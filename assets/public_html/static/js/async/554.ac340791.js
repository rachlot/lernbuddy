/*! For license information please see 554.ac340791.js.LICENSE.txt */
(self.webpackChunkdashjoin_gui=self.webpackChunkdashjoin_gui||[]).push([["554"],{60401:function(e,i,n){n(52406),n(29874),n(59236),n(82578),n(36699)},16453:function(e){e.exports=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},44379:function(e){e.exports=function(e,i,n){this.type=e,this.index=i,this.pressed=n.pressed,this.value=n.value}},34657:function(e){function i(e){let i=document.getElementById(e),n=i.parentNode;try{n&&n.removeChild(i)}catch(e){}}e.exports=function(e){return e=e||{},function(n,r){var s;return s=r=r||{},new(e.Promise||Promise)(function(e,r){var a;let o=s.timeout||5e3,l="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),h=((a=document.createElement("script")).type="text/javascript",a.async=!0,a.id=l,a.src=n,a),u=setTimeout(function(){r(Error("Script request to "+n+" timed out")),i(l)},o),c=function(e){clearTimeout(e)};h.addEventListener("load",function(n){e({ok:!0}),c(u),i(l)}),h.addEventListener("error",function(e){r(Error("Script request to "+n+" failed "+e)),c(u),i(l)}),function(e){let i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}(h)})}}},77454:function(){!function(e){var i,n,r="KeyboardEvent"in e;r||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var s=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,a=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,o=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,l=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function h(e,i){return -1!==String(e).indexOf(i)}var u=h(navigator.platform,"Win")?"win":h(navigator.platform,"Mac")?"mac":h(navigator.platform,"CrOS")?"cros":h(navigator.platform,"Linux")?"linux":h(navigator.userAgent,"iPad")||h(navigator.platform,"iPod")||h(navigator.platform,"iPhone")?"ios":"",c=h(navigator.userAgent,"Chrome/")?"chrome":h(navigator.vendor,"Apple")?"safari":h(navigator.userAgent,"MSIE")?"ie":h(navigator.userAgent,"Gecko/")?"moz":h(navigator.userAgent,"Opera/")?"opera":"",d=c+"-"+u;function p(e,i,n){(d===i||c===i||u===i)&&Object.keys(n).forEach(function(i){e[i]=n[i]})}var f={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:a},92:{code:"OSRight",location:o},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:l},97:{code:"Numpad1",keyCap:"1",location:l},98:{code:"Numpad2",keyCap:"2",location:l},99:{code:"Numpad3",keyCap:"3",location:l},100:{code:"Numpad4",keyCap:"4",location:l},101:{code:"Numpad5",keyCap:"5",location:l},102:{code:"Numpad6",keyCap:"6",location:l},103:{code:"Numpad7",keyCap:"7",location:l},104:{code:"Numpad8",keyCap:"8",location:l},105:{code:"Numpad9",keyCap:"9",location:l},106:{code:"NumpadMultiply",keyCap:"*",location:l},107:{code:"NumpadAdd",keyCap:"+",location:l},108:{code:"NumpadComma",keyCap:",",location:l},109:{code:"NumpadSubtract",keyCap:"-",location:l},110:{code:"NumpadDecimal",keyCap:".",location:l},111:{code:"NumpadDivide",keyCap:"/",location:l},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:l},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:a},161:{code:"ShiftRight",location:o},162:{code:"ControlLeft",location:a},163:{code:"ControlRight",location:o},164:{code:"AltLeft",location:a},165:{code:"AltRight",location:o},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};p(f,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:l},189:{code:"NumpadSubtract",keyCap:"-",location:l}}),p(f,"moz-mac",{12:{code:"NumLock",location:l},173:{code:"Minus",keyCap:"-"}}),p(f,"moz-win",{173:{code:"Minus",keyCap:"-"}}),p(f,"chrome-mac",{93:{code:"OSRight",location:o}}),p(f,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),p(f,"ios",{10:{code:"Enter",location:s}}),p(f,"safari-mac",{91:{code:"OSLeft",location:a},93:{code:"OSRight",location:o},229:{code:"KeyQ",keyCap:"Q"}});var m={};"cros"===u&&(m["U+00A0"]={code:"ShiftLeft",location:a},m["U+00A1"]={code:"ShiftRight",location:o},m["U+00A2"]={code:"ControlLeft",location:a},m["U+00A3"]={code:"ControlRight",location:o},m["U+00A4"]={code:"AltLeft",location:a},m["U+00A5"]={code:"AltRight",location:o}),"chrome-mac"===d&&(m["U+0010"]={code:"ContextMenu"}),"safari-mac"===d&&(m["U+0010"]={code:"ContextMenu"}),"ios"===u&&(m["U+0010"]={code:"Function"},m["U+001C"]={code:"ArrowLeft"},m["U+001D"]={code:"ArrowRight"},m["U+001E"]={code:"ArrowUp"},m["U+001F"]={code:"ArrowDown"},m["U+0001"]={code:"Home"},m["U+0004"]={code:"End"},m["U+000B"]={code:"PageUp"},m["U+000C"]={code:"PageDown"});var g=[];g[a]={16:{code:"ShiftLeft",location:a},17:{code:"ControlLeft",location:a},18:{code:"AltLeft",location:a}},g[o]={16:{code:"ShiftRight",location:o},17:{code:"ControlRight",location:o},18:{code:"AltRight",location:o}},g[l]={13:{code:"NumpadEnter",location:l}},p(g[l],"moz",{109:{code:"NumpadSubtract",location:l},107:{code:"NumpadAdd",location:l}}),p(g[a],"moz-mac",{224:{code:"OSLeft",location:a}}),p(g[o],"moz-mac",{224:{code:"OSRight",location:o}}),p(g[o],"moz-win",{91:{code:"OSRight",location:o}}),p(g[o],"mac",{93:{code:"OSRight",location:o}}),p(g[l],"chrome-mac",{12:{code:"NumLock",location:l}}),p(g[l],"safari-mac",{12:{code:"NumLock",location:l},187:{code:"NumpadAdd",location:l},189:{code:"NumpadSubtract",location:l},190:{code:"NumpadDecimal",location:l},191:{code:"NumpadDivide",location:l}});var A={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};p(A,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var v={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},y=(i="code",n={},Object.keys(f).forEach(function(e){var r=f[e];i in r&&(n[r[i]]=r)}),n);try{var x=r&&"location"in new KeyboardEvent("")}catch(e){}function _(e){var i,n="keyCode"in e?e.keyCode:"which"in e?e.which:0,r=function(){if(x||"keyLocation"in e){var i=x?e.location:e.keyLocation;if(i&&n in g[i])return g[i][n]}return"keyIdentifier"in e&&e.keyIdentifier in m?m[e.keyIdentifier]:n in f?f[n]:null}();if(!r)return null;var s=(i=A[r.code])?e.shiftKey&&"shiftKey"in i?i.shiftKey:i.key:r.code;return{code:r.code,key:s,location:r.location,keyCap:r.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,i,n){i in e||Object.defineProperty(e,i,n)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=_(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var i=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=i.get.call(this);return v.hasOwnProperty(e)?v[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=_(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=_(this);return e&&"location"in e?e.location:s}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,i){if(e=String(e),!y.hasOwnProperty(e))return"Undefined";if(i&&"en-us"!==String(i).toLowerCase())throw Error("Unsupported locale");var n=y[e];return n.keyCap||n.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var i=_(e);e.code=i?i.code:"",e.key=i&&"key"in i?i.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:i&&"location"in i?i.location:s,e.locale=""}}}(window)},60158:function(e,i,n){"use strict";n.r(i),n.d(i,{Pathfinding:()=>l,PathfindingHelper:()=>h});var r=n(1466);class s{static roundNumber(e,i){let n=Math.pow(10,i);return Math.round(e*n)/n}static sample(e){return e[Math.floor(Math.random()*e.length)]}static distanceToSquared(e,i){var n=e.x-i.x,r=e.y-i.y,s=e.z-i.z;return n*n+r*r+s*s}static isPointInPoly(e,i){for(var n=!1,r=-1,s=e.length,a=s-1;++r<s;a=r)(e[r].z<=i.z&&i.z<e[a].z||e[a].z<=i.z&&i.z<e[r].z)&&i.x<(e[a].x-e[r].x)*(i.z-e[r].z)/(e[a].z-e[r].z)+e[r].x&&(n=!n);return n}static isVectorInPolygon(e,i,n){var r=1e5,s=-1e5,a=[];return i.vertexIds.forEach(e=>{r=Math.min(n[e].y,r),s=Math.max(n[e].y,s),a.push(n[e])}),!!(e.y<s+.5&&e.y>r-.5&&this.isPointInPoly(a,e))}static triarea2(e,i,n){return(n.x-e.x)*(i.z-e.z)-(i.x-e.x)*(n.z-e.z)}static vequal(e,i){return 1e-5>this.distanceToSquared(e,i)}static mergeVertices(e,i=1e-4){i=Math.max(i,Number.EPSILON);for(var n={},s=e.getIndex(),a=e.getAttribute("position"),o=s?s.count:a.count,l=0,h=[],u=[],c=Math.log10(1/i),d=Math.pow(10,c),p=0;p<o;p++){var f=s?s.getX(p):p,m="";(m+=~~(a.getX(f)*d)+","+~~(a.getY(f)*d)+","+~~(a.getZ(f)*d)+",")in n?h.push(n[m]):(u.push(a.getX(f)),u.push(a.getY(f)),u.push(a.getZ(f)),n[m]=l,h.push(l),l++)}let g=new r.TlE(new Float32Array(u),a.itemSize,a.normalized),A=new r.u9r;return A.setAttribute("position",g),A.setIndex(h),A}}class a{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){let e=this.content[0],i=this.content.pop();return this.content.length>0&&(this.content[0]=i,this.bubbleUp(0)),e}remove(e){let i=this.content.indexOf(e),n=this.content.pop();i!==this.content.length-1&&(this.content[i]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(i):this.bubbleUp(i))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){let i=this.content[e];for(;e>0;){let n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(i)<this.scoreFunction(r)))break;this.content[n]=i,this.content[e]=r,e=n}}bubbleUp(e){let i=this.content.length,n=this.content[e],r=this.scoreFunction(n);for(;;){let s=e+1<<1,a=s-1,o,l=null;if(a<i&&(o=this.scoreFunction(this.content[a]))<r&&(l=a),s<i&&this.scoreFunction(this.content[s])<(null===l?r:o)&&(l=s),null===l)break;this.content[e]=this.content[l],this.content[l]=n,e=l}}}class o{constructor(){this.portals=[]}push(e,i){void 0===i&&(i=e),this.portals.push({left:e,right:i})}stringPull(){let e=this.portals,i=[],n,r,a,o=0,l=0,h=0;n=e[0].left,r=e[0].left,a=e[0].right,i.push(n);for(let u=1;u<e.length;u++){let c=e[u].left,d=e[u].right;if(0>=s.triarea2(n,a,d)){if(!(s.vequal(n,a)||s.triarea2(n,r,d)>0)){i.push(r),n=r,o=l,r=n,a=n,l=o,h=o,u=o;continue}a=d,h=u}if(s.triarea2(n,r,c)>=0){if(!(s.vequal(n,r)||0>s.triarea2(n,a,c))){i.push(a),n=a,o=h,r=n,a=n,l=o,h=o,u=o;continue}r=c,l=u}}return 0!==i.length&&s.vequal(i[i.length-1],e[e.length-1].left)||i.push(e[e.length-1].left),this.path=i,i}}class l{constructor(){this.zones={}}static createZone(e,i=1e-4){return(class{static buildZone(e,i){let n=this._buildNavigationMesh(e,i),a={};n.vertices.forEach(e=>{e.x=s.roundNumber(e.x,2),e.y=s.roundNumber(e.y,2),e.z=s.roundNumber(e.z,2)}),a.vertices=n.vertices;let o=this._buildPolygonGroups(n);return a.groups=Array(o.length),o.forEach((e,i)=>{let n=new Map;e.forEach((e,i)=>{n.set(e,i)});let o=Array(e.length);e.forEach((e,i)=>{let l=[];e.neighbours.forEach(e=>l.push(n.get(e)));let h=[];e.neighbours.forEach(i=>h.push(this._getSharedVerticesInOrder(e,i)));let u=new r.Pa4(0,0,0);u.add(a.vertices[e.vertexIds[0]]),u.add(a.vertices[e.vertexIds[1]]),u.add(a.vertices[e.vertexIds[2]]),u.divideScalar(3),u.x=s.roundNumber(u.x,2),u.y=s.roundNumber(u.y,2),u.z=s.roundNumber(u.z,2),o[i]={id:i,neighbours:l,vertexIds:e.vertexIds,centroid:u,portals:h}}),a.groups[i]=o}),a}static _buildNavigationMesh(e,i){return e=s.mergeVertices(e,i),this._buildPolygonsFromGeometry(e)}static _spreadGroupId(e){let i=new Set([e]);for(;i.size>0;){let n=i;i=new Set,n.forEach(n=>{n.group=e.group,n.neighbours.forEach(e=>{void 0===e.group&&i.add(e)})})}}static _buildPolygonGroups(e){let i=[];return e.polygons.forEach(e=>{void 0!==e.group?i[e.group].push(e):(e.group=i.length,this._spreadGroupId(e),i.push([e]))}),i}static _buildPolygonNeighbours(e,i){let n=new Set,r=i[e.vertexIds[1]],s=i[e.vertexIds[2]];return i[e.vertexIds[0]].forEach(i=>{i!==e&&(r.includes(i)||s.includes(i))&&n.add(i)}),r.forEach(i=>{i!==e&&s.includes(i)&&n.add(i)}),n}static _buildPolygonsFromGeometry(e){let i=[],n=[],s=e.attributes.position,a=e.index,o=[];for(let e=0;e<s.count;e++)n.push((new r.Pa4).fromBufferAttribute(s,e)),o[e]=[];for(let n=0;n<e.index.count;n+=3){let e=a.getX(n),r=a.getX(n+1),s=a.getX(n+2),l={vertexIds:[e,r,s],neighbours:null};i.push(l),o[e].push(l),o[r].push(l),o[s].push(l)}return i.forEach(e=>{e.neighbours=this._buildPolygonNeighbours(e,o)}),{polygons:i,vertices:n}}static _getSharedVerticesInOrder(e,i){let n=e.vertexIds,r=n[0],s=n[1],a=n[2],o=i.vertexIds,l=o.includes(r),h=o.includes(s),u=o.includes(a);return l&&h&&u?Array.from(n):l&&h?[r,s]:h&&u?[s,a]:l&&u?[a,r]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}).buildZone(e,i)}setZoneData(e,i){this.zones[e]=i}getRandomNode(e,i,n,a){if(!this.zones[e])return new r.Pa4;n=n||null,a=a||0;let o=[];return this.zones[e].groups[i].forEach(e=>{n&&a?s.distanceToSquared(n,e.centroid)<a*a&&o.push(e.centroid):o.push(e.centroid)}),s.sample(o)||new r.Pa4}getClosestNode(e,i,n,r=!1){let a=this.zones[i].vertices,o=null,l=1/0;return this.zones[i].groups[n].forEach(i=>{let n=s.distanceToSquared(i.centroid,e);n<l&&(!r||s.isVectorInPolygon(e,i,a))&&(o=i,l=n)}),o}findPath(e,i,n,l){let h=this.zones[n].groups[l],u=this.zones[n].vertices,c=this.getClosestNode(e,n,l,!0),d=this.getClosestNode(i,n,l,!0);if(!c||!d)return null;let p=(class{static init(e){for(let i=0;i<e.length;i++){let n=e[i];n.f=0,n.g=0,n.h=0,n.cost=1,n.visited=!1,n.closed=!1,n.parent=null}}static cleanUp(e){for(let i=0;i<e.length;i++){let n=e[i];delete n.f,delete n.g,delete n.h,delete n.cost,delete n.visited,delete n.closed,delete n.parent}}static heap(){return new a(function(e){return e.f})}static search(e,i,n){this.init(e);let r=this.heap();for(r.push(i);r.size()>0;){let i=r.pop();if(i===n){let e=i,n=[];for(;e.parent;)n.push(e),e=e.parent;return this.cleanUp(n),n.reverse()}i.closed=!0;let s=this.neighbours(e,i);for(let e=0,a=s.length;e<a;e++){let a=s[e];if(a.closed)continue;let o=i.g+a.cost,l=a.visited;if(!l||o<a.g){if(a.visited=!0,a.parent=i,!a.centroid||!n.centroid)throw Error("Unexpected state");a.h=a.h||this.heuristic(a.centroid,n.centroid),a.g=o,a.f=a.g+a.h,l?r.rescoreElement(a):r.push(a)}}}return[]}static heuristic(e,i){return s.distanceToSquared(e,i)}static neighbours(e,i){let n=[];for(let r=0;r<i.neighbours.length;r++)n.push(e[i.neighbours[r]]);return n}}).search(h,c,d),f=new o;f.push(e);for(let e=0;e<p.length;e++){let i=p[e],n=p[e+1];if(n){let e=function(e,i){for(var n=0;n<e.neighbours.length;n++)if(e.neighbours[n]===i.id)return e.portals[n]}(i,n);f.push(u[e[0]],u[e[1]])}}f.push(i),f.stringPull();let m=f.path.map(e=>new r.Pa4(e.x,e.y,e.z));return m.shift(),m}}l.prototype.getGroup=function(){let e=new r.JOQ;return function(i,n,r=!1){if(!this.zones[i])return null;let a=null,o=2500,l=this.zones[i];for(let i=0;i<l.groups.length;i++)for(let h of l.groups[i]){if(r&&(e.setFromCoplanarPoints(l.vertices[h.vertexIds[0]],l.vertices[h.vertexIds[1]],l.vertices[h.vertexIds[2]]),.01>Math.abs(e.distanceToPoint(n)))&&s.isPointInPoly([l.vertices[h.vertexIds[0]],l.vertices[h.vertexIds[1]],l.vertices[h.vertexIds[2]]],n))return i;let u=s.distanceToSquared(h.centroid,n);u<o&&(a=i,o=u)}return a}}(),l.prototype.clampStep=function(){let e=new r.Pa4,i=new r.JOQ,n=new r.CJI,s=new r.Pa4,a,o,l=new r.Pa4;return function(r,h,u,c,d,p){let f=this.zones[c].vertices,m=this.zones[c].groups[d],g=[u],A={};A[u.id]=0,a=void 0,l.set(0,0,0),o=1/0,i.setFromCoplanarPoints(f[u.vertexIds[0]],f[u.vertexIds[1]],f[u.vertexIds[2]]),i.projectPoint(h,e),s.copy(e);for(let i=g.pop();i;i=g.pop()){n.set(f[i.vertexIds[0]],f[i.vertexIds[1]],f[i.vertexIds[2]]),n.closestPointToPoint(s,e),e.distanceToSquared(s)<o&&(a=i,l.copy(e),o=e.distanceToSquared(s));let r=A[i.id];if(!(r>2))for(let e=0;e<i.neighbours.length;e++){let n=m[i.neighbours[e]];n.id in A||(g.push(n),A[n.id]=r+1)}}return p.copy(l),a}}();class h extends r.Tme{constructor(){super(),this._playerMarker=new r.Kj0(new r.xo$(.25,32,32),new r.vBJ({color:0xee836f})),this._targetMarker=new r.Kj0(new r.DvJ(.3,.3,.3),new r.vBJ({color:0xdccb18})),this._nodeMarker=new r.Kj0(new r.DvJ(.1,.8,.1),new r.vBJ({color:4417387})),this._stepMarker=new r.Kj0(new r.DvJ(.1,1,.1),new r.vBJ({color:0xdcd3b2})),this._pathMarker=new r.Tme,this._pathLineMaterial=new r.nls({color:41903,linewidth:2}),this._pathPointMaterial=new r.vBJ({color:41903}),this._pathPointGeometry=new r.xo$(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach(e=>{e.visible=!1,this.add(e)})}setPath(e){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);e=[this._playerMarker.position].concat(e);let i=new r.u9r;i.setAttribute("position",new r.TlE(new Float32Array(3*e.length),3));for(let n=0;n<e.length;n++)i.attributes.position.setXYZ(n,e[n].x,e[n].y+.2,e[n].z);this._pathMarker.add(new r.x12(i,this._pathLineMaterial));for(let i=0;i<e.length-1;i++){let n=new r.Kj0(this._pathPointGeometry,this._pathPointMaterial);n.position.copy(e[i]),n.position.y+=.2,this._pathMarker.add(n)}return this._pathMarker.visible=!0,this}setPlayerPosition(e){return this._playerMarker.position.copy(e),this._playerMarker.visible=!0,this}setTargetPosition(e){return this._targetMarker.position.copy(e),this._targetMarker.visible=!0,this}setNodePosition(e){return this._nodeMarker.position.copy(e),this._nodeMarker.visible=!0,this}setStepPosition(e){return this._stepMarker.position.copy(e),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach(e=>{e.visible=!1}),this}}},33386:function(e){e.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){let i=this.el;if(this.active&&this.checkpoint!==e){if(this.checkpoint&&i.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),.1>this.position.distanceTo(this.targetPosition)){this.checkpoint=null;return}i.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,i.emit("navigation-end",{checkpoint:e}),i.components["movement-controls"].updateNavLocation())}},isVelocityActive:function(){return!!(this.active&&this.checkpoint)},getVelocity:function(){if(!this.active)return;let e=this.data,i=this.offset,n=this.position,r=this.targetPosition,s=this.checkpoint;return(this.sync(),.1>n.distanceTo(r))?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:s}),i.set(0,0,0)):(i.setLength(e.animateSpeed),i)},sync:function(){let e=this.offset,i=this.position,n=this.targetPosition;i.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(n),n.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(n).sub(i)}})},45062:function(e,i,n){let r=n(16453),s=n(44379),a={LEFT:"left",RIGHT:"right"},o={MOVEMENT:1,ROTATION:2};e.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:r,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){let e=this.el.sceneEl;this.system=e.systems["tracked-controls"]||e.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};let i=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=i.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=i.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,e.addBehavior(this)},update:function(){this.tick()},tick:function(e,i){this.updateButtonState(),this.updateRotation(i)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;let e=this._dpadVector,i=this._moveVector;this.getDpad(e),this.getJoystick(o.MOVEMENT,i);let n=e.x||i.x,r=e.y||i.y;return Math.abs(n)>.2||Math.abs(r)>.2},getVelocityDelta:function(){let e=this._dpadVector,i=this._moveVector;this.getDpad(e),this.getJoystick(o.MOVEMENT,i);let n=e.x||i.x,r=e.y||i.y,s=new THREE.Vector3;return Math.abs(n)>.2&&(s.x+=n),Math.abs(r)>.2&&(s.z+=r),s},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;let e=this._lookVector;return this.getJoystick(o.ROTATION,e),Math.abs(e.x)>.2||Math.abs(e.y)>.2},updateRotation:function(e){if(!this.isRotationActive())return;let i=this.data,n=this.yaw,r=this.pitch;n.rotation.y=this.el.object3D.rotation.y,r.rotation.x=this.el.object3D.rotation.x;let s=this._lookVector;this.getJoystick(o.ROTATION,s),.2>=Math.abs(s.x)&&(s.x=0),.2>=Math.abs(s.y)&&(s.y=0),s.multiplyScalar(i.rotationSensitivity*e/1e3),n.rotation.y-=s.x,r.rotation.x-=s.y,r.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,r.rotation.x)),this.el.object3D.rotation.set(r.rotation.x,n.rotation.y,0)},updateButtonState:function(){let e=this.getGamepad(a.RIGHT);if(this.data.enabled&&e)for(var i=0;i<e.buttons.length;i++)e.buttons[i].pressed&&!this.buttons[i]?this.emit(new s("gamepadbuttondown",i,e.buttons[i])):!e.buttons[i].pressed&&this.buttons[i]&&this.emit(new s("gamepadbuttonup",i,e.buttons[i])),this.buttons[i]=e.buttons[i].pressed;else for(let e in this.buttons)this.buttons[e]=!1},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new s(e.type,e.index,e))},getGamepad:function(){let e=[],i=[];return function(n){let r=this.el.sceneEl.components["proxy-controls"],s=r&&r.isConnected()&&r.getGamepad(0);if(s)return s;e.length=0;for(let i=0;i<this.system.controllers.length;i++){let r=this.system.controllers[i],s=r?r.gamepad:null;if(e.push(s),s&&r.handedness===n)return s}let a=navigator.getGamepads?navigator.getGamepads():i;for(let e=0;e<a.length;e++){let i=a[e];if(i&&i.hand===n)return i}return e[0]||a[0]}}(),getButton:function(e){return this.getGamepad(a.RIGHT).buttons[e]},getAxis:function(e){return this.getGamepad(e>1?a.RIGHT:a.LEFT).axes[e]},getJoystick:function(e,i){let n=this.getGamepad(e===o.MOVEMENT?a.LEFT:a.RIGHT);if(!n)return i.set(0,0);if("xr-standard"===n.mapping)switch(e){case o.MOVEMENT:return i.set(n.axes[2],n.axes[3]);case o.ROTATION:return i.set(n.axes[2],0)}else switch(e){case o.MOVEMENT:return i.set(n.axes[0],n.axes[1]);case o.ROTATION:return i.set(n.axes[2],n.axes[3])}throw Error('Unexpected joystick index "%d".',e)},getDpad:function(e){let i=this.getGamepad(a.LEFT);return i&&i.buttons[r.DPAD_RIGHT]?e.set(+!!i.buttons[r.DPAD_RIGHT].pressed+(i.buttons[r.DPAD_LEFT].pressed?-1:0),(i.buttons[r.DPAD_UP].pressed?-1:0)+ +!!i.buttons[r.DPAD_DOWN].pressed):e.set(0,0)},isConnected:function(){let e=this.getGamepad(a.LEFT);return!!(e&&e.connected)},getID:function(){return this.getGamepad(a.LEFT).id}})},52406:function(e,i,n){n(33386),n(45062),n(32250),n(79048),n(43819),n(99893),n(94476)},32250:function(e,i,n){n(77454);let r=window.KeyboardEvent;e.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){let e=this.data,i=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((i.KeyW||i.ArrowUp)&&(this.dVelocity.z-=1),(i.KeyA||i.ArrowLeft)&&(this.dVelocity.x-=1),(i.KeyS||i.ArrowDown)&&(this.dVelocity.z+=1),(i.KeyD||i.ArrowRight)&&(this.dVelocity.x+=1),i.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(let e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(let e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new r(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){let e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}})},43819:function(e){let i="-controls";e.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){let e=this.el;this.data.camera||(this.data.camera=e.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){let n=this.el,r=this.data,s=n.sceneEl.systems.nav;if(n.sceneEl.hasLoaded&&this.injectControls(),s&&r.constrainToNavMesh!==e.constrainToNavMesh&&(r.constrainToNavMesh?s.addAgent(this):s.removeAgent(this)),r.enabled!==e.enabled)for(let e=0;e<r.controls.length;e++){let n=r.controls[e]+i;this.el.setAttribute(n,{enabled:this.data.enabled})}},injectControls:function(){let e=this.data;for(let n=0;n<e.controls.length;n++){let r=e.controls[n]+i;this.el.setAttribute(r,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){let e=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3;return function(r,s){if(!s)return;let a=this.el,o=this.data;if(!o.enabled)return;this.updateVelocityCtrl();let l=this.velocityCtrl,h=this.velocity;if(l){if(s/1e3>.2?h.set(0,0,0):this.updateVelocity(s),o.constrainToNavMesh&&!1!==l.isNavMeshConstrained){if(1e-5>h.lengthSq())return;e.copy(a.object3D.position),i.copy(h).multiplyScalar(s/1e3).add(e);let r=a.sceneEl.systems.nav;this.navGroup=null===this.navGroup?r.getGroup(e):this.navGroup,this.navNode=this.navNode||r.getNode(e,this.navGroup),this.navNode=r.clampStep(e,i,this.navGroup,this.navNode,n),a.object3D.position.copy(n)}else a.hasAttribute("velocity")?a.setAttribute("velocity",h):(a.object3D.position.x+=h.x*s/1e3,a.object3D.position.y+=h.y*s/1e3,a.object3D.position.z+=h.z*s/1e3)}}}(),updateVelocityCtrl:function(){let e=this.data;if(e.enabled){for(let n=0,r=e.controls.length;n<r;n++){let r=this.el.components[e.controls[n]+i];if(r&&r.isVelocityActive()){this.velocityCtrl=r;return}}this.velocityCtrl=null}},updateVelocity:function(){let e=new THREE.Vector2,i=new THREE.Quaternion;return function(n){let r;let s=this.el,a=this.velocityCtrl,o=this.velocity,l=this.data;if(a){if(a.getVelocityDelta)r=a.getVelocityDelta(n);else if(a.getVelocity){o.copy(a.getVelocity());return}else if(a.getPositionDelta){o.copy(a.getPositionDelta(n).multiplyScalar(1e3/n));return}else throw Error("Incompatible movement controls: ",a)}if(s.hasAttribute("velocity")&&!l.constrainToNavMesh&&o.copy(this.el.getAttribute("velocity")),r&&l.enabled){let n=l.camera;i.copy(n.object3D.quaternion),i.premultiply(s.object3D.quaternion),r.applyQuaternion(i);let a=r.length();l.fly?(o.copy(r),o.multiplyScalar(16.66667*this.data.speed)):(e.set(r.x,r.z),e.setLength(a*this.data.speed*16.66667),o.x=e.x,o.y=0,o.z=e.y),(0!==o.x||0!==o.y||0!==o.z)&&(this.eventDetail.velocity=o,this.el.emit("moved",this.eventDetail))}}}()})},94476:function(e,i,n){"use strict";n.r(i);var r=n(59694),s=n.n(r);AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;let e=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=e.pitchObject,this.yawObject=e.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(e){(this.data.moveJoystickPosition!==e.moveJoystickPosition||this.data.sideMargin!==e.sideMargin||this.data.bottomMargin!==e.bottomMargin||this.data.mode!==e.mode)&&this.removeMoveJoystick(),(this.data.lookJoystickPosition!==e.lookJoystickPosition||this.data.sideMargin!==e.sideMargin||this.data.bottomMargin!==e.bottomMargin||this.data.mode!==e.mode)&&this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){let e=this.moveData.force<1?this.moveData.force:1,i=this.moveData.angle.radian,n=Math.cos(i)*e,r=-Math.sin(i)*e;this.dVelocity.set(n,0,r)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(e){if(!this.isRotationActive())return;let i=this.lookData.force<1?this.lookData.force:1,n=this.lookData.angle.radian,r=this.lookVector;r.x=Math.cos(n)*i,r.y=Math.sin(n)*i,r.multiplyScalar(this.data.rotationSensitivity*e/1e3),this.yawObject.rotation.y-=r.x;let s=this.pitchObject.rotation.x+r.y;s=Math.max(-Math.PI/2,Math.min(Math.PI/2,s)),this.pitchObject.rotation.x=s},tick:function(e,i){this.updateRotation(i)},initLeftZone(){let e=document.createElement("div");e.setAttribute("id","joystickLeftZone"),e.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(e),this.leftZone=e},initRightZone(){let e=document.createElement("div");e.setAttribute("id","joystickRightZone"),e.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(e),this.rightZone=e},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();let e={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px","static"===this.data.mode?(this.leftZone.style.height="100px",e.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=s().create(e),this.moveJoystick.on("move",(e,i)=>{this.moveData=i,this.moving=!0}),this.moveJoystick.on("end",(e,i)=>{this.moving=!1})},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();let e={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px","static"===this.data.mode?(this.rightZone.style.height="100px",e.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=s().create(e),this.lookJoystick.on("move",(e,i)=>{this.lookData=i,this.rotating=!0}),this.lookJoystick.on("end",(e,i)=>{this.rotating=!1})},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}})},79048:function(e){e.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){let e=this.el.sceneEl,i=e.canvas;if(!i){e.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}i.addEventListener("touchstart",this.onTouchStart,{passive:!0}),i.addEventListener("touchend",this.onTouchEnd,{passive:!0});let n=e.getAttribute("vr-mode-ui");n&&n.cardboardModeEnabled&&e.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){let e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&e.touches&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()},onEnterVR:function(){let e=this.el.sceneEl.xrSession;e&&(e.addEventListener("selectstart",this.onTouchStart),e.addEventListener("selectend",this.onTouchEnd))}})},99893:function(e){e.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){let e=this.data,i=this.el.sceneEl;switch(i.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":i.addEventListener("trackpadtouchstart",this.onTouchStart),i.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":i.addEventListener("trackpaddown",this.onTouchStart),i.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){let e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){let i=this.data,n=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=n[0],this.startingAxisData[1]=n[1]),this.startingAxisData.length>0){let e=0,r=0;i.enableNegX&&n[0]<this.startingAxisData[0]&&(e=-1),i.enablePosX&&n[0]>this.startingAxisData[0]&&(e=1),i.enablePosZ&&n[1]>this.startingAxisData[1]&&(r=-1),i.enableNegZ&&n[1]<this.startingAxisData[1]&&(r=1);let s=Math.abs(this.startingAxisData[1]-n[1]);Math.abs(this.startingAxisData[0]-n[0])>s?(this.zVel=0,this.xVel=e):(this.xVel=0,this.zVel=r),this.isMoving=!0}},handleTouchAxis:function(e){let i=this.data,n=e.detail.axis,r=0,s=0;i.enableNegX&&n[0]<0&&(r=-1),i.enablePosX&&n[0]>0&&(r=1),i.enablePosZ&&n[1]>0&&(s=-1),i.enableNegZ&&n[1]<0&&(s=1),Math.abs(n[0])>Math.abs(n[1])?(this.zVel=0,this.xVel=r):(this.xVel=0,this.zVel=s)}})},76591:function(e){let i={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function n(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}e.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(i)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];let e=this.el.getObject3D("mesh");e?this.load(e):this.el.addEventListener("model-loaded",e=>{this.load(e.detail.model)})},load:function(e){let i=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",e=>{i.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})}),this.mixer.addEventListener("finished",e=>{i.emit("animation-finished",{action:e.action,direction:e.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(!e)return;let n=this.data,r=AFRAME.utils.diff(n,e);if("clip"in r){this.stopAction(),n.clip&&this.playAction();return}this.activeActions.forEach(e=>{"duration"in r&&n.duration&&e.setDuration(n.duration),"clampWhenFinished"in r&&(e.clampWhenFinished=n.clampWhenFinished),("loop"in r||"repetitions"in r)&&e.setLoop(i[n.loop],n.repetitions),"timeScale"in r&&e.setEffectiveTimeScale(n.timeScale)})},stopAction:function(){let e=this.data;for(let i=0;i<this.activeActions.length;i++)e.crossFadeDuration?this.activeActions[i].fadeOut(e.crossFadeDuration):this.activeActions[i].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;let e=this.model,r=this.data,s=e.animations||(e.geometry||{}).animations||[];if(!s.length)return;let a=r.useRegExp?r.clip:RegExp("^"+r.clip.split(/\*+/).map(n).join(".*")+"$");for(let n,o=0;n=s[o];o++)if(n.name.match(a)){let s=this.mixer.clipAction(n,e);s.enabled=!0,s.clampWhenFinished=r.clampWhenFinished,r.duration&&s.setDuration(r.duration),1!==r.timeScale&&s.setEffectiveTimeScale(r.timeScale),s.startAt(this.mixer.time-r.startAt/1e3),s.setLoop(i[r.loop],r.repetitions).fadeIn(r.crossFadeDuration).play(),this.activeActions.push(s)}},tick:function(e,i){this.mixer&&!isNaN(i)&&this.mixer.update(i/1e3)}})},30167:function(e,i,n){"use strict";var r=n(1466);class s extends r.yxD{constructor(e){super(e)}parse(e){if(e.length<19)throw Error("THREE.TGALoader: Not enough data to contain header.");let i=0,n=new Uint8Array(e),s={id_length:n[i++],colormap_type:n[i++],image_type:n[i++],colormap_index:n[i++]|n[i++]<<8,colormap_length:n[i++]|n[i++]<<8,colormap_size:n[i++],origin:[n[i++]|n[i++]<<8,n[i++]|n[i++]<<8],width:n[i++]|n[i++]<<8,height:n[i++]|n[i++]<<8,pixel_size:n[i++],flags:n[i++]};if(!function(e){switch(e.image_type){case 1:case 9:if(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)throw Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:if(e.colormap_type)throw Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:throw Error("THREE.TGALoader: No data.");default:throw Error("THREE.TGALoader: Invalid type "+e.image_type)}if(e.width<=0||e.height<=0)throw Error("THREE.TGALoader: Invalid image size.");if(8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size)throw Error("THREE.TGALoader: Invalid pixel size "+e.pixel_size)}(s),s.id_length+i>e.length)throw Error("THREE.TGALoader: No data.");i+=s.id_length;let a=!1,o=!1,l=!1;switch(s.image_type){case 9:a=!0,o=!0;break;case 1:o=!0;break;case 10:a=!0;break;case 2:break;case 11:a=!0,l=!0;break;case 3:l=!0}let h=new Uint8Array(s.width*s.height*4),u=function(e,i,n,r,s){let a,o;let l=n.pixel_size>>3,h=n.width*n.height*l;if(i&&(o=s.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),e){let e,i,n;a=new Uint8Array(h);let o=0,u=new Uint8Array(l);for(;o<h;)if(i=(127&(e=s[r++]))+1,128&e){for(n=0;n<l;++n)u[n]=s[r++];for(n=0;n<i;++n)a.set(u,o+n*l);o+=l*i}else{for(i*=l,n=0;n<i;++n)a[o+n]=s[r++];o+=i}}else a=s.subarray(r,r+=i?n.width*n.height:h);return{pixel_data:a,palettes:o}}(a,o,s,i,n);return!function(e,i,n,r,a){let o,h,u,c,d,p;switch((48&s.flags)>>4){default:case 2:o=0,u=1,d=i,h=0,c=1,p=n;break;case 0:o=0,u=1,d=i,h=n-1,c=-1,p=-1;break;case 3:o=i-1,u=-1,d=-1,h=0,c=1,p=n;break;case 1:o=i-1,u=-1,d=-1,h=n-1,c=-1,p=-1}if(l)switch(s.pixel_size){case 8:!function(e,i,n,r,a,o,l,h){let u,c=0,d,p,f=s.width;for(p=i;p!==r;p+=n)for(d=a;d!==l;d+=o,c++)u=h[c],e[(d+f*p)*4+0]=u,e[(d+f*p)*4+1]=u,e[(d+f*p)*4+2]=u,e[(d+f*p)*4+3]=255}(e,h,c,p,o,u,d,r);break;case 16:!function(e,i,n,r,a,o,l,h){let u=0,c,d,p=s.width;for(d=i;d!==r;d+=n)for(c=a;c!==l;c+=o,u+=2)e[(c+p*d)*4+0]=h[u+0],e[(c+p*d)*4+1]=h[u+0],e[(c+p*d)*4+2]=h[u+0],e[(c+p*d)*4+3]=h[u+1]}(e,h,c,p,o,u,d,r);break;default:throw Error("THREE.TGALoader: Format not supported.")}else switch(s.pixel_size){case 8:!function(e,i,n,r,a,o,l,h,u){let c,d=0,p,f,m=s.width;for(f=i;f!==r;f+=n)for(p=a;p!==l;p+=o,d++)c=h[d],e[(p+m*f)*4+3]=255,e[(p+m*f)*4+2]=u[3*c+0],e[(p+m*f)*4+1]=u[3*c+1],e[(p+m*f)*4+0]=u[3*c+2]}(e,h,c,p,o,u,d,r,a);break;case 16:!function(e,i,n,r,a,o,l,h){let u,c=0,d,p,f=s.width;for(p=i;p!==r;p+=n)for(d=a;d!==l;d+=o,c+=2)u=h[c+0]+(h[c+1]<<8),e[(d+f*p)*4+0]=(31744&u)>>7,e[(d+f*p)*4+1]=(992&u)>>2,e[(d+f*p)*4+2]=(31&u)<<3,e[(d+f*p)*4+3]=32768&u?0:255}(e,h,c,p,o,u,d,r);break;case 24:!function(e,i,n,r,a,o,l,h){let u=0,c,d,p=s.width;for(d=i;d!==r;d+=n)for(c=a;c!==l;c+=o,u+=3)e[(c+p*d)*4+3]=255,e[(c+p*d)*4+2]=h[u+0],e[(c+p*d)*4+1]=h[u+1],e[(c+p*d)*4+0]=h[u+2]}(e,h,c,p,o,u,d,r);break;case 32:!function(e,i,n,r,a,o,l,h){let u=0,c,d,p=s.width;for(d=i;d!==r;d+=n)for(c=a;c!==l;c+=o,u+=4)e[(c+p*d)*4+2]=h[u+0],e[(c+p*d)*4+1]=h[u+1],e[(c+p*d)*4+0]=h[u+2],e[(c+p*d)*4+3]=h[u+3]}(e,h,c,p,o,u,d,r);break;default:throw Error("THREE.TGALoader: Format not supported.")}}(h,s.width,s.height,u.pixel_data,u.palettes),{data:h,width:s.width,height:s.height,flipY:!0,generateMipmaps:!0,minFilter:r.D1R}}}class a extends r.aNw{load(e,i,n,s){let a=this,o=""===a.path?r.Zp0.extractUrlBase(e):a.path,l=new r.hH6(a.manager);l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(e,function(n){try{i(a.parse(n,o))}catch(i){s?s(i):console.error(i),a.manager.itemError(e)}},n,s)}parse(e,i){var n,a,o,l;let h;function u(e,i){let n=[],r=e.childNodes;for(let e=0,s=r.length;e<s;e++){let s=r[e];s.nodeName===i&&n.push(s)}return n}function c(e){if(0===e.length)return[];let i=e.trim().split(/\s+/),n=Array(i.length);for(let e=0,r=i.length;e<r;e++)n[e]=parseFloat(i[e]);return n}function d(e){if(0===e.length)return[];let i=e.trim().split(/\s+/),n=Array(i.length);for(let e=0,r=i.length;e<r;e++)n[e]=parseInt(i[e]);return n}function p(e){return e.substring(1)}function f(e){return 0===Object.keys(e).length}function m(e,i,n,r){let s=u(e,i)[0];if(void 0!==s){let e=u(s,n);for(let i=0;i<e.length;i++)r(e[i])}}function g(e,i){for(let n in e)e[n].build=i(e[n])}function A(e,i){return void 0!==e.build||(e.build=i(e)),e.build}function v(e){let i=[],n=e.channels,s=e.samplers,a=e.sources;for(let e in n)if(n.hasOwnProperty(e)){let o=n[e],l=s[o.sampler],h=l.inputs.INPUT,u=l.inputs.OUTPUT;!function(e,i){let n=e.keyframes,s=e.name,a=[],o=[],l=[],h=[];for(let e=0,i=n.length;e<i;e++){let i=n[e],r=i.time,s=i.value;V.fromArray(s).transpose(),V.decompose(x,b,_),a.push(r),o.push(x.x,x.y,x.z),l.push(b.x,b.y,b.z,b.w),h.push(_.x,_.y,_.z)}o.length>0&&i.push(new r.yC1(s+".position",a,o)),l.length>0&&i.push(new r.iLg(s+".quaternion",a,l)),h.length>0&&i.push(new r.yC1(s+".scale",a,h))}(function(e,i,n){let r,s,a,o,l,h;let u=eh.nodes[e.id],c=J(u.id),d=u.transforms[e.sid],p=u.matrix.clone().transpose(),f={};switch(d){case"matrix":for(a=0,o=i.array.length;a<o;a++)if(r=i.array[a],s=a*n.stride,void 0===f[r]&&(f[r]={}),!0===e.arraySyntax){let i=n.array[s],a=e.indices[0]+4*e.indices[1];f[r][a]=i}else for(l=0,h=n.stride;l<h;l++)f[r][l]=n.array[s+l];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',d)}let m=function(e,i){let n=[];for(let i in e)n.push({time:parseFloat(i),value:e[i]});n.sort(function(e,i){return e.time-i.time});for(let e=0;e<16;e++)!function(e,i,n){let r,s,a;let o=!0;for(s=0,a=e.length;s<a;s++)void 0===(r=e[s]).value[i]?r.value[i]=null:o=!1;if(!0===o)for(s=0,a=e.length;s<a;s++)(r=e[s]).value[i]=n;else!function(e,i){let n,r;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(null===a.value[i]){if(n=function(e,i,n){for(;i>=0;){let r=e[i];if(null!==r.value[n])return r;i--}return null}(e,s,i),r=function(e,i,n){for(;i<e.length;){let r=e[i];if(null!==r.value[n])return r;i++}return null}(e,s,i),null===n){a.value[i]=r.value[i];continue}if(null===r){a.value[i]=n.value[i];continue}!function(e,i,n,r){if(n.time-i.time==0){e.value[r]=i.value[r];return}e.value[r]=(e.time-i.time)*(n.value[r]-i.value[r])/(n.time-i.time)+i.value[r]}(a,n,r,i)}}}(e,i)}(n,e,i.elements[e]);return n}(f,p);return{name:c.uuid,keyframes:m}}(o,a[h],a[u]),i)}return i}function y(e){return A(eh.animations[e],v)}let x=new r.Pa4,_=new r.Pa4,b=new r._fP;function E(e){let i=[],n=e.name,s=e.end-e.start||-1,a=e.animations;for(let e=0,n=a.length;e<n;e++){let n=y(a[e]);for(let e=0,r=n.length;e<r;e++)i.push(n[e])}return new r.m7l(n,s,i)}function w(e){let i={id:e.id},n=eh.geometries[i.id];return void 0!==e.skin&&(i.skin=function(e){let i,n,s;let a={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,l=e.vertexWeights,h=l.vcount,u=l.v,c=l.inputs.JOINT.offset,d=l.inputs.WEIGHT.offset,p=e.sources[e.joints.inputs.JOINT],f=e.sources[e.joints.inputs.INV_BIND_MATRIX],m=o[l.inputs.WEIGHT.id].array,g=0;for(i=0,s=h.length;i<s;i++){let e=h[i],r=[];for(n=0;n<e;n++){let e=u[g+c],i=m[u[g+d]];r.push({index:e,weight:i}),g+=2}for(r.sort(A),n=0;n<4;n++){let e=r[n];void 0!==e?(a.indices.array.push(e.index),a.weights.array.push(e.weight)):(a.indices.array.push(0),a.weights.array.push(0))}}for(e.bindShapeMatrix?a.bindMatrix=new r.yGw().fromArray(e.bindShapeMatrix).transpose():a.bindMatrix=new r.yGw().identity(),i=0,s=p.array.length;i<s;i++){let e=p.array[i],n=new r.yGw().fromArray(f.array,i*f.stride).transpose();a.joints.push({name:e,boneInverse:n})}return a;function A(e,i){return i.weight-e.weight}}(e.skin),n.sources.skinIndices=i.skin.indices,n.sources.skinWeights=i.skin.weights),i}function M(e){return void 0!==e.build?e.build:e.init_from}function C(e){let i=eh.images[e];return void 0!==i?A(i,M):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function S(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"color":i[r.nodeName]=c(r.textContent);break;case"float":i[r.nodeName]=parseFloat(r.textContent);break;case"texture":i[r.nodeName]={id:r.getAttribute("texture"),extra:T(r)}}}return i}function T(e){let i={technique:{}};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"extra"===r.nodeName&&function(e,i){for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"technique"===r.nodeName&&function(e,i){for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":i.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?i.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?i.technique[r.nodeName]=0:i.technique[r.nodeName]=parseInt(r.textContent);break;case"bump":i[r.nodeName]=I(r)}}}(r,i)}}(r,i)}return i}function R(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"technique"===r.nodeName&&(i.technique=function(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"double_sided":i[r.nodeName]=parseInt(r.textContent);break;case"bump":i[r.nodeName]=I(r)}}return i}(r))}return i}function I(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"texture"===r.nodeName&&(i[r.nodeName]={id:r.getAttribute("texture"),texcoord:r.getAttribute("texcoord"),extra:T(r)})}return i}function B(e){return e}function L(e){var i;let n;let s=(i=e.url,A(eh.effects[i],B)),a=s.profile.technique;switch(a.type){case"phong":case"blinn":n=new r.xoR;break;case"lambert":n=new r.YBo;break;default:n=new r.vBJ}function o(e,i=null){let n=s.profile.samplers[e.id],a=null;if(void 0!==n?a=C(s.profile.surfaces[n.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),a=C(e.id)),null===a)return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null;{var l;let n,s;let o=n="tga"===(s=(s=(l=a).slice((l.lastIndexOf(".")-1>>>0)+2)).toLowerCase())?h:er;if(void 0===o)return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",a),null;{let n=o.load(a),s=e.extra;if(void 0!==s&&void 0!==s.technique&&!1===f(s.technique)){let e=s.technique;n.wrapS=e.wrapU?r.rpg:r.uWy,n.wrapT=e.wrapV?r.rpg:r.uWy,n.offset.set(e.offsetU||0,e.offsetV||0),n.repeat.set(e.repeatU||1,e.repeatV||1)}else n.wrapS=r.rpg,n.wrapT=r.rpg;return null!==i&&(n.colorSpace=i),n}}}n.name=e.name||"";let l=a.parameters;for(let e in l){let i=l[e];switch(e){case"diffuse":i.color&&n.color.fromArray(i.color),i.texture&&(n.map=o(i.texture,r.KI_));break;case"specular":i.color&&n.specular&&n.specular.fromArray(i.color),i.texture&&(n.specularMap=o(i.texture));break;case"bump":i.texture&&(n.normalMap=o(i.texture));break;case"ambient":i.texture&&(n.lightMap=o(i.texture,r.KI_));break;case"shininess":i.float&&n.shininess&&(n.shininess=i.float);break;case"emission":i.color&&n.emissive&&n.emissive.fromArray(i.color),i.texture&&(n.emissiveMap=o(i.texture,r.KI_))}}n.color.convertSRGBToLinear(),n.specular&&n.specular.convertSRGBToLinear(),n.emissive&&n.emissive.convertSRGBToLinear();let u=l.transparent,c=l.transparency;if(void 0===c&&u&&(c={float:1}),void 0===u&&c&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&c){if(u.data.texture)n.transparent=!0;else{let e=u.data.color;switch(u.opaque){case"A_ONE":n.opacity=e[3]*c.float;break;case"RGB_ZERO":n.opacity=1-e[0]*c.float;break;case"A_ZERO":n.opacity=1-e[3]*c.float;break;case"RGB_ONE":n.opacity=e[0]*c.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}n.opacity<1&&(n.transparent=!0)}}if(void 0!==a.extra&&void 0!==a.extra.technique){let e=a.extra.technique;for(let i in e){let s=e[i];switch(i){case"double_sided":n.side=1===s?r.ehD:r.Wl3;break;case"bump":n.normalMap=o(s.texture),n.normalScale=new r.FM8(1,1)}}}return n}function P(e){let i;switch(e.optics.technique){case"perspective":i=new r.cPb(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,s=e.optics.parameters.xmag,a=e.optics.parameters.aspect_ratio;s=void 0===s?n*a:s,n=void 0===n?s/a:n,s*=.5,n*=.5,i=new r.iKG(-s,s,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:i=new r.cPb}return i.name=e.name||"",i}function D(e){let i;switch(e.technique){case"directional":i=new r.Ox3;break;case"point":i=new r.cek;break;case"spot":i=new r.PMe;break;case"ambient":i=new r.Mig}return e.parameters.color&&i.color.copy(e.parameters.color),e.parameters.distance&&(i.distance=e.parameters.distance),i}function N(e){let i={array:[],stride:3};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"float_array":i.array=c(r.textContent);break;case"Name_array":i.array=function(e){if(0===e.length)return[];let i=e.trim().split(/\s+/),n=Array(i.length);for(let e=0,r=i.length;e<r;e++)n[e]=i[e];return n}(r.textContent);break;case"technique_common":let s=u(r,"accessor")[0];void 0!==s&&(i.stride=parseInt(s.getAttribute("stride")))}}return i}function O(e){let i={},n=e.sources,s=e.vertices,a=e.primitives;if(0===a.length)return{};let o=function(e){let i={};for(let n=0;n<e.length;n++){let r=e[n];void 0===i[r.type]&&(i[r.type]=[]),i[r.type].push(r)}return i}(a);for(let e in o){let a=o[e];!function(e){let i=0;for(let n=0,r=e.length;n<r;n++)!0===e[n].hasUV&&i++;i>0&&i<e.length&&(e.uvsNeedsFix=!0)}(a),i[e]=function(e,i,n){let s={},a={array:[],stride:0},o={array:[],stride:0},l={array:[],stride:0},h={array:[],stride:0},u={array:[],stride:0},c={array:[],stride:4},d={array:[],stride:4},p=new r.u9r,f=[],m=0;for(let r=0;r<e.length;r++){let s=e[r],g=s.inputs,A=0;switch(s.type){case"lines":case"linestrips":A=2*s.count;break;case"triangles":A=3*s.count;break;case"polylist":for(let e=0;e<s.count;e++){let i=s.vcount[e];switch(i){case 3:A+=3;break;case 4:A+=6;break;default:A+=(i-2)*3}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",s.type)}for(let v in p.addGroup(m,A,r),m+=A,s.material&&f.push(s.material),g){let r=g[v];switch(v){case"VERTEX":for(let p in n){let f=n[p];switch(p){case"POSITION":let m=a.array.length;if(U(s,i[f],r.offset,a.array),a.stride=i[f].stride,i.skinWeights&&i.skinIndices&&(U(s,i.skinIndices,r.offset,c.array),U(s,i.skinWeights,r.offset,d.array)),!1===s.hasUV&&!0===e.uvsNeedsFix){let e=(a.array.length-m)/a.stride;for(let i=0;i<e;i++)l.array.push(0,0)}break;case"NORMAL":U(s,i[f],r.offset,o.array),o.stride=i[f].stride;break;case"COLOR":U(s,i[f],r.offset,u.array),u.stride=i[f].stride;break;case"TEXCOORD":U(s,i[f],r.offset,l.array),l.stride=i[f].stride;break;case"TEXCOORD1":U(s,i[f],r.offset,h.array),l.stride=i[f].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',p)}}break;case"NORMAL":U(s,i[r.id],r.offset,o.array),o.stride=i[r.id].stride;break;case"COLOR":U(s,i[r.id],r.offset,u.array,!0),u.stride=i[r.id].stride;break;case"TEXCOORD":U(s,i[r.id],r.offset,l.array),l.stride=i[r.id].stride;break;case"TEXCOORD1":U(s,i[r.id],r.offset,h.array),h.stride=i[r.id].stride}}}return a.array.length>0&&p.setAttribute("position",new r.a$l(a.array,a.stride)),o.array.length>0&&p.setAttribute("normal",new r.a$l(o.array,o.stride)),u.array.length>0&&p.setAttribute("color",new r.a$l(u.array,u.stride)),l.array.length>0&&p.setAttribute("uv",new r.a$l(l.array,l.stride)),h.array.length>0&&p.setAttribute("uv1",new r.a$l(h.array,h.stride)),c.array.length>0&&p.setAttribute("skinIndex",new r.a$l(c.array,c.stride)),d.array.length>0&&p.setAttribute("skinWeight",new r.a$l(d.array,d.stride)),s.data=p,s.type=e[0].type,s.materialKeys=f,s}(a,n,s)}return i}function U(e,i,n,r,s=!1){let a=e.p,o=e.stride,l=e.vcount;function h(e){let i=a[e+n]*c,o=i+c;for(;i<o;i++)r.push(u[i]);if(s){let e=r.length-c-1;es.setRGB(r[e+0],r[e+1],r[e+2]).convertSRGBToLinear(),r[e+0]=es.r,r[e+1]=es.g,r[e+2]=es.b}}let u=i.array,c=i.stride;if(void 0!==e.vcount){let e=0;for(let i=0,n=l.length;i<n;i++){let n=l[i];if(4===n){let i=e+0*o,n=e+ +o,r=e+2*o,s=e+3*o;h(i),h(n),h(s),h(n),h(r),h(s)}else if(3===n){let i=e+0*o,n=e+ +o,r=e+2*o;h(i),h(n),h(r)}else if(n>4)for(let i=1,r=n-2;i<=r;i++){let n=e+0*o,r=e+o*i,s=e+o*(i+1);h(n),h(r),h(s)}e+=o*n}}else for(let e=0,i=a.length;e<i;e+=o)h(e)}function k(e){return A(eh.geometries[e],O)}function F(e){return void 0!==e.build?e.build:e}function z(e){let i={type:e.nodeName},n=c(e.textContent);switch(i.type){case"matrix":i.obj=new r.yGw,i.obj.fromArray(n).transpose();break;case"translate":i.obj=new r.Pa4,i.obj.fromArray(n);break;case"rotate":i.obj=new r.Pa4,i.obj.fromArray(n),i.angle=r.M8C.degToRad(n[3])}return i}function G(e){return void 0!==e.build?e.build:e}let V=new r.yGw,j=new r.Pa4;function H(e){let i={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new r.yGw,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){let s;let a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"node":i.nodes.push(a.getAttribute("id")),H(a);break;case"instance_camera":i.instanceCameras.push(p(a.getAttribute("url")));break;case"instance_controller":i.instanceControllers.push(Q(a));break;case"instance_light":i.instanceLights.push(p(a.getAttribute("url")));break;case"instance_geometry":i.instanceGeometries.push(Q(a));break;case"instance_node":i.instanceNodes.push(p(a.getAttribute("url")));break;case"matrix":s=c(a.textContent),i.matrix.multiply(V.fromArray(s).transpose()),i.transforms[a.getAttribute("sid")]=a.nodeName;break;case"translate":s=c(a.textContent),j.fromArray(s),i.matrix.multiply(V.makeTranslation(j.x,j.y,j.z)),i.transforms[a.getAttribute("sid")]=a.nodeName;break;case"rotate":s=c(a.textContent);let o=r.M8C.degToRad(s[3]);i.matrix.multiply(V.makeRotationAxis(j.fromArray(s),o)),i.transforms[a.getAttribute("sid")]=a.nodeName;break;case"scale":s=c(a.textContent),i.matrix.scale(j.fromArray(s)),i.transforms[a.getAttribute("sid")]=a.nodeName;break;case"extra":break;default:console.log(a)}}return Y(i.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",i.id):eh.nodes[i.id]=i,i}function Q(e){let i={id:p(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];switch(r.nodeName){case"bind_material":let s=r.getElementsByTagName("instance_material");for(let e=0;e<s.length;e++){let n=s[e],r=n.getAttribute("symbol"),a=n.getAttribute("target");i.materials[r]=p(a)}break;case"skeleton":i.skeletons.push(p(r.textContent))}}return i}function W(e,i,n){e.traverse(function(e){if(!0===e.isBone){let s;for(let n=0;n<i.length;n++){let r=i[n];if(r.name===e.name){s=r.boneInverse;break}}void 0===s&&(s=new r.yGw),n.push({bone:e,boneInverse:s,processed:!1})}})}function q(e){let i;let n=[],s=e.matrix,a=e.nodes,o=e.type,l=e.instanceCameras,h=e.instanceControllers,u=e.instanceLights,c=e.instanceGeometries,d=e.instanceNodes;for(let e=0,i=a.length;e<i;e++)n.push(J(a[e]));for(let e=0,i=l.length;e<i;e++){let i=function(e){let i=eh.cameras[e];return void 0!==i?A(i,P):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}(l[e]);null!==i&&n.push(i.clone())}for(let e=0,i=h.length;e<i;e++){var p;let i=h[e],s=(p=i.id,A(eh.controllers[p],w)),a=K(k(s.id),i.materials),o=function(e,i){let n,s,a;let o=[],l=[];for(n=0;n<e.length;n++){let r=e[n];if(Y(r))W(J(r),i,o);else{var h;if(h=r,void 0!==eh.visualScenes[h]){let e=eh.visualScenes[r].children;for(let n=0;n<e.length;n++){let r=e[n];"JOINT"===r.type&&W(J(r.id),i,o)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",r)}}for(n=0;n<i.length;n++)for(s=0;s<o.length;s++)if((a=o[s]).bone.name===i[n].name){l[n]=a,a.processed=!0;break}for(n=0;n<o.length;n++)!1===(a=o[n]).processed&&(l.push(a),a.processed=!0);let u=[],c=[];for(n=0;n<l.length;n++)a=l[n],u.push(a.bone),c.push(a.boneInverse);return new r.OdW(u,c)}(i.skeletons,s.skin.joints);for(let e=0,i=a.length;e<i;e++){let i=a[e];i.isSkinnedMesh&&(i.bind(o,s.skin.bindMatrix),i.normalizeSkinWeights()),n.push(i)}}for(let e=0,i=u.length;e<i;e++){let i=function(e){let i=eh.lights[e];return void 0!==i?A(i,D):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}(u[e]);null!==i&&n.push(i.clone())}for(let e=0,i=c.length;e<i;e++){let i=c[e],r=K(k(i.id),i.materials);for(let e=0,i=r.length;e<i;e++)n.push(r[e])}for(let e=0,i=d.length;e<i;e++)n.push(J(d[e]).clone());if(0===a.length&&1===n.length)i=n[0];else{i="JOINT"===o?new r.N$j:new r.ZAu;for(let e=0;e<n.length;e++)i.add(n[e])}return i.name="JOINT"===o?e.sid:e.name,i.matrix.copy(s),i.matrix.decompose(i.position,i.quaternion,i.scale),i}let X=new r.vBJ({name:r.aNw.DEFAULT_MATERIAL_NAME,color:0xff00ff});function K(e,i){let n=[];for(let s in e){let a;let o=e[s],l=function(e,i){let n=[];for(let r=0,s=e.length;r<s;r++){let s=i[e[r]];if(void 0===s)console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[r]),n.push(X);else n.push(A(eh.materials[s],L))}return n}(o.materialKeys,i);if(0===l.length&&("lines"===s||"linestrips"===s?l.push(new r.nls):l.push(new r.xoR)),"lines"===s||"linestrips"===s)for(let e=0,i=l.length;e<i;e++){let i=l[e];if(!0===i.isMeshPhongMaterial||!0===i.isMeshLambertMaterial){let n=new r.nls;n.color.copy(i.color),n.opacity=i.opacity,n.transparent=i.transparent,l[e]=n}}let h=void 0!==o.data.attributes.skinIndex,u=1===l.length?l[0]:l;switch(s){case"lines":a=new r.ejS(o.data,u);break;case"linestrips":a=new r.x12(o.data,u);break;case"triangles":case"polylist":a=h?new r.TUv(o.data,u):new r.Kj0(o.data,u)}n.push(a)}return n}function Y(e){return void 0!==eh.nodes[e]}function J(e){return A(eh.nodes[e],q)}function Z(e){let i=new r.ZAu;i.name=e.name;let n=e.children;for(let e=0;e<n.length;e++){let r=n[e];i.add(J(r.id))}return i}function $(e){return A(eh.visualScenes[e],Z)}if(0===e.length)return{scene:new r.xsS};let ee=new DOMParser().parseFromString(e,"application/xml"),et=u(ee,"COLLADA")[0],ei=ee.getElementsByTagName("parsererror")[0];if(void 0!==ei){let e;let i=u(ei,"div")[0];return console.error("THREE.ColladaLoader: Failed to parse collada file.\n",i?i.textContent:function(e){let i="",n=[e];for(;n.length;){let e=n.shift();e.nodeType===Node.TEXT_NODE?i+=e.textContent:(i+="\n",n.push.apply(n,e.childNodes))}return i.trim()}(ei)),null}console.debug("THREE.ColladaLoader: File version",et.getAttribute("version"));let en=(n=u(et,"asset")[0],{unit:void 0!==(o=u(n,"unit")[0])&&!0===o.hasAttribute("meter")?parseFloat(o.getAttribute("meter")):1,upAxis:void 0!==(l=u(n,"up_axis")[0])?l.textContent:"Y_UP"}),er=new r.dpR(this.manager);er.setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin),s&&(h=new s(this.manager)).setPath(this.resourcePath||i);let es=new r.Ilk,ea=[],eo={},el=0,eh={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};m(et,"library_animations","animation",function e(i){let n={sources:{},samplers:{},channels:{}},s=!1;for(let r=0,a=i.childNodes.length;r<a;r++){let a;let o=i.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"source":a=o.getAttribute("id"),n.sources[a]=N(o);break;case"sampler":a=o.getAttribute("id"),n.samplers[a]=function(e){let i={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType&&"input"===r.nodeName){let e=p(r.getAttribute("source")),n=r.getAttribute("semantic");i.inputs[n]=e}}return i}(o);break;case"channel":a=o.getAttribute("target"),n.channels[a]=function(e){let i={},n=e.getAttribute("target").split("/"),r=n.shift(),s=n.shift(),a=-1!==s.indexOf("("),o=-1!==s.indexOf(".");if(o)s=(n=s.split(".")).shift(),i.member=n.shift();else if(a){let e=s.split("(");s=e.shift();for(let i=0;i<e.length;i++)e[i]=parseInt(e[i].replace(/\)/,""));i.indices=e}return i.id=r,i.sid=s,i.arraySyntax=a,i.memberSyntax=o,i.sampler=p(e.getAttribute("source")),i}(o);break;case"animation":e(o),s=!0;break;default:console.log(o)}}!1===s&&(eh.animations[i.getAttribute("id")||r.M8C.generateUUID()]=n)}),m(et,"library_animation_clips","animation_clip",function(e){let i={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"instance_animation"===r.nodeName&&i.animations.push(p(r.getAttribute("url")))}eh.clips[e.getAttribute("id")]=i}),m(et,"library_controllers","controller",function(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"skin":i.id=p(r.getAttribute("source")),i.skin=function(e){let i={sources:{}};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_shape_matrix":i.bindShapeMatrix=c(r.textContent);break;case"source":let s=r.getAttribute("id");i.sources[s]=N(r);break;case"joints":i.joints=function(e){let i={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType&&"input"===r.nodeName){let e=r.getAttribute("semantic"),n=p(r.getAttribute("source"));i.inputs[e]=n}}return i}(r);break;case"vertex_weights":i.vertexWeights=function(e){let i={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":let s=r.getAttribute("semantic"),a=p(r.getAttribute("source")),o=parseInt(r.getAttribute("offset"));i.inputs[s]={id:a,offset:o};break;case"vcount":i.vcount=d(r.textContent);break;case"v":i.v=d(r.textContent)}}return i}(r)}}return i}(r);break;case"morph":i.id=p(r.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}eh.controllers[e.getAttribute("id")]=i}),m(et,"library_images","image",function(e){let i={init_from:u(e,"init_from")[0].textContent};eh.images[e.getAttribute("id")]=i}),m(et,"library_effects","effect",function(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"profile_COMMON"===r.nodeName&&(i.profile=function(e){let i={surfaces:{},samplers:{}};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"newparam":(function(e,i){let n=e.getAttribute("sid");for(let r=0,s=e.childNodes.length;r<s;r++){let s=e.childNodes[r];if(1===s.nodeType)switch(s.nodeName){case"surface":i.surfaces[n]=function(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"init_from"===r.nodeName&&(i.init_from=r.textContent)}return i}(s);break;case"sampler2D":i.samplers[n]=function(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"source"===r.nodeName&&(i.source=r.textContent)}return i}(s)}}})(r,i);break;case"technique":i.technique=function(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":i.type=r.nodeName,i.parameters=function(e){let i={};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":i[r.nodeName]=S(r);break;case"transparent":i[r.nodeName]={opaque:r.hasAttribute("opaque")?r.getAttribute("opaque"):"A_ONE",data:S(r)}}}return i}(r);break;case"extra":i.extra=R(r)}}return i}(r);break;case"extra":i.extra=R(r)}}return i}(r))}eh.effects[e.getAttribute("id")]=i}),m(et,"library_materials","material",function(e){let i={name:e.getAttribute("name")};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"instance_effect"===r.nodeName&&(i.url=p(r.getAttribute("url")))}eh.materials[e.getAttribute("id")]=i}),m(et,"library_cameras","camera",function(e){let i={name:e.getAttribute("name")};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];1===r.nodeType&&"optics"===r.nodeName&&(i.optics=function(e){for(let i=0;i<e.childNodes.length;i++){let n=e.childNodes[i];if("technique_common"===n.nodeName)return function(e){let i={};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":i.technique=r.nodeName,i.parameters=function(e){let i={};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":i[r.nodeName]=parseFloat(r.textContent)}}return i}(r)}}return i}(n)}return{}}(r))}eh.cameras[e.getAttribute("id")]=i}),m(et,"library_lights","light",function(e){let i={};for(let n=0,s=e.childNodes.length;n<s;n++){let s=e.childNodes[n];1===s.nodeType&&"technique_common"===s.nodeName&&(i=function(e){let i={};for(let n=0,s=e.childNodes.length;n<s;n++){let s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"directional":case"point":case"spot":case"ambient":i.technique=s.nodeName,i.parameters=function(e){let i={};for(let n=0,s=e.childNodes.length;n<s;n++){let s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"color":let a=c(s.textContent);i.color=new r.Ilk().fromArray(a).convertSRGBToLinear();break;case"falloff_angle":i.falloffAngle=parseFloat(s.textContent);break;case"quadratic_attenuation":let o=parseFloat(s.textContent);i.distance=o?Math.sqrt(1/o):0}}return i}(s)}}return i}(s))}eh.lights[e.getAttribute("id")]=i}),m(et,"library_geometries","geometry",function(e){let i={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=u(e,"mesh")[0];if(void 0!==n){for(let e=0;e<n.childNodes.length;e++){let r=n.childNodes[e];if(1!==r.nodeType)continue;let s=r.getAttribute("id");switch(r.nodeName){case"source":i.sources[s]=N(r);break;case"vertices":i.vertices=function(e){let i={};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];1===r.nodeType&&(i[r.getAttribute("semantic")]=p(r.getAttribute("source")))}return i}(r);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",r.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":i.primitives.push(function(e){let i={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,r=e.childNodes.length;n<r;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":let s=p(r.getAttribute("source")),a=r.getAttribute("semantic"),o=parseInt(r.getAttribute("offset")),l=parseInt(r.getAttribute("set")),h=l>0?a+l:a;i.inputs[h]={id:s,offset:o},i.stride=Math.max(i.stride,o+1),"TEXCOORD"===a&&(i.hasUV=!0);break;case"vcount":i.vcount=d(r.textContent);break;case"p":i.p=d(r.textContent)}}return i}(r));break;default:console.log(r)}}eh.geometries[e.getAttribute("id")]=i}}),m(et,"library_nodes","node",H),m(et,"library_visual_scenes","visual_scene",function(e){let i={name:e.getAttribute("name"),children:[]};!function(e){let i=e.getElementsByTagName("node");for(let e=0;e<i.length;e++){let n=i[e];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+el++)}}(e);let n=u(e,"node");for(let e=0;e<n.length;e++)i.children.push(H(n[e]));eh.visualScenes[e.getAttribute("id")]=i}),m(et,"library_kinematics_models","kinematics_model",function(e){let i={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){let s=e.childNodes[n];1===s.nodeType&&"technique_common"===s.nodeName&&function(e,i){for(let n=0;n<e.childNodes.length;n++){let s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"joint":i.joints[s.getAttribute("sid")]=function(e){let i;for(let n=0;n<e.childNodes.length;n++){let s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"prismatic":case"revolute":i=function(e){let i={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new r.Pa4,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":let s=c(r.textContent);i.axis.fromArray(s);break;case"limits":let a=r.getElementsByTagName("max")[0],o=r.getElementsByTagName("min")[0];i.limits.max=parseFloat(a.textContent),i.limits.min=parseFloat(o.textContent)}}return i.limits.min>=i.limits.max&&(i.static=!0),i.middlePosition=(i.limits.min+i.limits.max)/2,i}(s)}}return i}(s);break;case"link":i.links.push(function e(i){let n={sid:i.getAttribute("sid"),name:i.getAttribute("name")||"",attachments:[],transforms:[]};for(let r=0;r<i.childNodes.length;r++){let s=i.childNodes[r];if(1===s.nodeType)switch(s.nodeName){case"attachment_full":n.attachments.push(function(i){let n={joint:i.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let r=0;r<i.childNodes.length;r++){let s=i.childNodes[r];if(1===s.nodeType)switch(s.nodeName){case"link":n.links.push(e(s));break;case"matrix":case"translate":case"rotate":n.transforms.push(z(s))}}return n}(s));break;case"matrix":case"translate":case"rotate":n.transforms.push(z(s))}}return n}(s))}}}(s,i)}eh.kinematicsModels[e.getAttribute("id")]=i}),m(et,"library_physics_models","physics_model",function(e){let i={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];1===r.nodeType&&"rigid_body"===r.nodeName&&(i.rigidBodies[r.getAttribute("name")]={},function(e,i){for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];1===r.nodeType&&"technique_common"===r.nodeName&&function(e,i){for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":i.inertia=c(r.textContent);break;case"mass":i.mass=c(r.textContent)[0]}}}(r,i)}}(r,i.rigidBodies[r.getAttribute("name")]))}eh.physicsModels[e.getAttribute("id")]=i}),m(et,"scene","instance_kinematics_scene",function(e){let i={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];1===r.nodeType&&"bind_joint_axis"===r.nodeName&&i.bindJointAxis.push(function(e){let i={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){let r=e.childNodes[n];if(1===r.nodeType&&"axis"===r.nodeName){let e=r.getElementsByTagName("param")[0];i.axis=e.textContent;let n=i.axis.split("inst_").pop().split("axis")[0];i.jointIndex=n.substring(0,n.length-1)}}return i}(r))}eh.kinematicsScenes[p(e.getAttribute("url"))]=i}),g(eh.animations,v),g(eh.clips,E),g(eh.controllers,w),g(eh.images,M),g(eh.effects,B),g(eh.materials,L),g(eh.cameras,P),g(eh.lights,D),g(eh.geometries,O),g(eh.visualScenes,Z),function(){let e=eh.clips;if(!0===f(e)){if(!1===f(eh.animations)){let e=[];for(let i in eh.animations){let n=y(i);for(let i=0,r=n.length;i<r;i++)e.push(n[i])}ea.push(new r.m7l("default",-1,e))}}else for(let i in e)ea.push(A(eh.clips[i],E))}(),function(){let e=Object.keys(eh.kinematicsModels)[0],i=Object.keys(eh.kinematicsScenes)[0],n=Object.keys(eh.visualScenes)[0];if(void 0===e||void 0===i)return;let s=A(eh.kinematicsModels[e],F),a=A(eh.kinematicsScenes[i],G),o=$(n),l=a.bindJointAxis,h={};for(let e=0,i=l.length;e<i;e++){let i=l[e],n=et.querySelector('[sid="'+i.target+'"]');if(n){let e=n.parentElement;(function(e,i){let n=i.getAttribute("name"),a=s.joints[e];o.traverse(function(s){s.name===n&&(h[e]={object:s,transforms:function(e){let i=[],n=et.querySelector('[id="'+e.id+'"]');for(let e=0;e<n.childNodes.length;e++){let s,a;let o=n.childNodes[e];if(1===o.nodeType)switch(o.nodeName){case"matrix":s=c(o.textContent);let l=new r.yGw().fromArray(s).transpose();i.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"translate":case"scale":s=c(o.textContent),a=new r.Pa4().fromArray(s),i.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a});break;case"rotate":s=c(o.textContent),a=new r.Pa4().fromArray(s);let h=r.M8C.degToRad(s[3]);i.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a,angle:h})}}return i}(i),joint:a,position:a.zeroPosition})})})(i.jointIndex,e)}}let u=new r.yGw;eo={joints:s&&s.joints,getJointValue:function(e){let i=h[e];if(i)return i.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,i){let n=h[e];if(n){let s=n.joint;if(i>s.limits.max||i<s.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+i+" outside of limits (min: "+s.limits.min+", max: "+s.limits.max+").");else if(s.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{let a=n.object,o=s.axis,l=n.transforms;V.identity();for(let n=0;n<l.length;n++){let a=l[n];if(a.sid&&-1!==a.sid.indexOf(e))switch(s.type){case"revolute":V.multiply(u.makeRotationAxis(o,r.M8C.degToRad(i)));break;case"prismatic":V.multiply(u.makeTranslation(o.x*i,o.y*i,o.z*i));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+s.type)}else switch(a.type){case"matrix":V.multiply(a.obj);break;case"translate":V.multiply(u.makeTranslation(a.obj.x,a.obj.y,a.obj.z));break;case"scale":V.scale(a.obj);break;case"rotate":V.multiply(u.makeRotationAxis(a.obj,a.angle))}}a.matrix.copy(V),a.matrix.decompose(a.position,a.quaternion,a.scale),h[e].position=i}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();let eu=(a=u(et,"scene")[0],$(p(u(a,"instance_visual_scene")[0].getAttribute("url"))));return eu.animations=ea,"Z_UP"===en.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),eu.rotation.set(-Math.PI/2,0,0)),eu.scale.multiplyScalar(en.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),ea},kinematics:eo,library:eh,scene:eu}}}THREE.ColladaLoader=a,AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,i=this.el,n=this.data,r=this.el.sceneEl.systems.renderer;n&&(this.remove(),this.loader.load(n,function(n){e.model=n.scene,e.model.traverse(function(e){if(e.isMesh){var i=e.material;i.color&&r.applyColorCorrection(i.color),i.map&&r.applyColorCorrection(i.map),i.emissive&&r.applyColorCorrection(i.emissive),i.emissiveMap&&r.applyColorCorrection(i.emissiveMap)}}),i.setObject3D("mesh",e.model),i.emit("model-loaded",{format:"collada",model:e.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},86120:function(e,i,n){"use strict";let r,s,a;var o=n(1466),l=Uint8Array,h=Uint16Array,u=Int32Array,c=new l([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),d=new l([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),p=new l([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(e,i){for(var n=new h(31),r=0;r<31;++r)n[r]=i+=1<<e[r-1];for(var s=new u(n[30]),r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)s[a]=a-n[r]<<5|r;return{b:n,r:s}},m=f(c,2),g=m.b,A=m.r;g[28]=258,A[258]=28;var v=f(d,0),y=v.b;v.r;for(var x=new h(32768),_=0;_<32768;++_){var b=(43690&_)>>1|(21845&_)<<1;b=(61680&(b=(52428&b)>>2|(13107&b)<<2))>>4|(3855&b)<<4,x[_]=((65280&b)>>8|(255&b)<<8)>>1}for(var E=function(e,i,n){for(var r,s=e.length,a=0,o=new h(i);a<s;++a)e[a]&&++o[e[a]-1];var l=new h(i);for(a=1;a<i;++a)l[a]=l[a-1]+o[a-1]<<1;if(n){r=new h(1<<i);var u=15-i;for(a=0;a<s;++a)if(e[a])for(var c=a<<4|e[a],d=i-e[a],p=l[e[a]-1]++<<d,f=p|(1<<d)-1;p<=f;++p)r[x[p]>>u]=c}else for(a=0,r=new h(s);a<s;++a)e[a]&&(r[a]=x[l[e[a]-1]++]>>15-e[a]);return r},w=new l(288),_=0;_<144;++_)w[_]=8;for(var _=144;_<256;++_)w[_]=9;for(var _=256;_<280;++_)w[_]=7;for(var _=280;_<288;++_)w[_]=8;for(var M=new l(32),_=0;_<32;++_)M[_]=5;var C=E(w,9,1),S=E(M,5,1),T=function(e){for(var i=e[0],n=1;n<e.length;++n)e[n]>i&&(i=e[n]);return i},R=function(e,i,n){var r=i/8|0;return(e[r]|e[r+1]<<8)>>(7&i)&n},I=function(e,i){var n=i/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&i)},B=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],L=function(e,i,n){var r=Error(i||B[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,L),!n)throw r;return r},P=function(e,i,n,r){var s,a,o,h=e.length,u=r?r.length:0;if(!h||i.f&&!i.l)return n||new l(0);var f=!n,m=f||2!=i.i,A=i.i;f&&(n=new l(3*h));var v=function(e){var i=n.length;if(e>i){var r=new l(Math.max(2*i,e));r.set(n),n=r}},x=i.f||0,_=i.p||0,b=i.b||0,w=i.l,M=i.d,B=i.m,P=i.n,D=8*h;do{if(!w){x=R(e,_,1);var N=R(e,_+1,3);if(_+=3,N){if(1==N)w=C,M=S,B=9,P=5;else if(2==N){var O=R(e,_,31)+257,U=R(e,_+10,15)+4,k=O+R(e,_+5,31)+1;_+=14;for(var F=new l(k),z=new l(19),G=0;G<U;++G)z[p[G]]=R(e,_+3*G,7);_+=3*U;for(var V=T(z),j=(1<<V)-1,H=E(z,V,1),G=0;G<k;){var Q=H[R(e,_,j)];_+=15&Q;var W=Q>>4;if(W<16)F[G++]=W;else{var q=0,X=0;for(16==W?(X=3+R(e,_,3),_+=2,q=F[G-1]):17==W?(X=3+R(e,_,7),_+=3):18==W&&(X=11+R(e,_,127),_+=7);X--;)F[G++]=q}}var K=F.subarray(0,O),Y=F.subarray(O);B=T(K),P=T(Y),w=E(K,B,1),M=E(Y,P,1)}else L(1)}else{var W=((_+7)/8|0)+4,J=e[W-4]|e[W-3]<<8,Z=W+J;if(Z>h){A&&L(0);break}m&&v(b+J),n.set(e.subarray(W,Z),b),i.b=b+=J,i.p=_=8*Z,i.f=x;continue}if(_>D){A&&L(0);break}}m&&v(b+131072);for(var $=(1<<B)-1,ee=(1<<P)-1,et=_;;et=_){var q=w[I(e,_)&$],ei=q>>4;if((_+=15&q)>D){A&&L(0);break}if(q||L(2),ei<256)n[b++]=ei;else if(256==ei){et=_,w=null;break}else{var en=ei-254;if(ei>264){var G=ei-257,er=c[G];en=R(e,_,(1<<er)-1)+g[G],_+=er}var es=M[I(e,_)&ee],ea=es>>4;es||L(3),_+=15&es;var Y=y[ea];if(ea>3){var er=d[ea];Y+=I(e,_)&(1<<er)-1,_+=er}if(_>D){A&&L(0);break}m&&v(b+131072);var eo=b+en;if(b<Y){var el=u-Y,eh=Math.min(Y,eo);for(el+b<0&&L(3);b<eh;++b)n[b]=r[el+b]}for(;b<eo;++b)n[b]=n[b-Y]}}i.l=w,i.p=et,i.b=b,i.f=x,w&&(x=1,i.m=B,i.d=M,i.n=P)}while(!x);return b!=n.length&&f?(s=n,(a=0)<0&&(a=0),(null==(o=b)||o>s.length)&&(o=s.length),new l(s.subarray(a,o))):n.subarray(0,b)},D=new l(0),N="undefined"!=typeof TextDecoder&&new TextDecoder;try{N.decode(D,{stream:!0})}catch(e){}function O(e,i,n){let r=n.length-e-1;if(i>=n[r])return r-1;if(i<=n[e])return e;let s=e,a=r,o=Math.floor((s+a)/2);for(;i<n[o]||i>=n[o+1];)i<n[o]?a=o:s=o,o=Math.floor((s+a)/2);return o}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;class U extends o.Hyl{constructor(e,i,n,r,s){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let e=0;e<n.length;++e){let i=n[e];this.controlPoints[e]=new o.Ltg(i.x,i.y,i.z,i.w)}}getPoint(e,i=new o.Pa4){let n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(e,i,n,r){let s=O(e,r,i),a=function(e,i,n,r){let s=[],a=[],o=[];s[0]=1;for(let l=1;l<=n;++l){a[l]=i-r[e+1-l],o[l]=r[e+l]-i;let n=0;for(let e=0;e<l;++e){let i=o[e+1],r=a[l-e],h=s[e]/(i+r);s[e]=n+i*h,n=r*h}s[l]=n}return s}(s,r,e,i),l=new o.Ltg(0,0,0,0);for(let i=0;i<=e;++i){let r=n[s-e+i],o=a[i],h=r.w*o;l.x+=r.x*h,l.y+=r.y*h,l.z+=r.z*h,l.w+=r.w*o}return l}(this.degree,this.knots,this.controlPoints,n);return 1!==r.w&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,i=new o.Pa4){var n,r;let s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=(n=this.degree,r=this.knots,function(e){let i=e.length,n=[],r=[];for(let s=0;s<i;++s){let i=e[s];n[s]=new o.Pa4(i.x,i.y,i.z),r[s]=i.w}let s=[];for(let e=0;e<i;++e){let i=n[e].clone();for(let n=1;n<=e;++n)i.sub(s[e-n].clone().multiplyScalar(function(e,i){let n=1;for(let i=2;i<=e;++i)n*=i;let r=1;for(let e=2;e<=i;++e)r*=e;for(let n=2;n<=e-i;++n)r*=n;return n/r}(e,n)*r[n]));s[e]=i.divideScalar(r[0])}return s}(function(e,i,n,r,s){let a=1<e?s:e,l=[],h=O(e,r,i),u=function(e,i,n,r,s){let a=[];for(let e=0;e<=n;++e)a[e]=0;let o=[];for(let e=0;e<=r;++e)o[e]=a.slice(0);let l=[];for(let e=0;e<=n;++e)l[e]=a.slice(0);l[0][0]=1;let h=a.slice(0),u=a.slice(0);for(let r=1;r<=n;++r){h[r]=i-s[e+1-r],u[r]=s[e+r]-i;let n=0;for(let e=0;e<r;++e){let i=u[e+1],s=h[r-e];l[r][e]=i+s;let a=l[e][r-1]/l[r][e];l[e][r]=n+i*a,n=s*a}l[r][r]=n}for(let e=0;e<=n;++e)o[0][e]=l[e][n];for(let e=0;e<=n;++e){let i=0,s=1,h=[];for(let e=0;e<=n;++e)h[e]=a.slice(0);h[0][0]=1;for(let a=1;a<=r;++a){let r=0,u=e-a,c=n-a;e>=a&&(h[s][0]=h[i][0]/l[c+1][u],r=h[s][0]*l[u][c]);let d=u>=-1?1:-u,p=e-1<=c?a-1:n-e;for(let e=d;e<=p;++e)h[s][e]=(h[i][e]-h[i][e-1])/l[c+1][u+e],r+=h[s][e]*l[u+e][c];e<=c&&(h[s][a]=-h[i][a-1]/l[c+1][e],r+=h[s][a]*l[e][c]),o[a][e]=r;let f=i;i=s,s=f}}let c=n;for(let e=1;e<=r;++e){for(let i=0;i<=n;++i)o[e][i]*=c;c*=n-e}return o}(h,r,e,a,i),c=[];for(let e=0;e<n.length;++e){let i=n[e].clone(),r=i.w;i.x*=r,i.y*=r,i.z*=r,c[e]=i}for(let i=0;i<=a;++i){let n=c[h-e].clone().multiplyScalar(u[i][0]);for(let r=1;r<=e;++r)n.add(c[h-e+r].clone().multiplyScalar(u[i][r]));l[i]=n}for(let e=a+1;e<=s+1;++e)l[e]=new o.Ltg(0,0,0);return l}(n,r,this.controlPoints,s,1)));return i.copy(a[1]).normalize(),i}}class k extends o.aNw{constructor(e){super(e)}load(e,i,n,r){let s=this,a=""===s.path?o.Zp0.extractUrlBase(e):s.path,l=new o.hH6(this.manager);l.setPath(s.path),l.setResponseType("arraybuffer"),l.setRequestHeader(s.requestHeader),l.setWithCredentials(s.withCredentials),l.load(e,function(n){try{i(s.parse(n,a))}catch(i){r?r(i):console.error(i),s.manager.itemError(e)}},n,r)}parse(e,i){if(function(e){let i="Kaydara FBX Binary  \0";return e.byteLength>=i.length&&i===et(e,0,i.length)}(e))r=new j().parse(e);else{let i=et(e);if(!function(e){let i=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;for(let r=0;r<i.length;++r)if(function(i){let r=e[0];return e=e.slice(n+1),n++,r}(1)===i[r])return!1;return!0}(i))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>W(i))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+W(i));r=new V().parse(i)}return new F(new o.dpR(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin),this.manager).parse(r)}}class F{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){s=this.parseConnections();let e=this.parseImages(),i=this.parseTextures(e),n=this.parseMaterials(i),r=this.parseDeformers(),o=new z().parse(r);return this.parseScene(r,o,n),a}parseConnections(){let e=new Map;return"Connections"in r&&r.Connections.connections.forEach(function(i){let n=i[0],r=i[1],s=i[2];e.has(n)||e.set(n,{parents:[],children:[]}),e.get(n).parents.push({ID:r,relationship:s}),e.has(r)||e.set(r,{parents:[],children:[]}),e.get(r).children.push({ID:n,relationship:s})}),e}parseImages(){let e={},i={};if("Video"in r.Objects){let n=r.Objects.Video;for(let r in n){let s=n[r];if(e[parseInt(r)]=s.RelativeFilename||s.Filename,"Content"in s){let e=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,a="string"==typeof s.Content&&""!==s.Content;if(e||a){let e=this.parseImage(n[r]);i[s.RelativeFilename||s.Filename]=e}}}}for(let n in e){let r=e[n];void 0!==i[r]?e[n]=i[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){let i;let n=e.Content,r=e.RelativeFilename||e.Filename,s=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(s){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),i="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if("string"==typeof n)return"data:"+i+";base64,"+n;{let e=new Uint8Array(n);return window.URL.createObjectURL(new Blob([e],{type:i}))}}parseTextures(e){let i=new Map;if("Texture"in r.Objects){let n=r.Objects.Texture;for(let r in n){let s=this.parseTexture(n[r],e);i.set(parseInt(r),s)}}return i}parseTexture(e,i){let n=this.loadTexture(e,i);n.ID=e.id,n.name=e.attrName;let r=e.WrapModeU,s=e.WrapModeV,a=void 0!==r?r.value:0,l=void 0!==s?s.value:0;if(n.wrapS=0===a?o.rpg:o.uWy,n.wrapT=0===l?o.rpg:o.uWy,"Scaling"in e){let i=e.Scaling.value;n.repeat.x=i[0],n.repeat.y=i[1]}if("Translation"in e){let i=e.Translation.value;n.offset.x=i[0],n.offset.y=i[1]}return n}loadTexture(e,i){let n,r;let a=this.textureLoader.path,l=s.get(e.id).children;void 0!==l&&l.length>0&&void 0!==i[l[0].ID]&&(0===(n=i[l[0].ID]).indexOf("blob:")||0===n.indexOf("data:"))&&this.textureLoader.setPath(void 0);let h=e.FileName.slice(-3).toLowerCase();if("tga"===h){let i=this.manager.getHandler(".tga");null===i?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new o.xEZ):(i.setPath(this.textureLoader.path),r=i.load(n))}else if("dds"===h){let i=this.manager.getHandler(".dds");null===i?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),r=new o.xEZ):(i.setPath(this.textureLoader.path),r=i.load(n))}else"psd"===h?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new o.xEZ):r=this.textureLoader.load(n);return this.textureLoader.setPath(a),r}parseMaterials(e){let i=new Map;if("Material"in r.Objects){let n=r.Objects.Material;for(let r in n){let s=this.parseMaterial(n[r],e);null!==s&&i.set(parseInt(r),s)}}return i}parseMaterial(e,i){let n;let r=e.id,a=e.attrName,l=e.ShadingModel;if("object"==typeof l&&(l=l.value),!s.has(r))return null;let h=this.parseParameters(e,i,r);switch(l.toLowerCase()){case"phong":n=new o.xoR;break;case"lambert":n=new o.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',l),n=new o.xoR}return n.setValues(h),n.name=a,n}parseParameters(e,i,n){let r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new o.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(r.color=new o.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new o.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(r.emissive=new o.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new o.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=new o.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());let a=this;return s.get(n).children.forEach(function(e){let n=e.relationship;switch(n){case"Bump":r.bumpMap=a.getTexture(i,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=a.getTexture(i,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=a.getTexture(i,e.ID),void 0!==r.map&&(r.map.colorSpace=o.KI_);break;case"DisplacementColor":r.displacementMap=a.getTexture(i,e.ID);break;case"EmissiveColor":r.emissiveMap=a.getTexture(i,e.ID),void 0!==r.emissiveMap&&(r.emissiveMap.colorSpace=o.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=a.getTexture(i,e.ID);break;case"ReflectionColor":r.envMap=a.getTexture(i,e.ID),void 0!==r.envMap&&(r.envMap.mapping=o.dSO,r.envMap.colorSpace=o.KI_);break;case"SpecularColor":r.specularMap=a.getTexture(i,e.ID),void 0!==r.specularMap&&(r.specularMap.colorSpace=o.KI_);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=a.getTexture(i,e.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}}),r}getTexture(e,i){return"LayeredTexture"in r.Objects&&i in r.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=s.get(i).children[0].ID),e.get(i)}parseDeformers(){let e={},i={};if("Deformer"in r.Objects){let n=r.Objects.Deformer;for(let r in n){let a=n[r],o=s.get(parseInt(r));if("Skin"===a.attrType){let i=this.parseSkeleton(o,n);i.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),i.geometryID=o.parents[0].ID,e[r]=i}else if("BlendShape"===a.attrType){let e={id:r};e.rawTargets=this.parseMorphTargets(o,n),e.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[r]=e}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){let n=[];return e.children.forEach(function(e){let r=i[e.ID];if("Cluster"!==r.attrType)return;let s={ID:e.ID,indices:[],weights:[],transformLink:new o.yGw().fromArray(r.TransformLink.a)};"Indexes"in r&&(s.indices=r.Indexes.a,s.weights=r.Weights.a),n.push(s)}),{rawBones:n,bones:[]}}parseMorphTargets(e,i){let n=[];for(let r=0;r<e.children.length;r++){let a=e.children[r],o=i[a.ID],l={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;l.geoID=s.get(parseInt(a.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(l)}return n}parseScene(e,i,n){a=new o.ZAu;let l=this.parseModels(e.skeletons,i,n),h=r.Objects.Model,u=this;l.forEach(function(e){let i=h[e.ID];u.setLookAtProperties(e,i),s.get(e.ID).parents.forEach(function(i){let n=l.get(i.ID);void 0!==n&&n.add(e)}),null===e.parent&&a.add(e)}),this.bindSkeleton(e.skeletons,i,l),this.addGlobalSceneSettings(),a.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let i=Z(e.userData.transformData);e.applyMatrix4(i),e.updateWorldMatrix()}});let c=new G().parse();1===a.children.length&&a.children[0].isGroup&&(a.children[0].animations=c,a=a.children[0]),a.animations=c}parseModels(e,i,n){let a=new Map,l=r.Objects.Model;for(let r in l){let h=parseInt(r),u=l[r],c=s.get(h),d=this.buildSkeleton(c,e,h,u.attrName);if(!d){switch(u.attrType){case"Camera":d=this.createCamera(c);break;case"Light":d=this.createLight(c);break;case"Mesh":d=this.createMesh(c,i,n);break;case"NurbsCurve":d=this.createCurve(c,i);break;case"LimbNode":case"Root":d=new o.N$j;break;default:d=new o.ZAu}d.name=u.attrName?o.iUV.sanitizeNodeName(u.attrName):"",d.userData.originalName=u.attrName,d.ID=h}this.getTransformData(d,u),a.set(h,d)}return a}buildSkeleton(e,i,n,r){let s=null;return e.parents.forEach(function(e){for(let a in i){let l=i[a];l.rawBones.forEach(function(i,a){if(i.ID===e.ID){let e=s;(s=new o.N$j).matrixWorld.copy(i.transformLink),s.name=r?o.iUV.sanitizeNodeName(r):"",s.userData.originalName=r,s.ID=n,l.bones[a]=s,null!==e&&s.add(e)}})}}),s}createCamera(e){let i,n;if(e.children.forEach(function(e){let i=r.Objects.NodeAttribute[e.ID];void 0!==i&&(n=i)}),void 0===n)i=new o.Tme;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let r=1;void 0!==n.NearPlane&&(r=n.NearPlane.value/1e3);let s=1e3;void 0!==n.FarPlane&&(s=n.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(a=n.AspectWidth.value,l=n.AspectHeight.value);let h=a/l,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);let c=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:i=new o.cPb(u,h,r,s),null!==c&&i.setFocalLength(c);break;case 1:i=new o.iKG(-a/2,a/2,l/2,-l/2,r,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),i=new o.Tme}}return i}createLight(e){let i,n;if(e.children.forEach(function(e){let i=r.Objects.NodeAttribute[e.ID];void 0!==i&&(n=i)}),void 0===n)i=new o.Tme;else{let e;e=void 0===n.LightType?0:n.LightType.value;let r=0xffffff;void 0!==n.Color&&(r=new o.Ilk().fromArray(n.Color.value).convertSRGBToLinear());let s=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(s=0);let a=0;switch(void 0!==n.FarAttenuationEnd&&(a=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),e){case 0:i=new o.cek(r,s,a,1);break;case 1:i=new o.Ox3(r,s);break;case 2:let l=Math.PI/3;void 0!==n.InnerAngle&&(l=o.M8C.degToRad(n.InnerAngle.value));let h=0;void 0!==n.OuterAngle&&(h=Math.max(h=o.M8C.degToRad(n.OuterAngle.value),1)),i=new o.PMe(r,s,a,l,h,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),i=new o.cek(r,s)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(i.castShadow=!0)}return i}createMesh(e,i,n){let r;let s=null,a=null,l=[];return e.children.forEach(function(e){i.has(e.ID)&&(s=i.get(e.ID)),n.has(e.ID)&&l.push(n.get(e.ID))}),l.length>1?a=l:l.length>0?a=l[0]:(a=new o.xoR({name:o.aNw.DEFAULT_MATERIAL_NAME,color:0xcccccc}),l.push(a)),"color"in s.attributes&&l.forEach(function(e){e.vertexColors=!0}),s.FBX_Deformer?(r=new o.TUv(s,a)).normalizeSkinWeights():r=new o.Kj0(s,a),r}createCurve(e,i){let n=e.children.reduce(function(e,n){return i.has(n.ID)&&(e=i.get(n.ID)),e},null),r=new o.nls({name:o.aNw.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new o.x12(n,r)}getTransformData(e,i){let n={};"InheritType"in i&&(n.inheritType=parseInt(i.InheritType.value)),"RotationOrder"in i?n.eulerOrder=$(i.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in i&&(n.translation=i.Lcl_Translation.value),"PreRotation"in i&&(n.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(n.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(n.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(n.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(n.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(n.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(n.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(n.rotationPivot=i.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,i){"LookAtProperty"in i&&s.get(e.ID).children.forEach(function(i){if("LookAtProperty"===i.relationship){let n=r.Objects.Model[i.ID];if("Lcl_Translation"in n){let i=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(i),a.add(e.target)):e.lookAt(new o.Pa4().fromArray(i))}}})}bindSkeleton(e,i,n){let r=this.parsePoseNodes();for(let a in e){let l=e[a];s.get(parseInt(l.ID)).parents.forEach(function(e){if(i.has(e.ID)){let i=e.ID;s.get(i).parents.forEach(function(e){n.has(e.ID)&&n.get(e.ID).bind(new o.OdW(l.bones),r[e.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in r.Objects){let i=r.Objects.Pose;for(let n in i)if("BindPose"===i[n].attrType&&i[n].NbPoseNodes>0){let r=i[n].PoseNode;Array.isArray(r)?r.forEach(function(i){e[i.Node]=new o.yGw().fromArray(i.Matrix.a)}):e[r.Node]=new o.yGw().fromArray(r.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in r){if("AmbientColor"in r.GlobalSettings){let e=r.GlobalSettings.AmbientColor.value,i=e[0],n=e[1],s=e[2];if(0!==i||0!==n||0!==s){let e=new o.Ilk(i,n,s).convertSRGBToLinear();a.add(new o.Mig(e,1))}}"UnitScaleFactor"in r.GlobalSettings&&(a.userData.unitScaleFactor=r.GlobalSettings.UnitScaleFactor.value)}}}class z{constructor(){this.negativeMaterialIndices=!1}parse(e){let i=new Map;if("Geometry"in r.Objects){let n=r.Objects.Geometry;for(let r in n){let a=s.get(parseInt(r)),o=this.parseGeometry(a,n[r],e);i.set(parseInt(r),o)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,n){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,n);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,n){let s=n.skeletons,a=[],o=e.parents.map(function(e){return r.Objects.Model[e.ID]});if(0===o.length)return;let l=e.children.reduce(function(e,i){return void 0!==s[i.ID]&&(e=s[i.ID]),e},null);e.children.forEach(function(e){void 0!==n.morphTargets[e.ID]&&a.push(n.morphTargets[e.ID])});let h=o[0],u={};"RotationOrder"in h&&(u.eulerOrder=$(h.RotationOrder.value)),"InheritType"in h&&(u.inheritType=parseInt(h.InheritType.value)),"GeometricTranslation"in h&&(u.translation=h.GeometricTranslation.value),"GeometricRotation"in h&&(u.rotation=h.GeometricRotation.value),"GeometricScaling"in h&&(u.scale=h.GeometricScaling.value);let c=Z(u);return this.genGeometry(i,l,a,c)}genGeometry(e,i,n,r){let s=new o.u9r;e.attrName&&(s.name=e.attrName);let a=this.parseGeoNode(e,i),l=this.genBuffers(a),h=new o.a$l(l.vertex,3);if(h.applyMatrix4(r),s.setAttribute("position",h),l.colors.length>0&&s.setAttribute("color",new o.a$l(l.colors,3)),i&&(s.setAttribute("skinIndex",new o.qlB(l.weightsIndices,4)),s.setAttribute("skinWeight",new o.a$l(l.vertexWeights,4)),s.FBX_Deformer=i),l.normal.length>0){let e=new o.Vkp().getNormalMatrix(r),i=new o.a$l(l.normal,3);i.applyNormalMatrix(e),s.setAttribute("normal",i)}if(l.uvs.forEach(function(e,i){let n=0===i?"uv":`uv${i}`;s.setAttribute(n,new o.a$l(l.uvs[i],2))}),a.material&&"AllSame"!==a.material.mappingType){let e=l.materialIndex[0],i=0;if(l.materialIndex.forEach(function(n,r){n!==e&&(s.addGroup(i,r-i,e),e=n,i=r)}),s.groups.length>0){let i=s.groups[s.groups.length-1],n=i.start+i.count;n!==l.materialIndex.length&&s.addGroup(n,l.materialIndex.length-n,e)}0===s.groups.length&&s.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(s,e,n,r),s}parseGeoNode(e,i){let n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},null!==i&&(n.skeleton=i,i.rawBones.forEach(function(e,i){e.indices.forEach(function(r,s){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:i,weight:e.weights[s]})})})),n}genBuffers(e){let i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,s=!1,a=[],o=[],l=[],h=[],u=[],c=[],d=this;return e.vertexIndices.forEach(function(p,f){let m;let g=!1;p<0&&(p^=-1,g=!0);let A=[],v=[];if(a.push(3*p,3*p+1,3*p+2),e.color){let i=K(f,n,p,e.color);l.push(i[0],i[1],i[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach(function(e){v.push(e.weight),A.push(e.id)}),v.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);let e=[0,0,0,0],i=[0,0,0,0];v.forEach(function(n,r){let s=n,a=A[r];i.forEach(function(i,n,r){if(s>i){r[n]=s,s=i;let o=e[n];e[n]=a,a=o}})}),A=e,v=i}for(;v.length<4;)v.push(0),A.push(0);for(let e=0;e<4;++e)u.push(v[e]),c.push(A[e])}if(e.normal){let i=K(f,n,p,e.normal);o.push(i[0],i[1],i[2])}e.material&&"AllSame"!==e.material.mappingType&&(m=K(f,n,p,e.material)[0])<0&&(d.negativeMaterialIndices=!0,m=0),e.uv&&e.uv.forEach(function(e,i){let r=K(f,n,p,e);void 0===h[i]&&(h[i]=[]),h[i].push(r[0]),h[i].push(r[1])}),r++,g&&(d.genFace(i,e,a,m,o,l,h,u,c,r),n++,r=0,a=[],o=[],l=[],h=[],u=[],c=[])}),i}getNormalNewell(e){let i=new o.Pa4(0,0,0);for(let n=0;n<e.length;n++){let r=e[n],s=e[(n+1)%e.length];i.x+=(r.y-s.y)*(r.z+s.z),i.y+=(r.z-s.z)*(r.x+s.x),i.z+=(r.x-s.x)*(r.y+s.y)}return i.normalize(),i}getNormalTangentAndBitangent(e){let i=this.getNormalNewell(e),n=(Math.abs(i.z)>.5?new o.Pa4(0,1,0):new o.Pa4(0,0,1)).cross(i).normalize(),r=i.clone().cross(n).normalize();return{normal:i,tangent:n,bitangent:r}}flattenVertex(e,i,n){return new o.FM8(e.dot(i),e.dot(n))}genFace(e,i,n,r,s,a,l,h,u,c){let d;if(c>3){let e=[];for(let r=0;r<n.length;r+=3)e.push(new o.Pa4(i.vertexPositions[n[r]],i.vertexPositions[n[r+1]],i.vertexPositions[n[r+2]]));let{tangent:r,bitangent:s}=this.getNormalTangentAndBitangent(e),a=[];for(let i of e)a.push(this.flattenVertex(i,r,s));d=o.iDF.triangulateShape(a,[])}else d=[[0,1,2]];for(let[o,c,p]of d)e.vertex.push(i.vertexPositions[n[3*o]]),e.vertex.push(i.vertexPositions[n[3*o+1]]),e.vertex.push(i.vertexPositions[n[3*o+2]]),e.vertex.push(i.vertexPositions[n[3*c]]),e.vertex.push(i.vertexPositions[n[3*c+1]]),e.vertex.push(i.vertexPositions[n[3*c+2]]),e.vertex.push(i.vertexPositions[n[3*p]]),e.vertex.push(i.vertexPositions[n[3*p+1]]),e.vertex.push(i.vertexPositions[n[3*p+2]]),i.skeleton&&(e.vertexWeights.push(h[4*o]),e.vertexWeights.push(h[4*o+1]),e.vertexWeights.push(h[4*o+2]),e.vertexWeights.push(h[4*o+3]),e.vertexWeights.push(h[4*c]),e.vertexWeights.push(h[4*c+1]),e.vertexWeights.push(h[4*c+2]),e.vertexWeights.push(h[4*c+3]),e.vertexWeights.push(h[4*p]),e.vertexWeights.push(h[4*p+1]),e.vertexWeights.push(h[4*p+2]),e.vertexWeights.push(h[4*p+3]),e.weightsIndices.push(u[4*o]),e.weightsIndices.push(u[4*o+1]),e.weightsIndices.push(u[4*o+2]),e.weightsIndices.push(u[4*o+3]),e.weightsIndices.push(u[4*c]),e.weightsIndices.push(u[4*c+1]),e.weightsIndices.push(u[4*c+2]),e.weightsIndices.push(u[4*c+3]),e.weightsIndices.push(u[4*p]),e.weightsIndices.push(u[4*p+1]),e.weightsIndices.push(u[4*p+2]),e.weightsIndices.push(u[4*p+3])),i.color&&(e.colors.push(a[3*o]),e.colors.push(a[3*o+1]),e.colors.push(a[3*o+2]),e.colors.push(a[3*c]),e.colors.push(a[3*c+1]),e.colors.push(a[3*c+2]),e.colors.push(a[3*p]),e.colors.push(a[3*p+1]),e.colors.push(a[3*p+2])),i.material&&"AllSame"!==i.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),i.normal&&(e.normal.push(s[3*o]),e.normal.push(s[3*o+1]),e.normal.push(s[3*o+2]),e.normal.push(s[3*c]),e.normal.push(s[3*c+1]),e.normal.push(s[3*c+2]),e.normal.push(s[3*p]),e.normal.push(s[3*p+1]),e.normal.push(s[3*p+2])),i.uv&&i.uv.forEach(function(i,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(l[n][2*o]),e.uvs[n].push(l[n][2*o+1]),e.uvs[n].push(l[n][2*c]),e.uvs[n].push(l[n][2*c+1]),e.uvs[n].push(l[n][2*p]),e.uvs[n].push(l[n][2*p+1])})}addMorphTargets(e,i,n,s){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let a=this;n.forEach(function(n){n.rawTargets.forEach(function(n){let o=r.Objects.Geometry[n.geoID];void 0!==o&&a.genMorphGeometry(e,i,o,s,n.name)})})}genMorphGeometry(e,i,n,r,s){let a=void 0!==i.PolygonVertexIndex?i.PolygonVertexIndex.a:[],l=void 0!==n.Vertices?n.Vertices.a:[],h=void 0!==n.Indexes?n.Indexes.a:[],u=new Float32Array(3*e.attributes.position.count);for(let e=0;e<h.length;e++){let i=3*h[e];u[i]=l[3*e],u[i+1]=l[3*e+1],u[i+2]=l[3*e+2]}let c=this.genBuffers({vertexIndices:a,vertexPositions:u}),d=new o.a$l(c.vertex,3);d.name=s||n.attrName,d.applyMatrix4(r),e.morphAttributes.position.push(d)}parseNormals(e){let i=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,s=[];return"IndexToDirect"===n&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:i,referenceType:n}}parseUVs(e){let i=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,s=[];return"IndexToDirect"===n&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:i,referenceType:n}}parseVertexColors(e){let i=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,s=[];"IndexToDirect"===n&&(s=e.ColorIndex.a);for(let e=0,i=new o.Ilk;e<r.length;e+=4)i.fromArray(r,e).convertSRGBToLinear().toArray(r,e);return{dataSize:4,buffer:r,indices:s,mappingType:i,referenceType:n}}parseMaterialIndices(e){let i=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===i)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};let r=e.Materials.a,s=[];for(let e=0;e<r.length;++e)s.push(e);return{dataSize:1,buffer:r,indices:s,mappingType:i,referenceType:n}}parseNurbsGeometry(e){let i,n;let r=parseInt(e.Order);if(isNaN(r))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new o.u9r;let s=r-1,a=e.KnotVector.a,l=[],h=e.Points.a;for(let e=0,i=h.length;e<i;e+=4)l.push(new o.Ltg().fromArray(h,e));if("Closed"===e.Form)l.push(l[0]);else if("Periodic"===e.Form){i=s,n=a.length-1-i;for(let e=0;e<s;++e)l.push(l[e])}let u=new U(s,a,l,i,n).getPoints(12*l.length);return new o.u9r().setFromPoints(u)}}class G{parse(){let e=[],i=this.parseClips();if(void 0!==i)for(let n in i){let r=i[n],s=this.addClip(r);e.push(s)}return e}parseClips(){if(void 0===r.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){let e=r.Objects.AnimationCurveNode,i=new Map;for(let n in e){let r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){let e={id:r.id,attr:r.attrName,curves:{}};i.set(e.id,e)}}return i}parseAnimationCurves(e){let i=r.Objects.AnimationCurve;for(let n in i){let r={id:i[n].id,times:i[n].KeyTime.a.map(q),values:i[n].KeyValueFloat.a},a=s.get(r.id);if(void 0!==a){let i=a.parents[0].ID,n=a.parents[0].relationship;n.match(/X/)?e.get(i).curves.x=r:n.match(/Y/)?e.get(i).curves.y=r:n.match(/Z/)?e.get(i).curves.z=r:n.match(/DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=r)}}}parseAnimationLayers(e){let i=r.Objects.AnimationLayer,n=new Map;for(let l in i){let i=[],h=s.get(parseInt(l));void 0!==h&&(h.children.forEach(function(n,l){if(e.has(n.ID)){let h=e.get(n.ID);if(void 0!==h.curves.x||void 0!==h.curves.y||void 0!==h.curves.z){if(void 0===i[l]){let e=s.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){let s=r.Objects.Model[e.toString()];if(void 0===s){console.warn("THREE.FBXLoader: Encountered a unused curve.",n);return}let h={modelName:s.attrName?o.iUV.sanitizeNodeName(s.attrName):"",ID:s.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};a.traverse(function(e){e.ID===s.id&&(h.transform=e.matrix,e.userData.transformData&&(h.eulerOrder=e.userData.transformData.eulerOrder))}),h.transform||(h.transform=new o.yGw),"PreRotation"in s&&(h.preRotation=s.PreRotation.value),"PostRotation"in s&&(h.postRotation=s.PostRotation.value),i[l]=h}}i[l]&&(i[l][h.attr]=h)}else if(void 0!==h.curves.morph){if(void 0===i[l]){let e=s.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,a=s.get(e).parents[0].ID,h=s.get(a).parents[0].ID,u=s.get(h).parents[0].ID,c=r.Objects.Model[u],d={modelName:c.attrName?o.iUV.sanitizeNodeName(c.attrName):"",morphName:r.Objects.Deformer[e].attrName};i[l]=d}i[l][h.attr]=h}}}),n.set(parseInt(l),i))}return n}parseAnimStacks(e){let i=r.Objects.AnimationStack,n={};for(let r in i){let a=s.get(parseInt(r)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let o=e.get(a[0].ID);n[r]={name:i[r].attrName,layer:o}}return n}addClip(e){let i=[],n=this;return e.layer.forEach(function(e){i=i.concat(n.generateTracks(e))}),new o.m7l(e.name,-1,i)}generateTracks(e){let i=[],n=new o.Pa4,r=new o.Pa4;if(e.transform&&e.transform.decompose(n,new o._fP,r),n=n.toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==r&&i.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let n=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&i.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let n=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==n&&i.push(n)}if(void 0!==e.DeformPercent){let n=this.generateMorphTrack(e);void 0!==n&&i.push(n)}return i}generateVectorTrack(e,i,n,r){let s=this.getTimesForAllAxes(i),a=this.getKeyframeTrackValues(s,i,n);return new o.yC1(e+"."+r,s,a)}generateRotationTrack(e,i,n,r,s){let a,l;if(void 0!==i.x&&void 0!==i.y&&void 0!==i.z){let e=this.interpolateRotations(i.x,i.y,i.z,s);a=e[0],l=e[1]}void 0!==n&&((n=n.map(o.M8C.degToRad)).push(s),n=new o.USm().fromArray(n),n=new o._fP().setFromEuler(n)),void 0!==r&&((r=r.map(o.M8C.degToRad)).push(s),r=new o.USm().fromArray(r),r=new o._fP().setFromEuler(r).invert());let h=new o._fP,u=new o.USm,c=[];if(!l||!a)return new o.iLg(e+".quaternion",[0],[0]);for(let e=0;e<l.length;e+=3)u.set(l[e],l[e+1],l[e+2],s),h.setFromEuler(u),void 0!==n&&h.premultiply(n),void 0!==r&&h.multiply(r),e>2&&0>new o._fP().fromArray(c,(e-3)/3*4).dot(h)&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(c,e/3*4);return new o.iLg(e+".quaternion",a,c)}generateMorphTrack(e){let i=e.DeformPercent.curves.morph,n=i.values.map(function(e){return e/100}),r=a.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new o.dUE(e.modelName+".morphTargetInfluences["+r+"]",i.times,n)}getTimesForAllAxes(e){let i=[];if(void 0!==e.x&&(i=i.concat(e.x.times)),void 0!==e.y&&(i=i.concat(e.y.times)),void 0!==e.z&&(i=i.concat(e.z.times)),(i=i.sort(function(e,i){return e-i})).length>1){let e=1,n=i[0];for(let r=1;r<i.length;r++){let s=i[r];s!==n&&(i[e]=s,n=s,e++)}i=i.slice(0,e)}return i}getKeyframeTrackValues(e,i,n){let r=[],s=-1,a=-1,o=-1;return e.forEach(function(e){if(i.x&&(s=i.x.times.indexOf(e)),i.y&&(a=i.y.times.indexOf(e)),i.z&&(o=i.z.times.indexOf(e)),-1!==s){let e=i.x.values[s];r.push(e),n[0]=e}else r.push(n[0]);if(-1!==a){let e=i.y.values[a];r.push(e),n[1]=e}else r.push(n[1]);if(-1!==o){let e=i.z.values[o];r.push(e),n[2]=e}else r.push(n[2])}),r}interpolateRotations(e,i,n,r){let s=[],a=[];s.push(e.times[0]),a.push(o.M8C.degToRad(e.values[0])),a.push(o.M8C.degToRad(i.values[0])),a.push(o.M8C.degToRad(n.values[0]));for(let l=1;l<e.values.length;l++){let h=[e.values[l-1],i.values[l-1],n.values[l-1]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;let u=h.map(o.M8C.degToRad),c=[e.values[l],i.values[l],n.values[l]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;let d=c.map(o.M8C.degToRad),p=[c[0]-h[0],c[1]-h[1],c[2]-h[2]],f=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];if(f[0]>=180||f[1]>=180||f[2]>=180){let i=Math.max(...f)/180,n=new o.USm(...u,r),h=new o.USm(...d,r),c=new o._fP().setFromEuler(n),p=new o._fP().setFromEuler(h);c.dot(p)&&p.set(-p.x,-p.y,-p.z,-p.w);let m=e.times[l-1],g=e.times[l]-m,A=new o._fP,v=new o.USm;for(let e=0;e<1;e+=1/i)A.copy(c.clone().slerp(p.clone(),e)),s.push(m+e*g),v.setFromQuaternion(A,r),a.push(v.x),a.push(v.y),a.push(v.z)}else s.push(e.times[l]),a.push(o.M8C.degToRad(e.values[l])),a.push(o.M8C.degToRad(i.values[l])),a.push(o.M8C.degToRad(n.values[l]))}return[s,a]}}class V{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new Q,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let i=this,n=e.split(/[\r\n]+/);return n.forEach(function(e,r){let s=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(s||a)return;let o=e.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),l=e.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=e.match("^\\t{"+(i.currentIndent-1)+"}}");o?i.parseNodeBegin(e,o):l?i.parseNodeProperty(e,l,n[++r]):h?i.popStack():e.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,i){let n=i[1].trim().replace(/^"/,"").replace(/"$/,""),r=i[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},a=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,s):n in o?("PoseNode"===n?o.PoseNode.push(s):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==a.id&&(o[n][a.id]=s)):"number"==typeof a.id?(o[n]={},o[n][a.id]=s):"Properties70"!==n&&("PoseNode"===n?o[n]=[s]:o[n]=s),"number"==typeof a.id&&(s.id=a.id),""!==a.name&&(s.attrName=a.name),""!==a.type&&(s.attrType=a.type),this.pushStack(s)}parseNodeAttr(e){let i=e[0];""!==e[0]&&isNaN(i=parseInt(e[0]))&&(i=e[0]);let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:i,name:n,type:r}}parseNodeProperty(e,i,n){let r=i[1].replace(/^"/,"").replace(/"$/,"").trim(),s=i[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===s&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if("Properties70"===a.name){this.parseNodeSpecialProperty(e,r,s);return}if("C"===r){let e=s.split(",").slice(1),i=parseInt(e[0]),n=parseInt(e[1]),o=s.split(",").slice(3);o=o.map(function(e){return e.trim().replace(/^"/,"")}),r="connections",function(e,i){for(let n=0,r=e.length,s=i.length;n<s;n++,r++)e[r]=i[n]}(s=[i,n],o),void 0===a[r]&&(a[r]=[])}"Node"===r&&(a.id=s),r in a&&Array.isArray(a[r])?a[r].push(s):"a"!==r?a[r]=s:a.a=s,this.setCurrentProp(a,r),"a"===r&&","!==s.slice(-1)&&(a.a=ee(s))}parseNodePropertyContinued(e){let i=this.getCurrentNode();i.a+=e,","!==e.slice(-1)&&(i.a=ee(i.a))}parseNodeSpecialProperty(e,i,n){let r=n.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],a=r[1],o=r[2],l=r[3],h=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=ee(h)}this.getPrevNode()[s]={type:a,type2:o,flag:l,value:h},this.setCurrentProp(this.getPrevNode(),s)}}class j{parse(e){let i=new H(e);i.skip(23);let n=i.getUint32();if(n<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);let r=new Q;for(;!this.endOfContent(i);){let e=this.parseNode(i,n);null!==e&&r.add(e.name,e)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){let n={},r=i>=7500?e.getUint64():e.getUint32(),s=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),o=e.getString(a);if(0===r)return null;let l=[];for(let i=0;i<s;i++)l.push(this.parseProperty(e));let h=l.length>0?l[0]:"",u=l.length>1?l[1]:"",c=l.length>2?l[2]:"";for(n.singleProperty=1===s&&e.getOffset()===r;r>e.getOffset();){let r=this.parseNode(e,i);null!==r&&this.parseSubNode(o,n,r)}return n.propertyList=l,"number"==typeof h&&(n.id=h),""!==u&&(n.attrName=u),""!==c&&(n.attrType=c),""!==o&&(n.name=o),n}parseSubNode(e,i,n){if(!0===n.singleProperty){let e=n.propertyList[0];Array.isArray(e)?(i[n.name]=n,n.a=e):i[n.name]=e}else if("Connections"===e&&"C"===n.name){let e=[];n.propertyList.forEach(function(i,n){0!==n&&e.push(i)}),void 0===i.connections&&(i.connections=[]),i.connections.push(e)}else if("Properties70"===n.name)Object.keys(n).forEach(function(e){i[e]=n[e]});else if("Properties70"===e&&"P"===n.name){let e,r=n.propertyList[0],s=n.propertyList[1],a=n.propertyList[2],o=n.propertyList[3];0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),e="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],i[r]={type:s,type2:a,flag:o,value:e}}else void 0===i[n.name]?"number"==typeof n.id?(i[n.name]={},i[n.name][n.id]=n):i[n.name]=n:"PoseNode"===n.name?(Array.isArray(i[n.name])||(i[n.name]=[i[n.name]]),i[n.name].push(n)):void 0===i[n.name][n.id]&&(i[n.name][n.id]=n)}parseProperty(e){let i;let n=e.getString(1);switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r,s,a;let o=e.getUint32(),l=e.getUint32(),h=e.getUint32();if(0===l)switch(n){case"b":case"c":return e.getBooleanArray(o);case"d":return e.getFloat64Array(o);case"f":return e.getFloat32Array(o);case"i":return e.getInt32Array(o);case"l":return e.getInt64Array(o)}let u=new H(P((r=new Uint8Array(e.getArrayBuffer(h))).subarray((a=void 0,((15&r[0])!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&L(6,"invalid zlib data"),(r[1]>>5&1)==+!a&&L(6,"invalid zlib data: "+(32&r[1]?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2),-4),{i:2},s&&s.out,s&&s.dictionary).buffer);switch(n){case"b":case"c":return u.getBooleanArray(o);case"d":return u.getFloat64Array(o);case"f":return u.getFloat32Array(o);case"i":return u.getInt32Array(o);case"l":return u.getInt64Array(o)}break;default:throw Error("THREE.FBXLoader: Unknown property type "+n)}}}class H{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===i||i,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){let i=[];for(let n=0;n<e;n++)i.push(this.getBoolean());return i}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let i=[];for(let n=0;n<e;n++)i.push(this.getInt32());return i}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return(this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),0x80000000&i)?(i=0xffffffff&~i,0xffffffff==(e=0xffffffff&~e)&&(i=i+1&0xffffffff),-(0x100000000*i+(e=e+1&0xffffffff))):0x100000000*i+e}getInt64Array(e){let i=[];for(let n=0;n<e;n++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),0x100000000*i+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let i=[];for(let n=0;n<e;n++)i.push(this.getFloat32());return i}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let i=[];for(let n=0;n<e;n++)i.push(this.getFloat64());return i}getArrayBuffer(e){let i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){let i=this.offset,n=new Uint8Array(this.dv.buffer,i,e);this.skip(e);let r=n.indexOf(0);return r>=0&&(n=new Uint8Array(this.dv.buffer,i,r)),this._textDecoder.decode(n)}}class Q{add(e,i){this[e]=i}}function W(e){let i=e.match(/FBXVersion: (\d+)/);if(i)return parseInt(i[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function q(e){return e/46186158e3}let X=[];function K(e,i,n,r){let s;switch(r.mappingType){case"ByPolygonVertex":s=e;break;case"ByPolygon":s=i;break;case"ByVertice":s=n;break;case"AllSame":s=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(s=r.indices[s]);let a=s*r.dataSize,o=a+r.dataSize;return function(e,i,n,r){for(let s=n,a=0;s<r;s++,a++)e[a]=i[s];return e}(X,r.buffer,a,o)}let Y=new o.USm,J=new o.Pa4;function Z(e){let i=new o.yGw,n=new o.yGw,r=new o.yGw,s=new o.yGw,a=new o.yGw,l=new o.yGw,h=new o.yGw,u=new o.yGw,c=new o.yGw,d=new o.yGw,p=new o.yGw,f=new o.yGw,m=e.inheritType?e.inheritType:0;if(e.translation&&i.setPosition(J.fromArray(e.translation)),e.preRotation){let i=e.preRotation.map(o.M8C.degToRad);i.push(e.eulerOrder||o.USm.DEFAULT_ORDER),n.makeRotationFromEuler(Y.fromArray(i))}if(e.rotation){let i=e.rotation.map(o.M8C.degToRad);i.push(e.eulerOrder||o.USm.DEFAULT_ORDER),r.makeRotationFromEuler(Y.fromArray(i))}if(e.postRotation){let i=e.postRotation.map(o.M8C.degToRad);i.push(e.eulerOrder||o.USm.DEFAULT_ORDER),s.makeRotationFromEuler(Y.fromArray(i)),s.invert()}e.scale&&a.scale(J.fromArray(e.scale)),e.scalingOffset&&h.setPosition(J.fromArray(e.scalingOffset)),e.scalingPivot&&l.setPosition(J.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(J.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(J.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(p.copy(e.parentMatrix),d.copy(e.parentMatrixWorld));let g=n.clone().multiply(r).multiply(s),A=new o.yGw;A.extractRotation(d);let v=new o.yGw;v.copyPosition(d);let y=v.clone().invert().multiply(d),x=A.clone().invert().multiply(y),_=new o.yGw;if(0===m)_.copy(A).multiply(g).multiply(x).multiply(a);else if(1===m)_.copy(A).multiply(x).multiply(g).multiply(a);else{let e=new o.yGw().scale(new o.Pa4().setFromMatrixScale(p)).clone().invert(),i=x.clone().multiply(e);_.copy(A).multiply(g).multiply(i).multiply(a)}let b=c.clone().invert(),E=l.clone().invert(),w=i.clone().multiply(u).multiply(c).multiply(n).multiply(r).multiply(s).multiply(b).multiply(h).multiply(l).multiply(a).multiply(E),M=new o.yGw().copyPosition(w),C=d.clone().multiply(M);return f.copyPosition(C),(w=f.clone().multiply(_)).premultiply(d.invert()),w}function $(e){return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),"ZYX"):["ZYX","YZX","XZY","ZXY","YXZ","XYZ"][e]}function ee(e){return e.split(",").map(function(e){return parseFloat(e)})}function et(e,i,n){return void 0===i&&(i=0),void 0===n&&(n=e.byteLength),new TextDecoder().decode(new Uint8Array(e,i,n))}THREE.FBXLoader=k,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e=this.data;if(!e.src)return;this.remove();let i=new THREE.FBXLoader;e.crossorigin&&i.setCrossOrigin(e.crossorigin),i.load(e.src,this.load.bind(this))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},88837:function(e,i,n){let r;let s=n(34657)();e.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=(r=r||s("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js")).then(()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")})},update:function(){let e=this,i=this.el,n=this.data;n&&(this.remove(),this.loaderPromise.then(()=>{this.loader.load(n,function(n){e.model=n.scene,e.model.animations=n.animations,i.setObject3D("mesh",e.model),i.emit("model-loaded",{format:"gltf",model:e.model})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},29874:function(e,i,n){n(76591),n(30167),n(86120),n(88837),n(30171)},30171:function(e){e.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e;let i=this.data;i.src&&(this.remove(),e=new THREE.ObjectLoader,i.crossorigin&&e.setCrossOrigin(i.crossorigin),e.load(i.src,e=>{e.traverse(e=>{e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)}),this.load(e)}))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},37642:function(e){e.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){let e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},74795:function(e){function i(e,i,n,r){e&&(i=i||[],e.traverse(e=>{if(e.isMesh){var s;((s=e.material)?Array.isArray(s)?s:s.materials?s.materials:[s]:[]).forEach(e=>{(!e||"envMap"in e)&&(i.length&&-1===i.indexOf(e.name)||(e.envMap=n,e.reflectivity=r,e.needsUpdate=!0))})}}))}e.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){let e=this.data;this.texture=new THREE.CubeTextureLoader().load([e.path+"posx."+e.extension,e.path+"negx."+e.extension,e.path+"posy."+e.extension,e.path+"negy."+e.extension,e.path+"posz."+e.extension,e.path+"negz."+e.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{let e=this.el.getObject3D("mesh"),n=this.data;i(e,n.materials,this.texture,n.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){let n=this.data,r=this.el.getObject3D("mesh"),s=[],a=[];if(n.materials.length&&(e.materials?(s=n.materials.filter(i=>!e.materials.includes(i)),a=e.materials.filter(e=>!n.materials.includes(e))):s=n.materials),s.length&&i(r,s,this.texture,n.reflectivity),a.length&&i(r,a,null,1),e.materials&&n.reflectivity!==e.reflectivity){let s=n.materials.filter(i=>e.materials.includes(i));s.length&&i(r,s,this.texture,n.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);let e=this.el.getObject3D("mesh"),n=this.data;i(e,n.materials,null,1),n.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},79511:function(e){e.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){let e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){let e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){let e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){let i=e.detail.el;!i.is(this.GRABBED_STATE)&&this.grabbing&&!this.hitEl&&(i.addState(this.GRABBED_STATE),this.hitEl=i,this.constraint=new CANNON.LockConstraint(this.el.body,i.body),this.system.addConstraint(this.constraint))}})},59236:function(e,i,n){n(37642),n(74795),n(79511),n(78240),n(91790)},78240:function(e){e.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse(e=>{e.isMesh&&(e.material=this.material)})}})},91790:function(e){e.exports=AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){let e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){let e;let i=this.data;e=i.objects?this.el.sceneEl.querySelectorAll(i.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(e)},tick:function(){let e=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Box3,a=[],o=new Map;return function(l){let h;if(!this.data.enabled)return;let u=this.prevCheckTime;if(u&&l-u<this.data.interval)return;this.prevCheckTime=l;let c=this.el,d=this.data;if(c.getObject3D("mesh")){var p;a.length=0,o.clear(),c.object3D.getWorldPosition(e),c.object3D.getWorldScale(n),h=d.radius*Math.max((p=n).x,p.y,p.z),this.els.forEach(function(n){let l,u,c,d;if(n.isEntity&&(u=n.getObject3D("mesh")))s.setFromObject(u).getSize(r),l=Math.sqrt(2*(d=Math.max(r.x,r.y,r.z)/2)*d),s.getCenter(i),l&&(c=e.distanceTo(i))<l+h&&(a.push(n),o.set(n,c))}),a.sort((e,i)=>o.get(e)>o.get(i)?1:-1).forEach(this.handleHit),this.collisions.filter(e=>!o.has(e)).forEach(this.handleHitEnd),function(e,i){e.length=0;for(let n=0;n<i.length;n++)e[n]=i[n]}(this.collisions,a)}}}(),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.eventDetail.el=e,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.eventDetail.el=e,this.el.emit("hitend",this.eventDetail)}})},82578:function(e,i,n){n(38453),n(11250),n(31465)},11250:function(e){e.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){let e=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3;return function(r,s){let a;let o=this.el,l=this.data,h=this.raycaster,u=l.speed*s/1e3;if(!l.active)return;if(!this.path.length){let i=this.el.object3D.position;this.group=this.group||this.system.getGroup(i),this.path=this.system.getPath(i,e.copy(l.destination),this.group)||[],o.emit("navigation-start")}if(!this.path.length){console.warn("[nav] Unable to find path to %o.",l.destination),this.el.setAttribute("nav-agent",{active:!1}),o.emit("navigation-end");return}let c=o.object3D.position,d=this.path[0];if(i.subVectors(d,c),i.length()<u){if(this.path.shift(),!this.path.length){this.el.setAttribute("nav-agent",{active:!1}),o.emit("navigation-end");return}n.copy(c),a=this.path[0]}else n.copy(i.setLength(u)).add(c),a=d;a.y=c.y,o.object3D.lookAt(a),h.ray.origin.copy(n),h.ray.origin.y+=1.5,h.ray.direction={x:0,y:-1,z:0};let p=h.intersectObject(this.system.getNavMesh());p.length?(i.subVectors(p[0].point,c),c.add(i.setLength(u))):c.copy(n)}}()})},38453:function(e){e.exports=AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){let e;var i=this;let n=this.el.getObject3D("mesh");if(this.el.sceneEl.object3D,!n||(n.traverse(n=>{n.isMesh&&(!i.nodeName||n.name===i.nodeName)&&(e=n)}),!e))return;let r=e.geometry.clone();e.updateWorldMatrix(!0,!1),r.applyMatrix4(e.matrixWorld),this.system.setNavMeshGeometry(r),this.hasLoadedNavMesh=!0}})},31465:function(e,i,n){let{Pathfinding:r}=n(60158),s=new r,a="level";e.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),s.setZoneData(a,r.createZone(e)),Array.from(this.agents).forEach(e=>e.updateNavLocation())},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,i,n){return this.navMesh?s.findPath(e,i,a,n):null},getGroup:function(e){return this.navMesh?s.getGroup(a,e):null},getNode:function(e,i){return this.navMesh?s.getClosestNode(e,a,i,!0):null},clampStep:function(e,i,n,r,o){return this.navMesh?r?s.clampStep(e,i,r,a,n,o):(o.copy(i),this.getNode(i,n)):(o.copy(i),null)}})},50386:function(e){e.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},59307:function(e){e.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),e.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){let e=this.el,i=this.data,n=e.components.material,r=new THREE.PlaneGeometry(i.width,i.depth,i.density,i.density);this.waves=[];let s=r.getAttribute("position");for(let e=0;e<s.count;e++)this.waves.push({z:s.getZ(e),ang:Math.random()*Math.PI*2,amp:i.amplitude+Math.random()*i.amplitudeVariance,speed:(i.speed+Math.random()*i.speedVariance)/1e3});n||((n={}).material=new THREE.MeshPhongMaterial({color:i.color,transparent:i.opacity<1,opacity:i.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(r,n.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,i){if(!i)return;let n=this.mesh.geometry.getAttribute("position");for(let e=0;e<n.count;e++){let r=this.waves[e],s=r.z+Math.sin(r.ang)*r.amp;n.setZ(e,s),r.ang+=r.speed*i}n.needsUpdate=!0}})},50699:function(e){e.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),e.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){let e=this.el,i=this.data,n=e.components.material;if(!i.path.length){console.error("[a-tube] `path` property expected but not found.");return}let r=new THREE.CatmullRomCurve3(i.path.map(function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))})),s=new THREE.TubeGeometry(r,i.segments,i.radius,i.radialSegments,i.closed);n||((n={}).material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(s,n.material),this.el.setObject3D("mesh",this.mesh)},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},36699:function(e,i,n){n(50386),n(59307),n(50699)},31359:function(e,i,n){if("undefined"==typeof AFRAME)throw Error("Component attempted to register before AFRAME was available.");let r=n(37964);"default"in r&&(r=r.default);let s=n(74435);"default"in s&&(s=s.default);let a=function(e){return"string"==typeof e?JSON.parse(e):e},o=function(e){if("function"==typeof e)return e;let i=eval;try{return i("("+e+")")}catch(e){}return null},l=function(e){return isNaN(parseFloat(e))?o(e)?o(e):e:parseFloat(e)};AFRAME.registerComponent("forcegraph",{schema:{jsonUrl:{type:"string",default:""},nodes:{parse:a,default:[]},links:{parse:a,default:[]},numDimensions:{type:"number",default:3},dagMode:{type:"string",default:""},dagLevelDistance:{type:"number",default:0},dagNodeFilter:{parse:o,default:function(){return!0}},onDagError:{parse:o,default:void 0},nodeRelSize:{type:"number",default:4},nodeId:{type:"string",default:"id"},nodeVal:{parse:l,default:"val"},nodeResolution:{type:"number",default:8},nodeVisibility:{parse:l,default:!0},nodeColor:{parse:l,default:"color"},nodeAutoColorBy:{parse:l,default:""},nodeOpacity:{type:"number",default:.75},nodeThreeObject:{parse:l,default:null},nodeThreeObjectExtend:{parse:l,default:!1},linkSource:{type:"string",default:"source"},linkTarget:{type:"string",default:"target"},linkVisibility:{parse:l,default:!0},linkColor:{parse:l,default:"color"},linkAutoColorBy:{parse:l,default:""},linkOpacity:{type:"number",default:.2},linkWidth:{parse:l,default:0},linkResolution:{type:"number",default:6},linkCurvature:{parse:l,default:0},linkCurveRotation:{parse:l,default:0},linkMaterial:{parse:l,default:null},linkThreeObject:{parse:l,default:null},linkThreeObjectExtend:{parse:l,default:!1},linkPositionUpdate:{parse:o,default:null},linkDirectionalArrowLength:{parse:l,default:0},linkDirectionalArrowColor:{parse:l,default:null},linkDirectionalArrowRelPos:{parse:l,default:.5},linkDirectionalArrowResolution:{type:"number",default:8},linkDirectionalParticles:{parse:l,default:0},linkDirectionalParticleSpeed:{parse:l,default:.01},linkDirectionalParticleWidth:{parse:l,default:.5},linkDirectionalParticleColor:{parse:l,default:null},linkDirectionalParticleResolution:{type:"number",default:4},onNodeHover:{parse:o,default:()=>{}},onLinkHover:{parse:o,default:()=>{}},onNodeClick:{parse:o,default:()=>{}},onLinkClick:{parse:o,default:()=>{}},forceEngine:{type:"string",default:"d3"},d3AlphaMin:{type:"number",default:0},d3AlphaDecay:{type:"number",default:.0228},d3VelocityDecay:{type:"number",default:.4},ngraphPhysics:{parse:a,default:null},warmupTicks:{type:"int",default:0},cooldownTicks:{type:"int",default:1e18},cooldownTime:{type:"int",default:15e3},onEngineTick:{parse:o,default:function(){}},onEngineStop:{parse:o,default:function(){}}},getGraphBbox:function(e){return this.forceGraph||(this.forceGraph=new s),this.forceGraph.getGraphBbox(e)},emitParticle:function(){this.forceGraph||(this.forceGraph=new s);let e=this.forceGraph,i=e.emitParticle.apply(e,arguments);return i===e?this:i},d3Force:function(){this.forceGraph||(this.forceGraph=new s);let e=this.forceGraph,i=e.d3Force.apply(e,arguments);return i===e?this:i},d3ReheatSimulation:function(){return this.forceGraph&&this.forceGraph.d3ReheatSimulation(),this},refresh:function(){return this.forceGraph&&this.forceGraph.refresh(),this},init:function(){let e=this.state={};e.infoEl=document.createElement("a-text"),e.infoEl.setAttribute("position","0 -0.1 -1"),e.infoEl.setAttribute("width",1),e.infoEl.setAttribute("align","center"),e.infoEl.setAttribute("color","lavender");let i=document.querySelector("a-entity[camera], a-camera");i.appendChild(e.infoEl),e.cameraObj=i.object3D.children.filter(function(e){return"PerspectiveCamera"===e.type})[0],this.el.sceneEl.addEventListener("camera-set-active",function(i){e.cameraObj=i.detail.cameraEl.components.camera.camera}),this.forceGraph||(this.forceGraph=new s),this.forceGraph.onFinishUpdate(()=>this.el.setObject3D("forcegraphGroup",this.forceGraph)).onLoading(()=>e.infoEl.setAttribute("value","Loading...")).onFinishLoading(()=>e.infoEl.setAttribute("value","")),this.el.addEventListener("raycaster-intersected",i=>e.hoverDetail=i.detail),this.el.addEventListener("raycaster-intersected-cleared",i=>e.hoverDetail=i.detail),this.el.addEventListener("click",()=>e.hoverObj&&this.data["on"+("node"===e.hoverObj.__graphObjType?"Node":"Link")+"Click"](e.hoverObj.__data))},remove:function(){this.state.infoEl.remove(),this.el.removeObject3D("forcegraphGroup")},update:function(e){let i=this,n=this.data,r=AFRAME.utils.diff(n,e);["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].filter(function(e){return e in r}).forEach(function(e){i.forceGraph[e](""!==n[e]?n[e]:null)}),("nodes"in r||"links"in r)&&i.forceGraph.graphData({nodes:n.nodes,links:n.links})},tick:function(e,i){let n=this.state,r=this.data,s=n.hoverDetail?n.hoverDetail.getIntersection?n.hoverDetail.getIntersection(this.el):n.hoverDetail.intersection||void 0:void 0,a=s?s.object:void 0;for(;a&&!a.hasOwnProperty("__graphObjType");)a=a.parent;if(a!==n.hoverObj){let e=n.hoverObj?n.hoverObj.__graphObjType:null,i=n.hoverObj?n.hoverObj.__data:null,s=a?a.__graphObjType:null,o=a?a.__data:null;e&&e!==s&&r["on"+("node"===e?"Node":"Link")+"Hover"](null,i),s&&r["on"+("node"===s?"Node":"Link")+"Hover"](o,e===s?i:null),n.hoverObj=a}this.forceGraph.tickFrame()}})},75569:function(e){var i,n;self,n=()=>(()=>{var e={"./node_modules/an-array/index.js":e=>{var i=Object.prototype.toString;e.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===i.call(e.buffer)||Array.isArray(e)}},"./node_modules/as-number/index.js":e=>{e.exports=function(e,i){return"number"==typeof e?e:"number"==typeof i?i:0}},"./node_modules/base64-js/index.js":(e,i)=>{"use strict";i.byteLength=function(e){var i=h(e),n=i[0],r=i[1];return(n+r)*3/4-r},i.toByteArray=function(e){var i,n,a=h(e),o=a[0],l=a[1],u=new s((o+l)*3/4-l),c=0,d=l>0?o-4:o;for(n=0;n<d;n+=4)i=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[c++]=i>>16&255,u[c++]=i>>8&255,u[c++]=255&i;return 2===l&&(i=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[c++]=255&i),1===l&&(i=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[c++]=i>>8&255,u[c++]=255&i),u},i.fromByteArray=function(e){for(var i,r=e.length,s=r%3,a=[],o=0,l=r-s;o<l;o+=16383)a.push(function(e,i,r){for(var s,a=[],o=i;o<r;o+=3)s=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(n[s>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return a.join("")}(e,o,o+16383>l?l:o+16383));return 1===s?a.push(n[(i=e[r-1])>>2]+n[i<<4&63]+"=="):2===s&&a.push(n[(i=(e[r-2]<<8)+e[r-1])>>10]+n[i>>4&63]+n[i<<2&63]+"="),a.join("")};for(var n=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=a.length;o<l;++o)n[o]=a[o],r[a.charCodeAt(o)]=o;function h(e){var i=e.length;if(i%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=i);var r=n===i?0:4-n%4;return[n,r]}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},"./node_modules/buffer-equal/index.js":(e,i,n)=>{var r=n("./node_modules/buffer/index.js").Buffer;e.exports=function(e,i){if(r.isBuffer(e)&&r.isBuffer(i)){if("function"==typeof e.equals)return e.equals(i);if(e.length!==i.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==i[n])return!1;return!0}}},"./node_modules/buffer/index.js":(e,i,n)=>{"use strict";let r=n("./node_modules/base64-js/index.js"),s=n("./node_modules/ieee754/index.js"),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let i=new Uint8Array(e);return Object.setPrototypeOf(i,l.prototype),i}function l(e,i,n){if("number"==typeof e){if("string"==typeof i)throw TypeError('The "string" argument must be of type string. Received type number');return c(e)}return h(e,i,n)}function h(e,i,n){if("string"==typeof e)return function(e,i){if(("string"!=typeof i||""===i)&&(i="utf8"),!l.isEncoding(i))throw TypeError("Unknown encoding: "+i);let n=0|m(e,i),r=o(n),s=r.write(e,i);return s!==n&&(r=r.slice(0,s)),r}(e,i);if(ArrayBuffer.isView(e))return function(e){if(k(e,Uint8Array)){let i=new Uint8Array(e);return p(i.buffer,i.byteOffset,i.byteLength)}return d(e)}(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(k(e,ArrayBuffer)||e&&k(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(k(e,SharedArrayBuffer)||e&&k(e.buffer,SharedArrayBuffer)))return p(e,i,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,i,n);let s=function(e){if(l.isBuffer(e)){let i=0|f(e.length),n=o(i);return 0===n.length||e.copy(n,0,0,i),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?o(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),i,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return u(e),o(e<0?0:0|f(e))}function d(e){let i=e.length<0?0:0|f(e.length),n=o(i);for(let r=0;r<i;r+=1)n[r]=255&e[r];return n}function p(e,i,n){let r;if(i<0||e.byteLength<i)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<i+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n),l.prototype),r}function f(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function m(e,i){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||k(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let s=!1;for(;;)switch(i){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return O(e).length;default:if(s)return r?-1:N(e).length;i=(""+i).toLowerCase(),s=!0}}function g(e,i,n){let s=!1;if((void 0===i||i<0)&&(i=0),i>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(i>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,i,n){let r=e.length;(!i||i<0)&&(i=0),(!n||n<0||n>r)&&(n=r);let s="";for(let r=i;r<n;++r)s+=F[e[r]];return s}(this,i,n);case"utf8":case"utf-8":return x(this,i,n);case"ascii":return function(e,i,n){let r="";n=Math.min(e.length,n);for(let s=i;s<n;++s)r+=String.fromCharCode(127&e[s]);return r}(this,i,n);case"latin1":case"binary":return function(e,i,n){let r="";n=Math.min(e.length,n);for(let s=i;s<n;++s)r+=String.fromCharCode(e[s]);return r}(this,i,n);case"base64":var a,o,l;return a=this,o=i,l=n,0===o&&l===a.length?r.fromByteArray(a):r.fromByteArray(a.slice(o,l));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,i,n){let r=e.slice(i,n),s="";for(let e=0;e<r.length-1;e+=2)s+=String.fromCharCode(r[e]+256*r[e+1]);return s}(this,i,n);default:if(s)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function A(e,i,n){let r=e[i];e[i]=e[n],e[n]=r}function v(e,i,n,r,s){var a;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(a=n*=1)!=a&&(n=s?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(s)return -1;n=e.length-1}else if(n<0){if(!s)return -1;n=0}if("string"==typeof i&&(i=l.from(i,r)),l.isBuffer(i))return 0===i.length?-1:y(e,i,n,r,s);if("number"==typeof i)return(i&=255,"function"==typeof Uint8Array.prototype.indexOf)?s?Uint8Array.prototype.indexOf.call(e,i,n):Uint8Array.prototype.lastIndexOf.call(e,i,n):y(e,[i],n,r,s);throw TypeError("val must be string, number or Buffer")}function y(e,i,n,r,s){let a,o=1,l=e.length,h=i.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||i.length<2)return -1;o=2,l/=2,h/=2,n/=2}function u(e,i){return 1===o?e[i]:e.readUInt16BE(i*o)}if(s){let r=-1;for(a=n;a<l;a++)if(u(e,a)===u(i,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===h)return r*o}else -1!==r&&(a-=a-r),r=-1}else for(n+h>l&&(n=l-h),a=n;a>=0;a--){let n=!0;for(let r=0;r<h;r++)if(u(e,a+r)!==u(i,r)){n=!1;break}if(n)return a}return -1}function x(e,i,n){n=Math.min(e.length,n);let r=[],s=i;for(;s<n;){let i=e[s],a=null,o=i>239?4:i>223?3:i>191?2:1;if(s+o<=n){let n,r,l,h;switch(o){case 1:i<128&&(a=i);break;case 2:(192&(n=e[s+1]))==128&&(h=(31&i)<<6|63&n)>127&&(a=h);break;case 3:n=e[s+1],r=e[s+2],(192&n)==128&&(192&r)==128&&(h=(15&i)<<12|(63&n)<<6|63&r)>2047&&(h<55296||h>57343)&&(a=h);break;case 4:n=e[s+1],r=e[s+2],l=e[s+3],(192&n)==128&&(192&r)==128&&(192&l)==128&&(h=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&l)>65535&&h<1114112&&(a=h)}}null===a?(a=65533,o=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),s+=o}return function(e){let i=e.length;if(i<=4096)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<i;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function _(e,i,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+i>n)throw RangeError("Trying to access beyond buffer length")}function b(e,i,n,r,s,a){if(!l.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(i>s||i<a)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function E(e,i,n,r,s){B(i,r,s,e,n,7);let a=Number(i&BigInt(0xffffffff));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let o=Number(i>>BigInt(32)&BigInt(0xffffffff));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function w(e,i,n,r,s){B(i,r,s,e,n,7);let a=Number(i&BigInt(0xffffffff));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let o=Number(i>>BigInt(32)&BigInt(0xffffffff));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function M(e,i,n,r,s,a){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function C(e,i,n,r,a){return i*=1,n>>>=0,a||M(e,i,n,4,34028234663852886e22,-34028234663852886e22),s.write(e,i,n,r,23,4),n+4}function S(e,i,n,r,a){return i*=1,n>>>=0,a||M(e,i,n,8,17976931348623157e292,-17976931348623157e292),s.write(e,i,n,r,52,8),n+8}i.Buffer=l,i.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},i.INSPECT_MAX_BYTES=50,i.kMaxLength=0x7fffffff,l.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),i={foo:function(){return 42}};return Object.setPrototypeOf(i,Uint8Array.prototype),Object.setPrototypeOf(e,i),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,i,n){return h(e,i,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,i,n){return(u(e),e<=0)?o(e):void 0!==i?"string"==typeof n?o(e).fill(i,n):o(e).fill(i):o(e)},l.allocUnsafe=function(e){return c(e)},l.allocUnsafeSlow=function(e){return c(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,i){if(k(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),k(i,Uint8Array)&&(i=l.from(i,i.offset,i.byteLength)),!l.isBuffer(e)||!l.isBuffer(i))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===i)return 0;let n=e.length,r=i.length;for(let s=0,a=Math.min(n,r);s<a;++s)if(e[s]!==i[s]){n=e[s],r=i[s];break}return n<r?-1:+(r<n)},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,i){let n;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);if(void 0===i)for(n=0,i=0;n<e.length;++n)i+=e[n].length;let r=l.allocUnsafe(i),s=0;for(n=0;n<e.length;++n){let i=e[n];if(k(i,Uint8Array))s+i.length>r.length?(l.isBuffer(i)||(i=l.from(i)),i.copy(r,s)):Uint8Array.prototype.set.call(r,i,s);else if(l.isBuffer(i))i.copy(r,s);else throw TypeError('"list" argument must be an Array of Buffers');s+=i.length}return r},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let i=0;i<e;i+=2)A(this,i,i+1);return this},l.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let i=0;i<e;i+=4)A(this,i,i+3),A(this,i+1,i+2);return this},l.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let i=0;i<e;i+=8)A(this,i,i+7),A(this,i+1,i+6),A(this,i+2,i+5),A(this,i+3,i+4);return this},l.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?x(this,0,e):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="",n=i.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(l.prototype[a]=l.prototype.inspect),l.prototype.compare=function(e,i,n,r,s){if(k(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===i&&(i=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),i<0||n>e.length||r<0||s>this.length)throw RangeError("out of range index");if(r>=s&&i>=n)return 0;if(r>=s)return -1;if(i>=n)return 1;if(i>>>=0,n>>>=0,r>>>=0,s>>>=0,this===e)return 0;let a=s-r,o=n-i,h=Math.min(a,o),u=this.slice(r,s),c=e.slice(i,n);for(let e=0;e<h;++e)if(u[e]!==c[e]){a=u[e],o=c[e];break}return a<o?-1:+(o<a)},l.prototype.includes=function(e,i,n){return -1!==this.indexOf(e,i,n)},l.prototype.indexOf=function(e,i,n){return v(this,e,i,n,!0)},l.prototype.lastIndexOf=function(e,i,n){return v(this,e,i,n,!1)},l.prototype.write=function(e,i,n,r){var s,a,o,l,h,u,c,d;if(void 0===i)r="utf8",n=this.length,i=0;else if(void 0===n&&"string"==typeof i)r=i,n=this.length,i=0;else if(isFinite(i))i>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let p=this.length-i;if((void 0===n||n>p)&&(n=p),e.length>0&&(n<0||i<0)||i>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let f=!1;for(;;)switch(r){case"hex":return function(e,i,n,r){let s;n=Number(n)||0;let a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;let o=i.length;for(r>o/2&&(r=o/2),s=0;s<r;++s){var l;let r=parseInt(i.substr(2*s,2),16);if((l=r)!=l)break;e[n+s]=r}return s}(this,e,i,n);case"utf8":case"utf-8":return s=i,a=n,U(N(e,this.length-s),this,s,a);case"ascii":case"latin1":case"binary":return o=i,l=n,U(function(e){let i=[];for(let n=0;n<e.length;++n)i.push(255&e.charCodeAt(n));return i}(e),this,o,l);case"base64":return h=i,u=n,U(O(e),this,h,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=i,d=n,U(function(e,i){let n,r;let s=[];for(let a=0;a<e.length&&!((i-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,s.push(n%256),s.push(r);return s}(e,this.length-c),this,c,d);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},l.prototype.slice=function(e,i){let n=this.length;e=~~e,i=void 0===i?n:~~i,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),i<0?(i+=n)<0&&(i=0):i>n&&(i=n),i<e&&(i=e);let r=this.subarray(e,i);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,i,n){e>>>=0,i>>>=0,n||_(e,i,this.length);let r=this[e],s=1,a=0;for(;++a<i&&(s*=256);)r+=this[e+a]*s;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,i,n){e>>>=0,i>>>=0,n||_(e,i,this.length);let r=this[e+--i],s=1;for(;i>0&&(s*=256);)r+=this[e+--i]*s;return r},l.prototype.readUint8=l.prototype.readUInt8=function(e,i){return e>>>=0,i||_(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,i){return e>>>=0,i||_(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,i){return e>>>=0,i||_(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,i){return e>>>=0,i||_(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,i){return e>>>=0,i||_(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=z(function(e){L(e>>>=0,"offset");let i=this[e],n=this[e+7];(void 0===i||void 0===n)&&P(e,this.length-8);let r=i+256*this[++e]+65536*this[++e]+0x1000000*this[++e],s=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*n;return BigInt(r)+(BigInt(s)<<BigInt(32))}),l.prototype.readBigUInt64BE=z(function(e){L(e>>>=0,"offset");let i=this[e],n=this[e+7];(void 0===i||void 0===n)&&P(e,this.length-8);let r=0x1000000*i+65536*this[++e]+256*this[++e]+this[++e],s=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(s)}),l.prototype.readIntLE=function(e,i,n){e>>>=0,i>>>=0,n||_(e,i,this.length);let r=this[e],s=1,a=0;for(;++a<i&&(s*=256);)r+=this[e+a]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*i)),r},l.prototype.readIntBE=function(e,i,n){e>>>=0,i>>>=0,n||_(e,i,this.length);let r=i,s=1,a=this[e+--r];for(;r>0&&(s*=256);)a+=this[e+--r]*s;return a>=(s*=128)&&(a-=Math.pow(2,8*i)),a},l.prototype.readInt8=function(e,i){return(e>>>=0,i||_(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},l.prototype.readInt16LE=function(e,i){e>>>=0,i||_(e,2,this.length);let n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},l.prototype.readInt16BE=function(e,i){e>>>=0,i||_(e,2,this.length);let n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},l.prototype.readInt32LE=function(e,i){return e>>>=0,i||_(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,i){return e>>>=0,i||_(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=z(function(e){L(e>>>=0,"offset");let i=this[e],n=this[e+7];return(void 0===i||void 0===n)&&P(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24))<<BigInt(32))+BigInt(i+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),l.prototype.readBigInt64BE=z(function(e){L(e>>>=0,"offset");let i=this[e],n=this[e+7];return(void 0===i||void 0===n)&&P(e,this.length-8),(BigInt((i<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n)}),l.prototype.readFloatLE=function(e,i){return e>>>=0,i||_(e,4,this.length),s.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,i){return e>>>=0,i||_(e,4,this.length),s.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,i){return e>>>=0,i||_(e,8,this.length),s.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,i){return e>>>=0,i||_(e,8,this.length),s.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,i,n,r){if(e*=1,i>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;b(this,e,i,n,r,0)}let s=1,a=0;for(this[i]=255&e;++a<n&&(s*=256);)this[i+a]=e/s&255;return i+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,i,n,r){if(e*=1,i>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;b(this,e,i,n,r,0)}let s=n-1,a=1;for(this[i+s]=255&e;--s>=0&&(a*=256);)this[i+s]=e/a&255;return i+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,1,255,0),this[i]=255&e,i+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,2,65535,0),this[i]=255&e,this[i+1]=e>>>8,i+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,2,65535,0),this[i]=e>>>8,this[i+1]=255&e,i+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,4,0xffffffff,0),this[i+3]=e>>>24,this[i+2]=e>>>16,this[i+1]=e>>>8,this[i]=255&e,i+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,4,0xffffffff,0),this[i]=e>>>24,this[i+1]=e>>>16,this[i+2]=e>>>8,this[i+3]=255&e,i+4},l.prototype.writeBigUInt64LE=z(function(e,i=0){return E(this,e,i,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=z(function(e,i=0){return w(this,e,i,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(e,i,n,r){if(e*=1,i>>>=0,!r){let r=Math.pow(2,8*n-1);b(this,e,i,n,r-1,-r)}let s=0,a=1,o=0;for(this[i]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[i+s-1]&&(o=1),this[i+s]=(e/a>>0)-o&255;return i+n},l.prototype.writeIntBE=function(e,i,n,r){if(e*=1,i>>>=0,!r){let r=Math.pow(2,8*n-1);b(this,e,i,n,r-1,-r)}let s=n-1,a=1,o=0;for(this[i+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[i+s+1]&&(o=1),this[i+s]=(e/a>>0)-o&255;return i+n},l.prototype.writeInt8=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,1,127,-128),e<0&&(e=255+e+1),this[i]=255&e,i+1},l.prototype.writeInt16LE=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,2,32767,-32768),this[i]=255&e,this[i+1]=e>>>8,i+2},l.prototype.writeInt16BE=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,2,32767,-32768),this[i]=e>>>8,this[i+1]=255&e,i+2},l.prototype.writeInt32LE=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,4,0x7fffffff,-0x80000000),this[i]=255&e,this[i+1]=e>>>8,this[i+2]=e>>>16,this[i+3]=e>>>24,i+4},l.prototype.writeInt32BE=function(e,i,n){return e*=1,i>>>=0,n||b(this,e,i,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[i]=e>>>24,this[i+1]=e>>>16,this[i+2]=e>>>8,this[i+3]=255&e,i+4},l.prototype.writeBigInt64LE=z(function(e,i=0){return E(this,e,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=z(function(e,i=0){return w(this,e,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeFloatLE=function(e,i,n){return C(this,e,i,!0,n)},l.prototype.writeFloatBE=function(e,i,n){return C(this,e,i,!1,n)},l.prototype.writeDoubleLE=function(e,i,n){return S(this,e,i,!0,n)},l.prototype.writeDoubleBE=function(e,i,n){return S(this,e,i,!1,n)},l.prototype.copy=function(e,i,n,r){if(!l.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),i>=e.length&&(i=e.length),i||(i=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(i<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-i<r-n&&(r=e.length-i+n);let s=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(i,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),i),s},l.prototype.fill=function(e,i,n,r){let s;if("string"==typeof e){if("string"==typeof i?(r=i,i=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){let i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(i<0||this.length<i||this.length<n)throw RangeError("Out of range index");if(n<=i)return this;if(i>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=i;s<n;++s)this[s]=e;else{let a=l.isBuffer(e)?e:l.from(e,r),o=a.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-i;++s)this[s+i]=a[s%o]}return this};let T={};function R(e,i,n){T[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:i.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function I(e){let i="",n=e.length,r=+("-"===e[0]);for(;n>=r+4;n-=3)i=`_${e.slice(n-3,n)}${i}`;return`${e.slice(0,n)}${i}`}function B(e,i,n,r,s,a){if(e>n||e<i){let r;let s="bigint"==typeof i?"n":"";throw r=a>3?0===i||i===BigInt(0)?`>= 0${s} and < 2${s} ** ${(a+1)*8}${s}`:`>= -(2${s} ** ${(a+1)*8-1}${s}) and < 2 ** ${(a+1)*8-1}${s}`:`>= ${i}${s} and <= ${n}${s}`,new T.ERR_OUT_OF_RANGE("value",r,e)}L(s,"offset"),(void 0===r[s]||void 0===r[s+a])&&P(s,r.length-(a+1))}function L(e,i){if("number"!=typeof e)throw new T.ERR_INVALID_ARG_TYPE(i,"number",e)}function P(e,i,n){if(Math.floor(e)!==e)throw L(e,n),new T.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(i<0)throw new T.ERR_BUFFER_OUT_OF_BOUNDS;throw new T.ERR_OUT_OF_RANGE(n||"offset",`>= ${+!!n} and <= ${i}`,e)}R("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),R("ERR_INVALID_ARG_TYPE",function(e,i){return`The "${e}" argument must be of type number. Received type ${typeof i}`},TypeError),R("ERR_OUT_OF_RANGE",function(e,i,n){let r=`The value of "${e}" is out of range.`,s=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?s=I(String(n)):"bigint"==typeof n&&(s=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(s=I(s)),s+="n"),r+=` It must be ${i}. Received ${s}`},RangeError);let D=/[^+/0-9A-Za-z-_]/g;function N(e,i){let n;i=i||1/0;let r=e.length,s=null,a=[];for(let o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!s){if(n>56319||o+1===r){(i-=3)>-1&&a.push(239,191,189);continue}s=n;continue}if(n<56320){(i-=3)>-1&&a.push(239,191,189),s=n;continue}n=(s-55296<<10|n-56320)+65536}else s&&(i-=3)>-1&&a.push(239,191,189);if(s=null,n<128){if((i-=1)<0)break;a.push(n)}else if(n<2048){if((i-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((i-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((i-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return a}function O(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,i,n,r){let s;for(s=0;s<r&&!(s+n>=i.length)&&!(s>=e.length);++s)i[s+n]=e[s];return s}function k(e,i){return e instanceof i||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===i.name}let F=function(){let e="0123456789abcdef",i=Array(256);for(let n=0;n<16;++n){let r=16*n;for(let s=0;s<16;++s)i[r+s]=e[n]+e[s]}return i}();function z(e){return"undefined"==typeof BigInt?G:e}function G(){throw Error("BigInt not supported")}},"./node_modules/css-loader/dist/runtime/api.js":e=>{"use strict";e.exports=function(e){var i=[];return i.toString=function(){return this.map(function(i){var n="",r=void 0!==i[5];return i[4]&&(n+="@supports (".concat(i[4],") {")),i[2]&&(n+="@media ".concat(i[2]," {")),r&&(n+="@layer".concat(i[5].length>0?" ".concat(i[5]):""," {")),n+=e(i),r&&(n+="}"),i[2]&&(n+="}"),i[4]&&(n+="}"),n}).join("")},i.i=function(e,n,r,s,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var l=0;l<this.length;l++){var h=this[l][0];null!=h&&(o[h]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);(!r||!o[c[0]])&&(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),n&&(c[2]&&(c[1]="@media ".concat(c[2]," {").concat(c[1],"}")),c[2]=n),s&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=s):c[4]="".concat(s)),i.push(c))}},i}},"./node_modules/css-loader/dist/runtime/getUrl.js":e=>{"use strict";e.exports=function(e,i){return(i||(i={}),e&&(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),i.hash&&(e+=i.hash),/["'() \t\n]|(%20)/.test(e)||i.needQuotes))?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":e=>{"use strict";e.exports=function(e){var i=e[1],n=e[3];if(!n)return i;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n))));return[i].concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r)," */")]).join("\n")}return[i].join("\n")}},"./node_modules/debug/src/browser.js":(e,i,n)=>{let r;i.formatArgs=function(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;i.splice(1,0,n,"color: inherit");let r=0,s=0;i[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))}),i.splice(s,0,n)},i.save=function(e){try{e?i.storage.setItem("debug",e):i.storage.removeItem("debug")}catch(e){}},i.load=function(){let e;try{e=i.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},i.useColors=function(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},i.storage=function(){try{return localStorage}catch(e){}}(),i.destroy=(r=!1,()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],i.log=console.debug||console.log||(()=>{}),e.exports=n("./node_modules/debug/src/common.js")(i);let{formatters:s}=e.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},"./node_modules/debug/src/common.js":(e,i,n)=>{e.exports=function(e){function i(e){let n,s,a;let o=null;function l(...e){if(!l.enabled)return;let r=Number(new Date),s=r-(n||r);l.diff=s,l.prev=n,l.curr=r,n=r,e[0]=i.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,r)=>{if("%%"===n)return"%";a++;let s=i.formatters[r];if("function"==typeof s){let i=e[a];n=s.call(l,i),e.splice(a,1),a--}return n}),i.formatArgs.call(l,e),(l.log||i.log).apply(l,e)}return l.namespace=e,l.useColors=i.useColors(),l.color=i.selectColor(e),l.extend=r,l.destroy=i.destroy,Object.defineProperty(l,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(s!==i.namespaces&&(s=i.namespaces,a=i.enabled(e)),a),set:e=>{o=e}}),"function"==typeof i.init&&i.init(l),l}function r(e,n){let r=i(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(e){return e instanceof Error?e.stack||e.message:e},i.disable=function(){let e=[...i.names.map(s),...i.skips.map(s).map(e=>"-"+e)].join(",");return i.enable(""),e},i.enable=function(e){let n;i.save(e),i.namespaces=e,i.names=[],i.skips=[];let r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(n=0;n<s;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?i.skips.push(RegExp("^"+e.slice(1)+"$")):i.names.push(RegExp("^"+e+"$")))},i.enabled=function(e){let n,r;if("*"===e[e.length-1])return!0;for(n=0,r=i.skips.length;n<r;n++)if(i.skips[n].test(e))return!1;for(n=0,r=i.names.length;n<r;n++)if(i.names[n].test(e))return!0;return!1},i.humanize=n("./node_modules/ms/index.js"),i.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(n=>{i[n]=e[n]}),i.names=[],i.skips=[],i.formatters={},i.selectColor=function(e){let n=0;for(let i=0;i<e.length;i++)n=(n<<5)-n+e.charCodeAt(i)|0;return i.colors[Math.abs(n)%i.colors.length]},i.enable(i.load()),i}},"./node_modules/deep-assign/index.js":(e,i,n)=>{"use strict";var r=n("./node_modules/is-obj/index.js"),s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e,i,n){var a=i[n];if(null!=a){if(s.call(e,n)&&(void 0===e[n]||null===e[n]))throw TypeError("Cannot convert undefined or null to object ("+n+")");s.call(e,n)&&r(a)?e[n]=l(Object(e[n]),i[n]):e[n]=a}}function l(e,i){if(e===i)return e;for(var n in i=Object(i))s.call(i,n)&&o(e,i,n);if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(i),l=0;l<r.length;l++)a.call(i,r[l])&&o(e,i,r[l]);return e}e.exports=function(e){e=function(e){if(null==e)throw TypeError("Sources cannot be null or undefined");return Object(e)}(e);for(var i=1;i<arguments.length;i++)l(e,arguments[i]);return e}},"./node_modules/dtype/index.js":e=>{e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},"./node_modules/global/window.js":(e,i,n)=>{var r;"undefined"!=typeof window?r=window:void 0!==n.g?r=n.g:"undefined"!=typeof self?r=self:r={},e.exports=r},"./node_modules/ieee754/index.js":(e,i)=>{i.read=function(e,i,n,r,s){var a,o,l=8*s-r-1,h=(1<<l)-1,u=h>>1,c=-7,d=n?s-1:0,p=n?-1:1,f=e[i+d];for(d+=p,a=f&(1<<-c)-1,f>>=-c,c+=l;c>0;a=256*a+e[i+d],d+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[i+d],d+=p,c-=8);if(0===a)a=1-u;else{if(a===h)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=u}return(f?-1:1)*o*Math.pow(2,a-r)},i.write=function(e,i,n,r,s,a){var o,l,h,u=8*a-s-1,c=(1<<u)-1,d=c>>1,p=5960464477539062e-23*(23===s),f=r?0:a-1,m=r?1:-1,g=+(i<0||0===i&&1/i<0);for(isNaN(i=Math.abs(i))||i===1/0?(l=+!!isNaN(i),o=c):(o=Math.floor(Math.log(i)/Math.LN2),i*(h=Math.pow(2,-o))<1&&(o--,h*=2),o+d>=1?i+=p/h:i+=p*Math.pow(2,1-d),i*h>=2&&(o++,h/=2),o+d>=c?(l=0,o=c):o+d>=1?(l=(i*h-1)*Math.pow(2,s),o+=d):(l=i*Math.pow(2,d-1)*Math.pow(2,s),o=0));s>=8;e[n+f]=255&l,f+=m,l/=256,s-=8);for(o=o<<s|l,u+=s;u>0;e[n+f]=255&o,f+=m,o/=256,u-=8);e[n+f-m]|=128*g}},"./node_modules/is-buffer/index.js":e=>{function i(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){var n;return null!=e&&(i(e)||"function"==typeof(n=e).readFloatLE&&"function"==typeof n.slice&&i(n.slice(0,0))||!!e._isBuffer)}},"./node_modules/is-function/index.js":e=>{e.exports=function(e){if(!e)return!1;var n=i.call(e);return"[object Function]"===n||"function"==typeof e&&"[object RegExp]"!==n||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var i=Object.prototype.toString},"./node_modules/is-obj/index.js":e=>{"use strict";e.exports=function(e){var i=typeof e;return null!==e&&("object"===i||"function"===i)}},"./node_modules/layout-bmfont-text/index.js":(e,i,n)=>{var r=n("./node_modules/word-wrapper/index.js"),s=n("./node_modules/xtend/immutable.js"),a=n("./node_modules/as-number/index.js"),o=["x","e","a","o","n","s","r","c","u","m","v","w","z"],l=["m","w"],h=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"];function u(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function c(e,i){if(!e.chars||0===e.chars.length)return null;var n=p(e.chars,i);return n>=0?e.chars[n]:null}function d(e,i,n){if(!e.kernings||0===e.kernings.length)return 0;for(var r=e.kernings,s=0;s<r.length;s++){var a=r[s];if(a.first===i&&a.second===n)return a.amount}return 0}function p(e,i,n){n=n||0;for(var r=n;r<e.length;r++)if(e[r].id===i)return r;return -1}e.exports=function(e){return new u(e)},u.prototype.update=function(e){if(e=s({measure:this._measure},e),this._opt=e,this._opt.tabSize=a(this._opt.tabSize,4),!e.font)throw Error("must provide a valid bitmap font");var i,n=this.glyphs,l=e.text||"",u=e.font;this._setupSpaceGlyphs(u);var c=r.lines(l,e),f=e.width||0;n.length=0;var m=c.reduce(function(e,i){return Math.max(e,i.width,f)},0),g=0,A=0,v=a(e.lineHeight,u.common.lineHeight),y=u.common.base,x=v-y,_=e.letterSpacing||0,b=v*c.length-x,E="center"===(i=this._opt.align)?1:2*("right"===i);A-=b,this._width=m,this._height=b,this._descender=v-y,this._baseline=y,this._xHeight=function(e){for(var i=0;i<o.length;i++){var n=o[i].charCodeAt(0),r=p(e.chars,n);if(r>=0)return e.chars[r].height}return 0}(u),this._capHeight=function(e){for(var i=0;i<h.length;i++){var n=h[i].charCodeAt(0),r=p(e.chars,n);if(r>=0)return e.chars[r].height}return 0}(u),this._lineHeight=v,this._ascender=v-x-this._xHeight;var w=this;c.forEach(function(e,i){for(var r,s=e.start,a=e.end,o=e.width,h=s;h<a;h++){var c=l.charCodeAt(h),p=w.getGlyph(u,c);if(p){r&&(g+=d(u,r.id,p.id));var f=g;1===E?f+=(m-o)/2:2===E&&(f+=m-o),n.push({position:[f,A],data:p,index:h,line:i}),g+=p.xadvance+_,r=p}}A+=v,g=0}),this._linesTotal=c.length},u.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var i=c(e,32)||function(e){for(var i=0;i<l.length;i++){var n=l[i].charCodeAt(0),r=p(e.chars,n);if(r>=0)return e.chars[r]}return 0}(e)||e.chars[0],n=this._opt.tabSize*i.xadvance;this._fallbackSpaceGlyph=i,this._fallbackTabGlyph=s(i,{x:0,y:0,xadvance:n,id:9,xoffset:0,yoffset:0,width:0,height:0})}},u.prototype.getGlyph=function(e,i){var n=c(e,i);return n?n:9===i?this._fallbackTabGlyph:32===i?this._fallbackSpaceGlyph:null},u.prototype.computeMetrics=function(e,i,n,r){var s,a,o=this._opt.letterSpacing||0,l=this._opt.font,h=0,u=0,c=0;if(!l.chars||0===l.chars.length)return{start:i,end:i,width:0};n=Math.min(e.length,n);for(var p=i;p<n;p++){var f=e.charCodeAt(p),s=this.getGlyph(l,f);if(s){s.xoffset;var m=(h+=a?d(l,a.id,s.id):0)+s.xadvance+o,g=h+s.width;if(g>=r||m>=r)break;h=m,u=g,a=s}c++}return a&&(u+=a.xoffset),{start:i,end:i+c,width:u}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(e){var i;Object.defineProperty(u.prototype,e,{get:Function(["return function "+(i=e)+"() {","  return this._"+i,"}"].join("\n"))(),configurable:!0})})},"./node_modules/load-bmfont/browser.js":(e,i,n)=>{var r=n("./node_modules/buffer/index.js").Buffer,s=n("./node_modules/xhr/index.js"),a=function(){},o=n("./node_modules/parse-bmfont-ascii/index.js"),l=n("./node_modules/parse-bmfont-xml/lib/browser.js"),h=n("./node_modules/parse-bmfont-binary/index.js"),u=n("./node_modules/load-bmfont/lib/is-binary.js"),c=n("./node_modules/xtend/immutable.js"),d=self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;e.exports=function(e,i){i="function"==typeof i?i:a,"string"==typeof e?e={uri:e}:e||(e={}),e.binary&&(e=function(e){if(d)return c(e,{responseType:"arraybuffer"});if(void 0===self.XMLHttpRequest)throw Error("your browser does not support XHR loading");var i=new self.XMLHttpRequest;return i.overrideMimeType("text/plain; charset=x-user-defined"),c({xhr:i},e)}(e)),s(e,function(n,s,c){if(n)return i(n);if(!/^2/.test(s.statusCode))return i(Error("http status code: "+s.statusCode));if(!c)return i(Error("no body result"));var d,p,f=!1;if(d=c,"[object ArrayBuffer]"===Object.prototype.toString.call(d)){var m=new Uint8Array(c);c=r.from(m,"binary")}u(c)&&(f=!0,"string"==typeof c&&(c=r.from(c,"binary"))),f||(r.isBuffer(c)&&(c=c.toString(e.encoding)),c=c.trim());try{var g=s.headers["content-type"];p=f?h(c):/json/.test(g)||"{"===c.charAt(0)?JSON.parse(c):/xml/.test(g)||"<"===c.charAt(0)?l(c):o(c)}catch(e){i(Error("error parsing font "+e.message)),i=a}i(null,p)})}},"./node_modules/load-bmfont/lib/is-binary.js":(e,i,n)=>{var r=n("./node_modules/buffer/index.js").Buffer,s=n("./node_modules/buffer-equal/index.js"),a=r.from([66,77,70,3]);e.exports=function(e){return"string"==typeof e?"BMF"===e.substring(0,3):e.length>4&&s(e.slice(0,4),a)}},"./node_modules/ms/index.js":e=>{function i(e,i,n,r){return Math.round(e/n)+" "+r+(i>=1.5*n?"s":"")}e.exports=function(e,n){n=n||{};var r,s,a,o,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var n=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return 864e5*n;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*n;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===l&&isFinite(e)){return n.long?(s=Math.abs(r=e))>=864e5?i(r,s,864e5,"day"):s>=36e5?i(r,s,36e5,"hour"):s>=6e4?i(r,s,6e4,"minute"):s>=1e3?i(r,s,1e3,"second"):r+" ms":(o=Math.abs(a=e))>=864e5?Math.round(a/864e5)+"d":o>=36e5?Math.round(a/36e5)+"h":o>=6e4?Math.round(a/6e4)+"m":o>=1e3?Math.round(a/1e3)+"s":a+"ms"}throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},"./node_modules/parse-bmfont-ascii/index.js":e=>{e.exports=function(e){if(!e)throw Error("no data provided");e=e.toString().trim();var n={pages:[],chars:[],kernings:[]},r=e.split(/\r\n?|\n/g);if(0===r.length)throw Error("no data in BMFont file");for(var s=0;s<r.length;s++){var a=function(e,n){if(!(e=e.replace(/\t+/g," ").trim()))return null;var r=e.indexOf(" ");if(-1===r)throw Error("no named row at line "+n);var s=e.substring(0,r);e=(e=(e=(e=e.substring(r+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map(function(e){return e.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var a=[],o=0;o<e.length;o++){var l=e[o];0===o?a.push({key:l[0],data:""}):o===e.length-1?a[a.length-1].data=i(l[0]):(a[a.length-1].data=i(l[0]),a.push({key:l[1],data:""}))}var h={key:s,data:{}};return a.forEach(function(e){h.data[e.key]=e.data}),h}(r[s],s);if(a){if("page"===a.key){if("number"!=typeof a.data.id)throw Error("malformed file at line "+s+" -- needs page id=N");if("string"!=typeof a.data.file)throw Error("malformed file at line "+s+' -- needs page file="path"');n.pages[a.data.id]=a.data.file}else"chars"===a.key||"kernings"===a.key||("char"===a.key?n.chars.push(a.data):"kerning"===a.key?n.kernings.push(a.data):n[a.key]=a.data)}}return n};function i(e){return e&&0!==e.length?0===e.indexOf('"')||0===e.indexOf("'")?e.substring(1,e.length-1):-1!==e.indexOf(",")?e.split(",").map(function(e){return parseInt(e,10)}):parseInt(e,10):""}},"./node_modules/parse-bmfont-binary/index.js":e=>{var i=[66,77,70];function n(e,i){for(var n=i;n<e.length&&0!==e[n];n++);return e.slice(i,n)}e.exports=function(e){if(e.length<6)throw Error("invalid buffer length for BMFont");if(!i.every(function(i,n){return e.readUInt8(n)===i}))throw Error("BMFont missing BMF byte header");var r=3;if(e.readUInt8(r++)>3)throw Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var s={kernings:[],chars:[]},a=0;a<5;a++)r+=function(e,i,r){if(r>i.length-1)return 0;var s=i.readUInt8(r++),a=i.readInt32LE(r);switch(r+=4,s){case 1:e.info=function(e,i){var r={};r.size=e.readInt16LE(i);var s=e.readUInt8(i+2);return r.smooth=s>>7&1,r.unicode=s>>6&1,r.italic=s>>5&1,r.bold=s>>4&1,s>>3&1&&(r.fixedHeight=1),r.charset=e.readUInt8(i+3)||"",r.stretchH=e.readUInt16LE(i+4),r.aa=e.readUInt8(i+6),r.padding=[e.readInt8(i+7),e.readInt8(i+8),e.readInt8(i+9),e.readInt8(i+10)],r.spacing=[e.readInt8(i+11),e.readInt8(i+12)],r.outline=e.readUInt8(i+13),r.face=n(e,i+14).toString("utf8"),r}(i,r);break;case 2:e.common=function(e,i){var n={};return n.lineHeight=e.readUInt16LE(i),n.base=e.readUInt16LE(i+2),n.scaleW=e.readUInt16LE(i+4),n.scaleH=e.readUInt16LE(i+6),n.pages=e.readUInt16LE(i+8),e.readUInt8(i+10),n.packed=0,n.alphaChnl=e.readUInt8(i+11),n.redChnl=e.readUInt8(i+12),n.greenChnl=e.readUInt8(i+13),n.blueChnl=e.readUInt8(i+14),n}(i,r);break;case 3:e.pages=function(e,i,r){for(var s=[],a=n(e,i),o=a.length+1,l=r/o,h=0;h<l;h++)s[h]=e.slice(i,i+a.length).toString("utf8"),i+=o;return s}(i,r,a);break;case 4:e.chars=function(e,i,n){for(var r=[],s=n/20,a=0;a<s;a++){var o={},l=20*a;o.id=e.readUInt32LE(i+0+l),o.x=e.readUInt16LE(i+4+l),o.y=e.readUInt16LE(i+6+l),o.width=e.readUInt16LE(i+8+l),o.height=e.readUInt16LE(i+10+l),o.xoffset=e.readInt16LE(i+12+l),o.yoffset=e.readInt16LE(i+14+l),o.xadvance=e.readInt16LE(i+16+l),o.page=e.readUInt8(i+18+l),o.chnl=e.readUInt8(i+19+l),r[a]=o}return r}(i,r,a);break;case 5:e.kernings=function(e,i,n){for(var r=[],s=n/10,a=0;a<s;a++){var o={},l=10*a;o.first=e.readUInt32LE(i+0+l),o.second=e.readUInt32LE(i+4+l),o.amount=e.readInt16LE(i+8+l),r[a]=o}return r}(i,r,a)}return 5+a}(s,e,r);return s}},"./node_modules/parse-bmfont-xml/lib/browser.js":(e,i,n)=>{var r=n("./node_modules/parse-bmfont-xml/lib/parse-attribs.js"),s=n("./node_modules/xml-parse-from-string/index.js"),a={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};function o(e){return(function(e){for(var i=[],n=0;n<e.attributes.length;n++)i.push(e.attributes[n]);return i})(e).reduce(function(e,i){var n;return e[a[(n=i.nodeName).toLowerCase()]||n]=i.nodeValue,e},{})}e.exports=function(e){var i=s(e=e.toString()),n={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(e){var s=i.getElementsByTagName(e)[0];s&&(n[e]=r(o(s)))});var a=i.getElementsByTagName("pages")[0];if(!a)throw Error("malformed file -- no <pages> element");for(var l=a.getElementsByTagName("page"),h=0;h<l.length;h++){var u=l[h],c=parseInt(u.getAttribute("id"),10),d=u.getAttribute("file");if(isNaN(c))throw Error('malformed file -- page "id" attribute is NaN');if(!d)throw Error('malformed file -- needs page "file" attribute');n.pages[parseInt(c,10)]=d}return["chars","kernings"].forEach(function(e){var s=i.getElementsByTagName(e)[0];if(s)for(var a=e.substring(0,e.length-1),l=s.getElementsByTagName(a),h=0;h<l.length;h++){var u=l[h];n[e].push(r(o(u)))}}),n}},"./node_modules/parse-bmfont-xml/lib/parse-attribs.js":e=>{var i="chasrset";e.exports=function(e){for(var n in i in e&&(e.charset=e[i],delete e[i]),e)if("face"!==n&&"charset"!==n)"padding"===n||"spacing"===n?e[n]=e[n].split(",").map(function(e){return parseInt(e,10)}):e[n]=parseInt(e[n],10);return e}},"./node_modules/parse-headers/parse-headers.js":e=>{var i=function(e){return e.replace(/^\s+|\s+$/g,"")};e.exports=function(e){if(!e)return{};for(var n={},r=i(e).split("\n"),s=0;s<r.length;s++){var a,o=r[s],l=o.indexOf(":"),h=i(o.slice(0,l)).toLowerCase(),u=i(o.slice(l+1));void 0===n[h]?n[h]=u:(a=n[h],"[object Array]"===Object.prototype.toString.call(a))?n[h].push(u):n[h]=[n[h],u]}return n}},"./node_modules/quad-indices/index.js":(e,i,n)=>{var r=n("./node_modules/dtype/index.js"),s=n("./node_modules/an-array/index.js"),a=n("./node_modules/is-buffer/index.js"),o=[0,2,3],l=[2,1,3];e.exports=function(e,i){e&&(s(e)||a(e))||(i=e||{},e=null);for(var n="string"==typeof(i="number"==typeof i?{count:i}:i||{}).type?i.type:"uint16",h="number"==typeof i.count?i.count:1,u=i.start||0,c=!1!==i.clockwise?o:l,d=c[0],p=c[1],f=c[2],m=6*h,g=e||new(r(n))(m),A=0,v=0;A<m;A+=6,v+=4){var y=A+u;g[y+0]=v+0,g[y+1]=v+1,g[y+2]=v+2,g[y+3]=v+d,g[y+4]=v+p,g[y+5]=v+f}return g}},"./node_modules/super-animejs/lib/anime.es.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>eA});var r,s={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},a={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},o=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],l={},h={};function u(e,i,n){return Math.min(Math.max(e,i),n)}function c(e,i){return e.indexOf(i)>-1}function d(e,i){return e.apply(null,i)}var p=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,f=/^rgb/,m=/^hsl/,g={arr:function(e){return Array.isArray(e)},obj:function(e){return c(Object.prototype.toString.call(e),"Object")},pth:function(e){return g.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return e.nodeType||g.svg(e)},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return void 0===e},hex:function(e){return p.test(e)},rgb:function(e){return f.test(e)},hsl:function(e){return m.test(e)},col:function(e){return g.hex(e)||g.rgb(e)||g.hsl(e)},key:function(e){return!s.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}},A=/\(([^)]+)\)/;function v(e){var i=A.exec(e);return i?i[1].split(",").map(function(e){return parseFloat(e)}):[]}function y(e,i){var n=v(e),r=u(g.und(n[0])?1:n[0],.1,100),s=u(g.und(n[1])?100:n[1],.1,100),a=u(g.und(n[2])?10:n[2],.1,100),o=u(g.und(n[3])?0:n[3],.1,100),l=Math.sqrt(s/r),c=a/(2*Math.sqrt(s*r)),d=c<1?l*Math.sqrt(1-c*c):0,p=c<1?(c*l+-o)/d:-o+l;function f(e){var n=i?i*e/1e3:e;return(n=c<1?Math.exp(-n*c*l)*(+Math.cos(d*n)+p*Math.sin(d*n)):(1+p*n)*Math.exp(-n*l),0===e||1===e)?e:1-n}return i?f:function(){var i=h[e];if(i)return i;for(var n=1/6,r=0,s=0;;)if(1===f(r+=n)){if(++s>=16)break}else s=0;var a=r*n*1e3;return h[e]=a,a}}function x(e,i){void 0===e&&(e=1),void 0===i&&(i=.5);var n=u(e,1,10),r=u(i,.1,2);return function(e){return 0===e||1===e?e:-n*Math.pow(2,10*(e-1))*Math.sin(2*Math.PI*(e-1-r/(2*Math.PI)*Math.asin(1/n))/r)}}function _(e){return void 0===e&&(e=10),function(i){return 1/e*Math.round(i*e)}}var b=function(){function e(e,i,n){return(((1-3*n+3*i)*e+(3*n-6*i))*e+3*i)*e}function i(e,i,n){return 3*(1-3*n+3*i)*e*e+2*(3*n-6*i)*e+3*i}return function(n,r,s,a){if(0<=n&&n<=1&&0<=s&&s<=1){var o=new Float32Array(11);if(n!==r||s!==a)for(var l=0;l<11;++l)o[l]=e(.1*l,n,s);return function(l){return n===r&&s===a||0===l||1===l?l:e(function(r){for(var a=0,l=1;10!==l&&o[l]<=r;++l)a+=.1;var h=a+(r-o[--l])/(o[l+1]-o[l])*.1,u=i(h,n,s);return u>=.001?function(n,r,s,a){for(var o=0;o<4;++o){var l=i(r,s,a);if(0===l)break;var h=e(r,s,a)-n;r-=h/l}return r}(r,h,n,s):0===u?h:function(i,n,r,s,a){var o,l,h=0;do(o=e(l=n+(r-n)/2,s,a)-i)>0?r=l:n=l;while(Math.abs(o)>1e-7&&++h<10);return l}(r,a,a+.1,n,s)}(l),r,a)}}}}(),E=function(){var e=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],i={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],x],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(e,i){return function(n){return 1-x(e,i)(1-n)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(e,i){return function(n){return n<.5?x(e,i)(2*n)/2:1-x(e,i)(-2*n+2)/2}}]},n={linear:[.25,.25,.75,.75]};for(var r in i)for(var s=0,a=i[r].length;s<a;s++)n["ease"+r+e[s]]=i[r][s];return n}();function w(e,i){if(g.fnc(e))return e;var n=e.split("(")[0],r=E[n],s=v(e);switch(n){case"spring":return y(e,i);case"cubicBezier":return d(b,s);case"steps":return d(_,s);default:return g.fnc(r)?d(r,s):d(b,r)}}function M(e){try{return document.querySelectorAll(e)}catch(e){return}}var C=[];function S(e,i){for(var n=C,r=e.length,s=arguments.length>=2?arguments[1]:void 0,a=0;a<r;a++)if(a in e){var o=e[a];i.call(s,o,a,e)&&n.push(o)}return(C=e).length=0,n}function T(e,i){i||(i=[]);for(var n=0,r=e.length;n<r;n++){var s=e[n];Array.isArray(s)?T(s,i):i.push(s)}return i}function R(e){return g.arr(e)?e:(g.str(e)&&(e=M(e)||e),e instanceof NodeList||e instanceof HTMLCollection)?[].slice.call(e):[e]}function I(e,i){return e.some(function(e){return e===i})}function B(e){var i={};for(var n in e)i[n]=e[n];return i}function L(e,i){var n=B(e);for(var r in e)n[r]=i.hasOwnProperty(r)?i[r]:e[r];return n}function P(e,i){var n=B(e);for(var r in i)n[r]=g.und(e[r])?i[r]:e[r];return n}var D=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g,N=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,O=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,U=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,k=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g,F=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function z(e){var i=F.exec(e);if(i)return i[2]}function G(e,i){return g.fnc(e)?e(i.target,i.id,i.total):e}function V(e,i){return e.getAttribute(i)}function j(e,i,n){if(I([n,"deg","rad","turn"],z(i)))return i;var r=l[i+n];if(!g.und(r))return r;var s=document.createElement(e.tagName),a=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;a.appendChild(s),s.style.position="absolute",s.style.width=100+n;var o=100/s.offsetWidth;a.removeChild(s);var h=o*parseFloat(i);return l[i+n]=h,h}function H(e,i,n){if(i in e.style){var r=i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),s=e.style[i]||getComputedStyle(e).getPropertyValue(r)||"0";return n?j(e,s,n):s}}function Q(e,i){return g.dom(e)&&!g.inp(e)&&(V(e,i)||g.svg(e)&&e[i])?"attribute":g.dom(e)&&I(o,i)?"transform":g.dom(e)&&"transform"!==i&&H(e,i)?"css":null!=e[i]?"object":void 0}var W=/(\w+)\(([^)]*)\)/g;function q(e){if(g.dom(e)){for(var i,n=e.style.transform||"",r=new Map;i=W.exec(n);)r.set(i[1],i[2]);return r}}function X(e,i,n,r){switch(Q(e,i)){case"transform":var s,a;return s=c(i,"scale")?1:0+(c(i,"translate")||"perspective"===i?"px":c(i,"rotate")||c(i,"skew")?"deg":void 0),a=q(e).get(i)||s,r&&(r.transforms.list.set(i,a),r.transforms.last=i),n?j(e,a,n):a;case"css":return H(e,i,n);case"attribute":return V(e,i);default:return e[i]||0}}var K=/^(\*=|\+=|-=)/;function Y(e,i){var n=K.exec(e);if(!n)return e;var r=z(e)||0,s=parseFloat(i),a=parseFloat(e.replace(n[0],""));switch(n[0][0]){case"+":return s+a+r;case"-":return s-a+r;case"*":return s*a+r}}var J=/\s/g;function Z(e,i){if(g.col(e))return function(e){var i,n,r;return g.rgb(e)?(i=D.exec(e))?"rgba("+i[1]+",1)":e:g.hex(e)?(n=e.replace(N,function(e,i,n,r){return i+i+n+n+r+r}),"rgba("+parseInt((r=O.exec(n))[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+",1)"):g.hsl(e)?function(e){var i,n,r,s=U.exec(e)||k.exec(e),a=parseInt(s[1],10)/360,o=parseInt(s[2],10)/100,l=parseInt(s[3],10)/100,h=s[4]||1;function u(e,i,n){return(n<0&&(n+=1),n>1&&(n-=1),n<1/6)?e+(i-e)*6*n:n<.5?i:n<2/3?e+(i-e)*(2/3-n)*6:e}if(0==o)i=n=r=l;else{var c=l<.5?l*(1+o):l+o-l*o,d=2*l-c;i=u(d,c,a+1/3),n=u(d,c,a),r=u(d,c,a-1/3)}return"rgba("+255*i+","+255*n+","+255*r+","+h+")"}(e):void 0}(e);var n=z(e),r=n?e.substr(0,e.length-n.length):e;return i&&!J.test(e)?r+i:r}function $(e,i){return Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))}function ee(e){for(var i,n=e.points,r=0,s=0;s<n.numberOfItems;s++){var a=n.getItem(s);s>0&&(r+=$(i,a)),i=a}return r}function et(e){var i;if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return 2*Math.PI*V(e,"r");case"rect":return 2*V(e,"width")+2*V(e,"height");case"line":return $({x:V(e,"x1"),y:V(e,"y1")},{x:V(e,"x2"),y:V(e,"y2")});case"polyline":return ee(e);case"polygon":return i=e.points,ee(e)+$(i.getItem(i.numberOfItems-1),i.getItem(0))}}function ei(e,i){var n=i||{},r=n.el||function(e){for(var i=e.parentNode;g.svg(i)&&(i=i.parentNode,g.svg(i.parentNode)););return i}(e),s=r.getBoundingClientRect(),a=V(r,"viewBox"),o=s.width,l=s.height,h=n.viewBox||(a?a.split(" "):[0,0,o,l]);return{el:r,viewBox:h,x:h[0]/1,y:h[1]/1,w:o/h[2],h:l/h[3]}}var en=/-?\d*\.?\d+/g;function er(e,i){var n=Z(g.pth(e)?e.totalLength:e,i)+"";return{original:n,numbers:n.match(en)?n.match(en).map(Number):[0],strings:g.str(e)||i?n.split(en):[]}}function es(e){return S(e?T(g.arr(e)?e.map(R):R(e)):[],function(e,i,n){return n.indexOf(e)===i})}function ea(e){var i=es(e);return i.map(function(e,n){return{target:e,id:n,total:i.length,transforms:{list:q(e)}}})}var eo=/^spring/,el={css:function(e,i,n){return e.style[i]=n},attribute:function(e,i,n){return e.setAttribute(i,n)},object:function(e,i,n){return e[i]=n},transform:function(e,i,n,r,s){if(r.list.set(i,n),i===r.last||s){var a="";r.list.forEach(function(e,i){a+=i+"("+e+") "}),e.style.transform=a}}};function eh(e,i){for(var n=ea(e),r=0,s=n.length;r<s;r++){var a=n[r];for(var o in i){var l=G(i[o],a),h=a.target,u=z(l),c=X(h,o,u,a),d=Y(Z(l,u||z(c)),c);el[Q(h,o)](h,o,d,a.transforms,!0)}}}function eu(e,i){var n=e.length,r=function(e){return e.timelineOffset?e.timelineOffset:0},s={};return s.duration=n?Math.max.apply(Math,e.map(function(e){return r(e)+e.duration})):i.duration,s.delay=n?Math.min.apply(Math,e.map(function(e){return r(e)+e.delay})):i.delay,s.endDelay=n?s.duration-Math.max.apply(Math,e.map(function(e){return r(e)+e.duration-e.endDelay})):i.endDelay,s}var ec=0,ed=[],ep=[],ef=function(){function e(){r=requestAnimationFrame(i)}function i(i){var n=ed.length;if(n){for(var s=0;s<n;){var a=ed[s];if(a.paused){var o=ed.indexOf(a);o>-1&&(ed.splice(o,1),n=ed.length)}else a.tick(i);s++}e()}else r=cancelAnimationFrame(r)}return e}();function em(e){void 0===e&&(e={});var i,n,o,l,h,c,d,p,f,m=0,A=0,v=0,x=0,_=null;function b(){return window.Promise&&new Promise(function(e){return _=e})}var E=b(),M=(n=L(s,i=e),l=function(e,i){var n=[],r=i.keyframes;for(var s in r&&(i=P(function(e){for(var i=S(T(e.map(function(e){return Object.keys(e)})),function(e){return g.key(e)}).reduce(function(e,i){return 0>e.indexOf(i)&&e.push(i),e},[]),n={},r=0;r<i.length;r++)!function(r){var s=i[r];n[s]=e.map(function(e){var i={};for(var n in e)g.key(n)?n==s&&(i.value=e[n]):i[n]=e[n];return i})}(r);return n}(r),i)),i)g.key(s)&&n.push({name:s,tweens:function(e,i){var n=B(i);if(eo.test(n.easing)&&(n.duration=y(n.easing)),g.arr(e)){var r=e.length;2!==r||g.obj(e[0])?g.fnc(i.duration)||(n.duration=i.duration/r):e={value:e}}var s=g.arr(e)?e:[e];return s.map(function(e,n){var r=g.obj(e)&&!g.pth(e)?e:{value:e};return g.und(r.delay)&&(r.delay=n?0:i.delay),g.und(r.endDelay)&&(r.endDelay=n===s.length-1?i.endDelay:0),r}).map(function(e){return P(e,n)})}(i[s],e)});return n}(o=L(a,i),i),d=eu(c=S(T((h=ea(i.targets)).map(function(e){return l.map(function(i){return function(e,i){var n=Q(e.target,i.name);if(n){var r,s=i.tweens.map(function(n){var s=function(e,i){var n={};for(var r in e){var s=G(e[r],i);g.arr(s)&&1===(s=s.map(function(e){return G(e,i)})).length&&(s=s[0]),n[r]=s}return n.duration=parseFloat(n.duration),n.delay=parseFloat(n.delay),n}(n,e),a=s.value,o=g.arr(a)?a[1]:a,l=z(o),h=X(e.target,i.name,l,e),u=r?r.to.original:h,c=g.arr(a)?a[0]:u,d=z(c)||z(h),p=l||d;return g.und(o)&&(o=u),s.from=er(c,p),s.to=er(Y(o,c),p),s.start=r?r.end:0,s.end=s.start+s.delay+s.duration+s.endDelay,s.easing=w(s.easing,s.duration),s.isPath=g.pth(a),s.isColor=g.col(s.from.original),s.isColor&&(s.round=1),r=s,s}),a=s[s.length-1];return{type:n,property:i.name,animatable:e,tweens:s,duration:a.end,delay:s[0].delay,endDelay:a.endDelay}}}(e,i)})})),function(e){return!g.und(e)}),o),p=ec,ec++,P(n,{id:p,children:[],animatables:h,animations:c,duration:d.duration,delay:d.delay,endDelay:d.endDelay}));function C(){M.reversed=!M.reversed;for(var e=0,i=f.length;e<i;e++)f[e].reversed=M.reversed}function R(e){return M.reversed?M.duration-e:e}function I(){m=0,A=R(M.currentTime)*(1/em.speed)}function D(e,i){i&&i.seek(e-i.timelineOffset)}function N(e){for(var i=0,n=M.animations,r=n.length;i<r;){var s=n[i],a=s.animatable,o=s.tweens,l=o.length-1,h=o[l];l&&(h=S(o,function(i){return e<i.end})[0]||h);for(var c=u(e-h.start-h.delay,0,h.duration)/h.duration,d=isNaN(c)?1:h.easing(c),p=h.to.strings,f=h.round,m=[],g=h.to.numbers.length,A=void 0,v=0;v<g;v++){var y=void 0,x=h.to.numbers[v],_=h.from.numbers[v]||0;y=h.isPath?function(e,i){function n(n){void 0===n&&(n=0);var r=i+n>=1?i+n:0;return e.el.getPointAtLength(r)}var r=ei(e.el,e.svg),s=n(),a=n(-1),o=n(1);switch(e.property){case"x":return(s.x-r.x)*r.w;case"y":return(s.y-r.y)*r.h;case"angle":return 180*Math.atan2(o.y-a.y,o.x-a.x)/Math.PI}}(h.value,d*x):_+d*(x-_),f&&!(h.isColor&&v>2)&&(y=Math.round(y*f)/f),m.push(y)}var b=p.length;if(b){A=p[0];for(var E=0;E<b;E++){p[E];var w=p[E+1],C=m[E];isNaN(C)||(w?A+=C+w:A+=C+" ")}}else A=m[0];el[s.type](a.target,s.property,A,a.transforms),s.currentValue=A,i++}}function O(e){M[e]&&!M.passThrough&&M[e](M)}function U(e){var i=M.duration,n=M.delay,r=i-M.endDelay,s=R(e);M.progress=u(s/i*100,0,100),M.reversePlayback=s<M.currentTime,f&&function(e){if(M.reversePlayback)for(var i=x;i--;)D(e,f[i]);else for(var n=0;n<x;n++)D(e,f[n])}(s),!M.began&&M.currentTime>0&&(M.began=!0,O("begin"),O("loopBegin")),s<=n&&0!==M.currentTime&&N(0),(s>=r&&M.currentTime!==i||!i)&&N(i),s>n&&s<r?(M.changeBegan||(M.changeBegan=!0,M.changeCompleted=!1,O("changeBegin")),O("change"),N(s)):M.changeBegan&&(M.changeCompleted=!0,M.changeBegan=!1,O("changeComplete")),M.currentTime=u(s,0,i),M.began&&O("update"),e>=i&&(A=0,M.remaining&&!0!==M.remaining&&M.remaining--,M.remaining?(m=v,O("loopComplete"),O("loopBegin"),"alternate"===M.direction&&C()):(M.paused=!0,!M.completed&&(M.completed=!0,O("loopComplete"),O("complete"),"Promise"in window&&(_(),E=b()))))}return M.reset=function(){var e=M.direction;M.passThrough=!1,M.currentTime=0,M.progress=0,M.paused=!0,M.began=!1,M.changeBegan=!1,M.completed=!1,M.changeCompleted=!1,M.reversePlayback=!1,M.reversed="reverse"===e,M.remaining=M.loop,x=(f=M.children).length;for(var i=x;i--;)M.children[i].reset();(M.reversed&&!0!==M.loop||"alternate"===e&&1===M.loop)&&M.remaining++,N(0)},M.set=function(e,i){return eh(e,i),M},M.tick=function(e){v=e,m||(m=v),U((v+(A-m))*em.speed)},M.seek=function(e){U(R(e))},M.pause=function(){M.paused=!0,I()},M.play=function(){M.paused&&(M.paused=!1,ed.push(M),I(),r||ef())},M.reverse=function(){C(),I()},M.restart=function(){M.reset(),M.play()},M.finished=E,M.reset(),M.autoplay&&M.play(),M}function eg(e,i){for(var n=i.length;n--;)I(e,i[n].animatable.target)&&i.splice(n,1)}document.addEventListener("visibilitychange",function(){if(document.hidden){for(var e=0,i=ed.length;e<i;e++)activeInstance[e].pause();ep=ed.slice(0),ed=[]}else for(var n=0,r=ep.length;n<r;n++)ep[n].play()}),em.version="3.0.0",em.speed=1,em.running=ed,em.remove=function(e){for(var i=es(e),n=ed.length;n--;){var r=ed[n],s=r.animations,a=r.children;eg(i,s);for(var o=a.length;o--;){var l=a[o],h=l.animations;eg(i,h),h.length||l.children.length||a.splice(o,1)}s.length||a.length||r.pause()}},em.get=X,em.set=eh,em.convertPx=j,em.path=function(e,i){var n=g.str(e)?M(e)[0]:e,r=i||100;return function(e){return{property:e,el:n,svg:ei(n),totalLength:et(n)*(r/100)}}},em.setDashoffset=function(e){var i=et(e);return e.setAttribute("stroke-dasharray",i),i},em.stagger=function(e,i){void 0===i&&(i={});var n=i.direction||"normal",r=i.easing?w(i.easing):null,s=i.grid,a=i.axis,o=i.from||0,l="first"===o,h="center"===o,u="last"===o,c=g.arr(e),d=c?parseFloat(e[0]):parseFloat(e),p=c?parseFloat(e[1]):0,f=z(c?e[1]:e)||0,m=i.start||0+(c?d:0),A=[],v=0;return function(e,i,g){if(l&&(o=0),h&&(o=(g-1)/2),u&&(o=g-1),!A.length){for(var y=0;y<g;y++){if(s){var x=h?(s[0]-1)/2:o%s[0],_=h?(s[1]-1)/2:Math.floor(o/s[0]),b=y%s[0],E=Math.floor(y/s[0]),w=x-b,M=_-E,C=Math.sqrt(w*w+M*M);"x"===a&&(C=-w),"y"===a&&(C=-M),A.push(C)}else A.push(Math.abs(o-y));v=Math.max.apply(Math,A)}r&&(A=A.map(function(e){return r(e/v)*v})),"reverse"===n&&(A=A.map(function(e){return a?e<0?-1*e:-e:Math.abs(v-e)}))}return m+(c?(p-d)/v:d)*(Math.round(100*A[i])/100)+f}},em.timeline=function(e){void 0===e&&(e={});var i=em(e);return i.duration=0,i.add=function(n,r){var s=ed.indexOf(i),o=i.children;function l(e){e.passThrough=!0}s>-1&&ed.splice(s,1);for(var h=0;h<o.length;h++)l(o[h]);var u=P(n,L(a,e));u.targets=u.targets||e.targets;var c=i.duration;u.autoplay=!1,u.direction=i.direction,u.timelineOffset=g.und(r)?c:Y(r,c),l(i),i.seek(u.timelineOffset);var d=em(u);l(d),o.push(d);var p=eu(o,e);return i.delay=p.delay,i.endDelay=p.endDelay,i.duration=p.duration,i.seek(0),i.reset(),i.autoplay&&i.play(),i},i},em.easing=w,em.penner=E,em.random=function(e,i){return Math.floor(Math.random()*(i-e+1))+e};let eA=em},"./node_modules/three-bmfont-text/index.js":(e,i,n)=>{var r=n("./node_modules/layout-bmfont-text/index.js"),s=n("./node_modules/quad-indices/index.js"),a=n("./node_modules/three-bmfont-text/lib/vertices.js"),o=n("./node_modules/three-bmfont-text/lib/utils.js");e.exports=function(e){return new l(e)};class l extends THREE.BufferGeometry{constructor(e){super(),"string"==typeof e&&(e={text:e}),this._opt=Object.assign({},e),e&&this.update(e)}update(e){if("string"==typeof e&&(e={text:e}),!(e=Object.assign({},this._opt,e)).font)throw TypeError("must specify a { font } in options");this.layout=r(e);var i=!1!==e.flipY,n=e.font,o=n.common.scaleW,l=n.common.scaleH,h=this.layout.glyphs.filter(function(e){var i=e.data;return i.width*i.height>0});this.visibleGlyphs=h;var u=a.positions(h),c=a.uvs(h,o,l,i),d=s([],{clockwise:!0,type:"uint16",count:h.length});if(this.setIndex(d),this.setAttribute("position",new THREE.BufferAttribute(u,2)),this.setAttribute("uv",new THREE.BufferAttribute(c,2)),!e.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(e.multipage){var p=a.pages(h);this.setAttribute("page",new THREE.BufferAttribute(p,1))}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array,i=this.attributes.position.itemSize;if(!e||!i||e.length<2){this.boundingSphere.radius=0,this.boundingSphere.center.set(0,0,0);return}o.computeSphere(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.boundingBox,i=this.attributes.position.array,n=this.attributes.position.itemSize;if(!i||!n||i.length<2){e.makeEmpty();return}o.computeBox(i,e)}}},"./node_modules/three-bmfont-text/lib/utils.js":e=>{var i={min:[0,0],max:[0,0]};function n(e){var n=e.length/2;i.min[0]=e[0],i.min[1]=e[1],i.max[0]=e[0],i.max[1]=e[1];for(var r=0;r<n;r++){var s=e[2*r+0],a=e[2*r+1];i.min[0]=Math.min(s,i.min[0]),i.min[1]=Math.min(a,i.min[1]),i.max[0]=Math.max(s,i.max[0]),i.max[1]=Math.max(a,i.max[1])}}e.exports.computeBox=function(e,r){n(e),r.min.set(i.min[0],i.min[1],0),r.max.set(i.max[0],i.max[1],0)},e.exports.computeSphere=function(e,r){n(e);var s=i.min[0],a=i.min[1],o=i.max[0],l=i.max[1],h=o-s,u=l-a,c=Math.sqrt(h*h+u*u);r.center.set(s+h/2,a+u/2,0),r.radius=c/2}},"./node_modules/three-bmfont-text/lib/vertices.js":e=>{e.exports.pages=function(e){var i=new Float32Array(4*e.length),n=0;return e.forEach(function(e){var r=e.data.page||0;i[n++]=r,i[n++]=r,i[n++]=r,i[n++]=r}),i},e.exports.uvs=function(e,i,n,r){var s=new Float32Array(8*e.length),a=0;return e.forEach(function(e){var o=e.data,l=o.x+o.width,h=o.y+o.height,u=o.x/i,c=o.y/n,d=l/i,p=h/n;r&&(c=(n-o.y)/n,p=(n-h)/n),s[a++]=u,s[a++]=c,s[a++]=u,s[a++]=p,s[a++]=d,s[a++]=p,s[a++]=d,s[a++]=c}),s},e.exports.positions=function(e){var i=new Float32Array(8*e.length),n=0;return e.forEach(function(e){var r=e.data,s=e.position[0]+r.xoffset,a=e.position[1]+r.yoffset,o=r.width,l=r.height;i[n++]=s,i[n++]=a,i[n++]=s,i[n++]=a+l,i[n++]=s+o,i[n++]=a+l,i[n++]=s+o,i[n++]=a}),i}},"./node_modules/webvr-polyfill/build/webvr-polyfill.js":function(e,i,n){var r;r=function(){"use strict";var e,i,r="undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},s=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},a=function(e,i){for(var n=0,r=e.length;n<r;n++)i[n]=e[n]},o=function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n]);return e},l=(function(e,i){var n;n=function(){var e,i,n,s,a,o,l,h,u,c,d,p,f,m=function(e,i){if(!(e instanceof i))throw TypeError("Cannot call a class as a function")},g=function(){function e(e,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(i,n,r){return n&&e(i.prototype,n),r&&e(i,r),i}}(),A=function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,i){var n=[],r=!0,s=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){s=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(s)throw a}}return n}(e,i);throw TypeError("Invalid attempt to destructure non-iterable instance")},v=function(e,i,n){return e+(i-e)*n},y=(e=/iPad|iPhone|iPod/.test(navigator.platform),function(){return e}),x=(i=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome"),function(){return i}),_=(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),function(){return n}),b=(s=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android"),function(){return s}),E=(o=(a=navigator.userAgent.match(/.*Chrome\/([0-9]+)/))?parseInt(a[1],10):null,function(){return o}),w=(l=!1,l=y()&&_()&&-1!==navigator.userAgent.indexOf("13_4"),function(){return l}),M=function(){var e=!1;if(65===E()){var i=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(i){var n=A(i[1].split("."),4),r=(n[0],n[1],n[2]),s=n[3];e=3325===parseInt(r,10)&&148>parseInt(s,10)}}return function(){return e}}(),C=(h=-1!==navigator.userAgent.indexOf("R7 Build"),function(){return h}),S=function(){var e=90==window.orientation||-90==window.orientation;return C()?!e:e},T=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},R=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},I=function(e){if(x())return!1;if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else{if(!e.msRequestFullscreen)return!1;e.msRequestFullscreen()}return!0},B=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},L=function(e,i,n,r){var s=e.createShader(e.VERTEX_SHADER);e.shaderSource(s,i),e.compileShader(s);var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,n),e.compileShader(a);var o=e.createProgram();for(var l in e.attachShader(o,s),e.attachShader(o,a),r)e.bindAttribLocation(o,r[l],l);return e.linkProgram(o),e.deleteShader(s),e.deleteShader(a),o},P=function(e,i){for(var n={},r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS),s="",a=0;a<r;a++)n[s=e.getActiveUniform(i,a).name.replace("[0]","")]=e.getUniformLocation(i,s);return n},D=function(e,i,n,r,s,a,o){var l=1/(i-n),h=1/(r-s),u=1/(a-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(i+n)*l,e[13]=(s+r)*h,e[14]=(o+a)*u,e[15]=1,e},N=function(){var e,i=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(i=!0),i},O=function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n]);return e},U=function(e){if(y()){var i=e.style.width,n=e.style.height;e.style.width=parseInt(i)+1+"px",e.style.height=parseInt(n)+"px",setTimeout(function(){e.style.width=i,e.style.height=n},100)}window.canvas=e},k=function(){var e=Math.PI/180,i=.25*Math.PI,n=new Float32Array([0,0,0,1]),r=new Float32Array([0,0,0]);function s(s,a,o,l,h,u){c=l||null,d=u.depthNear,p=u.depthFar,f=Math.tan(c?c.upDegrees*e:i),m=Math.tan(c?c.downDegrees*e:i),v=2/((g=Math.tan(c?c.leftDegrees*e:i))+(A=Math.tan(c?c.rightDegrees*e:i))),y=2/(f+m),s[0]=v,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=y,s[6]=0,s[7]=0,s[8]=-((g-A)*v*.5),s[9]=(f-m)*y*.5,s[10]=p/(d-p),s[11]=-1,s[12]=0,s[13]=0,s[14]=p*d/(d-p),s[15]=0;var c,d,p,f,m,g,A,v,y,x,_,b,E,w,M,C,S,T,R,I,B,L,P,D,N,O,U,k,F,z,G,V,j,H,Q,W,q,X,K,Y,J,Z,$,ee,et,ei,en,er,es,ea,eo,el,eh,eu,ec,ed,ep,ef,em,eg,eA,ev,ey,ex,e_,eb,eE,ew,eM,eC=o.orientation||n,eS=o.position||r;x=eC[0],_=eC[1],b=eC[2],E=eC[3],w=x+x,M=_+_,C=b+b,S=x*w,T=x*M,R=x*C,I=_*M,B=_*C,L=b*C,P=E*w,D=E*M,N=E*C,a[0]=1-(I+L),a[1]=T+N,a[2]=R-D,a[3]=0,a[4]=T-N,a[5]=1-(S+L),a[6]=B+P,a[7]=0,a[8]=R+D,a[9]=B-P,a[10]=1-(S+I),a[11]=0,a[12]=eS[0],a[13]=eS[1],a[14]=eS[2],a[15]=1,h&&(X=h[0],K=h[1],Y=h[2],a==a?(a[12]=a[0]*X+a[4]*K+a[8]*Y+a[12],a[13]=a[1]*X+a[5]*K+a[9]*Y+a[13],a[14]=a[2]*X+a[6]*K+a[10]*Y+a[14],a[15]=a[3]*X+a[7]*K+a[11]*Y+a[15]):(O=a[0],U=a[1],k=a[2],F=a[3],z=a[4],G=a[5],V=a[6],j=a[7],H=a[8],Q=a[9],W=a[10],q=a[11],a[0]=O,a[1]=U,a[2]=k,a[3]=F,a[4]=z,a[5]=G,a[6]=V,a[7]=j,a[8]=H,a[9]=Q,a[10]=W,a[11]=q,a[12]=O*X+z*K+H*Y+a[12],a[13]=U*X+G*K+Q*Y+a[13],a[14]=k*X+V*K+W*Y+a[14],a[15]=F*X+j*K+q*Y+a[15])),J=a[0],Z=a[1],$=a[2],ee=a[3],et=a[4],ei=a[5],en=a[6],er=a[7],es=a[8],ea=a[9],eo=a[10],el=a[11],eh=a[12],eu=a[13],ec=a[14],ed=a[15],ep=J*ei-Z*et,ef=J*en-$*et,em=J*er-ee*et,eg=Z*en-$*ei,eA=Z*er-ee*ei,ev=$*er-ee*en,ey=es*eu-ea*eh,ex=es*ec-eo*eh,e_=es*ed-el*eh,eb=ea*ec-eo*eu,eE=ea*ed-el*eu,(eM=ep*(ew=eo*ed-el*ec)-ef*eE+em*eb+eg*e_-eA*ex+ev*ey)&&(eM=1/eM,a[0]=(ei*ew-en*eE+er*eb)*eM,a[1]=($*eE-Z*ew-ee*eb)*eM,a[2]=(eu*ev-ec*eA+ed*eg)*eM,a[3]=(eo*eA-ea*ev-el*eg)*eM,a[4]=(en*e_-et*ew-er*ex)*eM,a[5]=(J*ew-$*e_+ee*ex)*eM,a[6]=(ec*em-eh*ev-ed*ef)*eM,a[7]=(es*ev-eo*em+el*ef)*eM,a[8]=(et*eE-ei*e_+er*ey)*eM,a[9]=(Z*e_-J*eE-ee*ey)*eM,a[10]=(eh*eA-eu*em+ed*ep)*eM,a[11]=(ea*em-es*eA-el*ep)*eM,a[12]=(ei*ex-et*eb-en*ey)*eM,a[13]=(J*eb-Z*ex+$*ey)*eM,a[14]=(eu*ef-eh*eg-ec*ep)*eM,a[15]=(es*eg-ea*ef+eo*ep)*eM)}return function(e,i,n){return!!e&&!!i&&(e.pose=i,e.timestamp=i.timestamp,s(e.leftProjectionMatrix,e.leftViewMatrix,i,n._getFieldOfView("left"),n._getEyeOffset("left"),n),s(e.rightProjectionMatrix,e.rightViewMatrix,i,n._getFieldOfView("right"),n._getEyeOffset("right"),n),!0)}}(),F=function(){var e=window.self!==window.top,i=z(document.referrer),n=z(window.location.href);return e&&i!==n},z=function(e){var i,n=e.indexOf("://");i=-1!==n?n+3:0;var r=e.indexOf("/",i);return -1===r&&(r=e.length),e.substring(0,r)},G=(u={},function(e,i){void 0===u[e]&&(console.warn("webvr-polyfill: "+i),u[e]=!0)}),V=function(e,i){G(e,e+" has been deprecated. This may not work on native WebVR displays. "+(i?"Please use "+i+" instead.":""))},j=function(e,i,n){if(!i){n(e);return}for(var r=[],s=null,a=0;a<i.length;++a){var o=i[a];switch(o){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:var l=i[++a];if(l<e.TEXTURE0||l>e.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),r.push(null,null);break}s||(s=e.getParameter(e.ACTIVE_TEXTURE)),e.activeTexture(l),r.push(e.getParameter(o),null);break;case e.ACTIVE_TEXTURE:s=e.getParameter(e.ACTIVE_TEXTURE),r.push(null);break;default:r.push(e.getParameter(o))}}n(e);for(var a=0;a<i.length;++a){var o=i[a],h=r[a];switch(o){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,h);break;case e.COLOR_CLEAR_VALUE:e.clearColor(h[0],h[1],h[2],h[3]);break;case e.COLOR_WRITEMASK:e.colorMask(h[0],h[1],h[2],h[3]);break;case e.CURRENT_PROGRAM:e.useProgram(h);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,h);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,h);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,h);break;case e.TEXTURE_BINDING_2D:var l=i[++a];if(l<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_2D,h);break;case e.TEXTURE_BINDING_CUBE_MAP:var l=i[++a];if(l<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_CUBE_MAP,h);break;case e.VIEWPORT:e.viewport(h[0],h[1],h[2],h[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:h?e.enable(o):e.disable(o);break;default:console.log("No GL restore behavior for 0x"+o.toString(16))}s&&e.activeTexture(s)}};function H(e,i,n,r){this.gl=e,this.cardboardUI=i,this.bufferScale=n,this.dirtySubmitFrameBindings=r,this.ctxAttribs=e.getContextAttributes(),this.instanceExt=e.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,y()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=L(e,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}","precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs),this.uniforms=P(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize()}H.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},H.prototype.onResize=function(){var e=this.gl,i=this,n=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];j(e,n,function(e){i.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),i.scissorTest&&i.realDisable.call(e,e.SCISSOR_TEST),i.realColorMask.call(e,!0,!0,!0,!0),i.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),i.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),i.realBindFramebuffer.call(e,e.FRAMEBUFFER,i.framebuffer),e.bindTexture(e.TEXTURE_2D,i.renderTarget),e.texImage2D(e.TEXTURE_2D,0,i.ctxAttribs.alpha?e.RGBA:e.RGB,i.bufferWidth,i.bufferHeight,0,i.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i.renderTarget,0),i.ctxAttribs.depth&&i.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,i.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.bufferWidth,i.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,i.depthStencilBuffer)):i.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,i.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i.bufferWidth,i.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i.depthBuffer)):i.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,i.bufferWidth,i.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,i.stencilBuffer)),!e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),i.realBindFramebuffer.call(e,e.FRAMEBUFFER,i.lastBoundFramebuffer),i.scissorTest&&i.realEnable.call(e,e.SCISSOR_TEST),i.realColorMask.apply(e,i.colorMask),i.realViewport.apply(e,i.viewport),i.realClearColor.apply(e,i.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},H.prototype.patch=function(){if(!this.isPatched){var e=this,i=this.gl.canvas,n=this.gl;y()||(i.width=T()*this.bufferScale,i.height=R()*this.bufferScale,Object.defineProperty(i,"width",{configurable:!0,enumerable:!0,get:function(){return e.bufferWidth},set:function(n){e.bufferWidth=n,e.realCanvasWidth.set.call(i,n),e.onResize()}}),Object.defineProperty(i,"height",{configurable:!0,enumerable:!0,get:function(){return e.bufferHeight},set:function(n){e.bufferHeight=n,e.realCanvasHeight.set.call(i,n),e.onResize()}})),this.lastBoundFramebuffer=n.getParameter(n.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(i,r){e.lastBoundFramebuffer=r||e.framebuffer,e.realBindFramebuffer.call(n,i,e.lastBoundFramebuffer)},this.cullFace=n.getParameter(n.CULL_FACE),this.depthTest=n.getParameter(n.DEPTH_TEST),this.blend=n.getParameter(n.BLEND),this.scissorTest=n.getParameter(n.SCISSOR_TEST),this.stencilTest=n.getParameter(n.STENCIL_TEST),n.enable=function(i){switch(i){case n.CULL_FACE:e.cullFace=!0;break;case n.DEPTH_TEST:e.depthTest=!0;break;case n.BLEND:e.blend=!0;break;case n.SCISSOR_TEST:e.scissorTest=!0;break;case n.STENCIL_TEST:e.stencilTest=!0}e.realEnable.call(n,i)},n.disable=function(i){switch(i){case n.CULL_FACE:e.cullFace=!1;break;case n.DEPTH_TEST:e.depthTest=!1;break;case n.BLEND:e.blend=!1;break;case n.SCISSOR_TEST:e.scissorTest=!1;break;case n.STENCIL_TEST:e.stencilTest=!1}e.realDisable.call(n,i)},this.colorMask=n.getParameter(n.COLOR_WRITEMASK),n.colorMask=function(i,r,s,a){e.colorMask[0]=i,e.colorMask[1]=r,e.colorMask[2]=s,e.colorMask[3]=a,e.realColorMask.call(n,i,r,s,a)},this.clearColor=n.getParameter(n.COLOR_CLEAR_VALUE),n.clearColor=function(i,r,s,a){e.clearColor[0]=i,e.clearColor[1]=r,e.clearColor[2]=s,e.clearColor[3]=a,e.realClearColor.call(n,i,r,s,a)},this.viewport=n.getParameter(n.VIEWPORT),n.viewport=function(i,r,s,a){e.viewport[0]=i,e.viewport[1]=r,e.viewport[2]=s,e.viewport[3]=a,e.realViewport.call(n,i,r,s,a)},this.isPatched=!0,U(i)}},H.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,i=this.gl.canvas;y()||(Object.defineProperty(i,"width",this.realCanvasWidth),Object.defineProperty(i,"height",this.realCanvasHeight)),i.width=this.bufferWidth,i.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){U(i)},1)}},H.prototype.setTextureBounds=function(e,i){e||(e=[0,0,.5,1]),i||(i=[.5,0,.5,1]),this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=i[0],this.viewportOffsetScale[5]=i[1],this.viewportOffsetScale[6]=i[2],this.viewportOffsetScale[7]=i[3]},H.prototype.submitFrame=function(){var e=this.gl,i=this,n=[];if(this.dirtySubmitFrameBindings||n.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),j(e,n,function(e){i.realBindFramebuffer.call(e,e.FRAMEBUFFER,null);var n=0,r=0;i.instanceExt&&(n=e.getVertexAttrib(i.attribs.position,i.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),r=e.getVertexAttrib(i.attribs.texCoord,i.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),i.cullFace&&i.realDisable.call(e,e.CULL_FACE),i.depthTest&&i.realDisable.call(e,e.DEPTH_TEST),i.blend&&i.realDisable.call(e,e.BLEND),i.scissorTest&&i.realDisable.call(e,e.SCISSOR_TEST),i.stencilTest&&i.realDisable.call(e,e.STENCIL_TEST),i.realColorMask.call(e,!0,!0,!0,!0),i.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(i.ctxAttribs.alpha||y())&&(i.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(i.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.enableVertexAttribArray(i.attribs.position),e.enableVertexAttribArray(i.attribs.texCoord),e.vertexAttribPointer(i.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(i.attribs.texCoord,3,e.FLOAT,!1,20,8),i.instanceExt&&(0!=n&&i.instanceExt.vertexAttribDivisorANGLE(i.attribs.position,0),0!=r&&i.instanceExt.vertexAttribDivisorANGLE(i.attribs.texCoord,0)),e.activeTexture(e.TEXTURE0),e.uniform1i(i.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,i.renderTarget),e.uniform4fv(i.uniforms.viewportOffsetScale,i.viewportOffsetScale),e.drawElements(e.TRIANGLES,i.indexCount,e.UNSIGNED_SHORT,0),i.cardboardUI&&i.cardboardUI.renderNoState(),i.realBindFramebuffer.call(i.gl,e.FRAMEBUFFER,i.framebuffer),i.ctxAttribs.preserveDrawingBuffer||(i.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),i.dirtySubmitFrameBindings||i.realBindFramebuffer.call(e,e.FRAMEBUFFER,i.lastBoundFramebuffer),i.cullFace&&i.realEnable.call(e,e.CULL_FACE),i.depthTest&&i.realEnable.call(e,e.DEPTH_TEST),i.blend&&i.realEnable.call(e,e.BLEND),i.scissorTest&&i.realEnable.call(e,e.SCISSOR_TEST),i.stencilTest&&i.realEnable.call(e,e.STENCIL_TEST),i.realColorMask.apply(e,i.colorMask),i.realViewport.apply(e,i.viewport),(i.ctxAttribs.alpha||!i.ctxAttribs.preserveDrawingBuffer)&&i.realClearColor.apply(e,i.clearColor),i.instanceExt&&(0!=n&&i.instanceExt.vertexAttribDivisorANGLE(i.attribs.position,n),0!=r&&i.instanceExt.vertexAttribDivisorANGLE(i.attribs.texCoord,r))}),y()){var r=e.canvas;(r.width!=i.bufferWidth||r.height!=i.bufferHeight)&&(i.bufferWidth=r.width,i.bufferHeight=r.height,i.onResize())}},H.prototype.updateDeviceInfo=function(e){var i=this.gl,n=this,r=[i.ARRAY_BUFFER_BINDING,i.ELEMENT_ARRAY_BUFFER_BINDING];j(i,r,function(i){var r=n.computeMeshVertices_(n.meshWidth,n.meshHeight,e);if(i.bindBuffer(i.ARRAY_BUFFER,n.vertexBuffer),i.bufferData(i.ARRAY_BUFFER,r,i.STATIC_DRAW),!n.indexCount){var s=n.computeMeshIndices_(n.meshWidth,n.meshHeight);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,s,i.STATIC_DRAW),n.indexCount=s.length}})},H.prototype.computeMeshVertices_=function(e,i,n){for(var r=new Float32Array(2*e*i*5),s=n.getLeftEyeVisibleTanAngles(),a=n.getLeftEyeNoLensTanAngles(),o=n.getLeftEyeVisibleScreenRect(a),l=0,h=0;h<2;h++){for(var u=0;u<i;u++)for(var c=0;c<e;c++,l++){var d=c/(e-1),p=u/(i-1),f=d,m=p,g=v(s[0],s[2],d),A=v(s[3],s[1],p),y=Math.sqrt(g*g+A*A),x=n.distortion.distortInverse(y),_=g*x/y,b=A*x/y;d=(_-a[0])/(a[2]-a[0]),p=(b-a[3])/(a[1]-a[3]),d=(o.x+d*o.width-.5)*2,p=(o.y+p*o.height-.5)*2,r[5*l+0]=d,r[5*l+1]=p,r[5*l+2]=f,r[5*l+3]=m,r[5*l+4]=h}var E=s[2]-s[0];s[0]=-(E+s[0]),s[2]=E-s[2],E=a[2]-a[0],a[0]=-(E+a[0]),a[2]=E-a[2],o.x=1-(o.x+o.width)}return r},H.prototype.computeMeshIndices_=function(e,i){for(var n=new Uint16Array(2*(e-1)*(i-1)*6),r=e/2,s=i/2,a=0,o=0,l=0;l<2;l++)for(var h=0;h<i;h++)for(var u=0;u<e;u++,a++)0!=u&&0!=h&&(u<=r==h<=s?(n[o++]=a,n[o++]=a-e-1,n[o++]=a-e,n[o++]=a-e-1,n[o++]=a,n[o++]=a-1):(n[o++]=a-1,n[o++]=a-e,n[o++]=a,n[o++]=a-e,n[o++]=a-1,n[o++]=a-e-1));return n},H.prototype.getOwnPropertyDescriptor_=function(e,i){var n=Object.getOwnPropertyDescriptor(e,i);return(void 0===n.get||void 0===n.set)&&(n.configurable=!0,n.enumerable=!0,n.get=function(){return this.getAttribute(i)},n.set=function(e){this.setAttribute(i,e)}),n};var Q=Math.PI/180;function W(e){this.gl=e,this.attribs={position:0},this.program=L(e,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",this.attribs),this.uniforms=P(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function q(e){this.coefficients=e}W.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener("click",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},W.prototype.listen=function(e,i){var n=this.gl.canvas;this.listener=function(r){var s=n.clientWidth/2;r.clientX>s-42&&r.clientX<s+42&&r.clientY>n.clientHeight-42?e(r):r.clientX<42&&r.clientY<42&&i(r)},n.addEventListener("click",this.listener,!1)},W.prototype.onResize=function(){var e=this.gl,i=this,n=[e.ARRAY_BUFFER_BINDING];j(e,n,function(e){var n=[],r=e.drawingBufferWidth/2,s=Math.max(screen.width,screen.height)*window.devicePixelRatio,a=e.drawingBufferWidth/s*window.devicePixelRatio,o=4*a/2,l=42*a,h=28*a/2,u=14*a;function c(e,i){var s=(90-e)*Q,a=Math.cos(s),o=Math.sin(s);n.push(.3125*a*h+r,.3125*o*h+h),n.push(i*a*h+r,i*o*h+h)}n.push(r-o,l),n.push(r-o,e.drawingBufferHeight),n.push(r+o,l),n.push(r+o,e.drawingBufferHeight),i.gearOffset=n.length/2;for(var d=0;d<=6;d++){var p=60*d;c(p,1),c(p+12,1),c(p+20,.75),c(p+40,.75),c(p+48,1)}function f(i,r){n.push(u+i,e.drawingBufferHeight-u-r)}i.gearVertexCount=n.length/2-i.gearOffset,i.arrowOffset=n.length/2;var m=o/Math.sin(45*Q);f(0,h),f(h,0),f(h+m,m),f(m,h+m),f(m,h-m),f(0,h),f(h,2*h),f(h+m,2*h-m),f(m,h-m),f(0,h),f(m,h-o),f(28*a,h-o),f(m,h+o),f(28*a,h+o),i.arrowVertexCount=n.length/2-i.arrowOffset,e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW)})},W.prototype.render=function(){var e=this.gl,i=this,n=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];j(e,n,function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),i.renderNoState()})},W.prototype.renderNoState=function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(this.attribs.position),e.vertexAttribPointer(this.attribs.position,2,e.FLOAT,!1,8,0),e.uniform4f(this.uniforms.color,1,1,1,1),D(this.projMat,0,e.drawingBufferWidth,0,e.drawingBufferHeight,.1,1024),e.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.drawArrays(e.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),e.drawArrays(e.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},q.prototype.distortInverse=function(e){for(var i=0,n=1,r=e-this.distort(i);Math.abs(n-i)>1e-4;){var s=e-this.distort(n),a=n-(n-i)/(s-r)*s;i=n,n=a,r=s}return n},q.prototype.distort=function(e){for(var i=e*e,n=0,r=0;r<this.coefficients.length;r++)n=i*(n+this.coefficients[r]);return(n+1)*e};var X=Math.PI/180,K=180/Math.PI,Y=function(e,i,n){this.x=e||0,this.y=i||0,this.z=n||0};Y.prototype={constructor:Y,set:function(e,i,n){return this.x=e,this.y=i,this.z=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();return 0!==e?this.multiplyScalar(1/e):(this.x=0,this.y=0,this.z=0),this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var i=this.x,n=this.y,r=this.z,s=e.x,a=e.y,o=e.z,l=e.w,h=l*i+a*r-o*n,u=l*n+o*i-s*r,c=l*r+s*n-a*i,d=-s*i-a*n-o*r;return this.x=h*l+-(d*s)+-(u*o)- -(c*a),this.y=u*l+-(d*a)+-(c*s)- -(h*o),this.z=c*l+-(d*o)+-(h*a)- -(u*s),this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,i){var n=e.x,r=e.y,s=e.z,a=i.x,o=i.y,l=i.z;return this.x=r*l-s*o,this.y=s*a-n*l,this.z=n*o-r*a,this}};var J=function(e,i,n,r){this.x=e||0,this.y=i||0,this.z=n||0,this.w=void 0!==r?r:1};function Z(e){this.width=e.width||T(),this.height=e.height||R(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}J.prototype={constructor:J,set:function(e,i,n,r){return this.x=e,this.y=i,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,i,n){var r=Math.cos(e/2),s=Math.cos(i/2),a=Math.cos(n/2),o=Math.sin(e/2),l=Math.sin(i/2),h=Math.sin(n/2);return this.x=o*s*a+r*l*h,this.y=r*l*a-o*s*h,this.z=r*s*h+o*l*a,this.w=r*s*a-o*l*h,this},setFromEulerYXZ:function(e,i,n){var r=Math.cos(e/2),s=Math.cos(i/2),a=Math.cos(n/2),o=Math.sin(e/2),l=Math.sin(i/2),h=Math.sin(n/2);return this.x=o*s*a+r*l*h,this.y=r*l*a-o*s*h,this.z=r*s*h-o*l*a,this.w=r*s*a+o*l*h,this},setFromAxisAngle:function(e,i){var n=i/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,i){var n=e.x,r=e.y,s=e.z,a=e.w,o=i.x,l=i.y,h=i.z,u=i.w;return this.x=n*u+a*o+r*h-s*l,this.y=r*u+a*l+s*o-n*h,this.z=s*u+a*h+n*l-r*o,this.w=a*u-n*o-r*l-s*h,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,i){if(0===i)return this;if(1===i)return this.copy(e);var n=this.x,r=this.y,s=this.z,a=this.w,o=a*e.w+n*e.x+r*e.y+s*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=a,this.x=n,this.y=r,this.z=s,this;var l=Math.acos(o),h=Math.sqrt(1-o*o);if(.001>Math.abs(h))return this.w=.5*(a+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(s+this.z),this;var u=Math.sin((1-i)*l)/h,c=Math.sin(i*l)/h;return this.w=a*u+this.w*c,this.x=n*u+this.x*c,this.y=r*u+this.y*c,this.z=s*u+this.z*c,this},setFromUnitVectors:function(e,i){return void 0===c&&(c=new Y),(d=e.dot(i)+1)<1e-6?(d=0,Math.abs(e.x)>Math.abs(e.z)?c.set(-e.y,e.x,0):c.set(0,-e.z,e.y)):c.crossVectors(e,i),this.x=c.x,this.y=c.y,this.z=c.z,this.w=d,this.normalize(),this}};var $=new Z({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),ee=new Z({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),et={CardboardV1:new en({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new en({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9904169e-10,6183535e-11,-16981803e-13]})};function ei(e,i){this.viewer=et.CardboardV2,this.updateDeviceParams(e),this.distortion=new q(this.viewer.distortionCoefficients);for(var n=0;n<i.length;n++){var r=i[n];et[r.id]=new en(r)}}function en(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}ei.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},ei.prototype.getDevice=function(){return this.device},ei.prototype.setViewer=function(e){this.viewer=e,this.distortion=new q(this.viewer.distortionCoefficients)},ei.prototype.determineDevice_=function(e){if(!e)return y()?(console.warn("Using fallback iOS device measurements."),ee):(console.warn("Using fallback Android device measurements."),$);var i=.0254/e.xdpi,n=.0254/e.ydpi;return new Z({widthMeters:i*T(),heightMeters:n*R(),bevelMeters:.001*e.bevelMm})},ei.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,i=this.device,n=this.distortion,r=e.screenLensDistance,s=(i.widthMeters-e.interLensDistance)/2,a=e.interLensDistance/2,o=e.baselineLensDistance-i.bevelMeters,l=i.heightMeters-o,h=K*Math.atan(n.distort(s/r)),u=K*Math.atan(n.distort(a/r)),c=K*Math.atan(n.distort(o/r)),d=K*Math.atan(n.distort(l/r));return{leftDegrees:Math.min(h,e.fov),rightDegrees:Math.min(u,e.fov),downDegrees:Math.min(c,e.fov),upDegrees:Math.min(d,e.fov)}},ei.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,i=this.device,n=this.distortion,r=Math.tan(-X*e.fov),s=Math.tan(X*e.fov),a=Math.tan(X*e.fov),o=Math.tan(-X*e.fov),l=i.widthMeters/4,h=i.heightMeters/2,u=e.baselineLensDistance-i.bevelMeters-h,c=e.interLensDistance/2-l,d=-u,p=e.screenLensDistance,f=n.distort((c-l)/p),m=n.distort((d+h)/p),g=n.distort((c+l)/p),A=n.distort((d-h)/p),v=new Float32Array(4);return v[0]=Math.max(r,f),v[1]=Math.min(s,m),v[2]=Math.min(a,g),v[3]=Math.max(o,A),v},ei.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,i=this.device,n=this.distortion,r=new Float32Array(4),s=n.distortInverse(Math.tan(-X*e.fov)),a=n.distortInverse(Math.tan(X*e.fov)),o=n.distortInverse(Math.tan(X*e.fov)),l=n.distortInverse(Math.tan(-X*e.fov)),h=i.widthMeters/4,u=i.heightMeters/2,c=e.baselineLensDistance-i.bevelMeters-u,d=e.interLensDistance/2-h,p=-c,f=e.screenLensDistance;return r[0]=Math.max(s,(d-h)/f),r[1]=Math.min(a,(p+u)/f),r[2]=Math.min(o,(d+h)/f),r[3]=Math.max(l,(p-u)/f),r},ei.prototype.getLeftEyeVisibleScreenRect=function(e){var i=this.viewer,n=this.device,r=i.screenLensDistance,s=(n.widthMeters-i.interLensDistance)/2,a=i.baselineLensDistance-n.bevelMeters,o=(e[0]*r+s)/n.widthMeters,l=(e[1]*r+a)/n.heightMeters,h=(e[2]*r+s)/n.widthMeters,u=(e[3]*r+a)/n.heightMeters;return{x:o,y:u,width:h-o,height:l-u}},ei.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},ei.prototype.getFieldOfViewRightEye=function(e){var i=this.getFieldOfViewLeftEye(e);return{leftDegrees:i.rightDegrees,rightDegrees:i.leftDegrees,upDegrees:i.upDegrees,downDegrees:i.downDegrees}},ei.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:K*Math.atan(e.outerDist),rightDegrees:K*Math.atan(e.innerDist),downDegrees:K*Math.atan(e.bottomDist),upDegrees:K*Math.atan(e.topDist)}},ei.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),i=this.viewer,n=this.device,r=i.screenLensDistance,s=n.widthMeters/r,a=n.heightMeters/r,o=n.width/s,l=n.height/a,h=Math.round((e.eyePosX-e.outerDist)*o),u=Math.round((e.eyePosY-e.bottomDist)*l);return{x:h,y:u,width:Math.round((e.eyePosX+e.innerDist)*o)-h,height:Math.round((e.eyePosY+e.topDist)*l)-u}},ei.prototype.getUndistortedParams_=function(){var e=this.viewer,i=this.device,n=this.distortion,r=e.screenLensDistance,s=e.interLensDistance/2/r,a=i.widthMeters/r,o=i.heightMeters/r,l=a/2-s,h=(e.baselineLensDistance-i.bevelMeters)/r,u=e.fov,c=n.distortInverse(Math.tan(X*u)),d=Math.min(l,c),p=Math.min(s,c),f=Math.min(h,c);return{outerDist:d,innerDist:p,topDist:Math.min(o-h,c),bottomDist:f,eyePosX:l,eyePosY:h}},ei.Viewers=et;var er={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function es(e,i){if(this.dpdb=er,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=i;var n=new XMLHttpRequest,r=this;n.open("GET",e,!0),n.addEventListener("load",function(){r.loading=!1,n.status>=200&&n.status<=299?(r.dpdb=JSON.parse(n.response),r.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),n.send()}}function ea(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}function eo(e,i){this.set(e,i)}function el(e,i){this.kFilter=e,this.isDebug=i,this.currentAccelMeasurement=new eo,this.currentGyroMeasurement=new eo,this.previousGyroMeasurement=new eo,y()?this.filterQ=new J(-1,0,0,1):this.filterQ=new J(1,0,0,1),this.previousFilterQ=new J,this.previousFilterQ.copy(this.filterQ),this.accelQ=new J,this.isOrientationInitialized=!1,this.estimatedGravity=new Y,this.measuredGravity=new Y,this.gyroIntegralQ=new J}function eh(e,i){this.predictionTimeS=e,this.isDebug=i,this.previousQ=new J,this.previousTimestampS=null,this.deltaQ=new J,this.outQ=new J}function eu(e,i,n,r){this.yawOnly=n,this.accelerometer=new Y,this.gyroscope=new Y,this.filter=new el(e,r),this.posePredictor=new eh(i,r),this.isFirefoxAndroid=b(),this.isIOS=y();var s=E();this.isDeviceMotionInRadians=!this.isIOS&&s&&s<66,this.isWithoutDeviceMotion=M()||w(),this.filterToWorldQ=new J,y()?this.filterToWorldQ.setFromAxisAngle(new Y(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new Y(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new J,this.worldToScreenQ=new J,this.originalPoseAdjustQ=new J,this.originalPoseAdjustQ.setFromAxisAngle(new Y(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),S()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new J,this.orientationOut_=new Float32Array(4),this.start()}es.prototype.getDeviceParams=function(){return this.deviceParams},es.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},es.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return console.error("DPDB not available."),null;if(1!=e.format)return console.error("DPDB has unexpected format version."),null;if(!e.devices||!e.devices.length)return console.error("DPDB does not have a devices section."),null;var i=navigator.userAgent||navigator.vendor||window.opera,n=T(),r=R();if(!e.devices)return console.error("DPDB has no devices section."),null;for(var s=0;s<e.devices.length;s++){var a=e.devices[s];if(!a.rules){console.warn("Device["+s+"] has no rules section.");continue}if("ios"!=a.type&&"android"!=a.type){console.warn("Device["+s+"] has invalid type.");continue}if(y()==("ios"==a.type)){for(var o=!1,l=0;l<a.rules.length;l++){var h=a.rules[l];if(this.ruleMatches_(h,i,n,r)){o=!0;break}}if(o)return new ea({xdpi:a.dpi[0]||a.dpi,ydpi:a.dpi[1]||a.dpi,bevelMm:a.bw})}}return console.warn("No DPDB device match."),null},es.prototype.ruleMatches_=function(e,i,n,r){if(!e.ua&&!e.res||(e.ua&&"SM"===e.ua.substring(0,2)&&(e.ua=e.ua.substring(0,7)),e.ua&&0>i.indexOf(e.ua)))return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var s=e.res[0],a=e.res[1];if(Math.min(n,r)!=Math.min(s,a)||Math.max(n,r)!=Math.max(s,a))return!1}return!0},eo.prototype.set=function(e,i){this.sample=e,this.timestampS=i},eo.prototype.copy=function(e){this.set(e.sample,e.timestampS)},el.prototype.addAccelMeasurement=function(e,i){this.currentAccelMeasurement.set(e,i)},el.prototype.addGyroMeasurement=function(e,i){var n;this.currentGyroMeasurement.set(e,i),!isNaN(n=i-this.previousGyroMeasurement.timestampS)&&!(n<=.001)&&!(n>1)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},el.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,i=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(i),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(i);var n=new J;n.copy(this.filterQ),n.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(n),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var r=new J;r.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),r.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",K*(r.w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(r.w)),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var s=new J;s.copy(this.filterQ),s.multiply(r),this.filterQ.slerp(s,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},el.prototype.getOrientation=function(){return this.filterQ},el.prototype.accelToQuaternion_=function(e){var i=new Y;i.copy(e),i.normalize();var n=new J;return n.setFromUnitVectors(new Y(0,0,-1),i),n.inverse(),n},el.prototype.gyroToQuaternionDelta_=function(e,i){var n=new J,r=new Y;return r.copy(e),r.normalize(),n.setFromAxisAngle(r,e.length()*i),n},eh.prototype.getPrediction=function(e,i,n){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=n,e;var r=new Y;r.copy(i),r.normalize();var s=i.length();if(s<20*X)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(K*s).toFixed(1)),this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var a=s*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(r,a),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.previousTimestampS=n,this.outQ},eu.prototype.getPosition=function(){return null},eu.prototype.getOrientation=function(){var e=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||(i=new J().setFromAxisAngle(new Y(0,0,-1),0),n=new J,-90===window.orientation?n.setFromAxisAngle(new Y(0,1,0),-(Math.PI/2)):n.setFromAxisAngle(new Y(0,1,0),Math.PI/2),i.multiply(n)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||((r=new J).setFromAxisAngle(new Y(1,0,0),-Math.PI/2),r),e=this._deviceOrientationQ;var i,n,r,s=new J;return s.copy(e),s.multiply(this.deviceOrientationFilterToWorldQ),s.multiply(this.resetQ),s.multiply(this.worldToScreenQ),s.multiplyQuaternions(this.deviceOrientationFixQ,s),this.yawOnly&&(s.x=0,s.z=0,s.normalize()),this.orientationOut_[0]=s.x,this.orientationOut_[1]=s.y,this.orientationOut_[2]=s.z,this.orientationOut_[3]=s.w,this.orientationOut_}var a=this.filter.getOrientation();e=this.posePredictor.getPrediction(a,this.gyroscope,this.previousTimestampS);var s=new J;return s.copy(this.filterToWorldQ),s.multiply(this.resetQ),s.multiply(e),s.multiply(this.worldToScreenQ),this.yawOnly&&(s.x=0,s.z=0,s.normalize()),this.orientationOut_[0]=s.x,this.orientationOut_[1]=s.y,this.orientationOut_[2]=s.z,this.orientationOut_[3]=s.w,this.orientationOut_},eu.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),S()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},eu.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new J;var i=e.alpha,n=e.beta,r=e.gamma;i=(i||0)*Math.PI/180,n=(n||0)*Math.PI/180,r=(r||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(n,i,-r)},eu.prototype.onDeviceMotion_=function(e){this.updateDeviceMotion_(e)},eu.prototype.updateDeviceMotion_=function(e){var i=e.accelerationIncludingGravity,n=e.rotationRate,r=e.timeStamp/1e3,s=r-this.previousTimestampS;if(s<0){G("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=r;return}if(s<=.001||s>1){G("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=r;return}this.accelerometer.set(-i.x,-i.y,-i.z),n&&(C()?this.gyroscope.set(-n.beta,n.alpha,n.gamma):this.gyroscope.set(n.alpha,n.beta,n.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,r)),this.filter.addAccelMeasurement(this.accelerometer,r),this.previousTimestampS=r},eu.prototype.onOrientationChange_=function(e){this.setScreenTransform_()},eu.prototype.onMessage_=function(e){var i=e.data;i&&i.type&&"devicemotion"===i.type.toLowerCase()&&this.updateDeviceMotion_(i.deviceMotionEvent)},eu.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Y(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new Y(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},eu.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),y()&&F()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},eu.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var ec=new Y(1,0,0),ed=new Y(0,0,1),ep=new J;ep.setFromAxisAngle(ec,-Math.PI/2),ep.multiply(new J().setFromAxisAngle(ed,Math.PI/2));var ef=function(){function e(i){m(this,e),this.config=i,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new J,this._outQ=new J,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return g(e,[{key:"init",value:function(){var e=null;try{(e=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(e){this.errors.push(e),"SecurityError"===e.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===e.name?this.useDeviceMotion():console.error(e)}e&&(this.api="sensor",this.sensor=e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new eu(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var e=this.sensor.quaternion;this._sensorQ.set(e[0],e[1],e[2],e[3]);var i=this._outQ;return i.copy(ep),i.multiply(this._sensorQ),this.config.YAW_ONLY&&(i.x=i.z=0,i.normalize()),this._out[0]=i.x,this._out[1]=i.y,this._out[2]=i.z,this._out[3]=i.w,this._out}},{key:"_onSensorError",value:function(e){this.errors.push(e.error),"NotAllowedError"===e.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===e.error.name?console.error("Sensor could not be read"):console.error(e.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),e}();function em(){this.loadIcon_();var e=document.createElement("div"),i=e.style;i.position="fixed",i.top=0,i.right=0,i.bottom=0,i.left=0,i.backgroundColor="gray",i.fontFamily="sans-serif",i.zIndex=1e6;var n=document.createElement("img");n.src=this.icon;var i=n.style;i.marginLeft="25%",i.marginTop="25%",i.width="50%",e.appendChild(n);var r=document.createElement("div"),i=r.style;i.textAlign="center",i.fontSize="16px",i.lineHeight="24px",i.margin="24px 25%",i.width="50%",r.innerHTML="Place your phone into your Cardboard viewer.",e.appendChild(r);var s=document.createElement("div"),i=s.style;i.backgroundColor="#CFD8DC",i.position="fixed",i.bottom=0,i.width="100%",i.height="48px",i.padding="14px 24px",i.boxSizing="border-box",i.color="#656A6B",e.appendChild(s);var a=document.createElement("div");a.style.float="left",a.innerHTML="No Cardboard viewer?";var o=document.createElement("a");o.href="https://www.google.com/get/cardboard/get-cardboard/",o.innerHTML="get one",o.target="_blank";var i=o.style;i.float="right",i.fontWeight=600,i.textTransform="uppercase",i.borderLeft="1px solid gray",i.paddingLeft="24px",i.textDecoration="none",i.color="#656A6B",s.appendChild(a),s.appendChild(o),this.overlay=e,this.text=r,this.hide()}em.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var i=this.overlay.querySelector("img").style;S()?(i.width="20%",i.marginLeft="40%",i.marginTop="3%"):(i.width="50%",i.marginLeft="25%",i.marginTop="25%")},em.prototype.hide=function(){this.overlay.style.display="none"},em.prototype.showTemporarily=function(e,i){this.show(i),this.timer=setTimeout(this.hide.bind(this),e)},em.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},em.prototype.update=function(){this.disableShowTemporarily(),!S()&&N()?this.show():this.hide()},em.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};var eg="WEBVR_CARDBOARD_VIEWER";function eA(e){try{this.selectedKey=localStorage.getItem(eg)}catch(e){console.error("Failed to load viewer profile: %s",e)}this.selectedKey||(this.selectedKey=e||"CardboardV1"),this.dialog=this.createDialog_(ei.Viewers),this.root=null,this.onChangeCallbacks_=[]}eA.prototype.show=function(e){this.root=e,e.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},eA.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},eA.prototype.getCurrentViewer=function(){return ei.Viewers[this.selectedKey]},eA.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector("input[name=field]:checked");return e?e.id:null},eA.prototype.onChange=function(e){this.onChangeCallbacks_.push(e)},eA.prototype.fireOnChange_=function(e){for(var i=0;i<this.onChangeCallbacks_.length;i++)this.onChangeCallbacks_[i](e)},eA.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!ei.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(ei.Viewers[this.selectedKey]);try{localStorage.setItem(eg,this.selectedKey)}catch(e){console.error("Failed to save viewer profile: %s",e)}this.hide()},eA.prototype.createDialog_=function(e){var i=document.createElement("div");i.classList.add("webvr-polyfill-viewer-selector"),i.style.display="none";var n=document.createElement("div"),r=n.style;r.position="fixed",r.left=0,r.top=0,r.width="100%",r.height="100%",r.background="rgba(0, 0, 0, 0.3)",n.addEventListener("click",this.hide.bind(this));var s=document.createElement("div"),r=s.style;for(var a in r.boxSizing="border-box",r.position="fixed",r.top="24px",r.left="50%",r.marginLeft="-140px",r.width="280px",r.padding="24px",r.overflow="hidden",r.background="#fafafa",r.fontFamily="'Roboto', sans-serif",r.boxShadow="0px 5px 20px #666",s.appendChild(this.createH1_("Select your viewer")),e)s.appendChild(this.createChoice_(a,e[a].label));return s.appendChild(this.createButton_("Save",this.onSave_.bind(this))),i.appendChild(n),i.appendChild(s),i},eA.prototype.createH1_=function(e){var i=document.createElement("h1"),n=i.style;return n.color="black",n.fontSize="20px",n.fontWeight="bold",n.marginTop=0,n.marginBottom="24px",i.innerHTML=e,i},eA.prototype.createChoice_=function(e,i){var n=document.createElement("div");n.style.marginTop="8px",n.style.color="black";var r=document.createElement("input");r.style.fontSize="30px",r.setAttribute("id",e),r.setAttribute("type","radio"),r.setAttribute("value",e),r.setAttribute("name","field");var s=document.createElement("label");return s.style.marginLeft="4px",s.setAttribute("for",e),s.innerHTML=i,n.appendChild(r),n.appendChild(s),n},eA.prototype.createButton_=function(e,i){var n=document.createElement("button");n.innerHTML=e;var r=n.style;return r.float="right",r.textTransform="uppercase",r.color="#1094f7",r.fontSize="14px",r.letterSpacing=0,r.border=0,r.background="none",r.marginTop="16px",n.addEventListener("click",i),n},"undefined"!=typeof window?window:void 0!==r||"undefined"!=typeof self&&self;var ev=(function(e,i){var n;n=function(){return function(e){var i={};function n(r){if(i[r])return i[r].exports;var s=i[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=i,n.d=function(e,i,r){n.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(i,"a",i),i},n.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},n.p="",n(n.s=0)}([function(e,i,n){var r=function(){function e(e,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(i,n,r){return n&&e(i.prototype,n),r&&e(i,r),i}}(),s=n(1),a="undefined"!=typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream,o=function(){function e(){(function(e,i){if(!(e instanceof i))throw TypeError("Cannot call a class as a function")})(this,e),a?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",s),this.noSleepVideo.addEventListener("timeupdate",(function(e){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}).bind(this)))}return r(e,[{key:"enable",value:function(){a?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){a?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),e}();e.exports=o},function(e,i,n){e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])},e.exports=n()}(p={exports:{}},p.exports),(f=p.exports)&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default"))?f.default:f,ey=1e3,ex=[0,0,.5,1],e_=[.5,0,.5,1],eb=window.requestAnimationFrame,eE=window.cancelAnimationFrame;function ew(e){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:e.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:e.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:e.canPresent},maxLayers:{writable:!1,enumerable:!0,value:e.maxLayers},hasOrientation:{enumerable:!0,get:function(){return V("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),e.hasOrientation}}})}function eM(e){var i=!("wakelock"in(e=e||{}))||e.wakelock;this.isPolyfilled=!0,this.displayId=ey++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return V("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new ew({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,i&&N()&&(this.wakelock_=new ev)}eM.prototype.getFrameData=function(e){return k(e,this._getPose(),this)},eM.prototype.getPose=function(){return V("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},eM.prototype.resetPose=function(){return V("VRDisplay.prototype.resetPose"),this._resetPose()},eM.prototype.getImmediatePose=function(){return V("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},eM.prototype.requestAnimationFrame=function(e){return eb(e)},eM.prototype.cancelAnimationFrame=function(e){return eE(e)},eM.prototype.wrapForFullscreen=function(e){if(y())return e;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var i=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",i.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==e)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=e,this.originalParent_=e.parentElement,this.originalParent_||document.body.appendChild(e),!this.fullscreenWrapper_.parentElement){var n=this.fullscreenElement_.parentElement;n.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),n.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var r=this;return function(){if(r.fullscreenElement_){var e=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];r.fullscreenElement_.setAttribute("style",e.join("; ")+";")}}(),this.fullscreenWrapper_},eM.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElementCachedStyle_?e.setAttribute("style",this.fullscreenElementCachedStyle_):e.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var i=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),this.originalParent_===i?i.insertBefore(e,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(e),i.removeChild(this.fullscreenWrapper_),e}},eM.prototype.requestPresent=function(e){var i=this.isPresenting,n=this;return e instanceof Array||(V("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),e=[e]),new Promise(function(r,s){if(!n.capabilities.canPresent){s(Error("VRDisplay is not capable of presenting."));return}if(0==e.length||e.length>n.capabilities.maxLayers){s(Error("Invalid number of layers."));return}var a=e[0];if(!a.source){r();return}var o=a.leftBounds||ex,l=a.rightBounds||e_;if(i){var h=n.layer_;h.source!==a.source&&(h.source=a.source);for(var u=0;u<4;u++)h.leftBounds[u]=o[u],h.rightBounds[u]=l[u];n.wrapForFullscreen(n.layer_.source),n.updatePresent_(),r();return}if(n.layer_={predistorted:a.predistorted,source:a.source,leftBounds:o.slice(0),rightBounds:l.slice(0)},n.waitingForPresent_=!1,n.layer_&&n.layer_.source){var c=n.wrapForFullscreen(n.layer_.source);n.addFullscreenListeners_(c,function(){var e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;n.isPresenting=c===e,n.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(e){console.error("screen.orientation.lock() failed due to",e.message)}),n.waitingForPresent_=!1,n.beginPresent_(),r()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),n.removeFullscreenWrapper(),n.disableWakeLock(),n.endPresent_(),n.removeFullscreenListeners_()),n.fireVRDisplayPresentChange_()},function(){n.waitingForPresent_&&(n.removeFullscreenWrapper(),n.removeFullscreenListeners_(),n.disableWakeLock(),n.waitingForPresent_=!1,n.isPresenting=!1,s(Error("Unable to present.")))}),I(c)?(n.enableWakeLock(),n.waitingForPresent_=!0):(y()||x())&&(n.enableWakeLock(),n.isPresenting=!0,n.beginPresent_(),n.fireVRDisplayPresentChange_(),r())}n.waitingForPresent_||y()||(B(),s(Error("Unable to present.")))})},eM.prototype.exitPresent=function(){var e=this.isPresenting,i=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(n,r){e?(!B()&&y()&&(i.endPresent_(),i.fireVRDisplayPresentChange_()),x()&&(i.removeFullscreenWrapper(),i.removeFullscreenListeners_(),i.endPresent_(),i.fireVRDisplayPresentChange_()),n()):r(Error("Was not presenting to VRDisplay."))})},eM.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},eM.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(e)},eM.prototype.fireVRDisplayConnect_=function(){var e=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(e)},eM.prototype.addFullscreenListeners_=function(e,i,n){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=i,this.fullscreenErrorHandler_=n,i&&(document.fullscreenEnabled?e.addEventListener("fullscreenchange",i,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenchange",i,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",i,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenchange",i,!1)),n&&(document.fullscreenEnabled?e.addEventListener("fullscreenerror",n,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenerror",n,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",n,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenerror",n,!1))},eM.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var i=this.fullscreenChangeHandler_;e.removeEventListener("fullscreenchange",i,!1),e.removeEventListener("webkitfullscreenchange",i,!1),document.removeEventListener("mozfullscreenchange",i,!1),e.removeEventListener("msfullscreenchange",i,!1)}if(this.fullscreenErrorHandler_){var n=this.fullscreenErrorHandler_;e.removeEventListener("fullscreenerror",n,!1),e.removeEventListener("webkitfullscreenerror",n,!1),document.removeEventListener("mozfullscreenerror",n,!1),e.removeEventListener("msfullscreenerror",n,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},eM.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},eM.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},eM.prototype.beginPresent_=function(){},eM.prototype.endPresent_=function(){},eM.prototype.submitFrame=function(e){},eM.prototype.getEyeParameters=function(e){return null};var eC={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},eS={LEFT:"left",RIGHT:"right"};function eT(e){var i=O({},eC);e=O(i,e||{}),eM.call(this,{wakelock:e.MOBILE_WAKE_LOCK}),this.config=e,this.displayName="Cardboard VRDisplay",this.capabilities=new ew({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new ef(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new es(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new ei(this.dpdb_.getDeviceParams(),e.ADDITIONAL_VIEWERS),this.viewerSelector_=new eA(e.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new em),y()&&window.addEventListener("resize",this.onResize_.bind(this))}return eT.prototype=Object.create(eM.prototype),eT.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},eT.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},eT.prototype._getFieldOfView=function(e){var i;if(e==eS.LEFT)i=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=eS.RIGHT)return console.error("Invalid eye provided: %s",e),null;i=this.deviceInfo_.getFieldOfViewRightEye()}return i},eT.prototype._getEyeOffset=function(e){var i;if(e==eS.LEFT)i=[-(.5*this.deviceInfo_.viewer.interLensDistance),0,0];else{if(e!=eS.RIGHT)return console.error("Invalid eye provided: %s",e),null;i=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return i},eT.prototype.getEyeParameters=function(e){var i=this._getEyeOffset(e),n=this._getFieldOfView(e),r={offset:i,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(r,"fieldOfView",{enumerable:!0,get:function(){return V("VRFieldOfView","VRFrameData's projection matrices"),n}}),r},eT.prototype.onDeviceParamsUpdated_=function(e){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},eT.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},eT.prototype.beginPresent_=function(){var e=this.layer_.source.getContext("webgl");e||(e=this.layer_.source.getContext("experimental-webgl")),e||(e=this.layer_.source.getContext("webgl2")),e&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(e.canvas.width=T()*this.bufferScale_,e.canvas.height=R()*this.bufferScale_,this.cardboardUI_=new W(e)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new W(e)),this.distorter_=new H(e,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen((function(e){this.viewerSelector_.show(this.layer_.source.parentElement),e.stopPropagation(),e.preventDefault()}).bind(this),(function(e){this.exitPresent(),e.stopPropagation(),e.preventDefault()}).bind(this)),this.rotateInstructions_&&(S()&&N()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},eT.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},eT.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},eT.prototype.submitFrame=function(e){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var i=this.layer_.source.getContext("webgl");i||(i=this.layer_.source.getContext("experimental-webgl")),i||(i=this.layer_.source.getContext("webgl2"));var n=i.canvas;(n.width!=this.lastWidth||n.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=n.width,this.lastHeight=n.height,this.cardboardUI_.render()}},eT.prototype.onOrientationChange_=function(e){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},eT.prototype.onResize_=function(e){if(this.layer_){var i=this.layer_.source.getContext("webgl");i||(i=this.layer_.source.getContext("experimental-webgl")),i||(i=this.layer_.source.getContext("webgl2")),i.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;"),U(i.canvas)}},eT.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},eT.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},eT.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},eT.VRDisplay=eM,eT},e.exports=n()}(e={exports:{}},e.exports),(i=e.exports)&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default"))?i.default:i,h={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function u(e){this.config=o(o({},h),e),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&s())&&(this.enable(),this.getVRDisplays().then(function(e){e&&e[0]&&e[0].fireVRDisplayConnect_&&e[0].fireVRDisplayConnect_()}))}u.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(s()){var e=new l({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(e)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},u.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var e=this.native.VRFrameData,i=new this.native.VRFrameData,n=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(r){if(r instanceof e){n.call(this,r);return}n.call(this,i),r.pose=i.pose,a(i.leftProjectionMatrix,r.leftProjectionMatrix),a(i.rightProjectionMatrix,r.rightProjectionMatrix),a(i.leftViewMatrix,r.leftViewMatrix),a(i.rightViewMatrix,r.rightViewMatrix)}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=l.VRDisplay,window.VRFrameData=l.VRFrameData},u.prototype.getVRDisplays=function(){var e=this;return(this.config,this.hasNative)?this.native.getVRDisplays.call(navigator).then(function(i){return i.length>0?i:e.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},u.version="0.10.12",u.VRFrameData=l.VRFrameData,u.VRDisplay=l.VRDisplay;var c=Object.freeze({default:u}),d=c&&u||c;return void 0!==r&&r.window&&(r.document||(r.document=r.window.document),r.navigator||(r.navigator=r.window.navigator)),d},e.exports=r()},"./node_modules/word-wrapper/index.js":e=>{var i=/\n/,n=/\s/;function r(e){return n.test(e)}function s(e,i,n,r){var s=Math.min(r,n-i);return{start:i,end:i+s}}e.exports=function(i,n){return e.exports.lines(i,n).map(function(e){return i.substring(e.start,e.end)}).join("\n")},e.exports.lines=function(e,n){if(0===(n=n||{}).width&&"nowrap"!==n.mode)return[];e=e||"";var a="number"==typeof n.width?n.width:Number.MAX_VALUE,o=Math.max(0,n.start||0),l="number"==typeof n.end?n.end:e.length,h=n.mode,u=n.measure||s;return"pre"===h?function(e,n,r,s,a){for(var o=[],l=r,h=r;h<s&&h<n.length;h++){var u=n.charAt(h),c=i.test(u);if(c||h===s-1){var d=e(n,l,c?h:h+1,a);o.push(d),l=h+1}}return o}(u,e,o,l,a):function(e,i,n,s,a,o){var l=[],h=a;for("nowrap"===o&&(h=Number.MAX_VALUE);n<s&&n<i.length;){for(var u=function(e,i,n,r){var s=e.indexOf("\n",n);return -1===s||s>r?r:s}(i,0,n,s);n<u&&r(i.charAt(n));)n++;var c=e(i,n,u,h),d=n+(c.end-c.start),p=d+1;if(d<u){for(;d>n&&!r(i.charAt(d));)d--;if(d===n)p>n+1&&p--,d=p;else for(p=d;d>n&&r(i.charAt(d-1));)d--}if(d>=n){var f=e(i,n,d,h);l.push(f)}n=p}return l}(u,e,o,l,a,h)}},"./node_modules/xhr/index.js":(e,i,n)=>{"use strict";var r=n("./node_modules/global/window.js"),s=n("./node_modules/is-function/index.js"),a=n("./node_modules/parse-headers/parse-headers.js"),o=n("./node_modules/xtend/immutable.js");function l(e,i,n){var r=e;return s(i)?(n=i,"string"==typeof e&&(r={uri:e})):r=o(i,{uri:e}),r.callback=n,r}function h(e,i,n){return u(i=l(e,i,n))}function u(e){if(void 0===e.callback)throw Error("callback argument missing");var i,n,r,s=!1,o=function(i,n,r){s||(s=!0,e.callback(i,n,r))};function l(e){return clearTimeout(r),e instanceof Error||(e=Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,o(e,v)}function u(){if(!n){clearTimeout(r);var i,s=v,l=null;return 0!==(i=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status)?(s={body:function(){var e=void 0;if(e=c.response?c.response:c.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var i=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!i)return e.responseXML}catch(e){}return null}(c),A)try{e=JSON.parse(e)}catch(e){}return e}(),statusCode:i,method:p,headers:{},url:d,rawRequest:c},c.getAllResponseHeaders&&(s.headers=a(c.getAllResponseHeaders()))):l=Error("Internal XMLHttpRequest Error"),o(l,s,s.body)}}var c=e.xhr||null;c||(c=e.cors||e.useXDR?new h.XDomainRequest:new h.XMLHttpRequest);var d=c.url=e.uri||e.url,p=c.method=e.method||"GET",f=e.body||e.data,m=c.headers=e.headers||{},g=!!e.sync,A=!1,v={body:void 0,headers:{},statusCode:0,method:p,url:d,rawRequest:c};if("json"in e&&!1!==e.json&&(A=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(u,0)},c.onload=u,c.onerror=l,c.onprogress=function(){},c.onabort=function(){n=!0},c.ontimeout=l,c.open(p,d,!g,e.username,e.password),g||(c.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(r=setTimeout(function(){if(!n){n=!0,c.abort("timeout");var e=Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",l(e)}},e.timeout)),c.setRequestHeader)for(i in m)m.hasOwnProperty(i)&&c.setRequestHeader(i,m[i]);else if(e.headers&&!function(e){for(var i in e)if(e.hasOwnProperty(i))return!1;return!0}(e.headers))throw Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(f||null),c}e.exports=h,e.exports.default=h,h.XMLHttpRequest=r.XMLHttpRequest||function(){},h.XDomainRequest="withCredentials"in new h.XMLHttpRequest?h.XMLHttpRequest:r.XDomainRequest,function(e,i){for(var n=0;n<e.length;n++)i(e[n])}(["get","put","post","patch","head","delete"],function(e){h["delete"===e?"del":e]=function(i,n,r){return(n=l(i,n,r)).method=e.toUpperCase(),u(n)}})},"./node_modules/xml-parse-from-string/index.js":e=>{e.exports=void 0!==self.DOMParser?function(e){return new self.DOMParser().parseFromString(e,"application/xml")}:void 0!==self.ActiveXObject&&new self.ActiveXObject("Microsoft.XMLDOM")?function(e){var i=new self.ActiveXObject("Microsoft.XMLDOM");return i.async="false",i.loadXML(e),i}:function(e){var i=document.createElement("div");return i.innerHTML=e,i}},"./node_modules/xtend/immutable.js":e=>{e.exports=function(){for(var e={},n=0;n<arguments.length;n++){var r=arguments[n];for(var s in r)i.call(r,s)&&(e[s]=r[s])}return e};var i=Object.prototype.hasOwnProperty},"./src/components/anchored.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/index.js").debug("components:anchored:warn");e.exports.Component=r("anchored",{schema:{persistent:{default:!1}},init:function(){var e=this.el.sceneEl.getAttribute("webxr"),i=e.optionalFeatures;-1===i.indexOf("anchors")&&(i.push("anchors"),this.el.sceneEl.setAttribute("webxr",e)),this.auxQuaternion=new THREE.Quaternion,this.onEnterVR=this.onEnterVR.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR)},onEnterVR:function(){this.anchor=void 0,this.requestPersistentAnchorPending=this.data.persistent,this.requestAnchorPending=!this.data.persistent},tick:function(){var e,i,n,r=this.el.sceneEl,s=r.renderer.xr,a=this.el.object3D;if(r.is("ar-mode")||r.is("vr-mode"))!this.anchor&&this.requestPersistentAnchorPending&&this.restorePersistentAnchor(),!this.anchor&&this.requestAnchorPending&&this.createAnchor(),this.anchor&&(e=r.frame,i=s.getReferenceSpace(),n=e.getPose(this.anchor.anchorSpace,i),a.matrix.elements=n.transform.matrix,a.matrix.decompose(a.position,a.rotation,a.scale))},createAnchor:async function(e,i){var n,r,a,o,l,h=this.el.sceneEl,u=h.renderer.xr,c=this.el.object3D;if(e=e||c.position,i=i||this.auxQuaternion.setFromEuler(c.rotation),!((n=h.renderer.xr.getSession())&&n.restorePersistentAnchor)){s("This browser doesn't support the WebXR anchors module");return}this.anchor&&this.deleteAnchor(),r=h.frame,a=u.getReferenceSpace(),o=new XRRigidTransform({x:e.x,y:e.y,z:e.z},{x:i.x,y:i.y,z:i.z,w:i.w}),this.requestAnchorPending=!1,l=await r.createAnchor(o,a),this.data.persistent&&(this.el.id?(this.persistentHandle=await l.requestPersistentHandle(),localStorage.setItem(this.el.id,this.persistentHandle)):s("The anchor won't be persisted because the entity has no assigned id.")),h.object3D.attach(this.el.object3D),this.anchor=l},restorePersistentAnchor:async function(){var e,i=this.el.sceneEl.renderer.xr.getSession(),n=i.persistentAnchors;if(this.requestPersistentAnchorPending=!1,!this.el.id){s("The entity associated to the persistent anchor cannot be retrieved because it doesn't have an assigned id."),this.requestAnchorPending=!0;return}if(n){e=localStorage.getItem(this.el.id);for(var r=0;r<n.length;++r)if(e===n[r]){this.anchor=await i.restorePersistentAnchor(n[r]),this.anchor&&(this.persistentHandle=n[r]);break}this.anchor||(this.requestAnchorPending=!0)}else this.requestPersistentAnchorPending=!0},deleteAnchor:function(){var e,i=this.anchor;i&&(e=this.el.sceneEl.renderer.xr.getSession(),i.delete(),this.el.sceneEl.object3D.add(this.el.object3D),this.persistentHandle&&e.deletePersistentAnchor(this.persistentHandle),this.anchor=void 0)}})},"./src/components/animation.js":(e,i,n)=>{var r=n("./node_modules/super-animejs/lib/anime.es.js").default,s=n("./src/core/component.js").components,a=n("./src/core/component.js").registerComponent,o=n("./src/lib/three.js"),l=n("./src/utils/index.js"),h=new o.Color,u=new o.Color,c=l.entity.getComponentProperty,d=l.entity.setComponentProperty,p={},f="color",m="rotation",g="components";function A(e){e.x=o.MathUtils.degToRad(e.x),e.y=o.MathUtils.degToRad(e.y),e.z=o.MathUtils.degToRad(e.z)}function v(e,i,n){var r;for(r=0;r<i.length;r++)e.addEventListener(i[r],n)}function y(e,i,n){var r;for(r=0;r<i.length;r++)e.removeEventListener(i[r],n)}function x(e,i){var n,r,s;for(n=0,r=b(i),s=e;n<r.length;n++)s=s[r[n]];if(void 0===s)throw console.log(e),Error("[animation] property ("+i+") could not be found");return s}function _(e,i,n,r){var s,a,l,h;for(i.startsWith("object3D.rotation")&&(n=o.MathUtils.degToRad(n)),a=b(i),h=e,s=0;s<a.length-1;s++)h=h[a[s]];if(l=a[a.length-1],r===f){"r"in h[l]?(h[l].r=n.r,h[l].g=n.g,h[l].b=n.b):(h[l].x=n.r,h[l].y=n.g,h[l].z=n.b);return}h[l]=n}function b(e){return e in p||(p[e]=e.split(".")),p[e]}function E(e){return e.isRawProperty||e.property.startsWith(g)||e.property.startsWith("object3D")}e.exports.Component=a("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&parseInt(e,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var e=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){e.animationIsPlaying=!1,e.el.emit("animationcomplete",e.eventDetail,!1),e.id&&e.el.emit("animationcomplete__"+e.id,e.eventDetail,!1)}}},update:function(e){var i=this.config,n=this.data;this.animationIsPlaying=!1,this.data.enabled&&n.property&&(i.autoplay=!1,i.direction=n.dir,i.duration=n.dur,i.easing=n.easing,i.elasticity=n.elasticity,i.loop=n.loop,i.round=n.round,this.createAndStartAnimation())},tick:function(e,i){this.animationIsPlaying&&(this.time+=i,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var e=this.data;if(this.updateConfig(),this.animationIsPlaying=!1,this.animation=r(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),e.autoplay&&(!e.startEvents||!e.startEvents.length)){if(e.delay){setTimeout(this.beginAnimation,e.delay);return}this.beginAnimation()}},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){if(this.data.enabled){if(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=r(this.config),this.data.delay){setTimeout(this.beginAnimation,this.data.delay);return}this.beginAnimation()}},updateConfigForRawColor:function(){var e,i,n,r,s=this.config,a=this.data,o=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(n in i=""===a.from?x(o,a.property):a.from,r=a.to,this.setColorConfig(i,r),i=this.fromColor,r=this.toColor,this.targetsArray.length=0,this.targetsArray.push(i),s.targets=this.targetsArray,r)s[n]=r[n];s.update=(e={},function(i){var n;((n=i.animatables[0].target).r!==e.r||n.g!==e.g||n.b!==e.b)&&_(o,a.property,n,a.type)})}},updateConfigForDefault:function(){var e,i,n,r,s=this.config,a=this.data,o=this.el;!this.waitComponentInitRawProperty(this.updateConfigForDefault)&&(i=""===a.from?E(a)?x(o,a.property):c(o,a.property):a.from,r=a.to,isNaN(i||r)?(i=i?i.toString():i,r=r?r.toString():r):(i=parseFloat(i),r=parseFloat(r)),(n="true"===a.to||"false"===a.to||!0===a.to||!1===a.to)&&(i=+("true"===a.from||!0===a.from),r=+("true"===a.to||!0===a.to)),this.targets.aframeProperty=i,s.targets=this.targets,s.aframeProperty=r,s.update=function(i){var r;(r=i.animatables[0].target.aframeProperty)!==e&&(e=r,n&&(r=r>=1),E(a)?_(o,a.property,r,a.type):d(o,a.property,r))})},updateConfigForVector:function(){var e,i,n,r,s,a=this.config,o=this.data,h=this.el;for(n in r=""!==o.from?l.coordinates.parse(o.from):c(h,o.property),s=l.coordinates.parse(o.to),o.property===m&&(A(r),A(s)),this.targetsArray.length=0,this.targetsArray.push(r),a.targets=this.targetsArray,s)a[n]=s[n];if("position"===o.property||o.property===m||"scale"===o.property){a.update=(e={},function(i){var n=i.animatables[0].target;(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(e.x=n.x,e.y=n.y,e.z=n.z,h.object3D[o.property].set(n.x,n.y,n.z))});return}a.update=(i={},function(e){var n=e.animatables[0].target;(n.x!==i.x||n.y!==i.y||n.z!==i.z)&&(i.x=n.x,i.y=n.y,i.z=n.z,d(h,o.property,n))})},updateConfig:function(){var e,i,n,r,a,o;i=this.el,r=(a=this.data.property.split("."))[0],o=a[1],e=(n=i.components[r]||s[r])&&(!o||n.schema[o])?o?n.schema[o].type:n.schema.type:null,E(this.data)&&this.data.type===f?this.updateConfigForRawColor():"vec2"===e||"vec3"===e||"vec4"===e?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(e){var i,n=this.data,s=this.el,a=this;return!!(""===n.from&&n.property.startsWith(g))&&(i=b(n.property)[1],!s.components[i]&&(s.addEventListener("componentinitialized",function n(o){o.detail.name===i&&(e(),a.animation=r(a.config),s.removeEventListener("componentinitialized",n))}),!0))},stopRelatedAnimations:function(){var e,i;for(i in this.el.components)e=this.el.components[i],i!==this.attrName&&"animation"===e.name&&e.animationIsPlaying&&e.data.property===this.data.property&&(e.animationIsPlaying=!1)},addEventListeners:function(){var e=this.data,i=this.el;v(i,e.startEvents,this.onStartEvent),v(i,e.pauseEvents,this.pauseAnimation),v(i,e.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var e=this.data,i=this.el;y(i,e.startEvents,this.onStartEvent),y(i,e.pauseEvents,this.pauseAnimation),y(i,e.resumeEvents,this.resumeAnimation)},setColorConfig:function(e,i){h.set(e),u.set(i),e=this.fromColor,i=this.toColor,e.r=h.r,e.g=h.g,e.b=h.b,i.r=u.r,i.g=u.g,i.b=u.b}})},"./src/components/camera.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js");e.exports.Component=r("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var e,i=this.el;e=this.camera=new s.PerspectiveCamera,i.setObject3D("camera",e)},update:function(e){var i=this.data,n=this.camera;n.aspect=i.aspect||window.innerWidth/window.innerHeight,n.far=i.far,n.fov=i.fov,n.near=i.near,n.zoom=i.zoom,n.updateProjectionMatrix(),this.updateActiveCamera(e),this.updateSpectatorCamera(e)},updateActiveCamera:function(e){var i=this.data,n=this.el,r=this.system;(!e||e.active!==i.active)&&!i.spectator&&(i.active&&r.activeCameraEl!==n?r.setActiveCamera(n):i.active||r.activeCameraEl!==n||r.disableActiveCamera())},updateSpectatorCamera:function(e){var i=this.data,n=this.el,r=this.system;(!e||e.spectator!==i.spectator)&&(i.spectator&&r.spectatorCameraEl!==n?r.setSpectatorCamera(n):i.spectator||r.spectatorCameraEl!==n||r.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}})},"./src/components/cursor.js":(e,i,n)=>{var r,s,a,o,l=n("./src/core/component.js").registerComponent,h=n("./src/utils/index.js"),u={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"},c={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"},d={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},p=["selectstart"],f=["selectend"],m="a-mouse-cursor-hover";e.exports.Component=l("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:h.device.isMobile()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity","xrselect"]}},after:["tracked-controls"],multiple:!0,init:function(){var e=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.activeXRInput=null,this.updateCanvasBounds=h.debounce(function(){e.canvasBounds=e.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=this.onCursorDown.bind(this),this.onCursorUp=this.onCursorUp.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},update:function(e){this.data.rayOrigin!==e.rayOrigin&&this.updateMouseEventListeners()},tick:function(){var e=this.el.sceneEl.frame,i=this.activeXRInput;"xrselect"===this.data.rayOrigin&&e&&i&&this.onMouseMove({frame:e,inputSource:i,type:"fakeselectevent"})},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var e=this.el;e.removeState(c.HOVERING),e.removeState(c.FUSING),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(c.HOVERED),this.removeEventListeners()},addEventListeners:function(){var e,i=this.data,n=this.el,r=this;function s(){e=n.sceneEl.canvas,!i.downEvents.length&&!i.upEvents.length&&(d.DOWN.forEach(function(i){e.addEventListener(i,r.onCursorDown,{passive:!1})}),d.UP.forEach(function(i){e.addEventListener(i,r.onCursorUp,{passive:!1})}))}(e=n.sceneEl.canvas)?s():n.sceneEl.addEventListener("render-target-loaded",s),i.downEvents.forEach(function(e){n.addEventListener(e,r.onCursorDown)}),i.upEvents.forEach(function(e){n.addEventListener(e,r.onCursorUp)}),n.addEventListener("raycaster-intersection",this.onIntersection),n.addEventListener("raycaster-closest-entity-changed",this.onIntersection),n.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),n.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),n.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var e,i=this.data,n=this.el,r=this;(e=n.sceneEl.canvas)&&!i.downEvents.length&&!i.upEvents.length&&(d.DOWN.forEach(function(i){e.removeEventListener(i,r.onCursorDown)}),d.UP.forEach(function(i){e.removeEventListener(i,r.onCursorUp)})),i.downEvents.forEach(function(e){n.removeEventListener(e,r.onCursorDown)}),i.upEvents.forEach(function(e){n.removeEventListener(e,r.onCursorUp)}),n.removeEventListener("raycaster-intersection",this.onIntersection),n.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("touchstart",this.onMouseMove),e.removeEventListener("touchmove",this.onMouseMove),n.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),n.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds)},updateMouseEventListeners:function(){var e,i=this.el;(e=i.sceneEl.canvas).removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("touchmove",this.onMouseMove),i.setAttribute("raycaster","useWorldCoordinates",!1),"mouse"===this.data.rayOrigin&&(e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("touchmove",this.onMouseMove,{passive:!1}),i.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},onMouseMove:(r=new THREE.Vector3,s=new THREE.Vector2,o={origin:a=new THREE.Vector3,direction:r},function(e){var i,n,l,h,u,c,d,p=this.canvasBounds,f=this.el.sceneEl.camera;f.parent.updateMatrixWorld(),i=(n="touchmove"===e.type||"touchstart"===e.type?e.touches.item(0):e).clientX-p.left,l=n.clientY-p.top,s.x=i/p.width*2-1,s.y=-(2*(l/p.height))+1,"xrselect"===this.data.rayOrigin&&("selectstart"===e.type||"fakeselectevent"===e.type)?(h=e.frame,u=e.inputSource,c=this.el.renderer.xr.getReferenceSpace(),d=h.getPose(u.targetRaySpace,c).transform,r.set(0,0,-1),r.applyQuaternion(d.orientation),a.copy(d.position)):"fakeselectout"===e.type?(r.set(0,1,0),a.set(0,9999,0)):f&&f.isPerspectiveCamera?(a.setFromMatrixPosition(f.matrixWorld),r.set(s.x,s.y,.5).unproject(f).sub(a).normalize()):f&&f.isOrthographicCamera?(a.set(s.x,s.y,(f.near+f.far)/(f.near-f.far)).unproject(f),r.set(0,0,-1).transformDirection(f.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+f.type),this.el.setAttribute("raycaster",o),"touchmove"===e.type&&e.preventDefault()}),onCursorDown:function(e){this.isCursorDown=!0,"mouse"===this.data.rayOrigin&&"touchstart"===e.type&&(this.onMouseMove(e),this.el.components.raycaster.checkIntersections(),e.preventDefault()),"xrselect"===this.data.rayOrigin&&"selectstart"===e.type&&(this.activeXRInput=e.inputSource,this.onMouseMove(e),this.el.components.raycaster.checkIntersections(),this.el.components.raycaster.intersectedEls.length&&void 0!==this.el.sceneEl.components["ar-hit-test"]&&this.el.sceneEl.getAttribute("ar-hit-test").enabled&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!1),this.reenableARHitTest=!0)),this.twoWayEmit(u.MOUSEDOWN,e),this.cursorDownEl=this.intersectedEl},onCursorUp:function(e){if(this.isCursorDown){this.isCursorDown=!1;var i=this.data;this.twoWayEmit(u.MOUSEUP,e),!0===this.reenableARHitTest&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!0),this.reenableARHitTest=void 0),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(u.MOUSEUP,this.intersectedEventDetail)),(!i.fuse||"mouse"===i.rayOrigin||"xrselect"===i.rayOrigin)&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl&&this.twoWayEmit(u.CLICK,e),"xrselect"===i.rayOrigin&&this.activeXRInput===e.inputSource&&this.onMouseMove({type:"fakeselectout"}),this.activeXRInput=null,this.cursorDownEl=null,"touchend"===e.type&&e.preventDefault()}},onIntersection:function(e){var i,n,r,s,a=this.el;n=+(e.detail.els[0]===a),s=e.detail.intersections[n],!(!(r=e.detail.els[n])||this.intersectedEl===r||this.intersectedEl&&(i=this.el.components.raycaster.getIntersection(this.intersectedEl))&&i.distance<=s.distance)&&(this.clearCurrentIntersection(!0),this.setIntersection(r,s))},onIntersectionCleared:function(e){-1!==e.detail.clearedEls.indexOf(this.intersectedEl)&&this.clearCurrentIntersection()},onEnterVR:function(){this.clearCurrentIntersection(!0);var e=this.el.sceneEl.xrSession,i=this;e&&"mouse"!==this.data.rayOrigin&&(p.forEach(function(n){e.addEventListener(n,i.onCursorDown)}),f.forEach(function(n){e.addEventListener(n,i.onCursorUp)}))},setIntersection:function(e,i){var n=this.el,r=this.data,s=this;if(this.intersectedEl!==e)this.intersectedEl=e,n.addState(c.HOVERING),e.addState(c.HOVERED),this.twoWayEmit(u.MOUSEENTER),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.add(m),0!==r.fuseTimeout&&r.fuse&&"xrselect"!==r.rayOrigin&&"mouse"!==r.rayOrigin&&(n.addState(c.FUSING),this.twoWayEmit(u.FUSING),this.fuseTimeout=setTimeout(function(){n.removeState(c.FUSING),s.twoWayEmit(u.CLICK)},r.fuseTimeout))},clearCurrentIntersection:function(e){var i,n,r,s=this.el;if(this.intersectedEl&&(this.intersectedEl.removeState(c.HOVERED),s.removeState(c.HOVERING),s.removeState(c.FUSING),this.twoWayEmit(u.MOUSELEAVE),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.remove(m),this.intersectedEl=null,clearTimeout(this.fuseTimeout),!0!==e&&0!==(r=this.el.components.raycaster.intersections).length))i=+(r[0].object.el===s),(n=r[i])&&this.setIntersection(n.object.el,n)},twoWayEmit:function(e,i){var n,r=this.el,s=this.intersectedEl;function a(e,n){i instanceof MouseEvent?e.mouseEvent=i:"undefined"!=typeof TouchEvent&&i instanceof TouchEvent&&(e.touchEvent=i)}n=this.el.components.raycaster.getIntersection(s),this.eventDetail.intersectedEl=s,this.eventDetail.intersection=n,a(this.eventDetail,i),r.emit(e,this.eventDetail),s&&(this.intersectedEventDetail.intersection=n,a(this.intersectedEventDetail,i),s.emit(e,this.intersectedEventDetail))}})},"./src/components/generic-tracked-controller-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/tracked-controls.js"),a=s.checkControllerPresentAndSetup,o=s.emitIfAxesChanged,l=s.onButtonEvent,h="generic";e.exports.Component=r("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},orientationOffset:{type:"vec3"},disabled:{default:!1}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]},bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){l(i.detail.id,"down",e)},this.onButtonUp=function(i){l(i.detail.id,"up",e)},this.onButtonTouchStart=function(i){l(i.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(i){l(i.detail.id,"touchend",e)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.lastControllerCheck=0,this.bindMethods(),this.el.addEventListener("controllerconnected",function(i){i.detail.name!==e.name&&(e.wasControllerConnected=!0,e.removeEventListeners(),e.removeControllersUpdateListener())})},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;a(this,h,{hand:e.hand?e.hand:void 0,iterateControllerProfiles:!0})},play:function(){!this.wasControllerConnected&&(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,i=this.data;if(this.el.components["tracked-controls"]){this.removeEventListeners();return}e.setAttribute("tracked-controls",{hand:i.hand,idPrefix:h,orientationOffset:i.orientationOffset,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.wasControllerConnected&&this.checkIfControllerPresent()},onButtonChanged:function(e){var i=this.mapping.buttons[e.detail.id];i&&this.el.emit(i+"changed",e.detail.state)},onAxisMoved:function(e){o(this,this.mapping.axes,e)},initDefaultModel:function(){var e=this.modelEl=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"sphere",radius:.03}),e.setAttribute("material",{color:this.data.color}),this.el.appendChild(e),this.el.emit("controllermodelready",{name:"generic-tracked-controller-controls",model:this.modelEl,rayOrigin:{origin:{x:0,y:0,z:-.01},direction:{x:0,y:0,z:-1}}})}})},"./src/components/geometry.js":(e,i,n)=>{var r=n("./src/core/geometry.js").geometries,s=n("./src/core/geometry.js").geometryNames,a=n("./src/core/component.js").registerComponent,o=n("./src/lib/three.js"),l=new o.BufferGeometry;e.exports.Component=a("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:s,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(e){var i,n=this.data,r=this.el,s=this.system;this.geometry&&(s.unuseGeometry(e),this.geometry=null),this.geometry=s.getOrCreateGeometry(n),(i=r.getObject3D("mesh"))?i.geometry=this.geometry:((i=new o.Mesh).geometry=this.geometry,this.el.getAttribute("material")||(i.material=new o.MeshStandardMaterial({color:0xffffff*Math.random(),metalness:0,roughness:.5})),r.setObject3D("mesh",i))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=l,this.geometry=null},updateSchema:function(e){var i=this.oldData&&this.oldData.primitive,n=e.primitive,s=r[n]&&r[n].schema;if(!s)throw Error("Unknown geometry schema `"+n+"`");(!i||i!==n)&&this.extendSchema(s)}})},"./src/components/gltf-model.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js"),a=n("./src/utils/index.js").debug("components:gltf-model:warn");e.exports.Component=r("gltf-model",{schema:{type:"model"},init:function(){var e=this,i=this.system.getDRACOLoader(),n=this.system.getMeshoptDecoder(),r=this.system.getKTX2Loader();this.model=null,this.loader=new s.GLTFLoader,i&&this.loader.setDRACOLoader(i),n?this.ready=n.then(function(i){e.loader.setMeshoptDecoder(i)}):this.ready=Promise.resolve(),r&&this.loader.setKTX2Loader(r)},update:function(){var e=this,i=this.el,n=this.data;n&&(this.remove(),this.ready.then(function(){e.loader.load(n,function(n){e.model=n.scene||n.scenes[0],e.model.animations=n.animations,i.setObject3D("mesh",e.model),i.emit("model-loaded",{format:"gltf",model:e.model})},void 0,function(e){a(e&&e.message?e.message:"Failed to load glTF model"),i.emit("model-error",{format:"gltf",src:n})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},"./src/components/grabbable.js":(e,i,n)=>{(0,n("./src/core/component.js").registerComponent)("grabbable",{init:function(){this.el.setAttribute("obb-collider","centerModel: true")}})},"./src/components/hand-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/constants/index.js").AFRAME_CDN_ROOT,a={toonLeft:s+"controllers/hands/leftHand.glb",toonRight:s+"controllers/hands/rightHand.glb",lowPolyLeft:s+"controllers/hands/leftHandLow.glb",lowPolyRight:s+"controllers/hands/rightHandLow.glb",highPolyLeft:s+"controllers/hands/leftHandHigh.glb",highPolyRight:s+"controllers/hands/rightHandHigh.glb"},o={open:"Open",point:"Point",pointThumb:"Point + Thumb",fist:"Fist",hold:"Hold",thumbUp:"Thumb Up"},l={};function h(e,i){var n;return e?"grip"===(n=l[e])?n+(i?"close":"open"):"point"===n?n+(i?"up":"down"):"pointing"===n||"pistol"===n?n+(i?"start":"end"):void 0:void 0}l[o.fist]="grip",l[o.thumbUp]="pistol",l[o.point]="pointing",e.exports.Component=r("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},after:["tracked-controls"],init:function(){var e=this,i=this.el;this.pressedButtons={},this.touchedButtons={},this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){e.handleButton("grip","down")},this.onGripUp=function(){e.handleButton("grip","up")},this.onTrackpadDown=function(){e.handleButton("trackpad","down")},this.onTrackpadUp=function(){e.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){e.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){e.handleButton("trackpad","touchend")},this.onTriggerDown=function(){e.handleButton("trigger","down")},this.onTriggerUp=function(){e.handleButton("trigger","up")},this.onTriggerTouchStart=function(){e.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){e.handleButton("trigger","touchend")},this.onGripTouchStart=function(){e.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){e.handleButton("grip","touchend")},this.onThumbstickDown=function(){e.handleButton("thumbstick","down")},this.onThumbstickUp=function(){e.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){e.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){e.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){e.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){e.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){e.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){e.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),i.addEventListener("controllerconnected",this.onControllerConnected),i.addEventListener("controllerdisconnected",this.onControllerDisconnected),i.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(e,i){var n=this.el.getObject3D("mesh");n&&n.mixer&&n.mixer.update(i/1e3)},onControllerConnected:function(){this.el.object3D.visible=!0},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var e=this.el;e.addEventListener("gripdown",this.onGripDown),e.addEventListener("gripup",this.onGripUp),e.addEventListener("trackpaddown",this.onTrackpadDown),e.addEventListener("trackpadup",this.onTrackpadUp),e.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),e.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),e.addEventListener("triggerdown",this.onTriggerDown),e.addEventListener("triggerup",this.onTriggerUp),e.addEventListener("triggertouchstart",this.onTriggerTouchStart),e.addEventListener("triggertouchend",this.onTriggerTouchEnd),e.addEventListener("griptouchstart",this.onGripTouchStart),e.addEventListener("griptouchend",this.onGripTouchEnd),e.addEventListener("thumbstickdown",this.onThumbstickDown),e.addEventListener("thumbstickup",this.onThumbstickUp),e.addEventListener("abuttontouchstart",this.onAorXTouchStart),e.addEventListener("abuttontouchend",this.onAorXTouchEnd),e.addEventListener("bbuttontouchstart",this.onBorYTouchStart),e.addEventListener("bbuttontouchend",this.onBorYTouchEnd),e.addEventListener("xbuttontouchstart",this.onAorXTouchStart),e.addEventListener("xbuttontouchend",this.onAorXTouchEnd),e.addEventListener("ybuttontouchstart",this.onBorYTouchStart),e.addEventListener("ybuttontouchend",this.onBorYTouchEnd),e.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),e.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var e=this.el;e.removeEventListener("gripdown",this.onGripDown),e.removeEventListener("gripup",this.onGripUp),e.removeEventListener("trackpaddown",this.onTrackpadDown),e.removeEventListener("trackpadup",this.onTrackpadUp),e.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),e.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),e.removeEventListener("triggerdown",this.onTriggerDown),e.removeEventListener("triggerup",this.onTriggerUp),e.removeEventListener("triggertouchstart",this.onTriggerTouchStart),e.removeEventListener("triggertouchend",this.onTriggerTouchEnd),e.removeEventListener("griptouchstart",this.onGripTouchStart),e.removeEventListener("griptouchend",this.onGripTouchEnd),e.removeEventListener("thumbstickdown",this.onThumbstickDown),e.removeEventListener("thumbstickup",this.onThumbstickUp),e.removeEventListener("abuttontouchstart",this.onAorXTouchStart),e.removeEventListener("abuttontouchend",this.onAorXTouchEnd),e.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),e.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),e.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),e.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),e.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),e.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),e.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),e.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(e){var i,n=this.el,r=this.data.hand,s=this.data.handModelStyle,o=this.data.color,l=this;if(i={hand:r,model:!1},r!==e){var h=a[s+r.charAt(0).toUpperCase()+r.slice(1)];this.loader.load(h,function(e){var s=e.scene.children[0],a="left"===r?Math.PI/2:-Math.PI/2,h=n.sceneEl.hasWebXR?-Math.PI/2:0;s.mixer=new THREE.AnimationMixer(s),l.clips=e.animations,n.setObject3D("mesh",s),s.traverse(function(e){e.isMesh&&(e.material.color=new THREE.Color(o))}),s.position.set(0,0,0),s.rotation.set(h,0,a),n.setAttribute("magicleap-controls",i),n.setAttribute("vive-controls",i),n.setAttribute("oculus-touch-controls",i),n.setAttribute("pico-controls",i),n.setAttribute("windows-motion-controls",i),n.setAttribute("hp-mixed-reality-controls",i)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(e,i){var n,r="down"===i,s="touchstart"===i;if(0===i.indexOf("touch")){if(s===this.touchedButtons[e])return;this.touchedButtons[e]=s}else{if(r===this.pressedButtons[e])return;this.pressedButtons[e]=r}n=this.gesture,this.gesture=this.determineGesture(),this.gesture!==n&&(this.animateGesture(this.gesture,n),this.emitGestureEvents(this.gesture,n))},determineGesture:function(){var e,i,n,r=this.pressedButtons.grip,s=this.pressedButtons.surface||this.touchedButtons.surface,a=this.pressedButtons.trackpad||this.touchedButtons.trackpad,l=this.pressedButtons.trigger||this.touchedButtons.trigger,h=this.touchedButtons.AorX||this.touchedButtons.BorY;return(i=(e=this.el.components["tracked-controls"])&&e.controller)&&(i.id&&0===i.id.indexOf("OpenVR ")||i.profiles&&i.profiles[0]&&"htc-vive"===i.profiles[0])?r||l?n=o.fist:a&&(n=o.point):r?n=s||h||a?l?o.fist:o.point:l?o.thumbUp:o.pointThumb:l&&(n=o.hold),n},getClip:function(e){var i,n;for(n=0;n<this.clips.length;n++)if((i=this.clips[n]).name===e)return i},animateGesture:function(e,i){if(e){this.playAnimation(e||o.open,i,!1);return}this.playAnimation(i,i,!0)},emitGestureEvents:function(e,i){var n,r=this.el;i!==e&&((n=h(i,!1))&&r.emit(n),(n=h(e,!0))&&r.emit(n))},playAnimation:function(e,i,n){var r,s,a=this.el.getObject3D("mesh");if(a){if(r=this.getClip(e),s=a.mixer.clipAction(r),n){s.paused=!1,s.timeScale=-1;return}if(s.clampWhenFinished=!0,s.loop=THREE.LoopOnce,s.repetitions=0,s.timeScale=1,s.time=0,s.weight=1,!i){a.mixer.stopAllAction(),s.play();return}r=this.getClip(i),s.reset(),s.play(),a.mixer.clipAction(r).crossFadeTo(s,.15,!0)}}})},"./src/components/hand-tracking-controls.js":(e,i,n)=>{var r,s,a,o,l=n("./src/core/component.js").registerComponent,h=n("./src/core/a-entity.js").AEntity,u=n("./src/utils/tracked-controls.js").checkControllerPresentAndSetup,c=n("./src/constants/index.js").AFRAME_CDN_ROOT,d=c+"controllers/oculus-hands/v4/left.glb",p=c+"controllers/oculus-hands/v4/right.glb",f=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];e.exports.Component=l("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"},modelOpacity:{default:1}},after:["tracked-controls"],bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var e=0;e<this.jointEls.length;++e)this.jointEls[e].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var e=0;e<this.jointEls.length;++e)this.jointEls[e].object3D.visible=!1},init:function(){var e=this.el.sceneEl,i=e.getAttribute("webxr"),n=i.optionalFeatures;-1===n.indexOf("hand-tracking")&&(n.push("hand-tracking"),e.setAttribute("webxr",i)),this.wristObject3D=new THREE.Object3D,this.el.sceneEl.object3D.add(this.wristObject3D),this.onModelLoaded=this.onModelLoaded.bind(this),this.onChildAttached=this.onChildAttached.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new THREE.Vector3,wristRotation:new THREE.Quaternion},this.indexTipPosition=new THREE.Vector3,this.hasPoses=!1,this.jointPoses=new Float32Array(16*f.length),this.jointRadii=new Float32Array(f.length),this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace),this.el.addEventListener("child-attached",this.onChildAttached),this.el.object3D.visible=!1,this.wristObject3D.visible=!1},onChildAttached:function(e){this.addChildEntity(e.detail.el)},update:function(){this.updateModelMaterial()},updateModelMaterial:function(){var e=this.jointEls,i=this.skinnedMesh,n=1!==this.data.modelOpacity;i&&(this.skinnedMesh.material.color.set(this.data.modelColor),this.skinnedMesh.material.transparent=n,this.skinnedMesh.material.opacity=this.data.modelOpacity);for(var r=0;r<e.length;r++)e[r].setAttribute("material",{color:this.data.modelColor,transparent:n,opacity:this.data.modelOpacity})},updateReferenceSpace:function(){var e=this,i=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,i){var n=e.el.sceneEl.systems.webxr.sessionReferenceSpaceType;i.requestReferenceSpace(n).then(function(i){e.referenceSpace=i}).catch(function(i){throw e.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(n,"tracked-controls-webxr uses reference space "+n),i})}},checkIfControllerPresent:function(){var e=this.data;u(this,"",{hand:e.hand?e.hand:void 0,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var e=this.el.sceneEl,i=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,n=e.frame,r=this.el.components["tracked-controls-webxr"],s=this.referenceSpace;i&&n&&s&&r&&(this.hasPoses=!1,i.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),this.hasPoses=n.fillPoses(i.hand.values(),s,this.jointPoses)&&n.fillJointRadii(i.hand.values(),this.jointRadii),this.updateHandModel(),this.detectGesture(),this.updateWristObject()))},updateWristObject:(r=new THREE.Matrix4,function(){var e=this.wristObject3D;e&&this.hasPoses&&(r.fromArray(this.jointPoses,0),e.position.setFromMatrixPosition(r),e.quaternion.setFromRotationMatrix(r))}),updateHandModel:function(){"dots"===this.data.modelStyle&&this.updateHandDotsModel(),"mesh"===this.data.modelStyle&&this.updateHandMeshModel()},getBone:function(e){for(var i=this.bones,n=0;n<i.length;n++)if(i[n].name===e)return i[n];return null},updateHandMeshModel:(s=new THREE.Matrix4,function(){var e=0,i=this.jointPoses,n=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller;if(n&&this.mesh){if(this.mesh.visible=!1,this.hasPoses)for(var r of n.hand.values()){var a=this.getBone(r.jointName);null!=a&&(this.mesh.visible=!0,s.fromArray(i,16*e),a.position.setFromMatrixPosition(s),a.quaternion.setFromRotationMatrix(s)),e++}}}),updateHandDotsModel:function(){for(var e,i,n=this.jointPoses,r=this.jointRadii,s=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,a=0;a<s.hand.size;a++)i=(e=this.jointEls[a]).object3D,e.object3D.visible=this.hasPoses,this.hasPoses&&(i.matrix.fromArray(n,16*a),i.matrix.decompose(i.position,i.rotation,i.scale),e.setAttribute("scale",{x:r[a],y:r[a],z:r[a]}))},detectGesture:function(){this.detectPinch()},detectPinch:(a=new THREE.Vector3,o=new THREE.Matrix4,function(){var e=this.indexTipPosition,i=this.pinchEventDetail;if(this.hasPoses){a.setFromMatrixPosition(o.fromArray(this.jointPoses,64)),e.setFromMatrixPosition(o.fromArray(this.jointPoses,144)),i.wristRotation.setFromRotationMatrix(o.fromArray(this.jointPoses,0));var n=e.distanceTo(a);n<.015&&!1===this.isPinched&&(this.isPinched=!0,this.pinchDistance=n,i.position.copy(e).add(a).multiplyScalar(.5),this.el.emit("pinchstarted",i)),n>this.pinchDistance+.1*this.pinchDistance&&!0===this.isPinched&&(this.isPinched=!1,i.position.copy(e).add(a).multiplyScalar(.5),this.el.emit("pinchended",i)),this.isPinched&&(i.position.copy(e).add(a).multiplyScalar(.5),this.el.emit("pinchmoved",i))}}),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,i=this.data;if(e.setAttribute("tracked-controls",{id:"",hand:i.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.mesh){this.mesh!==e.getObject3D("mesh")&&e.setObject3D("mesh",this.mesh);return}this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var e,i=this.el;this.checkIfControllerPresent(),e=i.components["tracked-controls"]&&i.components["tracked-controls"].controller,this.mesh&&e&&e.hand&&e.hand instanceof XRHand&&i.setObject3D("mesh",this.mesh)},initDefaultModel:function(){var e=this.data;"dots"===e.modelStyle&&this.initDotsModel(),"mesh"===e.modelStyle&&this.initMeshHandModel(),this.el.object3D.visible=!0,this.wristObject3D.visible=!0},initDotsModel:function(){if(0===this.jointEls.length){for(var e=0;e<f.length;++e){var i=this.jointEl=document.createElement("a-entity");i.setAttribute("geometry",{primitive:"sphere",radius:1}),i.object3D.visible=!1,this.el.appendChild(i),this.jointEls.push(i)}this.updateModelMaterial()}},initMeshHandModel:function(){var e="left"===this.data.hand?d:p;this.el.setAttribute("gltf-model",e)},onModelLoaded:function(){var e=this.mesh=this.el.getObject3D("mesh").children[0],i=this.skinnedMesh=e.getObjectByProperty("type","SkinnedMesh");this.skinnedMesh&&(this.bones=i.skeleton.bones,this.el.removeObject3D("mesh"),e.position.set(0,0,0),e.rotation.set(0,0,0),i.frustumCulled=!1,i.material=new THREE.MeshStandardMaterial,this.updateModelMaterial(),this.setupChildrenEntities(),this.el.setObject3D("mesh",e))},setupChildrenEntities:function(){for(var e=this.el.children,i=0;i<e.length;++i)e[i]instanceof h&&this.addChildEntity(e[i])},addChildEntity:function(e){e instanceof h&&this.wristObject3D.add(e.object3D)}})},"./src/components/hand-tracking-grab-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js");r("hand-tracking-grab-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},color:{type:"color",default:"white"},hoverColor:{type:"color",default:"#538df1"},hoverEnabled:{default:!1}},init:function(){var e,i=this.el,n=this.data;e="right"===n.hand?"components.hand-tracking-controls.bones.3":"components.hand-tracking-controls.bones.21",i.setAttribute("hand-tracking-controls",{hand:n.hand}),i.setAttribute("obb-collider",{trackedObject3D:e,size:.04}),this.auxMatrix=new s.Matrix4,this.auxQuaternion=new s.Quaternion,this.auxQuaternion2=new s.Quaternion,this.auxVector=new s.Vector3,this.auxVector2=new s.Vector3,this.grabbingObjectPosition=new s.Vector3,this.grabbedObjectPosition=new s.Vector3,this.grabbedObjectPositionDelta=new s.Vector3,this.grabDeltaPosition=new s.Vector3,this.grabInitialRotation=new s.Quaternion,this.onCollisionStarted=this.onCollisionStarted.bind(this),this.el.addEventListener("obbcollisionstarted",this.onCollisionStarted),this.onCollisionEnded=this.onCollisionEnded.bind(this),this.el.addEventListener("obbcollisionended",this.onCollisionEnded),this.onPinchStarted=this.onPinchStarted.bind(this),this.el.addEventListener("pinchstarted",this.onPinchStarted),this.onPinchEnded=this.onPinchEnded.bind(this),this.el.addEventListener("pinchended",this.onPinchEnded),this.onPinchMoved=this.onPinchMoved.bind(this),this.el.addEventListener("pinchmoved",this.onPinchMoved)},transferEntityOwnership:function(){for(var e,i=this.el.sceneEl.querySelectorAll("[hand-tracking-grab-controls]"),n=0;n<i.length;++n)(e=i[n].components["hand-tracking-grab-controls"])!==this&&this.grabbedEl&&this.grabbedEl===e.grabbedEl&&e.releaseGrabbedEntity();return!1},onCollisionStarted:function(e){var i=e.detail.withEl;!this.collidedEl&&i.getAttribute("grabbable")&&(this.collidedEl=i,this.grabbingObject3D=e.detail.trackedObject3D,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.hoverColor))},onCollisionEnded:function(){this.collidedEl=void 0,!this.grabbedEl&&(this.grabbingObject3D=void 0,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.color))},onPinchStarted:function(e){this.collidedEl&&(this.pinchPosition=e.detail.position,this.wristRotation=e.detail.wristRotation,this.grabbedEl=this.collidedEl,this.transferEntityOwnership(),this.grab())},onPinchEnded:function(){this.releaseGrabbedEntity()},onPinchMoved:function(e){this.wristRotation=e.detail.wristRotation},releaseGrabbedEntity:function(){var e=this.grabbedEl;e&&(e.object3D.updateMatrixWorld=this.originalUpdateMatrixWorld,e.object3D.matrixAutoUpdate=!0,e.object3D.matrixWorldAutoUpdate=!0,e.object3D.matrixWorld.decompose(this.auxVector,this.auxQuaternion,this.auxVector2),e.object3D.position.copy(this.auxVector),e.object3D.quaternion.copy(this.auxQuaternion),this.el.emit("grabended",{grabbedEl:e}),this.grabbedEl=void 0)},grab:function(){var e,i=this.grabbedEl;e=i.object3D.getWorldPosition(this.grabbedObjectPosition),this.grabDeltaPosition.copy(e).sub(this.pinchPosition),this.grabInitialRotation.copy(this.auxQuaternion.copy(this.wristRotation).invert()),this.originalUpdateMatrixWorld=i.object3D.updateMatrixWorld,i.object3D.updateMatrixWorld=function(){},i.object3D.updateMatrixWorldChildren=function(e){for(var i=this.children,n=0,r=i.length;n<r;n++){var s=i[n];(!0===s.matrixWorldAutoUpdate||!0===e)&&s.updateMatrixWorld(!0)}},i.object3D.matrixAutoUpdate=!1,i.object3D.matrixWorldAutoUpdate=!1,this.el.emit("grabstarted",{grabbedEl:i})},tock:function(){var e,i=this.auxMatrix,n=this.auxQuaternion,r=this.auxQuaternion2,s=this.grabbedEl;s&&((e=s.object3D).getWorldQuaternion(r),e.matrixWorld.identity(),i.identity(),i.makeTranslation(this.pinchPosition),e.matrixWorld.multiply(i),i.identity(),i.makeRotationFromQuaternion(n.copy(this.wristRotation).multiply(this.grabInitialRotation)),e.matrixWorld.multiply(i),i.identity(),i.makeTranslation(this.grabDeltaPosition),e.matrixWorld.multiply(i),i.identity(),i.makeRotationFromQuaternion(r),e.matrixWorld.multiply(i),i.makeScale(s.object3D.scale.x,s.object3D.scale.y,s.object3D.scale.z),e.matrixWorld.multiply(i),e.updateMatrixWorldChildren())}})},"./src/components/hide-on-enter-ar.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("hide-on-enter-ar",{init:function(){var e=this;this.el.sceneEl.addEventListener("enter-vr",function(){e.el.sceneEl.is("ar-mode")&&(e.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){e.el.object3D.visible=!0})}})},"./src/components/hide-on-enter-vr.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("hide-on-enter-vr",{init:function(){var e=this;this.el.sceneEl.addEventListener("enter-vr",function(){e.el.sceneEl.is("vr-mode")&&(e.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){e.el.object3D.visible=!0})}})},"./src/components/hp-mixed-reality-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js"),a=n("./src/utils/tracked-controls.js"),o=a.checkControllerPresentAndSetup,l=a.emitIfAxesChanged,h=a.onButtonEvent,u="hp-mixed-reality",c=n("./src/constants/index.js").AFRAME_CDN_ROOT+"controllers/hp/mixed-reality/",d={x:0,y:0,z:.06},p={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"};e.exports.Component=r("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}},init:function(){var e=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){h(i.detail.id,"down",e,e.data.hand)},this.onButtonUp=function(i){h(i.detail.id,"up",e,e.data.hand)},this.onButtonTouchEnd=function(i){h(i.detail.id,"touchend",e,e.data.hand)},this.onButtonTouchStart=function(i){h(i.detail.id,"touchstart",e,e.data.hand)},this.previousButtonValues={},this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;o(this,u,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,i=this.data;e.setAttribute("tracked-controls",{idPrefix:u,hand:i.hand,controller:this.controllerIndex,orientationOffset:i.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",c+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var i=this.mapping[this.data.hand].buttons[e.detail.id];i&&("trigger"===i&&console.log("analog value of trigger press: "+e.detail.state.value),this.el.emit(i+"changed",e.detail.state))},onModelLoaded:function(e){var i=e.detail.model;this.data.model&&(i.position.copy(d),i.rotation.copy(p),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new s.Vector3(0,0,0)}))},onAxisMoved:function(e){l(this,this.mapping.axes,e)}})},"./src/components/index.js":(e,i,n)=>{n("./src/components/animation.js"),n("./src/components/anchored.js"),n("./src/components/camera.js"),n("./src/components/cursor.js"),n("./src/components/geometry.js"),n("./src/components/generic-tracked-controller-controls.js"),n("./src/components/gltf-model.js"),n("./src/components/grabbable.js"),n("./src/components/hand-tracking-controls.js"),n("./src/components/hand-tracking-grab-controls.js"),n("./src/components/hand-controls.js"),n("./src/components/hide-on-enter-ar.js"),n("./src/components/hide-on-enter-vr.js"),n("./src/components/hp-mixed-reality-controls.js"),n("./src/components/layer.js"),n("./src/components/laser-controls.js"),n("./src/components/light.js"),n("./src/components/line.js"),n("./src/components/link.js"),n("./src/components/look-controls.js"),n("./src/components/magicleap-controls.js"),n("./src/components/material.js"),n("./src/components/obb-collider.js"),n("./src/components/obj-model.js"),n("./src/components/oculus-go-controls.js"),n("./src/components/oculus-touch-controls.js"),n("./src/components/pico-controls.js"),n("./src/components/position.js"),n("./src/components/raycaster.js"),n("./src/components/rotation.js"),n("./src/components/scale.js"),n("./src/components/shadow.js"),n("./src/components/sound.js"),n("./src/components/text.js"),n("./src/components/tracked-controls.js"),n("./src/components/tracked-controls-webvr.js"),n("./src/components/tracked-controls-webxr.js"),n("./src/components/visible.js"),n("./src/components/valve-index-controls.js"),n("./src/components/vive-controls.js"),n("./src/components/vive-focus-controls.js"),n("./src/components/wasd-controls.js"),n("./src/components/windows-motion-controls.js"),n("./src/components/scene/ar-hit-test.js"),n("./src/components/scene/background.js"),n("./src/components/scene/debug.js"),n("./src/components/scene/device-orientation-permission-ui.js"),n("./src/components/scene/embedded.js"),n("./src/components/scene/inspector.js"),n("./src/components/scene/fog.js"),n("./src/components/scene/keyboard-shortcuts.js"),n("./src/components/scene/pool.js"),n("./src/components/scene/real-world-meshing.js"),n("./src/components/scene/reflection.js"),n("./src/components/scene/screenshot.js"),n("./src/components/scene/stats.js"),n("./src/components/scene/xr-mode-ui.js")},"./src/components/laser-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/index.js");r("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var e=this.config,i=this.data,n=this.el,r=this,a={hand:i.hand,model:i.model};function o(i){var a=e[i.detail.name];if(a){var o=s.extend({showLine:!0},a.raycaster||{});i.detail.rayOrigin&&(o.origin=i.detail.rayOrigin.origin,o.direction=i.detail.rayOrigin.direction,o.showLine=!0),i.detail.rayOrigin||!r.modelReady?n.setAttribute("raycaster",o):n.setAttribute("raycaster","showLine",!0),n.setAttribute("cursor",s.extend({fuse:!1},a.cursor))}}n.setAttribute("hp-mixed-reality-controls",a),n.setAttribute("magicleap-controls",a),n.setAttribute("oculus-go-controls",a),n.setAttribute("oculus-touch-controls",a),n.setAttribute("pico-controls",a),n.setAttribute("valve-index-controls",a),n.setAttribute("vive-controls",a),n.setAttribute("vive-focus-controls",a),n.setAttribute("windows-motion-controls",a),n.setAttribute("generic-tracked-controller-controls",{hand:a.hand}),n.addEventListener("controllerconnected",o),n.addEventListener("controllerdisconnected",function(i){e[i.detail.name]&&n.setAttribute("raycaster","showLine",!1)}),n.addEventListener("controllermodelready",function(e){o(e),r.modelReady=!0})},config:{"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"pico-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},"./src/components/layer.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/index.js").debug("components:layer:warn");e.exports.Component=r("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var e=this.el.sceneEl.renderer.getContext();this.quaternion=new THREE.Quaternion,this.position=new THREE.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=e.createFramebuffer();var i=this.el.sceneEl.getAttribute("webxr"),n=i.requiredFeatures;-1===n.indexOf("layers")&&(n.push("layers"),this.el.sceneEl.setAttribute("webxr",i)),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(e){this.data.src!==e.src&&this.updateSrc()},updateSrc:function(){var e=this.data.type;if(this.texture=void 0,"quad"===e){this.loadQuadImage();return}if("monocubemap"===e||"stereocubemap"===e){this.loadCubeMapImages();return}},loadCubeMapImages:function(){var e,i=this.xrGLFactory,n=this.el.sceneEl.frame,r=this.data.src,s=this.data.type;this.visibilityChanged=!1,this.layer&&("monocubemap"===s||"stereocubemap"===s)&&(r.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,"monocubemap"===s?(e=i.getSubImage(this.layer,n),this.loadCubeMapImage(e.colorTexture,r,0)):(e=i.getSubImage(this.layer,n,"left"),this.loadCubeMapImage(e.colorTexture,r,0),e=i.getSubImage(this.layer,n,"right"),this.loadCubeMapImage(e.colorTexture,r,6)))},loadQuadImage:function(){var e=this.data.src,i=this;this.el.sceneEl.systems.material.loadTexture(e,{src:e},function(n){i.el.sceneEl.renderer.initTexture(n),i.texture=n,"VIDEO"===e.tagName&&setTimeout(function(){i.textureIsVideo=!0},1e3),i.layer&&(i.layer.height=i.data.height/2||i.texture.image.height/1e3,i.layer.width=i.data.width/2||i.texture.image.width/1e3,i.needsRedraw=!0),i.updateQuadPanel()})},preGenerateCubeMapTextures:function(e,i){"monocubemap"===this.data.type?this.generateCubeMapTextures(e,0,i):(this.generateCubeMapTextures(e,0,i),this.generateCubeMapTextures(e,6,i))},generateCubeMapTextures:function(e,i,n){for(var r,s,a=this.data,o=this.cubeFaceSize,l=Math.min(e.width,e.height),h=[],u=0;u<6;u++){var c=document.createElement("CANVAS");c.width=c.height=o;var d=c.getContext("2d");a.rotateCubemap&&(2===u||3===u)&&(d.save(),d.translate(o,o),d.rotate(Math.PI)),d.drawImage(e,(u+i)*l,0,l,l,0,0,o,o),d.restore(),n&&n(),h.push(c)}return a.rotateCubemap&&(r=h[0],s=h[1],h[0]=s,h[1]=r,r=h[4],s=h[5],h[4]=s,h[5]=r),n&&n(),h},loadCubeMapImage:function(e,i,n){var r=this.el.sceneEl.renderer.getContext();r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.bindTexture(r.TEXTURE_CUBE_MAP,e);var s=0;(!i.complete||this.loadingScreen?this.loadingScreenImages:this.generateCubeMapTextures(i,n)).forEach(function(e,i){r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,0,0,r.RGBA,r.UNSIGNED_BYTE,e),s=r.getError()}),0!==s&&console.log("renderingError, WebGL Error Code: "+s),r.bindTexture(r.TEXTURE_CUBE_MAP,null)},tick:function(){if(this.el.sceneEl.xrSession)!this.layer&&(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),(this.needsRedraw||this.layer.needsRedraw||this.textureIsVideo)&&("quad"===this.data.type&&this.draw(),this.needsRedraw=!1)},initLayer:function(){var e=this,i=this.data.type;if(this.el.sceneEl.xrSession.onvisibilitychange=function(i){e.visibilityChanged="hidden"!==i.session.visibilityState},"quad"===i){this.initQuadLayer();return}if("monocubemap"===i||"stereocubemap"===i){this.initCubeMapLayer();return}},initQuadLayer:function(){var e=this.el.sceneEl,i=e.renderer.getContext(),n=this.xrGLFactory=new XRWebGLBinding(e.xrSession,i);this.texture&&(this.layer=n.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),e.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var e=this.data.src,i=this.el.sceneEl,n=i.renderer.getContext(),r=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),s=this.cubeFaceSize=Math.min(r,Math.min(e.width,e.height)),a=this.xrGLFactory=new XRWebGLBinding(i.xrSession,n);this.layer=a.createCubeLayer({space:this.referenceSpace,viewPixelWidth:s,viewPixelHeight:s,layout:"monocubemap"===this.data.type?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),i.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var e=this.cubeFaceSize,i=this.loadingScreenImages=[],n=0;n<6;n++){var r=document.createElement("CANVAS");r.width=r.height=e;var s=r.getContext("2d");r.width=r.height=e,s.fillStyle="black",s.fillRect(0,0,e,e),2!==n&&3!==n&&(s.translate(e,0),s.scale(-1,1),s.fillStyle="white",s.font="30px Arial",s.fillText("Loading",e/2,e/2)),i.push(r)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(e){this.layerEnabled=e,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var e=this.quadPanelEl;this.quadPanelEl||(e=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(e)),e.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),e.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var e,i,n,r,s,a,o,l,h,u=this.el.sceneEl,c=this.el.sceneEl.renderer.getContext(),d=this.xrGLFactory.getSubImage(this.layer,u.frame),p=u.renderer.properties.get(this.texture).__webglTexture,f=c.getParameter(c.FRAMEBUFFER_BINDING);c.viewport(d.viewport.x,d.viewport.y,d.viewport.width,d.viewport.height),c.bindFramebuffer(c.FRAMEBUFFER,this.frameBuffer),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,d.colorTexture,0),e=c,i=p,n=d,r=this.data.src,s=e.createFramebuffer(),a=n.viewport.x,o=n.viewport.y,l=n.viewport.x+n.viewport.width,h=n.viewport.y+n.viewport.height,"VIDEO"===r.tagName&&(e.bindTexture(e.TEXTURE_2D,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,e.RGB,e.UNSIGNED_BYTE,r)),e.bindFramebuffer(e.READ_FRAMEBUFFER,s),e.framebufferTexture2D(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.readBuffer(e.COLOR_ATTACHMENT0),e.blitFramebuffer(0,0,r.width,r.height,a,o,l,h,e.COLOR_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.deleteFramebuffer(s),c.bindFramebuffer(c.FRAMEBUFFER,f)},updateTransform:function(){var e=this.el,i=this.position,n=this.quaternion;e.object3D.updateMatrixWorld(),i.setFromMatrixPosition(e.object3D.matrixWorld),n.setFromRotationMatrix(e.object3D.matrixWorld),this.layerEnabled||i.set(0,0,1e8),this.layer.transform=new XRRigidTransform(i,n)},onEnterVR:function(){var e=this.el.sceneEl,i=e.xrSession;if(!e.hasWebXR||!XRWebGLBinding||!i){s("The layer component requires WebXR and the layers API enabled");return}i.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(e){this.referenceSpace=e}})},"./src/components/light.js":(e,i,n)=>{var r,s,a,o,l,h,u=n("./src/utils/index.js"),c=u.diff,d=n("./src/utils/debug.js"),p=n("./src/core/component.js").registerComponent,f=n("./src/lib/three.js"),m=n("./src/utils/math.js"),g=f.MathUtils.degToRad,A=d("components:light:warn"),v=new f.CubeTextureLoader,y={};e.exports.Component=p("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowCameraAutomatic:{default:"",if:{type:["directional"]}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var e=this.el;this.light=null,this.defaultTarget=null,this.system.registerLight(e)},update:function(e){var i=this.data,n=c(i,e),r=this.light,s=this;if(r&&!("type"in n)){var a=!1;Object.keys(n).forEach(function(e){var n=i[e];switch(e){case"color":r.color.set(n);break;case"groundColor":r.groundColor.set(n);break;case"angle":r.angle=g(n);break;case"target":null===n?("spot"===i.type||"directional"===i.type)&&(r.target=s.defaultTarget):n.hasLoaded?s.onSetTarget(n,r):n.addEventListener("loaded",s.onSetTarget.bind(s,n,r));break;case"envMap":s.updateProbeMap(i,r);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":a||(s.updateShadow(),a=!0);break;case"shadowCameraAutomatic":i.shadowCameraAutomatic?s.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(i.shadowCameraAutomatic)):s.shadowCameraAutomaticEls=[];break;default:r[e]=n}});return}this.setLight(this.data),this.updateShadow()},tick:(r=new f.Box3,s=new f.Vector3,a=new f.Vector3,o=new f.Matrix4,l=new f.Sphere,h=new f.Vector3,function(){if("directional"===this.data.type&&this.light.shadow&&this.light.shadow.camera instanceof f.OrthographicCamera&&this.shadowCameraAutomaticEls.length){var e=this.light.shadow.camera;e.getWorldDirection(s),e.getWorldPosition(a),o.copy(e.matrixWorld),o.invert(),e.near=1,e.left=1e5,e.right=-1e5,e.top=-1e5,e.bottom=1e5,this.shadowCameraAutomaticEls.forEach(function(i){r.setFromObject(i.object3D),r.getBoundingSphere(l);var n=m.distanceOfPointFromPlane(a,s,l.center),u=m.nearestPointInPlane(a,s,l.center,h).applyMatrix4(o);e.near=Math.min(-n-l.radius-1,e.near),e.left=Math.min(-l.radius+u.x,e.left),e.right=Math.max(l.radius+u.x,e.right),e.top=Math.max(l.radius+u.y,e.top),e.bottom=Math.min(-l.radius+u.y,e.bottom)}),e.updateProjectionMatrix()}}),setLight:function(e){var i=this.el,n=this.getLight(e);n&&(this.light&&i.removeObject3D("light"),this.light=n,this.light.el=i,i.setObject3D("light",this.light),("spot"===e.type||"directional"===e.type||"hemisphere"===e.type)&&i.getObject3D("light").translateY(-1),"spot"===e.type&&(i.setObject3D("light-target",this.defaultTarget),i.getObject3D("light-target").position.set(0,0,-1)),e.shadowCameraAutomatic?this.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(e.shadowCameraAutomatic)):this.shadowCameraAutomaticEls=[])},updateShadow:function(){var e=this.el,i=this.data,n=this.light;n.castShadow=i.castShadow;var r=e.getObject3D("cameraHelper");if(i.shadowCameraVisible&&!r?e.setObject3D("cameraHelper",new f.CameraHelper(n.shadow.camera)):!i.shadowCameraVisible&&r&&e.removeObject3D("cameraHelper"),!i.castShadow)return n;n.shadow.bias=i.shadowBias,n.shadow.radius=i.shadowRadius,n.shadow.mapSize.height=i.shadowMapHeight,n.shadow.mapSize.width=i.shadowMapWidth,n.shadow.camera.near=i.shadowCameraNear,n.shadow.camera.far=i.shadowCameraFar,n.shadow.camera instanceof f.OrthographicCamera?(n.shadow.camera.top=i.shadowCameraTop,n.shadow.camera.right=i.shadowCameraRight,n.shadow.camera.bottom=i.shadowCameraBottom,n.shadow.camera.left=i.shadowCameraLeft):n.shadow.camera.fov=i.shadowCameraFov,n.shadow.camera.updateProjectionMatrix(),r&&r.update()},getLight:function(e){var i=e.angle,n=new f.Color(e.color);n=n.getHex();var r=e.decay,s=e.distance,a=new f.Color(e.groundColor);a=a.getHex();var o=e.intensity,l=e.type,h=e.target,u=null;switch(l.toLowerCase()){case"ambient":return new f.AmbientLight(n,o);case"directional":return u=new f.DirectionalLight(n,o),this.defaultTarget=u.target,h&&(h.hasLoaded?this.onSetTarget(h,u):h.addEventListener("loaded",this.onSetTarget.bind(this,h,u))),u;case"hemisphere":return new f.HemisphereLight(n,a,o);case"point":return new f.PointLight(n,o,s,r);case"spot":return u=new f.SpotLight(n,o,s,g(i),e.penumbra,r),this.defaultTarget=u.target,h&&(h.hasLoaded?this.onSetTarget(h,u):h.addEventListener("loaded",this.onSetTarget.bind(this,h,u))),u;case"probe":return u=new f.LightProbe,this.updateProbeMap(e,u),u;default:A("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",l)}},updateProbeMap:function(e,i){e.envMap||i.copy(new f.LightProbe),y[e.envMap]instanceof window.Promise&&y[e.envMap].then(function(e){i.copy(e)}),y[e.envMap]instanceof f.LightProbe&&i.copy(y[e.envMap]),y[e.envMap]=new window.Promise(function(n){u.srcLoader.validateCubemapSrc(e.envMap,function(n){v.load(n,function(n){var r=f.LightProbeGenerator.fromCubeTexture(n);y[e.envMap]=r,i.copy(r)})})})},onSetTarget:function(e,i){i.target=e.object3D},remove:function(){var e=this.el;e.removeObject3D("light"),e.getObject3D("cameraHelper")&&e.removeObject3D("cameraHelper")}})},"./src/components/line.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;function s(e,i){return!!e&&!!i&&e.x===i.x&&e.y===i.y&&e.z===i.z}e.exports.Component=r("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var e,i,n=this.data;i=this.material=new THREE.LineBasicMaterial({color:n.color,opacity:n.opacity,transparent:n.opacity<1,visible:n.visible}),(e=this.geometry=new THREE.BufferGeometry).setAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.line=new THREE.Line(e,i),this.el.setObject3D(this.attrName,this.line)},update:function(e){var i=this.data,n=this.geometry,r=!1,a=this.material,o=n.attributes.position.array;s(i.start,e.start)||(o[0]=i.start.x,o[1]=i.start.y,o[2]=i.start.z,r=!0),s(i.end,e.end)||(o[3]=i.end.x,o[4]=i.end.y,o[5]=i.end.z,r=!0),r&&(n.attributes.position.needsUpdate=!0,n.computeBoundingSphere()),a.color.setStyle(i.color),a.opacity=i.opacity,a.transparent=i.opacity<1,a.visible=i.visible},remove:function(){this.el.removeObject3D(this.attrName,this.line)}})},"./src/components/link.js":(e,i,n)=>{var r,s,a,o,l,h,u,c,d=n("./src/core/component.js").registerComponent,p=n("./src/core/shader.js").registerShader,f=n("./src/lib/three.js");e.exports.Component=d("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new f.Quaternion,this.hiddenEls=[]},update:function(e){var i,n,r=this.data,s=this.el;if(r.visualAspectEnabled)this.initVisualAspect(),i=r.highlighted?r.highlightedColor:r.backgroundColor,n=r.highlighted?r.highlightedColor:r.borderColor,s.setAttribute("material","backgroundColor",i),s.setAttribute("material","strokeColor",n),r.on!==e.on&&this.updateEventListener(),void 0!==e.peekMode&&r.peekMode!==e.peekMode&&this.updatePeekMode(),r.image&&e.image!==r.image&&s.setAttribute("material","pano","string"==typeof r.image?r.image:r.image.src)},updatePeekMode:function(){var e=this.el,i=this.sphereEl;this.data.peekMode?(this.hideAll(),e.getObject3D("mesh").visible=!1,i.setAttribute("visible",!0)):(this.showAll(),e.getObject3D("mesh").visible=!0,i.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var e=this.el;e.isPlaying&&(this.removeEventListener(),e.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var e=this.data.on;e&&this.el.removeEventListener(e,this.navigate)},initVisualAspect:function(){var e,i,n,r=this.el;this.data.visualAspectEnabled&&!this.visualAspectInitialized&&(n=this.textEl=this.textEl||document.createElement("a-entity"),i=this.sphereEl=this.sphereEl||document.createElement("a-entity"),e=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),r.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),r.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"}),n.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),n.setAttribute("position","0 1.5 0"),r.appendChild(n),e.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),e.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),e.setAttribute("rotation","0 180 0"),e.setAttribute("position","0 0 0"),e.setAttribute("visible",!1),r.appendChild(e),i.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),i.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"}),i.setAttribute("visible",!1),r.appendChild(i),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:(r=new f.Vector3,s=new f.Vector3,a=new f.Quaternion,o=new f.Vector3,function(){var e,i,n=this.el,l=n.object3D,h=n.sceneEl.camera,u=this.textEl;if(this.data.visualAspectEnabled){if(l.updateMatrixWorld(),h.parent.updateMatrixWorld(),h.updateMatrixWorld(),l.matrix.decompose(s,a,o),s.setFromMatrixPosition(l.matrixWorld),r.setFromMatrixPosition(h.matrixWorld),(i=s.distanceTo(r))>20)this.previousQuaternion||(this.quaternionClone.copy(a),this.previousQuaternion=this.quaternionClone),l.lookAt(r);else{if(e=this.calculateCameraPortalOrientation(),i<.5){if(!0===this.semiSphereEl.getAttribute("visible"))return;u.setAttribute("text","width",1.5),e<=0?(u.setAttribute("position","0 0 0.75"),u.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(u.setAttribute("position","0 0 -0.75"),u.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),n.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=e}else e<=0?u.setAttribute("rotation","0 180 0"):u.setAttribute("rotation","0 0 0"),u.setAttribute("text","width",5),u.setAttribute("position","0 1.5 0"),n.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(l.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}),hideAll:function(){var e=this.el,i=this.hiddenEls,n=this;!(i.length>0)&&e.sceneEl.object3D.traverse(function(r){!(r&&r.el&&r.el.hasAttribute("link-controls"))&&r.el&&r!==e.sceneEl.object3D&&r.el!==e&&r.el!==n.sphereEl&&r.el!==e.sceneEl.cameraEl&&!1!==r.el.getAttribute("visible")&&r.el!==n.textEl&&r.el!==n.semiSphereEl&&(r.el.setAttribute("visible",!1),i.push(r.el))})},showAll:function(){this.hiddenEls.forEach(function(e){e.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:(l=new f.Matrix4,h=new f.Vector3,u=new f.Vector3(0,0,1),c=new f.Vector3(0,0,0),function(){var e=this.el,i=e.sceneEl.camera;return h.set(0,0,0),u.set(0,0,1),c.set(0,0,0),e.object3D.matrixWorld.extractRotation(l),u.applyMatrix4(l),e.object3D.updateMatrixWorld(),e.object3D.localToWorld(c),i.parent.parent.updateMatrixWorld(),i.parent.updateMatrixWorld(),i.updateMatrixWorld(),i.localToWorld(h),h.sub(c).normalize(),u.normalize(),Math.sign(u.dot(h))}),remove:function(){this.removeEventListener()}}),p("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:"vec3 portalPosition;\nvarying vec3 vWorldPosition;\nvarying float vDistanceToCenter;\nvarying float vDistance;\nvoid main() {\nvDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);\nportalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;\nvDistance = length(portalPosition - cameraPosition);\nvWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#define RECIPROCAL_PI2 0.15915494\nuniform sampler2D pano;\nuniform vec3 strokeColor;\nuniform vec3 backgroundColor;\nuniform float borderEnabled;\nvarying float vDistanceToCenter;\nvarying float vDistance;\nvarying vec3 vWorldPosition;\nvoid main() {\nvec3 direction = normalize(vWorldPosition - cameraPosition);\nvec2 sampleUV;\nfloat borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);\nsampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);\nsampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;\nif (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {\ngl_FragColor = vec4(strokeColor, 1.0);\n} else {\ngl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));\n}\n}"})},"./src/components/look-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js"),a=n("./src/utils/index.js"),o=Math.PI/2;e.exports.Component=r("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new s.Vector3,this.hmdQuaternion=new s.Quaternion,this.magicWindowAbsoluteEuler=new s.Euler,this.magicWindowDeltaEuler=new s.Euler,this.position=new s.Vector3,this.magicWindowObject=new s.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new s.Vector3,rotation:new s.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var e,i=this.data;(a.device.isMobile()||a.device.isMobileDeviceRequestingDesktopSite())&&(e=this.magicWindowControls=new s.DeviceOrientationControls(this.magicWindowObject),"undefined"!=typeof DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission&&(e.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?e.enabled=i.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){e.enabled=i.magicWindowTrackingEnabled})))},update:function(e){var i=this.data;i.enabled!==e.enabled&&this.updateGrabCursor(i.enabled),e&&!i.magicWindowTrackingEnabled&&e.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=i.magicWindowTrackingEnabled),e&&!i.pointerLockEnabled!==e.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(e){this.data.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onPointerLockError=this.onPointerLockError.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new s.Object3D,this.yawObject=new s.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var e=this.el.sceneEl,i=e.canvas;if(!i){e.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}i.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),i.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),e.addEventListener("enter-vr",this.onEnterVR),e.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))},removeEventListeners:function(){var e=this.el.sceneEl,i=e&&e.canvas;i&&(i.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),i.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("enter-vr",this.onEnterVR),e.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var e=this.el.object3D,i=this.pitchObject,n=this.yawObject,r=this.el.sceneEl;!((r.is("vr-mode")||r.is("ar-mode"))&&r.checkHeadsetConnected())&&(this.updateMagicWindowOrientation(),e.rotation.x=this.magicWindowDeltaEuler.x+i.rotation.x,e.rotation.y=this.magicWindowDeltaEuler.y+n.rotation.y,e.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var e=this.magicWindowAbsoluteEuler,i=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),e.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),this.previousMagicWindowYaw||0===e.y||(this.previousMagicWindowYaw=e.y),this.previousMagicWindowYaw&&(i.x=e.x,i.y+=e.y-this.previousMagicWindowYaw,i.z=e.z,this.previousMagicWindowYaw=e.y))},onMouseMove:function(e){var i,n,r,s=this.pitchObject,a=this.previousMouseEvent,l=this.yawObject;this.data.enabled&&(this.mouseDown||this.pointerLocked)&&(this.pointerLocked?(n=e.movementX||e.mozMovementX||0,r=e.movementY||e.mozMovementY||0):(n=e.screenX-a.screenX,r=e.screenY-a.screenY),this.previousMouseEvent.screenX=e.screenX,this.previousMouseEvent.screenY=e.screenY,i=this.data.reverseMouseDrag?1:-1,l.rotation.y+=.002*n*i,s.rotation.x+=.002*r*i,s.rotation.x=Math.max(-o,Math.min(o,s.rotation.x)))},onMouseDown:function(e){var i=this.el.sceneEl;if(!(!this.data.enabled||!this.data.mouseEnabled||(i.is("vr-mode")||i.is("ar-mode"))&&i.checkHeadsetConnected())&&0===e.button){var n=i&&i.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=e.screenX,this.previousMouseEvent.screenY=e.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(n.requestPointerLock?n.requestPointerLock():n.mozRequestPointerLock&&n.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(e){!(1!==e.touches.length||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&(this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(e){var i,n,r=this.el.sceneEl.canvas,s=this.yawObject;this.touchStarted&&this.data.touchEnabled&&(n=2*Math.PI*(e.touches[0].pageX-this.touchStart.x)/r.clientWidth,i=this.data.reverseTouchDrag?1:-1,s.rotation.y-=.5*n*i,this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var e=this.el.sceneEl;e.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),e.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!!(document.pointerLockElement||document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(e){var i=this.el.sceneEl;function n(){i.canvas.classList.add("a-grab-cursor")}function r(){i.canvas.classList.remove("a-grab-cursor")}if(!i.canvas){e?i.addEventListener("render-target-loaded",n):i.addEventListener("render-target-loaded",r);return}if(e){n();return}r()},saveCameraPose:function(){var e=this.el;this.savedPose.position.copy(e.object3D.position),this.savedPose.rotation.copy(e.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var e=this.el,i=this.savedPose;this.hasSavedPose&&(e.object3D.position.copy(i.position),e.object3D.rotation.copy(i.rotation),this.hasSavedPose=!1)}})},"./src/components/magicleap-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/tracked-controls.js"),a=s.checkControllerPresentAndSetup,o=s.emitIfAxesChanged,l=s.onButtonEvent,h="magicleap-one",u=n("./src/constants/index.js").AFRAME_CDN_ROOT+"controllers/magicleap/magicleap-one-controller.glb";e.exports.Component=r("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]},init:function(){var e=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){l(i.detail.id,"down",e)},this.onButtonUp=function(i){l(i.detail.id,"up",e)},this.onButtonTouchEnd=function(i){l(i.detail.id,"touchend",e)},this.onButtonTouchStart=function(i){l(i.detail.id,"touchstart",e)},this.previousButtonValues={},this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;a(this,h,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,i=this.data;e.setAttribute("tracked-controls",{idPrefix:h,hand:i.hand,controller:this.controllerIndex,orientationOffset:i.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",u)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var i=this.mapping.buttons[e.detail.id];i&&("trigger"===i&&console.log("analog value of trigger press: "+e.detail.state.value),this.el.emit(i+"changed",e.detail.state))},onModelLoaded:function(e){e.detail.model.scale.set(.01,.01,.01)},onAxisMoved:function(e){o(this,this.mapping.axes,e)},updateModel:function(e,i){},setButtonColor:function(e,i){}})},"./src/components/material.js":(e,i,n)=>{var r=n("./src/utils/index.js"),s=n("./src/core/component.js"),a=n("./src/lib/three.js"),o=n("./src/core/shader.js"),l=r.debug("components:material:error"),h=s.registerComponent,u=o.shaders,c=o.shaderNames;function d(e,i){e.dispose(),i.unregisterMaterial(e),Object.keys(e).filter(function(i){return e[i]&&e[i].isTexture}).forEach(function(i){e[i].dispose()})}e.exports.Component=h("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:c,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColorsEnabled:{default:!1},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0},anisotropy:{default:0,min:0}},init:function(){this.material=null},update:function(e){var i=this.data;this.shader&&i.shader===e.shader||this.updateShader(i.shader),this.shader.update(this.data),this.updateMaterial(e)},updateSchema:function(e){var i,n,r,s;n=e&&e.shader,i=this.oldData&&this.oldData.shader,(r=u[s=n||i]&&u[s].schema)||l("Unknown shader schema "+s),(!i||n!==i)&&(this.extendSchema(r),this.updateBehavior())},updateBehavior:function(){var e,i,n=this.el.sceneEl,r=this.schema,s=this;function a(e,n){var r;for(r in i)i[r]=e;s.shader.update(i)}for(e in this.tick=void 0,i={},r)"time"===r[e].type&&(this.tick=a,i[e]=!0);n&&(this.tick?n.addBehavior(this):n.removeBehavior(this))},updateShader:function(e){var i,n=this.data,r=u[e]&&u[e].Shader;if(!r)throw Error("Unknown shader "+e);(i=this.shader=new r).el=this.el,i.init(n),this.setMaterial(i.material),this.updateSchema(n)},updateMaterial:function(e){var i,n=this.data,r=this.material;for(i in r.alphaTest=n.alphaTest,r.depthTest=!1!==n.depthTest,r.depthWrite=!1!==n.depthWrite,r.opacity=n.opacity,r.flatShading=n.flatShading,r.side=function(e){switch(e){case"back":return a.BackSide;case"double":return a.DoubleSide;default:return a.FrontSide}}(n.side),r.transparent=!1!==n.transparent||n.opacity<1,r.vertexColors=n.vertexColorsEnabled,r.visible=n.visible,r.blending=function(e){switch(e){case"none":return a.NoBlending;case"additive":return a.AdditiveBlending;case"subtractive":return a.SubtractiveBlending;case"multiply":return a.MultiplyBlending;default:return a.NormalBlending}}(n.blending),r.dithering=n.dithering,e)break;i&&(e.alphaTest!==n.alphaTest||e.side!==n.side||e.vertexColorsEnabled!==n.vertexColorsEnabled)&&(r.needsUpdate=!0)},remove:function(){var e=new a.MeshBasicMaterial,i=this.material,n=this.el.getObject3D("mesh");n&&(n.material=e),d(i,this.system)},setMaterial:function(e){var i,n=this.el,r=this.system;this.material&&d(this.material,r),this.material=e,r.registerMaterial(e),(i=n.getObject3D("mesh"))?i.material=e:n.addEventListener("object3dset",function i(r){"mesh"===r.detail.type&&r.target===n&&(n.getObject3D("mesh").material=e,n.removeEventListener("object3dset",i))})}})},"./src/components/obb-collider.js":(e,i,n)=>{var r,s,a,o,l,h,u,c,d,p=n("./src/core/component.js").registerComponent,f=n("./src/lib/three.js");p("obb-collider",{schema:{size:{default:0},trackedObject3D:{default:""},minimumColliderDimension:{default:.02},centerModel:{default:!1}},init:function(){this.previousScale=new f.Vector3().copy(this.el.object3D.scale),this.auxEuler=new f.Euler,this.boundingBox=new f.Box3,this.boundingBoxSize=new f.Vector3,this.updateCollider=this.updateCollider.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.updateBoundingBox=this.updateBoundingBox.bind(this),this.el.addEventListener("model-loaded",this.onModelLoaded),this.updateCollider(),this.system.addCollider(this.el)},remove:function(){this.system.removeCollider(this.el)},update:function(){this.data.trackedObject3D&&(this.trackedObject3DPath=this.data.trackedObject3D.split("."))},onModelLoaded:function(){this.data.centerModel&&this.centerModel(),this.updateCollider()},centerModel:function(){var e,i=this.el,n=i.components["gltf-model"]&&i.components["gltf-model"].model;n&&(this.el.removeObject3D("mesh"),e=new f.Box3().setFromObject(n).getCenter(new f.Vector3),n.position.x+=n.position.x-e.x,n.position.y+=n.position.y-e.y,n.position.z+=n.position.z-e.z,this.el.setObject3D("mesh",n))},updateCollider:function(){var e=this.el,i=this.boundingBoxSize,n=this.aabb=this.aabb||new f.OBB;if(this.obb=this.obb||new f.OBB,!e.hasLoaded){e.addEventListener("loaded",this.updateCollider);return}this.updateBoundingBox(),n.halfSize.copy(i).multiplyScalar(.5),this.el.sceneEl.systems["obb-collider"].data.showColliders&&this.showCollider()},showCollider:function(){this.updateColliderMesh(),this.renderColliderMesh.visible=!0},updateColliderMesh:function(){var e=this.renderColliderMesh,i=this.boundingBoxSize;if(!e){this.initColliderMesh();return}e.geometry.dispose(),e.geometry=new f.BoxGeometry(i.x,i.y,i.z)},hideCollider:function(){this.renderColliderMesh&&(this.renderColliderMesh.visible=!1)},initColliderMesh:function(){var e,i,n;e=this.boundingBoxSize,i=this.renderColliderGeometry=new f.BoxGeometry(e.x,e.y,e.z),(n=this.renderColliderMesh=new f.Mesh(i,new f.MeshLambertMaterial({color:65280,side:f.DoubleSide}))).matrixAutoUpdate=!1,n.matrixWorldAutoUpdate=!1,n.updateMatrixWorld=function(){},this.el.sceneEl.object3D.add(n)},updateBoundingBox:(r=new f.Vector3,s=new f.Vector3,a=new f.Quaternion,o=new f.Quaternion,l=new f.Matrix4,function(){var e=this.auxEuler,i=this.boundingBox,n=this.data.size,h=this.trackedObject3D||this.el.object3D,u=this.boundingBoxSize,c=this.data.minimumColliderDimension;if(n){this.boundingBoxSize.x=n,this.boundingBoxSize.y=n,this.boundingBoxSize.z=n;return}e.copy(h.rotation),h.rotation.set(0,0,0),h.parent.matrixWorld.decompose(r,a,s),l.compose(r,o,s),h.parent.matrixWorld.copy(l),i.setFromObject(h,!0),i.getSize(u),u.x=u.x<c?c:u.x,u.y=u.y<c?c:u.y,u.z=u.z<c?c:u.z,h.parent.matrixWorld.compose(r,a,s),this.el.object3D.rotation.copy(e)}),checkTrackedObject:function(){var e,i=this.trackedObject3DPath;if(i&&i.length&&!this.trackedObject3D){e=this.el;for(var n=0;n<i.length&&(e=e[i[n]]);n++);e&&(this.trackedObject3D=e,this.updateCollider())}return this.trackedObject3D},tick:(h=new f.Vector3,u=new f.Vector3,c=new f.Quaternion,d=new f.Matrix4,function(){var e=this.obb,i=this.renderColliderMesh,n=this.checkTrackedObject()||this.el.object3D;n&&(n.updateMatrix(),n.updateMatrixWorld(!0),n.matrixWorld.decompose(h,c,u),(Math.abs(u.x-this.previousScale.x)>1e-4||Math.abs(u.y-this.previousScale.y)>1e-4||Math.abs(u.z-this.previousScale.z)>1e-4)&&this.updateCollider(),this.previousScale.copy(u),u.set(1,1,1),d.compose(h,c,u),i&&i.matrixWorld.copy(d),e.copy(this.aabb),e.applyMatrix4(d))})})},"./src/components/obj-model.js":(e,i,n)=>{var r=n("./src/utils/debug.js"),s=n("./src/core/component.js").registerComponent,a=n("./src/lib/three.js"),o=r("components:obj-model:warn");e.exports.Component=s("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var e=this;this.model=null,this.objLoader=new a.OBJLoader,this.mtlLoader=new a.MTLLoader(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(i){e.model&&"material"===i.detail.name&&e.applyMaterial()})},update:function(){var e=this.data;e.obj&&(this.resetMesh(),this.loadObj(e.obj,e.mtl))},remove:function(){this.resetMesh()},resetMesh:function(){this.model&&this.el.removeObject3D("mesh")},loadObj:function(e,i){var n=this,r=this.el,s=this.mtlLoader,a=this.objLoader,l=this.el.sceneEl.systems.renderer,h=i.substr(0,i.lastIndexOf("/")+1);if(i){r.hasAttribute("material")&&o("Material component properties are ignored when a .MTL is provided"),s.setResourcePath(h),s.load(i,function(i){i.preload(),a.setMaterials(i),a.load(e,function(e){n.model=e,n.model.traverse(function(e){if(e.isMesh){var i=e.material;i.map&&l.applyColorCorrection(i.map),i.emissiveMap&&l.applyColorCorrection(i.emissiveMap)}}),r.setObject3D("mesh",e),r.emit("model-loaded",{format:"obj",model:e})})});return}a.load(e,function(e){n.model=e,n.applyMaterial(),r.setObject3D("mesh",e),r.emit("model-loaded",{format:"obj",model:e})})},applyMaterial:function(){var e=this.el.components.material;e&&this.model.traverse(function(i){i instanceof a.Mesh&&(i.material=e.material)})}})},"./src/components/oculus-go-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/tracked-controls.js"),a=s.checkControllerPresentAndSetup,o=s.emitIfAxesChanged,l=s.onButtonEvent,h=n("./src/utils/index.js").device.isWebXRAvailable,u=n("./src/constants/index.js").AFRAME_CDN_ROOT+"controllers/oculus/go/oculus-go-controller.gltf",c=h?"oculus-go":"Oculus Go";e.exports.Component=r("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:h?{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){l(i.detail.id,"down",e)},this.onButtonUp=function(i){l(i.detail.id,"up",e)},this.onButtonTouchStart=function(i){l(i.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(i){l(i.detail.id,"touchend",e)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){a(this,c,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,i=this.data;e.setAttribute("tracked-controls",{armModel:i.armModel,hand:i.hand,idPrefix:c,orientationOffset:i.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",u)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(e){var i,n=e.detail.model;e.target===this.el&&this.data.model&&((i=this.buttonMeshes={}).trigger=n.getObjectByName("oculus_go_button_trigger"),i.trackpad=n.getObjectByName("oculus_go_touchpad"),i.touchpad=n.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(e){var i=this.mapping.buttons[e.detail.id];i&&this.el.emit(i+"changed",e.detail.state)},onAxisMoved:function(e){o(this,this.mapping.axes,e)},updateModel:function(e,i){this.data.model&&this.updateButtonModel(e,i)},updateButtonModel:function(e,i){var n,r=this.buttonMeshes;if(r&&r[e]){switch(i){case"down":n=this.data.buttonHighlightColor;break;case"touchstart":n=this.data.buttonTouchedColor;break;default:n=this.data.buttonColor}r[e].material.color.set(n)}}})},"./src/components/oculus-touch-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js"),a=n("./src/utils/tracked-controls.js"),o=a.checkControllerPresentAndSetup,l=a.emitIfAxesChanged,h=a.onButtonEvent,u=n("./src/utils/index.js").device.isWebXRAvailable,c="oculus-touch",d=u?c:"Oculus Touch",p=n("./src/constants/index.js").AFRAME_CDN_ROOT,f=p+"controllers/oculus/oculus-touch-controller-",m=p+"controllers/meta/",g={left:{modelUrl:f+"left.gltf",rayOrigin:{origin:{x:.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new s.Vector3(-.005,.003,-.055),modelPivotRotation:new s.Euler(0,0,0)},right:{modelUrl:f+"right.gltf",rayOrigin:{origin:{x:-.008,y:-.01,z:0},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new s.Vector3(.005,.003,-.055),modelPivotRotation:new s.Euler(0,0,0)}},A={left:{modelUrl:f+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new s.Vector3(-.005,.036,-.037),modelPivotRotation:new s.Euler(Math.PI/4.5,0,0)},right:{modelUrl:f+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new s.Vector3(.005,.036,-.037),modelPivotRotation:new s.Euler(Math.PI/4.5,0,0)}},v="oculus-touch",y={"oculus-touch":u?A:g,"oculus-touch-v2":{left:{modelUrl:f+"gen2-left.gltf",rayOrigin:{origin:{x:-.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new s.Vector3(0,-.007,-.021),modelPivotRotation:new s.Euler(-Math.PI/4,0,0)},right:{modelUrl:f+"gen2-right.gltf",rayOrigin:{origin:{x:.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new s.Vector3(0,-.007,-.021),modelPivotRotation:new s.Euler(-Math.PI/4,0,0)}},"oculus-touch-v3":{left:{modelUrl:f+"v3-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new s.Vector3(0,0,0),modelPivotRotation:new s.Euler(0,0,0)},right:{modelUrl:f+"v3-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new s.Vector3(0,0,0),modelPivotRotation:new s.Euler(0,0,0)}},"meta-quest-touch-pro":{left:{modelUrl:m+"quest-touch-pro-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new s.Vector3(0,0,0),modelPivotRotation:new s.Euler(0,0,0)},right:{modelUrl:m+"quest-touch-pro-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new s.Vector3(0,0,0),modelPivotRotation:new s.Euler(0,0,0)}},"meta-quest-touch-plus":{left:{modelUrl:m+"quest-touch-plus-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new s.Vector3(0,0,0),modelPivotRotation:new s.Euler(0,0,0)},right:{modelUrl:m+"quest-touch-plus-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new s.Vector3(0,0,0),modelPivotRotation:new s.Euler(0,0,0)}}};e.exports.Component=r("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},after:["tracked-controls"],mapping:u?{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}}:{left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},bindMethods:function(){this.onButtonChanged=this.onButtonChanged.bind(this),this.onThumbstickMoved=this.onThumbstickMoved.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this;this.onButtonDown=function(i){h(i.detail.id,"down",e,e.data.hand)},this.onButtonUp=function(i){h(i.detail.id,"up",e,e.data.hand)},this.onButtonTouchStart=function(i){h(i.detail.id,"touchstart",e,e.data.hand)},this.onButtonTouchEnd=function(i){h(i.detail.id,"touchend",e,e.data.hand)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.triggerEuler=new s.Euler},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){o(this,d,{hand:this.data.hand,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(e){var i,n=this.data;if(n.model){if(this.controllerObject3D){this.el.setObject3D("mesh",this.controllerObject3D);return}if(this.displayModel=y[n.controllerType]||y[v],"auto"===n.controllerType){var r=this.el.sceneEl.systems["tracked-controls-webvr"];if(r&&r.vrDisplay){var s=r.vrDisplay.displayName;/^Oculus Quest$/.test(s)&&(this.displayModel=y["oculus-touch-v2"])}else{i=v;for(var a=Object.keys(y),o=0;o<e.profiles.length;o++)if(-1!==a.indexOf(e.profiles[o])){i=e.profiles[o];break}this.displayModel=y[i]}}var l=this.displayModel[n.hand].modelUrl;this.isTouchV3orPROorPlus=this.displayModel===y["oculus-touch-v3"]||this.displayModel===y["meta-quest-touch-pro"]||this.displayModel===y["meta-quest-touch-plus"],this.el.setAttribute("gltf-model",l)}},injectTrackedControls:function(e){var i=this.data,n="right"===i.hand?"Oculus Touch (Right)":"Oculus Touch (Left)";this.el.setAttribute("tracked-controls",{id:u?c:n,hand:i.hand,orientationOffset:i.orientationOffset,handTrackingEnabled:!1,iterateControllerProfiles:!0,space:"gripSpace"}),this.loadModel(e)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var i=this.mapping[this.data.hand].buttons[e.detail.id];if(i){if(this.isTouchV3orPROorPlus)this.onButtonChangedV3orPROorPlus(e);else{var n,r=this.buttonMeshes;("trigger"===i||"grip"===i)&&(n=e.detail.state.value),r&&("trigger"===i&&r.trigger&&(r.trigger.rotation.x=this.originalXRotationTrigger-Math.PI/26*n),"grip"===i&&r.grip&&(n*="left"===this.data.hand?-1:1,r.grip.position.x=this.originalXPositionGrip+.004*n))}this.el.emit(i+"changed",e.detail.state)}},onButtonChangedV3orPROorPlus:function(e){var i,n=this.mapping[this.data.hand].buttons[e.detail.id],r=this.buttonObjects;r&&r[n]&&(i=e.detail.state.value,r[n].quaternion.slerpQuaternions(this.buttonRanges[n].min.quaternion,this.buttonRanges[n].max.quaternion,i),r[n].position.lerpVectors(this.buttonRanges[n].min.position,this.buttonRanges[n].max.position,i))},onModelLoaded:function(e){if(e.target===this.el&&this.data.model){if(this.isTouchV3orPROorPlus)this.onTouchV3orPROorPlusModelLoaded(e);else{var i,n=this.controllerObject3D=e.detail.model;(i=this.buttonMeshes={}).grip=n.getObjectByName("buttonHand"),this.originalXPositionGrip=i.grip&&i.grip.position.x,i.trigger=n.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=i.trigger&&i.trigger.rotation.x,i.thumbstick=n.getObjectByName("stick"),i.xbutton=n.getObjectByName("buttonX"),i.abutton=n.getObjectByName("buttonA"),i.ybutton=n.getObjectByName("buttonY"),i.bbutton=n.getObjectByName("buttonB")}for(var r in this.buttonMeshes)this.buttonMeshes[r]&&function(e){e.traverse(function(i){var n;"Mesh"===i.type&&(n=i.material.clone(),e.originalColor=i.material.color,i.material.dispose(),i.material=n)})}(this.buttonMeshes[r]);this.applyOffset(e.detail.model),this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin})}},applyOffset:function(e){e.position.copy(this.displayModel[this.data.hand].modelPivotOffset),e.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation)},onTouchV3orPROorPlusModelLoaded:function(e){var i=this.controllerObject3D=e.detail.model,n=this.buttonObjects={},r=this.buttonMeshes={},s=this.buttonRanges={};r.grip=i.getObjectByName("squeeze"),n.grip=i.getObjectByName("xr_standard_squeeze_pressed_value"),s.grip={min:i.getObjectByName("xr_standard_squeeze_pressed_min"),max:i.getObjectByName("xr_standard_squeeze_pressed_max")},n.grip.minX=n.grip.position.x,r.thumbstick=i.getObjectByName("thumbstick"),n.thumbstick=i.getObjectByName("xr_standard_thumbstick_pressed_value"),s.thumbstick={min:i.getObjectByName("xr_standard_thumbstick_pressed_min"),max:i.getObjectByName("xr_standard_thumbstick_pressed_max")},n.thumbstickXAxis=i.getObjectByName("xr_standard_thumbstick_xaxis_pressed_value"),s.thumbstickXAxis={min:i.getObjectByName("xr_standard_thumbstick_xaxis_pressed_min"),max:i.getObjectByName("xr_standard_thumbstick_xaxis_pressed_max")},n.thumbstickYAxis=i.getObjectByName("xr_standard_thumbstick_yaxis_pressed_value"),s.thumbstickYAxis={min:i.getObjectByName("xr_standard_thumbstick_yaxis_pressed_min"),max:i.getObjectByName("xr_standard_thumbstick_yaxis_pressed_max")},r.trigger=i.getObjectByName("trigger"),n.trigger=i.getObjectByName("xr_standard_trigger_pressed_value"),s.trigger={min:i.getObjectByName("xr_standard_trigger_pressed_min"),max:i.getObjectByName("xr_standard_trigger_pressed_max")},s.trigger.diff={x:Math.abs(s.trigger.max.rotation.x)-Math.abs(s.trigger.min.rotation.x),y:Math.abs(s.trigger.max.rotation.y)-Math.abs(s.trigger.min.rotation.y),z:Math.abs(s.trigger.max.rotation.z)-Math.abs(s.trigger.min.rotation.z)};var a="left"===this.data.hand?"x":"a",o="left"===this.data.hand?"y":"b",l=a+"button",h=o+"button";r[l]=i.getObjectByName(a+"_button"),n[l]=i.getObjectByName(a+"_button_pressed_value"),s[l]={min:i.getObjectByName(a+"_button_pressed_min"),max:i.getObjectByName(a+"_button_pressed_max")},r[h]=i.getObjectByName(o+"_button"),n[h]=i.getObjectByName(o+"_button_pressed_value"),s[h]={min:i.getObjectByName(o+"_button_pressed_min"),max:i.getObjectByName(o+"_button_pressed_max")}},onAxisMoved:function(e){l(this,this.mapping[this.data.hand].axes,e)},onThumbstickMoved:function(e){if(this.buttonMeshes&&this.buttonMeshes.thumbstick){if(this.isTouchV3orPROorPlus){this.updateThumbstickTouchV3orPROorPlus(e);return}for(var i in e.detail)this.buttonObjects.thumbstick.rotation[this.axisMap[i]]=this.buttonRanges.thumbstick.originalRotation[this.axisMap[i]]-Math.PI/8*e.detail[i]*("y"===i||"right"===this.data.hand?-1:1)}},axisMap:{y:"x",x:"z"},updateThumbstickTouchV3orPROorPlus:function(e){var i=(e.detail.x+1)/2;this.buttonObjects.thumbstickXAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickXAxis.min.quaternion,this.buttonRanges.thumbstickXAxis.max.quaternion,i);var n=(e.detail.y+1)/2;this.buttonObjects.thumbstickYAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickYAxis.min.quaternion,this.buttonRanges.thumbstickYAxis.max.quaternion,n)},updateModel:function(e,i){this.data.model&&this.updateButtonModel(e,i)},updateButtonModel:function(e,i){var n,r=this.buttonMeshes;r&&r[e]&&(n="up"===i||"touchend"===i?r[e].originalColor||this.data.buttonColor:"touchstart"===i?this.data.buttonTouchColor:this.data.buttonHighlightColor,r[e].material.color.set(n))}})},"./src/components/pico-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js"),a=n("./src/utils/tracked-controls.js"),o=a.checkControllerPresentAndSetup,l=a.emitIfAxesChanged,h=a.onButtonEvent,u="pico-4",c=n("./src/constants/index.js").AFRAME_CDN_ROOT+"controllers/pico/pico4/";e.exports.Component=r("pico-controls",{schema:{hand:{default:"none"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{left:{axes:{touchpad:[2,3]},buttons:["trigger","squeeze","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","squeeze","none","thumbstick","abutton","bbutton"]}},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){h(i.detail.id,"down",e,e.data.hand)},this.onButtonUp=function(i){h(i.detail.id,"up",e,e.data.hand)},this.onButtonTouchEnd=function(i){h(i.detail.id,"touchend",e,e.data.hand)},this.onButtonTouchStart=function(i){h(i.detail.id,"touchstart",e,e.data.hand)},this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;o(this,u,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,i=this.data;e.setAttribute("tracked-controls",{idPrefix:u,hand:i.hand,controller:this.controllerIndex,orientationOffset:i.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",c+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var i=this.mapping[this.data.hand].buttons[e.detail.id];i&&("trigger"===i&&console.log("analog value of trigger press: "+e.detail.state.value),this.el.emit(i+"changed",e.detail.state))},onModelLoaded:function(e){e.target===this.el&&this.data.model&&this.el.emit("controllermodelready",{name:"pico-controls",model:this.data.model,rayOrigin:new s.Vector3(0,0,0)})},onAxisMoved:function(e){l(this,this.mapping.axes,e)}})},"./src/components/position.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("position",{schema:{type:"vec3"},update:function(){var e=this.el.object3D,i=this.data;e.position.set(i.x,i.y,i.z)},remove:function(){this.el.object3D.position.set(0,0,0)}})},"./src/components/raycaster.js":(e,i,n)=>{var r,s,a=n("./src/core/component.js").registerComponent,o=n("./src/lib/three.js"),l=n("./src/utils/index.js").debug("components:raycaster:warn"),h=/^[\w\s-.,[\]#]*$/,u={childList:!0,attributes:!0,subtree:!0},c={INTERSECT:"raycaster-intersected",INTERSECTION:"raycaster-intersection",INTERSECT_CLEAR:"raycaster-intersected-cleared",INTERSECTION_CLEAR:"raycaster-intersection-cleared",INTERSECTION_CLOSEST_ENTITY_CHANGED:"raycaster-closest-entity-changed"};function d(e,i){var n;for(n=0,e.length=i.length;n<i.length;n++)e[n]=i[n]}e.exports.Component=a("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new o.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new o.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new o.Vector3,this.otherLineEndVec3=new o.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(e){var i=this.data,n=this.el,r=this.raycaster;r.far=i.far,r.near=i.near,i.showLine&&(i.far!==e.far||i.origin!==e.origin||i.direction!==e.direction||!e.showLine)&&(this.unitLineEndVec3.copy(i.direction).normalize(),this.drawLine()),!i.showLine&&e.showLine&&n.removeAttribute("line"),i.objects===e.objects||h.test(i.objects)||l('[raycaster] Selector "'+i.objects+'" may not update automatically with DOM changes.'),i.objects||l('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),i.autoRefresh!==e.autoRefresh&&n.isPlaying&&(i.autoRefresh?this.addEventListeners():this.removeEventListeners()),e.enabled&&!i.enabled&&this.clearAllIntersections(),this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,u),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var e,i=this.data;e=i.objects?this.el.sceneEl.querySelectorAll(i.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(e),this.dirty=!1},tock:function(e){var i=this.data,n=this.prevCheckTime;i.enabled&&(!n||!(e-n<i.interval))&&(this.prevCheckTime=e,this.checkIntersections())},checkIntersections:function(){var e,i,n=this.clearedIntersectedEls,r=this.el,s=this.data,a=this.intersectedEls,o=this.intersections,l=this.newIntersectedEls,h=this.newIntersections,u=this.prevIntersectedEls,p=this.rawIntersections;for(this.dirty&&this.refreshObjects(),d(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),p.length=0,this.raycaster.intersectObjects(this.objects,!0,p),o.length=0,a.length=0,e=0;e<p.length;e++)i=p[e],(!s.showLine||i.object!==r.getObject3D("line"))&&i.object.el&&(o.push(i),a.push(i.object.el));for(e=0,h.length=0,l.length=0;e<o.length;e++)-1===u.indexOf(o[e].object.el)&&(h.push(o[e]),l.push(o[e].object.el));for(e=0,n.length=0;e<u.length;e++)-1===a.indexOf(u[e])&&(u[e].emit(c.INTERSECT_CLEAR,this.intersectedClearedDetail),n.push(u[e]));for(n.length&&r.emit(c.INTERSECTION_CLEAR,this.intersectionClearedDetail),e=0;e<l.length;e++)l[e].emit(c.INTERSECT,this.intersectedDetail);h.length&&(this.intersectionDetail.els=l,this.intersectionDetail.intersections=h,r.emit(c.INTERSECTION,this.intersectionDetail)),(0===u.length&&o.length>0||u.length>0&&0===o.length||u.length&&o.length&&u[0]!==o[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=o,r.emit(c.INTERSECTION_CLOSEST_ENTITY_CHANGED,this.intersectionDetail)),s.showLine&&setTimeout(this.updateLine)},updateLine:function(){var e,i=this.el,n=this.intersections;n.length&&(e=n[0].object.el===i&&n[1]?n[1].distance:n[0].distance),this.drawLine(e)},getIntersection:function(e){var i,n;for(i=0;i<this.intersections.length;i++)if((n=this.intersections[i]).object.el===e)return n;return null},updateOriginDirection:(r=new o.Vector3,s=new o.Vector3,function(){var e=this.el,i=this.data;if(i.useWorldCoordinates){this.raycaster.set(i.origin,i.direction);return}e.object3D.updateMatrixWorld(),s.setFromMatrixPosition(e.object3D.matrixWorld),(0!==i.origin.x||0!==i.origin.y||0!==i.origin.z)&&(s=e.object3D.localToWorld(s.copy(i.origin))),r.copy(i.direction).transformDirection(e.object3D.matrixWorld).normalize(),this.raycaster.set(s,r)}),drawLine:function(e){var i,n=this.data,r=this.el;i=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,void 0===e&&(e=n.far===1/0?1e3:n.far),this.lineData.start=n.origin,this.lineData.end=i.copy(this.unitLineEndVec3).multiplyScalar(e).add(n.origin),this.lineData.color=n.lineColor,this.lineData.opacity=n.lineOpacity,r.setAttribute("line",this.lineData)},flattenObject3DMaps:function(e){var i,n,r=this.objects,s=this.el.sceneEl.object3D;for(n=0,r.length=0;n<e.length;n++){var a=e[n];if(a.isEntity&&a.object3D&&function e(i){return i.parent?e(i.parent):i===s}(a.object3D))for(i in a.object3DMap)r.push(a.getObject3D(i))}return r},clearAllIntersections:function(){var e;for(e=0;e<this.intersectedEls.length;e++)this.intersectedEls[e].emit(c.INTERSECT_CLEAR,this.intersectedClearedDetail);d(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(c.INTERSECTION_CLEAR,this.intersectionClearedDetail)}})},"./src/components/rotation.js":(e,i,n)=>{var r=n("./src/lib/three.js").MathUtils.degToRad,s=n("./src/core/component.js").registerComponent;e.exports.Component=s("rotation",{schema:{type:"vec3"},update:function(){var e=this.data;this.el.object3D.rotation.set(r(e.x),r(e.y),r(e.z),"YXZ")},remove:function(){this.el.object3D.rotation.set(0,0,0)}})},"./src/components/scale.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var e=this.data;this.el.object3D.scale.set(e.x,e.y,e.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}})},"./src/components/scene/ar-hit-test.js":(e,i,n)=>{var r,s,a,o=n("./src/core/component.js").registerComponent,l=n("./src/lib/three.js"),h=(s=new l.Quaternion,a=new l.Vector3,function(e,i,n){i.position.copy(e.transform.position),i.quaternion.copy(e.transform.orientation),a.copy(n),s.copy(e.transform.orientation),a.applyQuaternion(s),i.position.sub(a)});function u(e,i){this.renderer=e,this.xrHitTestSource=null,e.xr.addEventListener("sessionend",(function(){this.xrHitTestSource=null}).bind(this)),e.xr.addEventListener("sessionstart",(function(){this.sessionStart(i)}).bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(i)}function c(e){console.warn(e.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}h.tempFakePose={transform:{orientation:new l.Quaternion,position:new l.Vector3}},u.prototype.previousFrameAnchors=new Set,u.prototype.anchorToObject3D=new Map,u.prototype.sessionStart=function(e){if(this.session=this.renderer.xr.getSession(),!("requestHitTestSource"in this.session)){c({message:"No requestHitTestSource on the session."});return}e.space?this.session.requestHitTestSource(e).then((function(e){this.xrHitTestSource=e}).bind(this)).catch(c):e.profile&&this.session.requestHitTestSourceForTransientInput(e).then((function(e){this.xrHitTestSource=e,this.transient=!0}).bind(this)).catch(c)},u.prototype.anchorFromLastHitTestResult=function(e,i){var n=this.lastHitTest;if(n){var r={object3D:e,offset:i};Array.from(this.anchorToObject3D.entries()).forEach((function(i){var n=i[1].object3D,r=i[0];n===e&&(this.anchorToObject3D.delete(r),r.delete())}).bind(this)),n.createAnchor&&n.createAnchor().then((function(e){this.anchorToObject3D.set(e,r)}).bind(this)).catch(function(e){console.warn(e.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},u.prototype.doHit=function(e){if(this.renderer.xr.isPresenting){var i,n,r=this.renderer.xr.getReferenceSpace(),s=e.getViewerPose(r);if(this.xrHitTestSource&&s)return this.transient?(i=e.getHitTestResultsForTransientInput(this.xrHitTestSource)).length>0&&(n=i[0].results).length>0&&(this.lastHitTest=n[0],n[0].getPose(r)):(i=e.getHitTestResults(this.xrHitTestSource)).length>0&&(this.lastHitTest=i[0],i[0].getPose(r))}},u.updateAnchorPoses=function(e,i){var n=e.trackedAnchors||u.prototype.previousFrameAnchors;u.prototype.previousFrameAnchors.forEach(function(e){n.has(e)||u.prototype.anchorToObject3D.delete(e)}),n.forEach(function(n){var r,s,a;try{r=e.getPose(n.anchorSpace,i)}catch(e){}if(r){if(!(s=u.prototype.anchorToObject3D.get(n)))return;a=s.offset,h(r,s.object3D,a)}})},e.exports.Component=o("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:"data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},sceneOnly:!0,init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new l.OrthographicCamera,this.orthoCam.layers.set(21),this.textureTarget=new l.WebGLRenderTarget(512,512,{}),this.basicMaterial=new l.MeshBasicMaterial({color:0,side:l.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new l.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var e=this.el.getAttribute("webxr"),i=e.optionalFeatures;i.includes("hit-test")&&i.includes("anchors")||(i.push("hit-test"),i.push("anchors"),this.el.setAttribute("webxr",e)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",(function(){this.hitTest=null}).bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",(function(){if(this.el.is("ar-mode")){var e=this.el.sceneEl.renderer,i=this.session=e.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,r||(r=new Map),i.requestReferenceSpace("viewer").then((function(i){this.hitTest=new u(e,{space:i}),r.set(i,this.hitTest),this.el.emit("ar-hit-test-start")}).bind(this));var n="generic-touchscreen",s=new u(e,{profile:n});i.addEventListener("selectstart",(function(i){if(!0===this.data.enabled){var a=i.inputSource;this.bboxMesh.visible=!0,!0===this.hasPosedOnce&&(this.el.emit("ar-hit-test-select-start",{inputSource:a,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),a.profiles[0]===n?this.hitTest=s:(this.hitTest=r.get(a)||new u(e,{space:a.targetRaySpace}),r.set(a,this.hitTest)))}}).bind(this)),i.addEventListener("selectend",(function(e){if(!this.hitTest||!0!==this.data.enabled){this.hitTest=null;return}var i,n=e.inputSource;!0===this.hasPosedOnce&&(this.bboxMesh.visible=!1,this.data.target&&(i=this.data.target.object3D)&&(h.tempFakePose.transform.position.copy(this.bboxMesh.position),h.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),h(h.tempFakePose,i,this.bboxOffset),i.visible=!0,this.hitTest.anchorFromLastHitTestResult(i,this.bboxOffset)),this.el.emit("ar-hit-test-select",{inputSource:n,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion})),this.hitTest=null}).bind(this))}}).bind(this)),this.bboxOffset=new l.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){!1===this.data.enabled&&(this.hitTest=null,this.bboxMesh.visible=!1),this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(21),this.data.target.object3D.traverse(function(e){e.layers.enable(21)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var e=new l.PlaneGeometry(1,1),i=new l.MeshBasicMaterial({transparent:!0,color:0xffffff});e.rotateX(-Math.PI/2),e.rotateY(-Math.PI/2),this.bbox=new l.Box3,this.bboxMesh=new l.Mesh(e,i),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var e,i,n,r=this.el.sceneEl.renderer,s=r.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),i=r.getRenderTarget(),r.setRenderTarget(this.textureTarget),r.xr.enabled=!1,n=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,r.render(this.el.object3D,this.orthoCam),this.el.object3D.background=n,this.el.object3D.overrideMaterial=null,r.xr.enabled=s,r.setRenderTarget(i),r.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),e=this.context.getImageData(0,0,512,512);for(var a=0;a<262144;a++)0!==e.data[4*a+3]&&255!==e.data[4*a+3]&&(e.data[4*a+3]=128);this.context.putImageData(e,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var e,i,n=this.el.sceneEl.frame,r=this.el.sceneEl.renderer;n&&u.updateAnchorPoses(n,r.xr.getReferenceSpace()),this.bboxNeedsUpdate&&(this.bboxNeedsUpdate=!1,this.data.target&&"map"!==this.data.type||(this.textureCache.has(this.data.src)?i=this.textureCache.get(this.data.src):(i=new l.TextureLoader().load(this.data.src),this.textureCache.set(this.data.src,i)),this.bboxMesh.material.map=i,this.bboxMesh.material.needsUpdate=!0),this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),"footprint"===this.data.type&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)),this.hitTest&&(e=this.hitTest.doHit(n))&&(!0!==this.hasPosedOnce&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(e.transform.position),this.bboxMesh.quaternion.copy(e.transform.orientation))}})},"./src/components/scene/background.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},sceneOnly:!0,update:function(){var e=this.data,i=this.el.object3D;e.transparent?i.background=null:i.background=new THREE.Color(e.color)},remove:function(){this.el.object3D.background=null}})},"./src/components/scene/debug.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("debug",{schema:{default:!0},sceneOnly:!0})},"./src/components/scene/device-orientation-permission-ui.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/constants/index.js"),a="a-dialog-buttons-container",o="a-dialog-button";function l(e,i){var n,r,a,o;return(n=document.createElement("div")).classList.add("a-modal"),n.setAttribute(s.AFRAME_INJECTED,""),(r=document.createElement("div")).className="a-dialog",r.setAttribute(s.AFRAME_INJECTED,""),n.appendChild(r),(a=document.createElement("div")).classList.add("a-dialog-text-container"),r.appendChild(a),(o=document.createElement("div")).classList.add("a-dialog-text"),o.innerHTML=e,a.appendChild(o),r.appendChild(i),n}e.exports.Component=r("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},sceneOnly:!0,init:function(){var e=this;if(this.data.enabled){if(window.isSecureContext||this.showHTTPAlert(),"undefined"==typeof DeviceOrientationEvent||!DeviceOrientationEvent.requestPermission){this.permissionGranted=!0;return}this.onDeviceMotionDialogAllowClicked=this.onDeviceMotionDialogAllowClicked.bind(this),this.onDeviceMotionDialogDenyClicked=this.onDeviceMotionDialogDenyClicked.bind(this),DeviceOrientationEvent.requestPermission().then(function(){e.el.emit("deviceorientationpermissiongranted"),e.permissionGranted=!0}).catch(function(){var i,n,r,h,u,c,d,p;e.devicePermissionDialogEl=(i=e.data.denyButtonText,n=e.data.allowButtonText,r=e.data.deviceMotionMessage,h=e.onDeviceMotionDialogAllowClicked,u=e.onDeviceMotionDialogDenyClicked,(c=document.createElement("div")).classList.add(a),(d=document.createElement("button")).classList.add(o,"a-dialog-deny-button"),d.setAttribute(s.AFRAME_INJECTED,""),d.innerHTML=i,c.appendChild(d),(p=document.createElement("button")).classList.add(o,"a-dialog-allow-button"),p.setAttribute(s.AFRAME_INJECTED,""),p.innerHTML=n,c.appendChild(p),p.addEventListener("click",function(e){e.stopPropagation(),h()}),d.addEventListener("click",function(e){e.stopPropagation(),u()}),l(r,c)),e.el.appendChild(e.devicePermissionDialogEl)})}},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var e,i,n,r,h,u=this,c=(e=u.data.cancelButtonText,i=u.data.httpsMessage,n=function(){u.el.removeChild(c)},(r=document.createElement("div")).classList.add(a),(h=document.createElement("button")).classList.add(o,"a-dialog-ok-button"),h.setAttribute(s.AFRAME_INJECTED,""),h.innerHTML=e,r.appendChild(h),h.addEventListener("click",function(e){e.stopPropagation(),n()}),l(i,r));this.el.appendChild(c)},onDeviceMotionDialogAllowClicked:function(){var e=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(i){"granted"===i?(e.el.emit("deviceorientationpermissiongranted"),e.permissionGranted=!0):e.el.emit("deviceorientationpermissionrejected"),e.remove()}).catch(console.error)}})},"./src/components/scene/embedded.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("embedded",{dependencies:["xr-mode-ui"],schema:{default:!0},sceneOnly:!0,update:function(){var e=this.el,i=e.querySelector(".a-enter-vr");!0===this.data?(i&&i.classList.add("embedded"),e.removeFullScreenStyles()):(i&&i.classList.remove("embedded"),e.addFullScreenStyles())}})},"./src/components/scene/fog.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js");n("./src/utils/debug.js")("components:fog:warn"),e.exports.Component=r("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},sceneOnly:!0,update:function(){var e,i,n=this.data,r=this.el,a=this.el.object3D.fog;if(!a||n.type!==a.name){r.object3D.fog=((i="exponential"===(e=n).type?new s.FogExp2(e.color,e.density):new s.Fog(e.color,e.near,e.far)).name=e.type,i);return}Object.keys(this.schema).forEach(function(e){var i=n[e];"color"===e&&(i=new s.Color(i)),a[e]=i})},remove:function(){var e=this.el;this.el.object3D.fog&&(e.object3D.fog=null)}})},"./src/components/scene/inspector.js":(e,i,n)=>{var r,s=n("./src/constants/index.js").AFRAME_INJECTED,a=n("./package.json"),o=n("./src/core/component.js").registerComponent,l=n("./src/utils/index.js"),h="https://unpkg.com/aframe-inspector@"+((r=a.version.split("."))[2]="x",r.join("."))+"/dist/aframe-inspector.min.js";e.exports.Component=o("inspector",{schema:{url:{default:h}},sceneOnly:!0,init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var e;this.firstPlay&&"false"!==(e=l.getUrlParameter("inspector"))&&e&&(this.openInspector(),this.firstPlay=!1)},initOverlay:function(){this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML='Loading Inspector<span class="dots"><span>.</span><span>.</span><span>.</span></span>'},remove:function(){this.removeEventListeners()},onKeydown:function(e){73===e.keyCode&&(e.ctrlKey&&e.altKey||e.getModifierState("AltGraph"))&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(e){"INJECT_AFRAME_INSPECTOR"===e.data&&this.openInspector()},openInspector:function(e){var i,n=this;if(AFRAME.INSPECTOR||AFRAME.inspectorInjected){AFRAME.INSPECTOR.open(e);return}this.showLoader(),(i=document.createElement("script")).src=this.data.url,i.setAttribute("data-name","aframe-inspector"),i.setAttribute(s,""),i.onload=function(){AFRAME.INSPECTOR.open(e),n.hideLoader(),n.removeEventListeners()},i.onerror=function(){n.loadingMessageEl.innerHTML="Error loading Inspector"},document.head.appendChild(i),AFRAME.inspectorInjected=!0},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}})},"./src/components/scene/keyboard-shortcuts.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/index.js").shouldCaptureKeyEvent;e.exports.Component=r("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},sceneOnly:!0,init:function(){this.onKeyup=this.onKeyup.bind(this)},update:function(e){var i=this.data;this.enterVREnabled=i.enterVR},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(e){var i=this.el;s(e)&&(this.enterVREnabled&&70===e.keyCode&&i.enterVR(),this.enterVREnabled&&27===e.keyCode&&i.exitVR())}})},"./src/components/scene/pool.js":(e,i,n)=>{var r=n("./src/utils/debug.js"),s=n("./src/core/component.js").registerComponent,a=r("components:pool:warn");e.exports.Component=s("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},sceneOnly:!0,multiple:!0,initPool:function(){var e;for(this.availableEls=[],this.usedEls=[],this.data.mixin||a("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||a("Container "+this.data.container+" not found.")),this.container=this.container||this.el,e=0;e<this.data.size;++e)this.createEntity()},update:function(e){var i=this.data;(e.mixin!==i.mixin||e.size!==i.size)&&this.initPool()},createEntity:function(){(e=document.createElement("a-entity")).play=this.wrapPlay(e.play),e.setAttribute("mixin",this.data.mixin),e.object3D.visible=!1,e.pause(),this.container.appendChild(e),this.availableEls.push(e);var e,i=this.usedEls;e.addEventListener("loaded",function(){-1===i.indexOf(e)&&(e.object3DParent=e.object3D.parent,e.object3D.parent.remove(e.object3D))})},wrapPlay:function(e){var i=this.usedEls;return function(){-1!==i.indexOf(this)&&e.call(this)}},requestEntity:function(){var e;if(0===this.availableEls.length){if(!1===this.data.dynamic){a("Requested entity from empty pool: "+this.attrName);return}a("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName),this.createEntity()}return e=this.availableEls.shift(),this.usedEls.push(e),e.object3DParent&&(e.object3DParent.add(e.object3D),this.updateRaycasters()),e.object3D.visible=!0,e},returnEntity:function(e){var i=this.usedEls.indexOf(e);if(-1===i){a("The returned entity was not previously pooled from "+this.attrName);return}return this.usedEls.splice(i,1),this.availableEls.push(e),e.object3DParent=e.object3D.parent,e.object3D.parent.remove(e.object3D),this.updateRaycasters(),e.object3D.visible=!1,e.pause(),e},updateRaycasters:function(){document.querySelectorAll("[raycaster]").forEach(function(e){e.components.raycaster.setDirty()})}})},"./src/components/scene/real-world-meshing.js":(e,i,n)=>{var r,s=n("./src/core/component.js").registerComponent,a=n("./src/lib/three.js");e.exports.Component=s("real-world-meshing",{schema:{filterLabels:{type:"array"},meshesEnabled:{default:!0},meshMixin:{default:!0},planesEnabled:{default:!0},planeMixin:{default:""}},sceneOnly:!0,init:function(){var e=this.el.getAttribute("webxr"),i=e.requiredFeatures;-1===i.indexOf("mesh-detection")&&(i.push("mesh-detection"),this.el.setAttribute("webxr",e)),-1===i.indexOf("plane-detection")&&(i.push("plane-detection"),this.el.setAttribute("webxr",e)),this.meshEntities=[],this.initWorldMeshEntity=this.initWorldMeshEntity.bind(this)},tick:function(){this.el.is("ar-mode")&&(this.detectMeshes(),this.updateMeshes())},detectMeshes:function(){var e,i,n,r=this.data,s=this.el;s.renderer.xr;var a=this.meshEntities,o=!1,l=[],h=this.data.filterLabels;e=(n=s.frame).detectedMeshes,i=n.detectedPlanes;for(var u=0;u<a.length;u++)a[u].present=!1;if(r.meshesEnabled){for(var c of e.values())if(!h.length||-1!==h.indexOf(c.semanticLabel)){for(u=0;u<a.length;u++)if(c===a[u].mesh){o=!0,a[u].present=!0,a[u].lastChangedTime<c.lastChangedTime&&this.updateMeshGeometry(a[u].el,c),a[u].lastChangedTime=c.lastChangedTime;break}o||l.push(c),o=!1}}if(r.planesEnabled){for(c of i.values())if(!h.length||-1!==h.indexOf(c.semanticLabel)){for(u=0;u<a.length;u++)if(c===a[u].mesh){o=!0,a[u].present=!0,a[u].lastChangedTime<c.lastChangedTime&&this.updateMeshGeometry(a[u].el,c),a[u].lastChangedTime=c.lastChangedTime;break}o||l.push(c),o=!1}}this.deleteMeshes(),this.createNewMeshes(l)},updateMeshes:(r=new a.Matrix4,function(){for(var e,i,n,s=this.el,a=s.frame,o=this.meshEntities,l=s.renderer.xr.getReferenceSpace(),h=0;h<o.length;h++)n=o[h].mesh.meshSpace||o[h].mesh.planeSpace,e=a.getPose(n,l),(i=o[h].el).hasLoaded&&(r.fromArray(e.transform.matrix),r.decompose(i.object3D.position,i.object3D.quaternion,i.object3D.scale))}),deleteMeshes:function(){for(var e=this.meshEntities,i=[],n=0;n<e.length;n++)e[n].present?i.push(e[n]):this.el.removeChild(e[n]);this.meshEntities=i},createNewMeshes:function(e){for(var i,n=0;n<e.length;n++)i=document.createElement("a-entity"),this.meshEntities.push({mesh:e[n],el:i}),i.addEventListener("loaded",this.initWorldMeshEntity),this.el.appendChild(i)},initMeshGeometry:function(e){if(e instanceof XRPlane){n=new a.Shape,r=e.polygon;for(var i,n,r,s=0;s<r.length;++s)0===s?n.moveTo(r[s].x,r[s].z):n.lineTo(r[s].x,r[s].z);return(i=new a.ShapeGeometry(n)).rotateX(Math.PI/2),i}return(i=new a.BufferGeometry).setAttribute("position",new a.BufferAttribute(e.vertices,3)),i.setIndex(new a.BufferAttribute(e.indices,1)),i},initWorldMeshEntity:function(e){for(var i,n,r,s=e.target,o=this.meshEntities,l=0;l<o.length;l++)if(o[l].el===s){r=o[l];break}i=this.initMeshGeometry(r.mesh),n=new a.Mesh(i,new a.MeshBasicMaterial({color:0xffffff*Math.random(),side:a.DoubleSide})),s.setObject3D("mesh",n),r.mesh instanceof XRPlane&&this.data.planeMixin?s.setAttribute("mixin",this.data.planeMixin):this.data.meshMixin&&s.setAttribute("mixin",this.data.meshMixin),s.setAttribute("data-world-mesh",r.mesh.semanticLabel)},updateMeshGeometry:function(e,i){var n=e.getObject3D("mesh");n.geometry.dispose(),n.geometry=this.initMeshGeometry(i)}})},"./src/components/scene/reflection.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("reflection",{schema:{directionalLight:{type:"selector"}},sceneOnly:!0,init:function(){var e=this;this.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(16),this.cubeCamera=new THREE.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new THREE.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var i=this.el.getAttribute("webxr"),n=i.optionalFeatures;n.includes("light-estimation")||(n.push("light-estimation"),this.el.setAttribute("webxr",i)),this.el.addEventListener("enter-vr",function(){e.el.is("ar-mode")&&e.el.renderer.xr.getSession().requestLightProbe&&e.startLightProbe()}),this.el.addEventListener("exit-vr",function(){e.xrLightProbe&&e.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var e=this.el.renderer,i=e.xr.getSession(),n=this,r=e.getContext();if(!this.probeLight){var s=document.createElement("a-light");s.setAttribute("type","probe"),s.setAttribute("intensity",0),this.el.appendChild(s),this.probeLight=s}switch(i.preferredReflectionFormat){case"srgba8":r.getExtension("EXT_sRGB");break;case"rgba16f":r.getExtension("OES_texture_half_float")}this.glBinding=new XRWebGLBinding(i,r),r.getExtension("EXT_sRGB"),r.getExtension("OES_texture_half_float"),i.requestLightProbe().then(function(e){n.xrLightProbe=e,e.addEventListener("reflectionchange",n.updateXRCubeMap.bind(n))}).catch(function(e){console.warn("Lighting estimation not supported: "+e.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var e=this.el.renderer,i=this.glBinding.getReflectionCubeMap(this.xrLightProbe);i&&(e.properties.get(this.lightingEstimationTexture).__webglTexture=i,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture)},tick:function(){var e=this.el.object3D,i=this.el.renderer,n=this.el.frame;if(n&&this.xrLightProbe){var r,s,a,o,l=n.getLightEstimate(this.xrLightProbe);l&&(r=this.probeLight.components.light.light,s=this.data.directionalLight&&this.data.directionalLight.components.light.light,a=this.data.directionalLight&&this.data.directionalLight.object3D.position,o=Math.max(l.primaryLightIntensity.x,Math.max(l.primaryLightIntensity.y,l.primaryLightIntensity.z)),r.sh.fromArray(l.sphericalHarmonicsCoefficients),r.intensity=1,s&&(s.color.setRGB(l.primaryLightIntensity.x/o,l.primaryLightIntensity.y/o,l.primaryLightIntensity.z/o),s.intensity=o,a.copy(l.primaryLightDirection)))}this.needsVREnvironmentUpdate&&(e.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(i,e),e.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&n&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.probeLight&&this.el.removeChild(this.probeLight)}})},"./src/components/scene/screenshot.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js");e.exports.Component=r("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},sceneOnly:!0,setup:function(){var e=this.el;if(!this.canvas){var i=e.renderer.getContext();i&&(this.cubeMapSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),this.material=new s.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nvarying vec2 vUv;\nvoid main()  {\n  vUv = vec2( 1.- uv.x, uv.y );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform samplerCube map;\nvarying vec2 vUv;\n#define M_PI 3.141592653589793238462643383279\nvoid main() {\n  vec2 uv = vUv;\n  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;\n  float latitude = uv.y * M_PI;\n  vec3 dir = vec3(\n    - sin( longitude ) * sin( latitude ),\n    cos( latitude ),\n    - cos( longitude ) * sin( latitude )\n  );\n  normalize( dir );\n  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );\n}",side:s.DoubleSide}),this.quad=new s.Mesh(new s.PlaneGeometry(1,1),this.material),this.quad.visible=!1,this.camera=new s.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),e.object3D.add(this.quad),this.onKeyDown=this.onKeyDown.bind(this))}},getRenderTarget:function(e,i){return new s.WebGLRenderTarget(e,i,{colorSpace:this.el.sceneEl.renderer.outputColorSpace,minFilter:s.LinearFilter,magFilter:s.LinearFilter,wrapS:s.ClampToEdgeWrapping,wrapT:s.ClampToEdgeWrapping,format:s.RGBAFormat,type:s.UnsignedByteType})},resize:function(e,i){this.quad.scale.set(e,i,1),this.camera.left=-1*e/2,this.camera.right=e/2,this.camera.top=i/2,this.camera.bottom=-1*i/2,this.camera.updateProjectionMatrix(),this.canvas.width=e,this.canvas.height=i},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(e){var i=83===e.keyCode&&e.ctrlKey&&e.altKey;if(this.data&&i){var n=e.shiftKey?"equirectangular":"perspective";this.capture(n)}},setCapture:function(e){var i,n,r,a,o=this.el;return"perspective"===e?(this.quad.visible=!1,n=this.data.camera&&this.data.camera.components.camera.camera||o.camera,i={width:this.data.width,height:this.data.height}):(n=this.camera,a=new s.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:s.RGBFormat,generateMipmaps:!0,minFilter:s.LinearMipmapLinearFilter,colorSpace:s.SRGBColorSpace}),r=new s.CubeCamera(o.camera.near,o.camera.far,a),o.camera.getWorldPosition(r.position),o.camera.getWorldQuaternion(r.quaternion),r.update(o.renderer,o.object3D),this.quad.material.uniforms.map.value=r.renderTarget.texture,i={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:n,size:i,projection:e}},capture:function(e){var i,n=this.el.renderer.xr.enabled,r=this.el.renderer;this.setup(),r.xr.enabled=!1,i=this.setCapture(e),this.renderCapture(i.camera,i.size,i.projection),this.saveCapture(),r.xr.enabled=n},getCanvas:function(e){var i=this.el.renderer.xr.enabled,n=this.el.renderer;this.setup();var r=this.setCapture(e);return n.xr.enabled=!1,this.renderCapture(r.camera,r.size,r.projection),n.xr.enabled=i,this.canvas},renderCapture:function(e,i,n){var r,s,a,o=this.el.renderer.autoClear,l=this.el,h=l.renderer;s=this.getRenderTarget(i.width,i.height),a=new Uint8Array(4*i.width*i.height),this.resize(i.width,i.height),h.autoClear=!0,h.clear(),h.setRenderTarget(s),h.render(l.object3D,e),h.autoClear=o,h.readRenderTargetPixels(s,0,0,i.width,i.height,a),h.setRenderTarget(null),"perspective"===n&&(a=this.flipPixelsVertically(a,i.width,i.height)),r=new ImageData(new Uint8ClampedArray(a),i.width,i.height),this.quad.visible=!1,this.ctx.putImageData(r,0,0)},flipPixelsVertically:function(e,i,n){for(var r=e.slice(0),s=0;s<i;++s)for(var a=0;a<n;++a)r[4*s+a*i*4]=e[4*s+(n-a)*i*4],r[4*s+1+a*i*4]=e[4*s+1+(n-a)*i*4],r[4*s+2+a*i*4]=e[4*s+2+(n-a)*i*4],r[4*s+3+a*i*4]=e[4*s+3+(n-a)*i*4];return r},saveCapture:function(){this.canvas.toBlob(function(e){var i="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",n=document.createElement("a"),r=URL.createObjectURL(e);n.href=r,n.setAttribute("download",i),n.innerHTML="downloading...",n.style.display="none",document.body.appendChild(n),setTimeout(function(){n.click(),document.body.removeChild(n)},1)},"image/png")}})},"./src/components/scene/stats.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./vendor/rStats.js"),a=n("./src/utils/index.js");n("./vendor/rStats.extras.js"),n("./src/lib/rStatsAframe.js");var o=window.aframeStats,l="a-hidden",h=window.threeStats;e.exports.Component=r("stats",{schema:{default:!0},sceneOnly:!0,init:function(){var e,i,n,r=this.el;if("false"!==a.getUrlParameter("stats")){this.stats=(i=new h((e=r).renderer),n=new o(e),new s({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:e.isMobile?[]:[i,n]})),this.statsEl=document.querySelector(".rs-base"),this.hideBound=this.hide.bind(this),this.showBound=this.show.bind(this),r.addEventListener("enter-vr",this.hideBound),r.addEventListener("exit-vr",this.showBound)}},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var e=this.stats;e&&(e("rAF").tick(),e("FPS").frame(),e().update())},hide:function(){this.statsEl.classList.add(l)},show:function(){this.statsEl.classList.remove(l)}})},"./src/components/scene/xr-mode-ui.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/constants/index.js"),a=n("./src/utils/index.js"),o="a-hidden";function l(e){e.addEventListener("touchstart",function(){e.classList.remove("resethover")},{passive:!0}),e.addEventListener("touchend",function(){e.classList.add("resethover")},{passive:!0})}e.exports.Component=r("xr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},cardboardModeEnabled:{default:!1},enterVRButton:{default:""},enterVREnabled:{default:!0},enterARButton:{default:""},enterAREnabled:{default:!0},XRMode:{default:"vr",oneOf:["vr","ar","xr"]}},sceneOnly:!0,init:function(){var e=this,i=this.el;"false"!==a.getUrlParameter("ui")&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),i.addEventListener("enter-vr",this.updateEnterInterfaces),i.addEventListener("exit-vr",this.updateEnterInterfaces),i.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(i){"loaderReady"===i.data.type&&(e.insideLoader=!0,e.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=this.onEnterVRButtonClick.bind(this),this.onEnterARButtonClick=this.onEnterARButtonClick.bind(this),this.onModalClick=this.onModalClick.bind(this),this.toggleOrientationModalIfNeeded=this.toggleOrientationModalIfNeeded.bind(this),this.updateEnterInterfaces=this.updateEnterInterfaces.bind(this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var e,i,n,r,h,u,c,d,p,f,m=this.data,g=this.el;if(!m.enabled||this.insideLoader||"false"===a.getUrlParameter("ui"))return this.remove();if(!this.enterVREl&&!this.enterAREl&&!this.orientationModalEl){!this.enterVREl&&m.enterVREnabled&&("xr"===m.XRMode||"vr"===m.XRMode)&&(m.enterVRButton?(this.enterVREl=document.querySelector(m.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=(e=this.onEnterVRButtonClick,(n=document.createElement("div")).classList.add("a-enter-vr"),n.setAttribute(s.AFRAME_INJECTED,""),(i=document.createElement("button")).className="a-enter-vr-button",i.setAttribute("title","Enter VR mode with a headset or fullscreen without"),i.setAttribute(s.AFRAME_INJECTED,""),a.device.isMobile()&&l(i),n.appendChild(i),i.addEventListener("click",function(i){e(),i.stopPropagation()}),n),g.appendChild(this.enterVREl))),!this.enterAREl&&m.enterAREnabled&&("xr"===m.XRMode||"ar"===m.XRMode)&&(m.enterARButton?(this.enterAREl=document.querySelector(m.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=(r=this.onEnterARButtonClick,h="xr"===m.XRMode,(c=document.createElement("div")).classList.add("a-enter-ar"),h&&c.classList.add("xr"),c.setAttribute(s.AFRAME_INJECTED,""),(u=document.createElement("button")).className="a-enter-ar-button",u.setAttribute("title","Enter AR mode with a headset or handheld device."),u.setAttribute(s.AFRAME_INJECTED,""),a.device.isMobile()&&l(u),c.appendChild(u),u.addEventListener("click",function(e){r(),e.stopPropagation()}),c),g.appendChild(this.enterAREl))),this.orientationModalEl=(d=this.onModalClick,(p=document.createElement("div")).className="a-orientation-modal",p.classList.add(o),p.setAttribute(s.AFRAME_INJECTED,""),(f=document.createElement("button")).setAttribute(s.AFRAME_INJECTED,""),f.innerHTML="Exit VR",f.addEventListener("click",d),p.appendChild(f),p),g.appendChild(this.orientationModalEl),this.updateEnterInterfaces()}},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var e=this.el;this.enterVREl&&(e.is("vr-mode")||(e.isMobile||a.device.isMobileDeviceRequestingDesktopSite())&&!this.data.cardboardModeEnabled&&!a.device.checkVRSupport()?this.enterVREl.classList.add(o):(a.device.checkVRSupport()||this.enterVREl.classList.add("fullscreen"),this.enterVREl.classList.remove(o),e.enterVR(!1,!0)))},toggleEnterARButtonIfNeeded:function(){var e=this.el;this.enterAREl&&(e.is("vr-mode")||!a.device.checkARSupport()?this.enterAREl.classList.add(o):(this.enterAREl.classList.remove(o),e.enterVR(!0,!0)))},toggleOrientationModalIfNeeded:function(){var e=this.el,i=this.orientationModalEl;i&&e.isMobile&&(!a.device.isLandscape()&&e.is("vr-mode")?i.classList.remove(o):i.classList.add(o))}})},"./src/components/shadow.js":(e,i,n)=>{var r=n("./src/core/component.js"),s=n("./src/lib/three.js"),a=r.registerComponent;e.exports.Component=a("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=this.update.bind(this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var e=this.data;this.updateDescendants(e.cast,e.receive)},remove:function(){this.el.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(e,i){var n=this.el.sceneEl;this.el.object3D.traverse(function(r){if(r instanceof s.Mesh&&(r.castShadow=e,r.receiveShadow=i,n.hasLoaded&&r.material))for(var a=Array.isArray(r.material)?r.material:[r.material],o=0;o<a.length;o++)a[o].needsUpdate=!0})}})},"./src/components/sound.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/debug.js"),a=n("./src/lib/three.js"),o=s("components:sound:warn");e.exports.Component=r("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},loopStart:{default:0},loopEnd:{default:0},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var e=this;this.listener=null,this.audioLoader=new a.AudioLoader,this.pool=new a.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){e.playSound()}},update:function(e){var i,n,r=this.data,s=r.src!==e.src;if(s){if(!r.src)return;this.setupSound()}for(i=0;i<this.pool.children.length;i++)n=this.pool.children[i],r.positional&&(n.setDistanceModel(r.distanceModel),n.setMaxDistance(r.maxDistance),n.setRefDistance(r.refDistance),n.setRolloffFactor(r.rolloffFactor)),n.setLoop(r.loop),n.setLoopStart(r.loopStart),0!==r.loopStart&&0===r.loopEnd?n.setLoopEnd(n.buffer.duration):n.setLoopEnd(r.loopEnd),n.setVolume(r.volume),n.isPaused=!1;if(r.on!==e.on&&this.updateEventListener(e.on),s){var o=this;this.loaded=!1,this.audioLoader.load(r.src,function(e){for(i=0;i<o.pool.children.length;i++)(n=o.pool.children[i]).setBuffer(e);o.loaded=!0,a.Cache.remove(r.src),(o.data.autoplay||o.mustPlay)&&o.playSound(o.processSound),o.el.emit("sound-loaded",o.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var e;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(e=0;e<this.pool.children.length;e++)this.pool.children[e].disconnect()}catch(e){o("Audio source not properly disconnected")}},updateEventListener:function(e){var i=this.el;e&&i.removeEventListener(e,this.playSoundBound),i.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var e,i,n=this.el,r=n.sceneEl,s=this;this.pool.children.length>0&&(this.stopSound(),n.removeObject3D("sound"));var o=this.listener=r.audioListener||new a.AudioListener;for(r.audioListener=o,r.camera&&r.camera.add(o),r.addEventListener("camera-set-active",function(e){e.detail.cameraEl.getObject3D("camera").add(o)}),this.pool=new a.Group,e=0;e<this.data.poolSize;e++)i=this.data.positional?new a.PositionalAudio(o):new a.Audio(o),this.pool.add(i);for(n.setObject3D(this.attrName,this.pool),e=0;e<this.pool.children.length;e++)(i=this.pool.children[e]).onEnded=function(){this.isPlaying=!1,s.el.emit("sound-ended",s.evtDetail,!1)}},pauseSound:function(){var e,i;for(e=0,this.isPlaying=!1;e<this.pool.children.length;e++)(i=this.pool.children[e]).source&&i.source.buffer&&i.isPlaying&&!i.isPaused&&(i.isPaused=!0,i.pause())},playSound:function(e){var i,n,r;if(!this.loaded){o("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0,this.processSound=e;return}for(n=0,i=!1,this.isPlaying=!0;n<this.pool.children.length;n++)if(!(r=this.pool.children[n]).isPlaying&&r.buffer&&!i){e&&e(r),r.play(),r.isPaused=!1,i=!0;continue}if(!i){o("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el);return}this.mustPlay=!1,this.processSound=void 0},stopSound:function(){var e,i;for(e=0,this.isPlaying=!1;e<this.pool.children.length;e++){if(!(i=this.pool.children[e]).source||!i.source.buffer)return;i.stop()}}})},"./src/components/text.js":(e,i,n)=>{var r,s,a,o,l=n("./node_modules/three-bmfont-text/index.js"),h=n("./node_modules/load-bmfont/browser.js"),u=n("./src/core/component.js").registerComponent,c=n("./src/core/shader.js"),d=n("./src/lib/three.js"),p=n("./src/utils/index.js"),f=p.debug("components:text:error"),m=c.shaders,g=p.debug("components:text:warn"),A=n("./src/constants/index.js").AFRAME_CDN_ROOT+"fonts/",v={aileronsemibold:A+"Aileron-Semibold.fnt",dejavu:A+"DejaVu-sdf.fnt",exo2bold:A+"Exo2Bold.fnt",exo2semibold:A+"Exo2SemiBold.fnt",kelsonsans:A+"KelsonSans.fnt",monoid:A+"Monoid.fnt",mozillavr:A+"mozillavr.fnt",roboto:A+"Roboto-msdf.json",sourcecodepro:A+"SourceCodePro.fnt"},y=["roboto"],x="roboto";e.exports.FONTS=v;var _=new function(){var e=this.cache={};this.get=function(i,n){return i in e||(e[i]=n()),e[i]}},b={},E={},w=/^\w+:/;e.exports.Component=u("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:x},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:m},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=l(),this.createOrUpdateMaterial(),this.explicitGeoDimensionsChecked=!1},update:function(e){var i=this.data,n=this.currentFont;if(E[i.font]?this.texture=E[i.font]:(this.texture=E[i.font]=new d.Texture,this.texture.anisotropy=16),this.createOrUpdateMaterial(),e.font!==i.font){this.updateFont();return}n&&(this.updateGeometry(this.geometry,n),this.updateLayout())},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var e,i,n,r,s,a,o,l,h=this.data,u=this.material,c=this.shaderData;if(l=h.shader,-1!==y.indexOf(h.font)||h.font.indexOf("-msdf.")>=0?l="msdf":h.font in v&&-1===y.indexOf(h.font)&&(l="sdf"),a=(this.shaderObject&&this.shaderObject.name)!==l,c.alphaTest=h.alphaTest,c.color=h.color,c.map=this.texture,c.opacity=h.opacity,c.side=function(e){switch(e){case"back":return d.FrontSide;case"double":return d.DoubleSide;default:return d.BackSide}}(h.side),c.transparent=h.transparent,c.negate=h.negate,!a){this.shaderObject.update(c),u.transparent=c.transparent,u.side=c.side;return}e=this.el,i=l,n=c,(s=new m[i].Shader).el=e,s.init(n),s.update(n),(r=s.material).transparent=n.transparent,o={material:r,shader:s},this.material=o.material,this.shaderObject=o.shader,this.material.side=c.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var e,i=this.data,n=this.el,r=this.geometry,s=this;i.font||g("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),e=this.lookupFont(i.font||x)||i.font,_.get(e,function(){var n,r;return n=e,r=i.yOffset,new Promise(function(e,i){h(n,function(s,a){if(s){f("Error loading font",n),i(s);return}n.indexOf("/Roboto-msdf.json")>=0&&(r=30),r&&a.chars.map(function(e){e.yoffset+=r}),e(a)})})}).then(function(a){var o,l,h,u,c;if(1!==a.pages.length)throw Error("Currently only single-page bitmap fonts are supported.");b[e]||(a.widthFactor=b[a]=(h=0,u=0,c=0,(l=a).chars.map(function(e){h+=e.xadvance,e.id>=48&&e.id<=57&&(c++,u+=e.xadvance)}),c?u/c:h/l.chars.length)),s.currentFont=a,o=s.getFontImageSrc(),_.get(o,function(){var e;return e=o,new Promise(function(i,n){new d.ImageLoader().load(e,function(e){i(e)},void 0,function(){f("Error loading font image",e),n(null)})})}).then(function(e){var o=s.texture;o&&(o.image=e,o.needsUpdate=!0,E[i.font]=o,s.texture=o,s.initMesh(),s.currentFont=a,s.updateGeometry(r,a),s.updateLayout(),s.mesh.visible=!0,n.emit("textfontset",{font:i.font,fontObj:a}))}).catch(function(e){f(e.message),f(e.stack)})}).catch(function(e){f(e.message),f(e.stack)})},initMesh:function(){!this.mesh&&(this.mesh=new d.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var e=this.lookupFont(this.data.font||x)||this.data.font,i=this.currentFont.pages[0];return i.match(w)&&0!==i.indexOf("http")?e.replace(/(\.fnt)|(\.json)/,".png"):d.LoaderUtils.extractUrlBase(e)+i},updateLayout:function(){var e,i,n,r,s,a,o,l,h,u,c,d,p=this.el,f=this.data,m=this.geometry,g=this.mesh;if(g&&m.layout){if(a=p.getAttribute("geometry"),o=(h=(u=f.width||a&&a.width||1)/(e=f.wrapPixels,i=f.wrapCount,n=this.currentFont.widthFactor,e||(.5+i)*n))*((l=m.layout).height+l.descender),a&&"plane"===a.primitive&&(this.explicitGeoDimensionsChecked||(this.explicitGeoDimensionsChecked=!0,this.hasExplicitGeoWidth=!!a.width,this.hasExplicitGeoHeight=!!a.height),this.hasExplicitGeoWidth||p.setAttribute("geometry","width",u),this.hasExplicitGeoHeight||p.setAttribute("geometry","height",o)),"left"===(r="align"===f.anchor?f.align:f.anchor))c=0;else if("right"===r)c=-1*l.width;else if("center"===r)c=-1*l.width/2;else throw TypeError("Invalid text.anchor property value",r);if("bottom"===(s=f.baseline))d=0;else if("top"===s)d=-1*l.height+l.ascender;else if("center"===s)d=-1*l.height/2;else throw TypeError("Invalid text.baseline property value",s);g.position.x=c*h+f.xOffset,g.position.y=d*h,g.position.z=f.zOffset,g.scale.set(h,-1*h,h)}},lookupFont:function(e){return v[e]},updateGeometry:(r={},s={},a=/\\n/g,o=/\\t/g,function(e,i){var n,l,h,u=this.data;s.font=i,s.lineHeight=u.lineHeight&&isFinite(u.lineHeight)?u.lineHeight:i.common.lineHeight,s.text=u.value.toString().replace(a,"\n").replace(o,"	"),s.width=(n=u.wrapPixels,l=u.wrapCount,h=i.widthFactor,n||(.5+l)*h),e.update(p.extend(r,u,s))})})},"./src/components/tracked-controls-webvr.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/tracked-controls.js"),a=n("./src/constants/index.js").DEFAULT_CAMERA_HEIGHT,o=n("./src/lib/three.js"),l=n("./src/constants/index.js").DEFAULT_HANDEDNESS,h={touches:[]},u={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};e.exports.Component=r("tracked-controls-webvr",{schema:{autoHide:{default:!0},controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"}},init:function(){this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.changedAxes=[],this.targetControllerNumber=this.data.controller,this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.deltaControllerPosition=new o.Vector3,this.controllerQuaternion=new o.Quaternion,this.controllerEuler=new o.Euler,this.updateGamepad(),this.buttonEventDetails={}},tick:function(e,i){var n=this.el.getObject3D("mesh");n&&n.update&&n.update(i/1e3),this.updateGamepad(),this.updatePose(),this.updateButtons()},defaultUserHeight:function(){return a},getHeadElement:function(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function(){var e=this.data,i=s.findMatchingControllerWebVR(this.system.controllers,e.id,e.idPrefix,e.hand,e.controller);this.controller=i,this.el.components["tracked-controls"].controller=i,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},applyArmModel:function(e){var i,n,r,s,a=this.controller,o=this.controllerEuler,h=this.controllerQuaternion,u=this.deltaControllerPosition;n=this.getHeadElement().object3D,s=this.defaultUserHeight(),r=a.pose,i=(a?a.hand:void 0)||l,e.copy(n.position),u.set(.175*("left"===i?-1:+("right"===i)),-.3,-.03),u.multiplyScalar(s),u.applyAxisAngle(n.up,n.rotation.y),e.add(u),u.set(0,0,-.175),u.multiplyScalar(s),r.orientation?h.fromArray(r.orientation):h.copy(n.quaternion),o.setFromQuaternion(h),o.set(o.x,o.y,0),u.applyEuler(o),e.add(u)},updatePose:function(){var e,i,n=this.controller,r=this.data,s=this.el.object3D,a=this.system.vrDisplay;n&&((e=n.pose).position?s.position.fromArray(e.position):r.armModel&&this.applyArmModel(s.position),e.orientation&&s.quaternion.fromArray(e.orientation),a&&e.position&&(i=this.el.sceneEl.renderer.xr.getStandingMatrix(),s.matrix.compose(s.position,s.quaternion,s.scale),s.matrix.multiplyMatrices(i,s.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale)),s.rotateX(this.data.orientationOffset.x*o.MathUtils.DEG2RAD),s.rotateY(this.data.orientationOffset.y*o.MathUtils.DEG2RAD),s.rotateZ(this.data.orientationOffset.z*o.MathUtils.DEG2RAD))},updateButtons:function(){var e,i,n=this.controller;if(n){for(i=0;i<n.buttons.length;++i)this.buttonStates[i]||(this.buttonStates[i]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[i]||(this.buttonEventDetails[i]={id:i,state:this.buttonStates[i]}),e=n.buttons[i],this.handleButton(i,e);this.handleAxes()}},handleButton:function(e,i){return!!(this.handlePress(e,i)|this.handleTouch(e,i)|this.handleValue(e,i))&&(this.el.emit(u.BUTTONCHANGED,this.buttonEventDetails[e],!1),!0)},handleAxes:function(){var e,i=!1,n=this.controller.axes,r=this.axis,s=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),e=0;e<n.length;++e)s.push(r[e]!==n[e]),s[e]&&(i=!0);if(!i)return!1;for(this.axis.splice(0,this.axis.length),e=0;e<n.length;e++)this.axis.push(n[e]);return this.el.emit(u.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(e,i){var n,r=this.buttonStates[e];return i.pressed!==r.pressed&&(n=i.pressed?u.BUTTONDOWN:u.BUTTONUP,this.el.emit(n,this.buttonEventDetails[e],!1),r.pressed=i.pressed,!0)},handleTouch:function(e,i){var n,r=this.buttonStates[e];return i.touched!==r.touched&&(n=i.touched?u.TOUCHSTART:u.TOUCHEND,this.el.emit(n,this.buttonEventDetails[e],!1,h),r.touched=i.touched,!0)},handleValue:function(e,i){var n=this.buttonStates[e];return i.value!==n.value&&(n.value=i.value,!0)}})},"./src/components/tracked-controls-webxr.js":(e,i,n)=>{var r=n("./src/utils/tracked-controls.js"),s=n("./src/core/component.js").registerComponent,a={AXISMOVE:"axismove",BUTTONCHANGED:"buttonchanged",BUTTONDOWN:"buttondown",BUTTONUP:"buttonup",TOUCHSTART:"touchstart",TOUCHEND:"touchend"};e.exports.Component=s("tracked-controls-webxr",{schema:{id:{type:"string",default:""},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},index:{type:"int",default:-1},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"gripSpace"}},init:function(){this.updateController=this.updateController.bind(this),this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes}},update:function(){this.updateController()},play:function(){var e=this.el.sceneEl;this.updateController(),e.addEventListener("controllersupdated",this.updateController)},pause:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(e){return!!this.controller&&!this.controller.gamepad&&("none"===e.inputSource.handedness||e.inputSource.handedness===this.data.hand)},updateController:function(){this.controller=r.findMatchingControllerWebXR(this.system.controllers,this.data.id,this.data.hand,this.data.index,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller,this.data.autoHide&&(this.el.object3D.visible=!!this.controller)},tick:function(){var e=this.el.sceneEl,i=this.controller,n=e.frame;i&&e.frame&&this.system.referenceSpace&&(i.hand||(this.pose=n.getPose(i[this.data.space],this.system.referenceSpace),this.updatePose(),this.updateButtons()))},updatePose:function(){var e=this.el.object3D,i=this.pose;i&&(e.matrix.elements=i.transform.matrix,e.matrix.decompose(e.position,e.rotation,e.scale))},updateButtons:function(){var e,i,n,r=this.controller;if(r&&r.gamepad){for(i=0,n=r.gamepad;i<n.buttons.length;++i)this.buttonStates[i]||(this.buttonStates[i]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[i]||(this.buttonEventDetails[i]={id:i,state:this.buttonStates[i]}),e=n.buttons[i],this.handleButton(i,e);this.handleAxes()}},handleButton:function(e,i){return!!(this.handlePress(e,i)|this.handleTouch(e,i)|this.handleValue(e,i))&&(this.el.emit(a.BUTTONCHANGED,this.buttonEventDetails[e],!1),!0)},handleAxes:function(){var e,i=!1,n=this.controller.gamepad.axes,r=this.axis,s=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),e=0;e<n.length;++e)s.push(r[e]!==n[e]),s[e]&&(i=!0);if(!i)return!1;for(this.axis.splice(0,this.axis.length),e=0;e<n.length;e++)this.axis.push(n[e]);return this.el.emit(a.AXISMOVE,this.axisMoveEventDetail,!1),!0},handlePress:function(e,i){var n,r=this.buttonStates[e];return i.pressed!==r.pressed&&(n=i.pressed?a.BUTTONDOWN:a.BUTTONUP,this.el.emit(n,this.buttonEventDetails[e],!1),r.pressed=i.pressed,!0)},handleTouch:function(e,i){var n,r=this.buttonStates[e];return i.touched!==r.touched&&(n=i.touched?a.TOUCHSTART:a.TOUCHEND,this.el.emit(n,this.buttonEventDetails[e],!1),r.touched=i.touched,!0)},handleValue:function(e,i){var n=this.buttonStates[e];return i.value!==n.value&&(n.value=i.value,!0)}})},"./src/components/tracked-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("tracked-controls",{schema:{autoHide:{default:!0},controller:{default:-1},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},handTrackingEnabled:{default:!1},orientationOffset:{type:"vec3"},armModel:{default:!1},headElement:{type:"selector"},iterateControllerProfiles:{default:!1},space:{type:"string",oneOf:["targetRaySpace","gripSpace"],default:"targetRaySpace"}},after:["tracked-controls-webvr","tracked-controls-webxr"],update:function(){var e=this.data,i=this.el;i.sceneEl.hasWebXR?i.setAttribute("tracked-controls-webxr",{id:e.id,hand:e.hand,index:e.controller,iterateControllerProfiles:e.iterateControllerProfiles,handTrackingEnabled:e.handTrackingEnabled,space:e.space}):i.setAttribute("tracked-controls-webvr",e)}})},"./src/components/valve-index-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js"),a=n("./src/utils/tracked-controls.js"),o=a.checkControllerPresentAndSetup,l=a.emitIfAxesChanged,h=a.onButtonEvent,u=n("./src/constants/index.js").AFRAME_CDN_ROOT+"controllers/valve/index/valve-index-",c={left:u+"left.glb",right:u+"right.glb"},d="valve",p=n("./src/utils/index.js").device.isWebXRAvailable,f=p?{left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}}:{left:{_x:.692295102620542,_y:-.0627618864318427,_z:-.06265893149611756,_order:"XYZ"},right:{_x:.6484021229942998,_y:-.032563619881892894,_z:-.1327973171917482,_order:"XYZ"}},m=p?{left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}}:{left:{x:-23692678902063457e-20,y:.04724540367838371,z:-.061959880395271096},right:{x:.002471558599671131,y:.055765208987076195,z:-.061068168708348844}};e.exports.Component=r("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},after:["tracked-controls"],mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var e=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){h(i.detail.id,"down",e)},this.onButtonUp=function(i){h(i.detail.id,"up",e)},this.onButtonTouchEnd=function(i){h(i.detail.id,"touchend",e)},this.onButtonTouchStart=function(i){h(i.detail.id,"touchstart",e)},this.previousButtonValues={},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;o(this,d,{index:"right"===e.hand?0:"left"===e.hand?1:2,iterateControllerProfiles:!0,hand:e.hand})},injectTrackedControls:function(){var e=this.el,i=this.data;e.setAttribute("tracked-controls",{idPrefix:d,controller:"right"===i.hand?1:2*("left"!==i.hand),hand:i.hand,orientationOffset:i.orientationOffset}),this.loadModel()},loadModel:function(){var e=this.data;e.model&&this.el.setAttribute("gltf-model",""+c[e.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var i,n=this.mapping.buttons[e.detail.id],r=this.buttonMeshes;n&&("trigger"===n&&(i=e.detail.state.value,r&&r.trigger&&(r.trigger.rotation.x=this.triggerOriginalRotationX-Math.PI/40*i)),this.el.emit(n+"changed",e.detail.state))},onModelLoaded:function(e){var i,n=e.detail.model,r=this;e.target===this.el&&this.data.model&&((i=this.buttonMeshes={}).grip={left:n.getObjectByName("leftgrip"),right:n.getObjectByName("rightgrip")},i.menu=n.getObjectByName("menubutton"),i.system=n.getObjectByName("systembutton"),i.trackpad=n.getObjectByName("touchpad"),i.trigger=n.getObjectByName("trigger"),this.triggerOriginalRotationX=i.trigger.rotation.x,Object.keys(i).forEach(function(e){r.setButtonColor(e,r.data.buttonColor)}),n.position.copy(m[this.data.hand]),n.rotation.copy(f[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controls",model:this.data.model,rayOrigin:new s.Vector3(0,0,0)}))},onAxisMoved:function(e){l(this,this.mapping.axes,e)},updateModel:function(e,i){var n;this.data.model&&-1===i.indexOf("touch")&&(n="up"===i?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(e,n))},setButtonColor:function(e,i){}})},"./src/components/visible.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent;e.exports.Component=r("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}})},"./src/components/vive-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/tracked-controls.js"),a=s.checkControllerPresentAndSetup,o=s.emitIfAxesChanged,l=s.onButtonEvent,h=n("./src/constants/index.js").AFRAME_CDN_ROOT,u=h+"controllers/vive/vr_controller_vive.obj",c=h+"controllers/vive/vr_controller_vive.mtl",d=n("./src/utils/index.js").device.isWebXRAvailable,p=d?"htc-vive":"OpenVR ";e.exports.Component=r("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},after:["tracked-controls"],mapping:d?{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","none"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},init:function(){var e=this;this.controllerPresent=!1,this.lastControllerCheck=0,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){l(i.detail.id,"down",e)},this.onButtonUp=function(i){l(i.detail.id,"up",e)},this.onButtonTouchEnd=function(i){l(i.detail.id,"touchend",e)},this.onButtonTouchStart=function(i){l(i.detail.id,"touchstart",e)},this.previousButtonValues={},this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;a(this,p,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,i=this.data;e.setAttribute("tracked-controls",{idPrefix:p,hand:i.hand,controller:this.controllerIndex,orientationOffset:i.orientationOffset}),this.data.model&&this.el.setAttribute("obj-model",{obj:u,mtl:c})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var i,n=this.mapping.buttons[e.detail.id],r=this.buttonMeshes;n&&("trigger"===n&&(i=e.detail.state.value,r&&r.trigger&&(r.trigger.rotation.x=-(Math.PI/12*i))),this.el.emit(n+"changed",e.detail.state))},onModelLoaded:function(e){var i,n=e.detail.model,r=this;e.target===this.el&&this.data.model&&((i=this.buttonMeshes={}).grip={left:n.getObjectByName("leftgrip"),right:n.getObjectByName("rightgrip")},i.menu=n.getObjectByName("menubutton"),i.system=n.getObjectByName("systembutton"),i.trackpad=n.getObjectByName("touchpad"),i.touchpad=n.getObjectByName("touchpad"),i.trigger=n.getObjectByName("trigger"),Object.keys(i).forEach(function(e){r.setButtonColor(e,r.data.buttonColor)}),n.position.set(0,-.015,.04))},onAxisMoved:function(e){o(this,this.mapping.axes,e)},updateModel:function(e,i){var n;this.data.model&&-1===i.indexOf("touch")&&(n="up"===i?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(e,n))},setButtonColor:function(e,i){var n=this.buttonMeshes;if(n){if("grip"===e){n.grip.left.material.color.set(i),n.grip.right.material.color.set(i);return}n[e].material.color.set(i)}}})},"./src/components/vive-focus-controls.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/utils/tracked-controls.js"),a=s.checkControllerPresentAndSetup,o=s.emitIfAxesChanged,l=s.onButtonEvent,h=n("./src/constants/index.js").AFRAME_CDN_ROOT+"controllers/vive/focus-controller/focus-controller.gltf",u=n("./src/utils/index.js").device.isWebXRAvailable,c=u?"htc-vive-focus":"HTC Vive Focus ";e.exports.Component=r("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},after:["tracked-controls"],mapping:u?{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]}:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){l(i.detail.id,"down",e)},this.onButtonUp=function(i){l(i.detail.id,"up",e)},this.onButtonTouchStart=function(i){l(i.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(i){l(i.detail.id,"touchend",e)},this.controllerPresent=!1,this.lastControllerCheck=0,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){a(this,c,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,i=this.data;e.setAttribute("tracked-controls",{armModel:i.armModel,idPrefix:c,orientationOffset:i.orientationOffset}),this.data.model&&this.el.setAttribute("gltf-model",h)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(e){var i,n=e.detail.model;e.target===this.el&&this.data.model&&((i=this.buttonMeshes={}).trigger=n.getObjectByName("BumperKey"),i.triggerPressed=n.getObjectByName("BumperKey_Press"),i.triggerPressed&&(i.triggerPressed.visible=!1),i.trackpad=n.getObjectByName("TouchPad"),i.trackpadPressed=n.getObjectByName("TouchPad_Press"),i.trackpadPressed&&(i.trackpadPressed.visible=!1))},onButtonChanged:function(e){var i=this.mapping.buttons[e.detail.id];i&&this.el.emit(i+"changed",e.detail.state)},onAxisMoved:function(e){o(this,this.mapping.axes,e)},updateModel:function(e,i){this.data.model&&this.updateButtonModel(e,i)},updateButtonModel:function(e,i){var n,r=this.buttonMeshes,s=e+"Pressed";if(r&&r[e]&&r[s]){switch(i){case"down":n=this.data.buttonHighlightColor;break;case"touchstart":n=this.data.buttonTouchedColor}n&&r[s].material.color.set(n),r[s].visible=!!n,r[e].visible=!n}}})},"./src/components/wasd-controls.js":(e,i,n)=>{var r,s,a=n("./src/constants/index.js").keyboardevent.KEYCODE_TO_CODE,o=n("./src/core/component.js").registerComponent,l=n("./src/lib/three.js"),h=n("./src/utils/index.js").shouldCaptureKeyEvent,u=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];e.exports.Component=o("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},after:["look-controls"],init:function(){this.keys={},this.easing=1.1,this.velocity=new l.Vector3,this.onBlur=this.onBlur.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.attachVisibilityEventListeners()},tick:function(e,i){var n=this.data,r=this.el,s=this.velocity;if(!(!s[n.adAxis]&&!s[n.wsAxis]&&function(e){var i;for(i in e)return!1;return!0}(this.keys)))i/=1e3,this.updateVelocity(i),(s[n.adAxis]||s[n.wsAxis])&&r.object3D.position.add(this.getMovementVector(i))},update:function(e){e.adAxis!==this.data.adAxis&&(this.velocity[e.adAxis]=0),e.wsAxis!==this.data.wsAxis&&(this.velocity[e.wsAxis]=0)},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(e){var i,n,r,s,a,o=this.data,l=this.keys,h=this.velocity;if(n=o.adAxis,s=o.wsAxis,e>.2){h[n]=0,h[s]=0;return}var u=Math.pow(1/this.easing,60*e);0!==h[n]&&(h[n]=h[n]*u),0!==h[s]&&(h[s]=h[s]*u),1e-5>Math.abs(h[n])&&(h[n]=0),1e-5>Math.abs(h[s])&&(h[s]=0),o.enabled&&(i=o.acceleration,o.adEnabled&&(r=o.adInverted?-1:1,(l.KeyA||l.ArrowLeft)&&(h[n]-=r*i*e),(l.KeyD||l.ArrowRight)&&(h[n]+=r*i*e)),o.wsEnabled&&(a=o.wsInverted?-1:1,(l.KeyW||l.ArrowUp)&&(h[s]-=a*i*e),(l.KeyS||l.ArrowDown)&&(h[s]+=a*i*e)))},getMovementVector:(r=new l.Vector3(0,0,0),s=new l.Euler(0,0,0,"YXZ"),function(e){var i,n=this.el.getAttribute("rotation"),a=this.velocity;return r.copy(a),r.multiplyScalar(e),n&&(i=this.data.fly?n.x:0,s.set(l.MathUtils.degToRad(i),l.MathUtils.degToRad(n.y),0),r.applyEuler(s)),r}),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var e=Object.keys(this.keys),i=0;i<e.length;i++)delete this.keys[e[i]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(e){var i;h(e)&&(i=e.code||a[e.keyCode],-1!==u.indexOf(i)&&(this.keys[i]=!0))},onKeyUp:function(e){var i;i=e.code||a[e.keyCode],delete this.keys[i]}})},"./src/components/windows-motion-controls.js":(e,i,n)=>{var r,s,a,o=n("./src/core/component.js").registerComponent,l=n("./src/utils/tracked-controls.js"),h=l.checkControllerPresentAndSetup,u=l.emitIfAxesChanged,c=l.onButtonEvent,d=n("./src/utils/index.js"),p=d.debug("components:windows-motion-controls:debug"),f=d.debug("components:windows-motion-controls:warn"),m=n("./src/constants/index.js").DEFAULT_HANDEDNESS,g=n("./src/constants/index.js").AFRAME_CDN_ROOT+"controllers/microsoft/",A={left:"left.glb",right:"right.glb",default:"universal.glb"},v=n("./src/utils/index.js").device.isWebXRAvailable,y=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,x=v?"windows-mixed-reality":"Spatial Controller (Spatial Interaction Source) ";e.exports.Component=o("windows-motion-controls",{schema:{hand:{default:m},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},after:["tracked-controls"],mapping:v?{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"}:{axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},bindMethods:function(){this.onModelError=this.onModelError.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this,i=this.el;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(i){c(i.detail.id,"down",e)},this.onButtonUp=function(i){c(i.detail.id,"up",e)},this.onButtonTouchStart=function(i){c(i.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(i){c(i.detail.id,"touchend",e)},this.onControllerConnected=function(){e.setModelVisibility(!0)},this.onControllerDisconnected=function(){e.setModelVisibility(!1)},this.controllerPresent=!1,this.lastControllerCheck=0,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1},i.addEventListener("controllerconnected",this.onControllerConnected),i.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-error",this.onModelError),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-error",this.onModelError),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){h(this,x,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(!this.data.model||this.rayOrigin.createdFromMesh){this.modelReady();return}var e=this.createControllerModelUrl();this.loadModel(e)},createControllerModelUrl:function(e){var i=this.el.components["tracked-controls"],n=i?i.controller:null,r="default",s=this.data.hand;if(n&&!window.hasNativeWebXRImplementation&&(s=n.hand,!e)){var a=n.id.match(y);r=a&&a[0]||r}return g+r+"/"+(A[s]||A.default)},injectTrackedControls:function(){var e=this.data;this.el.setAttribute("tracked-controls",{idPrefix:x,controller:e.pair,hand:e.hand,armModel:!1}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(e){var i=this.createControllerModelUrl(!0);e.detail.src!==i?(f("Failed to load controller model for device, attempting to load default."),this.loadModel(i)):f("Failed to load default controller model.")},loadModel:function(e){this.el.setAttribute("gltf-model","url("+e+")")},onModelLoaded:function(e){var i,n,r,s,a=this.controllerModel=e.detail.model,o=this.loadedMeshInfo;if(e.target===this.el){if(p("Processing model"),o.buttonMeshes={},o.axisMeshes={},a){for(i=0;i<this.mapping.buttons.length;i++){if(!(n=this.mapping.buttonMeshNames[this.mapping.buttons[i]])){p("Skipping unknown button at index: "+i+" with mapped name: "+this.mapping.buttons[i]);continue}if(!(r=a.getObjectByName(n))){f("Missing button mesh with name: "+n);continue}(s={index:i,value:l(r,"VALUE"),pressed:l(r,"PRESSED"),unpressed:l(r,"UNPRESSED")}).value&&s.pressed&&s.unpressed?o.buttonMeshes[this.mapping.buttons[i]]=s:f("Missing button submesh under mesh with name: "+n+"(VALUE: "+!!s.value+", PRESSED: "+!!s.pressed+", UNPRESSED:"+!!s.unpressed+")")}for(i=0;i<this.mapping.axisMeshNames.length;i++){if(!(n=this.mapping.axisMeshNames[i])){p("Skipping unknown axis at index: "+i);continue}if(!(r=a.getObjectByName(n))){f("Missing axis mesh with name: "+n);continue}(s={index:i,value:l(r,"VALUE"),min:l(r,"MIN"),max:l(r,"MAX")}).value&&s.min&&s.max?o.axisMeshes[i]=s:f("Missing axis submesh under mesh with name: "+n+"(VALUE: "+!!s.value+", MIN: "+!!s.min+", MAX:"+!!s.max+")")}this.calculateRayOriginFromMesh(a),this.setModelVisibility()}p("Model load complete.")}function l(e,i){for(var n=0,r=e.children.length;n<r;n++){var s=e.children[n];if(s&&s.name===i)return s}}},calculateRayOriginFromMesh:(r=new THREE.Quaternion,function(e){var i;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,i=e.getObjectByName(this.mapping.pointingPoseMeshName)){var n=e.parent;n&&(e.parent=null,e.updateMatrixWorld(!0),e.parent=n),i.getWorldPosition(this.rayOrigin.origin),i.getWorldQuaternion(r),this.rayOrigin.direction.applyQuaternion(r),n&&e.updateMatrixWorld(!0)}else p("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}),lerpAxisTransform:(s=new THREE.Quaternion,function(e,i){var n=this.loadedMeshInfo.axisMeshes[e];if(n){var r=n.min,a=n.max,o=n.value,l=.5*i+.5;o.setRotationFromQuaternion(s.copy(r.quaternion).slerp(a.quaternion,l)),o.position.lerpVectors(r.position,a.position,l)}}),lerpButtonTransform:(a=new THREE.Quaternion,function(e,i){var n=this.loadedMeshInfo.buttonMeshes[e];if(n){var r=n.unpressed,s=n.pressed,o=n.value;o.setRotationFromQuaternion(a.copy(r.quaternion).slerp(s.quaternion,i)),o.position.lerpVectors(r.position,s.position,i)}}),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(e){var i=this.mapping.buttons[e.detail.id];i&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(i,e.detail.state.value),this.el.emit(i+"changed",e.detail.state))},onAxisMoved:function(e){var i=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var n=0;n<i;n++)this.lerpAxisTransform(n,e.detail.axis[n]||0);u(this,this.mapping.axes,e)},setModelVisibility:function(e){var i=this.el.getObject3D("mesh");if(this.controllerPresent)e=void 0!==e?e:this.modelVisible,this.modelVisible=e,i&&(i.visible=e)}})},"./src/constants/index.js":(e,i,n)=>{e.exports={AFRAME_CDN_ROOT:window.AFRAME_CDN_ROOT||"https://cdn.aframe.io/",AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",keyboardevent:n("./src/constants/keyboardevent.js")}},"./src/constants/keyboardevent.js":e=>{e.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},"./src/core/a-assets.js":(e,i,n)=>{var r=n("./src/core/a-node.js").ANode,s=n("./src/utils/debug.js"),a=n("./src/lib/three.js"),o=new a.FileLoader,l=s("core:a-assets:warn");function h(e){var i,n,r,s,a=(i=e).hasAttribute("crossorigin")||null!==(n=i.getAttribute("src"))&&(-1===n.indexOf("://")||(s=(r=n).indexOf("://")>-1?r.split("/")[2]:r.split("/")[0]).substring(0,s.indexOf(":"))===window.location.host)?i:(l('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',n),i.crossOrigin="anonymous",i.cloneNode(!0));return a.tagName&&"video"===a.tagName.toLowerCase()&&(a.setAttribute("playsinline",""),a.setAttribute("webkit-playsinline","")),a!==e&&(e.parentNode.appendChild(a),e.parentNode.removeChild(e)),a}function u(e){var i=c(e),n=i.lastIndexOf(".");return n>=0&&".glb"===i.slice(n,e.search(/\?|#|$/))?"arraybuffer":"text"}function c(e){var i=document.createElement("a");i.href=e;var n=i.search.replace(/^\?/,""),r=e.replace(n,"").replace("?","");return r.substring(r.lastIndexOf("/")+1)}customElements.define("a-assets",class extends r{constructor(){super(),this.isAssets=!0,this.fileLoader=o,this.timeout=null}doConnectedCallback(){var e,i,n,r,s,o,u=this,c=[];if(super.doConnectedCallback(),!this.parentNode.isScene)throw Error("<a-assets> must be a child of a <a-scene>.");for(e=0,s=this.querySelectorAll("img");e<s.length;e++)r=h(s[e]),c.push(new Promise(function(i,n){if(a.Cache.add(s[e].getAttribute("src"),r),r.complete){i();return}r.onload=i,r.onerror=n}));for(e=0,n=this.querySelectorAll("audio, video");e<n.length;e++)(i=h(n[e])).src||i.srcObject||l("Audio/video asset has neither `src` nor `srcObject` attributes."),c.push(function(e){if(e.hasAttribute("autoplay")||"auto"===e.getAttribute("preload"))return new Promise(function(i,n){if(4===e.readyState)return i();if(e.error)return n();function r(){for(var n=0,r=0;r<e.buffered.length;r++)n+=e.buffered.end(r)-e.buffered.start(r);n>=e.duration&&("VIDEO"===e.tagName&&a.Cache.add(e.getAttribute("src"),e),i())}e.addEventListener("loadeddata",r,!1),e.addEventListener("progress",r,!1),e.addEventListener("error",n,!1)})}(i));this.getChildren().forEach(function(e){e.isAssetItem&&e.hasAttribute("src")&&c.push(new Promise(function(i,n){if(e.hasLoaded)return i();e.addEventListener("loaded",i),e.addEventListener("error",n)}))}),Promise.allSettled(c).then(function(){null!==u.timeout&&u.load()}),o=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){!u.hasLoaded&&(l("Asset loading timed out in",o,"ms"),u.timeout=null,u.emit("timeout"),u.load())},o)}disconnectedCallback(){super.disconnectedCallback(),this.timeout&&clearTimeout(this.timeout)}load(){super.load.call(this,null,function(){return!1})}}),customElements.define("a-asset-item",class extends r{constructor(){super(),this.data=null,this.isAssetItem=!0}connectedCallback(){var e=this,i=this.getAttribute("src");o.setResponseType(this.getAttribute("response-type")||u(i)),o.load(i,function(i){e.data=i,r.prototype.load.call(e)},function(i){e.emit("progress",{loadedBytes:i.loaded,totalBytes:i.total,xhr:i})},function(i){e.emit("error",{xhr:i})})}}),e.exports.inferResponseType=u,e.exports.getFileNameFromURL=c},"./src/core/a-cubemap.js":(e,i,n)=>{var r=n("./src/utils/debug.js")("core:cubemap:warn");class s extends HTMLElement{constructor(e){return e=super(e)}onReadyStateChange(){"complete"===document.readyState&&this.doConnectedCallback()}connectedCallback(){if("complete"!==document.readyState){document.addEventListener("readystatechange",this.onReadyStateChange.bind(this));return}s.prototype.doConnectedCallback.call(this)}doConnectedCallback(){this.srcs=this.validate()}validate(){var e,i=this.querySelectorAll("[src]"),n=[];if(6===i.length){for(e=0;e<i.length;e++)"IMG"===i[e].tagName?n.push(i[e]):n.push(i[e].getAttribute("src"));return n}r("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")}}customElements.define("a-cubemap",s)},"./src/core/a-entity.js":(e,i,n)=>{var r=n("./src/core/a-node.js").ANode,s=n("./src/core/component.js").components,a=n("./src/lib/three.js"),o=n("./src/utils/index.js"),l=o.debug("core:a-entity:debug"),h=o.debug("core:a-entity:warn"),u=["position","rotation","scale","visible"],c={once:!0};class d extends r{constructor(){super(),this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new a.Group,this.object3D.rotation.order="YXZ",this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}attributeChangedCallback(e,i,n){var r=this.components[e];if(super.attributeChangedCallback(),r&&r.justInitialized&&""===n){delete r.justInitialized;return}(r||null!==n)&&this.setEntityAttribute(e,i,n)}doConnectedCallback(){var e,i,n=this;if(super.doConnectedCallback(),i=this.sceneEl,this.addToParent(),!this.isScene){if(!i){this.load();return}if((e=i.querySelector("a-assets"))&&!e.hasLoaded){e.addEventListener("loaded",function(){n.load()});return}this.load()}}disconnectedCallback(){var e;if(this.parentEl){for(e in this.components)this.removeComponent(e,!1);!this.isScene&&(this.removeFromParent(),super.disconnectedCallback(),this.object3D.el=null)}}getObject3D(e){return this.object3DMap[e]}setObject3D(e,i){var n,r=this;if(!(i instanceof a.Object3D))throw Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");(n=this.getObject3D(e))&&this.object3D.remove(n),i.el=this,i.children.length&&i.traverse(function(e){e.el=r}),this.object3D.add(i),this.object3DMap[e]=i,this.emit("object3dset",{object:i,type:e})}removeObject3D(e){var i=this.getObject3D(e);if(!i){h("Tried to remove `Object3D` of type:",e,"which was not defined.");return}this.object3D.remove(i),delete this.object3DMap[e],this.emit("object3dremove",{type:e})}getOrCreateObject3D(e,i){var n=this.getObject3D(e);return!n&&i&&(n=new i,this.setObject3D(e,n)),h("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),n}add(e){if(!e.object3D)throw Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(e.object3D),this.emit("child-attached",{el:e})}addToParent(){var e=this.parentEl=this.parentNode;e&&e.add&&!this.attachedToParent&&(e.add(this),this.attachedToParent=!0)}removeFromParent(){var e=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,e.emit("child-detached",{el:this})}load(){var e=this;!this.hasLoaded&&this.parentEl&&super.load.call(this,function(){e.parentEl&&(e.updateComponents(),(e.isScene||e.parentEl.isPlaying)&&e.play())})}remove(e){e?this.object3D.remove(e.object3D):this.parentNode.removeChild(this)}getChildEntities(){for(var e=this.children,i=[],n=0;n<e.length;n++){var r=e[n];r instanceof d&&i.push(r)}return i}initComponent(e,i,n){var r,a,h,u;u=(h=o.split(e,"__"))[0],a=h.length>2?h.slice(1).join("__"):h[1],s[u]&&(p(this,e)||void 0!==i||n)&&!(e in this.components)&&(this.initComponentDependencies(u),r=new s[u].Component(this,i,a),this.isPlaying&&r.play(),this.hasAttribute(e)||(r.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,e,"")),l("Component initialized: %s",e))}initComponentDependencies(e){var i,n;if(s[e]&&(i=s[e].dependencies))for(n=0;n<i.length;n++)this.initComponent(i[n],window.HTMLElement.prototype.getAttribute.call(this,i[n])||void 0,!0)}removeComponent(e,i){var n;if(n=this.components[e]){if(!n.initialized){this.addEventListener("componentinitialized",function n(r){r.detail.name===e&&(this.removeComponent(e,i),this.removeEventListener("componentinitialized",n))});return}n.pause(),n.remove(),i&&(n.destroy(),delete this.components[e],this.hasAttribute(e)&&window.HTMLElement.prototype.removeAttribute.call(this,e)),this.emit("componentremoved",n.evtDetail,!1)}}updateComponents(){var e,i,n,r,s,a,l=this.componentsToUpdate;if(this.hasLoaded||this.isLoading){for(s=0;s<this.mixinEls.length;s++)for(a in this.mixinEls[s].componentCache)f(a)&&(l[a]=!0);if(this.getExtraComponents)for(a in r=this.getExtraComponents())f(a)&&(l[a]=!0);for(s=0;s<this.attributes.length;++s)a=this.attributes[s].name,-1===u.indexOf(a)&&f(a)&&(l[a]=!0);for(s=0;s<u.length;s++)a=u[s],this.hasAttribute(a)&&this.updateComponent(a,this.getDOMAttribute(a));for(a in l){e=this.getDOMAttribute(a),n=(i=r&&r[a])?i.constructor===Object?o.extend(i,o.styleParser.parse(e||{})):e||i:e,this.updateComponent(a,n),delete l[a]}}}updateComponent(e,i,n){var r=this.components[e];if(r){if(null===i&&!p(this,e)){this.removeComponent(e,!0);return}r.updateProperties(i,n);return}this.initComponent(e,i,!1)}removeAttribute(e,i){var n=this.components[e];if(n&&void 0===i&&this.removeComponent(e,!0),n&&void 0!==i){n.resetProperty(i);return}"mixin"===e&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,e)}play(){var e,i,n;if(!this.isPlaying&&(this.hasLoaded||this.isLoading)){for(n in this.isPlaying=!0,this.components)this.components[n].play();for(i=0,e=this.getChildEntities();i<e.length;i++)e[i].play();this.emit("play")}}pause(){var e,i,n;if(this.isPlaying){for(n in this.isPlaying=!1,this.components)this.components[n].pause();for(i=0,e=this.getChildEntities();i<e.length;i++)e[i].pause();this.emit("pause")}}setEntityAttribute(e,i,n){if(s[e]||this.components[e]){this.updateComponent(e,n);return}if("mixin"===e){if(n===this.computedMixinStr)return;this.mixinUpdate(n,i)}}mixinUpdate(e,i,n){var r,s,a,o,l=d.componentsUpdated,h=this;if(n||(i=i||this.getAttribute("mixin")),!this.hasLoaded){this.addEventListener("loaded-private",function(){h.mixinUpdate(e,i,!0)},c);return}for(o=0,a=this.updateMixins(e,i),l.length=0;o<this.mixinEls.length;o++)for(r in this.mixinEls[o].componentCache)-1===l.indexOf(r)&&(this.components[r]?this.components[r].handleMixinUpdate():this.initComponent(r,null),l.push(r));for(o=0;o<a.oldMixinIds.length;o++)if(s=document.getElementById(a.oldMixinIds[o]))for(r in s.componentCache)-1===l.indexOf(r)&&this.components[r]&&(this.getDOMAttribute(r)?this.components[r].handleMixinUpdate():this.removeComponent(r,!0))}setAttribute(e,i,n){var r,a,l,h,u=d.singlePropUpdate;if(!s[(l=e.indexOf("__"))>0?e.substring(0,l):e]){"mixin"===e&&this.mixinUpdate(i),super.setAttribute.call(this,e,i);return}if(!this.components[e]&&this.hasAttribute(e)&&this.updateComponent(e,window.HTMLElement.prototype.getAttribute.call(this,e)),void 0!==n&&"string"==typeof i&&i.length>0&&"string"==typeof o.styleParser.parse(i)){for(h in u)delete u[h];(r=u)[i]=n,a=!1}else r=i,a=!0===n;this.updateComponent(e,r,a),this.sceneEl&&this.sceneEl.getAttribute("debug")&&this.components[e].flushToDOM()}flushToDOM(e){var i,n,r,s=this.components,a=this.children;for(r in s)s[r].flushToDOM();if(e)for(n=0;n<a.length;++n)(i=a[n]).flushToDOM&&i.flushToDOM(e)}getAttribute(e){var i,n,r,s,o;return"position"===e?this.object3D.position:"rotation"===e?(n=this,r=a.MathUtils.radToDeg,s=n.object3D.rotation,(o=n.rotationObj).x=r(s.x),o.y=r(s.y),o.z=r(s.z),o):"scale"===e?this.object3D.scale:"visible"===e?this.object3D.visible:(i=this.components[e])?i.data:window.HTMLElement.prototype.getAttribute.call(this,e)}getDOMAttribute(e){var i=this.components[e];return i?i.attrValue:window.HTMLElement.prototype.getAttribute.call(this,e)}addState(e){!this.is(e)&&(this.states.push(e),this.emit("stateadded",e))}removeState(e){var i=this.states.indexOf(e);-1!==i&&(this.states.splice(i,1),this.emit("stateremoved",e))}is(e){return -1!==this.states.indexOf(e)}inspect(){this.sceneEl.components.inspector.openInspector(this)}destroy(){var e;if(this.parentNode){h("Entity can only be destroyed if detached from scenegraph.");return}for(e in this.components)this.components[e].destroy()}}function p(e,i){return!!e.components[i]&&!!e.components[i].attrValue||function(e,i){var n,r=!1;for(n=0;n<i.length&&!(r=i[n].hasAttribute(e));++n);return r}(i,e.mixinEls)}function f(e){return -1!==e.indexOf("__")&&(e=o.split(e,"__")[0]),!!s[e]}d.componentsUpdated=[],d.singlePropUpdate={},customElements.define("a-entity",d),e.exports.AEntity=d},"./src/core/a-mixin.js":(e,i,n)=>{var r=n("./src/core/a-node.js").ANode,s=n("./src/core/component.js").components,a=n("./src/utils/index.js"),o=a.styleParser;customElements.define("a-mixin",class extends r{constructor(){super(),this.componentCache={},this.rawAttributeCache={},this.isMixin=!0}doConnectedCallback(){super.doConnectedCallback(),this.sceneEl=this.closestScene(),this.id=this.getAttribute("id"),this.cacheAttributes(),this.updateEntities(),this.load()}attributeChangedCallback(e,i,n){super.attributeChangedCallback(),this.cacheAttribute(e,n),this.updateEntities()}setAttribute(e,i){window.HTMLElement.prototype.setAttribute.call(this,e,i),this.cacheAttribute(e,i)}cacheAttribute(e,i){var n;n=s[a.split(e,"__")[0]],void 0===i&&(i=window.HTMLElement.prototype.getAttribute.call(this,e)),this.rawAttributeCache[e]=i,n&&(this.componentCache[e]=this.parseComponentAttrValue(n,i))}parseComponentAttrValue(e,i){var n;return"string"!=typeof i?i:(e.isSingleProperty?"string"==typeof(n=e.schema.parse(i))&&(n=i):n=o.parse(i),n)}getAttribute(e){return this.componentCache[e]||window.HTMLElement.prototype.getAttribute.call(this,e)}cacheAttributes(){var e,i,n=this.attributes;for(i=0;i<n.length;i++)e=n[i].name,this.cacheAttribute(e)}updateEntities(){var e,i,n;if(this.sceneEl)for(n=0,i=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]");n<i.length;n++)(e=i[n]).hasLoaded&&!e.isMixin&&e.mixinUpdate(this.id)}})},"./src/core/a-node.js":(e,i,n)=>{var r=n("./src/utils/index.js"),s=n("./src/core/readyState.js"),a=r.debug("core:a-node:warn"),o={"a-scene":!0,"a-assets":!0,"a-assets-items":!0,"a-cubemap":!0,"a-mixin":!0,"a-node":!0,"a-entity":!0};function l(e){return e.tagName.toLowerCase()in o||e.isNode}class h extends HTMLElement{constructor(){super(),this.computedMixinStr="",this.hasLoaded=!1,this.isNode=!0,this.mixinEls=[]}connectedCallback(){if(!s.canInitializeElements){document.addEventListener("aframeready",this.connectedCallback.bind(this));return}this.doConnectedCallback()}doConnectedCallback(){var e;this.sceneEl=this.closestScene(),this.sceneEl||a("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),!this.isMixin&&(e=this.getAttribute("mixin"))&&this.updateMixins(e)}attributeChangedCallback(e,i,n){n!==this.computedMixinStr&&("mixin"!==e||this.isMixin||this.updateMixins(n,i))}closestScene(){for(var e=this;e&&!e.isScene;)e=e.parentElement;return e}closest(e){for(var i=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,n=this;n&&!i.call(n,e);)n=n.parentElement;return n}disconnectedCallback(){this.hasLoaded=!1}load(e,i){var n=this;!this.hasLoaded&&(i=i||l,Promise.allSettled(this.getChildren().filter(i).map(function(e){return new Promise(function(i,n){if(e.hasLoaded)return i();e.addEventListener("loaded",i),e.addEventListener("error",n)})})).then(function(i){i.forEach(function(e){"rejected"===e.status&&a("Rendering scene with errors on node: ",e.reason.target)}),n.isLoading=!0,n.setupMutationObserver(),e&&e(),n.isLoading=!1,n.hasLoaded=!0,n.emit("loaded-private",void 0,!1),n.emit("loaded",void 0,!1)}))}setupMutationObserver(){var e=this;new MutationObserver(function(i){var n;for(n=0;n<i.length;n++)if("attributes"===i[n].type){var r=i[n].attributeName,s=window.HTMLElement.prototype.getAttribute.call(e,r),a=i[n].oldValue;e.attributeChangedCallback(r,a,s)}}).observe(this,{attributes:!0,attributeOldValue:!0})}getChildren(){return Array.prototype.slice.call(this.children,0)}updateMixins(e,i){var n,s,a,o=h.newMixinIdArray,l=h.oldMixinIdArray,u=h.mixinIds;for(n=0,o.length=0,l.length=0,s=e?r.split(e.trim(),/\s+/):o,a=i?r.split(i.trim(),/\s+/):l,u.newMixinIds=s,u.oldMixinIds=a;n<a.length;n++)-1===s.indexOf(a[n])&&this.unregisterMixin(a[n]);for(n=0,this.computedMixinStr="",this.mixinEls.length=0;n<s.length;n++)this.registerMixin(s[n]);return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),0===s.length&&window.HTMLElement.prototype.removeAttribute.call(this,"mixin"),u}registerMixin(e){var i,n,s,o=document.getElementById(e);if(!o){a("No mixin was found with id `%s`",e);return}if(s=o.getAttribute("mixin"))for(n=0,i=r.split(s.trim(),/\s+/);n<i.length;n++)this.registerMixin(i[n]);this.computedMixinStr=this.computedMixinStr+" "+o.id,this.mixinEls.push(o)}setAttribute(e,i){"mixin"===e&&this.updateMixins(i),window.HTMLElement.prototype.setAttribute.call(this,e,i)}unregisterMixin(e){var i,n=this.mixinEls;for(i=0;i<n.length;++i)if(e===n[i].id){n.splice(i,1);break}}emit(e,i,n,s){var a=h.evtData;void 0===n&&(n=!0),a.bubbles=!!n,a.detail=i,s&&(a=r.extend({},s,a)),this.dispatchEvent(new CustomEvent(e,a))}}h.evtData={},h.newMixinIdArray=[],h.oldMixinIdArray=[],h.mixinIds={},customElements.define("a-node",h),e.exports.ANode=h,e.exports.knownTags=o},"./src/core/component.js":(e,i,n)=>{var r=n("./src/core/schema.js"),s=n("./src/core/scene/scenes.js"),a=n("./src/core/system.js"),o=n("./src/utils/index.js"),l=e.exports.components={},h=r.parseProperty,u=r.process,c=r.isSingleProperty,d=r.stringifyProperties,p=r.stringifyProperty,f=o.styleParser,m=o.debug("core:component:warn"),g=document.currentScript,A=/[A-Z]+/,v={},y=Object.freeze({}),x=[],_={get:function(e,i){return e.getComputedPropertyValue(i)},set:function(e,i,n){return i in e.schema?e.recomputeProperty(i,n):void 0!==n&&e.handleUnknownProperty(i,n),!0}},b=e.exports.Component=function(e,i,n){var r=this;if(this.sceneOnly&&!e.isScene)throw Error("Component `"+this.name+"` can only be applied to <a-scene>");if(n&&!this.multiple)throw Error("Trying to initialize multiple components of type `"+this.name+"`. There can only be one component of this type per entity.");this.el=e,this.id=n,this.attrName=this.name+(n?"__"+n:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.el.components[this.attrName]=this,this.objectPool=v[this.name];var s=this.events;this.events={},function(e,i){var n;for(n in i)e.events[n]=i[n].bind(e)}(this,s),this.attrValue=void 0,this.isObjectBased?(this.data=this.objectPool.use(),o.objectPool.removeUnusedKeys(this.data,this.schema),this.oldData=this.objectPool.use(),o.objectPool.removeUnusedKeys(this.oldData,this.schema),this.attrValueProxy=new Proxy(this,_)):(this.data=void 0,this.oldData=void 0,this.attrValueProxy=void 0),this.deferUnknownPropertyWarnings=!!this.updateSchema,this.silenceUnknownPropertyWarnings=!1,this.throttledEmitComponentChanged=o.throttleLeadingAndTrailing(function(){e.emit("componentchanged",r.evtDetail,!1)},200),this.updateProperties(i,!0)};if(b.prototype={schema:{},init:function(){},events:{},update:function(e){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},stringify:function(e){var i=this.schema;return"string"==typeof e?e:this.isSingleProperty?p(e,i):(e=d(e,i),f.stringify(e))},flushToDOM:function(e){var i=e?this.data:this.attrValue;null!=i&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(i))},updateProperties:function(e,i){var n=this.el;this.updateData(e,i),(n.hasLoaded||n.isLoading)&&(this.initialized?this.callUpdateHandler():this.initComponent())},initComponent:function(){var e,i=this.el;!i.initializingComponents[this.name]&&(i.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete i.initializingComponents[this.name],e=this.isObjectBased?y:void 0,this.dataChanged=!1,this.storeOldData(),this.update(e),i.isPlaying&&this.play(),i.emit("componentinitialized",this.evtDetail,!1))},updateData:function(e,i){if(this.isSingleProperty){this.recomputeProperty(void 0,e);return}i?(o.objectPool.clearObject(this.attrValue),this.recomputeData(e),this.schemaChangeRequired=!!this.updateSchema):"string"==typeof e?f.parse(e,this.attrValueProxy):o.extend(this.attrValueProxy,e),this.updateSchemaIfNeeded(e)},updateSchemaIfNeeded:function(e){if(!this.schemaChangeRequired||!this.updateSchema){for(var i=0;i<x.length;i++)m("Unknown property `"+x[i]+"` for component `"+this.name+"`.");x.length=0;return}x.length=0,this.updateSchema(this.data),o.objectPool.removeUnusedKeys(this.data,this.schema),this.silenceUnknownPropertyWarnings=!0,this.recomputeData(e),this.silenceUnknownPropertyWarnings=!1,this.schemaChangeRequired=!1},callUpdateHandler:function(){if(this.isPositionRotationScale||this.dataChanged){this.dataChanged=!1;var e=this.oldData;this.oldDataInUse=!0,this.update(e),e!==this.oldData&&this.objectPool.recycle(e),this.oldDataInUse=!1,this.storeOldData(),this.throttledEmitComponentChanged()}},handleMixinUpdate:function(){this.recomputeData(),this.updateSchemaIfNeeded(),this.callUpdateHandler()},resetProperty:function(e){(this.isSingleProperty||e in this.schema)&&(e?this.attrValue[e]=void 0:(this.isObjectBased&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0),this.recomputeProperty(e,void 0),this.updateSchemaIfNeeded(),this.callUpdateHandler())},extendSchema:function(e){var i;i=o.extend({},l[this.name].schema),o.extend(i,e),this.schema=u(i),this.el.emit("schemachanged",this.evtDetail)},getComputedPropertyValue:function(e){var i=this.el.mixinEls,n=this.attrValue&&e?this.attrValue[e]:this.attrValue;if(void 0!==n)return n;for(var r=i.length-1;r>=0;r--){var s=i[r].getAttribute(this.attrName);if(null!==s&&(!e||e in s))return e?s[e]:s}return e?this.schema[e].default:this.schema.default},recomputeProperty:function(e,i){var n=e?this.schema[e]:this.schema;if(null!=i){void 0===this.attrValue&&this.isObjectBased&&(this.attrValue=this.objectPool.use());var r=e?this.attrValue[e]:this.attrValue;"string"==typeof(r=n.isCacheable?h(i,n,r):i)&&(r=""===i?void 0:i),e?this.attrValue[e]=r:this.attrValue=r}this.oldDataInUse&&(this.oldData=this.objectPool.use(),o.objectPool.removeUnusedKeys(this.oldData,this.schema),this.storeOldData(),this.oldDataInUse=!1);var s=e?this.oldData[e]:this.oldData,a=e?this.data[e]:this.data,l=h(this.getComputedPropertyValue(e),n,a);return"array"!==n.type||e||(l=o.clone(l)),!n.equals(l,s)&&(this.dataChanged=!0,n.schemaChange&&(this.schemaChangeRequired=!0)),e?this.data[e]=l:this.data=l,l},handleUnknownProperty:function(e,i){void 0===this.attrValue&&(this.attrValue=this.objectPool.use()),this.attrValue[e]=i,this.silenceUnknownPropertyWarnings||(this.deferUnknownPropertyWarnings?x.push(e):this.silenceUnknownPropertyWarnings||m("Unknown property `"+e+"` for component `"+this.name+"`."))},storeOldData:function(){var e;if(!this.isObjectBased){this.oldData=this.data;return}if(this.isSingleProperty){this.oldData=h(this.data,this.schema,this.oldData);return}for(e in this.schema)void 0!==this.data[e]&&(this.data[e]&&"object"==typeof this.data[e]?this.oldData[e]=h(this.data[e],this.schema[e],this.oldData[e]):this.oldData[e]=this.data[e])},recomputeData:function(e){var i;if(this.isSingleProperty){this.recomputeProperty(void 0,e);return}if(e&&"object"==typeof e)for(i in this.schema)this.attrValueProxy[i]=e[i];else for(i in this.schema)this.attrValueProxy[i]=void 0;for(i in"string"==typeof e&&f.parse(e,this.attrValueProxy),this.attrValue)void 0!==this.attrValue[i]&&-1!==x.indexOf(i)&&(i in this.schema||m("Unknown property `"+i+"` for component `"+this.name+"`."))},eventsAttach:function(){var e;for(e in this.eventsDetach(),this.events)this.el.addEventListener(e,this.events[e])},eventsDetach:function(){var e;for(e in this.events)this.el.removeEventListener(e,this.events[e])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.data),this.objectPool.recycle(this.oldData),this.attrValue=this.data=this.oldData=this.attrValueProxy=void 0}},window.debug)var E=e.exports.registrationOrderWarnings={};function w(e){return e.tick||e.tock}function M(e){return e&&e.constructor===Object&&!(e instanceof window.HTMLElement)}e.exports.registerComponent=function(e,i){var n,r,d,p,f,y={};if(document.currentScript&&document.currentScript!==g&&s.forEach(function(i){!i.hasLoaded&&document.currentScript.compareDocumentPosition(i)!==Node.DOCUMENT_POSITION_FOLLOWING&&(m("The component `"+e+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(E[e]=!0))}),!0===A.test(e)&&m("The component name `"+e+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+e.toLowerCase()+"`"),-1!==e.indexOf("__"))throw Error("The component name `"+e+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(i).forEach(function(e){y[e]={value:i[e],writable:!0}}),l[e])throw Error("The component `"+e+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");(d=function(e,i,n){b.call(this,e,i,n)}).prototype=Object.create(b.prototype,y),d.prototype.name=e,d.prototype.isPositionRotationScale="position"===e||"rotation"===e||"scale"===e,d.prototype.constructor=d,d.prototype.system=a&&a.systems[e],d.prototype.play=(n=d.prototype.play,function(){var e=this.el.sceneEl,i=this.el.isPlaying&&!this.isPlaying;if(this.initialized&&i)n.call(this),this.isPlaying=!0,this.eventsAttach(),w(this)&&e.addBehavior(this)}),d.prototype.pause=(r=d.prototype.pause,function(){var e=this.el.sceneEl;if(this.isPlaying)r.call(this),this.isPlaying=!1,this.eventsDetach(),w(this)&&e.removeBehavior(this)}),p=o.extend(u(d.prototype.schema,d.prototype.name)),d.prototype.isSingleProperty=f=c(d.prototype.schema),d.prototype.isObjectBased=!f||f&&(M(p.default)||M(h(void 0,p))),v[e]=o.objectPool.createPool(),l[e]={Component:d,dependencies:d.prototype.dependencies,before:d.prototype.before,after:d.prototype.after,isSingleProperty:d.prototype.isSingleProperty,isObjectBased:d.prototype.isObjectBased,multiple:d.prototype.multiple,sceneOnly:d.prototype.sceneOnly,name:e,schema:p,stringify:d.prototype.stringify};for(var x=0;x<s.length;x++)s[x].emit("componentregistered",{name:e},!1);return d}},"./src/core/geometry.js":(e,i,n)=>{var r=n("./src/core/schema.js").process,s=e.exports.geometries={},a=e.exports.geometryNames=[],o=n("./src/lib/three.js"),l=e.exports.Geometry=function(){};l.prototype={schema:{},init:function(e){return this.geometry=new o.BufferGeometry,this.geometry},update:function(e){}},e.exports.registerGeometry=function(e,i){var n,o={};if(Object.keys(i).forEach(function(e){o[e]={value:i[e],writable:!0}}),s[e])throw Error("The geometry `"+e+"` has been already registered");return(n=function(){l.call(this)}).prototype=Object.create(l.prototype,o),n.prototype.name=e,n.prototype.constructor=n,s[e]={Geometry:n,schema:r(n.prototype.schema)},a.push(e),n}},"./src/core/propertyTypes.js":(e,i,n)=>{var r=n("./src/utils/coordinates.js"),s=n("./node_modules/debug/src/browser.js")("core:propertyTypes:warn"),a=e.exports.propertyTypes={},o=/[,> .[\]:]/,l=/url\((.+)\)/;function h(e,i,n,r,s,o){if(e in a)throw Error("Property type "+e+" is already registered.");a[e]={default:i,parse:n||d,stringify:r||p,equals:s||f,isCacheable:!1!==o}}function u(e,i){if(!Array.isArray(e)||!Array.isArray(i))return e===i;if(e.length!==i.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==i[n])return!1;return!0}function c(e){var i,n;if("string"!=typeof e)return e;if(n=e.match(l))return n[1];if("#"===e.charAt(0))return(i=document.getElementById(e.substring(1)))?"CANVAS"===i.tagName||"VIDEO"===i.tagName||"IMG"===i.tagName?i:i.getAttribute("src"):void s('"'+e+'" asset not found.');return e}function d(e){return e}function p(e){return null===e?"null":e.toString()}function f(e,i){return e===i}function m(e){return parseInt(e,10)}function g(e,i,n){return r.parse(e,i,n)}function A(e,i){if(null===e)return!0;if("object"!=typeof e||Object.keys(e).length!==i)return!1;var n=e.x,r=e.y,s=e.z,a=e.w;return"number"==typeof n&&"number"==typeof r&&(!(i>2)||"number"==typeof s)&&(!(i>3)||"number"==typeof a)}h("audio","",c),h("array",[],function(e){return Array.isArray(e)?e:e&&"string"==typeof e?e.split(",").map(function(e){return e.trim()}):[]},function(e){return e.join(", ")},u),h("asset","",c),h("boolean",!1,function(e){return"false"!==e&&!1!==e}),h("color","#FFF"),h("int",0,m),h("number",0,function(e){return parseFloat(e,10)}),h("map","",c),h("model","",c),h("selector",null,function(e){return e?"string"!=typeof e?e:"#"!==e[0]||o.test(e)?document.querySelector(e):document.getElementById(e.substring(1)):null},function(e){return e.getAttribute?"#"+e.getAttribute("id"):p(e)},f,!1),h("selectorAll",null,function(e){return e?"string"!=typeof e?e:Array.prototype.slice.call(document.querySelectorAll(e),0):null},function(e){return e instanceof Array?e.map(function(e){return"#"+e.getAttribute("id")}).join(", "):p(e)},u,!1),h("src","",function(e){return s("`src` property type is deprecated. Use `asset` instead."),c(e)}),h("string",""),h("time",0,m),h("vec2",{x:0,y:0},g,r.stringify,r.equals),h("vec3",{x:0,y:0,z:0},g,r.stringify,r.equals),h("vec4",{x:0,y:0,z:0,w:1},g,r.stringify,r.equals),e.exports.registerPropertyType=h,e.exports.isValidDefaultValue=function(e,i){return!!(("audio"!==e||"string"==typeof i)&&("array"!==e||Array.isArray(i)))&&("asset"!==e||"string"==typeof i)&&("boolean"!==e||"boolean"==typeof i)&&("color"!==e||"string"==typeof i)&&("int"!==e||"number"==typeof i)&&("number"!==e||"number"==typeof i)&&("map"!==e||"string"==typeof i)&&("model"!==e||"string"==typeof i)&&("selector"!==e||"string"==typeof i||null===i)&&("selectorAll"!==e||"string"==typeof i||null===i)&&("src"!==e||"string"==typeof i)&&("string"!==e||"string"==typeof i)&&("time"!==e||"number"==typeof i)&&("vec2"===e?A(i,2):"vec3"===e?A(i,3):"vec4"!==e||A(i,4))},e.exports.isValidDefaultCoordinate=A},"./src/core/readyState.js":e=>{function i(){!e.exports.canInitializeElements&&(e.exports.canInitializeElements=!0,setTimeout(function(){document.dispatchEvent(new CustomEvent("aframeready"))}))}e.exports.canInitializeElements=!1,e.exports.waitForDocumentReadyState=function(){if("complete"===document.readyState){i();return}document.addEventListener("readystatechange",function e(){"complete"===document.readyState&&(document.removeEventListener("readystatechange",e),i())})},e.exports.emitReady=i},"./src/core/scene/a-scene.js":(e,i,n)=>{var r=n("./src/core/scene/metaTags.js").inject,s=n("./src/core/scene/wakelock.js"),a=n("./src/core/scene/loadingScreen.js"),o=n("./src/core/scene/scenes.js"),l=n("./src/core/system.js").systems,h=n("./src/core/component.js").components,u=n("./src/lib/three.js"),c=n("./src/utils/index.js"),d=c.debug("core:a-scene:warn"),p=n("./src/core/a-entity.js").AEntity,f=n("./src/core/a-node.js").ANode,m=n("./src/core/scene/postMessage.js"),g=c.device.isIOS(),A=c.device.isMobile(),v=c.device.isWebXRAvailable;g&&n("./src/utils/ios-orientationchange-blank-bug.js");class y extends p{constructor(){var e;super(),e=this,e.clock=new u.Clock,e.isIOS=g,e.isMobile=A,e.hasWebXR=v,e.isAR=!1,e.isScene=!0,e.object3D=new u.Scene,e.object3D.onAfterRender=function(i,n,r){e.isPlaying&&e.tock(e.time,e.delta,r)},e.resize=e.resize.bind(e),e.render=e.render.bind(e),e.systems={},e.systemNames=[],e.time=e.delta=0,e.usedOfferSession=!1,e.componentOrder=[],e.behaviors={},e.hasLoaded=!1,e.isPlaying=!1,e.originalHTML=e.innerHTML}addFullScreenStyles(){document.documentElement.classList.add("a-fullscreen")}removeFullScreenStyles(){document.documentElement.classList.remove("a-fullscreen")}doConnectedCallback(){var e=this,i=this.hasAttribute("embedded");this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("xr-mode-ui",""),this.setAttribute("device-orientation-permission-ui",""),super.doConnectedCallback(),E(this),this.setupRenderer(),a.setup(this,b),this.resize(),i||this.addFullScreenStyles(),m(this),r(this),s(this),this.onVRPresentChangeBound=this.onVRPresentChange.bind(this),window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),this.enterVRBound=function(){e.enterVR()},this.exitVRBound=function(){e.exitVR()},this.exitVRTrueBound=function(){e.exitVR(!0)},this.pointerRestrictedBound=function(){e.pointerRestricted()},this.pointerUnrestrictedBound=function(){e.pointerUnrestricted()},e.hasWebXR||(window.addEventListener("vrdisplaydeactivate",this.exitVRBound),window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)),window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){e.attachedCallbackPostCamera()}),this.initSystems(),this.componentOrder=x(h,this.componentOrder),this.addEventListener("componentregistered",function(){e.componentOrder=x(h,e.componentOrder)}),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){e.enterVR()})}attachedCallbackPostCamera(){var e,i=this;window.addEventListener("load",e),window.addEventListener("resize",function(){i.isIOS?setTimeout(i.resize,100):i.resize()}),this.play(),o.push(this)}initSystems(){var e;for(e in this.initSystem("camera"),l)"camera"!==e&&this.initSystem(e)}initSystem(e){!this.systems[e]&&(this.systems[e]=new l[e](this),this.systemNames.push(e))}disconnectedCallback(){var e=o.indexOf(this);super.disconnectedCallback(),o.splice(e,1),window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound),window.removeEventListener("vrdisplayactivate",this.enterVRBound),window.removeEventListener("vrdisplaydeactivate",this.exitVRBound),window.removeEventListener("vrdisplayconnect",this.enterVRBound),window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound),window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound),window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound),window.removeEventListener("sessionend",this.resize),this.renderer.dispose()}addBehavior(e){var i,n,r=this.behaviors[e.name];for(n in r||(r=this.behaviors[e.name]={tick:{inUse:!1,array:[],markedForRemoval:[]},tock:{inUse:!1,array:[],markedForRemoval:[]}}),r)if(e[n]){if((i=r[n]).inUse){var s=i.markedForRemoval.indexOf(e);-1!==s&&i.markedForRemoval.splice(s,1)}-1===i.array.indexOf(e)&&i.array.push(e)}}getPointerLockElement(){return document.pointerLockElement}checkHeadsetConnected(){return c.device.checkHeadsetConnected()}enterAR(){var e;if(!this.hasWebXR)throw Error("Failed to enter AR mode, WebXR not supported.");if(!c.device.checkARSupport())throw Error("Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.");return this.enterVR(!0)}enterVR(e,i){var n,r,s=this,a=s.renderer.xr;if(i&&(!navigator.xr||!navigator.xr.offerSession))return Promise.resolve("OfferSession is not supported.");if(s.usedOfferSession&&i)return Promise.resolve("OfferSession was already called.");if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){var o=s.getAttribute("renderer");if(a.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var l=this.sceneEl.systems.webxr.sessionReferenceSpaceType;a.setReferenceSpaceType(l);var h=e?"immersive-ar":"immersive-vr";return r=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(e,n){var l=i?navigator.xr.offerSession.bind(navigator.xr):navigator.xr.requestSession.bind(navigator.xr);s.usedOfferSession|=i,l(h,r).then(function(n){i&&(s.usedOfferSession=!1),a.layersEnabled=-1!==r.requiredFeatures.indexOf("layers"),a.setSession(n).then(function(){a.setFoveation(o.foveationLevel),s.xrSession=n,s.systems.renderer.setWebXRFrameRate(n),n.addEventListener("end",s.exitVRBound),d(e)})},function(e){n(Error("Failed to enter "+("immersive-ar"===h?"AR":"VR")+" mode (`requestSession`)",{cause:e}))})})}if(n=c.device.getVRDisplay(),a.setDevice(n),n.isPresenting&&!window.hasNativeWebVRImplementation)return d(),Promise.resolve();var u={highRefreshRate:o.highRefreshRate};return n.requestPresent([{source:this.canvas,attributes:u}]).then(d,function(e){if(s.removeState("vr-mode"),e&&e.message)throw Error("Failed to enter VR mode (`requestPresent`): "+e.message);throw Error("Failed to enter VR mode (`requestPresent`).")})}return d(),Promise.resolve();function d(i){var n;window.hasNativeWebVRImplementation&&!window.hasNativeWebXRImplementation&&(n=new CustomEvent("vrdisplaypresentchange",{detail:{display:c.device.getVRDisplay()}}),window.dispatchEvent(n)),e?s.addState("ar-mode"):s.addState("vr-mode"),s.emit("enter-vr",{target:s}),!s.hasWebXR&&s.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),s.addFullScreenStyles(),s.isMobile||s.checkHeadsetConnected()||function(e){(e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen).apply(e,[{navigationUI:"hide"}])}(s.canvas),s.resize(),i&&i()}}exitVR(){var e,i=this,n=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(n.enabled=!1,e=c.device.getVRDisplay(),this.hasWebXR)this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0;else if(e.isPresenting)return e.exitPresent().then(r,function(e){if(e&&e.message)throw Error("Failed to exit VR mode (`exitPresent`): "+e.message);throw Error("Failed to exit VR mode (`exitPresent`).")})}else(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen());return r(),Promise.resolve();function r(){i.removeState("vr-mode"),i.removeState("ar-mode"),i.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),i.hasAttribute("embedded")&&i.removeFullScreenStyles(),i.resize(),i.isIOS&&c.forceCanvasResizeSafariMobile(i.canvas),i.renderer.setPixelRatio(window.devicePixelRatio),i.emit("exit-vr",{target:i})}}pointerRestricted(){if(this.canvas){var e=this.getPointerLockElement();e&&e!==this.canvas&&document.exitPointerLock&&document.exitPointerLock(),this.canvas.requestPointerLock&&this.canvas.requestPointerLock()}}pointerUnrestricted(){var e=this.getPointerLockElement();e&&e===this.canvas&&document.exitPointerLock&&document.exitPointerLock()}onVRPresentChange(e){var i=e.display||e.detail.display;if(i&&i.isPresenting){this.enterVR();return}this.exitVR()}getAttribute(e){var i=this.systems[e];return i?i.data:p.prototype.getAttribute.call(this,e)}getDOMAttribute(e){var i=this.systems[e];return i?i.data:p.prototype.getDOMAttribute.call(this,e)}setAttribute(e,i,n){if(l[e]){f.prototype.setAttribute.call(this,e,i);var r=this.systems[e];r&&r.updateProperties(i);return}p.prototype.setAttribute.call(this,e,i,n)}removeBehavior(e){var i,n,r,s=this.behaviors[e.name];for(n in s)e[n]&&-1!==(r=(i=s[n]).array.indexOf(e))&&(i.inUse?-1===i.markedForRemoval.indexOf(e)&&i.markedForRemoval.push(e):(i.array[r]=i.array[i.array.length-1],i.array.pop()))}resize(){var e,i,n=this.camera,r=this.canvas,s=this.renderer.xr.isPresenting;e=this.renderer.xr.enabled&&s,!(!n||!r||this.is("vr-mode")&&(this.isMobile||e))&&(i=b(r,this.getAttribute("embedded")&&!this.is("vr-mode"),this.maxCanvasSize,this.is("vr-mode")),n.aspect=i.width/i.height,n.updateProjectionMatrix(),this.renderer.setSize(i.width,i.height,!1),this.emit("rendererresize",null,!1))}setupRenderer(){var e,i,n,r,s=this;r={alpha:!0,antialias:!A,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:-1,width:-1},this.hasAttribute("renderer")&&(n=this.getAttribute("renderer"),(i=c.styleParser.parse(n)).precision&&(r.precision=i.precision+"p"),i.antialias&&"auto"!==i.antialias&&(r.antialias="true"===i.antialias),i.logarithmicDepthBuffer&&"auto"!==i.logarithmicDepthBuffer&&(r.logarithmicDepthBuffer="true"===i.logarithmicDepthBuffer),i.alpha&&(r.alpha="true"===i.alpha),i.stencil&&(r.stencil="true"===i.stencil),i.multiviewStereo&&(r.multiviewStereo="true"===i.multiviewStereo),this.maxCanvasSize={width:i.maxCanvasWidth?parseInt(i.maxCanvasWidth):this.maxCanvasSize.width,height:i.maxCanvasHeight?parseInt(i.maxCanvasHeight):this.maxCanvasSize.height}),(e=this.renderer=new u.WebGLRenderer(r)).setPixelRatio(window.devicePixelRatio),this.camera&&e.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){e.xr.setPoseTarget(s.camera.el.object3D)})}play(){var e=this,i=this;if(this.renderStarted){p.prototype.play.call(this);return}this.addEventListener("loaded",function(){var e,n=this.renderer,r=this.renderer.xr;p.prototype.play.call(this),!i.renderStarted&&(i.resize(),i.renderer&&(window.performance&&window.performance.mark("render-started"),a.remove(),(e=c.device.getVRDisplay())&&e.isPresenting&&(r.setDevice(e),r.enabled=!0,i.enterVR()),n.setAnimationLoop(this.render),i.renderStarted=!0,i.emit("renderstart")))}),setTimeout(function(){p.prototype.load.call(e)})}updateComponent(e){!(e in l)&&p.prototype.updateComponent.apply(this,arguments)}tick(e,i){var n,r=this.systems;for(this.callComponentBehaviors("tick",e,i),n=0;n<this.systemNames.length;n++)r[this.systemNames[n]].tick&&r[this.systemNames[n]].tick(e,i)}tock(e,i,n){var r,s=this.systems;for(this.callComponentBehaviors("tock",e,i),r=0;r<this.systemNames.length;r++)s[this.systemNames[r]].tock&&s[this.systemNames[r]].tock(e,i,n)}render(e,i){var n=this.renderer;this.frame=i,this.delta=1e3*this.clock.getDelta(),this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,this.delta);var r=null;this.is("ar-mode")&&(r=this.object3D.background,this.object3D.background=null),n.render(this.object3D,this.camera),r&&(this.object3D.background=r)}callComponentBehaviors(e,i,n){for(var r,s=0;s<this.componentOrder.length;s++){var a=this.behaviors[this.componentOrder[s]];if(a){var o=a[e];for(r=0,o.inUse=!0;r<o.array.length;r++)o.array[r].isPlaying&&o.array[r][e](i,n);for(r=0,o.inUse=!1;r<o.markedForRemoval.length;r++)this.removeBehavior(o.markedForRemoval[r]);o.markedForRemoval.length=0}}}}function x(e,i){var n,r,s={},a=i||[];for(r in a.length=0,e){var o=e[r];if(void 0!==o){var l=o.before?o.before.slice(0):[],h=o.after?o.after.slice(0):[];s[r]={before:l,after:h,visited:!1,done:!1}}}for(r in s)for(n=0;n<s[r].before.length;n++){var u=s[r].before[n];if(!(u in s)){d("Invalid ordering constraint, no component named `"+u+"` referenced by `"+r+"`");continue}s[u].after.push(r)}for(r in s)!s[r].done&&!function e(i){if(i in s&&!s[i].done){if(s[i].visited){d("Cycle detected, ignoring one or more before/after constraints. The resulting order might be incorrect");return}s[i].visited=!0;for(var n=0;n<s[i].after.length;n++){var r=s[i].after[n];r in s||d("Invalid before/after constraint, no component named `"+r+"` referenced in `"+i+"`"),e(r)}s[i].done=!0,a.push(i)}}(r);return a}function _(e,i){var n,r=window.devicePixelRatio;return!i||-1===i.width&&-1===i.height||e.width*r<i.width&&e.height*r<i.height||(n=e.width/e.height,e.width*r>i.width&&-1!==i.width&&(e.width=Math.round(i.width/r),e.height=Math.round(i.width/n/r)),e.height*r>i.height&&-1!==i.height&&(e.height=Math.round(i.height/r),e.width=Math.round(i.height*n/r))),e}function b(e,i,n,r){var s,a,o;if(!e.parentElement)return{height:0,width:0};if(i)return _({height:e.parentElement.offsetHeight,width:e.parentElement.offsetWidth},n);return s=n,a=r,(o={height:document.body.offsetHeight,width:document.body.offsetWidth},a)?o:_(o,s)}function E(e){var i;function n(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||e.exitVR(),document.activeElement.blur(),document.body.focus()}(i=document.createElement("canvas")).classList.add("a-canvas"),i.dataset.aframeCanvas=!0,e.appendChild(i),document.addEventListener("fullscreenchange",n),document.addEventListener("mozfullscreenchange",n),document.addEventListener("webkitfullscreenchange",n),document.addEventListener("MSFullscreenChange",n),i.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),e.canvas=i,e.emit("render-target-loaded",{target:i}),setTimeout(e.resize.bind(e),0)}e.exports.determineComponentBehaviorOrder=x,customElements.define("a-scene",y),e.exports.setupCanvas=E,e.exports.AScene=y},"./src/core/scene/loadingScreen.js":(e,i,n)=>{var r,s,a,o=n("./src/utils/index.js").styleParser,l="loading-screen";function h(e){var i=r.hasAttribute("embedded"),n=a(r.canvas,i,r.maxCanvasSize,r.is("vr-mode"));e.aspect=n.width/n.height,e.updateProjectionMatrix(),r.renderer.setSize(n.width,n.height,!1)}e.exports.setup=function(e,i){r=e,a=i;var n,u,c,d,p,f,m,g,A,v,y=r.hasAttribute(l)?o.parse(r.getAttribute(l)):void 0,x=y&&y.dotsColor||"white",_=y&&y.backgroundColor||"#24CAFF";(void 0===y||"true"===y.enabled||void 0===y.enabled)&&(n=new THREE.Scene,u=new THREE.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),c=new THREE.MeshBasicMaterial({color:x}),p=(d=new THREE.Mesh(u,c)).clone(),f=d.clone(),m=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),g=new THREE.Clock,A=0,v=function(){r.renderer.render(n,m),A=g.getElapsedTime()%4,d.visible=A>=1,p.visible=A>=2,f.visible=A>=3},n.background=new THREE.Color(_),n.add(m),d.position.set(-1,0,-15),p.position.set(0,0,-15),f.position.set(1,0,-15),m.add(d),m.add(p),m.add(f),(s=document.createElement("div")).className="a-loader-title",s.innerHTML=document.title,s.style.display="none",r.appendChild(s),setTimeout(function(){!r.hasLoaded&&(h(m),s.style.display="block",window.addEventListener("resize",function(){h(m)}),r.renderer.setAnimationLoop(v))},200))},e.exports.remove=function(){window.removeEventListener("resize",h),s&&(s.style.display="none")}},"./src/core/scene/metaTags.js":(e,i,n)=>{var r,s=n("./src/constants/index.js"),a=n("./src/utils/index.js").extend,o=e.exports.MOBILE_HEAD_TAGS=[h({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),h({name:"mobile-web-app-capable",content:"yes"}),h({name:"theme-color",content:"black"})],l=[h({name:"apple-mobile-web-app-capable",content:"yes"}),h({name:"apple-mobile-web-app-status-bar-style",content:"black"}),{tagName:"link",attributes:r={rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"},exists:function(){return document.querySelector('link[rel="'+r.rel+'"]')}}];function h(e){return{tagName:"meta",attributes:e,exists:function(){return document.querySelector('meta[name="'+e.name+'"]')}}}e.exports.inject=function(e){var i,n=document.head,r=n.querySelector("script"),h=[];return o.forEach(u),e.isIOS&&l.forEach(u),h;function u(e){!(!e||e.exists())&&(i=function(e){if(e&&e.tagName){var i=document.createElement(e.tagName);return i.setAttribute(s.AFRAME_INJECTED,""),a(i,e.attributes)}}(e))&&(r?r.parentNode.insertBefore(i,r):n.appendChild(i),h.push(i))}}},"./src/core/scene/postMessage.js":(e,i,n)=>{var r=n("./src/utils/index.js").isIframed;function s(e){if(e.data&&"vr"===e.data.type)switch(e.data.data){case"enter":this.enterVR();break;case"exit":this.exitVR()}}e.exports=function(e){r()&&window.addEventListener("message",s.bind(e))}},"./src/core/scene/scenes.js":e=>{e.exports=[]},"./src/core/scene/wakelock.js":(e,i,n)=>{var r=n("./vendor/wakelock/wakelock.js");e.exports=function(e){if(e.isMobile){var i=e.wakelock=new r;e.addEventListener("enter-vr",function(){i.request()}),e.addEventListener("exit-vr",function(){i.release()})}}},"./src/core/schema.js":(e,i,n)=>{var r,s=n("./src/utils/index.js"),a=n("./src/core/propertyTypes.js"),o=s.debug,l=a.isValidDefaultValue,h=a.propertyTypes,u=o("core:schema:warn");function c(e){return"type"in e?"string"==typeof e.type:"default"in e}function d(e,i){var n,r,s=e.default,a=e.type;return e.type?"bool"===e.type?a="boolean":"float"===e.type&&(a="number"):a=void 0!==s&&("boolean"==typeof s||"number"==typeof s)?typeof s:Array.isArray(s)?"array":"string",(r=h[a])||u("Unknown property type for component `"+i+"`: "+a),n=!!e.parse,e.parse=e.parse||r.parse,e.stringify=e.stringify||r.stringify,e.equals=e.equals||r.equals,e.isCacheable=!0===e.isCacheable||r.isCacheable,e.type=a,"default"in e?n||l(a,s)||u("Default value `"+s+"` does not match type `"+a+"` in component `"+i+"`"):e.default=r.default,e}function p(e,i,n){return(null==e||""===e)&&Array.isArray(e=i.default)&&(e=e.slice()),i.parse(e,i.default,n)}function f(e,i){return"object"!=typeof e?e:i&&null!==e?i.stringify(e):JSON.stringify(e)}e.exports.isSingleProperty=c,e.exports.process=function(e,i){var n;if(c(e))return d(e,i);for(n in e)e[n]=d(e[n],i);return e},e.exports.processPropertyDefinition=d,e.exports.parseProperties=(r=[],function(e,i,n,s,a){var o,l,h,c;for(l in r.length=0,n?e:i)(!n||void 0!==e[l])&&r.push(l);if(null===e||"object"!=typeof e)return e;for(l in e)void 0===e[l]||i[l]||a||u("Unknown property `"+l+"` for component/system `"+s+"`.");for(o=0;o<r.length;o++){if(h=i[l=r[o]],c=e[l],!i[l])return;e[l]=p(c,h)}return e}),e.exports.parseProperty=p,e.exports.stringifyProperties=function(e,i){var n,r,s,a,o={};for(n in e)r=i[n],"object"!=typeof(a=s=e[n])||(a=f(s,r),r||u("Unknown component property: "+n)),o[n]=a;return o},e.exports.stringifyProperty=f},"./src/core/shader.js":(e,i,n)=>{var r=n("./src/core/schema.js").process,s=e.exports.shaders={},a=e.exports.shaderNames=[],o=n("./src/lib/three.js"),l=n("./src/utils/index.js"),h={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},u=e.exports.Shader=function(){};u.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(e){return this.uniforms=this.initUniforms(),this.material=new(this.raw?o.RawShaderMaterial:o.ShaderMaterial)({uniforms:this.uniforms,glslVersion:this.raw||this.glsl3?o.GLSL3:null,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initUniforms:function(){var e,i,n=this.schema,r={};for(e in n)"uniform"===n[e].is&&(i=h[n[e].type],r[e]={type:i,value:void 0});return r},update:function(e){var i,n,r=this.schema,s=this.uniforms;for(i in e)if(r[i]&&"uniform"===r[i].is){if("map"===r[i].type){if(!s[i]||s[i].value===e[i])continue;n="_texture_"+i,this.setMapOnTextureLoad(s,i,n),l.material.updateMapMaterialFromData(n,i,this,e);continue}s[i].value=this.parseValue(r[i].type,e[i]),s[i].needsUpdate=!0}},parseValue:function(e,i){var n;switch(e){case"vec2":return new o.Vector2(i.x,i.y);case"vec3":return new o.Vector3(i.x,i.y,i.z);case"vec4":return new o.Vector4(i.x,i.y,i.z,i.w);case"color":return n=new o.Color(i),new o.Vector3(n.r,n.g,n.b);default:return i}},setMapOnTextureLoad:function(e,i,n){var r=this;this.el.addEventListener("materialtextureloaded",function(){e[i].value=r.material[n],e[i].needsUpdate=!0})}},e.exports.registerShader=function(e,i){var n,o={};if(Object.keys(i).forEach(function(e){o[e]={value:i[e],writable:!0}}),s[e])throw Error("The shader "+e+" has already been registered");return(n=function(){u.call(this)}).prototype=Object.create(u.prototype,o),n.prototype.name=e,n.prototype.constructor=n,s[e]={Shader:n,schema:r(n.prototype.schema)},a.push(e),n}},"./src/core/system.js":(e,i,n)=>{var r=n("./src/core/component.js"),s=n("./src/core/schema.js"),a=n("./src/utils/index.js"),o=n("./src/core/readyState.js"),l=s.parseProperties,h=s.parseProperty,u=s.process,c=s.isSingleProperty,d=a.styleParser,p=e.exports.systems={},f=e.exports.System=function(e){var i=r&&r.components[this.name];this.el=e,this.sceneEl=e,i&&(i.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};f.prototype={schema:{},init:function(){},update:function(e){},updateProperties:function(e){var i=this.data;Object.keys(s).length&&(this.buildData(e),this.update(i))},buildData:function(e){var i=this.schema;Object.keys(i).length&&(e=e||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),c(i)?this.data=h(e,i):this.data=l(d.parse(e)||{},i,!1,this.name))},tick:void 0,tock:void 0,play:function(){},pause:function(){}},e.exports.registerSystem=function(e,i){var n,r,s={},l=a.findAllScenes(document);if(Object.keys(i).forEach(function(e){s[e]={value:i[e],writable:!0}}),p[e])throw Error("The system `"+e+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");if((r=function(e){f.call(this,e)}).prototype=Object.create(f.prototype,s),r.prototype.name=e,r.prototype.constructor=r,r.prototype.schema=a.extend(u(r.prototype.schema)),p[e]=r,o.canInitializeElements)for(n=0;n<l.length;n++)l[n].initSystem(e)}},"./src/extras/components/index.js":(e,i,n)=>{n("./src/extras/components/pivot.js")},"./src/extras/components/pivot.js":(e,i,n)=>{var r=n("./src/core/component.js").registerComponent,s=n("./src/lib/three.js"),a=new s.Vector3,o=new s.Vector3;r("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var e=this.data,i=this.el,n=i.object3D.parent,r=i.object3D,l=new s.Group;a.copy(r.position),o.copy(r.rotation),n.remove(r),l.add(r),n.add(l),i.object3D=l,r.position.set(-1*e.x,-1*e.y,-1*e.z),l.position.set(e.x+a.x,e.y+a.y,e.z+a.z),l.rotation.copy(r.rotation),r.rotation.set(0,0,0)}})},"./src/extras/primitives/getMeshMixin.js":(e,i,n)=>{var r=n("./src/core/component.js").components,s=n("./src/core/shader.js").shaders,a=n("./src/utils/index.js"),o={};function l(e){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();"fog"===e&&(i="material-fog"),"visible"===e&&(i="material-visible"),o[i]="material."+e}Object.keys(r.material.schema).forEach(l),Object.keys(s.standard.schema).forEach(l),e.exports=function(){return{defaultComponents:{material:{}},mappings:a.extend({},o)}}},"./src/extras/primitives/index.js":(e,i,n)=>{n("./src/extras/primitives/primitives/a-camera.js"),n("./src/extras/primitives/primitives/a-cursor.js"),n("./src/extras/primitives/primitives/a-curvedimage.js"),n("./src/extras/primitives/primitives/a-gltf-model.js"),n("./src/extras/primitives/primitives/a-image.js"),n("./src/extras/primitives/primitives/a-light.js"),n("./src/extras/primitives/primitives/a-link.js"),n("./src/extras/primitives/primitives/a-obj-model.js"),n("./src/extras/primitives/primitives/a-sky.js"),n("./src/extras/primitives/primitives/a-sound.js"),n("./src/extras/primitives/primitives/a-text.js"),n("./src/extras/primitives/primitives/a-video.js"),n("./src/extras/primitives/primitives/a-videosphere.js"),n("./src/extras/primitives/primitives/meshPrimitives.js")},"./src/extras/primitives/primitives.js":(e,i,n)=>{var r=n("./src/core/a-node.js").knownTags,s=n("./src/core/a-entity.js").AEntity,a=n("./src/core/component.js").components,o=n("./src/utils/index.js"),l=o.debug,h=o.entity.setComponentProperty,u=l("extras:primitives:debug"),c=l("extras:primitives:warn"),d=l("extras:primitives:error"),p=e.exports.primitives={};function f(e,i,n){var r=o.entity.getComponentPropertyPath(e);r.constructor===Array?(n[r[0]]=n[r[0]]||{},n[r[0]][r[1]]=i.trim()):n[r]=i.trim()}e.exports.registerPrimitive=function(e,i){if(r[e=e.toLowerCase()]){d("Trying to register primitive "+e+" that has been already previously registered");return}r[e]=!0,u("Registering <%s>",e),i.defaultAttributes&&c("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var n=i.mappings||{},l=class extends s{constructor(){super(),this.defaultComponentsFromPrimitive=i.defaultComponents||i.defaultAttributes||{},this.deprecated=i.deprecated||null,this.deprecatedMappings=i.deprecatedMappings||{},this.mappings=n,i.deprecated&&console.warn(i.deprecated),this.resolveMappingCollisions()}resolveMappingCollisions(){var e=this.mappings,i=this;Object.keys(e).forEach(function(n){var r;n!==n.toLowerCase()&&c("Mapping keys should be specified in lower case. The mapping key "+n+" may not be recognized"),a[n]&&(r=e[n].replace(".","-"),e[r]=e[n],delete e[n],console.warn("The primitive "+i.tagName.toLowerCase()+" has a mapping collision. The attribute "+n+" has the same name as a registered component and has been renamed to "+r))})}getExtraComponents(){var e,i,n,r,s,a=this;for(i=o.clone(this.defaultComponentsFromPrimitive),(s=this.getAttribute("mixin"))&&(s=o.split(s.trim(),/\s+/)).forEach(function(e){var n=document.getElementById(e);if(n){var s,l,c=n.rawAttributeCache,d=n.componentCache;for(var p in c){if(r=a.mappings[p]){f(r,c[p],i);return}p in d&&(i[p]=(s=i[p],l=d[p],function(e){return void 0===e}(s)?h(l):function(e){return void 0===e}(l)?h(s):u(s)&&u(l)?o.extendDeep(s,l):h(l)))}}}),n=0;n<this.attributes.length;n++)e=this.attributes[n],(r=this.mappings[e.name])&&f(r,e.value,i);return i;function l(e){return void 0===e}function h(e){return u(e)?o.extendDeep({},e):e}function u(e){return null!==e&&e.constructor===Object}}attributeChangedCallback(e,i,n){var r=this.mappings[e];if(e in this.deprecatedMappings&&console.warn(this.deprecatedMappings[e]),!e||!r){super.attributeChangedCallback(e,i,n);return}h(this,r,n)}};return customElements.define(e,l),l.mappings=n,p[e]=l,l},e.exports.definePrimitive=function(i,n,r){r=r||{},Object.keys(n).map(function(e){!function(e,i){Object.keys(a[e].schema).map(function(n){var r=n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();void 0!==i[r]&&(r=e+"-"+n),i[r]=e+"."+n})}(e,r)}),e.exports.registerPrimitive(i,o.extendDeep({},null,{defaultComponents:n,mappings:r}))}},"./src/extras/primitives/primitives/a-camera.js":(e,i,n)=>{(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},"./src/extras/primitives/primitives/a-cursor.js":(e,i,n)=>{var r=n("./src/extras/primitives/getMeshMixin.js");(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-cursor",n("./src/utils/index.js").extendDeep({},r(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},"./src/extras/primitives/primitives/a-curvedimage.js":(e,i,n)=>{var r=n("./src/extras/primitives/getMeshMixin.js");(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-curvedimage",n("./src/utils/index.js").extendDeep({},r(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},"./src/extras/primitives/primitives/a-gltf-model.js":(e,i,n)=>{(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-gltf-model",{mappings:{src:"gltf-model"}})},"./src/extras/primitives/primitives/a-image.js":(e,i,n)=>{var r=n("./src/extras/primitives/getMeshMixin.js");(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-image",n("./src/utils/index.js").extendDeep({},r(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-light.js":(e,i,n)=>{(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap","shadow-camera-automatic":"light.shadowCameraAutomatic"}})},"./src/extras/primitives/primitives/a-link.js":(e,i,n)=>{(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},"./src/extras/primitives/primitives/a-obj-model.js":(e,i,n)=>{var r=n("./src/extras/primitives/getMeshMixin.js")();(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-obj-model",n("./src/utils/index.js").extendDeep({},r,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},"./src/extras/primitives/primitives/a-sky.js":(e,i,n)=>{var r=n("./src/extras/primitives/getMeshMixin.js"),s=n("./src/extras/primitives/primitives.js").registerPrimitive,a=n("./src/utils/index.js"),o=n("./src/extras/primitives/primitives/meshPrimitives.js");s("a-sky",a.extendDeep({},r(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:a.extendDeep({},o["a-sphere"].mappings)}))},"./src/extras/primitives/primitives/a-sound.js":(e,i,n)=>{(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},"./src/extras/primitives/primitives/a-text.js":(e,i,n)=>{(0,n("./src/extras/primitives/primitives.js").definePrimitive)("a-text",{text:{anchor:"align",width:5}})},"./src/extras/primitives/primitives/a-video.js":(e,i,n)=>{var r=n("./src/extras/primitives/getMeshMixin.js");(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-video",n("./src/utils/index.js").extendDeep({},r(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},"./src/extras/primitives/primitives/a-videosphere.js":(e,i,n)=>{var r=n("./src/extras/primitives/getMeshMixin.js");(0,n("./src/extras/primitives/primitives.js").registerPrimitive)("a-videosphere",n("./src/utils/index.js").extendDeep({},r(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},"./src/extras/primitives/primitives/meshPrimitives.js":(e,i,n)=>{var r=n("./src/extras/primitives/getMeshMixin.js"),s=n("./src/core/geometry.js").geometries,a=n("./src/core/geometry.js").geometryNames,o=n("./src/extras/primitives/primitives.js").registerPrimitive,l=n("./src/utils/index.js"),h=e.exports={};function u(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}a.forEach(function(e){var i=s[e],n=u(e),a={};Object.keys(i.schema).forEach(function(e){a[u(e)]="geometry."+e});var c="a-"+n,d=o(c,l.extendDeep({},r(),{defaultComponents:{geometry:{primitive:e}},mappings:a}));h[c]=d})},"./src/geometries/box.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js");r("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(e){this.geometry=new s.BoxGeometry(e.width,e.height,e.depth,e.segmentsWidth,e.segmentsHeight,e.segmentsDepth)}})},"./src/geometries/circle.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js"),a=s.MathUtils.degToRad;r("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new s.CircleGeometry(e.radius,e.segments,a(e.thetaStart),a(e.thetaLength))}})},"./src/geometries/cone.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js"),a=s.MathUtils.degToRad;r("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new s.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.segmentsRadial,e.segmentsHeight,e.openEnded,a(e.thetaStart),a(e.thetaLength))}})},"./src/geometries/cylinder.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js"),a=s.MathUtils.degToRad;r("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new s.CylinderGeometry(e.radius,e.radius,e.height,e.segmentsRadial,e.segmentsHeight,e.openEnded,a(e.thetaStart),a(e.thetaLength))}})},"./src/geometries/dodecahedron.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js");r("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new s.DodecahedronGeometry(e.radius,e.detail)}})},"./src/geometries/icosahedron.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js");r("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new s.IcosahedronGeometry(e.radius,e.detail)}})},"./src/geometries/index.js":(e,i,n)=>{n("./src/geometries/box.js"),n("./src/geometries/circle.js"),n("./src/geometries/cone.js"),n("./src/geometries/cylinder.js"),n("./src/geometries/dodecahedron.js"),n("./src/geometries/icosahedron.js"),n("./src/geometries/octahedron.js"),n("./src/geometries/plane.js"),n("./src/geometries/ring.js"),n("./src/geometries/sphere.js"),n("./src/geometries/tetrahedron.js"),n("./src/geometries/torus.js"),n("./src/geometries/torusKnot.js"),n("./src/geometries/triangle.js")},"./src/geometries/octahedron.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js");r("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new s.OctahedronGeometry(e.radius,e.detail)}})},"./src/geometries/plane.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js");r("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(e){this.geometry=new s.PlaneGeometry(e.width,e.height,e.segmentsWidth,e.segmentsHeight)}})},"./src/geometries/ring.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js"),a=s.MathUtils.degToRad;r("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new s.RingGeometry(e.radiusInner,e.radiusOuter,e.segmentsTheta,e.segmentsPhi,a(e.thetaStart),a(e.thetaLength))}})},"./src/geometries/sphere.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js"),a=s.MathUtils.degToRad;r("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(e){this.geometry=new s.SphereGeometry(e.radius,e.segmentsWidth,e.segmentsHeight,a(e.phiStart),a(e.phiLength),a(e.thetaStart),a(e.thetaLength))}})},"./src/geometries/tetrahedron.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js");r("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new s.TetrahedronGeometry(e.radius,e.detail)}})},"./src/geometries/torus.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js"),a=s.MathUtils.degToRad;r("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(e){this.geometry=new s.TorusGeometry(e.radius,2*e.radiusTubular,e.segmentsRadial,e.segmentsTubular,a(e.arc))}})},"./src/geometries/torusKnot.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js");r("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(e){this.geometry=new s.TorusKnotGeometry(e.radius,2*e.radiusTubular,e.segmentsTubular,e.segmentsRadial,e.p,e.q)}})},"./src/geometries/triangle.js":(e,i,n)=>{var r=n("./src/core/geometry.js").registerGeometry,s=n("./src/lib/three.js"),a=new s.Quaternion,o=new s.Vector3(0,0,1),l=new s.Vector2,h=new s.Vector2,u=new s.Vector2;r("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(e){var i,n,r,c,d,p,f,m,g;(r=new s.Triangle).a.set(e.vertexA.x,e.vertexA.y,e.vertexA.z),r.b.set(e.vertexB.x,e.vertexB.y,e.vertexB.z),r.c.set(e.vertexC.x,e.vertexC.y,e.vertexC.z),n=r.getNormal(new s.Vector3),a.setFromUnitVectors(n,o),c=r.a.clone().applyQuaternion(a),d=r.b.clone().applyQuaternion(a),p=r.c.clone().applyQuaternion(a),l.set(Math.min(c.x,d.x,p.x),Math.min(c.y,d.y,p.y)),h.set(Math.max(c.x,d.x,p.x),Math.max(c.y,d.y,p.y)),u.set(0,0).subVectors(h,l),c=new s.Vector2().subVectors(c,l).divide(u),d=new s.Vector2().subVectors(d,l).divide(u),p=new s.Vector2().subVectors(p,l).divide(u),i=this.geometry=new s.BufferGeometry,f=[r.a.x,r.a.y,r.a.z,r.b.x,r.b.y,r.b.z,r.c.x,r.c.y,r.c.z],m=[n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z],g=[c.x,c.y,d.x,d.y,p.x,p.y],i.setAttribute("position",new s.Float32BufferAttribute(f,3)),i.setAttribute("normal",new s.Float32BufferAttribute(m,3)),i.setAttribute("uv",new s.Float32BufferAttribute(g,2))}})},"./src/index.js":(e,i,n)=>{if(window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices,window.hasNativeWebXRImplementation=void 0!==navigator.xr,!window.hasNativeWebXRImplementation&&!window.hasNativeWebVRImplementation){var r=n("./src/utils/isIOSOlderThan10.js")(window.navigator.userAgent)?1/window.devicePixelRatio:1,s=n("./node_modules/webvr-polyfill/build/webvr-polyfill.js"),a={BUFFER_SCALE:r,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0,MOBILE_WAKE_LOCK:!!window.cordova};window.webvrpolyfill=new s(a)}var o=n("./src/utils/index.js"),l=o.debug,h=l("A-Frame:error"),u=l("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&u("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),window.cordova||"file:"!==window.location.protocol||h("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/1.4.0/introduction/installation.html#use-a-local-server."),o.device.isBrowserEnvironment&&(n("./src/style/aframe.css"),n("./src/style/rStats.css"));var c=n("./src/core/scene/a-scene.js").AScene,d=n("./src/core/component.js").components,p=n("./src/core/component.js").registerComponent,f=n("./src/core/geometry.js").registerGeometry,m=n("./src/extras/primitives/primitives.js").registerPrimitive,g=n("./src/core/shader.js").registerShader,A=n("./src/core/system.js").registerSystem,v=n("./src/core/shader.js").shaders,y=n("./src/core/system.js").systems,x=window.THREE=n("./src/lib/three.js"),_=n("./src/core/readyState.js"),b=n("./package.json");n("./src/components/index.js"),n("./src/geometries/index.js"),n("./src/shaders/index.js"),n("./src/systems/index.js");var E=n("./src/core/a-node.js").ANode,w=n("./src/core/a-entity.js").AEntity;n("./src/core/a-assets.js"),n("./src/core/a-cubemap.js"),n("./src/core/a-mixin.js"),n("./src/extras/components/index.js"),n("./src/extras/primitives/index.js"),console.log("A-Frame Version: 1.6.0 (Date 2024-05-23, Commit #e6c47761)"),console.log("THREE Version (https://github.com/supermedium/three.js):",x.REVISION),console.log("WebVR Polyfill Version:",b.dependencies["webvr-polyfill"]),window.AFRAME_ASYNC||_.waitForDocumentReadyState(),e.exports=window.AFRAME={AComponent:n("./src/core/component.js").Component,AEntity:w,ANode:E,ANIME:n("./node_modules/super-animejs/lib/anime.es.js").default,AScene:c,components:d,coreComponents:Object.keys(d),geometries:n("./src/core/geometry.js").geometries,registerComponent:p,registerGeometry:f,registerPrimitive:m,registerShader:g,registerSystem:A,primitives:{getMeshMixin:n("./src/extras/primitives/getMeshMixin.js"),primitives:n("./src/extras/primitives/primitives.js").primitives},scenes:n("./src/core/scene/scenes.js"),schema:n("./src/core/schema.js"),shaders:v,systems:y,emitReady:_.emitReady,THREE:x,utils:o,version:b.version}},"./src/lib/rStatsAframe.js":e=>{window.aframeStats=function(e){var i=null;return{update:function(){var n;i("te").set((n=e.querySelectorAll("*"),Array.prototype.slice.call(n).filter(function(e){return e.isEntity}),n.length)),window.performance.getEntriesByName&&i("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))},start:function(){},end:function(){},attach:function(e){i=e},values:{te:{caption:"Entities"},lt:{caption:"Load Time"}},groups:[{caption:"A-Frame",values:["te","lt"]}],fractions:[]}},e.exports={aframeStats:window.aframeStats}},"./src/lib/three.js":(e,i,n)=>{var r=n("./src/lib/three.mjs").default;n.g.THREE=r,n("./vendor/DeviceOrientationControls.js"),r.Cache&&(r.Cache.enabled=!0),e.exports=r},"./src/shaders/flat.js":(e,i,n)=>{var r=n("./src/core/shader.js").registerShader,s=n("./src/lib/three.js"),a=n("./src/utils/index.js");function o(e,i){return i.color.set(e.color),i.fog=e.fog,i.wireframe=e.wireframe,i.toneMapped=e.toneMapped,i.wireframeLinewidth=e.wireframeLinewidth,i}e.exports.Shader=r("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2},toneMapped:{default:!0}},init:function(e){this.materialData={color:new s.Color},o(e,this.materialData),this.material=new s.MeshBasicMaterial(this.materialData)},update:function(e){this.updateMaterial(e),a.material.updateMap(this,e)},updateMaterial:function(e){var i;for(i in o(e,this.materialData),this.materialData)this.material[i]=this.materialData[i]}})},"./src/shaders/index.js":(e,i,n)=>{n("./src/shaders/flat.js"),n("./src/shaders/standard.js"),n("./src/shaders/phong.js"),n("./src/shaders/sdf.js"),n("./src/shaders/msdf.js"),n("./src/shaders/shadow.js")},"./src/shaders/msdf.js":(e,i,n)=>{var r=n("./src/core/shader.js").registerShader,s=n("./src/lib/three.js");e.exports.Shader=r("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},vertexShader:"#include <common>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nout vec2 vUV;\nvoid main(void) {\n  vUV = uv;\n  #include <begin_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n  #include <fog_vertex>\n}",fragmentShader:"#include <common>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nuniform bool negate;\nuniform float alphaTest;\nuniform float opacity;\nuniform sampler2D map;\nuniform vec3 color;\nin vec2 vUV;\nfloat median(float r, float g, float b) {\n  return max(min(r, g), min(max(r, g), b));\n}\n#define BIG_ENOUGH 0.001\n#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)\nvoid main() {\n  vec3 sampleColor = texture(map, vUV).rgb;\n  if (negate) { sampleColor = 1.0 - sampleColor; }\n  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;\n  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);\n  float dscale = 0.353505;\n  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));\n  float isBigEnough = max(abs(duv.x), abs(duv.y));\n  // Do modified alpha test.\n  if (isBigEnough > BIG_ENOUGH) {\n    float ratio = BIG_ENOUGH / isBigEnough;\n    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);\n  }\n  // Do modified alpha test.\n  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }\n  gl_FragColor = vec4(color.xyz, alpha * opacity);\n  #include <logdepthbuf_fragment>\n  #include <tonemapping_fragment>\n  #include <colorspace_fragment>\n  #include <fog_fragment>\n}",init:function(){return this.uniforms=s.UniformsUtils.merge([s.UniformsLib.fog,this.initUniforms()]),this.material=new s.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}})},"./src/shaders/phong.js":(e,i,n)=>{var r=n("./src/core/shader.js").registerShader,s=n("./src/lib/three.js"),a=n("./src/utils/index.js");function o(e,i){switch(i.color.set(e.color),i.specular.set(e.specular),i.emissive.set(e.emissive),i.emissiveIntensity=e.emissiveIntensity,i.fog=e.fog,i.transparent=e.transparent,i.wireframe=e.wireframe,i.wireframeLinewidth=e.wireframeLinewidth,i.shininess=e.shininess,i.flatShading=e.flatShading,i.wireframe=e.wireframe,i.wireframeLinewidth=e.wireframeLinewidth,i.reflectivity=e.reflectivity,i.refractionRatio=e.refractionRatio,e.combine){case"mix":i.combine=s.MixOperation;break;case"multiply":i.combine=s.MultiplyOperation;break;case"add":i.combine=s.AddOperation}return e.normalMap&&(i.normalScale=e.normalScale),e.ambientOcclusionMap&&(i.aoMapIntensity=e.ambientOcclusionMapIntensity),e.bumpMap&&(i.bumpScale=e.bumpMapScale),e.displacementMap&&(i.displacementScale=e.displacementScale,i.displacementBias=e.displacementBias),i}e.exports.Shader=r("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(e){this.materialData={color:new s.Color,specular:new s.Color,emissive:new s.Color},o(e,this.materialData),this.material=new s.MeshPhongMaterial(this.materialData);var i=this.el.sceneEl;Object.defineProperty(this.material,"envMap",{get:function(){return this._envMap||i.object3D.environment},set:function(e){this._envMap=e}})},update:function(e){this.updateMaterial(e),a.material.updateMap(this,e),a.material.updateDistortionMap("normal",this,e),a.material.updateDistortionMap("displacement",this,e),a.material.updateDistortionMap("ambientOcclusion",this,e),a.material.updateDistortionMap("bump",this,e),a.material.updateEnvMap(this,e)},updateMaterial:function(e){var i;for(i in o(e,this.materialData),this.materialData)this.material[i]=this.materialData[i]}})},"./src/shaders/sdf.js":(e,i,n)=>{var r=n("./src/core/shader.js").registerShader,s=n("./src/lib/three.js");e.exports.Shader=r("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:"#include <common>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nout vec2 vUV;\nvoid main(void) {\n  vUV = uv;\n  #include <begin_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n  #include <fog_vertex>\n}",fragmentShader:"#include <common>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nuniform float alphaTest;\nuniform float opacity;\nuniform sampler2D map;\nuniform vec3 color;\nin vec2 vUV;\nfloat contour(float width, float value) {\n  return smoothstep(0.5 - value, 0.5 + value, width);\n}\n#define BIG_ENOUGH 0.001\n#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)\nvoid main() {\n  vec2 uv = vUV;\n  vec4 texColor = texture(map, uv);\n  float dist = texColor.a;\n  float width = fwidth(dist);\n  float alpha = contour(dist, width);\n  float dscale = 0.353505;\n  vec2 duv = dscale * (dFdx(uv) + dFdy(uv));\n  float isBigEnough = max(abs(duv.x), abs(duv.y));\n  if (isBigEnough > BIG_ENOUGH) {\n    float ratio = BIG_ENOUGH / isBigEnough;\n    alpha = ratio * alpha + (1.0 - ratio) * dist;\n  }\n  if (isBigEnough <= BIG_ENOUGH) {\n    vec4 box = vec4 (uv - duv, uv + duv);\n    alpha = (alpha + 0.5 * (\n      contour(texture(map, box.xy).a, width)\n      + contour(texture(map, box.zw).a, width)\n      + contour(texture(map, box.xw).a, width)\n      + contour(texture(map, box.zy).a, width)\n    )) / 3.0;\n  }\n  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }\n  gl_FragColor = vec4(color, opacity * alpha);\n  #include <logdepthbuf_fragment>\n  #include <tonemapping_fragment>\n  #include <colorspace_fragment>\n  #include <fog_fragment>\n}",init:function(){return this.uniforms=s.UniformsUtils.merge([s.UniformsLib.fog,this.initUniforms()]),this.material=new s.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}})},"./src/shaders/shadow.js":(e,i,n)=>{var r=n("./src/core/shader.js").registerShader,s=n("./src/lib/three.js");e.exports.Shader=r("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(e){this.material=new s.ShadowMaterial},update:function(e){this.material.opacity=e.opacity,this.material.alphaToCoverage=e.alphaToCoverage,this.material.transparent=e.transparent}})},"./src/shaders/standard.js":(e,i,n)=>{var r=n("./src/core/shader.js").registerShader,s=n("./src/lib/three.js"),a=n("./src/utils/index.js");function o(e,i){return i.color.set(e.color),i.emissive.set(e.emissive),i.emissiveIntensity=e.emissiveIntensity,i.fog=e.fog,i.metalness=e.metalness,i.roughness=e.roughness,i.wireframe=e.wireframe,i.wireframeLinewidth=e.wireframeLinewidth,e.normalMap&&(i.normalScale=e.normalScale),e.ambientOcclusionMap&&(i.aoMapIntensity=e.ambientOcclusionMapIntensity),e.displacementMap&&(i.displacementScale=e.displacementScale,i.displacementBias=e.displacementBias),i}e.exports.Shader=r("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(e){this.materialData={color:new s.Color,emissive:new s.Color},o(e,this.materialData),this.material=new s.MeshStandardMaterial(this.materialData)},update:function(e){this.updateMaterial(e),a.material.updateMap(this,e),a.material.updateDistortionMap("normal",this,e),a.material.updateDistortionMap("displacement",this,e),a.material.updateDistortionMap("ambientOcclusion",this,e),a.material.updateDistortionMap("metalness",this,e),a.material.updateDistortionMap("roughness",this,e),a.material.updateEnvMap(this,e)},updateMaterial:function(e){var i,n=this.material;for(i in o(e,this.materialData),this.materialData)n[i]=this.materialData[i]}})},"./src/systems/camera.js":(e,i,n)=>{var r=n("./src/constants/index.js"),s=n("./src/core/system.js").registerSystem,a="data-aframe-default-camera";e.exports.System=s("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var e,i,n=this.sceneEl,r=this;if(n.camera&&!n.camera.el.getAttribute("camera").spectator){n.emit("cameraready",{cameraEl:n.camera.el});return}if(!(e=n.querySelectorAll("a-camera, :not(a-mixin)[camera]")).length){this.createDefaultCamera();return}for(i=0,this.numUserCameras=e.length;i<e.length;i++)e[i].addEventListener("object3dset",function(e){"camera"===e.detail.type&&r.checkUserCamera(this)}),e[i].isNode?e[i].load():e[i].addEventListener("nodeready",function(){this.load()})},checkUserCamera:function(e){var i,n=this.el.sceneEl;if(this.numUserCamerasChecked++,!this.initialCameraFound){if(!(i=e.getAttribute("camera")).active||i.spectator){this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera();return}this.initialCameraFound=!0,n.camera=e.getObject3D("camera"),n.emit("cameraready",{cameraEl:e})}},createDefaultCamera:function(){var e,i=this.sceneEl;(e=document.createElement("a-entity")).setAttribute("camera",{active:!0}),e.setAttribute("position",{x:0,y:r.DEFAULT_CAMERA_HEIGHT,z:0}),e.setAttribute("wasd-controls",""),e.setAttribute("look-controls",""),e.setAttribute(r.AFRAME_INJECTED,""),e.addEventListener("object3dset",function(n){"camera"===n.detail.type&&(i.camera=n.detail.object,i.emit("cameraready",{cameraEl:e}))}),i.appendChild(e)},disableActiveCamera:function(){var e;(e=this.sceneEl.querySelectorAll(":not(a-mixin)[camera]"))[e.length-1].setAttribute("camera","active",!0)},setActiveCamera:function(e){var i,n,r,s,o=this.activeCameraEl,l=this.sceneEl;if((s=e.getObject3D("camera"))&&e!==this.activeCameraEl){var h,u,c=l.querySelector("["+a+"]");for(e===(c&&c.querySelector(":not(a-mixin)[camera]"))||(h=l).camera&&(u=h.querySelector("["+a+"]"))&&h.removeChild(u),this.activeCameraEl=e,this.activeCameraEl.play(),l.camera=s,o&&o.setAttribute("camera","active",!1),n=l.querySelectorAll(":not(a-mixin)[camera]"),r=0;r<n.length;r++)(i=n[r]).isEntity&&e!==i&&(i.setAttribute("camera","active",!1),i.pause());l.emit("camera-set-active",{cameraEl:e})}},setSpectatorCamera:function(e){var i,n=this.spectatorCameraEl,r=this.sceneEl;e.getObject3D("camera")&&e!==this.spectatorCameraEl&&(n&&n.setAttribute("camera","spectator",!1),i=this.spectatorCameraEl=e,r.addEventListener("enter-vr",this.wrapRender),r.addEventListener("exit-vr",this.unwrapRender),i.setAttribute("camera","active",!1),i.play(),r.emit("camera-set-spectator",{cameraEl:e}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){this.spectatorCameraEl&&!this.originalRender&&(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(e,i){var n,r,s=this.sceneEl;n=s.renderer.xr.enabled,this.originalRender.call(s.renderer,e,i),this.spectatorCameraEl&&!s.isMobile&&n&&(r=this.spectatorCameraEl.components.camera.camera,s.renderer.xr.enabled=!1,this.originalRender.call(s.renderer,e,r),s.renderer.xr.enabled=n)}})},"./src/systems/geometry.js":(e,i,n)=>{var r=n("./src/core/geometry.js").geometries,s=n("./src/core/system.js").registerSystem;function a(e){var i=e.primitive,n=r[i]&&r[i].Geometry,s=new n;if(!n)throw Error("Unknown geometry `"+i+"`");return s.init(e),s.geometry}e.exports.System=s("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(e){var i,n,r,s,o=this.cache;return e.skipCache?a(e):(r=o[s=this.hash(e)],(i=this.cacheCount)[n=s]=void 0===i[n]?1:i[n]+1,r||(r=a(e),o[s]=r),r)},unuseGeometry:function(e){var i,n,r,s=this.cache,a=this.cacheCount;if(!e.skipCache&&s[r=this.hash(e)]){if(i=a,n=r,i[n]--,!(a[r]>0))s[r].dispose(),delete s[r],delete a[r]}},hash:function(e){return JSON.stringify(e)}})},"./src/systems/gltf-model.js":(e,i,n)=>{var r=n("./src/core/system.js").registerSystem,s=n("./src/lib/three.js");e.exports.System=r("gltf-model",{schema:{dracoDecoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.5.6/"},basisTranscoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var e=this.data.dracoDecoderPath,i=this.data.basisTranscoderPath,n=this.data.meshoptDecoderPath;!this.dracoLoader&&e&&(this.dracoLoader=new s.DRACOLoader,this.dracoLoader.setDecoderPath(e)),!this.ktx2Loader&&i&&(this.ktx2Loader=new s.KTX2Loader,this.ktx2Loader.setTranscoderPath(i).detectSupport(this.el.renderer)),!this.meshoptDecoder&&n&&(this.meshoptDecoder=new Promise(function(e,i){var r=document.createElement("script");document.body.appendChild(r),r.onload=e,r.onerror=i,r.async=!0,r.src=n}).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getKTX2Loader:function(){return this.ktx2Loader},getMeshoptDecoder:function(){return this.meshoptDecoder}})},"./src/systems/index.js":(e,i,n)=>{n("./src/systems/camera.js"),n("./src/systems/geometry.js"),n("./src/systems/gltf-model.js"),n("./src/systems/light.js"),n("./src/systems/material.js"),n("./src/systems/obb-collider.js"),n("./src/systems/renderer.js"),n("./src/systems/shadow.js"),n("./src/systems/tracked-controls-webvr.js"),n("./src/systems/tracked-controls-webxr.js"),n("./src/systems/webxr.js")},"./src/systems/light.js":(e,i,n)=>{var r=n("./src/core/system.js").registerSystem,s=n("./src/constants/index.js"),a="data-aframe-default-light";e.exports.System=r("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",this.setupDefaultLights.bind(this))},registerLight:function(e){e.hasAttribute(a)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var e,i=this.sceneEl;if(this.defaultLights){e=document.querySelectorAll("["+a+"]");for(var n=0;n<e.length;n++)i.removeChild(e[n]);this.defaultLights=!1}},setupDefaultLights:function(){var e,i,n=this.sceneEl;!this.userDefinedLights&&!this.defaultLights&&this.data.defaultLightsEnabled&&((e=document.createElement("a-entity")).setAttribute("light",{color:"#BBB",type:"ambient"}),e.setAttribute(a,""),e.setAttribute(s.AFRAME_INJECTED,""),n.appendChild(e),(i=document.createElement("a-entity")).setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0}),i.setAttribute("position",{x:-.5,y:1,z:1}),i.setAttribute(a,""),i.setAttribute(s.AFRAME_INJECTED,""),n.appendChild(i),this.defaultLights=!0)}})},"./src/systems/material.js":(e,i,n)=>{var r=n("./src/core/system.js").registerSystem,s=n("./src/lib/three.js"),a=n("./src/utils/index.js"),o=n("./src/utils/material.js").setTextureProperties,l=n("./src/utils/material.js").createCompatibleTexture,h=a.debug,u=h("components:texture:error"),c=h("components:texture:warn"),d=new s.ImageLoader;e.exports.System=r("material",{init:function(){this.materials={},this.sourceCache={}},clearTextureSourceCache:function(){this.sourceCache={}},loadTexture:function(e,i,n){this.loadTextureSource(e,function(e){var r=l(e);o(r,i),n(r)})},loadTextureSource:function(e,i){var n=this,r=this.sourceCache,o=this.hash(e);if(r[o]){r[o].then(i);return}if("CANVAS"===e.tagName){l(new s.Source(e));return}function l(e){r[o]=Promise.resolve(e),r[o].then(i)}l(new Promise(function(i,r){a.srcLoader.validateSrc(e,function(e){n.loadImage(e,i)},function(e){n.loadVideo(e,i)})}))},loadCubeMapTexture:function(e,i){var n=this,r=0,a=new s.CubeTexture;if(a.colorSpace=s.SRGBColorSpace,6!==e.length){c("Cube map texture requires exactly 6 sources, got only %s sources",e.length);return}for(var o=0;o<e.length;o++)!function(s){n.loadTextureSource(e[s],function(e){a.images[s]=e,6==++r&&(a.needsUpdate=!0,i(a))})}(o)},loadImage:function(e,i){var n;if("string"!=typeof e){i(new s.Source(e));return}i((n=e,new Promise(function(e,i){d.load(n,function(i){e(new s.Source(i))},function(){},function(e){u("`$s` could not be fetched (Error code: %s; Response: %s)",e.status,e.statusText)})})))},loadVideo:function(e,i){var n,r,a,o;"string"!=typeof e&&((r=n=e).autoplay=r.hasAttribute("autoplay")&&"false"!==r.getAttribute("autoplay"),r.controls=r.hasAttribute("controls")&&"false"!==r.getAttribute("controls"),"false"===r.getAttribute("loop")&&r.removeAttribute("loop"),"false"===r.getAttribute("preload")&&(r.preload="none"),r.crossOrigin=r.crossOrigin||"anonymous",r.setAttribute("playsinline",""),r.setAttribute("webkit-playsinline","")),n=n||(a=e,(o=document.createElement("video")).setAttribute("playsinline",""),o.setAttribute("webkit-playsinline",""),o.autoplay=!0,o.loop=!0,o.crossOrigin="anonymous",o.addEventListener("error",function(){c("`%s` is not a valid video",a)},!0),o.src=a,o),i(new s.Source(n))},hash:function(e){return e.tagName&&(e.id||e.src)||e},registerMaterial:function(e){this.materials[e.uuid]=e},unregisterMaterial:function(e){delete this.materials[e.uuid]}})},"./src/systems/obb-collider.js":(e,i,n)=>{(0,n("./src/core/system.js").registerSystem)("obb-collider",{schema:{showColliders:{default:!1}},init:function(){this.collisions=[],this.colliderEls=[]},addCollider:function(e){this.colliderEls.push(e),this.data.showColliders?e.components["obb-collider"].showCollider():e.components["obb-collider"].hideCollider(),this.tick=this.detectCollisions},removeCollider:function(e){var i=this.colliderEls,n=i.indexOf(e);e.components["obb-collider"].hideCollider(),n>-1&&i.splice(n,1),0===i.length&&(this.tick=void 0)},registerCollision:function(e,i){var n=this.collisions,r=!1,s=e.obb,a=i.obb,o=e.renderColliderMesh,l=i.renderColliderMesh;o&&o.material.color.set(0xff0000),l&&l.material.color.set(0xff0000);for(var h=0;h<n.length;h++)if(n[h].componentA.obb===s&&n[h].componentB.obb===a||n[h].componentA.obb===a&&n[h].componentB.obb===s){r=!0,n[h].detected=!0;break}r||(n.push({componentA:e,componentB:i,detected:!0}),e.el.emit("obbcollisionstarted",{trackedObject3D:e.trackedObject3D,withEl:i.el}),i.el.emit("obbcollisionstarted",{trackedObject3D:i.trackedObject3D,withEl:e.el}))},resetCollisions:function(){for(var e=this.collisions,i=0;i<e.length;i++)e[i].detected=!1},clearCollisions:function(){for(var e,i,n,r,s=this.collisions,a=[],o=0;o<s.length;o++)s[o].detected?a.push(s[o]):(e=s[o].componentA,i=s[o].componentB,n=e.renderColliderMesh,r=i.renderColliderMesh,n&&n.material.color.set(65280),e.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:i.el}),r&&r.material.color.set(65280),i.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:e.el}));this.collisions=a},detectCollisions:function(){var e,i,n,r,s=this.colliderEls;if(!(s.length<2)){this.resetCollisions();for(var a=0;a<s.length;a++)if(n=s[a].components["obb-collider"],0!==(e=s[a].components["obb-collider"].obb).halfSize.x&&0!==e.halfSize.y&&0!==e.halfSize.z)for(var o=a+1;o<s.length;o++)0!==(i=(r=s[o].components["obb-collider"]).obb).halfSize.x&&0!==i.halfSize.y&&0!==i.halfSize.z&&e.intersectsOBB(i)&&this.registerCollision(n,r);this.clearCollisions()}}})},"./src/systems/renderer.js":(e,i,n)=>{var r=n("./src/core/system.js").registerSystem,s=n("./src/utils/index.js"),a=n("./src/lib/three.js"),o=(0,s.debug)("components:renderer:warn");function l(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.z-i.z}function h(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder-i.renderOrder}function u(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:i.z-e.z}e.exports.System=r("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:s.device.isOculusBrowser()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:-1},maxCanvasHeight:{default:-1},multiviewStereo:{default:!1},physicallyCorrectLights:{default:!1},exposure:{default:1,if:{toneMapping:["ACESFilmic","linear","reinhard","cineon"]}},toneMapping:{default:"no",oneOf:["no","ACESFilmic","linear","reinhard","cineon"]},precision:{default:"high",oneOf:["high","medium","low"]},anisotropy:{default:1},sortTransparentObjects:{default:!1},colorManagement:{default:!0},alpha:{default:!0},stencil:{default:!1},foveationLevel:{default:1}},init:function(){var e=this.data,i=this.el,n=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1),r=i.renderer;e.physicallyCorrectLights||(r.useLegacyLights=!e.physicallyCorrectLights),r.toneMapping=a[n+"ToneMapping"],a.Texture.DEFAULT_ANISOTROPY=e.anisotropy,a.ColorManagement.enabled=e.colorManagement,r.outputColorSpace=e.colorManagement?a.SRGBColorSpace:a.LinearSRGBColorSpace,i.hasAttribute("antialias")&&o('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),i.hasAttribute("logarithmicDepthBuffer")&&o('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.'),r.sortObjects=!0,r.setOpaqueSort(l)},update:function(){var e=this.data,i=this.el.renderer,n=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1);i.toneMapping=a[n+"ToneMapping"],i.toneMappingExposure=e.exposure,i.xr.setFoveation(e.foveationLevel),e.sortObjects&&o('`sortObjects` property is deprecated. Use `renderer="sortTransparentObjects: true"` instead.'),e.sortTransparentObjects?i.setTransparentSort(u):i.setTransparentSort(h)},applyColorCorrection:function(e){this.data.colorManagement&&e&&e.isTexture&&e.colorSpace!==a.SRGBColorSpace&&(e.colorSpace=a.SRGBColorSpace,e.needsUpdate=!0)},setWebXRFrameRate:function(e){var i,n=this.data,r=e.supportedFrameRates;r&&e.updateTargetFrameRate&&(i=r.includes(90)?n.highRefreshRate?90:72:n.highRefreshRate?72:60,e.updateTargetFrameRate(i).catch(function(e){console.warn("failed to set target frame rate of "+i+". Error info: "+e)}))}}),e.exports.sortFrontToBack=l,e.exports.sortRenderOrderOnly=h,e.exports.sortBackToFront=u},"./src/systems/shadow.js":(e,i,n)=>{var r=n("./src/core/system.js").registerSystem,s=n("./src/lib/three.js"),a={basic:s.BasicShadowMap,pcf:s.PCFShadowMap,pcfsoft:s.PCFSoftShadowMap};e.exports.System=r("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var e=this.sceneEl,i=this.data;this.shadowMapEnabled=!1,e.renderer.shadowMap.type=a[i.type],e.renderer.shadowMap.autoUpdate=i.autoUpdate},update:function(e){e.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.shadowMapEnabled)},setShadowMapEnabled:function(e){var i,n=this.sceneEl,r=this.sceneEl.renderer;this.shadowMapEnabled=e;var s=this.data.enabled&&this.shadowMapEnabled;r&&s!==r.shadowMap.enabled&&(r.shadowMap.enabled=s,!(i=n).hasLoaded||i.object3D.traverse(function(e){if(e.material)for(var i=Array.isArray(e.material)?e.material:[e.material],n=0;n<i.length;n++)i[n].needsUpdate=!0}))}})},"./src/systems/tracked-controls-webvr.js":(e,i,n)=>{var r=n("./src/core/system.js").registerSystem,s=n("./src/utils/index.js"),a=s.device.isWebXRAvailable;e.exports.System=r("tracked-controls-webvr",{init:function(){var e=this;this.controllers=[],this.isChrome=-1!==navigator.userAgent.indexOf("Chrome"),this.updateControllerList(),this.throttledUpdateControllerList=s.throttle(this.updateControllerList,500,this),!a&&navigator.getVRDisplays&&this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(i){i.length&&(e.vrDisplay=i[0])})})},tick:function(){this.isChrome?this.updateControllerList():this.throttledUpdateControllerList()},updateControllerList:function(){var e,i,n,r,s=this.controllers;if(i=navigator.getGamepads&&navigator.getGamepads()){for(n=0,r=s.length,s.length=0;n<i.length;++n)(e=i[n])&&e.pose&&s.push(e);s.length!==r&&this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/tracked-controls-webxr.js":(e,i,n)=>{var r=n("./src/core/system.js").registerSystem,s=n("./src/utils/index.js");e.exports.System=r("tracked-controls-webxr",{init:function(){this.controllers=[],this.oldControllers=[],this.oldControllersLength=0,this.throttledUpdateControllerList=s.throttle(this.updateControllerList,500,this),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.addEventListener("enter-vr",this.updateReferenceSpace),this.el.addEventListener("exit-vr",this.updateReferenceSpace)},tick:function(){this.throttledUpdateControllerList()},updateReferenceSpace:function(){var e=this,i=this.el.xrSession;if(!i){this.referenceSpace=void 0,this.controllers=[],this.oldControllersLength>0&&(this.oldControllersLength=0,this.el.emit("controllersupdated",void 0,!1));return}var n=e.el.sceneEl.systems.webxr.sessionReferenceSpaceType;i.requestReferenceSpace(n).then(function(i){e.referenceSpace=i}).catch(function(i){throw e.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(n,'tracked-controls-webxr uses reference space "'+n+'".'),i})},updateControllerList:function(){var e,i=this.el.xrSession,n=this.oldControllers;if(!i){if(0===this.oldControllersLength)return;this.oldControllersLength=0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1);return}if(i.inputSources){if(this.controllers=i.inputSources,this.oldControllersLength===this.controllers.length){var r=!0;for(e=0;e<this.controllers.length;++e)if(this.controllers[e]!==n[e]||this.controllers[e].gamepad!==n[e].gamepad){r=!1;break}if(r)return}for(e=0,n.length=0;e<this.controllers.length;e++)n.push(this.controllers[e]);this.oldControllersLength=this.controllers.length,this.el.emit("controllersupdated",void 0,!1)}}})},"./src/systems/webxr.js":(e,i,n)=>{var r=n("./src/core/system.js").registerSystem,s=n("./src/utils/index.js").debug("systems:webxr:warn");e.exports.System=r("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var e=this.data;this.sessionConfiguration={requiredFeatures:e.requiredFeatures,optionalFeatures:e.optionalFeatures},this.sessionReferenceSpaceType=e.referenceSpaceType,e.overlayElement&&(e.overlayElement.classList.remove("a-dom-overlay"),e.optionalFeatures.includes("dom-overlay")||(e.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",e)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:e.overlayElement},e.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(e){return!!("viewer"===e||"local"===e||this.sessionConfiguration.requiredFeatures.includes(e)||this.sessionConfiguration.optionalFeatures.includes(e))},warnIfFeatureNotRequested:function(e,i){this.wasFeatureRequested(e)||s((i?i+" ":"")+('Please add the feature "'+e)+"\" to a-scene's webxr system options in requiredFeatures/optionalFeatures.")}})},"./src/utils/coordinates.js":(e,i,n)=>{var r=n("./src/utils/debug.js")("utils:coordinates:warn"),s=["x","y","z","w"],a=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;e.exports.regex=a;var o=/\s+/g;function l(e){return a.test(e)}function h(e){return null!=e&&e.constructor===String?parseFloat(e,10):e}e.exports.parse=function(e,i,n){var r,a,l,u,c,d,p,f,m=n&&"object"==typeof n?n:{};if(e&&e instanceof Object)return c=void 0===e.x?i&&i.x:e.x,d=void 0===e.y?i&&i.y:e.y,p=void 0===e.z?i&&i.z:e.z,f=void 0===e.w?i&&i.w:e.w,null!=c&&(m.x=h(c)),null!=d&&(m.y=h(d)),null!=p&&(m.z=h(p)),null!=f&&(m.w=h(f)),m;if(null==e)return"object"==typeof i?Object.assign(m,i):i;for(u=0,r=e.trim().split(o);u<s.length;u++)if(l=s[u],r[u])m[l]=parseFloat(r[u],10);else{if(void 0===(a=i&&i[l]))continue;m[l]=h(a)}return m},e.exports.stringify=function(e){var i;return"object"!=typeof e?e:(i=e.x+" "+e.y,null!=e.z&&(i+=" "+e.z),null!=e.w&&(i+=" "+e.w),i)},e.exports.equals=function(e,i){return"object"!=typeof e||"object"!=typeof i?e===i:e.x===i.x&&e.y===i.y&&e.z===i.z&&e.w===i.w},e.exports.isCoordinates=l,e.exports.isCoordinate=function(e){return r("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),l(e)},e.exports.toVector3=function(e){return new THREE.Vector3(e.x,e.y,e.z)}},"./src/utils/debug.js":(e,i,n)=>{var r=n("./node_modules/debug/src/browser.js"),s=n("./src/utils/device.js").isBrowserEnvironment,a={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}};r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),this.useColors){this.color=(n=(i=this.namespace.split(":"))[i.length-1],a.colors&&a.colors[n]||null);var i,n,r="color: "+this.color;e.splice(1,0,r,"color: inherit");var s=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(s++,"%c"===e&&(o=s))}),e.splice(o,0,r)}};var o=function(){try{return window.localStorage}catch(e){}}();o&&(parseInt(o.logs,10)||"true"===o.logs)?r.enable("*"):r.enable("*:error,*:info,*:warn"),s&&(window.logs=r),e.exports=r},"./src/utils/device.js":(e,i,n)=>{var r,s,a,o=n("./node_modules/debug/src/browser.js")("device:error"),l=!1,h=!1,u=e.exports.isWebXRAvailable=void 0!==navigator.xr;if(window.addEventListener("vrdisplayactivate",function(e){var i;!u&&(i=document.createElement("canvas"),a=e.display,i.getContext("webgl",{}),a.requestPresent([{source:i}]).then(function(){},function(){}))}),u){var c=function(){var e=document.querySelector("a-scene");if(!e){window.addEventListener("DOMContentLoaded",c);return}e.hasLoaded?e.components["xr-mode-ui"].updateEnterInterfaces():e.addEventListener("loaded",c)},d=function(e){o("WebXR session support error: "+e.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(e){l=e,c()}).catch(d),navigator.xr.isSessionSupported("immersive-ar").then(function(e){h=e,c()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){l=!0,c()}).catch(d),navigator.xr.supportsSession("immersive-ar").then(function(){h=!0,c()}).catch(function(){})):o("WebXR has neither isSessionSupported or supportsSession?!")}else navigator.getVRDisplays&&navigator.getVRDisplays().then(function(e){var i=document.querySelector("a-scene");a=e.length&&e[0],i&&i.emit("displayconnected",{vrDisplay:a})});e.exports.getVRDisplay=function(){return a},e.exports.checkHeadsetConnected=function(){return l||h||!!a},e.exports.checkARSupport=function(){return h},e.exports.checkVRSupport=function(){return l};var p=(r=!1,s=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(s)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(s.substr(0,4)))&&(r=!0),(g()||f()||x())&&(r=!0),y()&&(r=!1),function(){return r});function f(e){var i=e||window.navigator.userAgent;return/Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(i)||m()}function m(e,i,n){var r=e||window.navigator.userAgent,s=i||window.navigator.platform,a=n||window.navigator.maxTouchPoints||0;return("iPad"===s||"MacIntel"===s)&&a>0&&/Macintosh|Intel|iPad|ipad/i.test(r)&&!window.MSStream}function g(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function A(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function v(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function y(){return A()||v()}function x(){return/R7 Build/.test(window.navigator.userAgent)}e.exports.isMobile=p,e.exports.isTablet=f,e.exports.isIpad=m,e.exports.isIOS=g,e.exports.isMobileDeviceRequestingDesktopSite=function(){return!p()&&!y()&&void 0!==window.orientation},e.exports.isOculusBrowser=A,e.exports.isFirefoxReality=v,e.exports.isMobileVR=y,e.exports.isR7=x,e.exports.isLandscape=function(){var e=window.orientation;return x()&&(e+=90),90===e||-90===e},e.exports.isBrowserEnvironment="undefined"==typeof process||!0===process.browser,e.exports.isNodeEnvironment=!e.exports.isBrowserEnvironment},"./src/utils/entity.js":(e,i,n)=>{var r=n("./src/utils/split.js").split;function s(e,i){var n=r(e,i=i||".");return 1===n.length?n[0]:n}e.exports.getComponentPropertyPath=s,e.exports.getComponentProperty=function(e,i,n){var r;return(n=n||".",-1!==i.indexOf(n))?(r=s(i,n)).constructor===String?e.getAttribute(r):e.getAttribute(r[0])[r[1]]:e.getAttribute(i)},e.exports.setComponentProperty=function(e,i,n,r){var a;if(r=r||".",-1!==i.indexOf(r)){(a=s(i,r)).constructor===String?e.setAttribute(a,n):e.setAttribute(a[0],a[1],n);return}e.setAttribute(i,n)}},"./src/utils/forceCanvasResizeSafariMobile.js":e=>{e.exports=function(e){var i=e.style.width,n=e.style.height;e.style.width=parseInt(i,10)+1+"px",e.style.height=parseInt(n,10)+1+"px",setTimeout(function(){e.style.width=i,e.style.height=n},200)}},"./src/utils/index.js":(e,i,n)=>{var r,s,a=n("./src/utils/debug.js"),o=n("./node_modules/deep-assign/index.js"),l=n("./src/utils/device.js"),h=n("./src/utils/object-pool.js"),u=a("utils:warn");e.exports.bind=function(e){return e.bind.apply(e,Array.prototype.slice.call(arguments,1))},e.exports.coordinates=n("./src/utils/coordinates.js"),e.exports.debug=a,e.exports.device=l,e.exports.entity=n("./src/utils/entity.js"),e.exports.forceCanvasResizeSafariMobile=n("./src/utils/forceCanvasResizeSafariMobile.js"),e.exports.material=n("./src/utils/material.js"),e.exports.objectPool=h,e.exports.split=n("./src/utils/split.js").split,e.exports.styleParser=n("./src/utils/styleParser.js"),e.exports.trackedControls=n("./src/utils/tracked-controls.js"),e.exports.checkHeadsetConnected=function(){return u("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),l.checkHeadsetConnected(arguments)},e.exports.isGearVR=e.exports.device.isGearVR=function(){u("`utils.isGearVR` has been deprecated, use `utils.device.isMobileVR`")},e.exports.isIOS=function(){return u("`utils.isIOS` has moved to `utils.device.isIOS`"),l.isIOS(arguments)},e.exports.isOculusGo=e.exports.device.isOculusGo=function(){u("`utils.isOculusGo` has been deprecated, use `utils.device.isMobileVR`")},e.exports.isMobile=function(){return u("`utils.isMobile has moved to `utils.device.isMobile`"),l.isMobile(arguments)},e.exports.throttle=function(e,i,n){var r;return n&&(e=e.bind(n)),function(){var n=Date.now(),s=void 0===r?i:n-r;(void 0===r||s>=i)&&(r=n,e.apply(null,arguments))}},e.exports.throttleLeadingAndTrailing=function(e,i,n){n&&(e=e.bind(n));var r,s,a,o=function(){r=Date.now(),e.apply(this,a),s=void 0};return function(){var n=Date.now(),l=void 0===r?i:n-r;l>=i?(clearTimeout(s),s=void 0,r=n,e.apply(null,arguments)):(s=s||setTimeout(o,i-l),a=arguments)}},e.exports.throttleTick=function(e,i,n){var r;return n&&(e=e.bind(n)),function(n,s){var a=void 0===r?s:n-r;(void 0===r||a>=i)&&(r=n,e(n,a))}},e.exports.debounce=function(e,i,n){var r;return function(){var s=this,a=arguments,o=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(s,a)},i),o&&e.apply(s,a)}},e.exports.extend=Object.assign,e.exports.extendDeep=o,e.exports.clone=function(e){return JSON.parse(JSON.stringify(e))};var c=(r=h.createPool(function(){return[]}),function(e,i){var n,s,a,o,l,h;if(void 0===e||void 0===i||null===e||null===i||!(e&&i&&e.constructor===Object&&i.constructor===Object||e.constructor===Array&&i.constructor===Array))return e===i;for(n in s=r.use(),a=r.use(),s.length=0,a.length=0,e)s.push(n);for(n in i)a.push(n);if(s.length!==a.length)return r.recycle(s),r.recycle(a),!1;for(o=0;o<s.length;++o)if(l=e[s[o]],h=i[s[o]],"object"==typeof l||"object"==typeof h||Array.isArray(l)&&Array.isArray(h)){if(l===h)continue;if(!c(l,h))return r.recycle(s),r.recycle(a),!1}else if(l!==h)return r.recycle(s),r.recycle(a),!1;return r.recycle(s),r.recycle(a),!0});e.exports.deepEqual=c,e.exports.diff=(s=[],function(e,i,n){var r,a,o,l,h,u,d;for(h in l=n||{},s.length=0,e)s.push(h);if(!i)return l;for(o in i)-1===s.indexOf(o)&&s.push(o);for(u=0;u<s.length;u++)r=e[h=s[u]],a=i[h],((d=r&&a&&r.constructor===Object&&a.constructor===Object)&&!c(r,a)||!d&&r!==a)&&(l[h]=a);return l}),e.exports.shouldCaptureKeyEvent=function(e){return!e.metaKey&&document.activeElement===document.body},e.exports.splitString=function(e,i){void 0===i&&(i=" ");var n=RegExp(i,"g");return(e=(e||"").replace(n,i)).split(i)},e.exports.getElData=function(e,i){var n={};return Object.keys(i=i||{}).forEach(function(i){e.hasAttribute(i)&&(n[i]=e.getAttribute(i))}),n},e.exports.getUrlParameter=function(e){var i=RegExp("[\\?&]"+(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"))+"=([^&#]*)").exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},e.exports.isIframed=function(){return window.top!==window.self},e.exports.findAllScenes=function(e){for(var i=[],n=e.getElementsByTagName("*"),r=0,s=n.length;r<s;r++)n[r].isScene&&i.push(n[r]);return i},e.exports.srcLoader=n("./src/utils/src-loader.js")},"./src/utils/ios-orientationchange-blank-bug.js":()=>{window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)})},"./src/utils/isIOSOlderThan10.js":e=>{e.exports=function(e){return/(iphone|ipod|ipad).*os.(7_|8_|9_)/i.test(e)}},"./src/utils/material.js":(e,i,n)=>{var r=n("./src/lib/three.js"),s=n("./src/utils/src-loader.js"),a=n("./src/utils/debug.js")("utils:material:warn"),o=new Set(["emissiveMap","envMap","map","specularMap"]);function l(e,i){var n=i.offset||{x:0,y:0},s=i.repeat||{x:1,y:1},a=i.npot||!1,o=i.anisotropy||r.Texture.DEFAULT_ANISOTROPY,l=e.wrapS,h=e.wrapT,u=e.magFilter,c=e.minFilter;a&&(l=r.ClampToEdgeWrapping,h=r.ClampToEdgeWrapping,u=r.LinearFilter,c=r.LinearFilter),(1!==s.x||1!==s.y)&&(l=r.RepeatWrapping,h=r.RepeatWrapping),e.offset.set(n.x,n.y),e.repeat.set(s.x,s.y),(e.wrapS!==l||e.wrapT!==h||e.magFilter!==u||e.minFilter!==c||e.anisotropy!==o)&&(e.wrapS=l,e.wrapT=h,e.magFilter=u,e.minFilter=c,e.anisotropy=o,e.needsUpdate=!0)}e.exports.setTextureProperties=l,e.exports.updateMapMaterialFromData=function(e,i,n,s){var a=n.el,h=n.material,p=a.sceneEl.systems.renderer,f=s[i];if(n.materialSrcs||(n.materialSrcs={}),!f){delete n.materialSrcs[e],m(null);return}if(f===n.materialSrcs[e]&&h[e]){l(h[e],s);return}function m(i){h[e]!==i&&(h[e]&&h[e].dispose(),h[e]=i,h.needsUpdate=!0,u(a,i))}n.materialSrcs[e]=f,f instanceof r.Texture?m(f):a.sceneEl.systems.material.loadTextureSource(f,function(i){if(n.materialSrcs[e]===f){var r=h[e];r&&(null===i||!c(r,i))&&(r=null),!r&&i&&(r=d(i)),r&&(r.source!==i&&(r.source=i,r.needsUpdate=!0),o.has(e)&&p.applyColorCorrection(r),l(r,s)),m(r)}})},e.exports.updateMap=function(i,n){return e.exports.updateMapMaterialFromData("map","src",i,n)},e.exports.updateDistortionMap=function(i,n,r){var s=i;"ambientOcclusion"===i&&(s="ao");var a={};return a.src=r[i+"Map"],a.offset=r[i+"TextureOffset"],a.repeat=r[i+"TextureRepeat"],a.wrap=r[i+"TextureWrap"],e.exports.updateMapMaterialFromData(s+"Map","src",n,a)};var h={};function u(e,i){if(i)e.emit("materialtextureloaded",{src:i.image,texture:i}),i.image&&"VIDEO"===i.image.tagName&&(i.image.addEventListener("loadeddata",n),i.image.addEventListener("ended",r),i.addEventListener("dispose",function(){i.image.removeEventListener("loadeddata",n),i.image.removeEventListener("ended",r)}));function n(){e.emit("materialvideoloadeddata",{src:i.image,texture:i})}function r(){e.emit("materialvideoended",{src:i.image,texture:i})}}function c(e,i){return i.data instanceof HTMLCanvasElement?e.isCanvasTexture:i.data instanceof HTMLVideoElement?e.isVideoTexture&&e.source===i:e.isTexture&&!e.isCanvasTexture&&!e.isVideoTexture}function d(e){var i;return e.data instanceof HTMLCanvasElement?i=new r.CanvasTexture:e.data instanceof HTMLVideoElement?i=new r.VideoTexture(e.data):i=new r.Texture,i.source=e,i.needsUpdate=!0,i}e.exports.updateEnvMap=function(e,i){var n=e.material,o=e.el,l="envMap",c=i.envMap,d=i.sphericalEnvMap,p=i.refract;if(d&&(c=d,a("`sphericalEnvMap` property is deprecated, using spherical map as equirectangular map instead. Use `envMap` property with a CubeMap or Equirectangular image instead.")),e.materialSrcs||(e.materialSrcs={}),!c){delete e.materialSrcs[l],n.envMap=null,n.needsUpdate=!0;return}if(e.materialSrcs[l]=c,h[c]){h[c].then(f);return}function f(i){e.materialSrcs[l]===c&&(n.envMap=i,n.needsUpdate=!0,u(o,i))}h[c]=new Promise(function(e){s.validateEnvMapSrc(c,function(i){o.sceneEl.systems.material.loadCubeMapTexture(i,function(i){i.mapping=p?r.CubeRefractionMapping:r.CubeReflectionMapping,f(i),e(i)})},function(i){o.sceneEl.systems.material.loadTexture(i,{src:i},function(i){i.mapping=p?r.EquirectangularRefractionMapping:r.EquirectangularReflectionMapping,f(i),e(i)})})})},e.exports.handleTextureEvents=u,e.exports.isCompatibleTexture=c,e.exports.createCompatibleTexture=d},"./src/utils/math.js":e=>{function i(e,i,n){return(i.dot(e)-i.dot(n))/i.length()}e.exports.distanceOfPointFromPlane=i,e.exports.nearestPointInPlane=function(e,n,r,s){var a=i(e,n,r);return s.copy(n),s.multiplyScalar(a),s.add(r),s}},"./src/utils/object-pool.js":e=>{var i=Object.freeze(Object.create(null));function n(){return{}}function r(e){var i;if(e&&e.constructor===Object)for(i in e)e[i]=void 0}e.exports.createPool=function(e){var s=[],a=null;function o(i){var n,r;if((i=void 0===i?s.length:i)>0&&null==a&&(a=0),i>0)for(n=s.length,s.length+=Number(i),r=n;r<s.length;r++)s[r]=e();return s.length}return e=e||n,{grow:o,pool:s,recycle:function(e){if(e instanceof Object){if(null===a||-1===a){s[s.length]=e;return}s[--a]=e}},size:function(){return s.length},use:function(){var e;return(null===a||a===s.length)&&o(s.length||5),e=s[a],s[a++]=i,r(e),e}}},e.exports.clearObject=r,e.exports.removeUnusedKeys=function(e,i){var n;if(e&&e.constructor===Object)for(n in e)n in i||delete e[n]}},"./src/utils/split.js":e=>{var i;e.exports.split=(i={},function(e,n){return n in i||(i[n]={}),e in i[n]||(i[n][e]=e.split(n)),i[n][e]})},"./src/utils/src-loader.js":(e,i,n)=>{var r=n("./src/utils/debug.js")("utils:src-loader:warn");function s(e,i,n){(function(e,i){var n;if(e.tagName){i("IMG"===e.tagName);return}(n=new XMLHttpRequest).open("HEAD",e),n.addEventListener("load",function(r){var s;n.status>=200&&n.status<300?null==(s=n.getResponseHeader("Content-Type"))?l(e,i):s.startsWith("image")?i(!0):i(!1):l(e,i),n.abort()}),n.send()})(e,function(r){if(r){i(e);return}n(e)})}function a(e,i,n){var a,l,h,u="",c=[];if("string"==typeof e){for(l=0;l<5;l++)u+="(url\\((?:[^\\)]+)\\),\\s*)";function d(e){c.push(e),6===c.length&&i(c)}if(u+="(url\\((?:[^\\)]+)\\)\\s*)",h=e.match(new RegExp(u))){for(l=1;l<7;l++)s(o(h[l]),d);return}if(!e.startsWith("#")){var p=o(e);p?s(p,n):s(e,n);return}}return(a=e.tagName?e:function(e){try{var i=document.querySelector(e);return i||r('No element was found matching the selector: "%s"',e),i}catch(i){r('"%s" is not a valid selector',e);return}}(e))?"A-CUBEMAP"===a.tagName&&a.srcs?i(a.srcs):"IMG"===a.tagName?n(a):void r('Selector "%s" does not point to <a-cubemap> or <img>',e):void 0}function o(e){var i=e.match(/url\((.+)\)/);if(i)return i[1]}function l(e,i){var n=new Image;n.addEventListener("load",function(){i(!0)}),n.addEventListener("error",function(){i(!1)}),n.src=e}e.exports={parseUrl:o,validateSrc:s,validateCubemapSrc:function(e,i){return a(e,i,function(){r("Expected cubemap but got image")})},validateEnvMapSrc:a}},"./src/utils/styleParser.js":e=>{var i,n,r=/-([a-z])/g;function s(e){return e.replace(r,o)}e.exports.parse=function(e,i){var n;return"string"!=typeof e||(n=function(e,i){var n,r,o,l,h,u;for(r=0,i=i||{},n=a(e);r<n.length;r++)(o=n[r])&&(l=o.indexOf(":"),h=o.substr(0,l).trim(),u=o.substr(l+1).trim(),i[s(h)]=u);return i}(e,i))[""]?e:n},e.exports.stringify=function(e){return"string"==typeof e?e:function(e){var i,n=0,r=0,s="";for(i in e)n++;for(i in e)s+=i+": "+e[i],r<n-1&&(s+="; "),r++;return s}(e)},e.exports.toCamelCase=s;var a=(i=[],n=/url\([^)]+$/,function(e){var r,s="",a=0;for(i.length=0;a<e.length;){if(-1===(r=e.indexOf(";",a))&&(r=e.length),s+=e.substring(a,r),n.test(s)){s+=";",a=r+1;continue}i.push(s.trim()),s="",a=r+1}return i});function o(e){return e[1].toUpperCase()}},"./src/utils/tracked-controls.js":(e,i,n)=>{var r=n("./src/constants/index.js").DEFAULT_HANDEDNESS,s=["x","y","z","w"];function a(e,i,n){var r,s,a=e.el.sceneEl,o=n.index||0;return!!i&&!!(s=a&&a.systems["tracked-controls-webvr"])&&!!(r=s.controllers).length&&!!l(r,null,i,n.hand,o)}function o(e,i,n){var r,s=e.el.sceneEl,a=s&&s.systems["tracked-controls-webxr"];return!!a&&!!(r=a.controllers)&&!!r.length&&h(r,i,n.hand,n.index,n.iterateControllerProfiles,n.handTracking)}function l(e,i,n,s,a){var o,l,h=0,u=a>=0?a:0;for(l=0;l<e.length;l++)if(o=e[l],(!n||o.id.startsWith(n))&&(n||o.id===i)&&(!s||!o.hand||s===o.hand)){if(!s||o.hand||h===(u=2*a+ +(s!==r)))return o;++h}}function h(e,i,n,r,s,a){var o,l,h,u,c=!1;for(o=0;o<e.length;o++){if(u=(h=e[o]).profiles,a)c=h.hand;else if(s)for(l=0;l<u.length&&!(c=u[l].startsWith(i));l++);else c=u.length>0&&u[0].startsWith(i);if(c){if("right"===h.handedness||"left"===h.handedness){if(h.handedness===n)return e[o]}else if(o===r)return e[o]}}}e.exports.checkControllerPresentAndSetup=function(e,i,n){var r,s,l=e.el,h=l.sceneEl.hasWebXR;if(s=!!(r=(h?o:a)(e,i,n)),!e.controllerPresent||e.controllerEventsActive||h||e.addEventListeners(),s===e.controllerPresent)return s;e.controllerPresent=s,s?(e.addEventListeners(),e.injectTrackedControls(r),l.emit("controllerconnected",{name:e.name,component:e})):(e.removeEventListeners(),l.emit("controllerdisconnected",{name:e.name,component:e}))},e.exports.isControllerPresentWebVR=a,e.exports.isControllerPresentWebXR=o,e.exports.findMatchingControllerWebVR=l,e.exports.findMatchingControllerWebXR=h,e.exports.emitIfAxesChanged=function(e,i,n){var r,a,o,l,h;for(a in i){for(h=0,r=i[a],o=!1;h<r.length;h++)n.detail.changed[r[h]]&&(o=!0);if(o){for(h=0,l={};h<r.length;h++)l[s[h]]=n.detail.axis[r[h]];e.el.emit(a+"moved",l)}}},e.exports.onButtonEvent=function(e,i,n,r){var s=(r?n.mapping[r]:n.mapping).buttons[e];n.el.emit(s+i),n.updateModel&&n.updateModel(s,i)}},"./vendor/DeviceOrientationControls.js":()=>{THREE.DeviceOrientationControls=function(e){var i,n,r,s,a=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var o=function(e){a.deviceOrientation=e},l=function(){a.screenOrientation=window.orientation||0},h=(i=new THREE.Vector3(0,0,1),n=new THREE.Euler,r=new THREE.Quaternion,s=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,a,o,l,h){n.set(o,a,-l,"YXZ"),e.setFromEuler(n),e.multiply(s),e.multiply(r.setFromAxisAngle(i,-h))});this.connect=function(){l(),window.addEventListener("orientationchange",l,!1),window.addEventListener("deviceorientation",o,!1),a.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",l,!1),window.removeEventListener("deviceorientation",o,!1),a.enabled=!1},this.update=function(){if(!1!==a.enabled){var e=a.deviceOrientation;if(e){var i=e.alpha?THREE.MathUtils.degToRad(e.alpha)+a.alphaOffset:0,n=e.beta?THREE.MathUtils.degToRad(e.beta):0,r=e.gamma?THREE.MathUtils.degToRad(e.gamma):0,s=a.screenOrientation?THREE.MathUtils.degToRad(a.screenOrientation):0;h(a.object.quaternion,i,n,r,s)}}},this.dispose=function(){a.disconnect()},this.connect()}},"./vendor/rStats.extras.js":e=>{window.glStats=function(){var e=null,i=0,n=0,r=0,s=0,a=0,o=0,l=0;function h(e,i){return function(){i.apply(this,arguments),e.apply(this,arguments)}}return WebGLRenderingContext.prototype.drawArrays=h(WebGLRenderingContext.prototype.drawArrays,function(){i++,arguments[0]==this.POINTS?o+=arguments[2]:a+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=h(WebGLRenderingContext.prototype.drawElements,function(){n++,s+=arguments[1]/3,a+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=h(WebGLRenderingContext.prototype.useProgram,function(){r++}),WebGLRenderingContext.prototype.bindTexture=h(WebGLRenderingContext.prototype.bindTexture,function(){l++}),{update:function(){e("allcalls").set(i+n),e("drawElements").set(n),e("drawArrays").set(i),e("bindTexture").set(l),e("useProgram").set(r),e("glfaces").set(s),e("glvertices").set(a),e("glpoints").set(o)},start:function(){i=0,n=0,r=0,s=0,a=0,o=0,l=0},end:function(){},attach:function(i){e=i},values:{allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},groups:[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],fractions:[{base:"allcalls",steps:["drawelements","drawarrays"]}]}},window.threeStats=function(e){var i=null;return{update:function(){i("renderer.info.memory.geometries").set(e.info.memory.geometries),i("renderer.info.programs").set(e.info.programs.length),i("renderer.info.memory.textures").set(e.info.memory.textures),i("renderer.info.render.calls").set(e.info.render.calls),i("renderer.info.render.triangles").set(e.info.render.triangles),i("renderer.info.render.points").set(e.info.render.points)},start:function(){},end:function(){},attach:function(e){i=e},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],fractions:[]}},window.BrowserStats=function(){var e=null,i=0,n=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),0===performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var r=Math.log(1024);function s(e){var i=Math.floor(Math.log(e)/r);return Math.round(100*e/Math.pow(1024,i))/100}return{update:function(){i=s(performance.memory.usedJSHeapSize),n=s(performance.memory.totalJSHeapSize),e("memory").set(i),e("total").set(n)},start:function(){i=0},end:function(){},attach:function(i){e=i},values:{memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},groups:[{caption:"Browser",values:["memory","total"]}],fractions:[{base:"total",steps:["memory"]}]}},e.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}},"./vendor/rStats.js":e=>{"use strict";(function(){"performance"in window==!1&&(window.performance={});var e=window.performance;if("now"in e==!1){var i=Date.now();e.timing&&e.timing.navigationStart&&(i=e.timing.navigationStart),e.now=function(){return Date.now()-i}}e.mark||(e.mark=function(){}),e.measure||(e.measure=function(){})})(),window.rStats=function(e){function i(e,i){for(var n=Object.keys(e),r=0,s=n.length;r<s;r++)i(n[r])}var n,r,s=e||{},a=s.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],o=(s.CSSPath?s.CSSPath:"")+"rStats.css";(s.css||["https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",o]).forEach(function(e){var i;(i=document.createElement("link")).href=e,i.rel="stylesheet",i.type="text/css",document.getElementsByTagName("head")[0].appendChild(i)}),s.values||(s.values={});var l={};function h(e,i,n){var r=n||{},s=document.createElement("canvas"),a=s.getContext("2d"),o=0,l=0,h=r.color?r.color:"#666666",u=document.createElement("canvas"),c=u.getContext("2d");u.width=1,u.height=20,c.fillStyle="#444444",c.fillRect(0,0,1,20),c.fillStyle=h,c.fillRect(0,10,1,10),c.fillStyle="#ffffff",c.globalAlpha=.5,c.fillRect(0,10,1,1),c.globalAlpha=1;var d=document.createElement("canvas"),p=d.getContext("2d");return d.width=1,d.height=20,p.fillStyle="#444444",p.fillRect(0,0,1,20),p.fillStyle="#b70000",p.fillRect(0,10,1,10),p.globalAlpha=.5,p.fillStyle="#ffffff",p.fillRect(0,10,1,1),p.globalAlpha=1,s.width=200,s.height=10,s.style.width=s.width+"px",s.style.height=s.height+"px",s.className="rs-canvas",e.appendChild(s),a.fillStyle="#444444",a.fillRect(0,0,s.width,s.height),{draw:function(e,i){l+=(e-l)*.1,o*=.99,l>o&&(o=l),a.drawImage(s,1,0,s.width-1,s.height,0,0,s.width-1,s.height),i?a.drawImage(d,s.width-1,s.height-l*s.height/o-10):a.drawImage(u,s.width-1,s.height-l*s.height/o-10)}}}function u(e,n){var r=document.createElement("canvas"),s=r.getContext("2d");return r.width=200,r.height=10*n,r.style.width=r.width+"px",r.style.height=r.height+"px",r.className="rs-canvas",e.appendChild(r),s.fillStyle="#444444",s.fillRect(0,0,r.width,r.height),{draw:function(e){s.drawImage(r,1,0,r.width-1,r.height,0,0,r.width-1,r.height);var n=0;i(e,function(i){var o=e[i]*r.height;s.fillStyle=a[i],s.fillRect(r.width-1,n,1,o),n+=o})}}}function c(e,i){var n,a=0,o=0,l=0,u=0,c=performance.now(),d=0,p=document.createElement("div"),f=document.createElement("span"),m=document.createElement("div"),g=document.createTextNode(""),A=s?s.values[e.toLowerCase()]:null,v=new h(p,e,A),y=!1;function x(e){if(A&&A.average){u+=e,d++;var i=performance.now();i-c>=(A.avgMs||1e3)&&(l=u/d,u=0,c=i,d=0)}}function _(){n=performance.now(),s.userTimingAPI&&performance.mark(e+"-start"),y=!0}function b(){a=performance.now()-n,s.userTimingAPI&&(performance.mark(e+"-end"),y&&performance.measure(e,e+"-start",e+"-end")),x(a)}return f.className="rs-counter-id",f.textContent=A&&A.caption?A.caption:e,m.className="rs-counter-value",m.appendChild(g),p.appendChild(f),p.appendChild(m),i?i.div.appendChild(p):r.appendChild(p),n=performance.now(),{set:function(e){x(a=e)},start:_,tick:function(){b(),_()},end:b,frame:function(){var e=performance.now(),i=e-n;o++,i>1e3&&(a=A&&!1===A.interpolate?o:1e3*o/i,o=0,n=e,x(a))},value:function(){return a},draw:function(){var e=A&&A.average?l:a;g.nodeValue=Math.round(100*e)/100;var i=A&&(A.below&&a<A.below||A.over&&a>A.over);v.draw(a,i),p.className=i?"rs-counter-base alarm":"rs-counter-base"}}}function d(e){var n=e.toLowerCase();if(void 0===n&&(n="default"),l[n])return l[n];var r=null;s&&s.groups&&i(s.groups,function(e){var i=s.groups[parseInt(e,10)];r||-1===i.values.indexOf(n.toLowerCase())||(r=i)});var a=new c(n,r);return l[n]=a,a}function p(){i(s.plugins,function(e){s.plugins[e].update()}),i(l,function(e){l[e].draw()}),s&&s.fractions&&i(s.fractions,function(e){var n=s.fractions[parseInt(e,10)],r=[],a=l[n.base.toLowerCase()];a&&(a=a.value(),i(s.fractions[e].steps,function(i){var n=l[s.fractions[e].steps[parseInt(i,10)].toLowerCase()];n&&r.push(n.value()/a)})),n.graph.draw(r)})}return function(){if(s.plugins){s.values||(s.values={}),s.groups||(s.groups=[]),s.fractions||(s.fractions=[]);for(var e=0;e<s.plugins.length;e++)s.plugins[e].attach(d),i(s.plugins[e].values,function(i){s.values[i]=s.plugins[e].values[i]}),s.groups=s.groups.concat(s.plugins[e].groups),s.fractions=s.fractions.concat(s.plugins[e].fractions)}else s.plugins={};(n=document.createElement("div")).className="rs-base",(r=document.createElement("div")).className="rs-container",r.style.height="auto",n.appendChild(r),document.body.appendChild(n),s&&(s.groups&&i(s.groups,function(e){var i=s.groups[parseInt(e,10)],n=document.createElement("div");n.className="rs-group",i.div=n;var a=document.createElement("h1");a.textContent=i.caption,a.addEventListener("click",(function(e){this.classList.toggle("hidden"),e.preventDefault()}).bind(n)),r.appendChild(a),r.appendChild(n)}),s.fractions&&i(s.fractions,function(e){var n=s.fractions[parseInt(e,10)],o=document.createElement("div");o.className="rs-fraction";var l=document.createElement("div");l.className="rs-legend";var h=0;i(s.fractions[e].steps,function(i){var n=document.createElement("p");n.textContent=s.fractions[e].steps[i],n.style.color=a[h],l.appendChild(n),h++}),o.appendChild(l),o.style.height=10*h+"px",n.div=o;var c=new u(o,h);n.graph=c,r.appendChild(o)}))}(),function(e){return e?d(e):{element:n,update:p}}},e.exports=window.rStats},"./vendor/wakelock/util.js":e=>{var i={};i.base64=function(e,i){return"data:"+e+";base64,"+i},i.isMobile=function(){var e,i=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(i=!0),i},i.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},i.isIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},i.appendQueryParameter=function(e,i,n){var r=0>e.indexOf("?")?"?":"&";return e+(r+i+"="+n)},i.getQueryParameter=function(e){var i=RegExp("[\\?&]"+(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"))+"=([^&#]*)").exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},i.isLandscapeMode=function(){return 90==window.orientation||-90==window.orientation},e.exports=i},"./vendor/wakelock/wakelock.js":(e,i,n)=>{var r,s=n("./vendor/wakelock/util.js");e.exports=(r=navigator.userAgent||navigator.vendor||window.opera).match(/iPhone/i)||r.match(/iPod/i)?function(){var e=null;this.request=function(){e||(e=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){e&&(clearInterval(e),e=null)}}:function(){var e=document.createElement("video");e.addEventListener("ended",function(){e.play()}),this.request=function(){e.paused&&(e.src=s.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),e.play())},this.release=function(){e.pause(),e.src=""}}},"./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css":(e,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>_});var r=n("./node_modules/css-loader/dist/runtime/sourceMaps.js"),s=n.n(r),a=n("./node_modules/css-loader/dist/runtime/api.js"),o=n.n(a),l=n("./node_modules/css-loader/dist/runtime/getUrl.js"),h=n.n(l),u=new URL(n("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),n.b),c=new URL(n("data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"),n.b),d=new URL(n("data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"),n.b),p=new URL(n("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"),n.b),f=new URL(n("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"),n.b),m=o()(s()),g=h()(u),A=h()(c),v=h()(d),y=h()(p),x=h()(f);m.push([e.id,"/* .a-fullscreen means not embedded. */\nhtml.a-fullscreen {\n  bottom: 0;\n  left: 0;\n  position: fixed;\n  right: 0;\n  top: 0;\n}\n\nhtml.a-fullscreen body {\n  height: 100%;\n  margin: 0;\n  overflow: hidden;\n  padding: 0;\n  width: 100%;\n}\n\n/* Class is removed when doing <a-scene embedded>. */\nhtml.a-fullscreen .a-canvas {\n  width: 100% !important;\n  height: 100% !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  bottom: 0 !important;\n  position: fixed !important;\n}\n\nhtml:not(.a-fullscreen) .a-enter-vr,\nhtml:not(.a-fullscreen) .a-enter-ar {\n  right: 5px;\n  bottom: 5px;\n}\n\nhtml:not(.a-fullscreen) .a-enter-ar {\n  right: 60px;\n}\n\n/* In chrome mobile the user agent stylesheet set it to white  */\n:-webkit-full-screen {\n  background-color: transparent;\n}\n\n.a-hidden {\n  display: none !important;\n}\n\n.a-canvas {\n  height: 100%;\n  left: 0;\n  position: absolute;\n  top: 0;\n  width: 100%;\n}\n\n.a-canvas.a-grab-cursor:hover {\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\ncanvas.a-canvas.a-mouse-cursor-hover:hover {\n  cursor: pointer;\n}\n\n.a-inspector-loader {\n  background-color: #ed3160;\n  position: fixed;\n  left: 3px;\n  top: 3px;\n  padding: 6px 10px;\n  color: #fff;\n  text-decoration: none;\n  font-size: 12px;\n  font-family: Roboto,sans-serif;\n  text-align: center;\n  z-index: 99999;\n  width: 204px;\n}\n\n/* Inspector loader animation */\n@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }\n@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }\n@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }\n@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }\n@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }\n@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }\n\n.a-inspector-loader .dots span {\n  animation: dots-1 2s infinite steps(1);\n  -webkit-animation: dots-1 2s infinite steps(1);\n}\n\n.a-inspector-loader .dots span:first-child + span {\n  animation-name: dots-2;\n  -webkit-animation-name: dots-2;\n}\n\n.a-inspector-loader .dots span:first-child + span + span {\n  animation-name: dots-3;\n  -webkit-animation-name: dots-3;\n}\n\na-scene {\n  display: block;\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n\na-assets,\na-scene video,\na-scene img,\na-scene audio {\n  display: none;\n}\n\n.a-enter-vr-modal,\n.a-orientation-modal {\n  font-family: Consolas, Andale Mono, Courier New, monospace;\n}\n\n.a-enter-vr-modal a {\n  border-bottom: 1px solid #fff;\n  padding: 2px 0;\n  text-decoration: none;\n  transition: .1s color ease-in;\n}\n\n.a-enter-vr-modal a:hover {\n  background-color: #fff;\n  color: #111;\n  padding: 2px 4px;\n  position: relative;\n  left: -4px;\n}\n\n.a-enter-vr,\n.a-enter-ar {\n  font-family: sans-serif, monospace;\n  font-size: 13px;\n  width: 100%;\n  font-weight: 200;\n  line-height: 16px;\n  position: absolute;\n  right: 20px;\n  bottom: 20px;\n}\n\n.a-enter-ar.xr {\n  right: 90px;\n}\n\n.a-enter-vr-button,\n.a-enter-vr-modal,\n.a-enter-vr-modal a {\n  color: #fff;\n  user-select: none;\n  outline: none;\n}\n\n.a-enter-vr-button {\n  background: rgba(0, 0, 0, 0.35) url("+g+") 50% 50% no-repeat;\n}\n\n.a-enter-ar-button {\n  background: rgba(0, 0, 0, 0.20) url("+A+") 50% 50% no-repeat;\n}\n\n.a-enter-vr.fullscreen .a-enter-vr-button {\n  background-image: url("+v+");\n}\n\n.a-enter-vr-button,\n.a-enter-ar-button {\n  background-size: 90% 90%;\n  border: 0;\n  bottom: 0;\n  cursor: pointer;\n  min-width: 58px;\n  min-height: 34px;\n  /* 1.74418604651 */\n  /*\n    In order to keep the aspect ratio when resizing\n    padding-top percentages are relative to the containing block's width.\n    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio\n  */\n  padding-right: 0;\n  padding-top: 0;\n  position: absolute;\n  right: 0;\n  transition: background-color .05s ease;\n  -webkit-transition: background-color .05s ease;\n  z-index: 9999;\n  border-radius: 8px;\n  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */\n}\n\n.a-enter-ar-button {\n  background-size: 100% 90%;\n  border-radius: 7px;\n}\n\n.a-enter-ar-button:active,\n.a-enter-ar-button:hover,\n.a-enter-vr-button:active,\n.a-enter-vr-button:hover {\n  background-color: #ef2d5e;\n}\n\n.a-enter-vr-button.resethover {\n  background-color: rgba(0, 0, 0, 0.35);\n}\n\n.a-enter-vr-modal {\n  background-color: #666;\n  border-radius: 0;\n  display: none;\n  min-height: 32px;\n  margin-right: 70px;\n  padding: 9px;\n  width: 280px;\n  right: 2%;\n  position: absolute;\n}\n\n.a-enter-vr-modal:after {\n  border-bottom: 10px solid transparent;\n  border-left: 10px solid #666;\n  border-top: 10px solid transparent;\n  display: inline-block;\n  content: '';\n  position: absolute;\n  right: -5px;\n  top: 5px;\n  width: 0;\n  height: 0;\n}\n\n.a-enter-vr-modal p,\n.a-enter-vr-modal a {\n  display: inline;\n}\n\n.a-enter-vr-modal p {\n  margin: 0;\n}\n\n.a-enter-vr-modal p:after {\n  content: ' ';\n}\n\n.a-orientation-modal {\n  background: rgba(244, 244, 244, 1) url("+y+') center no-repeat;\n  background-size: 50% 50%;\n  bottom: 0;\n  font-size: 14px;\n  font-weight: 600;\n  left: 0;\n  line-height: 20px;\n  right: 0;\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n}\n\n.a-orientation-modal:after {\n  color: #666;\n  content: "Insert phone into Cardboard holder.";\n  display: block;\n  position: absolute;\n  text-align: center;\n  top: 70%;\n  transform: translateY(-70%);\n  width: 100%;\n}\n\n.a-orientation-modal button {\n  background: url('+x+") no-repeat;\n  border: none;\n  height: 50px;\n  text-indent: -9999px;\n  width: 50px;\n}\n\n.a-loader-title {\n  background-color: rgba(0, 0, 0, 0.6);\n  font-family: sans-serif, monospace;\n  text-align: center;\n  font-size: 20px;\n  height: 50px;\n  font-weight: 300;\n  line-height: 50px;\n  position: absolute;\n  right: 0px;\n  left: 0px;\n  top: 0px;\n  color: white;\n}\n\n.a-modal {\n  position: absolute;\n  background: rgba(0, 0, 0, 0.60);\n  background-size: 50% 50%;\n  bottom: 0;\n  font-size: 14px;\n  font-weight: 600;\n  left: 0;\n  line-height: 20px;\n  right: 0;\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n}\n\n.a-dialog {\n  position: relative;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 199995;\n  width: 300px;\n  height: 200px;\n  background-size: contain;\n  background-color: white;\n  font-family: sans-serif, monospace;\n  font-size: 20px;\n  border-radius: 3px;\n  padding: 6px;\n}\n\n.a-dialog-text-container {\n  width: 100%;\n  height: 70%;\n  align-self: flex-start;\n  display: flex;\n  justify-content: center;\n  align-content: center;\n  flex-direction: column;\n}\n\n.a-dialog-text {\n  display: inline-block;\n  font-weight: normal;\n  font-size: 14pt;\n  margin: 8px;\n}\n\n.a-dialog-buttons-container {\n  display: inline-flex;\n  align-self: flex-end;\n  width: 100%;\n  height: 30%;\n}\n\n.a-dialog-button {\n  cursor: pointer;\n  align-self: center;\n  opacity: 0.9;\n  height: 80%;\n  width: 50%;\n  font-size: 12pt;\n  margin: 4px;\n  border-radius: 2px;\n  text-align:center;\n  border: none;\n  display: inline-block;\n  -webkit-transition: all 0.25s ease-in-out;\n  transition: all 0.25s ease-in-out;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);\n  user-select: none;\n}\n\n.a-dialog-permission-button:hover {\n  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);\n}\n\n.a-dialog-allow-button {\n  background-color: #00ceff;\n}\n\n.a-dialog-deny-button {\n  background-color: #ff005b;\n}\n\n.a-dialog-ok-button {\n  background-color: #00ceff;\n  width: 100%;\n}\n\n.a-dom-overlay:not(.a-no-style) {\n  overflow: hidden;\n  position: absolute;\n  pointer-events: none;\n  box-sizing: border-box;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  top: 0;\n  padding: 1em;\n}\n\n.a-dom-overlay:not(.a-no-style)>* {\n  pointer-events: auto;\n}\n","",{version:3,sources:["webpack://./src/style/aframe.css"],names:[],mappings:"AAAA,sCAAsC;AACtC;EACE,SAAS;EACT,OAAO;EACP,eAAe;EACf,QAAQ;EACR,MAAM;AACR;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,UAAU;EACV,WAAW;AACb;;AAEA,oDAAoD;AACpD;EACE,sBAAsB;EACtB,uBAAuB;EACvB,iBAAiB;EACjB,kBAAkB;EAClB,mBAAmB;EACnB,oBAAoB;EACpB,0BAA0B;AAC5B;;AAEA;;EAEE,UAAU;EACV,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA,gEAAgE;AAChE;EACE,6BAA6B;AAC/B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,yBAAyB;EACzB,eAAe;EACf,SAAS;EACT,QAAQ;EACR,iBAAiB;EACjB,WAAW;EACX,qBAAqB;EACrB,eAAe;EACf,8BAA8B;EAC9B,kBAAkB;EAClB,cAAc;EACd,YAAY;AACd;;AAEA,+BAA+B;AAC/B,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;;AAErE;EACE,sCAAsC;EACtC,8CAA8C;AAChD;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,WAAW;AACb;;AAEA;;;;EAIE,aAAa;AACf;;AAEA;;EAEE,0DAA0D;AAC5D;;AAEA;EACE,6BAA6B;EAC7B,cAAc;EACd,qBAAqB;EACrB,6BAA6B;AAC/B;;AAEA;EACE,sBAAsB;EACtB,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,UAAU;AACZ;;AAEA;;EAEE,kCAAkC;EAClC,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,WAAW;EACX,YAAY;AACd;;AAEA;EACE,WAAW;AACb;;AAEA;;;EAGE,WAAW;EACX,iBAAiB;EACjB,aAAa;AACf;;AAEA;EACE,yFAA4qB;AAC9qB;;AAEA;EACE,yFAAkzB;AACpzB;;AAEA;EACE,yDAA2qK;AAC7qK;;AAEA;;EAEE,wBAAwB;EACxB,SAAS;EACT,SAAS;EACT,eAAe;EACf,eAAe;EACf,gBAAgB;EAChB,kBAAkB;EAClB;;;;GAIC;EACD,gBAAgB;EAChB,cAAc;EACd,kBAAkB;EAClB,QAAQ;EACR,sCAAsC;EACtC,8CAA8C;EAC9C,aAAa;EACb,kBAAkB;EAClB,0BAA0B,EAAE,8CAA8C;AAC5E;;AAEA;EACE,yBAAyB;EACzB,kBAAkB;AACpB;;AAEA;;;;EAIE,yBAAyB;AAC3B;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,qCAAqC;EACrC,4BAA4B;EAC5B,kCAAkC;EAClC,qBAAqB;EACrB,WAAW;EACX,kBAAkB;EAClB,WAAW;EACX,QAAQ;EACR,QAAQ;EACR,SAAS;AACX;;AAEA;;EAEE,eAAe;AACjB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,2FAAivF;EACjvF,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,WAAW;EACX,8CAA8C;EAC9C,cAAc;EACd,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,2BAA2B;EAC3B,WAAW;AACb;;AAEA;EACE,6DAA25B;EAC35B,YAAY;EACZ,YAAY;EACZ,oBAAoB;EACpB,WAAW;AACb;;AAEA;EACE,oCAAoC;EACpC,kCAAkC;EAClC,kBAAkB;EAClB,eAAe;EACf,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,UAAU;EACV,SAAS;EACT,QAAQ;EACR,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,+BAA+B;EAC/B,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,QAAQ;EACR,gCAAgC;EAChC,eAAe;EACf,YAAY;EACZ,aAAa;EACb,wBAAwB;EACxB,uBAAuB;EACvB,kCAAkC;EAClC,eAAe;EACf,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,WAAW;EACX,sBAAsB;EACtB,aAAa;EACb,uBAAuB;EACvB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,qBAAqB;EACrB,mBAAmB;EACnB,eAAe;EACf,WAAW;AACb;;AAEA;EACE,oBAAoB;EACpB,oBAAoB;EACpB,WAAW;EACX,WAAW;AACb;;AAEA;EACE,eAAe;EACf,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,UAAU;EACV,eAAe;EACf,WAAW;EACX,kBAAkB;EAClB,iBAAiB;EACjB,YAAY;EACZ,qBAAqB;EACrB,yCAAyC;EACzC,iCAAiC;EACjC,wEAAwE;EACxE,iBAAiB;AACnB;;AAEA;EACE,mEAAmE;AACrE;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;EACtB,SAAS;EACT,OAAO;EACP,QAAQ;EACR,MAAM;EACN,YAAY;AACd;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:["/* .a-fullscreen means not embedded. */\nhtml.a-fullscreen {\n  bottom: 0;\n  left: 0;\n  position: fixed;\n  right: 0;\n  top: 0;\n}\n\nhtml.a-fullscreen body {\n  height: 100%;\n  margin: 0;\n  overflow: hidden;\n  padding: 0;\n  width: 100%;\n}\n\n/* Class is removed when doing <a-scene embedded>. */\nhtml.a-fullscreen .a-canvas {\n  width: 100% !important;\n  height: 100% !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  bottom: 0 !important;\n  position: fixed !important;\n}\n\nhtml:not(.a-fullscreen) .a-enter-vr,\nhtml:not(.a-fullscreen) .a-enter-ar {\n  right: 5px;\n  bottom: 5px;\n}\n\nhtml:not(.a-fullscreen) .a-enter-ar {\n  right: 60px;\n}\n\n/* In chrome mobile the user agent stylesheet set it to white  */\n:-webkit-full-screen {\n  background-color: transparent;\n}\n\n.a-hidden {\n  display: none !important;\n}\n\n.a-canvas {\n  height: 100%;\n  left: 0;\n  position: absolute;\n  top: 0;\n  width: 100%;\n}\n\n.a-canvas.a-grab-cursor:hover {\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\ncanvas.a-canvas.a-mouse-cursor-hover:hover {\n  cursor: pointer;\n}\n\n.a-inspector-loader {\n  background-color: #ed3160;\n  position: fixed;\n  left: 3px;\n  top: 3px;\n  padding: 6px 10px;\n  color: #fff;\n  text-decoration: none;\n  font-size: 12px;\n  font-family: Roboto,sans-serif;\n  text-align: center;\n  z-index: 99999;\n  width: 204px;\n}\n\n/* Inspector loader animation */\n@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }\n@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }\n@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }\n@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }\n@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }\n@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }\n\n.a-inspector-loader .dots span {\n  animation: dots-1 2s infinite steps(1);\n  -webkit-animation: dots-1 2s infinite steps(1);\n}\n\n.a-inspector-loader .dots span:first-child + span {\n  animation-name: dots-2;\n  -webkit-animation-name: dots-2;\n}\n\n.a-inspector-loader .dots span:first-child + span + span {\n  animation-name: dots-3;\n  -webkit-animation-name: dots-3;\n}\n\na-scene {\n  display: block;\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n\na-assets,\na-scene video,\na-scene img,\na-scene audio {\n  display: none;\n}\n\n.a-enter-vr-modal,\n.a-orientation-modal {\n  font-family: Consolas, Andale Mono, Courier New, monospace;\n}\n\n.a-enter-vr-modal a {\n  border-bottom: 1px solid #fff;\n  padding: 2px 0;\n  text-decoration: none;\n  transition: .1s color ease-in;\n}\n\n.a-enter-vr-modal a:hover {\n  background-color: #fff;\n  color: #111;\n  padding: 2px 4px;\n  position: relative;\n  left: -4px;\n}\n\n.a-enter-vr,\n.a-enter-ar {\n  font-family: sans-serif, monospace;\n  font-size: 13px;\n  width: 100%;\n  font-weight: 200;\n  line-height: 16px;\n  position: absolute;\n  right: 20px;\n  bottom: 20px;\n}\n\n.a-enter-ar.xr {\n  right: 90px;\n}\n\n.a-enter-vr-button,\n.a-enter-vr-modal,\n.a-enter-vr-modal a {\n  color: #fff;\n  user-select: none;\n  outline: none;\n}\n\n.a-enter-vr-button {\n  background: rgba(0, 0, 0, 0.35) url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat;\n}\n\n.a-enter-ar-button {\n  background: rgba(0, 0, 0, 0.20) url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat;\n}\n\n.a-enter-vr.fullscreen .a-enter-vr-button {\n  background-image: url(\"data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3Csvg width='108' height='62' viewBox='0 0 108 62' version='1.1' id='svg320' sodipodi:docname='fullscreen-aframe.svg' xml:space='preserve' inkscape:version='1.2.1 (9c6d41e  2022-07-14)' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/'%3E%3Cdefs id='defs324' /%3E%3Csodipodi:namedview id='namedview322' pagecolor='%23ffffff' bordercolor='%23000000' borderopacity='0.25' inkscape:showpageshadow='2' inkscape:pageopacity='0.0' inkscape:pagecheckerboard='0' inkscape:deskcolor='%23d1d1d1' showgrid='false' inkscape:zoom='3.8064516' inkscape:cx='91.423729' inkscape:cy='-1.4449153' inkscape:window-width='1440' inkscape:window-height='847' inkscape:window-x='32' inkscape:window-y='25' inkscape:window-maximized='0' inkscape:current-layer='svg320' /%3E%3Ctitle id='title312'%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z' fill='%23fff' id='path314' style='fill:%23ffffff' /%3E%3Cg id='g356' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g358' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g360' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g362' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g364' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g366' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g368' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g370' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g372' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g374' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g376' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g378' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g380' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g382' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g384' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cmetadata id='metadata561'%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d='m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4' id='path596' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4' id='path598' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4' id='path600' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616' id='path602' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3C/svg%3E\");\n}\n\n.a-enter-vr-button,\n.a-enter-ar-button {\n  background-size: 90% 90%;\n  border: 0;\n  bottom: 0;\n  cursor: pointer;\n  min-width: 58px;\n  min-height: 34px;\n  /* 1.74418604651 */\n  /*\n    In order to keep the aspect ratio when resizing\n    padding-top percentages are relative to the containing block's width.\n    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio\n  */\n  padding-right: 0;\n  padding-top: 0;\n  position: absolute;\n  right: 0;\n  transition: background-color .05s ease;\n  -webkit-transition: background-color .05s ease;\n  z-index: 9999;\n  border-radius: 8px;\n  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */\n}\n\n.a-enter-ar-button {\n  background-size: 100% 90%;\n  border-radius: 7px;\n}\n\n.a-enter-ar-button:active,\n.a-enter-ar-button:hover,\n.a-enter-vr-button:active,\n.a-enter-vr-button:hover {\n  background-color: #ef2d5e;\n}\n\n.a-enter-vr-button.resethover {\n  background-color: rgba(0, 0, 0, 0.35);\n}\n\n.a-enter-vr-modal {\n  background-color: #666;\n  border-radius: 0;\n  display: none;\n  min-height: 32px;\n  margin-right: 70px;\n  padding: 9px;\n  width: 280px;\n  right: 2%;\n  position: absolute;\n}\n\n.a-enter-vr-modal:after {\n  border-bottom: 10px solid transparent;\n  border-left: 10px solid #666;\n  border-top: 10px solid transparent;\n  display: inline-block;\n  content: '';\n  position: absolute;\n  right: -5px;\n  top: 5px;\n  width: 0;\n  height: 0;\n}\n\n.a-enter-vr-modal p,\n.a-enter-vr-modal a {\n  display: inline;\n}\n\n.a-enter-vr-modal p {\n  margin: 0;\n}\n\n.a-enter-vr-modal p:after {\n  content: ' ';\n}\n\n.a-orientation-modal {\n  background: rgba(244, 244, 244, 1) url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center no-repeat;\n  background-size: 50% 50%;\n  bottom: 0;\n  font-size: 14px;\n  font-weight: 600;\n  left: 0;\n  line-height: 20px;\n  right: 0;\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n}\n\n.a-orientation-modal:after {\n  color: #666;\n  content: \"Insert phone into Cardboard holder.\";\n  display: block;\n  position: absolute;\n  text-align: center;\n  top: 70%;\n  transform: translateY(-70%);\n  width: 100%;\n}\n\n.a-orientation-modal button {\n  background: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;\n  border: none;\n  height: 50px;\n  text-indent: -9999px;\n  width: 50px;\n}\n\n.a-loader-title {\n  background-color: rgba(0, 0, 0, 0.6);\n  font-family: sans-serif, monospace;\n  text-align: center;\n  font-size: 20px;\n  height: 50px;\n  font-weight: 300;\n  line-height: 50px;\n  position: absolute;\n  right: 0px;\n  left: 0px;\n  top: 0px;\n  color: white;\n}\n\n.a-modal {\n  position: absolute;\n  background: rgba(0, 0, 0, 0.60);\n  background-size: 50% 50%;\n  bottom: 0;\n  font-size: 14px;\n  font-weight: 600;\n  left: 0;\n  line-height: 20px;\n  right: 0;\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n}\n\n.a-dialog {\n  position: relative;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 199995;\n  width: 300px;\n  height: 200px;\n  background-size: contain;\n  background-color: white;\n  font-family: sans-serif, monospace;\n  font-size: 20px;\n  border-radius: 3px;\n  padding: 6px;\n}\n\n.a-dialog-text-container {\n  width: 100%;\n  height: 70%;\n  align-self: flex-start;\n  display: flex;\n  justify-content: center;\n  align-content: center;\n  flex-direction: column;\n}\n\n.a-dialog-text {\n  display: inline-block;\n  font-weight: normal;\n  font-size: 14pt;\n  margin: 8px;\n}\n\n.a-dialog-buttons-container {\n  display: inline-flex;\n  align-self: flex-end;\n  width: 100%;\n  height: 30%;\n}\n\n.a-dialog-button {\n  cursor: pointer;\n  align-self: center;\n  opacity: 0.9;\n  height: 80%;\n  width: 50%;\n  font-size: 12pt;\n  margin: 4px;\n  border-radius: 2px;\n  text-align:center;\n  border: none;\n  display: inline-block;\n  -webkit-transition: all 0.25s ease-in-out;\n  transition: all 0.25s ease-in-out;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);\n  user-select: none;\n}\n\n.a-dialog-permission-button:hover {\n  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);\n}\n\n.a-dialog-allow-button {\n  background-color: #00ceff;\n}\n\n.a-dialog-deny-button {\n  background-color: #ff005b;\n}\n\n.a-dialog-ok-button {\n  background-color: #00ceff;\n  width: 100%;\n}\n\n.a-dom-overlay:not(.a-no-style) {\n  overflow: hidden;\n  position: absolute;\n  pointer-events: none;\n  box-sizing: border-box;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  top: 0;\n  padding: 1em;\n}\n\n.a-dom-overlay:not(.a-no-style)>* {\n  pointer-events: auto;\n}\n"],sourceRoot:""}]);let _=m},"./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css":(e,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>l});var r=n("./node_modules/css-loader/dist/runtime/sourceMaps.js"),s=n.n(r),a=n("./node_modules/css-loader/dist/runtime/api.js"),o=n.n(a)()(s());o.push([e.id,".rs-base {\n  background-color: #333;\n  color: #fafafa;\n  border-radius: 0;\n  font: 10px monospace;\n  left: 5px;\n  line-height: 1em;\n  opacity: 0.85;\n  overflow: hidden;\n  padding: 10px;\n  position: fixed;\n  top: 5px;\n  width: 300px;\n  z-index: 10000;\n}\n\n.rs-base div.hidden {\n  display: none;\n}\n\n.rs-base h1 {\n  color: #fff;\n  cursor: pointer;\n  font-size: 1.4em;\n  font-weight: 300;\n  margin: 0 0 5px;\n  padding: 0;\n}\n\n.rs-group {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column-reverse;\n  flex-direction: column-reverse;\n  margin-bottom: 5px;\n}\n\n.rs-group:last-child {\n  margin-bottom: 0;\n}\n\n.rs-counter-base {\n  align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  height: 10px;\n  -webkit-justify-content: space-between;\n  justify-content: space-between;\n  margin: 2px 0;\n}\n\n.rs-counter-base.alarm {\n  color: #b70000;\n  text-shadow: 0 0 0 #b70000,\n               0 0 1px #fff,\n               0 0 1px #fff,\n               0 0 2px #fff,\n               0 0 2px #fff,\n               0 0 3px #fff,\n               0 0 3px #fff,\n               0 0 4px #fff,\n               0 0 4px #fff;\n}\n\n.rs-counter-id {\n  font-weight: 300;\n  -webkit-box-ordinal-group: 0;\n  -webkit-order: 0;\n  order: 0;\n  width: 54px;\n}\n\n.rs-counter-value {\n  font-weight: 300;\n  -webkit-box-ordinal-group: 1;\n  -webkit-order: 1;\n  order: 1;\n  text-align: right;\n  width: 35px;\n}\n\n.rs-canvas {\n  -webkit-box-ordinal-group: 2;\n  -webkit-order: 2;\n  order: 2;\n}\n\n@media (min-width: 480px) {\n  .rs-base {\n    left: 20px;\n    top: 20px;\n  }\n}\n","",{version:3,sources:["webpack://./src/style/rStats.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,cAAc;EACd,gBAAgB;EAChB,oBAAoB;EACpB,SAAS;EACT,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,eAAe;EACf,QAAQ;EACR,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,WAAW;EACX,eAAe;EACf,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,UAAU;AACZ;;AAEA;EACE,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,sCAAsC;EACtC,8BAA8B;EAC9B,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,mBAAmB;EACnB,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,YAAY;EACZ,sCAAsC;EACtC,8BAA8B;EAC9B,aAAa;AACf;;AAEA;EACE,cAAc;EACd;;;;;;;;2BAQyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,iBAAiB;EACjB,WAAW;AACb;;AAEA;EACE,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;AACV;;AAEA;EACE;IACE,UAAU;IACV,SAAS;EACX;AACF",sourcesContent:[".rs-base {\n  background-color: #333;\n  color: #fafafa;\n  border-radius: 0;\n  font: 10px monospace;\n  left: 5px;\n  line-height: 1em;\n  opacity: 0.85;\n  overflow: hidden;\n  padding: 10px;\n  position: fixed;\n  top: 5px;\n  width: 300px;\n  z-index: 10000;\n}\n\n.rs-base div.hidden {\n  display: none;\n}\n\n.rs-base h1 {\n  color: #fff;\n  cursor: pointer;\n  font-size: 1.4em;\n  font-weight: 300;\n  margin: 0 0 5px;\n  padding: 0;\n}\n\n.rs-group {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column-reverse;\n  flex-direction: column-reverse;\n  margin-bottom: 5px;\n}\n\n.rs-group:last-child {\n  margin-bottom: 0;\n}\n\n.rs-counter-base {\n  align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  height: 10px;\n  -webkit-justify-content: space-between;\n  justify-content: space-between;\n  margin: 2px 0;\n}\n\n.rs-counter-base.alarm {\n  color: #b70000;\n  text-shadow: 0 0 0 #b70000,\n               0 0 1px #fff,\n               0 0 1px #fff,\n               0 0 2px #fff,\n               0 0 2px #fff,\n               0 0 3px #fff,\n               0 0 3px #fff,\n               0 0 4px #fff,\n               0 0 4px #fff;\n}\n\n.rs-counter-id {\n  font-weight: 300;\n  -webkit-box-ordinal-group: 0;\n  -webkit-order: 0;\n  order: 0;\n  width: 54px;\n}\n\n.rs-counter-value {\n  font-weight: 300;\n  -webkit-box-ordinal-group: 1;\n  -webkit-order: 1;\n  order: 1;\n  text-align: right;\n  width: 35px;\n}\n\n.rs-canvas {\n  -webkit-box-ordinal-group: 2;\n  -webkit-order: 2;\n  order: 2;\n}\n\n@media (min-width: 480px) {\n  .rs-base {\n    left: 20px;\n    top: 20px;\n  }\n}\n"],sourceRoot:""}]);let l=o},"./src/style/aframe.css":(e,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>v});var r=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),s=n.n(r),a=n("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),o=n.n(a),l=n("./node_modules/style-loader/dist/runtime/insertBySelector.js"),h=n.n(l),u=n("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),c=n.n(u),d=n("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),p=n.n(d),f=n("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),m=n.n(f),g=n("./node_modules/css-loader/dist/cjs.js!./src/style/aframe.css"),A={};A.styleTagTransform=m(),A.setAttributes=c(),A.insert=h().bind(null,"head"),A.domAPI=o(),A.insertStyleElement=p(),s()(g.default,A);let v=g.default&&g.default.locals?g.default.locals:void 0},"./src/style/rStats.css":(e,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>v});var r=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),s=n.n(r),a=n("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),o=n.n(a),l=n("./node_modules/style-loader/dist/runtime/insertBySelector.js"),h=n.n(l),u=n("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),c=n.n(u),d=n("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),p=n.n(d),f=n("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),m=n.n(f),g=n("./node_modules/css-loader/dist/cjs.js!./src/style/rStats.css"),A={};A.styleTagTransform=m(),A.setAttributes=c(),A.insert=h().bind(null,"head"),A.domAPI=o(),A.insertStyleElement=p(),s()(g.default,A);let v=g.default&&g.default.locals?g.default.locals:void 0},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":e=>{"use strict";var i=[];function n(e){for(var n=-1,r=0;r<i.length;r++)if(i[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},a=[],o=0;o<e.length;o++){var l=e[o],h=r.base?l[0]+r.base:l[0],u=s[h]||0,c="".concat(h," ").concat(u);s[h]=u+1;var d=n(c),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)i[d].references++,i[d].updater(p);else{var f=function(e,i){var n=i.domAPI(i);return n.update(e),function(i){i?(i.css!==e.css||i.media!==e.media||i.sourceMap!==e.sourceMap||i.supports!==e.supports||i.layer!==e.layer)&&n.update(e=i):n.remove()}}(p,r);r.byIndex=o,i.splice(o,0,{identifier:c,updater:f,references:1})}a.push(c)}return a}e.exports=function(e,s){var a=r(e=e||[],s=s||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var l=n(a[o]);i[l].references--}for(var h=r(e,s),u=0;u<a.length;u++){var c=n(a[u]);0===i[c].references&&(i[c].updater(),i.splice(c,1))}a=h}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":e=>{"use strict";var i={};e.exports=function(e,n){var r=function(e){if(void 0===i[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}i[e]=n}return i[e]}(e);if(!r)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":e=>{"use strict";e.exports=function(e){var i=document.createElement("style");return e.setAttributes(i,e.attributes),e.insert(i,e.options),i}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(e,i,n)=>{"use strict";e.exports=function(e){var i=n.nc;i&&e.setAttribute("nonce",i)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var i=e.insertStyleElement(e);return{update:function(n){var r,s,a;r="",n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {")),(s=void 0!==n.layer)&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,s&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}"),(a=n.sourceMap)&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(r,i,e.options)},remove:function(){!function(e){if(null!==e.parentNode)e.parentNode.removeChild(e)}(i)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":e=>{"use strict";e.exports=function(e,i){if(i.styleSheet)i.styleSheet.cssText=e;else{for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(document.createTextNode(e))}}},"data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E":e=>{"use strict";e.exports="data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E":e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E":e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"},"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E":e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"},"./node_modules/three/build/three.module.js":(e,i,n)=>{"use strict";let r,s,a,o,l;n.r(i),n.d(i,{ACESFilmicToneMapping:()=>eu,AddEquation:()=>R,AddOperation:()=>es,AdditiveAnimationBlendMode:()=>tU,AdditiveBlending:()=>M,AgXToneMapping:()=>ed,AlphaFormat:()=>eq,AlwaysCompare:()=>im,AlwaysDepth:()=>Y,AlwaysStencilFunc:()=>ia,AmbientLight:()=>cs,AnimationAction:()=>cK,AnimationClip:()=>uz,AnimationLoader:()=>uX,AnimationMixer:()=>cJ,AnimationObjectGroup:()=>cX,AnimationUtils:()=>uS,ArcCurve:()=>hu,ArrayCamera:()=>oI,ArrowHelper:()=>dB,AttachedBindMode:()=>ef,Audio:()=>cB,AudioAnalyser:()=>cU,AudioContext:()=>cv,AudioListener:()=>cI,AudioLoader:()=>cy,AxesHelper:()=>dL,BackSide:()=>_,BasicDepthPacking:()=>tG,BasicShadowMap:()=>g,BatchedMesh:()=>lH,Bone:()=>lg,BooleanKeyframeTrack:()=>uP,Box2:()=>de,Box3:()=>nc,Box3Helper:()=>dT,BoxGeometry:()=>st,BoxHelper:()=>dS,BufferAttribute:()=>rT,BufferGeometry:()=>rQ,BufferGeometryLoader:()=>cd,ByteType:()=>eO,Cache:()=>uG,Camera:()=>so,CameraHelper:()=>dw,CanvasTexture:()=>ho,CapsuleGeometry:()=>hB,CatmullRomCurve3:()=>hg,CineonToneMapping:()=>eh,CircleGeometry:()=>hL,ClampToEdgeWrapping:()=>eE,Clock:()=>cw,Color:()=>rA,ColorKeyframeTrack:()=>uD,ColorManagement:()=>i1,CompressedArrayTexture:()=>hs,CompressedCubeTexture:()=>ha,CompressedTexture:()=>hr,CompressedTextureLoader:()=>uK,ConeGeometry:()=>hD,ConstantAlphaFactor:()=>q,ConstantColorFactor:()=>Q,CubeCamera:()=>sd,CubeReflectionMapping:()=>eA,CubeRefractionMapping:()=>ev,CubeTexture:()=>sp,CubeTextureLoader:()=>uJ,CubeUVReflectionMapping:()=>e_,CubicBezierCurve:()=>hx,CubicBezierCurve3:()=>h_,CubicInterpolant:()=>uR,CullFaceBack:()=>p,CullFaceFront:()=>f,CullFaceFrontBack:()=>m,CullFaceNone:()=>d,Curve:()=>hl,CurvePath:()=>hT,CustomBlending:()=>T,CustomToneMapping:()=>ec,CylinderGeometry:()=>hP,Cylindrical:()=>c7,Data3DTexture:()=>ns,DataArrayTexture:()=>nn,DataTexture:()=>lA,DataTextureLoader:()=>uZ,DataUtils:()=>rM,DecrementStencilOp:()=>t4,DecrementWrapStencilOp:()=>t6,DefaultLoadingManager:()=>uj,DepthFormat:()=>eZ,DepthStencilFormat:()=>e$,DepthTexture:()=>s7,DetachedBindMode:()=>em,DirectionalLight:()=>cr,DirectionalLightHelper:()=>d_,DiscreteInterpolant:()=>uB,DisplayP3ColorSpace:()=>tX,DodecahedronGeometry:()=>hO,DoubleSide:()=>b,DstAlphaFactor:()=>z,DstColorFactor:()=>V,DynamicCopyUsage:()=>iE,DynamicDrawUsage:()=>iA,DynamicReadUsage:()=>ix,EdgesGeometry:()=>hG,EllipseCurve:()=>hh,EqualCompare:()=>ih,EqualDepth:()=>$,EqualStencilFunc:()=>ie,EquirectangularReflectionMapping:()=>ey,EquirectangularRefractionMapping:()=>ex,Euler:()=>nX,EventDispatcher:()=>iR,ExtrudeGeometry:()=>h7,FileLoader:()=>uq,Float16BufferAttribute:()=>rO,Float32BufferAttribute:()=>rU,FloatType:()=>eG,Fog:()=>oq,FogExp2:()=>oW,FramebufferTexture:()=>hn,FrontSide:()=>x,Frustum:()=>s_,GLBufferAttribute:()=>c2,GLSL1:()=>iM,GLSL3:()=>iC,GreaterCompare:()=>ic,GreaterDepth:()=>et,GreaterEqualCompare:()=>ip,GreaterEqualDepth:()=>ee,GreaterEqualStencilFunc:()=>is,GreaterStencilFunc:()=>ii,GridHelper:()=>dg,Group:()=>oR,HalfFloatType:()=>eV,HemisphereLight:()=>u1,HemisphereLightHelper:()=>dm,IcosahedronGeometry:()=>ue,ImageBitmapLoader:()=>cA,ImageLoader:()=>uY,ImageUtils:()=>i4,IncrementStencilOp:()=>t3,IncrementWrapStencilOp:()=>t5,InstancedBufferAttribute:()=>l_,InstancedBufferGeometry:()=>cc,InstancedInterleavedBuffer:()=>c1,InstancedMesh:()=>lR,Int16BufferAttribute:()=>rL,Int32BufferAttribute:()=>rD,Int8BufferAttribute:()=>rR,IntType:()=>eF,InterleavedBuffer:()=>oK,InterleavedBufferAttribute:()=>oJ,Interpolant:()=>uT,InterpolateDiscrete:()=>tI,InterpolateLinear:()=>tB,InterpolateSmooth:()=>tL,InvertStencilOp:()=>t8,KeepStencilOp:()=>t1,KeyframeTrack:()=>uL,LOD:()=>ls,LatheGeometry:()=>hI,Layers:()=>nK,LessCompare:()=>il,LessDepth:()=>J,LessEqualCompare:()=>iu,LessEqualDepth:()=>Z,LessEqualStencilFunc:()=>it,LessStencilFunc:()=>t9,Light:()=>u0,LightProbe:()=>cl,Line:()=>l$,Line3:()=>dn,LineBasicMaterial:()=>lQ,LineCurve:()=>hb,LineCurve3:()=>hE,LineDashedMaterial:()=>u_,LineLoop:()=>l4,LineSegments:()=>l3,LinearDisplayP3ColorSpace:()=>tK,LinearFilter:()=>eI,LinearInterpolant:()=>uI,LinearMipMapLinearFilter:()=>eD,LinearMipMapNearestFilter:()=>eL,LinearMipmapLinearFilter:()=>eP,LinearMipmapNearestFilter:()=>eB,LinearSRGBColorSpace:()=>tq,LinearToneMapping:()=>eo,LinearTransfer:()=>tY,Loader:()=>uH,LoaderUtils:()=>cu,LoadingManager:()=>uV,LoopOnce:()=>tS,LoopPingPong:()=>tR,LoopRepeat:()=>tT,LuminanceAlphaFormat:()=>eJ,LuminanceFormat:()=>eY,MOUSE:()=>u,Material:()=>rx,MaterialLoader:()=>ch,MathUtils:()=>iz,Matrix3:()=>iV,Matrix4:()=>nk,MaxEquation:()=>P,Mesh:()=>r9,MeshBasicMaterial:()=>r_,MeshDepthMaterial:()=>oE,MeshDistanceMaterial:()=>ow,MeshLambertMaterial:()=>uy,MeshMatcapMaterial:()=>ux,MeshNormalMaterial:()=>uv,MeshPhongMaterial:()=>ug,MeshPhysicalMaterial:()=>um,MeshStandardMaterial:()=>uf,MeshToonMaterial:()=>uA,MinEquation:()=>L,MirroredRepeatWrapping:()=>ew,MixOperation:()=>er,MultiplyBlending:()=>S,MultiplyOperation:()=>en,NearestFilter:()=>eM,NearestMipMapLinearFilter:()=>eR,NearestMipMapNearestFilter:()=>eS,NearestMipmapLinearFilter:()=>eT,NearestMipmapNearestFilter:()=>eC,NeutralToneMapping:()=>ep,NeverCompare:()=>io,NeverDepth:()=>K,NeverStencilFunc:()=>t7,NoBlending:()=>E,NoColorSpace:()=>tQ,NoToneMapping:()=>ea,NormalAnimationBlendMode:()=>tO,NormalBlending:()=>w,NotEqualCompare:()=>id,NotEqualDepth:()=>ei,NotEqualStencilFunc:()=>ir,NumberKeyframeTrack:()=>uN,Object3D:()=>rt,ObjectLoader:()=>cp,ObjectSpaceNormalMap:()=>tH,OctahedronGeometry:()=>ut,OneFactor:()=>N,OneMinusConstantAlphaFactor:()=>X,OneMinusConstantColorFactor:()=>W,OneMinusDstAlphaFactor:()=>G,OneMinusDstColorFactor:()=>j,OneMinusSrcAlphaFactor:()=>F,OneMinusSrcColorFactor:()=>U,OrthographicCamera:()=>sU,P3Primaries:()=>t$,PCFShadowMap:()=>A,PCFSoftShadowMap:()=>v,PMREMGenerator:()=>sX,Path:()=>hR,PerspectiveCamera:()=>sc,Plane:()=>sv,PlaneGeometry:()=>sw,PlaneHelper:()=>dR,PointLight:()=>ci,PointLightHelper:()=>dc,Points:()=>he,PointsMaterial:()=>l5,PolarGridHelper:()=>dA,PolyhedronGeometry:()=>hN,PositionalAudio:()=>cO,PropertyBinding:()=>cq,PropertyMixer:()=>ck,QuadraticBezierCurve:()=>hw,QuadraticBezierCurve3:()=>hM,Quaternion:()=>no,QuaternionKeyframeTrack:()=>uU,QuaternionLinearInterpolant:()=>uO,RED_GREEN_RGTC2_Format:()=>tM,RED_RGTC1_Format:()=>tE,REVISION:()=>h,RGBADepthPacking:()=>tV,RGBAFormat:()=>eK,RGBAIntegerFormat:()=>e4,RGBA_ASTC_10x10_Format:()=>tA,RGBA_ASTC_10x5_Format:()=>tf,RGBA_ASTC_10x6_Format:()=>tm,RGBA_ASTC_10x8_Format:()=>tg,RGBA_ASTC_12x10_Format:()=>tv,RGBA_ASTC_12x12_Format:()=>ty,RGBA_ASTC_4x4_Format:()=>ta,RGBA_ASTC_5x4_Format:()=>to,RGBA_ASTC_5x5_Format:()=>tl,RGBA_ASTC_6x5_Format:()=>th,RGBA_ASTC_6x6_Format:()=>tu,RGBA_ASTC_8x5_Format:()=>tc,RGBA_ASTC_8x6_Format:()=>td,RGBA_ASTC_8x8_Format:()=>tp,RGBA_BPTC_Format:()=>tx,RGBA_ETC2_EAC_Format:()=>ts,RGBA_PVRTC_2BPPV1_Format:()=>ti,RGBA_PVRTC_4BPPV1_Format:()=>tt,RGBA_S3TC_DXT1_Format:()=>e6,RGBA_S3TC_DXT3_Format:()=>e8,RGBA_S3TC_DXT5_Format:()=>e7,RGBFormat:()=>eX,RGB_BPTC_SIGNED_Format:()=>t_,RGB_BPTC_UNSIGNED_Format:()=>tb,RGB_ETC1_Format:()=>tn,RGB_ETC2_Format:()=>tr,RGB_PVRTC_2BPPV1_Format:()=>te,RGB_PVRTC_4BPPV1_Format:()=>e9,RGB_S3TC_DXT1_Format:()=>e5,RGFormat:()=>e2,RGIntegerFormat:()=>e3,RawShaderMaterial:()=>up,Ray:()=>nU,Raycaster:()=>c4,Rec709Primaries:()=>tZ,RectAreaLight:()=>ca,RedFormat:()=>e0,RedIntegerFormat:()=>e1,ReinhardToneMapping:()=>el,RenderTarget:()=>nt,RepeatWrapping:()=>eb,ReplaceStencilOp:()=>t2,ReverseSubtractEquation:()=>B,RingGeometry:()=>ui,SIGNED_RED_GREEN_RGTC2_Format:()=>tC,SIGNED_RED_RGTC1_Format:()=>tw,SRGBColorSpace:()=>tW,SRGBTransfer:()=>tJ,Scene:()=>oX,ShaderChunk:()=>sM,ShaderLib:()=>sS,ShaderMaterial:()=>sa,ShadowMaterial:()=>ud,Shape:()=>hV,ShapeGeometry:()=>un,ShapePath:()=>dP,ShapeUtils:()=>h5,ShortType:()=>eU,Skeleton:()=>lx,SkeletonHelper:()=>du,SkinnedMesh:()=>lm,Source:()=>i6,Sphere:()=>nR,SphereGeometry:()=>ur,Spherical:()=>c8,SphericalHarmonics3:()=>co,SplineCurve:()=>hC,SpotLight:()=>u8,SpotLightHelper:()=>ds,Sprite:()=>lt,SpriteMaterial:()=>oZ,SrcAlphaFactor:()=>k,SrcAlphaSaturateFactor:()=>H,SrcColorFactor:()=>O,StaticCopyUsage:()=>ib,StaticDrawUsage:()=>ig,StaticReadUsage:()=>iy,StereoCamera:()=>cE,StreamCopyUsage:()=>iw,StreamDrawUsage:()=>iv,StreamReadUsage:()=>i_,StringKeyframeTrack:()=>uk,SubtractEquation:()=>I,SubtractiveBlending:()=>C,TOUCH:()=>c,TangentSpaceNormalMap:()=>tj,TetrahedronGeometry:()=>us,Texture:()=>i9,TextureLoader:()=>u$,TorusGeometry:()=>ua,TorusKnotGeometry:()=>uo,Triangle:()=>rd,TriangleFanDrawMode:()=>tz,TriangleStripDrawMode:()=>tF,TrianglesDrawMode:()=>tk,TubeGeometry:()=>ul,UVMapping:()=>eg,Uint16BufferAttribute:()=>rP,Uint32BufferAttribute:()=>rN,Uint8BufferAttribute:()=>rI,Uint8ClampedBufferAttribute:()=>rB,Uniform:()=>cZ,UniformsGroup:()=>c0,UniformsLib:()=>sC,UniformsUtils:()=>ss,UnsignedByteType:()=>eN,UnsignedInt248Type:()=>eQ,UnsignedInt5999Type:()=>eW,UnsignedIntType:()=>ez,UnsignedShort4444Type:()=>ej,UnsignedShort5551Type:()=>eH,UnsignedShortType:()=>ek,VSMShadowMap:()=>y,Vector2:()=>iG,Vector3:()=>nl,Vector4:()=>ne,VectorKeyframeTrack:()=>uF,VideoTexture:()=>hi,WebGL3DRenderTarget:()=>na,WebGLArrayRenderTarget:()=>nr,WebGLCoordinateSystem:()=>iS,WebGLCubeRenderTarget:()=>sf,WebGLMultipleRenderTargets:()=>dD,WebGLRenderTarget:()=>ni,WebGLRenderer:()=>oQ,WebGLUtils:()=>oT,WebGPUCoordinateSystem:()=>iT,WireframeGeometry:()=>uh,WrapAroundEnding:()=>tN,ZeroCurvatureEnding:()=>tP,ZeroFactor:()=>D,ZeroSlopeEnding:()=>tD,ZeroStencilOp:()=>t0,createCanvasElement:()=>iX});let h="164",u={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},c={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},d=0,p=1,f=2,m=3,g=0,A=1,v=2,y=3,x=0,_=1,b=2,E=0,w=1,M=2,C=3,S=4,T=5,R=100,I=101,B=102,L=103,P=104,D=200,N=201,O=202,U=203,k=204,F=205,z=206,G=207,V=208,j=209,H=210,Q=211,W=212,q=213,X=214,K=0,Y=1,J=2,Z=3,$=4,ee=5,et=6,ei=7,en=0,er=1,es=2,ea=0,eo=1,el=2,eh=3,eu=4,ec=5,ed=6,ep=7,ef="attached",em="detached",eg=300,eA=301,ev=302,ey=303,ex=304,e_=306,eb=1e3,eE=1001,ew=1002,eM=1003,eC=1004,eS=1004,eT=1005,eR=1005,eI=1006,eB=1007,eL=1007,eP=1008,eD=1008,eN=1009,eO=1010,eU=1011,ek=1012,eF=1013,ez=1014,eG=1015,eV=1016,ej=1017,eH=1018,eQ=1020,eW=35902,eq=1021,eX=1022,eK=1023,eY=1024,eJ=1025,eZ=1026,e$=1027,e0=1028,e1=1029,e2=1030,e3=1031,e4=1033,e5=33776,e6=33777,e8=33778,e7=33779,e9=35840,te=35841,tt=35842,ti=35843,tn=36196,tr=37492,ts=37496,ta=37808,to=37809,tl=37810,th=37811,tu=37812,tc=37813,td=37814,tp=37815,tf=37816,tm=37817,tg=37818,tA=37819,tv=37820,ty=37821,tx=36492,t_=36494,tb=36495,tE=36283,tw=36284,tM=36285,tC=36286,tS=2200,tT=2201,tR=2202,tI=2300,tB=2301,tL=2302,tP=2400,tD=2401,tN=2402,tO=2500,tU=2501,tk=0,tF=1,tz=2,tG=3200,tV=3201,tj=0,tH=1,tQ="",tW="srgb",tq="srgb-linear",tX="display-p3",tK="display-p3-linear",tY="linear",tJ="srgb",tZ="rec709",t$="p3",t0=0,t1=7680,t2=7681,t3=7682,t4=7683,t5=34055,t6=34056,t8=5386,t7=512,t9=513,ie=514,it=515,ii=516,ir=517,is=518,ia=519,io=512,il=513,ih=514,iu=515,ic=516,id=517,ip=518,im=519,ig=35044,iA=35048,iv=35040,iy=35045,ix=35049,i_=35041,ib=35046,iE=35050,iw=35042,iM="100",iC="300 es",iS=2e3,iT=2001;class iR{addEventListener(e,i){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(i)&&n[e].push(i)}hasEventListener(e,i){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(i)}removeEventListener(e,i){if(void 0===this._listeners)return;let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(i);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let i=this._listeners[e.type];if(void 0!==i){e.target=this;let n=i.slice(0);for(let i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}let iI=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],iB=1234567,iL=Math.PI/180,iP=180/Math.PI;function iD(){let e=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0;return(iI[255&e]+iI[e>>8&255]+iI[e>>16&255]+iI[e>>24&255]+"-"+iI[255&i]+iI[i>>8&255]+"-"+iI[i>>16&15|64]+iI[i>>24&255]+"-"+iI[63&n|128]+iI[n>>8&255]+"-"+iI[n>>16&255]+iI[n>>24&255]+iI[255&r]+iI[r>>8&255]+iI[r>>16&255]+iI[r>>24&255]).toLowerCase()}function iN(e,i,n){return Math.max(i,Math.min(n,e))}function iO(e,i){return(e%i+i)%i}function iU(e,i,n){return(1-n)*e+n*i}function ik(e,i){switch(i.constructor){case Float32Array:return e;case Uint32Array:return e/0xffffffff;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/0x7fffffff,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function iF(e,i){switch(i.constructor){case Float32Array:return e;case Uint32Array:return Math.round(0xffffffff*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(0x7fffffff*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}let iz={DEG2RAD:iL,RAD2DEG:iP,generateUUID:iD,clamp:iN,euclideanModulo:iO,mapLinear:function(e,i,n,r,s){return r+(e-i)*(s-r)/(n-i)},inverseLerp:function(e,i,n){return e!==i?(n-e)/(i-e):0},lerp:iU,damp:function(e,i,n,r){return iU(e,i,1-Math.exp(-n*r))},pingpong:function(e,i=1){return i-Math.abs(iO(e,2*i)-i)},smoothstep:function(e,i,n){return e<=i?0:e>=n?1:(e=(e-i)/(n-i))*e*(3-2*e)},smootherstep:function(e,i,n){return e<=i?0:e>=n?1:(e=(e-i)/(n-i))*e*e*(e*(6*e-15)+10)},randInt:function(e,i){return e+Math.floor(Math.random()*(i-e+1))},randFloat:function(e,i){return e+Math.random()*(i-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(iB=e);let i=iB+=0x6d2b79f5;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/0x100000000},degToRad:function(e){return e*iL},radToDeg:function(e){return e*iP},isPowerOfTwo:function(e){return(e&e-1)==0&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,i,n,r,s){let a=Math.cos,o=Math.sin,l=a(n/2),h=o(n/2),u=a((i+r)/2),c=o((i+r)/2),d=a((i-r)/2),p=o((i-r)/2),f=a((r-i)/2),m=o((r-i)/2);switch(s){case"XYX":e.set(l*c,h*d,h*p,l*u);break;case"YZY":e.set(h*p,l*c,h*d,l*u);break;case"ZXZ":e.set(h*d,h*p,l*c,l*u);break;case"XZX":e.set(l*c,h*m,h*f,l*u);break;case"YXY":e.set(h*f,l*c,h*m,l*u);break;case"ZYZ":e.set(h*m,h*f,l*c,l*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}},normalize:iF,denormalize:ik};class iG{constructor(e=0,i=0){iG.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let i=this.x,n=this.y,r=e.elements;return this.x=r[0]*i+r[3]*n+r[6],this.y=r[1]*i+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===i?Math.PI/2:Math.acos(iN(this.dot(e)/i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){let n=Math.cos(i),r=Math.sin(i),s=this.x-e.x,a=this.y-e.y;return this.x=s*n-a*r+e.x,this.y=s*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class iV{constructor(e,i,n,r,s,a,o,l,h){iV.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,i,n,r,s,a,o,l,h)}set(e,i,n,r,s,a,o,l,h){let u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=n,u[7]=a,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let n=e.elements,r=i.elements,s=this.elements,a=n[0],o=n[3],l=n[6],h=n[1],u=n[4],c=n[7],d=n[2],p=n[5],f=n[8],m=r[0],g=r[3],A=r[6],v=r[1],y=r[4],x=r[7],_=r[2],b=r[5],E=r[8];return s[0]=a*m+o*v+l*_,s[3]=a*g+o*y+l*b,s[6]=a*A+o*x+l*E,s[1]=h*m+u*v+c*_,s[4]=h*g+u*y+c*b,s[7]=h*A+u*x+c*E,s[2]=d*m+p*v+f*_,s[5]=d*g+p*y+f*b,s[8]=d*A+p*x+f*E,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8];return i*a*u-i*o*h-n*s*u+n*o*l+r*s*h-r*a*l}invert(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=u*a-o*h,d=o*l-u*s,p=h*s-a*l,f=i*c+n*d+r*p;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);let m=1/f;return e[0]=c*m,e[1]=(r*h-u*n)*m,e[2]=(o*n-r*a)*m,e[3]=d*m,e[4]=(u*i-r*l)*m,e[5]=(r*s-o*i)*m,e[6]=p*m,e[7]=(n*l-h*i)*m,e[8]=(a*i-n*s)*m,this}transpose(){let e;let i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,r,s,a,o){let l=Math.cos(s),h=Math.sin(s);return this.set(n*l,n*h,-n*(l*a+h*o)+a+e,-r*h,r*l,-r*(-h*a+l*o)+o+i,0,0,1),this}scale(e,i){return this.premultiply(ij.makeScale(e,i)),this}rotate(e){return this.premultiply(ij.makeRotation(-e)),this}translate(e,i){return this.premultiply(ij.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){let i=this.elements,n=e.elements;for(let e=0;e<9;e++)if(i[e]!==n[e])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){let n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let ij=new iV;function iH(e){for(let i=e.length-1;i>=0;--i)if(e[i]>=65535)return!0;return!1}let iQ={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function iW(e,i){return new iQ[e](i)}function iq(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function iX(){let e=iq("canvas");return e.style.display="block",e}let iK={};function iY(e){e in iK||(iK[e]=!0,console.warn(e))}let iJ=new iV().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),iZ=new iV().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),i$={[tq]:{transfer:tY,primaries:tZ,toReference:e=>e,fromReference:e=>e},[tW]:{transfer:tJ,primaries:tZ,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[tK]:{transfer:tY,primaries:t$,toReference:e=>e.applyMatrix3(iZ),fromReference:e=>e.applyMatrix3(iJ)},[tX]:{transfer:tJ,primaries:t$,toReference:e=>e.convertSRGBToLinear().applyMatrix3(iZ),fromReference:e=>e.applyMatrix3(iJ).convertLinearToSRGB()}},i0=new Set([tq,tK]),i1={enabled:!0,_workingColorSpace:tq,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(colorSpace){if(!i0.has(colorSpace))throw Error(`Unsupported working color space, "${colorSpace}".`);this._workingColorSpace=colorSpace},convert:function(e,i,n){if(!1===this.enabled||i===n||!i||!n)return e;let r=i$[i].toReference;return(0,i$[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,i){return this.convert(e,this._workingColorSpace,i)},toWorkingColorSpace:function(e,i){return this.convert(e,i,this._workingColorSpace)},getPrimaries:function(e){return i$[e].primaries},getTransfer:function(e){return e===tQ?tY:i$[e].transfer}};function i2(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function i3(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class i4{static getDataURL(e){let i;if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)i=e;else{void 0===r&&(r=iq("canvas")),r.width=e.width,r.height=e.height;let n=r.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),i=r}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let i=iq("canvas");i.width=e.width,i.height=e.height;let n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height);let r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let e=0;e<s.length;e++)s[e]=255*i2(s[e]/255);return n.putImageData(r,0,0),i}if(!e.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e;{let i=e.data.slice(0);for(let e=0;e<i.length;e++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[e]=Math.floor(255*i2(i[e]/255)):i[e]=i2(i[e]);return{data:i,width:e.width,height:e.height}}}}let i5=0;class i6{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:i5++}),this.uuid=iD(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let i=void 0===e||"string"==typeof e;if(!i&&void 0!==e.images[this.uuid])return e.images[this.uuid];let n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let i=0,n=r.length;i<n;i++)r[i].isDataTexture?e.push(i8(r[i].image)):e.push(i8(r[i]))}else e=i8(r);n.url=e}return i||(e.images[this.uuid]=n),n}}function i8(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?i4.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let i7=0;class i9 extends iR{constructor(e=i9.DEFAULT_IMAGE,i=i9.DEFAULT_MAPPING,n=eE,r=eE,s=eI,a=eP,o=eK,l=eN,h=i9.DEFAULT_ANISOTROPY,u=tQ){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:i7++}),this.uuid=iD(),this.name="",this.source=new i6(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=l,this.offset=new iG(0,0),this.repeat=new iG(1,1),this.center=new iG(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new iV,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let i=void 0===e||"string"==typeof e;if(!i&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==eg)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case eb:e.x=e.x-Math.floor(e.x);break;case eE:e.x=e.x<0?0:1;break;case ew:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case eb:e.y=e.y-Math.floor(e.y);break;case eE:e.y=e.y<0?0:1;break;case ew:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}i9.DEFAULT_IMAGE=null,i9.DEFAULT_MAPPING=eg,i9.DEFAULT_ANISOTROPY=1;class ne{constructor(e=0,i=0,n=0,r=1){ne.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,r){return this.x=e,this.y=i,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let i=this.x,n=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*i+a[4]*n+a[8]*r+a[12]*s,this.y=a[1]*i+a[5]*n+a[9]*r+a[13]*s,this.z=a[2]*i+a[6]*n+a[10]*r+a[14]*s,this.w=a[3]*i+a[7]*n+a[11]*r+a[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,r,s;let a=e.elements,o=a[0],l=a[4],h=a[8],u=a[1],c=a[5],d=a[9],p=a[2],f=a[6],m=a[10];if(.01>Math.abs(l-u)&&.01>Math.abs(h-p)&&.01>Math.abs(d-f)){if(.1>Math.abs(l+u)&&.1>Math.abs(h+p)&&.1>Math.abs(d+f)&&.1>Math.abs(o+c+m-3))return this.set(1,0,0,0),this;i=Math.PI;let e=(o+1)/2,a=(c+1)/2,g=(m+1)/2,A=(l+u)/4,v=(h+p)/4,y=(d+f)/4;return e>a&&e>g?e<.01?(n=0,r=.707106781,s=.707106781):(r=A/(n=Math.sqrt(e)),s=v/n):a>g?a<.01?(n=.707106781,r=0,s=.707106781):(n=A/(r=Math.sqrt(a)),s=y/r):g<.01?(n=.707106781,r=.707106781,s=0):(n=v/(s=Math.sqrt(g)),r=y/s),this.set(n,r,s,i),this}let g=Math.sqrt((f-d)*(f-d)+(h-p)*(h-p)+(u-l)*(u-l));return .001>Math.abs(g)&&(g=1),this.x=(f-d)/g,this.y=(h-p)/g,this.z=(u-l)/g,this.w=Math.acos((o+c+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class nt extends iR{constructor(e=1,i=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new ne(0,0,e,i),this.scissorTest=!1,this.viewport=new ne(0,0,e,i);let r=new i9({width:e,height:i,depth:1},(n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:eI,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n)).mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];let s=n.count;for(let e=0;e<s;e++)this.textures[e]=r.clone(),this.textures[e].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,n=1){if(this.width!==e||this.height!==i||this.depth!==n){this.width=e,this.height=i,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=i,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,n=e.textures.length;i<n;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;let i=Object.assign({},e.texture.image);return this.texture.source=new i6(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ni extends nt{constructor(e=1,i=1,n={}){super(e,i,n),this.isWebGLRenderTarget=!0}}class nn extends i9{constructor(e=null,i=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:n,depth:r},this.magFilter=eM,this.minFilter=eM,this.wrapR=eE,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class nr extends ni{constructor(e=1,i=1,n=1,r={}){super(e,i,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new nn(null,e,i,n),this.texture.isRenderTargetTexture=!0}}class ns extends i9{constructor(e=null,i=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:n,depth:r},this.magFilter=eM,this.minFilter=eM,this.wrapR=eE,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class na extends ni{constructor(e=1,i=1,n=1,r={}){super(e,i,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new ns(null,e,i,n),this.texture.isRenderTargetTexture=!0}}class no{constructor(e=0,i=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=n,this._w=r}static slerpFlat(e,i,n,r,s,a,o){let l=n[r+0],h=n[r+1],u=n[r+2],c=n[r+3],d=s[a+0],p=s[a+1],f=s[a+2],m=s[a+3];if(0===o){e[i+0]=l,e[i+1]=h,e[i+2]=u,e[i+3]=c;return}if(1===o){e[i+0]=d,e[i+1]=p,e[i+2]=f,e[i+3]=m;return}if(c!==m||l!==d||h!==p||u!==f){let e=1-o,i=l*d+h*p+u*f+c*m,n=i>=0?1:-1,r=1-i*i;if(r>Number.EPSILON){let s=Math.sqrt(r),a=Math.atan2(s,i*n);e=Math.sin(e*a)/s,o=Math.sin(o*a)/s}let s=o*n;if(l=l*e+d*s,h=h*e+p*s,u=u*e+f*s,c=c*e+m*s,e===1-o){let e=1/Math.sqrt(l*l+h*h+u*u+c*c);l*=e,h*=e,u*=e,c*=e}}e[i]=l,e[i+1]=h,e[i+2]=u,e[i+3]=c}static multiplyQuaternionsFlat(e,i,n,r,s,a){let o=n[r],l=n[r+1],h=n[r+2],u=n[r+3],c=s[a],d=s[a+1],p=s[a+2],f=s[a+3];return e[i]=o*f+u*c+l*p-h*d,e[i+1]=l*f+u*d+h*c-o*p,e[i+2]=h*f+u*p+o*d-l*c,e[i+3]=u*f-o*c-l*d-h*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,n,r){return this._x=e,this._y=i,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){let n=e._x,r=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,h=o(n/2),u=o(r/2),c=o(s/2),d=l(n/2),p=l(r/2),f=l(s/2);switch(a){case"XYZ":this._x=d*u*c+h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c-d*p*f;break;case"YXZ":this._x=d*u*c+h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c+d*p*f;break;case"ZXY":this._x=d*u*c-h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c-d*p*f;break;case"ZYX":this._x=d*u*c-h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c+d*p*f;break;case"YZX":this._x=d*u*c+h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c-d*p*f;break;case"XZY":this._x=d*u*c-h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===i&&this._onChangeCallback(),this}setFromAxisAngle(e,i){let n=i/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let i=e.elements,n=i[0],r=i[4],s=i[8],a=i[1],o=i[5],l=i[9],h=i[2],u=i[6],c=i[10],d=n+o+c;if(d>0){let e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(u-l)*e,this._y=(s-h)*e,this._z=(a-r)*e}else if(n>o&&n>c){let e=2*Math.sqrt(1+n-o-c);this._w=(u-l)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(s+h)/e}else if(o>c){let e=2*Math.sqrt(1+o-n-c);this._w=(s-h)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(l+u)/e}else{let e=2*Math.sqrt(1+c-n-o);this._w=(a-r)/e,this._x=(s+h)/e,this._y=(l+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let n=e.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x),this._w=n,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(iN(this.dot(e),-1,1)))}rotateTowards(e,i){let n=this.angleTo(e);if(0===n)return this;let r=Math.min(1,i/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){let n=e._x,r=e._y,s=e._z,a=e._w,o=i._x,l=i._y,h=i._z,u=i._w;return this._x=n*u+a*o+r*h-s*l,this._y=r*u+a*l+s*o-n*h,this._z=s*u+a*h+n*l-r*o,this._w=a*u-n*o-r*l-s*h,this._onChangeCallback(),this}slerp(e,i){if(0===i)return this;if(1===i)return this.copy(e);let n=this._x,r=this._y,s=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=s,this;let l=1-o*o;if(l<=Number.EPSILON){let e=1-i;return this._w=e*a+i*this._w,this._x=e*n+i*this._x,this._y=e*r+i*this._y,this._z=e*s+i*this._z,this.normalize(),this}let h=Math.sqrt(l),u=Math.atan2(h,o),c=Math.sin((1-i)*u)/h,d=Math.sin(i*u)/h;return this._w=a*c+this._w*d,this._x=n*c+this._x*d,this._y=r*c+this._y*d,this._z=s*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,i,n){return this.copy(e).slerp(i,n)}random(){let e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(i),s*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class nl{constructor(e=0,i=0,n=0){nl.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return void 0===n&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(nu.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(nu.setFromAxisAngle(e,i))}applyMatrix3(e){let i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6]*r,this.y=s[1]*i+s[4]*n+s[7]*r,this.z=s[2]*i+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let i=this.x,n=this.y,r=this.z,s=e.elements,a=1/(s[3]*i+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*i+s[4]*n+s[8]*r+s[12])*a,this.y=(s[1]*i+s[5]*n+s[9]*r+s[13])*a,this.z=(s[2]*i+s[6]*n+s[10]*r+s[14])*a,this}applyQuaternion(e){let i=this.x,n=this.y,r=this.z,s=e.x,a=e.y,o=e.z,l=e.w,h=2*(a*r-o*n),u=2*(o*i-s*r),c=2*(s*n-a*i);return this.x=i+l*h+a*c-o*u,this.y=n+l*u+o*h-s*c,this.z=r+l*c+s*u-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[4]*n+s[8]*r,this.y=s[1]*i+s[5]*n+s[9]*r,this.z=s[2]*i+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){let n=e.x,r=e.y,s=e.z,a=i.x,o=i.y,l=i.z;return this.x=r*l-s*o,this.y=s*a-n*l,this.z=n*o-r*a,this}projectOnVector(e){let i=e.lengthSq();if(0===i)return this.set(0,0,0);let n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return nh.copy(this).projectOnVector(e),this.sub(nh)}reflect(e){return this.sub(nh.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===i?Math.PI/2:Math.acos(iN(this.dot(e)/i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return i*i+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){let r=Math.sin(i)*e;return this.x=r*Math.sin(n),this.y=Math.cos(i)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){let i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){let i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,4*i)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,3*i)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=Math.random()*Math.PI*2,i=2*Math.random()-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let nh=new nl,nu=new no;class nc{constructor(e=new nl(Infinity,Infinity,Infinity),i=new nl(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i+=3)this.expandByPoint(np.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,n=e.count;i<n;i++)this.expandByPoint(np.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){let n=np.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);let n=e.geometry;if(void 0!==n){let r=n.getAttribute("position");if(!0===i&&void 0!==r&&!0!==e.isInstancedMesh)for(let i=0,n=r.count;i<n;i++)!0===e.isMesh?e.getVertexPosition(i,np):np.fromBufferAttribute(r,i),np.applyMatrix4(e.matrixWorld),this.expandByPoint(np);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),nf.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),nf.copy(n.boundingBox)),nf.applyMatrix4(e.matrixWorld),this.union(nf)}let r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],i);return this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)&&!(e.z<this.min.z)&&!(e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)&&!(e.max.z<this.min.z)&&!(e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,np),np.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,n;return e.normal.x>0?(i=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),i<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(n_),nb.subVectors(this.max,n_),nm.subVectors(e.a,n_),ng.subVectors(e.b,n_),nA.subVectors(e.c,n_),nv.subVectors(ng,nm),ny.subVectors(nA,ng),nx.subVectors(nm,nA);let i=[0,-nv.z,nv.y,0,-ny.z,ny.y,0,-nx.z,nx.y,nv.z,0,-nv.x,ny.z,0,-ny.x,nx.z,0,-nx.x,-nv.y,nv.x,0,-ny.y,ny.x,0,-nx.y,nx.x,0];return!!(nM(i,nm,ng,nA,nb)&&nM(i=[1,0,0,0,1,0,0,0,1],nm,ng,nA,nb))&&(nE.crossVectors(nv,ny),nM(i=[nE.x,nE.y,nE.z],nm,ng,nA,nb))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,np).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(np).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(nd[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),nd[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),nd[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),nd[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),nd[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),nd[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),nd[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),nd[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(nd)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let nd=[new nl,new nl,new nl,new nl,new nl,new nl,new nl,new nl],np=new nl,nf=new nc,nm=new nl,ng=new nl,nA=new nl,nv=new nl,ny=new nl,nx=new nl,n_=new nl,nb=new nl,nE=new nl,nw=new nl;function nM(e,i,n,r,s){for(let a=0,o=e.length-3;a<=o;a+=3){nw.fromArray(e,a);let o=s.x*Math.abs(nw.x)+s.y*Math.abs(nw.y)+s.z*Math.abs(nw.z),l=i.dot(nw),h=n.dot(nw),u=r.dot(nw);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>o)return!1}return!0}let nC=new nc,nS=new nl,nT=new nl;class nR{constructor(e=new nl,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){let n=this.center;void 0!==i?n.copy(i):nC.setFromPoints(e).getCenter(n);let r=0;for(let i=0,s=e.length;i<s;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){let n=this.center.distanceToSquared(e);return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;nS.subVectors(e,this.center);let i=nS.lengthSq();if(i>this.radius*this.radius){let e=Math.sqrt(i),n=(e-this.radius)*.5;this.center.addScaledVector(nS,n/e),this.radius+=n}return this}union(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(nT.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(nS.copy(e.center).add(nT)),this.expandByPoint(nS.copy(e.center).sub(nT)))),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}let nI=new nl,nB=new nl,nL=new nl,nP=new nl,nD=new nl,nN=new nl,nO=new nl;class nU{constructor(e=new nl,i=new nl(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,nI)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);let n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let i=nI.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(nI.copy(this.origin).addScaledVector(this.direction,i),nI.distanceToSquared(e))}distanceSqToSegment(e,i,n,r){let s,a,o,l;nB.copy(e).add(i).multiplyScalar(.5),nL.copy(i).sub(e).normalize(),nP.copy(this.origin).sub(nB);let h=.5*e.distanceTo(i),u=-this.direction.dot(nL),c=nP.dot(this.direction),d=-nP.dot(nL),p=nP.lengthSq(),f=Math.abs(1-u*u);if(f>0){if(s=u*d-c,a=u*c-d,l=h*f,s>=0){if(a>=-l){if(a<=l){let e=1/f;s*=e,a*=e,o=s*(s+u*a+2*c)+a*(u*s+a+2*d)+p}else o=-(s=Math.max(0,-(u*(a=h)+c)))*s+a*(a+2*d)+p}else o=-(s=Math.max(0,-(u*(a=-h)+c)))*s+a*(a+2*d)+p}else a<=-l?(a=(s=Math.max(0,-(-u*h+c)))>0?-h:Math.min(Math.max(-h,-d),h),o=-s*s+a*(a+2*d)+p):a<=l?(s=0,o=(a=Math.min(Math.max(-h,-d),h))*(a+2*d)+p):(a=(s=Math.max(0,-(u*h+c)))>0?h:Math.min(Math.max(-h,-d),h),o=-s*s+a*(a+2*d)+p)}else a=u>0?-h:h,o=-(s=Math.max(0,-(u*a+c)))*s+a*(a+2*d)+p;return n&&n.copy(this.origin).addScaledVector(this.direction,s),r&&r.copy(nB).addScaledVector(nL,a),o}intersectSphere(e,i){nI.subVectors(e.center,this.origin);let n=nI.dot(this.direction),r=nI.dot(nI)-n*n,s=e.radius*e.radius;if(r>s)return null;let a=Math.sqrt(s-r),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let i=e.normal.dot(this.direction);if(0===i)return 0===e.distanceToPoint(this.origin)?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/i;return n>=0?n:null}intersectPlane(e,i){let n=this.distanceToPlane(e);return null===n?null:this.at(n,i)}intersectsPlane(e){let i=e.distanceToPoint(this.origin);return!!(0===i||e.normal.dot(this.direction)*i<0)}intersectBox(e,i){let n,r,s,a,o,l;let h=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return(h>=0?(n=(e.min.x-d.x)*h,r=(e.max.x-d.x)*h):(n=(e.max.x-d.x)*h,r=(e.min.x-d.x)*h),u>=0?(s=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),n>a||s>r)?null:((s>n||isNaN(n))&&(n=s),(a<r||isNaN(r))&&(r=a),c>=0?(o=(e.min.z-d.z)*c,l=(e.max.z-d.z)*c):(o=(e.max.z-d.z)*c,l=(e.min.z-d.z)*c),n>l||o>r)?null:((o>n||n!=n)&&(n=o),(l<r||r!=r)&&(r=l),r<0)?null:this.at(n>=0?n:r,i)}intersectsBox(e){return null!==this.intersectBox(e,nI)}intersectTriangle(e,i,n,r,s){let a;nD.subVectors(i,e),nN.subVectors(n,e),nO.crossVectors(nD,nN);let o=this.direction.dot(nO);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}nP.subVectors(this.origin,e);let l=a*this.direction.dot(nN.crossVectors(nP,nN));if(l<0)return null;let h=a*this.direction.dot(nD.cross(nP));if(h<0||l+h>o)return null;let u=-a*nP.dot(nO);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class nk{constructor(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g){nk.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g)}set(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g){let A=this.elements;return A[0]=e,A[4]=i,A[8]=n,A[12]=r,A[1]=s,A[5]=a,A[9]=o,A[13]=l,A[2]=h,A[6]=u,A[10]=c,A[14]=d,A[3]=p,A[7]=f,A[11]=m,A[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new nk().fromArray(this.elements)}copy(e){let i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){let i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){let i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){let i=this.elements,n=e.elements,r=1/nF.setFromMatrixColumn(e,0).length(),s=1/nF.setFromMatrixColumn(e,1).length(),a=1/nF.setFromMatrixColumn(e,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=0,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=0,i[8]=n[8]*a,i[9]=n[9]*a,i[10]=n[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){let i=this.elements,n=e.x,r=e.y,s=e.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(r),h=Math.sin(r),u=Math.cos(s),c=Math.sin(s);if("XYZ"===e.order){let e=a*u,n=a*c,r=o*u,s=o*c;i[0]=l*u,i[4]=-l*c,i[8]=h,i[1]=n+r*h,i[5]=e-s*h,i[9]=-o*l,i[2]=s-e*h,i[6]=r+n*h,i[10]=a*l}else if("YXZ"===e.order){let e=l*u,n=l*c,r=h*u,s=h*c;i[0]=e+s*o,i[4]=r*o-n,i[8]=a*h,i[1]=a*c,i[5]=a*u,i[9]=-o,i[2]=n*o-r,i[6]=s+e*o,i[10]=a*l}else if("ZXY"===e.order){let e=l*u,n=l*c,r=h*u,s=h*c;i[0]=e-s*o,i[4]=-a*c,i[8]=r+n*o,i[1]=n+r*o,i[5]=a*u,i[9]=s-e*o,i[2]=-a*h,i[6]=o,i[10]=a*l}else if("ZYX"===e.order){let e=a*u,n=a*c,r=o*u,s=o*c;i[0]=l*u,i[4]=r*h-n,i[8]=e*h+s,i[1]=l*c,i[5]=s*h+e,i[9]=n*h-r,i[2]=-h,i[6]=o*l,i[10]=a*l}else if("YZX"===e.order){let e=a*l,n=a*h,r=o*l,s=o*h;i[0]=l*u,i[4]=s-e*c,i[8]=r*c+n,i[1]=c,i[5]=a*u,i[9]=-o*u,i[2]=-h*u,i[6]=n*c+r,i[10]=e-s*c}else if("XZY"===e.order){let e=a*l,n=a*h,r=o*l,s=o*h;i[0]=l*u,i[4]=-c,i[8]=h*u,i[1]=e*c+s,i[5]=a*u,i[9]=n*c-r,i[2]=r*c-n,i[6]=o*u,i[10]=s*c+e}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(nG,e,nV)}lookAt(e,i,n){let r=this.elements;return nQ.subVectors(e,i),0===nQ.lengthSq()&&(nQ.z=1),nQ.normalize(),nj.crossVectors(n,nQ),0===nj.lengthSq()&&(1===Math.abs(n.z)?nQ.x+=1e-4:nQ.z+=1e-4,nQ.normalize(),nj.crossVectors(n,nQ)),nj.normalize(),nH.crossVectors(nQ,nj),r[0]=nj.x,r[4]=nH.x,r[8]=nQ.x,r[1]=nj.y,r[5]=nH.y,r[9]=nQ.y,r[2]=nj.z,r[6]=nH.z,r[10]=nQ.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let n=e.elements,r=i.elements,s=this.elements,a=n[0],o=n[4],l=n[8],h=n[12],u=n[1],c=n[5],d=n[9],p=n[13],f=n[2],m=n[6],g=n[10],A=n[14],v=n[3],y=n[7],x=n[11],_=n[15],b=r[0],E=r[4],w=r[8],M=r[12],C=r[1],S=r[5],T=r[9],R=r[13],I=r[2],B=r[6],L=r[10],P=r[14],D=r[3],N=r[7],O=r[11],U=r[15];return s[0]=a*b+o*C+l*I+h*D,s[4]=a*E+o*S+l*B+h*N,s[8]=a*w+o*T+l*L+h*O,s[12]=a*M+o*R+l*P+h*U,s[1]=u*b+c*C+d*I+p*D,s[5]=u*E+c*S+d*B+p*N,s[9]=u*w+c*T+d*L+p*O,s[13]=u*M+c*R+d*P+p*U,s[2]=f*b+m*C+g*I+A*D,s[6]=f*E+m*S+g*B+A*N,s[10]=f*w+m*T+g*L+A*O,s[14]=f*M+m*R+g*P+A*U,s[3]=v*b+y*C+x*I+_*D,s[7]=v*E+y*S+x*B+_*N,s[11]=v*w+y*T+x*L+_*O,s[15]=v*M+y*R+x*P+_*U,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){let e=this.elements,i=e[0],n=e[4],r=e[8],s=e[12],a=e[1],o=e[5],l=e[9],h=e[13],u=e[2],c=e[6],d=e[10],p=e[14],f=e[3],m=e[7];return f*(+s*l*c-r*h*c-s*o*d+n*h*d+r*o*p-n*l*p)+m*(+i*l*p-i*h*d+s*a*d-r*a*p+r*h*u-s*l*u)+e[11]*(+i*h*c-i*o*p-s*a*c+n*a*p+s*o*u-n*h*u)+e[15]*(-r*o*u-i*l*c+i*o*d+r*a*c-n*a*d+n*l*u)}transpose(){let e;let i=this.elements;return e=i[1],i[1]=i[4],i[4]=e,e=i[2],i[2]=i[8],i[8]=e,e=i[6],i[6]=i[9],i[9]=e,e=i[3],i[3]=i[12],i[12]=e,e=i[7],i[7]=i[13],i[13]=e,e=i[11],i[11]=i[14],i[14]=e,this}setPosition(e,i,n){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=n),this}invert(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],A=e[15],v=c*g*h-m*d*h+m*l*p-o*g*p-c*l*A+o*d*A,y=f*d*h-u*g*h-f*l*p+a*g*p+u*l*A-a*d*A,x=u*m*h-f*c*h+f*o*p-a*m*p-u*o*A+a*c*A,_=f*c*l-u*m*l-f*o*d+a*m*d+u*o*g-a*c*g,b=i*v+n*y+r*x+s*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let E=1/b;return e[0]=v*E,e[1]=(m*d*s-c*g*s-m*r*p+n*g*p+c*r*A-n*d*A)*E,e[2]=(o*g*s-m*l*s+m*r*h-n*g*h-o*r*A+n*l*A)*E,e[3]=(c*l*s-o*d*s-c*r*h+n*d*h+o*r*p-n*l*p)*E,e[4]=y*E,e[5]=(u*g*s-f*d*s+f*r*p-i*g*p-u*r*A+i*d*A)*E,e[6]=(f*l*s-a*g*s-f*r*h+i*g*h+a*r*A-i*l*A)*E,e[7]=(a*d*s-u*l*s+u*r*h-i*d*h-a*r*p+i*l*p)*E,e[8]=x*E,e[9]=(f*c*s-u*m*s-f*n*p+i*m*p+u*n*A-i*c*A)*E,e[10]=(a*m*s-f*o*s+f*n*h-i*m*h-a*n*A+i*o*A)*E,e[11]=(u*o*s-a*c*s-u*n*h+i*c*h+a*n*p-i*o*p)*E,e[12]=_*E,e[13]=(u*m*r-f*c*r+f*n*d-i*m*d-u*n*g+i*c*g)*E,e[14]=(f*o*r-a*m*r-f*n*l+i*m*l+a*n*g-i*o*g)*E,e[15]=(a*c*r-u*o*r+u*n*l-i*c*l-a*n*d+i*o*d)*E,this}scale(e){let i=this.elements,n=e.x,r=e.y,s=e.z;return i[0]*=n,i[4]*=r,i[8]*=s,i[1]*=n,i[5]*=r,i[9]*=s,i[2]*=n,i[6]*=r,i[10]*=s,i[3]*=n,i[7]*=r,i[11]*=s,this}getMaxScaleOnAxis(){let e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.sqrt(Math.max(i,e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){let i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){let n=Math.cos(i),r=Math.sin(i),s=1-n,a=e.x,o=e.y,l=e.z,h=s*a,u=s*o;return this.set(h*a+n,h*o-r*l,h*l+r*o,0,h*o+r*l,u*o+n,u*l-r*a,0,h*l-r*o,u*l+r*a,s*l*l+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,r,s,a){return this.set(1,n,s,0,e,1,a,0,i,r,1,0,0,0,0,1),this}compose(e,i,n){let r=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,h=s+s,u=a+a,c=o+o,d=s*h,p=s*u,f=s*c,m=a*u,g=a*c,A=o*c,v=l*h,y=l*u,x=l*c,_=n.x,b=n.y,E=n.z;return r[0]=(1-(m+A))*_,r[1]=(p+x)*_,r[2]=(f-y)*_,r[3]=0,r[4]=(p-x)*b,r[5]=(1-(d+A))*b,r[6]=(g+v)*b,r[7]=0,r[8]=(f+y)*E,r[9]=(g-v)*E,r[10]=(1-(d+m))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,n){let r=this.elements,s=nF.set(r[0],r[1],r[2]).length(),a=nF.set(r[4],r[5],r[6]).length(),o=nF.set(r[8],r[9],r[10]).length();0>this.determinant()&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],nz.copy(this);let l=1/s,h=1/a,u=1/o;return nz.elements[0]*=l,nz.elements[1]*=l,nz.elements[2]*=l,nz.elements[4]*=h,nz.elements[5]*=h,nz.elements[6]*=h,nz.elements[8]*=u,nz.elements[9]*=u,nz.elements[10]*=u,i.setFromRotationMatrix(nz),n.x=s,n.y=a,n.z=o,this}makePerspective(e,i,n,r,s,a,o=iS){let l,h;let u=this.elements;if(o===iS)l=-(a+s)/(a-s),h=-2*a*s/(a-s);else if(o===iT)l=-a/(a-s),h=-a*s/(a-s);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return u[0]=2*s/(i-e),u[4]=0,u[8]=(i+e)/(i-e),u[12]=0,u[1]=0,u[5]=2*s/(n-r),u[9]=(n+r)/(n-r),u[13]=0,u[2]=0,u[6]=0,u[10]=l,u[14]=h,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,i,n,r,s,a,o=iS){let l,h;let u=this.elements,c=1/(i-e),d=1/(n-r),p=1/(a-s);if(o===iS)l=(a+s)*p,h=-2*p;else if(o===iT)l=s*p,h=-1*p;else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return u[0]=2*c,u[4]=0,u[8]=0,u[12]=-((i+e)*c),u[1]=0,u[5]=2*d,u[9]=0,u[13]=-((n+r)*d),u[2]=0,u[6]=0,u[10]=h,u[14]=-l,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){let i=this.elements,n=e.elements;for(let e=0;e<16;e++)if(i[e]!==n[e])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){let n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}}let nF=new nl,nz=new nk,nG=new nl(0,0,0),nV=new nl(1,1,1),nj=new nl,nH=new nl,nQ=new nl,nW=new nk,nq=new no;class nX{constructor(e=0,i=0,n=0,r=nX.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,r=this._order){return this._x=e,this._y=i,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){let r=e.elements,s=r[0],a=r[4],o=r[8],l=r[1],h=r[5],u=r[9],c=r[2],d=r[6],p=r[10];switch(i){case"XYZ":this._y=Math.asin(iN(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,h),this._z=0);break;case"YXZ":this._x=Math.asin(-iN(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(iN(d,-1,1)),.9999999>Math.abs(d)?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-iN(c,-1,1)),.9999999>Math.abs(c)?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(iN(l,-1,1)),.9999999>Math.abs(l)?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-iN(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return nW.makeRotationFromQuaternion(e),this.setFromRotationMatrix(nW,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return nq.setFromEuler(this),this.setFromQuaternion(nq,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}nX.DEFAULT_ORDER="XYZ";class nK{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let nY=0,nJ=new nl,nZ=new no,n$=new nk,n0=new nl,n1=new nl,n2=new nl,n3=new no,n4=new nl(1,0,0),n5=new nl(0,1,0),n6=new nl(0,0,1),n8={type:"added"},n7={type:"removed"},n9={type:"childadded",child:null},re={type:"childremoved",child:null};class rt extends iR{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:nY++}),this.uuid=iD(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=rt.DEFAULT_UP.clone();let e=new nl,i=new nX,n=new no,r=new nl(1,1,1);i._onChange(function(){n.setFromEuler(i,!1)}),n._onChange(function(){i.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new nk},normalMatrix:{value:new iV}}),this.matrix=new nk,this.matrixWorld=new nk,this.matrixAutoUpdate=rt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=rt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new nK,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return nZ.setFromAxisAngle(e,i),this.quaternion.multiply(nZ),this}rotateOnWorldAxis(e,i){return nZ.setFromAxisAngle(e,i),this.quaternion.premultiply(nZ),this}rotateX(e){return this.rotateOnAxis(n4,e)}rotateY(e){return this.rotateOnAxis(n5,e)}rotateZ(e){return this.rotateOnAxis(n6,e)}translateOnAxis(e,i){return nJ.copy(e).applyQuaternion(this.quaternion),this.position.add(nJ.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(n4,e)}translateY(e){return this.translateOnAxis(n5,e)}translateZ(e){return this.translateOnAxis(n6,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(n$.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?n0.copy(e):n0.set(e,i,n);let r=this.parent;this.updateWorldMatrix(!0,!1),n1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?n$.lookAt(n1,n0,this.up):n$.lookAt(n0,n1,this.up),this.quaternion.setFromRotationMatrix(n$),r&&(n$.extractRotation(r.matrixWorld),nZ.setFromRotationMatrix(n$),this.quaternion.premultiply(nZ.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(n8),n9.child=e,this.dispatchEvent(n9),n9.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let i=this.children.indexOf(e);return -1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(n7),re.child=e,this.dispatchEvent(re),re.child=null),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),n$.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),n$.multiply(e.parent.matrixWorld)),e.applyMatrix4(n$),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(n8),n9.child=e,this.dispatchEvent(n9),n9.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectByProperty(e,i);if(void 0!==r)return r}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);let r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(n1,e,n2),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(n1,n3,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);let i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverseVisible(e)}traverseAncestors(e){let i=this.parent;null!==i&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let i=this.children;for(let n=0,r=i.length;n<r;n++){let r=i[n];(!0===r.matrixWorldAutoUpdate||!0===e)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,i){let n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){let e=this.children;for(let i=0,n=e.length;i<n;i++){let n=e[i];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){let i=void 0===e||"string"==typeof e,n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let r={};function s(i,n){return void 0===i[n.uuid]&&(i[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);let i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){let n=i.shapes;if(Array.isArray(n))for(let i=0,r=n.length;i<r;i++){let r=n[i];s(e.shapes,r)}else s(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){let i=[];for(let n=0,r=this.material.length;n<r;n++)i.push(s(e.materials,this.material[n]));r.material=i}else r.material=s(e.materials,this.material)}if(this.children.length>0){r.children=[];for(let i=0;i<this.children.length;i++)r.children.push(this.children[i].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let i=0;i<this.animations.length;i++){let n=this.animations[i];r.animations.push(s(e.animations,n))}}if(i){let i=a(e.geometries),r=a(e.materials),s=a(e.textures),o=a(e.images),l=a(e.shapes),h=a(e.skeletons),u=a(e.animations),c=a(e.nodes);i.length>0&&(n.geometries=i),r.length>0&&(n.materials=r),s.length>0&&(n.textures=s),o.length>0&&(n.images=o),l.length>0&&(n.shapes=l),h.length>0&&(n.skeletons=h),u.length>0&&(n.animations=u),c.length>0&&(n.nodes=c)}return n.object=r,n;function a(e){let i=[];for(let n in e){let r=e[n];delete r.metadata,i.push(r)}return i}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===i)for(let i=0;i<e.children.length;i++){let n=e.children[i];this.add(n.clone())}return this}}rt.DEFAULT_UP=new nl(0,1,0),rt.DEFAULT_MATRIX_AUTO_UPDATE=!0,rt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let ri=new nl,rn=new nl,rr=new nl,rs=new nl,ra=new nl,ro=new nl,rl=new nl,rh=new nl,ru=new nl,rc=new nl;class rd{constructor(e=new nl,i=new nl,n=new nl){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,r){r.subVectors(n,i),ri.subVectors(e,i),r.cross(ri);let s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,i,n,r,s){ri.subVectors(r,i),rn.subVectors(n,i),rr.subVectors(e,i);let a=ri.dot(ri),o=ri.dot(rn),l=ri.dot(rr),h=rn.dot(rn),u=rn.dot(rr),c=a*h-o*o;if(0===c)return s.set(0,0,0),null;let d=1/c,p=(h*l-o*u)*d,f=(a*u-o*l)*d;return s.set(1-p-f,f,p)}static containsPoint(e,i,n,r){return null!==this.getBarycoord(e,i,n,r,rs)&&rs.x>=0&&rs.y>=0&&rs.x+rs.y<=1}static getInterpolation(e,i,n,r,s,a,o,l){return null===this.getBarycoord(e,i,n,r,rs)?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,rs.x),l.addScaledVector(a,rs.y),l.addScaledVector(o,rs.z),l)}static isFrontFacing(e,i,n,r){return ri.subVectors(n,i),rn.subVectors(e,i),0>ri.cross(rn).dot(r)}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,r){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,n,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ri.subVectors(this.c,this.b),rn.subVectors(this.a,this.b),.5*ri.cross(rn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return rd.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return rd.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,r,s){return rd.getInterpolation(e,this.a,this.b,this.c,i,n,r,s)}containsPoint(e){return rd.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return rd.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){let n,r;let s=this.a,a=this.b,o=this.c;ra.subVectors(a,s),ro.subVectors(o,s),rh.subVectors(e,s);let l=ra.dot(rh),h=ro.dot(rh);if(l<=0&&h<=0)return i.copy(s);ru.subVectors(e,a);let u=ra.dot(ru),c=ro.dot(ru);if(u>=0&&c<=u)return i.copy(a);let d=l*c-u*h;if(d<=0&&l>=0&&u<=0)return n=l/(l-u),i.copy(s).addScaledVector(ra,n);rc.subVectors(e,o);let p=ra.dot(rc),f=ro.dot(rc);if(f>=0&&p<=f)return i.copy(o);let m=p*h-l*f;if(m<=0&&h>=0&&f<=0)return r=h/(h-f),i.copy(s).addScaledVector(ro,r);let g=u*f-p*c;if(g<=0&&c-u>=0&&p-f>=0)return rl.subVectors(o,a),r=(c-u)/(c-u+(p-f)),i.copy(a).addScaledVector(rl,r);let A=1/(g+m+d);return n=m*A,r=d*A,i.copy(s).addScaledVector(ra,n).addScaledVector(ro,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let rp={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},rf={h:0,s:0,l:0},rm={h:0,s:0,l:0};function rg(e,i,n){return(n<0&&(n+=1),n>1&&(n-=1),n<1/6)?e+(i-e)*6*n:n<.5?i:n<2/3?e+(i-e)*6*(2/3-n):e}class rA{constructor(e,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,n)}set(e,i,n){return void 0===i&&void 0===n?e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e):this.setRGB(e,i,n),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=tW){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,i1.toWorkingColorSpace(this,i),this}setRGB(e,i,n,r=i1.workingColorSpace){return this.r=e,this.g=i,this.b=n,i1.toWorkingColorSpace(this,r),this}setHSL(e,i,n,r=i1.workingColorSpace){if(e=iO(e,1),i=iN(i,0,1),n=iN(n,0,1),0===i)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+i):n+i-n*i,s=2*n-r;this.r=rg(s,r,e+1/3),this.g=rg(s,r,e),this.b=rg(s,r,e-1/3)}return i1.toWorkingColorSpace(this,r),this}setStyle(e,i=tW){let n;function r(i){void 0!==i&&1>parseFloat(i)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;let a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=n[1],s=r.length;if(3===s)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,i);if(6===s)return this.setHex(parseInt(r,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=tW){let n=rp[e.toLowerCase()];return void 0!==n?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=i2(e.r),this.g=i2(e.g),this.b=i2(e.b),this}copyLinearToSRGB(e){return this.r=i3(e.r),this.g=i3(e.g),this.b=i3(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=tW){return i1.fromWorkingColorSpace(rv.copy(this),e),65536*Math.round(iN(255*rv.r,0,255))+256*Math.round(iN(255*rv.g,0,255))+Math.round(iN(255*rv.b,0,255))}getHexString(e=tW){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=i1.workingColorSpace){let n,r;i1.fromWorkingColorSpace(rv.copy(this),i);let s=rv.r,a=rv.g,o=rv.b,l=Math.max(s,a,o),h=Math.min(s,a,o),u=(h+l)/2;if(h===l)n=0,r=0;else{let e=l-h;switch(r=u<=.5?e/(l+h):e/(2-l-h),l){case s:n=(a-o)/e+6*(a<o);break;case a:n=(o-s)/e+2;break;case o:n=(s-a)/e+4}n/=6}return e.h=n,e.s=r,e.l=u,e}getRGB(e,i=i1.workingColorSpace){return i1.fromWorkingColorSpace(rv.copy(this),i),e.r=rv.r,e.g=rv.g,e.b=rv.b,e}getStyle(e=tW){i1.fromWorkingColorSpace(rv.copy(this),e);let i=rv.r,n=rv.g,r=rv.b;return e!==tW?`color(${e} ${i.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*i)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,i,n){return this.getHSL(rf),this.setHSL(rf.h+e,rf.s+i,rf.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,n){return this.r=e.r+(i.r-e.r)*n,this.g=e.g+(i.g-e.g)*n,this.b=e.b+(i.b-e.b)*n,this}lerpHSL(e,i){this.getHSL(rf),e.getHSL(rm);let n=iU(rf.h,rm.h,i),r=iU(rf.s,rm.s,i),s=iU(rf.l,rm.l,i);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let i=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*i+s[3]*n+s[6]*r,this.g=s[1]*i+s[4]*n+s[7]*r,this.b=s[2]*i+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let rv=new rA;rA.NAMES=rp;let ry=0;class rx extends iR{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ry++}),this.uuid=iD(),this.name="",this.type="Material",this.blending=w,this.side=x,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=k,this.blendDst=F,this.blendEquation=R,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new rA(0,0,0),this.blendAlpha=0,this.depthFunc=Z,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ia,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=t1,this.stencilZFail=t1,this.stencilZPass=t1,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let i in e){let n=e[i];if(void 0===n){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}let r=this[i];if(void 0===r){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[i]=n}}toJSON(e){let i=void 0===e||"string"==typeof e;i&&(e={textures:{},images:{}});let n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){let i=[];for(let n in e){let r=e[n];delete r.metadata,i.push(r)}return i}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==w&&(n.blending=this.blending),this.side!==x&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==k&&(n.blendSrc=this.blendSrc),this.blendDst!==F&&(n.blendDst=this.blendDst),this.blendEquation!==R&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Z&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==ia&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==t1&&(n.stencilFail=this.stencilFail),this.stencilZFail!==t1&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==t1&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),i){let i=r(e.textures),s=r(e.images);i.length>0&&(n.textures=i),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let i=e.clippingPlanes,n=null;if(null!==i){let e=i.length;n=Array(e);for(let r=0;r!==e;++r)n[r]=i[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class r_ extends rx{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new rA(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nX,this.combine=en,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let rb=function(){let e=new ArrayBuffer(4),i=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){let i=e-127;i<-27?(r[e]=0,r[256|e]=32768,s[e]=24,s[256|e]=24):i<-14?(r[e]=1024>>-i-14,r[256|e]=1024>>-i-14|32768,s[e]=-i-1,s[256|e]=-i-1):i<=15?(r[e]=i+15<<10,r[256|e]=i+15<<10|32768,s[e]=13,s[256|e]=13):i<128?(r[e]=31744,r[256|e]=64512,s[e]=24,s[256|e]=24):(r[e]=31744,r[256|e]=64512,s[e]=13,s[256|e]=13)}let a=new Uint32Array(2048),o=new Uint32Array(64),l=new Uint32Array(64);for(let e=1;e<1024;++e){let i=e<<13,n=0;for(;(8388608&i)==0;)i<<=1,n-=8388608;i&=-8388609,n+=0x38800000,a[e]=i|n}for(let e=1024;e<2048;++e)a[e]=0x38000000+(e-1024<<13);for(let e=1;e<31;++e)o[e]=e<<23;o[31]=0x47800000,o[32]=0x80000000;for(let e=33;e<63;++e)o[e]=0x80000000+(e-32<<23);o[63]=0xc7800000;for(let e=1;e<64;++e)32!==e&&(l[e]=1024);return{floatView:i,uint32View:n,baseTable:r,shiftTable:s,mantissaTable:a,exponentTable:o,offsetTable:l}}();function rE(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=iN(e,-65504,65504),rb.floatView[0]=e;let i=rb.uint32View[0],n=i>>23&511;return rb.baseTable[n]+((8388607&i)>>rb.shiftTable[n])}function rw(e){let i=e>>10;return rb.uint32View[0]=rb.mantissaTable[rb.offsetTable[i]+(1023&e)]+rb.exponentTable[i],rb.floatView[0]}let rM={toHalfFloat:rE,fromHalfFloat:rw},rC=new nl,rS=new iG;class rT{constructor(e,i,n=!1){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=void 0!==e?e.length/i:0,this.normalized=n,this.usage=ig,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=eG,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return iY("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,n){e*=this.itemSize,n*=i.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=i.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let i=0,n=this.count;i<n;i++)rS.fromBufferAttribute(this,i),rS.applyMatrix3(e),this.setXY(i,rS.x,rS.y);else if(3===this.itemSize)for(let i=0,n=this.count;i<n;i++)rC.fromBufferAttribute(this,i),rC.applyMatrix3(e),this.setXYZ(i,rC.x,rC.y,rC.z);return this}applyMatrix4(e){for(let i=0,n=this.count;i<n;i++)rC.fromBufferAttribute(this,i),rC.applyMatrix4(e),this.setXYZ(i,rC.x,rC.y,rC.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)rC.fromBufferAttribute(this,i),rC.applyNormalMatrix(e),this.setXYZ(i,rC.x,rC.y,rC.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)rC.fromBufferAttribute(this,i),rC.transformDirection(e),this.setXYZ(i,rC.x,rC.y,rC.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let n=this.array[e*this.itemSize+i];return this.normalized&&(n=ik(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=iF(n,this.array)),this.array[e*this.itemSize+i]=n,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=ik(i,this.array)),i}setX(e,i){return this.normalized&&(i=iF(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=ik(i,this.array)),i}setY(e,i){return this.normalized&&(i=iF(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=ik(i,this.array)),i}setZ(e,i){return this.normalized&&(i=iF(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=ik(i,this.array)),i}setW(e,i){return this.normalized&&(i=iF(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array)),this.array[e+0]=i,this.array[e+1]=n,this}setXYZ(e,i,n,r){return e*=this.itemSize,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array),r=iF(r,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,i,n,r,s){return e*=this.itemSize,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array),r=iF(r,this.array),s=iF(s,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ig&&(e.usage=this.usage),e}}class rR extends rT{constructor(e,i,n){super(new Int8Array(e),i,n)}}class rI extends rT{constructor(e,i,n){super(new Uint8Array(e),i,n)}}class rB extends rT{constructor(e,i,n){super(new Uint8ClampedArray(e),i,n)}}class rL extends rT{constructor(e,i,n){super(new Int16Array(e),i,n)}}class rP extends rT{constructor(e,i,n){super(new Uint16Array(e),i,n)}}class rD extends rT{constructor(e,i,n){super(new Int32Array(e),i,n)}}class rN extends rT{constructor(e,i,n){super(new Uint32Array(e),i,n)}}class rO extends rT{constructor(e,i,n){super(new Uint16Array(e),i,n),this.isFloat16BufferAttribute=!0}getX(e){let i=rw(this.array[e*this.itemSize]);return this.normalized&&(i=ik(i,this.array)),i}setX(e,i){return this.normalized&&(i=iF(i,this.array)),this.array[e*this.itemSize]=rE(i),this}getY(e){let i=rw(this.array[e*this.itemSize+1]);return this.normalized&&(i=ik(i,this.array)),i}setY(e,i){return this.normalized&&(i=iF(i,this.array)),this.array[e*this.itemSize+1]=rE(i),this}getZ(e){let i=rw(this.array[e*this.itemSize+2]);return this.normalized&&(i=ik(i,this.array)),i}setZ(e,i){return this.normalized&&(i=iF(i,this.array)),this.array[e*this.itemSize+2]=rE(i),this}getW(e){let i=rw(this.array[e*this.itemSize+3]);return this.normalized&&(i=ik(i,this.array)),i}setW(e,i){return this.normalized&&(i=iF(i,this.array)),this.array[e*this.itemSize+3]=rE(i),this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array)),this.array[e+0]=rE(i),this.array[e+1]=rE(n),this}setXYZ(e,i,n,r){return e*=this.itemSize,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array),r=iF(r,this.array)),this.array[e+0]=rE(i),this.array[e+1]=rE(n),this.array[e+2]=rE(r),this}setXYZW(e,i,n,r,s){return e*=this.itemSize,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array),r=iF(r,this.array),s=iF(s,this.array)),this.array[e+0]=rE(i),this.array[e+1]=rE(n),this.array[e+2]=rE(r),this.array[e+3]=rE(s),this}}class rU extends rT{constructor(e,i,n){super(new Float32Array(e),i,n)}}let rk=0,rF=new nk,rz=new rt,rG=new nl,rV=new nc,rj=new nc,rH=new nl;class rQ extends iR{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:rk++}),this.uuid=iD(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(iH(e)?rN:rP)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){let i=this.attributes.position;void 0!==i&&(i.applyMatrix4(e),i.needsUpdate=!0);let n=this.attributes.normal;if(void 0!==n){let i=new iV().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}let r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return rF.makeRotationFromQuaternion(e),this.applyMatrix4(rF),this}rotateX(e){return rF.makeRotationX(e),this.applyMatrix4(rF),this}rotateY(e){return rF.makeRotationY(e),this.applyMatrix4(rF),this}rotateZ(e){return rF.makeRotationZ(e),this.applyMatrix4(rF),this}translate(e,i,n){return rF.makeTranslation(e,i,n),this.applyMatrix4(rF),this}scale(e,i,n){return rF.makeScale(e,i,n),this.applyMatrix4(rF),this}lookAt(e){return rz.lookAt(e),rz.updateMatrix(),this.applyMatrix4(rz.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(rG).negate(),this.translate(rG.x,rG.y,rG.z),this}setFromPoints(e){let i=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new rU(i,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nc);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new nl(-1/0,-1/0,-1/0),new nl(Infinity,Infinity,Infinity));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),i)for(let e=0,n=i.length;e<n;e++){let n=i[e];rV.setFromBufferAttribute(n),this.morphTargetsRelative?(rH.addVectors(this.boundingBox.min,rV.min),this.boundingBox.expandByPoint(rH),rH.addVectors(this.boundingBox.max,rV.max),this.boundingBox.expandByPoint(rH)):(this.boundingBox.expandByPoint(rV.min),this.boundingBox.expandByPoint(rV.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new nR);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new nl,1/0);return}if(e){let n=this.boundingSphere.center;if(rV.setFromBufferAttribute(e),i)for(let e=0,n=i.length;e<n;e++){let n=i[e];rj.setFromBufferAttribute(n),this.morphTargetsRelative?(rH.addVectors(rV.min,rj.min),rV.expandByPoint(rH),rH.addVectors(rV.max,rj.max),rV.expandByPoint(rH)):(rV.expandByPoint(rj.min),rV.expandByPoint(rj.max))}rV.getCenter(n);let r=0;for(let i=0,s=e.count;i<s;i++)rH.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(rH));if(i)for(let s=0,a=i.length;s<a;s++){let a=i[s],o=this.morphTargetsRelative;for(let i=0,s=a.count;i<s;i++)rH.fromBufferAttribute(a,i),o&&(rG.fromBufferAttribute(e,i),rH.add(rG)),r=Math.max(r,n.distanceToSquared(rH))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,i=this.attributes;if(null===e||void 0===i.position||void 0===i.normal||void 0===i.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=i.position,r=i.normal,s=i.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new rT(new Float32Array(4*n.count),4));let a=this.getAttribute("tangent"),o=[],l=[];for(let e=0;e<n.count;e++)o[e]=new nl,l[e]=new nl;let h=new nl,u=new nl,c=new nl,d=new iG,p=new iG,f=new iG,m=new nl,g=new nl,A=this.groups;0===A.length&&(A=[{start:0,count:e.count}]);for(let i=0,r=A.length;i<r;++i){let r=A[i],a=r.start,v=r.count;for(let i=a,r=a+v;i<r;i+=3)!function(e,i,r){h.fromBufferAttribute(n,e),u.fromBufferAttribute(n,i),c.fromBufferAttribute(n,r),d.fromBufferAttribute(s,e),p.fromBufferAttribute(s,i),f.fromBufferAttribute(s,r),u.sub(h),c.sub(h),p.sub(d),f.sub(d);let a=1/(p.x*f.y-f.x*p.y);isFinite(a)&&(m.copy(u).multiplyScalar(f.y).addScaledVector(c,-p.y).multiplyScalar(a),g.copy(c).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(a),o[e].add(m),o[i].add(m),o[r].add(m),l[e].add(g),l[i].add(g),l[r].add(g))}(e.getX(i+0),e.getX(i+1),e.getX(i+2))}let v=new nl,y=new nl,x=new nl,_=new nl;function b(e){x.fromBufferAttribute(r,e),_.copy(x);let i=o[e];v.copy(i),v.sub(x.multiplyScalar(x.dot(i))).normalize(),y.crossVectors(_,i);let n=y.dot(l[e]);a.setXYZW(e,v.x,v.y,v.z,n<0?-1:1)}for(let i=0,n=A.length;i<n;++i){let n=A[i],r=n.start,s=n.count;for(let i=r,n=r+s;i<n;i+=3)b(e.getX(i+0)),b(e.getX(i+1)),b(e.getX(i+2))}}computeVertexNormals(){let e=this.index,i=this.getAttribute("position");if(void 0!==i){let n=this.getAttribute("normal");if(void 0===n)n=new rT(new Float32Array(3*i.count),3),this.setAttribute("normal",n);else for(let e=0,i=n.count;e<i;e++)n.setXYZ(e,0,0,0);let r=new nl,s=new nl,a=new nl,o=new nl,l=new nl,h=new nl,u=new nl,c=new nl;if(e)for(let d=0,p=e.count;d<p;d+=3){let p=e.getX(d+0),f=e.getX(d+1),m=e.getX(d+2);r.fromBufferAttribute(i,p),s.fromBufferAttribute(i,f),a.fromBufferAttribute(i,m),u.subVectors(a,s),c.subVectors(r,s),u.cross(c),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),h.fromBufferAttribute(n,m),o.add(u),l.add(u),h.add(u),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z),n.setXYZ(m,h.x,h.y,h.z)}else for(let e=0,o=i.count;e<o;e+=3)r.fromBufferAttribute(i,e+0),s.fromBufferAttribute(i,e+1),a.fromBufferAttribute(i,e+2),u.subVectors(a,s),c.subVectors(r,s),u.cross(c),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)rH.fromBufferAttribute(e,i),rH.normalize(),e.setXYZ(i,rH.x,rH.y,rH.z)}toNonIndexed(){function e(e,i){let n=e.array,r=e.itemSize,s=e.normalized,a=new n.constructor(i.length*r),o=0,l=0;for(let s=0,h=i.length;s<h;s++){o=e.isInterleavedBufferAttribute?i[s]*e.data.stride+e.offset:i[s]*r;for(let e=0;e<r;e++)a[l++]=n[o++]}return new rT(a,r,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let i=new rQ,n=this.index.array,r=this.attributes;for(let s in r){let a=e(r[s],n);i.setAttribute(s,a)}let s=this.morphAttributes;for(let r in s){let a=[],o=s[r];for(let i=0,r=o.length;i<r;i++){let r=e(o[i],n);a.push(r)}i.morphAttributes[r]=a}i.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let e=0,n=a.length;e<n;e++){let n=a[e];i.addGroup(n.start,n.count,n.materialIndex)}return i}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let i=this.parameters;for(let n in i)void 0!==i[n]&&(e[n]=i[n]);return e}e.data={attributes:{}};let i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});let n=this.attributes;for(let i in n){let r=n[i];e.data.attributes[i]=r.toJSON(e.data)}let r={},s=!1;for(let i in this.morphAttributes){let n=this.morphAttributes[i],a=[];for(let i=0,r=n.length;i<r;i++){let r=n[i];a.push(r.toJSON(e.data))}a.length>0&&(r[i]=a,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let i={};this.name=e.name;let n=e.index;null!==n&&this.setIndex(n.clone(i));let r=e.attributes;for(let e in r){let n=r[e];this.setAttribute(e,n.clone(i))}let s=e.morphAttributes;for(let e in s){let n=[],r=s[e];for(let e=0,s=r.length;e<s;e++)n.push(r[e].clone(i));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let e=0,i=a.length;e<i;e++){let i=a[e];this.addGroup(i.start,i.count,i.materialIndex)}let o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());let l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let rW=new nk,rq=new nU,rX=new nR,rK=new nl,rY=new nl,rJ=new nl,rZ=new nl,r$=new nl,r0=new nl,r1=new iG,r2=new iG,r3=new iG,r4=new nl,r5=new nl,r6=new nl,r8=new nl,r7=new nl;class r9 extends rt{constructor(e=new rQ,i=new r_){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++){let i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}getVertexPosition(e,i){let n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;i.fromBufferAttribute(r,e);let o=this.morphTargetInfluences;if(s&&o){r0.set(0,0,0);for(let n=0,r=s.length;n<r;n++){let r=o[n],l=s[n];0!==r&&(r$.fromBufferAttribute(l,e),a?r0.addScaledVector(r$,r):r0.addScaledVector(r$.sub(i),r))}i.add(r0)}return i}raycast(e,i){let n=this.geometry,r=this.material,s=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),rX.copy(n.boundingSphere),rX.applyMatrix4(s),rq.copy(e.ray).recast(e.near),!1===rX.containsPoint(rq.origin)&&(null===rq.intersectSphere(rX,rK)||rq.origin.distanceToSquared(rK)>(e.far-e.near)**2)||(rW.copy(s).invert(),rq.copy(e.ray).applyMatrix4(rW),null!==n.boundingBox&&!1===rq.intersectsBox(n.boundingBox)))return;this._computeIntersections(e,i,rq)}}_computeIntersections(e,i,n){let r;let s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,h=s.attributes.uv,u=s.attributes.uv1,c=s.attributes.normal,d=s.groups,p=s.drawRange;if(null!==o){if(Array.isArray(a))for(let s=0,l=d.length;s<l;s++){let l=d[s],f=a[l.materialIndex],m=Math.max(l.start,p.start),g=Math.min(o.count,Math.min(l.start+l.count,p.start+p.count));for(let s=m;s<g;s+=3){let a=o.getX(s);(r=se(this,f,e,n,h,u,c,a,o.getX(s+1),o.getX(s+2)))&&(r.faceIndex=Math.floor(s/3),r.face.materialIndex=l.materialIndex,i.push(r))}}else{let s=Math.max(0,p.start),l=Math.min(o.count,p.start+p.count);for(let d=s;d<l;d+=3){let s=o.getX(d);(r=se(this,a,e,n,h,u,c,s,o.getX(d+1),o.getX(d+2)))&&(r.faceIndex=Math.floor(d/3),i.push(r))}}}else if(void 0!==l){if(Array.isArray(a))for(let s=0,o=d.length;s<o;s++){let o=d[s],f=a[o.materialIndex],m=Math.max(o.start,p.start),g=Math.min(l.count,Math.min(o.start+o.count,p.start+p.count));for(let s=m;s<g;s+=3)(r=se(this,f,e,n,h,u,c,s,s+1,s+2))&&(r.faceIndex=Math.floor(s/3),r.face.materialIndex=o.materialIndex,i.push(r))}else{let s=Math.max(0,p.start),o=Math.min(l.count,p.start+p.count);for(let l=s;l<o;l+=3)(r=se(this,a,e,n,h,u,c,l,l+1,l+2))&&(r.faceIndex=Math.floor(l/3),i.push(r))}}}}function se(e,i,n,r,s,a,o,l,h,u){e.getVertexPosition(l,rY),e.getVertexPosition(h,rJ),e.getVertexPosition(u,rZ);let c=function(e,i,n,r,s,a,o,l){let h;if(null===(i.side===_?r.intersectTriangle(o,a,s,!0,l):r.intersectTriangle(s,a,o,i.side===x,l)))return null;r7.copy(l),r7.applyMatrix4(e.matrixWorld);let u=n.ray.origin.distanceTo(r7);return u<n.near||u>n.far?null:{distance:u,point:r7.clone(),object:e}}(e,i,n,r,rY,rJ,rZ,r8);if(c){s&&(r1.fromBufferAttribute(s,l),r2.fromBufferAttribute(s,h),r3.fromBufferAttribute(s,u),c.uv=rd.getInterpolation(r8,rY,rJ,rZ,r1,r2,r3,new iG)),a&&(r1.fromBufferAttribute(a,l),r2.fromBufferAttribute(a,h),r3.fromBufferAttribute(a,u),c.uv1=rd.getInterpolation(r8,rY,rJ,rZ,r1,r2,r3,new iG)),o&&(r4.fromBufferAttribute(o,l),r5.fromBufferAttribute(o,h),r6.fromBufferAttribute(o,u),c.normal=rd.getInterpolation(r8,rY,rJ,rZ,r4,r5,r6,new nl),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));let e={a:l,b:h,c:u,normal:new nl,materialIndex:0};rd.getNormal(rY,rJ,rZ,e.normal),c.face=e}return c}class st extends rQ{constructor(e=1,i=1,n=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:a};let o=this;r=Math.floor(r),s=Math.floor(s);let l=[],h=[],u=[],c=[],d=0,p=0;function f(e,i,n,r,s,a,f,m,g,A,v){let y=a/g,x=f/A,_=a/2,b=f/2,E=m/2,w=g+1,M=A+1,C=0,S=0,T=new nl;for(let a=0;a<M;a++){let o=a*x-b;for(let l=0;l<w;l++){let d=l*y-_;T[e]=d*r,T[i]=o*s,T[n]=E,h.push(T.x,T.y,T.z),T[e]=0,T[i]=0,T[n]=m>0?1:-1,u.push(T.x,T.y,T.z),c.push(l/g),c.push(1-a/A),C+=1}}for(let e=0;e<A;e++)for(let i=0;i<g;i++){let n=d+i+w*e,r=d+i+w*(e+1),s=d+(i+1)+w*(e+1),a=d+(i+1)+w*e;l.push(n,r,a),l.push(r,s,a),S+=6}o.addGroup(p,S,v),p+=S,d+=C}f("z","y","x",-1,-1,n,i,e,a=Math.floor(a),s,0),f("z","y","x",1,-1,n,i,-e,a,s,1),f("x","z","y",1,1,e,n,i,r,a,2),f("x","z","y",1,-1,e,n,-i,r,a,3),f("x","y","z",1,-1,e,i,n,r,s,4),f("x","y","z",-1,-1,e,i,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new rU(h,3)),this.setAttribute("normal",new rU(u,3)),this.setAttribute("uv",new rU(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new st(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function si(e){let i={};for(let n in e)for(let r in i[n]={},e[n]){let s=e[n][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),i[n][r]=null):i[n][r]=s.clone():Array.isArray(s)?i[n][r]=s.slice():i[n][r]=s}return i}function sn(e){let i={};for(let n=0;n<e.length;n++){let r=si(e[n]);for(let e in r)i[e]=r[e]}return i}function sr(e){let i=e.getRenderTarget();return null===i?e.outputColorSpace:!0===i.isXRRenderTarget?i.texture.colorSpace:i1.workingColorSpace}let ss={clone:si,merge:sn};class sa extends rx{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=si(e.uniforms),this.uniformsGroups=function(e){let i=[];for(let n=0;n<e.length;n++)i.push(e[n].clone());return i}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let i=super.toJSON(e);for(let n in i.glslVersion=this.glslVersion,i.uniforms={},this.uniforms){let r=this.uniforms[n].value;r&&r.isTexture?i.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?i.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?i.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?i.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?i.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?i.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?i.uniforms[n]={type:"m4",value:r.toArray()}:i.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;let n={};for(let e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class so extends rt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new nk,this.projectionMatrix=new nk,this.projectionMatrixInverse=new nk,this.coordinateSystem=iS}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let sl=new nl,sh=new iG,su=new iG;class sc extends so{constructor(e=50,i=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let i=.5*this.getFilmHeight()/e;this.fov=2*iP*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*iL*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*iP*Math.atan(Math.tan(.5*iL*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,n){sl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(sl.x,sl.y).multiplyScalar(-e/sl.z),sl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(sl.x,sl.y).multiplyScalar(-e/sl.z)}getViewSize(e,i){return this.getViewBounds(e,sh,su),i.subVectors(su,sh)}setViewOffset(e,i,n,r,s,a){this.aspect=e/i,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,i=e*Math.tan(.5*iL*this.fov)/this.zoom,n=2*i,r=this.aspect*n,s=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,o=a.fullHeight;s+=a.offsetX*r/e,i-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}let o=this.filmOffset;0!==o&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,i,i-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,null!==this.view&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}class sd extends rt{constructor(e,i,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;let r=new sc(-90,1,e,i);r.layers=this.layers,this.add(r);let s=new sc(-90,1,e,i);s.layers=this.layers,this.add(s);let a=new sc(-90,1,e,i);a.layers=this.layers,this.add(a);let o=new sc(-90,1,e,i);o.layers=this.layers,this.add(o);let l=new sc(-90,1,e,i);l.layers=this.layers,this.add(l);let h=new sc(-90,1,e,i);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){let e=this.coordinateSystem,i=this.children.concat(),[n,r,s,a,o,l]=i;for(let e of i)this.remove(e);if(e===iS)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===iT)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(let e of i)this.add(e),e.updateMatrixWorld()}update(e,i){null===this.parent&&this.updateMatrixWorld();let{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[s,a,o,l,h,u]=this.children,c=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;let m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(i,s),e.setRenderTarget(n,1,r),e.render(i,a),e.setRenderTarget(n,2,r),e.render(i,o),e.setRenderTarget(n,3,r),e.render(i,l),e.setRenderTarget(n,4,r),e.render(i,h),n.texture.generateMipmaps=m,e.setRenderTarget(n,5,r),e.render(i,u),e.setRenderTarget(c,d,p),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class sp extends i9{constructor(e,i,n,r,s,a,o,l,h,u){super(e=void 0!==e?e:[],i=void 0!==i?i:eA,n,r,s,a,o,l,h,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class sf extends ni{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;let n={width:e,height:e,depth:1};this.texture=new sp([n,n,n,n,n,n],i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:eI}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new st(5,5,5),s=new sa({name:"CubemapFromEquirect",uniforms:si(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:_,blending:E});s.uniforms.tEquirect.value=i;let a=new r9(r,s),o=i.minFilter;return i.minFilter===eP&&(i.minFilter=eI),new sd(1,10,this).update(e,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,n,r){let s=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(i,n,r);e.setRenderTarget(s)}}let sm=new nl,sg=new nl,sA=new iV;class sv{constructor(e=new nl(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,n,r){return this.normal.set(e,i,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,n){let r=sm.subVectors(n,i).cross(sg.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){let n=e.delta(sm),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?i.copy(e.start):null;let s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:i.copy(e.start).addScaledVector(n,s)}intersectsLine(e){let i=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return i<0&&n>0||n<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){let n=i||sA.getNormalMatrix(e),r=this.coplanarPoint(sm).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}let sy=new nR,sx=new nl;class s_{constructor(e=new sv,i=new sv,n=new sv,r=new sv,s=new sv,a=new sv){this.planes=[e,i,n,r,s,a]}set(e,i,n,r,s,a){let o=this.planes;return o[0].copy(e),o[1].copy(i),o[2].copy(n),o[3].copy(r),o[4].copy(s),o[5].copy(a),this}copy(e){let i=this.planes;for(let n=0;n<6;n++)i[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,i=iS){let n=this.planes,r=e.elements,s=r[0],a=r[1],o=r[2],l=r[3],h=r[4],u=r[5],c=r[6],d=r[7],p=r[8],f=r[9],m=r[10],g=r[11],A=r[12],v=r[13],y=r[14],x=r[15];if(n[0].setComponents(l-s,d-h,g-p,x-A).normalize(),n[1].setComponents(l+s,d+h,g+p,x+A).normalize(),n[2].setComponents(l+a,d+u,g+f,x+v).normalize(),n[3].setComponents(l-a,d-u,g-f,x-v).normalize(),n[4].setComponents(l-o,d-c,g-m,x-y).normalize(),i===iS)n[5].setComponents(l+o,d+c,g+m,x+y).normalize();else if(i===iT)n[5].setComponents(o,c,m,y).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),sy.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let i=e.geometry;null===i.boundingSphere&&i.computeBoundingSphere(),sy.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(sy)}intersectsSprite(e){return sy.center.set(0,0,0),sy.radius=.7071067811865476,sy.applyMatrix4(e.matrixWorld),this.intersectsSphere(sy)}intersectsSphere(e){let i=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(i[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){let i=this.planes;for(let n=0;n<6;n++){let r=i[n];if(sx.x=r.normal.x>0?e.max.x:e.min.x,sx.y=r.normal.y>0?e.max.y:e.min.y,sx.z=r.normal.z>0?e.max.z:e.min.z,0>r.distanceToPoint(sx))return!1}return!0}containsPoint(e){let i=this.planes;for(let n=0;n<6;n++)if(0>i[n].distanceToPoint(e))return!1;return!0}clone(){return new this.constructor().copy(this)}}function sb(){let e=null,i=!1,n=null,r=null;function s(i,a){n(i,a),r=e.requestAnimationFrame(s)}return{start:function(){!0!==i&&null!==n&&(r=e.requestAnimationFrame(s),i=!0)},stop:function(){e.cancelAnimationFrame(r),i=!1},setAnimationLoop:function(e){n=e},setContext:function(i){e=i}}}function sE(e){let i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);let r=i.get(n);r&&(e.deleteBuffer(r.buffer),i.delete(n))},update:function(n,r){if(n.isGLBufferAttribute){let e=i.get(n);(!e||e.version<n.version)&&i.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version});return}n.isInterleavedBufferAttribute&&(n=n.data);let s=i.get(n);if(void 0===s)i.set(n,function(i,n){let r;let s=i.array,a=i.usage,o=s.byteLength,l=e.createBuffer();if(e.bindBuffer(n,l),e.bufferData(n,s,a),i.onUploadCallback(),s instanceof Float32Array)r=e.FLOAT;else if(s instanceof Uint16Array)r=i.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(s instanceof Int16Array)r=e.SHORT;else if(s instanceof Uint32Array)r=e.UNSIGNED_INT;else if(s instanceof Int32Array)r=e.INT;else if(s instanceof Int8Array)r=e.BYTE;else if(s instanceof Uint8Array)r=e.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)r=e.UNSIGNED_BYTE;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);return{buffer:l,type:r,bytesPerElement:s.BYTES_PER_ELEMENT,version:i.version,size:o}}(n,r));else if(s.version<n.version){if(s.size!==n.array.byteLength)throw Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(i,n,r){let s=n.array,a=n._updateRange,o=n.updateRanges;if(e.bindBuffer(r,i),-1===a.count&&0===o.length&&e.bufferSubData(r,0,s),0!==o.length){for(let i=0,n=o.length;i<n;i++){let n=o[i];e.bufferSubData(r,n.start*s.BYTES_PER_ELEMENT,s,n.start,n.count)}n.clearUpdateRanges()}-1!==a.count&&(e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count),a.count=-1),n.onUploadCallback()})(s.buffer,n,r),s.version=n.version}}}}class sw extends rQ{constructor(e=1,i=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:n,heightSegments:r};let s=e/2,a=i/2,o=Math.floor(n),l=Math.floor(r),h=o+1,u=l+1,c=e/o,d=i/l,p=[],f=[],m=[],g=[];for(let e=0;e<u;e++){let i=e*d-a;for(let n=0;n<h;n++){let r=n*c-s;f.push(r,-i,0),m.push(0,0,1),g.push(n/o),g.push(1-e/l)}}for(let e=0;e<l;e++)for(let i=0;i<o;i++){let n=i+h*e,r=i+h*(e+1),s=i+1+h*(e+1),a=i+1+h*e;p.push(n,r,a),p.push(r,s,a)}this.setIndex(p),this.setAttribute("position",new rU(f,3)),this.setAttribute("normal",new rU(m,3)),this.setAttribute("uv",new rU(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sw(e.width,e.height,e.widthSegments,e.heightSegments)}}let sM={alphahash_fragment:"#ifdef USE_ALPHAHASH\n	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n	const float ALPHA_HASH_SCALE = 0.05;\n	float hash2D( vec2 value ) {\n		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n	}\n	float hash3D( vec3 value ) {\n		return hash2D( vec2( hash2D( value.xy ), value.z ) );\n	}\n	float getAlphaHashThreshold( vec3 position ) {\n		float maxDeriv = max(\n			length( dFdx( position.xyz ) ),\n			length( dFdy( position.xyz ) )\n		);\n		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n		vec2 pixScales = vec2(\n			exp2( floor( log2( pixScale ) ) ),\n			exp2( ceil( log2( pixScale ) ) )\n		);\n		vec2 alpha = vec2(\n			hash3D( floor( pixScales.x * position.xyz ) ),\n			hash3D( floor( pixScales.y * position.xyz ) )\n		);\n		float lerpFactor = fract( log2( pixScale ) );\n		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n		float a = min( lerpFactor, 1.0 - lerpFactor );\n		vec3 cases = vec3(\n			x * x / ( 2.0 * a * ( 1.0 - a ) ),\n			( x - 0.5 * a ) / ( 1.0 - a ),\n			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n		);\n		float threshold = ( x < ( 1.0 - a ) )\n			? ( ( x < a ) ? cases.x : cases.y )\n			: cases.z;\n		return clamp( threshold , 1.0e-6, 1.0 );\n	}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n	#ifdef ALPHA_TO_COVERAGE\n	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n	if ( diffuseColor.a == 0.0 ) discard;\n	#else\n	if ( diffuseColor.a < alphaTest ) discard;\n	#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_CLEARCOAT ) \n		clearcoatSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_SHEEN ) \n		sheenSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n	attribute float batchId;\n	uniform highp sampler2D batchingTexture;\n	mat4 getBatchingMatrix( const in float i ) {\n		int size = textureSize( batchingTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n	mat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n	vPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n	const mat3 XYZ_TO_REC709 = mat3(\n		 3.2404542, -0.9692660,  0.0556434,\n		-1.5371385,  1.8760108, -0.2040259,\n		-0.4985314,  0.0415560,  1.0572252\n	);\n	vec3 Fresnel0ToIor( vec3 fresnel0 ) {\n		vec3 sqrtF0 = sqrt( fresnel0 );\n		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n	}\n	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n	}\n	float IorToFresnel0( float transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n	}\n	vec3 evalSensitivity( float OPD, vec3 shift ) {\n		float phase = 2.0 * PI * OPD * 1.0e-9;\n		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n		xyz /= 1.0685e-7;\n		vec3 rgb = XYZ_TO_REC709 * xyz;\n		return rgb;\n	}\n	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n		vec3 I;\n		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n		float cosTheta2Sq = 1.0 - sinTheta2Sq;\n		if ( cosTheta2Sq < 0.0 ) {\n			return vec3( 1.0 );\n		}\n		float cosTheta2 = sqrt( cosTheta2Sq );\n		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n		float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n		float T121 = 1.0 - R12;\n		float phi12 = 0.0;\n		if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n		float phi21 = PI - phi12;\n		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n		vec3 phi23 = vec3( 0.0 );\n		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n		vec3 phi = vec3( phi21 ) + phi23;\n		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n		vec3 r123 = sqrt( R123 );\n		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n		vec3 C0 = R12 + Rs;\n		I = C0;\n		vec3 Cm = Rs - T121;\n		for ( int m = 1; m <= 2; ++ m ) {\n			Cm *= r123;\n			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n			I += Cm * Sm;\n		}\n		return max( I, vec3( 0.0 ) );\n	}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vBumpMapUv );\n		vec2 dSTdy = dFdy( vBumpMapUv );\n		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#ifdef ALPHA_TO_COVERAGE\n		float distanceToPlane, distanceGradient;\n		float clipOpacity = 1.0;\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n			distanceGradient = fwidth( distanceToPlane ) / 2.0;\n			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			if ( clipOpacity == 0.0 ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			float unionClipOpacity = 1.0;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n				distanceGradient = fwidth( distanceToPlane ) / 2.0;\n				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			}\n			#pragma unroll_loop_end\n			clipOpacity *= 1.0 - unionClipOpacity;\n		#endif\n		diffuseColor.a *= clipOpacity;\n		if ( diffuseColor.a == 0.0 ) discard;\n	#else\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			bool clipped = true;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n			}\n			#pragma unroll_loop_end\n			if ( clipped ) discard;\n		#endif\n	#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	varying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n	varying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n	return dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		uv.x += filterInt * 3.0 * cubeUV_minTileSize;\n		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n		uv.x *= CUBEUV_TEXEL_WIDTH;\n		uv.y *= CUBEUV_TEXEL_HEIGHT;\n		#ifdef texture2DGradEXT\n			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n		#else\n			return texture2D( envMap, uv ).rgb;\n		#endif\n	}\n	#define cubeUV_r0 1.0\n	#define cubeUV_m0 - 2.0\n	#define cubeUV_r1 0.8\n	#define cubeUV_m1 - 1.0\n	#define cubeUV_r4 0.4\n	#define cubeUV_m4 2.0\n	#define cubeUV_r5 0.305\n	#define cubeUV_m5 3.0\n	#define cubeUV_r6 0.21\n	#define cubeUV_m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= cubeUV_r1 ) {\n			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n		} else if ( roughness >= cubeUV_r4 ) {\n			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n		} else if ( roughness >= cubeUV_r5 ) {\n			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n		} else if ( roughness >= cubeUV_r6 ) {\n			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n	vec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n	mat3 bm = mat3( batchingMatrix );\n	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n	transformedNormal = bm * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = bm * transformedTangent;\n	#endif\n#endif\n#ifdef USE_INSTANCING\n	mat3 im = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n	transformedNormal = im * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = im * transformedTangent;\n	#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n	vec3( 0.8224621, 0.177538, 0.0 ),\n	vec3( 0.0331941, 0.9668058, 0.0 ),\n	vec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n	vec3( 1.2249401, - 0.2249404, 0.0 ),\n	vec3( - 0.0420569, 1.0420571, 0.0 ),\n	vec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n	return value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n	return value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n	return sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	uniform mat3 envMapRotation;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n	vec3 getIBLIrradiance( const in vec3 normal ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 reflectVec = reflect( - viewDir, normal );\n			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	#ifdef USE_ANISOTROPY\n		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n			#ifdef ENVMAP_TYPE_CUBE_UV\n				vec3 bentNormal = cross( bitangent, viewDir );\n				bentNormal = normalize( cross( bentNormal, bitangent ) );\n				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n				return getIBLRadiance( viewDir, bentNormal, roughness );\n			#else\n				return vec3( 0.0 );\n			#endif\n		}\n	#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return vec3( texture2D( gradientMap, coord ).r );\n	#else\n		vec2 fw = fwidth( coord ) * 0.5;\n		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n	#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n	vec3 diffuseColor;\n	float specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Lambert\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n	uniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	#if defined ( LEGACY_LIGHTS )\n		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n		}\n		return 1.0;\n	#else\n		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n		if ( cutoffDistance > 0.0 ) {\n			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n		}\n		return distanceFalloff;\n	#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n		float dotNL = dot( normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	material.ior = ior;\n	#ifdef USE_SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularColorFactor = specularColor;\n		#ifdef USE_SPECULAR_COLORMAP\n			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n		#endif\n		#ifdef USE_SPECULAR_INTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularColorFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n	material.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	material.iridescence = iridescence;\n	material.iridescenceIOR = iridescenceIOR;\n	#ifdef USE_IRIDESCENCEMAP\n		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n	#endif\n	#ifdef USE_IRIDESCENCE_THICKNESSMAP\n		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n	#else\n		material.iridescenceThickness = iridescenceThicknessMaximum;\n	#endif\n#endif\n#ifdef USE_SHEEN\n	material.sheenColor = sheenColor;\n	#ifdef USE_SHEEN_COLORMAP\n		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n	#endif\n	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	#ifdef USE_ANISOTROPYMAP\n		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n	#else\n		vec2 anisotropyV = anisotropyVector;\n	#endif\n	material.anisotropy = length( anisotropyV );\n	if( material.anisotropy == 0.0 ) {\n		anisotropyV = vec2( 1.0, 0.0 );\n	} else {\n		anisotropyV /= material.anisotropy;\n		material.anisotropy = saturate( material.anisotropy );\n	}\n	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	float dispersion;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_IRIDESCENCE\n		float iridescence;\n		float iridescenceIOR;\n		float iridescenceThickness;\n		vec3 iridescenceFresnel;\n		vec3 iridescenceF0;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenColor;\n		float sheenRoughness;\n	#endif\n	#ifdef IOR\n		float ior;\n	#endif\n	#ifdef USE_TRANSMISSION\n		float transmission;\n		float transmissionAlpha;\n		float thickness;\n		float attenuationDistance;\n		vec3 attenuationColor;\n	#endif\n	#ifdef USE_ANISOTROPY\n		float anisotropy;\n		float alphaT;\n		vec3 anisotropyT;\n		vec3 anisotropyB;\n	#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n		float v = 0.5 / ( gv + gl );\n		return saturate(v);\n	}\n	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n		float a2 = alphaT * alphaB;\n		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n		highp float v2 = dot( v, v );\n		float w2 = a2 / v2;\n		return RECIPROCAL_PI * a2 * pow2 ( w2 );\n	}\n#endif\n#ifdef USE_CLEARCOAT\n	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n		vec3 f0 = material.clearcoatF0;\n		float f90 = material.clearcoatF90;\n		float roughness = material.clearcoatRoughness;\n		float alpha = pow2( roughness );\n		vec3 halfDir = normalize( lightDir + viewDir );\n		float dotNL = saturate( dot( normal, lightDir ) );\n		float dotNV = saturate( dot( normal, viewDir ) );\n		float dotNH = saturate( dot( normal, halfDir ) );\n		float dotVH = saturate( dot( viewDir, halfDir ) );\n		vec3 F = F_Schlick( f0, f90, dotVH );\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n		return F * ( V * D );\n	}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n	vec3 f0 = material.specularColor;\n	float f90 = material.specularF90;\n	float roughness = material.roughness;\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	#ifdef USE_IRIDESCENCE\n		F = mix( F, material.iridescenceFresnel, material.iridescence );\n	#endif\n	#ifdef USE_ANISOTROPY\n		float dotTL = dot( material.anisotropyT, lightDir );\n		float dotTV = dot( material.anisotropyT, viewDir );\n		float dotTH = dot( material.anisotropyT, halfDir );\n		float dotBL = dot( material.anisotropyB, lightDir );\n		float dotBV = dot( material.anisotropyB, viewDir );\n		float dotBH = dot( material.anisotropyB, halfDir );\n		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n	#else\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n	#endif\n	return F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n	float alpha = pow2( roughness );\n	float invAlpha = 1.0 / alpha;\n	float cos2h = dotNH * dotNH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float D = D_Charlie( sheenRoughness, dotNH );\n	float V = V_Neubelt( dotNV, dotNL );\n	return sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float r2 = roughness * roughness;\n	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n	return saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	#ifdef USE_IRIDESCENCE\n		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n	#else\n		vec3 Fr = specularColor;\n	#endif\n	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometryNormal;\n		vec3 viewDir = geometryViewDir;\n		vec3 position = geometryPosition;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n	#endif\n	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	#ifdef USE_IRIDESCENCE\n		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n	#else\n		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	#endif\n	vec3 totalScattering = singleScattering + multiScattering;\n	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n	geometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n	float dotNVi = saturate( dot( normal, geometryViewDir ) );\n	if ( material.iridescenceThickness == 0.0 ) {\n		material.iridescence = 0.0;\n	} else {\n		material.iridescence = saturate( material.iridescence );\n	}\n	if ( material.iridescence > 0.0 ) {\n		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n	}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometryPosition, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	vec4 spotColor;\n	vec3 spotLightCoord;\n	bool inSpotLightMap;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometryPosition, directLight );\n		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n		#else\n		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#endif\n		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n		#endif\n		#undef SPOT_LIGHT_MAP_INDEX\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	#if defined( USE_LIGHT_PROBES )\n		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n	#endif\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometryNormal );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	#ifdef USE_ANISOTROPY\n		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n	#else\n		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n	#endif\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	vFragDepth = 1.0 + gl_Position.w;\n	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 sampledDiffuseColor = texture2D( map, vMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n	\n	#endif\n	diffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	#if defined( USE_POINTS_UV )\n		vec2 uv = vUv;\n	#else\n		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n	#endif\n#endif\n#ifdef USE_MAP\n	diffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n	varying vec2 vUv;\n#else\n	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n		uniform mat3 uvTransform;\n	#endif\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n	float morphTargetInfluences[MORPHTARGETS_COUNT];\n	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n	}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n	vColor *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		#if defined( USE_COLOR_ALPHA )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n		#elif defined( USE_COLOR )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n		#endif\n	}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n		}\n	#else\n		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n	#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	#ifndef USE_INSTANCING_MORPH\n		uniform float morphTargetBaseInfluence;\n	#endif\n	#ifdef MORPHTARGETS_TEXTURE\n		#ifndef USE_INSTANCING_MORPH\n			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n		#endif\n		uniform sampler2DArray morphTargetsTexture;\n		uniform ivec2 morphTargetsTextureSize;\n		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n			int y = texelIndex / morphTargetsTextureSize.x;\n			int x = texelIndex - y * morphTargetsTextureSize.x;\n			ivec3 morphUV = ivec3( x, y, morphTargetIndex );\n			return texelFetch( morphTargetsTexture, morphUV, 0 );\n		}\n	#else\n		#ifndef USE_MORPHNORMALS\n			uniform float morphTargetInfluences[ 8 ];\n		#else\n			uniform float morphTargetInfluences[ 4 ];\n		#endif\n	#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n		}\n	#else\n		transformed += morphTarget0 * morphTargetInfluences[ 0 ];\n		transformed += morphTarget1 * morphTargetInfluences[ 1 ];\n		transformed += morphTarget2 * morphTargetInfluences[ 2 ];\n		transformed += morphTarget3 * morphTargetInfluences[ 3 ];\n		#ifndef USE_MORPHNORMALS\n			transformed += morphTarget4 * morphTargetInfluences[ 4 ];\n			transformed += morphTarget5 * morphTargetInfluences[ 5 ];\n			transformed += morphTarget6 * morphTargetInfluences[ 6 ];\n			transformed += morphTarget7 * morphTargetInfluences[ 7 ];\n		#endif\n	#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal *= faceDirection;\n	#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n	#ifdef USE_TANGENT\n		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn = getTangentFrame( - vViewPosition, normal,\n		#if defined( USE_NORMALMAP )\n			vNormalMapUv\n		#elif defined( USE_CLEARCOAT_NORMALMAP )\n			vClearcoatNormalMapUv\n		#else\n			vUv\n		#endif\n		);\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn[0] *= faceDirection;\n		tbn[1] *= faceDirection;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	#ifdef USE_TANGENT\n		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn2[0] *= faceDirection;\n		tbn2[1] *= faceDirection;\n	#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	normal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( uv.st );\n		vec2 st1 = dFdy( uv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n		return mat3( T * scale, B * scale, N );\n	}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	clearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n	uniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n	vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n	return packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n	mvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		float hard_shadow = step( compare , distribution.x );\n		if (hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x ;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return shadow;\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		float shadow = 1.0;\n		vec3 lightToPosition = shadowCoord.xyz;\n		\n		float lightToPositionLength = length( lightToPosition );\n		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;\n			vec3 bd3D = normalize( lightToPosition );\n			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n				shadow = (\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n				) * ( 1.0 / 9.0 );\n			#else\n				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n			#endif\n		}\n		return shadow;\n	}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n	vec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n		shadowWorldPosition = worldPosition;\n		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n		#endif\n		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	uniform highp sampler2D boneTexture;\n	mat4 getBoneMatrix( const in float i ) {\n		int size = textureSize( boneTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n	vec3( 1.6605, - 0.1246, - 0.0182 ),\n	vec3( - 0.5876, 1.1329, - 0.1006 ),\n	vec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n	vec3( 0.6274, 0.0691, 0.0164 ),\n	vec3( 0.3293, 0.9195, 0.0880 ),\n	vec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n	vec3 x2 = x * x;\n	vec3 x4 = x2 * x2;\n	return + 15.5 * x4 * x2\n		- 40.14 * x4 * x\n		+ 31.96 * x4\n		- 6.868 * x2 * x\n		+ 0.4298 * x2\n		+ 0.1191 * x\n		- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n	const mat3 AgXInsetMatrix = mat3(\n		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n	);\n	const mat3 AgXOutsetMatrix = mat3(\n		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n	);\n	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;\n	color *= toneMappingExposure;\n	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n	color = AgXInsetMatrix * color;\n	color = max( color, 1e-10 );	color = log2( color );\n	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n	color = clamp( color, 0.0, 1.0 );\n	color = agxDefaultContrastApprox( color );\n	color = AgXOutsetMatrix * color;\n	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n	color = clamp( color, 0.0, 1.0 );\n	return color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n	const float StartCompression = 0.8 - 0.04;\n	const float Desaturation = 0.15;\n	color *= toneMappingExposure;\n	float x = min( color.r, min( color.g, color.b ) );\n	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n	color -= offset;\n	float peak = max( color.r, max( color.g, color.b ) );\n	if ( peak < StartCompression ) return color;\n	float d = 1. - StartCompression;\n	float newPeak = 1. - d * d / ( peak + d - StartCompression );\n	color *= newPeak / peak;\n	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n	return mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n	material.transmission = transmission;\n	material.transmissionAlpha = 1.0;\n	material.thickness = thickness;\n	material.attenuationDistance = attenuationDistance;\n	material.attenuationColor = attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmitted = getIBLVolumeRefraction(\n		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n		material.attenuationColor, material.attenuationDistance );\n	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	float w0( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n	}\n	float w1( float a ) {\n		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n	}\n	float w2( float a ){\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n	}\n	float w3( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * a * a );\n	}\n	float g0( float a ) {\n		return w0( a ) + w1( a );\n	}\n	float g1( float a ) {\n		return w2( a ) + w3( a );\n	}\n	float h0( float a ) {\n		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n	}\n	float h1( float a ) {\n		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n	}\n	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n		uv = uv * texelSize.zw + 0.5;\n		vec2 iuv = floor( uv );\n		vec2 fuv = fract( uv );\n		float g0x = g0( fuv.x );\n		float g1x = g1( fuv.x );\n		float h0x = h0( fuv.x );\n		float h1x = h1( fuv.x );\n		float h0y = h0( fuv.y );\n		float h1y = h1( fuv.y );\n		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n	}\n	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n		vec2 fLodSizeInv = 1.0 / fLodSize;\n		vec2 cLodSizeInv = 1.0 / cLodSize;\n		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n		return mix( fSample, cSample, fract( lod ) );\n	}\n	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( const in float roughness, const in float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n	}\n	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n		if ( isinf( attenuationDistance ) ) {\n			return vec3( 1.0 );\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n		const in vec3 attenuationColor, const in float attenuationDistance ) {\n		vec4 transmittedLight;\n		vec3 transmittance;\n		#ifdef USE_DISPERSION\n			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n			for ( int i = 0; i < 3; i ++ ) {\n				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n				vec3 refractedRayExit = position + transmissionRay;\n		\n				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n				vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n				refractionCoords += 1.0;\n				refractionCoords /= 2.0;\n		\n				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n				transmittedLight[ i ] = transmissionSample[ i ];\n				transmittedLight.a += transmissionSample.a;\n				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n			}\n			transmittedLight.a /= 3.0;\n		\n		#else\n		\n			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n			vec3 refractedRayExit = position + transmissionRay;\n			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n			vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n			refractionCoords += 1.0;\n			refractionCoords /= 2.0;\n			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n		\n		#endif\n		vec3 attenuatedColor = transmittance * transmittedLight.rgb;\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n	}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform mat3 mapTransform;\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform mat3 alphaMapTransform;\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	uniform mat3 lightMapTransform;\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	uniform mat3 aoMapTransform;\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	uniform mat3 bumpMapTransform;\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	uniform mat3 normalMapTransform;\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	uniform mat3 displacementMapTransform;\n	varying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	uniform mat3 emissiveMapTransform;\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	uniform mat3 metalnessMapTransform;\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	uniform mat3 roughnessMapTransform;\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	uniform mat3 anisotropyMapTransform;\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	uniform mat3 clearcoatMapTransform;\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform mat3 clearcoatNormalMapTransform;\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform mat3 clearcoatRoughnessMapTransform;\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	uniform mat3 sheenColorMapTransform;\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	uniform mat3 sheenRoughnessMapTransform;\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	uniform mat3 iridescenceMapTransform;\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform mat3 iridescenceThicknessMapTransform;\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	uniform mat3 specularMapTransform;\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	uniform mat3 specularColorMapTransform;\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	uniform mat3 specularIntensityMapTransform;\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	vUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_BATCHING\n		worldPosition = batchingMatrix * worldPosition;\n	#endif\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n	uniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n	vec2 scale;\n	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"},sC={common:{diffuse:{value:new rA(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new iV},alphaMap:{value:null},alphaMapTransform:{value:new iV},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new iV}},envmap:{envMap:{value:null},envMapRotation:{value:new iV},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new iV}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new iV}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new iV},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new iV},normalScale:{value:new iG(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new iV},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new iV}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new iV}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new iV}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new rA(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new rA(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new iV},alphaTest:{value:0},uvTransform:{value:new iV}},sprite:{diffuse:{value:new rA(0xffffff)},opacity:{value:1},center:{value:new iG(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new iV},alphaMap:{value:null},alphaMapTransform:{value:new iV},alphaTest:{value:0}}},sS={basic:{uniforms:sn([sC.common,sC.specularmap,sC.envmap,sC.aomap,sC.lightmap,sC.fog]),vertexShader:sM.meshbasic_vert,fragmentShader:sM.meshbasic_frag},lambert:{uniforms:sn([sC.common,sC.specularmap,sC.envmap,sC.aomap,sC.lightmap,sC.emissivemap,sC.bumpmap,sC.normalmap,sC.displacementmap,sC.fog,sC.lights,{emissive:{value:new rA(0)}}]),vertexShader:sM.meshlambert_vert,fragmentShader:sM.meshlambert_frag},phong:{uniforms:sn([sC.common,sC.specularmap,sC.envmap,sC.aomap,sC.lightmap,sC.emissivemap,sC.bumpmap,sC.normalmap,sC.displacementmap,sC.fog,sC.lights,{emissive:{value:new rA(0)},specular:{value:new rA(1118481)},shininess:{value:30}}]),vertexShader:sM.meshphong_vert,fragmentShader:sM.meshphong_frag},standard:{uniforms:sn([sC.common,sC.envmap,sC.aomap,sC.lightmap,sC.emissivemap,sC.bumpmap,sC.normalmap,sC.displacementmap,sC.roughnessmap,sC.metalnessmap,sC.fog,sC.lights,{emissive:{value:new rA(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:sM.meshphysical_vert,fragmentShader:sM.meshphysical_frag},toon:{uniforms:sn([sC.common,sC.aomap,sC.lightmap,sC.emissivemap,sC.bumpmap,sC.normalmap,sC.displacementmap,sC.gradientmap,sC.fog,sC.lights,{emissive:{value:new rA(0)}}]),vertexShader:sM.meshtoon_vert,fragmentShader:sM.meshtoon_frag},matcap:{uniforms:sn([sC.common,sC.bumpmap,sC.normalmap,sC.displacementmap,sC.fog,{matcap:{value:null}}]),vertexShader:sM.meshmatcap_vert,fragmentShader:sM.meshmatcap_frag},points:{uniforms:sn([sC.points,sC.fog]),vertexShader:sM.points_vert,fragmentShader:sM.points_frag},dashed:{uniforms:sn([sC.common,sC.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:sM.linedashed_vert,fragmentShader:sM.linedashed_frag},depth:{uniforms:sn([sC.common,sC.displacementmap]),vertexShader:sM.depth_vert,fragmentShader:sM.depth_frag},normal:{uniforms:sn([sC.common,sC.bumpmap,sC.normalmap,sC.displacementmap,{opacity:{value:1}}]),vertexShader:sM.meshnormal_vert,fragmentShader:sM.meshnormal_frag},sprite:{uniforms:sn([sC.sprite,sC.fog]),vertexShader:sM.sprite_vert,fragmentShader:sM.sprite_frag},background:{uniforms:{uvTransform:{value:new iV},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:sM.background_vert,fragmentShader:sM.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new iV}},vertexShader:sM.backgroundCube_vert,fragmentShader:sM.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:sM.cube_vert,fragmentShader:sM.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:sM.equirect_vert,fragmentShader:sM.equirect_frag},distanceRGBA:{uniforms:sn([sC.common,sC.displacementmap,{referencePosition:{value:new nl},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:sM.distanceRGBA_vert,fragmentShader:sM.distanceRGBA_frag},shadow:{uniforms:sn([sC.lights,sC.fog,{color:{value:new rA(0)},opacity:{value:1}}]),vertexShader:sM.shadow_vert,fragmentShader:sM.shadow_frag}};sS.physical={uniforms:sn([sS.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new iV},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new iV},clearcoatNormalScale:{value:new iG(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new iV},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new iV},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new iV},sheen:{value:0},sheenColor:{value:new rA(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new iV},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new iV},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new iV},transmissionSamplerSize:{value:new iG},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new iV},attenuationDistance:{value:0},attenuationColor:{value:new rA(0)},specularColor:{value:new rA(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new iV},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new iV},anisotropyVector:{value:new iG},anisotropyMap:{value:null},anisotropyMapTransform:{value:new iV}}]),vertexShader:sM.meshphysical_vert,fragmentShader:sM.meshphysical_frag};let sT={r:0,b:0,g:0},sR=new nX,sI=new nk;function sB(e,i,n,r,s,a,o){let l,h;let u=new rA(0),c=+(!0!==a),d=null,p=0,f=null;function m(e){let r=!0===e.isScene?e.background:null;return r&&r.isTexture&&(r=(e.backgroundBlurriness>0?n:i).get(r)),r}function g(i,n){i.getRGB(sT,sr(e)),r.buffers.color.setClear(sT.r,sT.g,sT.b,n,o)}return{getClearColor:function(){return u},setClearColor:function(e,i=1){u.set(e),g(u,c=i)},getClearAlpha:function(){return c},setClearAlpha:function(e){g(u,c=e)},render:function(i){let n=!1,s=m(i);null===s?g(u,c):s&&s.isColor&&(g(s,1),n=!0);let a=e.xr.getEnvironmentBlendMode();"additive"===a?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===a&&r.buffers.color.setClear(0,0,0,0,o),(e.autoClear||n)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)},addToRenderList:function(i,n){let r=m(n);r&&(r.isCubeTexture||r.mapping===e_)?(void 0===h&&((h=new r9(new st(1e4,1e4,1e4),new sa({name:"BackgroundCubeMaterial",uniforms:si(sS.backgroundCube.uniforms),vertexShader:sS.backgroundCube.vertexShader,fragmentShader:sS.backgroundCube.fragmentShader,side:_,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(e,i,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),sR.copy(n.backgroundRotation),sR.x*=-1,sR.y*=-1,sR.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(sR.y*=-1,sR.z*=-1),h.material.uniforms.envMap.value=r,h.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,h.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(sI.makeRotationFromEuler(sR)),h.material.toneMapped=i1.getTransfer(r.colorSpace)!==tJ,(d!==r||p!==r.version||f!==e.toneMapping)&&(h.material.needsUpdate=!0,d=r,p=r.version,f=e.toneMapping),h.layers.enableAll(),i.unshift(h,h.geometry,h.material,0,0,null)):r&&r.isTexture&&(void 0===l&&((l=new r9(new sw(2,2),new sa({name:"BackgroundMaterial",uniforms:si(sS.background.uniforms),vertexShader:sS.background.vertexShader,fragmentShader:sS.background.fragmentShader,side:x,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=i1.getTransfer(r.colorSpace)!==tJ,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),(d!==r||p!==r.version||f!==e.toneMapping)&&(l.material.needsUpdate=!0,d=r,p=r.version,f=e.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null))}}}function sL(e,i){let n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},s=u(null),a=s,o=!1;function l(i){return e.bindVertexArray(i)}function h(i){return e.deleteVertexArray(i)}function u(e){let i=[],r=[],s=[];for(let e=0;e<n;e++)i[e]=0,r[e]=0,s[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:i,enabledAttributes:r,attributeDivisors:s,object:e,attributes:{},index:null}}function c(){let e=a.newAttributes;for(let i=0,n=e.length;i<n;i++)e[i]=0}function d(e){p(e,0)}function p(i,n){let r=a.newAttributes,s=a.enabledAttributes,o=a.attributeDivisors;r[i]=1,0===s[i]&&(e.enableVertexAttribArray(i),s[i]=1),o[i]!==n&&(e.vertexAttribDivisor(i,n),o[i]=n)}function f(){let i=a.newAttributes,n=a.enabledAttributes;for(let r=0,s=n.length;r<s;r++)n[r]!==i[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function m(i,n,r,s,a,o,l){!0===l?e.vertexAttribIPointer(i,n,r,a,o):e.vertexAttribPointer(i,n,r,s,a,o)}function g(){A(),o=!0,a!==s&&l((a=s).object)}function A(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:function(n,s,h,g,A){let v=!1,y=function(i,n,s){let a=!0===s.wireframe,o=r[i.id];void 0===o&&(o={},r[i.id]=o);let l=o[n.id];void 0===l&&(l={},o[n.id]=l);let h=l[a];return void 0===h&&(h=u(e.createVertexArray()),l[a]=h),h}(g,h,s);a!==y&&l((a=y).object),(v=function(e,i,n,r){let s=a.attributes,o=i.attributes,l=0,h=n.getAttributes();for(let i in h)if(h[i].location>=0){let n=s[i],r=o[i];if(void 0===r&&("instanceMatrix"===i&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===i&&e.instanceColor&&(r=e.instanceColor)),void 0===n||n.attribute!==r||r&&n.data!==r.data)return!0;l++}return a.attributesNum!==l||a.index!==r}(n,g,h,A))&&function(e,i,n,r){let s={},o=i.attributes,l=0,h=n.getAttributes();for(let i in h)if(h[i].location>=0){let n=o[i];void 0===n&&("instanceMatrix"===i&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===i&&e.instanceColor&&(n=e.instanceColor));let r={};r.attribute=n,n&&n.data&&(r.data=n.data),s[i]=r,l++}a.attributes=s,a.attributesNum=l,a.index=r}(n,g,h,A),null!==A&&i.update(A,e.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(n,r,s,a){c();let o=a.attributes,l=s.getAttributes(),h=r.defaultAttributeValues;for(let r in l){let s=l[r];if(s.location>=0){let l=o[r];if(void 0===l&&("instanceMatrix"===r&&n.instanceMatrix&&(l=n.instanceMatrix),"instanceColor"===r&&n.instanceColor&&(l=n.instanceColor)),void 0!==l){let r=l.normalized,o=l.itemSize,h=i.get(l);if(void 0===h)continue;let u=h.buffer,c=h.type,f=h.bytesPerElement,g=c===e.INT||c===e.UNSIGNED_INT||l.gpuType===eF;if(l.isInterleavedBufferAttribute){let i=l.data,h=i.stride,A=l.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<s.locationSize;e++)p(s.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<s.locationSize;e++)d(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)m(s.location+e,o/s.locationSize,c,r,h*f,(A+o/s.locationSize*e)*f,g)}else{if(l.isInstancedBufferAttribute){for(let e=0;e<s.locationSize;e++)p(s.location+e,l.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=l.meshPerAttribute*l.count)}else for(let e=0;e<s.locationSize;e++)d(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)m(s.location+e,o/s.locationSize,c,r,o*f,o/s.locationSize*e*f,g)}}else if(void 0!==h){let i=h[r];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(s.location,i);break;case 3:e.vertexAttrib3fv(s.location,i);break;case 4:e.vertexAttrib4fv(s.location,i);break;default:e.vertexAttrib1fv(s.location,i)}}}}f()}(n,s,h,g),null!==A&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.get(A).buffer))},reset:g,resetDefaultState:A,dispose:function(){for(let e in g(),r){let i=r[e];for(let e in i){let n=i[e];for(let e in n)h(n[e].object),delete n[e];delete i[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;let i=r[e.id];for(let e in i){let n=i[e];for(let e in n)h(n[e].object),delete n[e];delete i[e]}delete r[e.id]},releaseStatesOfProgram:function(e){for(let i in r){let n=r[i];if(void 0===n[e.id])continue;let s=n[e.id];for(let e in s)h(s[e].object),delete s[e];delete n[e.id]}},initAttributes:c,enableAttribute:d,disableUnusedAttributes:f}}function sP(e,i,n){let r;function s(i,s,a){0!==a&&(e.drawArraysInstanced(r,i,s,a),n.update(s,r,a))}this.setMode=function(e){r=e},this.render=function(i,s){e.drawArrays(r,i,s),n.update(s,r,1)},this.renderInstances=s,this.renderMultiDraw=function(e,s,a){if(0===a)return;let o=i.get("WEBGL_multi_draw");if(null===o)for(let i=0;i<a;i++)this.render(e[i],s[i]);else{o.multiDrawArraysWEBGL(r,e,0,s,0,a);let i=0;for(let e=0;e<a;e++)i+=s[e];n.update(i,r,1)}},this.renderMultiDrawInstances=function(e,a,o,l){if(0===o)return;let h=i.get("WEBGL_multi_draw");if(null===h)for(let i=0;i<e.length;i++)s(e[i],a[i],l[i]);else{h.multiDrawArraysInstancedWEBGL(r,e,0,a,0,l,0,o);let i=0;for(let e=0;e<o;e++)i+=a[e];for(let e=0;e<l.length;e++)n.update(i,r,l[e])}}}function sD(e,i,n,r){let s;function a(i){if("highp"===i){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";i="mediump"}return"mediump"===i&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp",l=a(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let h=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==s)return s;if(!0===i.has("EXT_texture_filter_anisotropic")){let n=i.get("EXT_texture_filter_anisotropic");s=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s},getMaxPrecision:a,textureFormatReadable:function(i){return i===eK||r.convert(i)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){let s=n===eV&&(i.has("EXT_color_buffer_half_float")||i.has("EXT_color_buffer_float"));return n===eN||r.convert(n)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)||n===eG||!!s},precision:o,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:c,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:c>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function sN(e){let i=this,n=null,r=0,s=!1,a=!1,o=new sv,l=new iV,h={value:null,needsUpdate:!1};function u(e,n,r,s){let a=null!==e?e.length:0,u=null;if(0!==a){if(u=h.value,!0!==s||null===u){let i=r+4*a,s=n.matrixWorldInverse;l.getNormalMatrix(s),(null===u||u.length<i)&&(u=new Float32Array(i));for(let i=0,n=r;i!==a;++i,n+=4)o.copy(e[i]).applyMatrix4(s,l),o.normal.toArray(u,n),u[n+3]=o.constant}h.value=u,h.needsUpdate=!0}return i.numPlanes=a,i.numIntersection=0,u}this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i){let n=0!==e.length||i||0!==r||s;return s=i,r=e.length,n},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,i){n=u(e,i,0)},this.setState=function(o,l,c){let d=o.clippingPlanes,p=o.clipIntersection,f=o.clipShadows,m=e.get(o);if(s&&null!==d&&0!==d.length&&(!a||f)){let e=a?0:r,i=4*e,s=m.clippingState||null;h.value=s,s=u(d,l,i,c);for(let e=0;e!==i;++e)s[e]=n[e];m.clippingState=s,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=e}else a?u(null):(h.value!==n&&(h.value=n,h.needsUpdate=r>0),i.numPlanes=r,i.numIntersection=0)}}function sO(e){let i=new WeakMap;function n(e,i){return i===ey?e.mapping=eA:i===ex&&(e.mapping=ev),e}function r(e){let n=e.target;n.removeEventListener("dispose",r);let s=i.get(n);void 0!==s&&(i.delete(n),s.dispose())}return{get:function(s){if(s&&s.isTexture){let a=s.mapping;if(a===ey||a===ex){if(i.has(s))return n(i.get(s).texture,s.mapping);{let a=s.image;if(!a||!(a.height>0))return null;{let o=new sf(a.height);return o.fromEquirectangularTexture(e,s),i.set(s,o),s.addEventListener("dispose",r),n(o.texture,s.mapping)}}}}return s},dispose:function(){i=new WeakMap}}}class sU extends so{constructor(e=-1,i=1,n=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=n,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,i,n,r,s,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=n-e,a=n+e,o=r+i,l=r-i;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,i=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=e*this.view.offsetX,a=s+e*this.view.width,o-=i*this.view.offsetY,l=o-i*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,null!==this.view&&(i.object.view=Object.assign({},this.view)),i}}let sk=[.125,.215,.35,.446,.526,.582],sF=new sU,sz=new rA,sG=null,sV=0,sj=0,sH=!1,sQ=(1+Math.sqrt(5))/2,sW=1/sQ,sq=[new nl(-sQ,sW,0),new nl(sQ,sW,0),new nl(-sW,0,sQ),new nl(sW,0,sQ),new nl(0,sQ,-sW),new nl(0,sQ,sW),new nl(-1,1,-1),new nl(1,1,-1),new nl(-1,1,1),new nl(1,1,1)];class sX{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,n=.1,r=100){sG=this._renderer.getRenderTarget(),sV=this._renderer.getActiveCubeFace(),sj=this._renderer.getActiveMipmapLevel(),sH=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);let s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=sZ(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=sJ(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(sG,sV,sj),this._renderer.xr.enabled=sH,e.scissorTest=!1,sY(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===eA||e.mapping===ev?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),sG=this._renderer.getRenderTarget(),sV=this._renderer.getActiveCubeFace(),sj=this._renderer.getActiveMipmapLevel(),sH=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;let n=i||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:eI,minFilter:eI,generateMipmaps:!1,type:eV,format:eK,colorSpace:tq,depthBuffer:!1},r=sK(e,i,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){var s;null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=sK(e,i,n);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){let i=[],n=[],r=[],s=e,a=e-4+1+sk.length;for(let o=0;o<a;o++){let a=Math.pow(2,s);n.push(a);let l=1/a;o>e-4?l=sk[o-e+4-1]:0===o&&(l=0),r.push(l);let h=1/(a-2),u=-h,c=1+h,d=[u,u,c,u,c,c,u,u,c,c,u,c],p=new Float32Array(108),f=new Float32Array(72),m=new Float32Array(36);for(let e=0;e<6;e++){let i=e%3*2/3-1,n=e>2?0:-1,r=[i,n,0,i+2/3,n,0,i+2/3,n+1,0,i,n,0,i+2/3,n+1,0,i,n+1,0];p.set(r,18*e),f.set(d,12*e);let s=[e,e,e,e,e,e];m.set(s,6*e)}let g=new rQ;g.setAttribute("position",new rT(p,3)),g.setAttribute("uv",new rT(f,2)),g.setAttribute("faceIndex",new rT(m,1)),i.push(g),s>4&&s--}return{lodPlanes:i,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=(s=r,new sa({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new nl(0,1,0)}},vertexShader:s$(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:E,depthTest:!1,depthWrite:!1}))}return r}_compileMaterial(e){let i=new r9(this._lodPlanes[0],e);this._renderer.compile(i,sF)}_sceneToCubeUV(e,i,n,r){let s=new sc(90,1,i,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,h=l.autoClear,u=l.toneMapping;l.getClearColor(sz),l.toneMapping=ea,l.autoClear=!1;let c=new r_({name:"PMREM.Background",side:_,depthWrite:!1,depthTest:!1}),d=new r9(new st,c),p=!1,f=e.background;f?f.isColor&&(c.color.copy(f),e.background=null,p=!0):(c.color.copy(sz),p=!0);for(let i=0;i<6;i++){let n=i%3;0===n?(s.up.set(0,a[i],0),s.lookAt(o[i],0,0)):1===n?(s.up.set(0,0,a[i]),s.lookAt(0,o[i],0)):(s.up.set(0,a[i],0),s.lookAt(0,0,o[i]));let h=this._cubeSize;sY(r,n*h,i>2?h:0,h,h),l.setRenderTarget(r),p&&l.render(d,s),l.render(e,s)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=u,l.autoClear=h,e.background=f}_textureToCubeUV(e,i){let n=this._renderer,r=e.mapping===eA||e.mapping===ev;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=sZ()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=sJ());let s=r?this._cubemapMaterial:this._equirectMaterial,a=new r9(this._lodPlanes[0],s);s.uniforms.envMap.value=e;let o=this._cubeSize;sY(i,0,0,3*o,2*o),n.setRenderTarget(i),n.render(a,sF)}_applyPMREM(e){let i=this._renderer,n=i.autoClear;i.autoClear=!1;let r=this._lodPlanes.length;for(let i=1;i<r;i++){let n=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),s=sq[(r-i-1)%sq.length];this._blur(e,i-1,i,n,s)}i.autoClear=n}_blur(e,i,n,r,s){let a=this._pingPongRenderTarget;this._halfBlur(e,a,i,n,r,"latitudinal",s),this._halfBlur(a,e,n,n,r,"longitudinal",s)}_halfBlur(e,i,n,r,s,a,o){let l=this._renderer,h=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let u=new r9(this._lodPlanes[r],h),c=h.uniforms,d=this._sizeLods[n]-1,p=isFinite(s)?Math.PI/(2*d):2*Math.PI/39,f=s/p,m=isFinite(s)?1+Math.floor(3*f):20;m>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);let g=[],A=0;for(let e=0;e<20;++e){let i=e/f,n=Math.exp(-i*i/2);g.push(n),0===e?A+=n:e<m&&(A+=2*n)}for(let e=0;e<g.length;e++)g[e]=g[e]/A;c.envMap.value=e.texture,c.samples.value=m,c.weights.value=g,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);let{_lodMax:v}=this;c.dTheta.value=p,c.mipInt.value=v-n;let y=this._sizeLods[r],x=4*(this._cubeSize-y);sY(i,3*y*(r>v-4?r-v+4:0),x,3*y,2*y),l.setRenderTarget(i),l.render(u,sF)}}function sK(e,i,n){let r=new ni(e,i,n);return r.texture.mapping=e_,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function sY(e,i,n,r,s){e.viewport.set(i,n,r,s),e.scissor.set(i,n,r,s)}function sJ(){return new sa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:s$(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:E,depthTest:!1,depthWrite:!1})}function sZ(){return new sa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:s$(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:E,depthTest:!1,depthWrite:!1})}function s$(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function s0(e){let i=new WeakMap,n=null;function r(e){let n=e.target;n.removeEventListener("dispose",r);let s=i.get(n);void 0!==s&&(i.delete(n),s.dispose())}return{get:function(s){if(s&&s.isTexture){let a=s.mapping,o=a===ey||a===ex,l=a===eA||a===ev;if(o||l){let a=i.get(s),h=void 0!==a?a.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==h)return null===n&&(n=new sX(e)),(a=o?n.fromEquirectangular(s,a):n.fromCubemap(s,a)).texture.pmremVersion=s.pmremVersion,i.set(s,a),a.texture;if(void 0!==a)return a.texture;{let h=s.image;return o&&h&&h.height>0||l&&h&&function(e){let i=0;for(let n=0;n<6;n++)void 0!==e[n]&&i++;return 6===i}(h)?(null===n&&(n=new sX(e)),(a=o?n.fromEquirectangular(s):n.fromCubemap(s)).texture.pmremVersion=s.pmremVersion,i.set(s,a),s.addEventListener("dispose",r),a.texture):null}}}return s},dispose:function(){i=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function s1(e){let i={};function n(n){let r;if(void 0!==i[n])return i[n];switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return i[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){let i=n(e);return null===i&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),i}}}function s2(e,i,n,r){let s={},a=new WeakMap;function o(e){let l=e.target;for(let e in null!==l.index&&i.remove(l.index),l.attributes)i.remove(l.attributes[e]);for(let e in l.morphAttributes){let n=l.morphAttributes[e];for(let e=0,r=n.length;e<r;e++)i.remove(n[e])}l.removeEventListener("dispose",o),delete s[l.id];let h=a.get(l);h&&(i.remove(h),a.delete(l)),r.releaseStatesOfGeometry(l),!0===l.isInstancedBufferGeometry&&delete l._maxInstanceCount,n.memory.geometries--}function l(e){let n=[],r=e.index,s=e.attributes.position,o=0;if(null!==r){let e=r.array;o=r.version;for(let i=0,r=e.length;i<r;i+=3){let r=e[i+0],s=e[i+1],a=e[i+2];n.push(r,s,s,a,a,r)}}else{if(void 0===s)return;let e=s.array;o=s.version;for(let i=0,r=e.length/3-1;i<r;i+=3){let e=i+0,r=i+1,s=i+2;n.push(e,r,r,s,s,e)}}let l=new(iH(n)?rN:rP)(n,1);l.version=o;let h=a.get(e);h&&i.remove(h),a.set(e,l)}return{get:function(e,i){return!0===s[i.id]||(i.addEventListener("dispose",o),s[i.id]=!0,n.memory.geometries++),i},update:function(n){let r=n.attributes;for(let n in r)i.update(r[n],e.ARRAY_BUFFER);let s=n.morphAttributes;for(let n in s){let r=s[n];for(let n=0,s=r.length;n<s;n++)i.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){let i=a.get(e);if(i){let n=e.index;null!==n&&i.version<n.version&&l(e)}else l(e);return a.get(e)}}}function s3(e,i,n){let r,s,a;function o(i,o,l){0!==l&&(e.drawElementsInstanced(r,o,s,i*a,l),n.update(o,r,l))}this.setMode=function(e){r=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(i,o){e.drawElements(r,o,s,i*a),n.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(e,o,l){if(0===l)return;let h=i.get("WEBGL_multi_draw");if(null===h)for(let i=0;i<l;i++)this.render(e[i]/a,o[i]);else{h.multiDrawElementsWEBGL(r,o,0,s,e,0,l);let i=0;for(let e=0;e<l;e++)i+=o[e];n.update(i,r,1)}},this.renderMultiDrawInstances=function(e,l,h,u){if(0===h)return;let c=i.get("WEBGL_multi_draw");if(null===c)for(let i=0;i<e.length;i++)o(e[i]/a,l[i],u[i]);else{c.multiDrawElementsInstancedWEBGL(r,l,0,s,e,0,u,0,h);let i=0;for(let e=0;e<h;e++)i+=l[e];for(let e=0;e<u.length;e++)n.update(i,r,u[e])}}}function s4(e){let i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(n,r,s){switch(i.calls++,r){case e.TRIANGLES:i.triangles+=n/3*s;break;case e.LINES:i.lines+=n/2*s;break;case e.LINE_STRIP:i.lines+=s*(n-1);break;case e.LINE_LOOP:i.lines+=s*n;break;case e.POINTS:i.points+=s*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function s5(e,i,n){let r=new WeakMap,s=new ne;return{update:function(a,o,l){let h=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,c=void 0!==u?u.length:0,d=r.get(o);if(void 0===d||d.count!==c){void 0!==d&&d.texture.dispose();let e=void 0!==o.morphAttributes.position,n=void 0!==o.morphAttributes.normal,a=void 0!==o.morphAttributes.color,l=o.morphAttributes.position||[],h=o.morphAttributes.normal||[],u=o.morphAttributes.color||[],p=0;!0===e&&(p=1),!0===n&&(p=2),!0===a&&(p=3);let f=o.attributes.position.count*p,m=1;f>i.maxTextureSize&&(m=Math.ceil(f/i.maxTextureSize),f=i.maxTextureSize);let g=new Float32Array(f*m*4*c),A=new nn(g,f,m,c);A.type=eG,A.needsUpdate=!0;let v=4*p;for(let i=0;i<c;i++){let r=l[i],o=h[i],c=u[i],d=f*m*4*i;for(let i=0;i<r.count;i++){let l=i*v;!0===e&&(s.fromBufferAttribute(r,i),g[d+l+0]=s.x,g[d+l+1]=s.y,g[d+l+2]=s.z,g[d+l+3]=0),!0===n&&(s.fromBufferAttribute(o,i),g[d+l+4]=s.x,g[d+l+5]=s.y,g[d+l+6]=s.z,g[d+l+7]=0),!0===a&&(s.fromBufferAttribute(c,i),g[d+l+8]=s.x,g[d+l+9]=s.y,g[d+l+10]=s.z,g[d+l+11]=4===c.itemSize?s.w:1)}}d={count:c,texture:A,size:new iG(f,m)},r.set(o,d),o.addEventListener("dispose",function e(){A.dispose(),r.delete(o),o.removeEventListener("dispose",e)})}if(!0===a.isInstancedMesh&&null!==a.morphTexture)l.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{let i=0;for(let e=0;e<h.length;e++)i+=h[e];let n=o.morphTargetsRelative?1:1-i;l.getUniforms().setValue(e,"morphTargetBaseInfluence",n),l.getUniforms().setValue(e,"morphTargetInfluences",h)}l.getUniforms().setValue(e,"morphTargetsTexture",d.texture,n),l.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}}}class s6{constructor(e,i,n){if(this.renderer=e,this.DEFAULT_NUMVIEWS=2,this.maxNumViews=0,this.gl=n,this.extensions=i,this.available=this.extensions.has("OCULUS_multiview"),this.available){let e=this.extensions.get("OCULUS_multiview");this.maxNumViews=this.gl.getParameter(e.MAX_VIEWS_OVR),this.mat4=[],this.mat3=[],this.cameraArray=[];for(var r=0;r<this.maxNumViews;r++)this.mat4[r]=new nk,this.mat3[r]=new iV}}getCameraArray(e){return e.isArrayCamera?e.cameras:(this.cameraArray[0]=e,this.cameraArray)}updateCameraProjectionMatricesUniform(e,i){for(var n=this.getCameraArray(e),r=0;r<n.length;r++)this.mat4[r].copy(n[r].projectionMatrix);i.setValue(this.gl,"projectionMatrices",this.mat4)}updateCameraViewMatricesUniform(e,i){for(var n=this.getCameraArray(e),r=0;r<n.length;r++)this.mat4[r].copy(n[r].matrixWorldInverse);i.setValue(this.gl,"viewMatrices",this.mat4)}updateObjectMatricesUniforms(e,i,n){for(var r=this.getCameraArray(i),s=0;s<r.length;s++)this.mat4[s].multiplyMatrices(r[s].matrixWorldInverse,e.matrixWorld),this.mat3[s].getNormalMatrix(this.mat4[s]);n.setValue(this.gl,"modelViewMatrices",this.mat4),n.setValue(this.gl,"normalMatrices",this.mat3)}}function s8(e,i,n,r){let s=new WeakMap;function a(e){let i=e.target;i.removeEventListener("dispose",a),n.remove(i.instanceMatrix),null!==i.instanceColor&&n.remove(i.instanceColor)}return{update:function(o){let l=r.render.frame,h=o.geometry,u=i.get(o,h);if(s.get(u)!==l&&(i.update(u),s.set(u,l)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),s.get(o)!==l&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),s.set(o,l))),o.isSkinnedMesh){let e=o.skeleton;s.get(e)!==l&&(e.update(),s.set(e,l))}return u},dispose:function(){s=new WeakMap}}}class s7 extends i9{constructor(e,i,n,r,s,a,o,l,h,u){if((u=void 0!==u?u:eZ)!==eZ&&u!==e$)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===eZ&&(n=ez),void 0===n&&u===e$&&(n=eQ),super(null,r,s,a,o,l,u,n,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=void 0!==o?o:eM,this.minFilter=void 0!==l?l:eM,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let i=super.toJSON(e);return null!==this.compareFunction&&(i.compareFunction=this.compareFunction),i}}let s9=new i9,ae=new s7(1,1);ae.compareFunction=iu;let at=new nn,ai=new ns,an=new sp,ar=[],as=[],aa=new Float32Array(16),ao=new Float32Array(9),al=new Float32Array(4);function ah(e,i,n){let r=e[0];if(r<=0||r>0)return e;let s=i*n,a=ar[s];if(void 0===a&&(a=new Float32Array(s),ar[s]=a),0!==i){r.toArray(a,0);for(let r=1,s=0;r!==i;++r)s+=n,e[r].toArray(a,s)}return a}function au(e,i){if(e.length!==i.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==i[n])return!1;return!0}function ac(e,i){for(let n=0,r=i.length;n<r;n++)e[n]=i[n]}function ad(e,i){let n=as[i];void 0===n&&(n=new Int32Array(i),as[i]=n);for(let r=0;r!==i;++r)n[r]=e.allocateTextureUnit();return n}function ap(e,i){let n=this.cache;n[0]!==i&&(e.uniform1f(this.addr,i),n[0]=i)}function af(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y)&&(e.uniform2f(this.addr,i.x,i.y),n[0]=i.x,n[1]=i.y);else{if(au(n,i))return;e.uniform2fv(this.addr,i),ac(n,i)}}function am(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z)&&(e.uniform3f(this.addr,i.x,i.y,i.z),n[0]=i.x,n[1]=i.y,n[2]=i.z);else if(void 0!==i.r)(n[0]!==i.r||n[1]!==i.g||n[2]!==i.b)&&(e.uniform3f(this.addr,i.r,i.g,i.b),n[0]=i.r,n[1]=i.g,n[2]=i.b);else{if(au(n,i))return;e.uniform3fv(this.addr,i),ac(n,i)}}function ag(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z||n[3]!==i.w)&&(e.uniform4f(this.addr,i.x,i.y,i.z,i.w),n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=i.w);else{if(au(n,i))return;e.uniform4fv(this.addr,i),ac(n,i)}}function aA(e,i){let n=this.cache,r=i.elements;if(void 0===r){if(au(n,i))return;e.uniformMatrix2fv(this.addr,!1,i),ac(n,i)}else{if(au(n,r))return;al.set(r),e.uniformMatrix2fv(this.addr,!1,al),ac(n,r)}}function av(e,i){let n=this.cache,r=i.elements;if(void 0===r){if(au(n,i))return;e.uniformMatrix3fv(this.addr,!1,i),ac(n,i)}else{if(au(n,r))return;ao.set(r),e.uniformMatrix3fv(this.addr,!1,ao),ac(n,r)}}function ay(e,i){let n=this.cache,r=i.elements;if(void 0===r){if(au(n,i))return;e.uniformMatrix4fv(this.addr,!1,i),ac(n,i)}else{if(au(n,r))return;aa.set(r),e.uniformMatrix4fv(this.addr,!1,aa),ac(n,r)}}function ax(e,i){let n=this.cache;n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i)}function a_(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y)&&(e.uniform2i(this.addr,i.x,i.y),n[0]=i.x,n[1]=i.y);else{if(au(n,i))return;e.uniform2iv(this.addr,i),ac(n,i)}}function ab(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z)&&(e.uniform3i(this.addr,i.x,i.y,i.z),n[0]=i.x,n[1]=i.y,n[2]=i.z);else{if(au(n,i))return;e.uniform3iv(this.addr,i),ac(n,i)}}function aE(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z||n[3]!==i.w)&&(e.uniform4i(this.addr,i.x,i.y,i.z,i.w),n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=i.w);else{if(au(n,i))return;e.uniform4iv(this.addr,i),ac(n,i)}}function aw(e,i){let n=this.cache;n[0]!==i&&(e.uniform1ui(this.addr,i),n[0]=i)}function aM(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y)&&(e.uniform2ui(this.addr,i.x,i.y),n[0]=i.x,n[1]=i.y);else{if(au(n,i))return;e.uniform2uiv(this.addr,i),ac(n,i)}}function aC(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z)&&(e.uniform3ui(this.addr,i.x,i.y,i.z),n[0]=i.x,n[1]=i.y,n[2]=i.z);else{if(au(n,i))return;e.uniform3uiv(this.addr,i),ac(n,i)}}function aS(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z||n[3]!==i.w)&&(e.uniform4ui(this.addr,i.x,i.y,i.z,i.w),n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=i.w);else{if(au(n,i))return;e.uniform4uiv(this.addr,i),ac(n,i)}}function aT(e,i,n){let r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s);let a=this.type===e.SAMPLER_2D_SHADOW?ae:s9;n.setTexture2D(i||a,s)}function aR(e,i,n){let r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),n.setTexture3D(i||ai,s)}function aI(e,i,n){let r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),n.setTextureCube(i||an,s)}function aB(e,i,n){let r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),n.setTexture2DArray(i||at,s)}function aL(e,i){e.uniform1fv(this.addr,i)}function aP(e,i){let n=ah(i,this.size,2);e.uniform2fv(this.addr,n)}function aD(e,i){let n=ah(i,this.size,3);e.uniform3fv(this.addr,n)}function aN(e,i){let n=ah(i,this.size,4);e.uniform4fv(this.addr,n)}function aO(e,i){let n=ah(i,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function aU(e,i){let n=ah(i,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ak(e,i){let n=ah(i,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function aF(e,i){e.uniform1iv(this.addr,i)}function az(e,i){e.uniform2iv(this.addr,i)}function aG(e,i){e.uniform3iv(this.addr,i)}function aV(e,i){e.uniform4iv(this.addr,i)}function aj(e,i){e.uniform1uiv(this.addr,i)}function aH(e,i){e.uniform2uiv(this.addr,i)}function aQ(e,i){e.uniform3uiv(this.addr,i)}function aW(e,i){e.uniform4uiv(this.addr,i)}function aq(e,i,n){let r=this.cache,s=i.length,a=ad(n,s);au(r,a)||(e.uniform1iv(this.addr,a),ac(r,a));for(let e=0;e!==s;++e)n.setTexture2D(i[e]||s9,a[e])}function aX(e,i,n){let r=this.cache,s=i.length,a=ad(n,s);au(r,a)||(e.uniform1iv(this.addr,a),ac(r,a));for(let e=0;e!==s;++e)n.setTexture3D(i[e]||ai,a[e])}function aK(e,i,n){let r=this.cache,s=i.length,a=ad(n,s);au(r,a)||(e.uniform1iv(this.addr,a),ac(r,a));for(let e=0;e!==s;++e)n.setTextureCube(i[e]||an,a[e])}function aY(e,i,n){let r=this.cache,s=i.length,a=ad(n,s);au(r,a)||(e.uniform1iv(this.addr,a),ac(r,a));for(let e=0;e!==s;++e)n.setTexture2DArray(i[e]||at,a[e])}class aJ{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.setValue=function(e){switch(e){case 5126:return ap;case 35664:return af;case 35665:return am;case 35666:return ag;case 35674:return aA;case 35675:return av;case 35676:return ay;case 5124:case 35670:return ax;case 35667:case 35671:return a_;case 35668:case 35672:return ab;case 35669:case 35673:return aE;case 5125:return aw;case 36294:return aM;case 36295:return aC;case 36296:return aS;case 35678:case 36198:case 36298:case 36306:case 35682:return aT;case 35679:case 36299:case 36307:return aR;case 35680:case 36300:case 36308:case 36293:return aI;case 36289:case 36303:case 36311:case 36292:return aB}}(i.type)}}class aZ{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=function(e){switch(e){case 5126:return aL;case 35664:return aP;case 35665:return aD;case 35666:return aN;case 35674:return aO;case 35675:return aU;case 35676:return ak;case 5124:case 35670:return aF;case 35667:case 35671:return az;case 35668:case 35672:return aG;case 35669:case 35673:return aV;case 5125:return aj;case 36294:return aH;case 36295:return aQ;case 36296:return aW;case 35678:case 36198:case 36298:case 36306:case 35682:return aq;case 35679:case 36299:case 36307:return aX;case 35680:case 36300:case 36308:case 36293:return aK;case 36289:case 36303:case 36311:case 36292:return aY}}(i.type)}}class a${constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,n){let r=this.seq;for(let s=0,a=r.length;s!==a;++s){let a=r[s];a.setValue(e,i[a.id],n)}}}let a0=/(\w+)(\])?(\[|\.)?/g;function a1(e,i){e.seq.push(i),e.map[i.id]=i}class a2{constructor(e,i){this.seq=[],this.map={};let n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){let n=e.getActiveUniform(i,r),s=e.getUniformLocation(i,n.name);!function(e,i,n){let r=e.name,s=r.length;for(a0.lastIndex=0;;){let a=a0.exec(r),o=a0.lastIndex,l=a[1],h="]"===a[2],u=a[3];if(h&&(l|=0),void 0===u||"["===u&&o+2===s){a1(n,void 0===u?new aJ(l,e,i):new aZ(l,e,i));break}{let e=n.map[l];void 0===e&&a1(n,e=new a$(l)),n=e}}}(n,s,this)}}setValue(e,i,n,r){let s=this.map[i];void 0!==s&&s.setValue(e,n,r)}setOptional(e,i,n){let r=i[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,i,n,r){for(let s=0,a=i.length;s!==a;++s){let a=i[s],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}}static seqWithValue(e,i){let n=[];for(let r=0,s=e.length;r!==s;++r){let s=e[r];s.id in i&&n.push(s)}return n}}function a3(e,i,n){let r=e.createShader(i);return e.shaderSource(r,n),e.compileShader(r),r}let a4=0;function a5(e,i,n){let r=e.getShaderParameter(i,e.COMPILE_STATUS),s=e.getShaderInfoLog(i).trim();if(r&&""===s)return"";let a=/ERROR: 0:(\d+)/.exec(s);if(!a)return s;{let r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+s+"\n\n"+function(e,i){let n=e.split("\n"),r=[],s=Math.max(i-6,0),a=Math.min(i+6,n.length);for(let e=s;e<a;e++){let s=e+1;r.push(`${s===i?">":" "} ${s}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(i),r)}}function a6(e){return""!==e}function a8(e,i){let n=i.numSpotLightShadows+i.numSpotLightMaps-i.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,i.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,i.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,i.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,i.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,i.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,i.numPointLightShadows)}function a7(e,i){return e.replace(/NUM_CLIPPING_PLANES/g,i.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,i.numClippingPlanes-i.numClipIntersection)}let a9=/^[ \t]*#include +<([\w\d./]+)>/gm;function oe(e){return e.replace(a9,oi)}let ot=new Map;function oi(e,i){let n=sM[i];if(void 0===n){let e=ot.get(i);if(void 0!==e)n=sM[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',i,e);else throw Error("Can not resolve #include <"+i+">")}return oe(n)}let on=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function or(e){return e.replace(on,os)}function os(e,i,n,r){let s="";for(let e=parseInt(i);e<parseInt(n);e++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return s}function oa(e){let i=`precision ${e.precision} float;
	precision ${e.precision} int;
	precision ${e.precision} sampler2D;
	precision ${e.precision} samplerCube;
	precision ${e.precision} sampler3D;
	precision ${e.precision} sampler2DArray;
	precision ${e.precision} sampler2DShadow;
	precision ${e.precision} samplerCubeShadow;
	precision ${e.precision} sampler2DArrayShadow;
	precision ${e.precision} isampler2D;
	precision ${e.precision} isampler3D;
	precision ${e.precision} isamplerCube;
	precision ${e.precision} isampler2DArray;
	precision ${e.precision} usampler2D;
	precision ${e.precision} usampler3D;
	precision ${e.precision} usamplerCube;
	precision ${e.precision} usampler2DArray;
	`;return"highp"===e.precision?i+="\n#define HIGH_PRECISION":"mediump"===e.precision?i+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(i+="\n#define LOW_PRECISION"),i}function oo(e,i,n,r){let s,a,o,l,h,u;let c=e.getContext(),d=n.defines,p=n.vertexShader,f=n.fragmentShader,m=(h="SHADOWMAP_TYPE_BASIC",n.shadowMapType===A?h="SHADOWMAP_TYPE_PCF":n.shadowMapType===v?h="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===y&&(h="SHADOWMAP_TYPE_VSM"),h),g=function(e){let i="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case eA:case ev:i="ENVMAP_TYPE_CUBE";break;case e_:i="ENVMAP_TYPE_CUBE_UV"}return i}(n),x=(u="ENVMAP_MODE_REFLECTION",n.envMap&&n.envMapMode===ev&&(u="ENVMAP_MODE_REFRACTION"),u),_=function(e){let i="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case en:i="ENVMAP_BLENDING_MULTIPLY";break;case er:i="ENVMAP_BLENDING_MIX";break;case es:i="ENVMAP_BLENDING_ADD"}return i}(n),b=function(e){let i=e.envMapCubeUVHeight;if(null===i)return null;let n=Math.log2(i)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:1/i,maxMip:n}}(n),E=[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(a6).join("\n"),w=function(e){let i=[];for(let n in e){let r=e[n];!1!==r&&i.push("#define "+n+" "+r)}return i.join("\n")}(d),M=c.createProgram(),C=n.glslVersion?"#version "+n.glslVersion+"\n":"",S=n.numMultiviewViews;n.isRawShaderMaterial?((s=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,w].filter(a6).join("\n")).length>0&&(s+="\n"),(a=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,w].filter(a6).join("\n")).length>0&&(a+="\n")):(s=[oa(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,w,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+x:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+m:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(a6).join("\n"),a=[oa(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,w,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+g:"",n.envMap?"#define "+x:"",n.envMap?"#define "+_:"",b?"#define CUBEUV_TEXEL_WIDTH "+b.texelWidth:"",b?"#define CUBEUV_TEXEL_HEIGHT "+b.texelHeight:"",b?"#define CUBEUV_MAX_MIP "+b.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+m:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ea?"#define TONE_MAPPING":"",n.toneMapping!==ea?sM.tonemapping_pars_fragment:"",n.toneMapping!==ea?function(e,i){let n;switch(i){case eo:n="Linear";break;case el:n="Reinhard";break;case eh:n="OptimizedCineon";break;case eu:n="ACESFilmic";break;case ed:n="AgX";break;case ep:n="Neutral";break;case ec:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",i),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",sM.colorspace_pars_fragment,function(e,i){let n=function(e){let i;let n=i1.getPrimaries(i1.workingColorSpace),r=i1.getPrimaries(e);switch(n===r?i="":n===t$&&r===tZ?i="LinearDisplayP3ToLinearSRGB":n===tZ&&r===t$&&(i="LinearSRGBToLinearDisplayP3"),e){case tq:case tK:return[i,"LinearTransferOETF"];case tW:case tX:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}}(i);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(a6).join("\n")),p=a7(p=a8(p=oe(p),n),n),f=a7(f=a8(f=oe(f),n),n),p=or(p),f=or(f),!0!==n.isRawShaderMaterial&&(C="#version 300 es\n",s=[E,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+s,a=["#define varying in",n.glslVersion===iC?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===iC?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a,S>0&&(s=(s=["#extension GL_OVR_multiview : require","layout(num_views = "+S+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n")+"\n"+s).replace("uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;",["uniform mat4 modelViewMatrices["+S+"];","uniform mat4 projectionMatrices["+S+"];","uniform mat4 viewMatrices["+S+"];","uniform mat3 normalMatrices["+S+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),a=(a="#extension GL_OVR_multiview : require\n#define VIEW_ID gl_ViewID_OVR\n"+a).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+S+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n"))));let T=C+s+p,R=C+a+f,I=a3(c,c.VERTEX_SHADER,T),B=a3(c,c.FRAGMENT_SHADER,R);function L(i){if(e.debug.checkShaderErrors){let n=c.getProgramInfoLog(M).trim(),r=c.getShaderInfoLog(I).trim(),o=c.getShaderInfoLog(B).trim(),l=!0,h=!0;if(!1===c.getProgramParameter(M,c.LINK_STATUS)){if(l=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(c,M,I,B);else{let e=a5(c,I,"vertex"),r=a5(c,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+c.getError()+" - VALIDATE_STATUS "+c.getProgramParameter(M,c.VALIDATE_STATUS)+"\n\nMaterial Name: "+i.name+"\nMaterial Type: "+i.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+r)}}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):(""===r||""===o)&&(h=!1);h&&(i.diagnostics={runnable:l,programLog:n,vertexShader:{log:r,prefix:s},fragmentShader:{log:o,prefix:a}})}c.deleteShader(I),c.deleteShader(B),o=new a2(c,M),l=function(e,i){let n={},r=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let r=e.getActiveAttrib(i,s),a=r.name,o=1;r.type===e.FLOAT_MAT2&&(o=2),r.type===e.FLOAT_MAT3&&(o=3),r.type===e.FLOAT_MAT4&&(o=4),n[a]={type:r.type,location:e.getAttribLocation(i,a),locationSize:o}}return n}(c,M)}c.attachShader(M,I),c.attachShader(M,B),void 0!==n.index0AttributeName?c.bindAttribLocation(M,0,n.index0AttributeName):!0===n.morphTargets&&c.bindAttribLocation(M,0,"position"),c.linkProgram(M),this.getUniforms=function(){return void 0===o&&L(this),o},this.getAttributes=function(){return void 0===l&&L(this),l};let P=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===P&&(P=c.getProgramParameter(M,37297)),P},this.destroy=function(){r.releaseStatesOfProgram(this),c.deleteProgram(M),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=a4++,this.cacheKey=i,this.usedTimes=1,this.program=M,this.vertexShader=I,this.fragmentShader=B,this.numMultiviewViews=S,this}let ol=0;class oh{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let i=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(i),s=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(s)&&(a.add(s),s.usedTimes++),this}remove(e){for(let i of this.materialCache.get(e))i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let i=this.materialCache,n=i.get(e);return void 0===n&&(n=new Set,i.set(e,n)),n}_getShaderStage(e){let i=this.shaderCache,n=i.get(e);return void 0===n&&(n=new ou(e),i.set(e,n)),n}}class ou{constructor(e){this.id=ol++,this.code=e,this.usedTimes=0}}function oc(e,i,n,r,s,a,o){let l=new nK,h=new oh,u=new Set,c=[],d=s.logarithmicDepthBuffer,p=s.vertexTextures,f=s.precision,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(e){return(u.add(e),0===e)?"uv":`uv${e}`}return{getParameters:function(a,l,c,A,v){let y,x,E,M;let C=A.fog,S=v.geometry,T=a.isMeshStandardMaterial?A.environment:null,R=(a.isMeshStandardMaterial?n:i).get(a.envMap||T),I=R&&R.mapping===e_?R.image.height:null,B=m[a.type];null!==a.precision&&(f=s.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead.");let L=S.morphAttributes.position||S.morphAttributes.normal||S.morphAttributes.color,P=void 0!==L?L.length:0,D=0;if(void 0!==S.morphAttributes.position&&(D=1),void 0!==S.morphAttributes.normal&&(D=2),void 0!==S.morphAttributes.color&&(D=3),B){let e=sS[B];y=e.vertexShader,x=e.fragmentShader}else y=a.vertexShader,x=a.fragmentShader,h.update(a),E=h.getVertexShaderID(a),M=h.getFragmentShaderID(a);let N=e.getRenderTarget(),O=N&&N.isWebGLMultiviewRenderTarget?N.numViews:0,U=!0===v.isInstancedMesh,k=!0===v.isBatchedMesh,F=!!a.map,z=!!a.matcap,G=!!R,V=!!a.aoMap,j=!!a.lightMap,H=!!a.bumpMap,Q=!!a.normalMap,W=!!a.displacementMap,q=!!a.emissiveMap,X=!!a.metalnessMap,K=!!a.roughnessMap,Y=a.anisotropy>0,J=a.clearcoat>0,Z=a.dispersion>0,$=a.iridescence>0,ee=a.sheen>0,et=a.transmission>0,ei=Y&&!!a.anisotropyMap,en=J&&!!a.clearcoatMap,er=J&&!!a.clearcoatNormalMap,es=J&&!!a.clearcoatRoughnessMap,eo=$&&!!a.iridescenceMap,el=$&&!!a.iridescenceThicknessMap,eh=ee&&!!a.sheenColorMap,eu=ee&&!!a.sheenRoughnessMap,ec=!!a.specularMap,ed=!!a.specularColorMap,ep=!!a.specularIntensityMap,ef=et&&!!a.transmissionMap,em=et&&!!a.thicknessMap,eg=!!a.gradientMap,eA=!!a.alphaMap,ev=a.alphaTest>0,ey=!!a.alphaHash,ex=!!a.extensions,eb=ea;a.toneMapped&&(null===N||!0===N.isXRRenderTarget)&&(eb=e.toneMapping);let eE={shaderID:B,shaderType:a.type,shaderName:a.name,vertexShader:y,fragmentShader:x,defines:a.defines,customVertexShaderID:E,customFragmentShaderID:M,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,batching:k,instancing:U,instancingColor:U&&null!==v.instanceColor,instancingMorph:U&&null!==v.morphTexture,supportsVertexTextures:p,numMultiviewViews:O,outputColorSpace:null===N?e.outputColorSpace:!0===N.isXRRenderTarget?N.texture.colorSpace:tq,alphaToCoverage:!!a.alphaToCoverage,map:F,matcap:z,envMap:G,envMapMode:G&&R.mapping,envMapCubeUVHeight:I,aoMap:V,lightMap:j,bumpMap:H,normalMap:Q,displacementMap:p&&W,emissiveMap:q,normalMapObjectSpace:Q&&a.normalMapType===tH,normalMapTangentSpace:Q&&a.normalMapType===tj,metalnessMap:X,roughnessMap:K,anisotropy:Y,anisotropyMap:ei,clearcoat:J,clearcoatMap:en,clearcoatNormalMap:er,clearcoatRoughnessMap:es,dispersion:Z,iridescence:$,iridescenceMap:eo,iridescenceThicknessMap:el,sheen:ee,sheenColorMap:eh,sheenRoughnessMap:eu,specularMap:ec,specularColorMap:ed,specularIntensityMap:ep,transmission:et,transmissionMap:ef,thicknessMap:em,gradientMap:eg,opaque:!1===a.transparent&&a.blending===w&&!1===a.alphaToCoverage,alphaMap:eA,alphaTest:ev,alphaHash:ey,combine:a.combine,mapUv:F&&g(a.map.channel),aoMapUv:V&&g(a.aoMap.channel),lightMapUv:j&&g(a.lightMap.channel),bumpMapUv:H&&g(a.bumpMap.channel),normalMapUv:Q&&g(a.normalMap.channel),displacementMapUv:W&&g(a.displacementMap.channel),emissiveMapUv:q&&g(a.emissiveMap.channel),metalnessMapUv:X&&g(a.metalnessMap.channel),roughnessMapUv:K&&g(a.roughnessMap.channel),anisotropyMapUv:ei&&g(a.anisotropyMap.channel),clearcoatMapUv:en&&g(a.clearcoatMap.channel),clearcoatNormalMapUv:er&&g(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:es&&g(a.clearcoatRoughnessMap.channel),iridescenceMapUv:eo&&g(a.iridescenceMap.channel),iridescenceThicknessMapUv:el&&g(a.iridescenceThicknessMap.channel),sheenColorMapUv:eh&&g(a.sheenColorMap.channel),sheenRoughnessMapUv:eu&&g(a.sheenRoughnessMap.channel),specularMapUv:ec&&g(a.specularMap.channel),specularColorMapUv:ed&&g(a.specularColorMap.channel),specularIntensityMapUv:ep&&g(a.specularIntensityMap.channel),transmissionMapUv:ef&&g(a.transmissionMap.channel),thicknessMapUv:em&&g(a.thicknessMap.channel),alphaMapUv:eA&&g(a.alphaMap.channel),vertexTangents:!!S.attributes.tangent&&(Q||Y),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!S.attributes.color&&4===S.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!S.attributes.uv&&(F||eA),fog:!!C,useFog:!0===a.fog,fogExp2:!!C&&C.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==S.morphAttributes.position,morphNormals:void 0!==S.morphAttributes.normal,morphColors:void 0!==S.morphAttributes.color,morphTargetsCount:P,morphTextureStride:D,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numLightProbes:l.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:eb,useLegacyLights:e._useLegacyLights,decodeVideoTexture:F&&!0===a.map.isVideoTexture&&i1.getTransfer(a.map.colorSpace)===tJ,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===b,flipSided:a.side===_,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:ex&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:ex&&!0===a.extensions.multiDraw&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return eE.vertexUv1s=u.has(1),eE.vertexUv2s=u.has(2),eE.vertexUv3s=u.has(3),u.clear(),eE},getProgramCacheKey:function(i){var n,r,s,a;let o=[];if(i.shaderID?o.push(i.shaderID):(o.push(i.customVertexShaderID),o.push(i.customFragmentShaderID)),void 0!==i.defines)for(let e in i.defines)o.push(e),o.push(i.defines[e]);return!1===i.isRawShaderMaterial&&(n=o,r=i,n.push(r.precision),n.push(r.outputColorSpace),n.push(r.envMapMode),n.push(r.envMapCubeUVHeight),n.push(r.mapUv),n.push(r.alphaMapUv),n.push(r.lightMapUv),n.push(r.aoMapUv),n.push(r.bumpMapUv),n.push(r.normalMapUv),n.push(r.displacementMapUv),n.push(r.emissiveMapUv),n.push(r.metalnessMapUv),n.push(r.roughnessMapUv),n.push(r.anisotropyMapUv),n.push(r.clearcoatMapUv),n.push(r.clearcoatNormalMapUv),n.push(r.clearcoatRoughnessMapUv),n.push(r.iridescenceMapUv),n.push(r.iridescenceThicknessMapUv),n.push(r.sheenColorMapUv),n.push(r.sheenRoughnessMapUv),n.push(r.specularMapUv),n.push(r.specularColorMapUv),n.push(r.specularIntensityMapUv),n.push(r.transmissionMapUv),n.push(r.thicknessMapUv),n.push(r.combine),n.push(r.fogExp2),n.push(r.sizeAttenuation),n.push(r.morphTargetsCount),n.push(r.morphAttributeCount),n.push(r.numDirLights),n.push(r.numPointLights),n.push(r.numSpotLights),n.push(r.numSpotLightMaps),n.push(r.numHemiLights),n.push(r.numRectAreaLights),n.push(r.numDirLightShadows),n.push(r.numPointLightShadows),n.push(r.numSpotLightShadows),n.push(r.numSpotLightShadowsWithMaps),n.push(r.numLightProbes),n.push(r.shadowMapType),n.push(r.toneMapping),n.push(r.numClippingPlanes),n.push(r.numClipIntersection),n.push(r.depthPacking),s=o,a=i,l.disableAll(),a.supportsVertexTextures&&l.enable(0),a.instancing&&l.enable(1),a.instancingColor&&l.enable(2),a.instancingMorph&&l.enable(3),a.matcap&&l.enable(4),a.envMap&&l.enable(5),a.normalMapObjectSpace&&l.enable(6),a.normalMapTangentSpace&&l.enable(7),a.clearcoat&&l.enable(8),a.iridescence&&l.enable(9),a.alphaTest&&l.enable(10),a.vertexColors&&l.enable(11),a.vertexAlphas&&l.enable(12),a.vertexUv1s&&l.enable(13),a.vertexUv2s&&l.enable(14),a.vertexUv3s&&l.enable(15),a.vertexTangents&&l.enable(16),a.anisotropy&&l.enable(17),a.alphaHash&&l.enable(18),a.batching&&l.enable(19),a.dispersion&&l.enable(20),s.push(l.mask),l.disableAll(),a.fog&&l.enable(0),a.useFog&&l.enable(1),a.flatShading&&l.enable(2),a.logarithmicDepthBuffer&&l.enable(3),a.skinning&&l.enable(4),a.morphTargets&&l.enable(5),a.morphNormals&&l.enable(6),a.morphColors&&l.enable(7),a.premultipliedAlpha&&l.enable(8),a.shadowMapEnabled&&l.enable(9),a.useLegacyLights&&l.enable(10),a.doubleSided&&l.enable(11),a.flipSided&&l.enable(12),a.useDepthPacking&&l.enable(13),a.dithering&&l.enable(14),a.transmission&&l.enable(15),a.sheen&&l.enable(16),a.opaque&&l.enable(17),a.pointsUvs&&l.enable(18),a.decodeVideoTexture&&l.enable(19),a.alphaToCoverage&&l.enable(20),a.numMultiviewViews&&l.enable(21),s.push(l.mask),o.push(e.outputColorSpace)),o.push(i.customProgramCacheKey),o.join()},getUniforms:function(e){let i;let n=m[e.type];if(n){let e=sS[n];i=ss.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(i,n){let r;for(let e=0,i=c.length;e<i;e++){let i=c[e];if(i.cacheKey===n){r=i,++r.usedTimes;break}}return void 0===r&&(r=new oo(e,n,i,a),c.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){let i=c.indexOf(e);c[i]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){h.remove(e)},programs:c,dispose:function(){h.dispose()}}}function od(){let e=new WeakMap;return{get:function(i){let n=e.get(i);return void 0===n&&(n={},e.set(i,n)),n},remove:function(i){e.delete(i)},update:function(i,n,r){e.get(i)[n]=r},dispose:function(){e=new WeakMap}}}function op(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.material.id!==i.material.id?e.material.id-i.material.id:e.z!==i.z?e.z-i.z:e.id-i.id}function of(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.z!==i.z?i.z-e.z:e.id-i.id}function om(){let e=[],i=0,n=[],r=[],s=[];function a(n,r,s,a,o,l){let h=e[i];return void 0===h?(h={id:n.id,object:n,geometry:r,material:s,groupOrder:a,renderOrder:n.renderOrder,z:o,group:l},e[i]=h):(h.id=n.id,h.object=n,h.geometry=r,h.material=s,h.groupOrder=a,h.renderOrder=n.renderOrder,h.z=o,h.group=l),i++,h}return{opaque:n,transmissive:r,transparent:s,init:function(){i=0,n.length=0,r.length=0,s.length=0},push:function(e,i,o,l,h,u){let c=a(e,i,o,l,h,u);o.transmission>0?r.push(c):!0===o.transparent?s.push(c):n.push(c)},unshift:function(e,i,o,l,h,u){let c=a(e,i,o,l,h,u);o.transmission>0?r.unshift(c):!0===o.transparent?s.unshift(c):n.unshift(c)},finish:function(){for(let n=i,r=e.length;n<r;n++){let i=e[n];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.group=null}},sort:function(e,i){n.length>1&&n.sort(e||op),r.length>1&&r.sort(i||of),s.length>1&&s.sort(i||of)}}}function og(){let e=new WeakMap;return{get:function(i,n){let r;let s=e.get(i);return void 0===s?(r=new om,e.set(i,[r])):n>=s.length?(r=new om,s.push(r)):r=s[n],r},dispose:function(){e=new WeakMap}}}function oA(){let e={};return{get:function(i){let n;if(void 0!==e[i.id])return e[i.id];switch(i.type){case"DirectionalLight":n={direction:new nl,color:new rA};break;case"SpotLight":n={position:new nl,direction:new nl,color:new rA,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new nl,color:new rA,distance:0,decay:0};break;case"HemisphereLight":n={direction:new nl,skyColor:new rA,groundColor:new rA};break;case"RectAreaLight":n={color:new rA,position:new nl,halfWidth:new nl,halfHeight:new nl}}return e[i.id]=n,n}}}let ov=0;function oy(e,i){return 2*!!i.castShadow-2*!!e.castShadow+ +!!i.map-+!!e.map}function ox(e){let i=new oA,n=function(){let e={};return{get:function(i){let n;if(void 0!==e[i.id])return e[i.id];switch(i.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new iG};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new iG,shadowCameraNear:1,shadowCameraFar:1e3}}return e[i.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new nl);let s=new nl,a=new nk,o=new nk;return{setup:function(s,a){let o=0,l=0,h=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,c=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,y=0,x=0;s.sort(oy);let _=!0===a?Math.PI:1;for(let e=0,a=s.length;e<a;e++){let a=s[e],b=a.color,E=a.intensity,w=a.distance,M=a.shadow&&a.shadow.map?a.shadow.map.texture:null;if(a.isAmbientLight)o+=b.r*E*_,l+=b.g*E*_,h+=b.b*E*_;else if(a.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(a.sh.coefficients[e],E);x++}else if(a.isDirectionalLight){let e=i.get(a);if(e.color.copy(a.color).multiplyScalar(a.intensity*_),a.castShadow){let e=a.shadow,i=n.get(a);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[u]=i,r.directionalShadowMap[u]=M,r.directionalShadowMatrix[u]=a.shadow.matrix,m++}r.directional[u]=e,u++}else if(a.isSpotLight){let e=i.get(a);e.position.setFromMatrixPosition(a.matrixWorld),e.color.copy(b).multiplyScalar(E*_),e.distance=w,e.coneCos=Math.cos(a.angle),e.penumbraCos=Math.cos(a.angle*(1-a.penumbra)),e.decay=a.decay,r.spot[d]=e;let s=a.shadow;if(a.map&&(r.spotLightMap[v]=a.map,v++,s.updateMatrices(a),a.castShadow&&y++),r.spotLightMatrix[d]=s.matrix,a.castShadow){let e=n.get(a);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=M,A++}d++}else if(a.isRectAreaLight){let e=i.get(a);e.color.copy(b).multiplyScalar(E),e.halfWidth.set(.5*a.width,0,0),e.halfHeight.set(0,.5*a.height,0),r.rectArea[p]=e,p++}else if(a.isPointLight){let e=i.get(a);if(e.color.copy(a.color).multiplyScalar(a.intensity*_),e.distance=a.distance,e.decay=a.decay,a.castShadow){let e=a.shadow,i=n.get(a);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[c]=i,r.pointShadowMap[c]=M,r.pointShadowMatrix[c]=a.shadow.matrix,g++}r.point[c]=e,c++}else if(a.isHemisphereLight){let e=i.get(a);e.skyColor.copy(a.color).multiplyScalar(E*_),e.groundColor.copy(a.groundColor).multiplyScalar(E*_),r.hemi[f]=e,f++}}p>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=sC.LTC_FLOAT_1,r.rectAreaLTC2=sC.LTC_FLOAT_2):(r.rectAreaLTC1=sC.LTC_HALF_1,r.rectAreaLTC2=sC.LTC_HALF_2)),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=h;let b=r.hash;(b.directionalLength!==u||b.pointLength!==c||b.spotLength!==d||b.rectAreaLength!==p||b.hemiLength!==f||b.numDirectionalShadows!==m||b.numPointShadows!==g||b.numSpotShadows!==A||b.numSpotMaps!==v||b.numLightProbes!==x)&&(r.directional.length=u,r.spot.length=d,r.rectArea.length=p,r.point.length=c,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=A,r.spotShadowMap.length=A,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=A+v-y,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=y,r.numLightProbes=x,b.directionalLength=u,b.pointLength=c,b.spotLength=d,b.rectAreaLength=p,b.hemiLength=f,b.numDirectionalShadows=m,b.numPointShadows=g,b.numSpotShadows=A,b.numSpotMaps=v,b.numLightProbes=x,r.version=ov++)},setupView:function(e,i){let n=0,l=0,h=0,u=0,c=0,d=i.matrixWorldInverse;for(let i=0,p=e.length;i<p;i++){let p=e[i];if(p.isDirectionalLight){let e=r.directional[n];e.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(d),n++}else if(p.isSpotLight){let e=r.spot[h];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(d),h++}else if(p.isRectAreaLight){let e=r.rectArea[u];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(d),o.identity(),a.copy(p.matrixWorld),a.premultiply(d),o.extractRotation(a),e.halfWidth.set(.5*p.width,0,0),e.halfHeight.set(0,.5*p.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),u++}else if(p.isPointLight){let e=r.point[l];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(d),l++}else if(p.isHemisphereLight){let e=r.hemi[c];e.direction.setFromMatrixPosition(p.matrixWorld),e.direction.transformDirection(d),c++}}},state:r}}function o_(e){let i=new ox(e),n=[],r=[],s={lightsArray:n,shadowsArray:r,camera:null,lights:i,transmissionRenderTarget:{}};return{init:function(e){s.camera=e,n.length=0,r.length=0},state:s,setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function ob(e){let i=new WeakMap;return{get:function(n,r=0){let s;let a=i.get(n);return void 0===a?(s=new o_(e),i.set(n,[s])):r>=a.length?(s=new o_(e),a.push(s)):s=a[r],s},dispose:function(){i=new WeakMap}}}class oE extends rx{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=tG,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class ow extends rx{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function oM(e,i,n){let r=new s_,s=new iG,a=new iG,o=new ne,l=new oE({depthPacking:tV}),h=new ow,u={},c=n.maxTextureSize,d={[x]:_,[_]:x,[b]:b},p=new sa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new iG},radius:{value:4}},vertexShader:"void main() {\n	gl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n	const float samples = float( VSM_SAMPLES );\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=p.clone();f.defines.HORIZONTAL_PASS=1;let m=new rQ;m.setAttribute("position",new rT(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new r9(m,p),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=A;let w=this.type;function M(i,n,r,s){let a=null,o=!0===r.isPointLight?i.customDistanceMaterial:i.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===r.isPointLight?h:l,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){let e=a.uuid,i=n.uuid,r=u[e];void 0===r&&(r={},u[e]=r);let s=r[i];void 0===s&&(s=a.clone(),r[i]=s,n.addEventListener("dispose",C)),a=s}return a.visible=n.visible,a.wireframe=n.wireframe,s===y?a.side=null!==n.shadowSide?n.shadowSide:n.side:a.side=null!==n.shadowSide?n.shadowSide:d[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=r),a}function C(e){for(let i in e.target.removeEventListener("dispose",C),u){let n=u[i],r=e.target.uuid;r in n&&(n[r].dispose(),delete n[r])}}this.render=function(n,l,h){if(!1===v.enabled||!1===v.autoUpdate&&!1===v.needsUpdate||0===n.length)return;let u=e.getRenderTarget(),d=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),A=e.state;A.setBlending(E),A.buffers.color.setClear(1,1,1,1),A.buffers.depth.setTest(!0),A.setScissorTest(!1);let x=w!==y&&this.type===y,_=w===y&&this.type!==y;for(let u=0,d=n.length;u<d;u++){let d=n[u],m=d.shadow;if(void 0===m){console.warn("THREE.WebGLShadowMap:",d,"has no shadow.");continue}if(!1===m.autoUpdate&&!1===m.needsUpdate)continue;s.copy(m.mapSize);let v=m.getFrameExtents();if(s.multiply(v),a.copy(m.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(a.x=Math.floor(c/v.x),s.x=a.x*v.x,m.mapSize.x=a.x),s.y>c&&(a.y=Math.floor(c/v.y),s.y=a.y*v.y,m.mapSize.y=a.y)),null===m.map||!0===x||!0===_){let e=this.type!==y?{minFilter:eM,magFilter:eM}:{};null!==m.map&&m.map.dispose(),m.map=new ni(s.x,s.y,e),m.map.texture.name=d.name+".shadowMap",m.camera.updateProjectionMatrix()}e.setRenderTarget(m.map),e.clear();let b=m.getViewportCount();for(let n=0;n<b;n++){let s=m.getViewport(n);o.set(a.x*s.x,a.y*s.y,a.x*s.z,a.y*s.w),A.viewport(o),m.updateMatrices(d,n),r=m.getFrustum(),function n(s,a,o,l,h){if(!1===s.visible)return;if(s.layers.test(a.layers)&&(s.isMesh||s.isLine||s.isPoints)&&(s.castShadow||s.receiveShadow&&h===y)&&(!s.frustumCulled||r.intersectsObject(s))){s.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,s.matrixWorld);let n=i.update(s),r=s.material;if(Array.isArray(r)){let i=n.groups;for(let u=0,c=i.length;u<c;u++){let c=i[u],d=r[c.materialIndex];if(d&&d.visible){let i=M(s,d,l,h);s.onBeforeShadow(e,s,a,o,n,i,c),e.renderBufferDirect(o,null,n,i,s,c),s.onAfterShadow(e,s,a,o,n,i,c)}}}else if(r.visible){let i=M(s,r,l,h);s.onBeforeShadow(e,s,a,o,n,i,null),e.renderBufferDirect(o,null,n,i,s,null),s.onAfterShadow(e,s,a,o,n,i,null)}}let u=s.children;for(let e=0,i=u.length;e<i;e++)n(u[e],a,o,l,h)}(l,h,m.camera,d,this.type)}!0!==m.isPointLightShadow&&this.type===y&&function(n,r){let a=i.update(g);p.defines.VSM_SAMPLES!==n.blurSamples&&(p.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,p.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new ni(s.x,s.y)),p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,p,g,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,f,g,null)}(m,h),m.needsUpdate=!1}w=this.type,v.needsUpdate=!1,e.setRenderTarget(u,d,m)}}function oC(e){let i=new function(){let i=!1,n=new ne,r=null,s=new ne(0,0,0,0);return{setMask:function(n){r===n||i||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){i=e},setClear:function(i,r,a,o,l){!0===l&&(i*=o,r*=o,a*=o),n.set(i,r,a,o),!1===s.equals(n)&&(e.clearColor(i,r,a,o),s.copy(n))},reset:function(){i=!1,r=null,s.set(-1,0,0,0)}}},n=new function(){let i=!1,n=null,r=null,s=null;return{setTest:function(i){i?eM(e.DEPTH_TEST):eC(e.DEPTH_TEST)},setMask:function(r){n===r||i||(e.depthMask(r),n=r)},setFunc:function(i){if(r!==i){switch(i){case K:e.depthFunc(e.NEVER);break;case Y:e.depthFunc(e.ALWAYS);break;case J:e.depthFunc(e.LESS);break;case Z:e.depthFunc(e.LEQUAL);break;case $:e.depthFunc(e.EQUAL);break;case ee:e.depthFunc(e.GEQUAL);break;case et:e.depthFunc(e.GREATER);break;case ei:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}r=i}},setLocked:function(e){i=e},setClear:function(i){s!==i&&(e.clearDepth(i),s=i)},reset:function(){i=!1,n=null,r=null,s=null}}},r=new function(){let i=!1,n=null,r=null,s=null,a=null,o=null,l=null,h=null,u=null;return{setTest:function(n){i||(n?eM(e.STENCIL_TEST):eC(e.STENCIL_TEST))},setMask:function(r){n===r||i||(e.stencilMask(r),n=r)},setFunc:function(i,n,o){(r!==i||s!==n||a!==o)&&(e.stencilFunc(i,n,o),r=i,s=n,a=o)},setOp:function(i,n,r){(o!==i||l!==n||h!==r)&&(e.stencilOp(i,n,r),o=i,l=n,h=r)},setLocked:function(e){i=e},setClear:function(i){u!==i&&(e.clearStencil(i),u=i)},reset:function(){i=!1,n=null,r=null,s=null,a=null,o=null,l=null,h=null,u=null}}},s=new WeakMap,a=new WeakMap,o={},l={},h=new WeakMap,u=[],c=null,m=!1,g=null,A=null,v=null,y=null,x=null,en=null,er=null,es=new rA(0,0,0),ea=0,eo=!1,el=null,eh=null,eu=null,ec=null,ed=null,ep=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),ef=!1,em=0,eg=e.getParameter(e.VERSION);-1!==eg.indexOf("WebGL")?ef=parseFloat(/^WebGL (\d)/.exec(eg)[1])>=1:-1!==eg.indexOf("OpenGL ES")&&(ef=parseFloat(/^OpenGL ES (\d)/.exec(eg)[1])>=2);let eA=null,ev={},ey=e.getParameter(e.SCISSOR_BOX),ex=e.getParameter(e.VIEWPORT),e_=new ne().fromArray(ey),eb=new ne().fromArray(ex);function eE(i,n,r,s){let a=new Uint8Array(4),o=e.createTexture();e.bindTexture(i,o),e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<r;o++)i===e.TEXTURE_3D||i===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}let ew={};function eM(i){!0!==o[i]&&(e.enable(i),o[i]=!0)}function eC(i){!1!==o[i]&&(e.disable(i),o[i]=!1)}ew[e.TEXTURE_2D]=eE(e.TEXTURE_2D,e.TEXTURE_2D,1),ew[e.TEXTURE_CUBE_MAP]=eE(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),ew[e.TEXTURE_2D_ARRAY]=eE(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),ew[e.TEXTURE_3D]=eE(e.TEXTURE_3D,e.TEXTURE_3D,1,1),i.setClear(0,0,0,1),n.setClear(1),r.setClear(0),eM(e.DEPTH_TEST),n.setFunc(Z),eI(!1),eB(p),eM(e.CULL_FACE),eR(E);let eS={[R]:e.FUNC_ADD,[I]:e.FUNC_SUBTRACT,[B]:e.FUNC_REVERSE_SUBTRACT};eS[L]=e.MIN,eS[P]=e.MAX;let eT={[D]:e.ZERO,[N]:e.ONE,[O]:e.SRC_COLOR,[k]:e.SRC_ALPHA,[H]:e.SRC_ALPHA_SATURATE,[V]:e.DST_COLOR,[z]:e.DST_ALPHA,[U]:e.ONE_MINUS_SRC_COLOR,[F]:e.ONE_MINUS_SRC_ALPHA,[j]:e.ONE_MINUS_DST_COLOR,[G]:e.ONE_MINUS_DST_ALPHA,[Q]:e.CONSTANT_COLOR,[W]:e.ONE_MINUS_CONSTANT_COLOR,[q]:e.CONSTANT_ALPHA,[X]:e.ONE_MINUS_CONSTANT_ALPHA};function eR(i,n,r,s,a,o,l,h,u,c){if(i===E){!0===m&&(eC(e.BLEND),m=!1);return}if(!1===m&&(eM(e.BLEND),m=!0),i!==T){if(i!==g||c!==eo){if((A!==R||x!==R)&&(e.blendEquation(e.FUNC_ADD),A=R,x=R),c)switch(i){case w:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case M:e.blendFunc(e.ONE,e.ONE);break;case C:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case S:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",i)}else switch(i){case w:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case M:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case C:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case S:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",i)}v=null,y=null,en=null,er=null,es.set(0,0,0),ea=0,g=i,eo=c}return}a=a||n,o=o||r,l=l||s,(n!==A||a!==x)&&(e.blendEquationSeparate(eS[n],eS[a]),A=n,x=a),(r!==v||s!==y||o!==en||l!==er)&&(e.blendFuncSeparate(eT[r],eT[s],eT[o],eT[l]),v=r,y=s,en=o,er=l),(!1===h.equals(es)||u!==ea)&&(e.blendColor(h.r,h.g,h.b,u),es.copy(h),ea=u),g=i,eo=!1}function eI(i){el!==i&&(i?e.frontFace(e.CW):e.frontFace(e.CCW),el=i)}function eB(i){i!==d?(eM(e.CULL_FACE),i!==eh&&(i===p?e.cullFace(e.BACK):i===f?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):eC(e.CULL_FACE),eh=i}function eL(i,n,r){i?(eM(e.POLYGON_OFFSET_FILL),(ec!==n||ed!==r)&&(e.polygonOffset(n,r),ec=n,ed=r)):eC(e.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:n,stencil:r},enable:eM,disable:eC,bindFramebuffer:function(i,n){return l[i]!==n&&(e.bindFramebuffer(i,n),l[i]=n,i===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),i===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(i,n){let r=u,s=!1;if(i){void 0===(r=h.get(n))&&(r=[],h.set(n,r));let a=i.textures;if(r.length!==a.length||r[0]!==e.COLOR_ATTACHMENT0){for(let i=0,n=a.length;i<n;i++)r[i]=e.COLOR_ATTACHMENT0+i;r.length=a.length,s=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,s=!0);s&&e.drawBuffers(r)},useProgram:function(i){return c!==i&&(e.useProgram(i),c=i,!0)},setBlending:eR,setMaterial:function(s,a){s.side===b?eC(e.CULL_FACE):eM(e.CULL_FACE);let o=s.side===_;a&&(o=!o),eI(o),s.blending===w&&!1===s.transparent?eR(E):eR(s.blending,s.blendEquation,s.blendSrc,s.blendDst,s.blendEquationAlpha,s.blendSrcAlpha,s.blendDstAlpha,s.blendColor,s.blendAlpha,s.premultipliedAlpha),n.setFunc(s.depthFunc),n.setTest(s.depthTest),n.setMask(s.depthWrite),i.setMask(s.colorWrite);let l=s.stencilWrite;r.setTest(l),l&&(r.setMask(s.stencilWriteMask),r.setFunc(s.stencilFunc,s.stencilRef,s.stencilFuncMask),r.setOp(s.stencilFail,s.stencilZFail,s.stencilZPass)),eL(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits),!0===s.alphaToCoverage?eM(e.SAMPLE_ALPHA_TO_COVERAGE):eC(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:eI,setCullFace:eB,setLineWidth:function(i){i!==eu&&(ef&&e.lineWidth(i),eu=i)},setPolygonOffset:eL,setScissorTest:function(i){i?eM(e.SCISSOR_TEST):eC(e.SCISSOR_TEST)},activeTexture:function(i){void 0===i&&(i=e.TEXTURE0+ep-1),eA!==i&&(e.activeTexture(i),eA=i)},bindTexture:function(i,n,r){void 0===r&&(r=null===eA?e.TEXTURE0+ep-1:eA);let s=ev[r];void 0===s&&(s={type:void 0,texture:void 0},ev[r]=s),(s.type!==i||s.texture!==n)&&(eA!==r&&(e.activeTexture(r),eA=r),e.bindTexture(i,n||ew[i]),s.type=i,s.texture=n)},unbindTexture:function(){let i=ev[eA];void 0!==i&&void 0!==i.type&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(i,n){let r=a.get(n);void 0===r&&(r=new WeakMap,a.set(n,r));let s=r.get(i);void 0===s&&(s=e.getUniformBlockIndex(n,i.name),r.set(i,s))},uniformBlockBinding:function(i,n){let r=a.get(n).get(i);s.get(n)!==r&&(e.uniformBlockBinding(n,r,i.__bindingPointIndex),s.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(i){!1===e_.equals(i)&&(e.scissor(i.x,i.y,i.z,i.w),e_.copy(i))},viewport:function(i){!1===eb.equals(i)&&(e.viewport(i.x,i.y,i.z,i.w),eb.copy(i))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(0xffffffff),e.stencilFunc(e.ALWAYS,0,0xffffffff),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},eA=null,ev={},l={},h=new WeakMap,u=[],c=null,m=!1,g=null,A=null,v=null,y=null,x=null,en=null,er=null,es=new rA(0,0,0),ea=0,eo=!1,el=null,eh=null,eu=null,ec=null,ed=null,e_.set(0,0,e.canvas.width,e.canvas.height),eb.set(0,0,e.canvas.width,e.canvas.height),i.reset(),n.reset(),r.reset()}}}function oS(e,i,n,r,s,a,o){let l;let h=i.has("WEBGL_multisampled_render_to_texture")?i.get("WEBGL_multisampled_render_to_texture"):null,u="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=i.has("OCULUS_multiview")?i.get("OCULUS_multiview"):null,d=new iG,p=new WeakMap,f=new WeakMap,m=[],g=!1,A=!1;try{A="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,i){return A?new OffscreenCanvas(e,i):iq("canvas")}function y(e,i,n){let r=1,s=Q(e);if((s.width>n||s.height>n)&&(r=n/Math.max(s.width,s.height)),r<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){let n=Math.floor(r*s.width),a=Math.floor(r*s.height);void 0===l&&(l=v(n,a));let o=i?v(n,a):l;return o.width=n,o.height=a,o.getContext("2d").drawImage(e,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+s.width+"x"+s.height+") to ("+n+"x"+a+")."),o}"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+s.width+"x"+s.height+").")}return e}function x(e){return e.generateMipmaps&&e.minFilter!==eM&&e.minFilter!==eI}function _(i){e.generateMipmap(i)}function b(n,r,s,a,o=!1){if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=r;if(r===e.RED&&(s===e.FLOAT&&(l=e.R32F),s===e.HALF_FLOAT&&(l=e.R16F),s===e.UNSIGNED_BYTE&&(l=e.R8)),r===e.RED_INTEGER&&(s===e.UNSIGNED_BYTE&&(l=e.R8UI),s===e.UNSIGNED_SHORT&&(l=e.R16UI),s===e.UNSIGNED_INT&&(l=e.R32UI),s===e.BYTE&&(l=e.R8I),s===e.SHORT&&(l=e.R16I),s===e.INT&&(l=e.R32I)),r===e.RG&&(s===e.FLOAT&&(l=e.RG32F),s===e.HALF_FLOAT&&(l=e.RG16F),s===e.UNSIGNED_BYTE&&(l=e.RG8)),r===e.RG_INTEGER&&(s===e.UNSIGNED_BYTE&&(l=e.RG8UI),s===e.UNSIGNED_SHORT&&(l=e.RG16UI),s===e.UNSIGNED_INT&&(l=e.RG32UI),s===e.BYTE&&(l=e.RG8I),s===e.SHORT&&(l=e.RG16I),s===e.INT&&(l=e.RG32I)),r===e.RGB&&s===e.UNSIGNED_INT_5_9_9_9_REV&&(l=e.RGB9_E5),r===e.RGBA){let i=o?tY:i1.getTransfer(a);s===e.FLOAT&&(l=e.RGBA32F),s===e.HALF_FLOAT&&(l=e.RGBA16F),s===e.UNSIGNED_BYTE&&(l=i===tJ?e.SRGB8_ALPHA8:e.RGBA8),s===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),s===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return(l===e.R16F||l===e.R32F||l===e.RG16F||l===e.RG32F||l===e.RGBA16F||l===e.RGBA32F)&&i.get("EXT_color_buffer_float"),l}function E(e,i){return!0===x(e)||e.isFramebufferTexture&&e.minFilter!==eM&&e.minFilter!==eI?Math.log2(Math.max(i.width,i.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?i.mipmaps.length:1}function w(e){let i=e.target;i.removeEventListener("dispose",w),function(e){let i=r.get(e);if(void 0===i.__webglInit)return;let n=e.source,s=f.get(n);if(s){let r=s[i.__cacheKey];r.usedTimes--,0===r.usedTimes&&C(e),0===Object.keys(s).length&&f.delete(n)}r.remove(e)}(i),i.isVideoTexture&&p.delete(i)}function M(i){let n=i.target;n.removeEventListener("dispose",M),function(i){let n=r.get(i);if(i.depthTexture&&i.depthTexture.dispose(),i.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let r=0;r<n.__webglFramebuffer[i].length;r++)e.deleteFramebuffer(n.__webglFramebuffer[i][r]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let i=0;i<n.__webglFramebuffer.length;i++)e.deleteFramebuffer(n.__webglFramebuffer[i]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let i=0;i<n.__webglColorRenderbuffer.length;i++)n.__webglColorRenderbuffer[i]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[i]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}let s=i.textures;for(let i=0,n=s.length;i<n;i++){let n=r.get(s[i]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),o.memory.textures--),r.remove(s[i])}r.remove(i)}(n)}function C(i){let n=r.get(i);e.deleteTexture(n.__webglTexture);let s=i.source,a=f.get(s);delete a[n.__cacheKey],o.memory.textures--}let S=0;function T(i,s){let a=r.get(i);if(i.isVideoTexture&&function(e){let i=o.render.frame;p.get(e)!==i&&(p.set(e,i),e.update())}(i),!1===i.isRenderTargetTexture&&i.version>0&&a.__version!==i.version){let e=i.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===e.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else if(N(a,i,s))return}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+s)}function R(i,s){let a=r.get(i);if(i.version>0&&a.__version!==i.version){N(a,i,s);return}n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+s)}let I={[eb]:e.REPEAT,[eE]:e.CLAMP_TO_EDGE,[ew]:e.MIRRORED_REPEAT},B={[eM]:e.NEAREST,[eC]:e.NEAREST_MIPMAP_NEAREST,[eT]:e.NEAREST_MIPMAP_LINEAR,[eI]:e.LINEAR,[eB]:e.LINEAR_MIPMAP_NEAREST,[eP]:e.LINEAR_MIPMAP_LINEAR},L={[io]:e.NEVER,[im]:e.ALWAYS,[il]:e.LESS,[iu]:e.LEQUAL,[ih]:e.EQUAL,[ip]:e.GEQUAL,[ic]:e.GREATER,[id]:e.NOTEQUAL};function P(n,a){if(a.type===eG&&!1===i.has("OES_texture_float_linear")&&(a.magFilter===eI||a.magFilter===eB||a.magFilter===eT||a.magFilter===eP||a.minFilter===eI||a.minFilter===eB||a.minFilter===eT||a.minFilter===eP)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,I[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,I[a.wrapT]),(n===e.TEXTURE_3D||n===e.TEXTURE_2D_ARRAY)&&e.texParameteri(n,e.TEXTURE_WRAP_R,I[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,B[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,B[a.minFilter]),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,L[a.compareFunction])),!0===i.has("EXT_texture_filter_anisotropic")&&a.magFilter!==eM&&(a.minFilter===eT||a.minFilter===eP)&&(a.type!==eG||!1!==i.has("OES_texture_float_linear"))&&(a.anisotropy>1||r.get(a).__currentAnisotropy)){let o=i.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,s.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}function D(i,n){let r=!1;void 0===i.__webglInit&&(i.__webglInit=!0,n.addEventListener("dispose",w));let s=n.source,a=f.get(s);void 0===a&&(a={},f.set(s,a));let l=function(e){let i=[];return i.push(e.wrapS),i.push(e.wrapT),i.push(e.wrapR||0),i.push(e.magFilter),i.push(e.minFilter),i.push(e.anisotropy),i.push(e.internalFormat),i.push(e.format),i.push(e.type),i.push(e.generateMipmaps),i.push(e.premultiplyAlpha),i.push(e.flipY),i.push(e.unpackAlignment),i.push(e.colorSpace),i.join()}(n);if(l!==i.__cacheKey){void 0===a[l]&&(a[l]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[l].usedTimes++;let s=a[i.__cacheKey];void 0!==s&&(a[i.__cacheKey].usedTimes--,0===s.usedTimes&&C(n)),i.__cacheKey=l,i.__webglTexture=a[l].texture}return r}function N(i,o,l){if(g)return o.isPendingDeferredUpload||(o.isPendingDeferredUpload=!0,m.push({textureProperties:i,texture:o,slot:l})),!1;let h=e.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(h=e.TEXTURE_2D_ARRAY),o.isData3DTexture&&(h=e.TEXTURE_3D);let u=D(i,o),c=o.source;n.bindTexture(h,i.__webglTexture,e.TEXTURE0+l);let d=r.get(c);if(c.version!==d.__version||!0===u){let i;n.activeTexture(e.TEXTURE0+l);let r=i1.getPrimaries(i1.workingColorSpace),p=o.colorSpace===tQ?null:i1.getPrimaries(o.colorSpace),f=o.colorSpace===tQ||r===p?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);let m=y(o.image,!1,s.maxTextureSize);m=H(o,m);let g=a.convert(o.format,o.colorSpace),A=a.convert(o.type),v=b(o.internalFormat,g,A,o.colorSpace,o.isVideoTexture);P(h,o);let w=o.mipmaps,M=!0!==o.isVideoTexture,C=void 0===d.__version||!0===u,S=c.dataReady,T=E(o,m);if(o.isDepthTexture)v=e.DEPTH_COMPONENT16,o.type===eG?v=e.DEPTH_COMPONENT32F:o.type===ez?v=e.DEPTH_COMPONENT24:o.type===eQ&&(v=e.DEPTH24_STENCIL8),C&&(M?n.texStorage2D(e.TEXTURE_2D,1,v,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,v,m.width,m.height,0,g,A,null));else if(o.isDataTexture){if(w.length>0){M&&C&&n.texStorage2D(e.TEXTURE_2D,T,v,w[0].width,w[0].height);for(let r=0,s=w.length;r<s;r++)i=w[r],M?S&&n.texSubImage2D(e.TEXTURE_2D,r,0,0,i.width,i.height,g,A,i.data):n.texImage2D(e.TEXTURE_2D,r,v,i.width,i.height,0,g,A,i.data);o.generateMipmaps=!1}else M?(C&&n.texStorage2D(e.TEXTURE_2D,T,v,m.width,m.height),S&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,g,A,m.data)):n.texImage2D(e.TEXTURE_2D,0,v,m.width,m.height,0,g,A,m.data)}else if(o.isCompressedTexture){if(o.isCompressedArrayTexture){M&&C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,T,v,w[0].width,w[0].height,m.depth);for(let r=0,s=w.length;r<s;r++)i=w[r],o.format!==eK?null!==g?M?S&&n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,r,0,0,0,i.width,i.height,m.depth,g,i.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,r,v,i.width,i.height,m.depth,0,i.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?S&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,r,0,0,0,i.width,i.height,m.depth,g,A,i.data):n.texImage3D(e.TEXTURE_2D_ARRAY,r,v,i.width,i.height,m.depth,0,g,A,i.data)}else{M&&C&&n.texStorage2D(e.TEXTURE_2D,T,v,w[0].width,w[0].height);for(let r=0,s=w.length;r<s;r++)i=w[r],o.format!==eK?null!==g?M?S&&n.compressedTexSubImage2D(e.TEXTURE_2D,r,0,0,i.width,i.height,g,i.data):n.compressedTexImage2D(e.TEXTURE_2D,r,v,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?S&&n.texSubImage2D(e.TEXTURE_2D,r,0,0,i.width,i.height,g,A,i.data):n.texImage2D(e.TEXTURE_2D,r,v,i.width,i.height,0,g,A,i.data)}}else if(o.isDataArrayTexture)M?(C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,T,v,m.width,m.height,m.depth),S&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,g,A,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,v,m.width,m.height,m.depth,0,g,A,m.data);else if(o.isData3DTexture)M?(C&&n.texStorage3D(e.TEXTURE_3D,T,v,m.width,m.height,m.depth),S&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,g,A,m.data)):n.texImage3D(e.TEXTURE_3D,0,v,m.width,m.height,m.depth,0,g,A,m.data);else if(o.isFramebufferTexture){if(C){if(M)n.texStorage2D(e.TEXTURE_2D,T,v,m.width,m.height);else{let i=m.width,r=m.height;for(let s=0;s<T;s++)n.texImage2D(e.TEXTURE_2D,s,v,i,r,0,g,A,null),i>>=1,r>>=1}}}else if(w.length>0){if(M&&C){let i=Q(w[0]);n.texStorage2D(e.TEXTURE_2D,T,v,i.width,i.height)}for(let r=0,s=w.length;r<s;r++)i=w[r],M?S&&n.texSubImage2D(e.TEXTURE_2D,r,0,0,g,A,i):n.texImage2D(e.TEXTURE_2D,r,v,g,A,i);o.generateMipmaps=!1}else if(M){if(C){let i=Q(m);n.texStorage2D(e.TEXTURE_2D,T,v,i.width,i.height)}S&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,g,A,m)}else n.texImage2D(e.TEXTURE_2D,0,v,g,A,m);x(o)&&_(h),d.__version=c.version,o.onUpdate&&o.onUpdate(o)}return i.__version=o.version,!0}function O(i,s,o,l,u,d){let p=a.convert(o.format,o.colorSpace),f=a.convert(o.type),m=b(o.internalFormat,p,f,o.colorSpace);if(!r.get(s).__hasExternalTextures){let i=Math.max(1,s.width>>d),r=Math.max(1,s.height>>d);!0===s.isWebGLMultiviewRenderTarget?n.texStorage3D(e.TEXTURE_2D_ARRAY,0,m,s.width,s.height,s.numViews):u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?n.texImage3D(u,d,m,i,r,s.depth,0,p,f,null):n.texImage2D(u,d,m,i,r,0,p,f,null)}n.bindFramebuffer(e.FRAMEBUFFER,i);let g=j(s);!0===s.isWebGLMultiviewRenderTarget?g?c.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,r.get(o).__webglTexture,0,V(s),0,s.numViews):c.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,r.get(o).__webglTexture,0,0,s.numViews):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&(g?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,u,r.get(o).__webglTexture,0,V(s)):e.framebufferTexture2D(e.FRAMEBUFFER,l,u,r.get(o).__webglTexture,d)),n.bindFramebuffer(e.FRAMEBUFFER,null)}function U(i,n,s){if(e.bindRenderbuffer(e.RENDERBUFFER,i),!0===n.isWebGLMultiviewRenderTarget){let i=j(n),s=n.numViews,a=n.depthTexture,o=e.DEPTH_COMPONENT24,l=e.DEPTH_ATTACHMENT;a&&a.isDepthTexture&&(a.type===eG?o=e.DEPTH_COMPONENT32F:a.type===eQ&&(o=e.DEPTH24_STENCIL8,l=e.DEPTH_STENCIL_ATTACHMENT));let h=r.get(n.depthTexture).__webglTexture;void 0===h&&(h=e.createTexture(),e.bindTexture(e.TEXTURE_2D_ARRAY,h),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,o,n.width,n.height,s)),i?c.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,l,h,0,V(n),0,s):c.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,l,h,0,0,s)}else if(n.depthBuffer&&!n.stencilBuffer){let r=e.DEPTH_COMPONENT24;if(s||j(n)){let i=n.depthTexture;i&&i.isDepthTexture&&(i.type===eG?r=e.DEPTH_COMPONENT32F:i.type===ez&&(r=e.DEPTH_COMPONENT24));let s=V(n);j(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,s,r,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,s,r,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i)}else if(n.depthBuffer&&n.stencilBuffer){let r=V(n);s&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):j(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,i)}else{let i=n.textures;for(let r=0;r<i.length;r++){let o=i[r],l=a.convert(o.format,o.colorSpace),u=a.convert(o.type),c=b(o.internalFormat,l,u,o.colorSpace),d=V(n);s&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,c,n.width,n.height):j(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function k(i,s){if(s&&s.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,i),!(s.depthTexture&&s.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),T(s.depthTexture,0),1!=s.depthTexture.image.depth?R(s.depthTexture,0):T(s.depthTexture,0);let a=r.get(s.depthTexture).__webglTexture,o=V(s);if(!0===s.isWebGLMultiviewRenderTarget){let i=j(s),n=s.numViews;if(s.depthTexture.format===eZ)i?c.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,a,0,o,0,n):c.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,a,0,0,n);else if(s.depthTexture.format===e$)i?c.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,a,0,o,0,n):c.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,a,0,0,n);else throw Error("Unknown depthTexture format")}else if(s.depthTexture.format===eZ)j(s)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else if(s.depthTexture.format===e$)j(s)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0);else throw Error("Unknown depthTexture format")}function F(i){let s=r.get(i),a=!0===i.isWebGLCubeRenderTarget;if(i.depthTexture&&!s.__autoAllocateDepthBuffer){if(a)throw Error("target.depthTexture not supported in Cube render targets");k(s.__webglFramebuffer,i)}else if(a){s.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer[r]),s.__webglDepthbuffer[r]=e.createRenderbuffer(),U(s.__webglDepthbuffer[r],i,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer),s.__webglDepthbuffer=e.createRenderbuffer(),U(s.__webglDepthbuffer,i,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}let z=[],G=[];function V(e){return Math.min(s.maxSamples,e.samples)}function j(e){let n=r.get(e);return e.samples>0&&!0===i.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,i){let n=e.colorSpace,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==tq&&n!==tQ&&(i1.getTransfer(n)===tJ?(r!==eK||s!==eN)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),i}function Q(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(d.width=e.naturalWidth||e.width,d.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(d.width=e.displayWidth,d.height=e.displayHeight):(d.width=e.width,d.height=e.height),d}this.allocateTextureUnit=function(){let e=S;return e>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+s.maxTextures),S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=R,this.setTexture3D=function(i,s){let a=r.get(i);if(i.version>0&&a.__version!==i.version){N(a,i,s);return}n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+s)},this.setTextureCube=function(i,o){let l=r.get(i);if(i.version>0&&l.__version!==i.version){(function(i,o,l){if(6!==o.image.length)return;let h=D(i,o),u=o.source;n.bindTexture(e.TEXTURE_CUBE_MAP,i.__webglTexture,e.TEXTURE0+l);let c=r.get(u);if(u.version!==c.__version||!0===h){let i;n.activeTexture(e.TEXTURE0+l);let r=i1.getPrimaries(i1.workingColorSpace),d=o.colorSpace===tQ?null:i1.getPrimaries(o.colorSpace),p=o.colorSpace===tQ||r===d?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);let f=o.isCompressedTexture||o.image[0].isCompressedTexture,m=o.image[0]&&o.image[0].isDataTexture,g=[];for(let e=0;e<6;e++)f||m?g[e]=m?o.image[e].image:o.image[e]:g[e]=y(o.image[e],!0,s.maxCubemapSize),g[e]=H(o,g[e]);let A=g[0],v=a.convert(o.format,o.colorSpace),w=a.convert(o.type),M=b(o.internalFormat,v,w,o.colorSpace),C=!0!==o.isVideoTexture,S=void 0===c.__version||!0===h,T=u.dataReady,R=E(o,A);if(P(e.TEXTURE_CUBE_MAP,o),f){C&&S&&n.texStorage2D(e.TEXTURE_CUBE_MAP,R,M,A.width,A.height);for(let r=0;r<6;r++){i=g[r].mipmaps;for(let s=0;s<i.length;s++){let a=i[s];o.format!==eK?null!==v?C?T&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s,0,0,a.width,a.height,v,a.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s,M,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s,0,0,a.width,a.height,v,w,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s,M,a.width,a.height,0,v,w,a.data)}}}else{if(i=o.mipmaps,C&&S){i.length>0&&R++;let r=Q(g[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,R,M,r.width,r.height)}for(let r=0;r<6;r++)if(m){C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,0,0,g[r].width,g[r].height,v,w,g[r].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,M,g[r].width,g[r].height,0,v,w,g[r].data);for(let s=0;s<i.length;s++){let a=i[s].image[r].image;C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s+1,0,0,a.width,a.height,v,w,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s+1,M,a.width,a.height,0,v,w,a.data)}}else{C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,0,0,v,w,g[r]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,M,v,w,g[r]);for(let s=0;s<i.length;s++){let a=i[s];C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s+1,0,0,v,w,a.image[r]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s+1,M,v,w,a.image[r])}}}x(o)&&_(e.TEXTURE_CUBE_MAP),c.__version=u.version,o.onUpdate&&o.onUpdate(o)}i.__version=o.version})(l,i,o);return}n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture,e.TEXTURE0+o)},this.rebindTextures=function(i,n,s){let a=r.get(i);void 0!==n&&O(a.__webglFramebuffer,i,i.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==s&&F(i)},this.uploadTexture=N,this.setupRenderTarget=function(i){let s=i.texture,l=r.get(i),h=r.get(s);i.addEventListener("dispose",M);let u=i.textures,c=!0===i.isWebGLCubeRenderTarget,d=u.length>1;if(!d&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=s.version,o.memory.textures++),c){l.__webglFramebuffer=[];for(let i=0;i<6;i++)if(s.mipmaps&&s.mipmaps.length>0){l.__webglFramebuffer[i]=[];for(let n=0;n<s.mipmaps.length;n++)l.__webglFramebuffer[i][n]=e.createFramebuffer()}else l.__webglFramebuffer[i]=e.createFramebuffer()}else{if(s.mipmaps&&s.mipmaps.length>0){l.__webglFramebuffer=[];for(let i=0;i<s.mipmaps.length;i++)l.__webglFramebuffer[i]=e.createFramebuffer()}else l.__webglFramebuffer=e.createFramebuffer();if(d)for(let i=0,n=u.length;i<n;i++){let n=r.get(u[i]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}if(i.samples>0&&!1===j(i)){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,l.__webglMultisampledFramebuffer);for(let n=0;n<u.length;n++){let r=u[n];l.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,l.__webglColorRenderbuffer[n]);let s=a.convert(r.format,r.colorSpace),o=a.convert(r.type),h=b(r.internalFormat,s,o,r.colorSpace,!0===i.isXRRenderTarget),c=V(i);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,h,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,l.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),i.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),U(l.__webglDepthRenderbuffer,i,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){n.bindTexture(e.TEXTURE_CUBE_MAP,h.__webglTexture),P(e.TEXTURE_CUBE_MAP,s);for(let n=0;n<6;n++)if(s.mipmaps&&s.mipmaps.length>0)for(let r=0;r<s.mipmaps.length;r++)O(l.__webglFramebuffer[n][r],i,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else O(l.__webglFramebuffer[n],i,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);x(s)&&_(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){for(let s=0,a=u.length;s<a;s++){let a=u[s],o=r.get(a);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),P(e.TEXTURE_2D,a),O(l.__webglFramebuffer,i,a,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,0),x(a)&&_(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((i.isWebGL3DRenderTarget||i.isWebGLArrayRenderTarget)&&(r=i.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),!0===i.isWebGLMultiviewRenderTarget&&(r=e.TEXTURE_2D_ARRAY),n.bindTexture(r,h.__webglTexture),P(r,s),s.mipmaps&&s.mipmaps.length>0)for(let n=0;n<s.mipmaps.length;n++)O(l.__webglFramebuffer[n],i,s,e.COLOR_ATTACHMENT0,r,n);else O(l.__webglFramebuffer,i,s,e.COLOR_ATTACHMENT0,r,0);x(s)&&_(r),n.unbindTexture()}(i.depthBuffer||!0===i.isWebGLMultiviewRenderTarget)&&this.setupDepthRenderbuffer(i)},this.updateRenderTargetMipmap=function(i){let s=i.textures;for(let a=0,o=s.length;a<o;a++){let o=s[a];if(x(o)){let s=i.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=r.get(o).__webglTexture;n.bindTexture(s,a),_(s),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(i){if(i.samples>0){if(!1===j(i)){let s=i.textures,a=i.width,o=i.height,l=e.COLOR_BUFFER_BIT,h=i.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=r.get(i),d=s.length>1;if(d)for(let i=0;i<s.length;i++)n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let n=0;n<s.length;n++){if(i.resolveDepthBuffer&&(i.depthBuffer&&(l|=e.DEPTH_BUFFER_BIT),i.stencilBuffer&&i.resolveStencilBuffer&&(l|=e.STENCIL_BUFFER_BIT)),d){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);let i=r.get(s[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,l,e.NEAREST),!0===u&&(z.length=0,G.length=0,z.push(e.COLOR_ATTACHMENT0+n),i.depthBuffer&&!1===i.resolveDepthBuffer&&(z.push(h),G.push(h),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,G)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,z))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let i=0;i<s.length;i++){n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,c.__webglColorRenderbuffer[i]);let a=r.get(s[i]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}else if(i.depthBuffer&&!1===i.resolveDepthBuffer&&u){let n=i.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}}},this.setupDepthTexture=k,this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=O,this.useMultisampledRTT=j,this.runDeferredUploads=function(){let e=g;for(let e of(g=!1,m))N(e.textureProperties,e.texture,e.slot),e.texture.isPendingDeferredUpload=!1;m=[],g=e},this.setDeferTextureUploads=function(e){g=e}}function oT(e,i){return{convert:function(n,r=tQ){let s;let a=i1.getTransfer(r);if(n===eN)return e.UNSIGNED_BYTE;if(n===ej)return e.UNSIGNED_SHORT_4_4_4_4;if(n===eH)return e.UNSIGNED_SHORT_5_5_5_1;if(n===eW)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===eO)return e.BYTE;if(n===eU)return e.SHORT;if(n===ek)return e.UNSIGNED_SHORT;if(n===eF)return e.INT;if(n===ez)return e.UNSIGNED_INT;if(n===eG)return e.FLOAT;if(n===eV)return e.HALF_FLOAT;if(n===eq)return e.ALPHA;if(n===eX)return e.RGB;if(n===eK)return e.RGBA;if(n===eY)return e.LUMINANCE;if(n===eJ)return e.LUMINANCE_ALPHA;if(n===eZ)return e.DEPTH_COMPONENT;if(n===e$)return e.DEPTH_STENCIL;if(n===e0)return e.RED;if(n===e1)return e.RED_INTEGER;if(n===e2)return e.RG;if(n===e3)return e.RG_INTEGER;if(n===e4)return e.RGBA_INTEGER;if(n===e5||n===e6||n===e8||n===e7){if(a===tJ){if(null===(s=i.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===e5)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===e6)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===e8)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===e7)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(s=i.get("WEBGL_compressed_texture_s3tc")))return null;if(n===e5)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===e6)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===e8)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===e7)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(n===e9||n===te||n===tt||n===ti){if(null===(s=i.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===e9)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===te)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===tt)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===ti)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===tn||n===tr||n===ts){if(null===(s=i.get("WEBGL_compressed_texture_etc")))return null;if(n===tn||n===tr)return a===tJ?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===ts)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===ta||n===to||n===tl||n===th||n===tu||n===tc||n===td||n===tp||n===tf||n===tm||n===tg||n===tA||n===tv||n===ty){if(null===(s=i.get("WEBGL_compressed_texture_astc")))return null;if(n===ta)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===to)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===tl)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===th)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===tu)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===tc)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===td)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===tp)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===tf)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===tm)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===tg)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===tA)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===tv)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===ty)return a===tJ?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===tx||n===t_||n===tb){if(null===(s=i.get("EXT_texture_compression_bptc")))return null;if(n===tx)return a===tJ?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===t_)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===tb)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===tE||n===tw||n===tM||n===tC){if(null===(s=i.get("EXT_texture_compression_rgtc")))return null;if(n===tx)return s.COMPRESSED_RED_RGTC1_EXT;if(n===tw)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===tM)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===tC)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===eQ?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class oR extends rt{constructor(){super(),this.isGroup=!0,this.type="Group"}}class oI extends sc{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}var oB=new nl,oL=new nl;function oP(e){var i=this,n=null,r=null,s=null,a=[],o=new nk,l=new nk,h=1,u="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",_,!1));var c=new nk,d=new no,p=new nl,f=new sc;f.viewport=new ne,f.layers.enable(1);var m=new sc;m.viewport=new ne,m.layers.enable(2);var g=new oI([f,m]);g.layers.enable(1),g.layers.enable(2);var A,v,y,x=new iG;function _(){if(i.isPresenting=null!==n&&!0===n.isPresenting){var r=n.getEyeParameters("left");A=2*r.renderWidth*h,v=r.renderHeight*h,y=e.getPixelRatio(),e.getSize(x),e.setDrawingBufferSize(A,v,1),f.viewport.set(0,0,A/2,v),m.viewport.set(A/2,0,A/2,v),M.start(),i.dispatchEvent({type:"sessionstart"})}else i.enabled&&e.setDrawingBufferSize(x.width,x.height,y),M.stop(),i.dispatchEvent({type:"sessionend"})}var b=[],E=[];function w(e,i){null!==i&&4===i.length&&e.set(i[0]*A,i[1]*v,i[2]*A,i[3]*v)}this.enabled=!1,this.getController=function(e){var i=a[e];return void 0===i&&((i=new oR).matrixAutoUpdate=!1,i.visible=!1,a[e]=i),i},this.getDevice=function(){return n},this.setDevice=function(e){void 0!==e&&(n=e),M.setContext(e)},this.setFramebufferScaleFactor=function(e){h=e},this.setReferenceSpaceType=function(e){u=e},this.setPoseTarget=function(e){void 0!==e&&(s=e)},this.cameraAutoUpdate=!0,this.updateCamera=function(e){var i=1.6*("local-floor"===u);if(n.depthNear=e.near,n.depthFar=e.far,n.getFrameData(r),"local-floor"===u){var h=n.stageParameters;h?o.fromArray(h.sittingToStandingTransform):o.makeTranslation(0,i,0)}var A=r.pose,v=null!==s?s:e;v.matrix.copy(o),v.matrix.decompose(v.position,v.quaternion,v.scale),null!==A.orientation&&(d.fromArray(A.orientation),v.quaternion.multiply(d)),null!==A.position&&(d.setFromRotationMatrix(o),p.fromArray(A.position),p.applyQuaternion(d),v.position.add(p)),v.updateMatrixWorld();for(var y=v.children,x=0,_=y.length;x<_;x++)y[x].updateMatrixWorld(!0);f.near=e.near,m.near=e.near,f.far=e.far,m.far=e.far,f.matrixWorldInverse.fromArray(r.leftViewMatrix),m.matrixWorldInverse.fromArray(r.rightViewMatrix),l.copy(o).invert(),"local-floor"===u&&(f.matrixWorldInverse.multiply(l),m.matrixWorldInverse.multiply(l));var M=v.parent;null!==M&&(c.copy(M.matrixWorld).invert(),f.matrixWorldInverse.multiply(c),m.matrixWorldInverse.multiply(c)),f.matrixWorld.copy(f.matrixWorldInverse).invert(),m.matrixWorld.copy(m.matrixWorldInverse).invert(),f.projectionMatrix.fromArray(r.leftProjectionMatrix),m.projectionMatrix.fromArray(r.rightProjectionMatrix),function(e,i,n){oB.setFromMatrixPosition(i.matrixWorld),oL.setFromMatrixPosition(n.matrixWorld);var r=oB.distanceTo(oL),s=i.projectionMatrix.elements,a=n.projectionMatrix.elements,o=s[14]/(s[10]-1),l=s[14]/(s[10]+1),h=(s[9]+1)/s[5],u=(s[9]-1)/s[5],c=(s[8]-1)/s[0],d=(a[8]+1)/a[0],p=r/(-c+d),f=-(p*c);i.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var m=o+p,g=l+p;e.projectionMatrix.makePerspective(o*c-f,o*d+(r-f),h*l/g*m,u*l/g*m,m,g)}(g,f,m);var C=n.getLayers();if(C.length){var S=C[0];w(f.viewport,S.leftBounds),w(m.viewport,S.rightBounds)}return function(){for(var e=0;e<a.length;e++){var i=a[e],n=function(e){for(var i=navigator.getGamepads&&navigator.getGamepads(),n=0,r=i.length;n<r;n++){var s=i[n];if(s&&("Daydream Controller"===s.id||"Gear VR Controller"===s.id||"Oculus Go Controller"===s.id||"OpenVR Gamepad"===s.id||s.id.startsWith("Oculus Touch")||s.id.startsWith("HTC Vive Focus")||s.id.startsWith("Spatial Controller"))){var a=s.hand;if(0===e&&(""===a||"right"===a)||1===e&&"left"===a)return s}}}(e);if(void 0!==n&&void 0!==n.pose){if(null===n.pose)return;var r=n.pose;!1===r.hasPosition&&i.position.set(.2,-.6,-.05),null!==r.position&&i.position.fromArray(r.position),null!==r.orientation&&i.quaternion.fromArray(r.orientation),i.matrix.compose(i.position,i.quaternion,i.scale),i.matrix.premultiply(o),i.matrix.decompose(i.position,i.quaternion,i.scale),i.matrixWorldNeedsUpdate=!0,i.visible=!0;var s=+("Daydream Controller"!==n.id);void 0===b[e]&&(b[e]=!1),b[e]!==n.buttons[s].pressed&&(b[e]=n.buttons[s].pressed,!0===b[e]?i.dispatchEvent({type:"selectstart"}):(i.dispatchEvent({type:"selectend"}),i.dispatchEvent({type:"select"}))),s=2,void 0===E[e]&&(E[e]=!1),void 0!==n.buttons[s]&&E[e]!==n.buttons[s].pressed&&(E[e]=n.buttons[s].pressed,!0===E[e]?i.dispatchEvent({type:"squeezestart"}):(i.dispatchEvent({type:"squeezeend"}),i.dispatchEvent({type:"squeeze"})))}else i.visible=!1}}(),g},this.getCamera=function(){return g},this.getFoveation=function(){return 1},this.setFoveation=function(e){1!==e&&console.warn("THREE.WebVRManager: setFoveation() not used in WebVR.")},this.getEnvironmentBlendMode=function(){if(i.isPresenting)return"opaque"},this.getStandingMatrix=function(){return o},this.isPresenting=!1;var M=new sb;this.setAnimationLoop=function(e){M.setAnimationLoop(e),this.isPresenting&&M.start()},this.submitFrame=function(){this.isPresenting&&n.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",_)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}Object.assign(oP.prototype,{addEventListener:iR.prototype.addEventListener,hasEventListener:iR.prototype.hasEventListener,removeEventListener:iR.prototype.removeEventListener,dispatchEvent:iR.prototype.dispatchEvent});class oD extends ni{constructor(e,i,n,r={}){super(e,i,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}copy(e){return super.copy(e),this.numViews=e.numViews,this}}oD.prototype.isWebGLMultiviewRenderTarget=!0;let oN={type:"move"};class oO{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new oR,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new oR,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new nl,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new nl),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new oR,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new nl,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new nl),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let i=this._hand;if(i)for(let n of e.hand.values())this._getHandJoint(i,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,i,n){let r=null,s=null,a=null,o=this._targetRay,l=this._grip,h=this._hand;if(e&&"visible-blurred"!==i.session.visibilityState){if(h&&e.hand){for(let r of(a=!0,e.hand.values())){let e=i.getJointPose(r,n),s=this._getHandJoint(h,r);null!==e&&(s.matrix.fromArray(e.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,s.jointRadius=e.radius),s.visible=null!==e}let r=h.joints["index-finger-tip"],s=h.joints["thumb-tip"],o=r.position.distanceTo(s.position);h.inputState.pinching&&o>.025?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&o<=.015&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&null!==(s=i.getPose(e.gripSpace,n))&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1);null!==o&&(null===(r=i.getPose(e.targetRaySpace,n))&&null!==s&&(r=s),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(oN)))}return null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),null!==h&&(h.visible=null!==a),this}_getHandJoint(e,i){if(void 0===e.joints[i.jointName]){let n=new oR;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[i.jointName]=n,e.add(n)}return e.joints[i.jointName]}}let oU=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,ok=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class oF{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,n){if(null===this.texture){let r=new i9;e.properties.get(r).__webglTexture=i.texture,(i.depthNear!=n.depthNear||i.depthFar!=n.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=r}}render(e,i){if(null!==this.texture){if(null===this.mesh){let e=i.cameras[0].viewport,n=new sa({vertexShader:oU,fragmentShader:ok,uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new r9(new sw(20,20),n)}e.render(this.mesh,i)}}reset(){this.texture=null,this.mesh=null}}class oz extends iR{constructor(e,i,n,r){super();let s=this,a=null,o=1;var l=null;let h=null,u="local-floor",c=1,d=null,p=null;var f=[];let m=null,g=null,A=null,v=null,y=new oF,x=i.getContextAttributes(),_=null,b=null,E=[],w=[],M=new iG,C=null,S=new sc;S.layers.enable(1),S.viewport=new ne;let T=new sc;T.layers.enable(2),T.viewport=new ne;let R=[S,T],I=new oI;I.layers.enable(1),I.layers.enable(2);let B=null,L=null;function P(e){let i=w.indexOf(e.inputSource);if(-1===i)return;let n=E[i];void 0!==n&&(n.update(e.inputSource,e.frame,d||h),n.dispatchEvent({type:e.type,data:e.inputSource}))}function D(){a.removeEventListener("select",P),a.removeEventListener("selectstart",P),a.removeEventListener("selectend",P),a.removeEventListener("squeeze",P),a.removeEventListener("squeezestart",P),a.removeEventListener("squeezeend",P),a.removeEventListener("end",D),a.removeEventListener("inputsourceschange",N);for(let e=0;e<E.length;e++){let i=w[e];null!==i&&(w[e]=null,E[e].disconnect(i))}B=null,L=null,y.reset(),e.setRenderTarget(_),A=null,g=null,m=null,a=null,b=null,z.stop(),s.isPresenting=!1,e.setPixelRatio(C),e.setSize(M.width,M.height,!1),s.dispatchEvent({type:"sessionend"})}function N(e){for(let i=0;i<e.removed.length;i++){let n=e.removed[i],r=w.indexOf(n);r>=0&&(w[r]=null,E[r].disconnect(n))}for(let i=0;i<e.added.length;i++){let n=e.added[i],r=w.indexOf(n);if(-1===r){for(let e=0;e<E.length;e++){if(e>=w.length){w.push(n),r=e;break}if(null===w[e]){w[e]=n,r=e;break}}if(-1===r)break}let s=E[r];s&&s.connect(n)}}this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.isMultiview=!1,this.getCameraPose=function(){return p},this.getController=function(e){let i=E[e];return void 0===i&&(i=new oO,E[e]=i),i.getTargetRaySpace()},this.getControllerGrip=function(e){let i=E[e];return void 0===i&&(i=new oO,E[e]=i),i.getGripSpace()},this.getHand=function(e){let i=E[e];return void 0===i&&(i=new oO,E[e]=i),i.getHandSpace()},this.setFramebufferScaleFactor=function(e){o=e,!0===s.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){u=e,!0===s.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||h},this.setReferenceSpace=function(e){d=e},this.getBaseLayer=function(){return null!==g?g:A},this.getBinding=function(){return m},this.getFrame=function(){return v},this.getSession=function(){return a},this.setSession=async function(l){if(null!==(a=l)){if(_=e.getRenderTarget(),a.addEventListener("select",P),a.addEventListener("selectstart",P),a.addEventListener("selectend",P),a.addEventListener("squeeze",P),a.addEventListener("squeezestart",P),a.addEventListener("squeezeend",P),a.addEventListener("end",D),a.addEventListener("inputsourceschange",N),!0!==x.xrCompatible&&await i.makeXRCompatible(),C=e.getPixelRatio(),e.getSize(M),void 0===a.renderState.layers){let n={antialias:x.antialias,alpha:!0,depth:x.depth,stencil:x.stencil,framebufferScaleFactor:o};A=new XRWebGLLayer(a,i,n),a.updateRenderState({baseLayer:A}),e.setPixelRatio(1),e.setSize(A.framebufferWidth,A.framebufferHeight,!1),b=new ni(A.framebufferWidth,A.framebufferHeight,{format:eK,type:eN,colorSpace:e.outputColorSpace,stencilBuffer:x.stencil})}else{let l=null,h=null,u=null;x.depth&&(u=x.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,l=x.stencil?e$:eZ,h=x.stencil?eQ:ez),s.isMultiview=r&&n.has("OCULUS_multiview");let c={colorFormat:i.RGBA8,depthFormat:u,scaleFactor:o};s.isMultiview&&(c.textureType="texture-array"),g=(m=new XRWebGLBinding(a,i)).createProjectionLayer(c),a.updateRenderState({layers:[g]}),e.setPixelRatio(1),e.setSize(g.textureWidth,g.textureHeight,!1);let d={format:eK,type:eN,depthTexture:new s7(g.textureWidth,g.textureHeight,h,void 0,void 0,void 0,void 0,void 0,void 0,l),stencilBuffer:x.stencil,colorSpace:e.outputColorSpace,samples:4*!!x.antialias,resolveDepthBuffer:!1===g.ignoreDepthValues};if(s.isMultiview){let e=n.get("OCULUS_multiview");this.maxNumViews=i.getParameter(e.MAX_VIEWS_OVR),b=new oD(g.textureWidth,g.textureHeight,2,d)}else b=new ni(g.textureWidth,g.textureHeight,d)}b.isXRRenderTarget=!0,this.setFoveation(c),d=null,h=await a.requestReferenceSpace(u),z.setContext(a),z.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==a)return a.environmentBlendMode},this.addLayer=function(e){window.XRWebGLBinding&&this.layersEnabled&&a&&(f.push(e),this.updateLayers())},this.removeLayer=function(e){f.splice(f.indexOf(e),1),window.XRWebGLBinding&&this.layersEnabled&&a&&this.updateLayers()},this.updateLayers=function(){var e=f.map(function(e){return e});e.unshift(a.renderState.layers[0]),a.updateRenderState({layers:e})};let O=new nl,U=new nl;function k(e,i){null===i?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(i.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.setPoseTarget=function(e){void 0!==e&&(l=e)},this.updateCamera=function(e){if(null===a)return;null!==y.texture&&(e.near=y.depthNear,e.far=y.depthFar),I.near=T.near=S.near=e.near,I.far=T.far=S.far=e.far,(B!==I.near||L!==I.far)&&(a.updateRenderState({depthNear:I.near,depthFar:I.far}),B=I.near,L=I.far,S.near=B,S.far=L,T.near=B,T.far=L,S.updateProjectionMatrix(),T.updateProjectionMatrix(),e.updateProjectionMatrix());let i=I.cameras;var n,r,s,o=l||e;let h=o.parent;k(I,h);for(let e=0;e<i.length;e++)k(i[e],h);2===i.length?function(e,i,n){O.setFromMatrixPosition(i.matrixWorld),U.setFromMatrixPosition(n.matrixWorld);let r=O.distanceTo(U),s=i.projectionMatrix.elements,a=n.projectionMatrix.elements,o=s[14]/(s[10]-1),l=s[14]/(s[10]+1),h=(s[9]+1)/s[5],u=(s[9]-1)/s[5],c=(s[8]-1)/s[0],d=(a[8]+1)/a[0],p=r/(-c+d),f=-(p*c);i.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let m=o+p,g=l+p;e.projectionMatrix.makePerspective(o*c-f,o*d+(r-f),h*l/g*m,u*l/g*m,m,g),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(I,S,T):I.projectionMatrix.copy(S.projectionMatrix),n=e,r=I,s=o,r.matrixWorld.decompose(r.position,r.quaternion,r.scale),null===s.parent?s.matrix.copy(r.matrixWorld):(s.matrix.copy(s.parent.matrixWorld),s.matrix.invert(),s.matrix.multiply(r.matrixWorld)),s.matrix.decompose(s.position,s.quaternion,s.scale),s.updateMatrixWorld(!0),n.projectionMatrix.copy(r.projectionMatrix),n.projectionMatrixInverse.copy(r.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=2*iP*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)},this.getCamera=function(){return I},this.getFoveation=function(){if(null!==g||null!==A)return c},this.setFoveation=function(e){c=e,null!==g&&(g.fixedFoveation=e),null!==A&&void 0!==A.fixedFoveation&&(A.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==y.texture};let F=null,z=new sb;z.setAnimationLoop(function(i,n){if(p=n.getViewerPose(d||h),v=n,null!==p){let i=p.views;null!==A&&(e.setRenderTargetFramebuffer(b,A.framebuffer),e.setRenderTarget(b));let n=!1;i.length!==I.cameras.length&&(I.cameras.length=0,n=!0);for(let r=0;r<i.length;r++){let s=i[r],a=null;if(null!==A)a=A.getViewport(s);else{let i=m.getViewSubImage(g,s);a=i.viewport,0===r&&(e.setRenderTargetTextures(b,i.colorTexture,g.ignoreDepthValues?void 0:i.depthStencilTexture),e.setRenderTarget(b))}let o=R[r];void 0===o&&((o=new sc).layers.enable(r),o.viewport=new ne,R[r]=o),o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(s.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===r&&(I.matrix.copy(o.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale)),!0===n&&I.cameras.push(o)}let r=a.enabledFeatures;if(r&&r.includes("depth-sensing")){let n=m.getDepthInformation(i[0]);n&&n.isValid&&n.texture&&y.init(e,n,a.renderState)}}for(let e=0;e<E.length;e++){let i=w[e],r=E[e];null!==i&&void 0!==r&&r.update(i,n,d||h)}y.render(e,I),F&&F(i,n),n.detectedPlanes&&s.dispatchEvent({type:"planesdetected",data:n}),v=null}),this.setAnimationLoop=function(e){F=e},this.dispose=function(){}}}let oG=new nX,oV=new nk;function oj(e,i){function n(e,i){!0===e.matrixAutoUpdate&&e.updateMatrix(),i.value.copy(e.matrix)}function r(r,s){r.opacity.value=s.opacity,s.color&&r.diffuse.value.copy(s.color),s.emissive&&r.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),s.map&&(r.map.value=s.map,n(s.map,r.mapTransform)),s.alphaMap&&(r.alphaMap.value=s.alphaMap,n(s.alphaMap,r.alphaMapTransform)),s.bumpMap&&(r.bumpMap.value=s.bumpMap,n(s.bumpMap,r.bumpMapTransform),r.bumpScale.value=s.bumpScale,s.side===_&&(r.bumpScale.value*=-1)),s.normalMap&&(r.normalMap.value=s.normalMap,n(s.normalMap,r.normalMapTransform),r.normalScale.value.copy(s.normalScale),s.side===_&&r.normalScale.value.negate()),s.displacementMap&&(r.displacementMap.value=s.displacementMap,n(s.displacementMap,r.displacementMapTransform),r.displacementScale.value=s.displacementScale,r.displacementBias.value=s.displacementBias),s.emissiveMap&&(r.emissiveMap.value=s.emissiveMap,n(s.emissiveMap,r.emissiveMapTransform)),s.specularMap&&(r.specularMap.value=s.specularMap,n(s.specularMap,r.specularMapTransform)),s.alphaTest>0&&(r.alphaTest.value=s.alphaTest);let a=i.get(s),o=a.envMap,l=a.envMapRotation;if(o&&(r.envMap.value=o,oG.copy(l),oG.x*=-1,oG.y*=-1,oG.z*=-1,o.isCubeTexture&&!1===o.isRenderTargetTexture&&(oG.y*=-1,oG.z*=-1),r.envMapRotation.value.setFromMatrix4(oV.makeRotationFromEuler(oG)),r.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,r.reflectivity.value=s.reflectivity,r.ior.value=s.ior,r.refractionRatio.value=s.refractionRatio),s.lightMap){r.lightMap.value=s.lightMap;let i=!0===e._useLegacyLights?Math.PI:1;r.lightMapIntensity.value=s.lightMapIntensity*i,n(s.lightMap,r.lightMapTransform)}s.aoMap&&(r.aoMap.value=s.aoMap,r.aoMapIntensity.value=s.aoMapIntensity,n(s.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(i,n){n.color.getRGB(i.fogColor.value,sr(e)),n.isFog?(i.fogNear.value=n.near,i.fogFar.value=n.far):n.isFogExp2&&(i.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,s,a,o,l){var h,u,c,d,p,f,m,g,A,v,y,x,b,E,w,M,C,S,T,R,I;s.isMeshBasicMaterial?r(e,s):s.isMeshLambertMaterial?r(e,s):s.isMeshToonMaterial?(r(e,s),h=e,(u=s).gradientMap&&(h.gradientMap.value=u.gradientMap)):s.isMeshPhongMaterial?(r(e,s),c=e,d=s,c.specular.value.copy(d.specular),c.shininess.value=Math.max(d.shininess,1e-4)):s.isMeshStandardMaterial?(r(e,s),p=e,f=s,p.metalness.value=f.metalness,f.metalnessMap&&(p.metalnessMap.value=f.metalnessMap,n(f.metalnessMap,p.metalnessMapTransform)),p.roughness.value=f.roughness,f.roughnessMap&&(p.roughnessMap.value=f.roughnessMap,n(f.roughnessMap,p.roughnessMapTransform)),f.envMap&&(p.envMapIntensity.value=f.envMapIntensity),s.isMeshPhysicalMaterial&&(m=e,g=s,A=l,m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap,n(g.sheenColorMap,m.sheenColorMapTransform)),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap,n(g.sheenRoughnessMap,m.sheenRoughnessMapTransform))),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap,n(g.clearcoatMap,m.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,n(g.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(m.clearcoatNormalMap.value=g.clearcoatNormalMap,n(g.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===_&&m.clearcoatNormalScale.value.negate())),g.dispersion>0&&(m.dispersion.value=g.dispersion),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap,n(g.iridescenceMap,m.iridescenceMapTransform)),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap,n(g.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=A.texture,m.transmissionSamplerSize.value.set(A.width,A.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap,n(g.transmissionMap,m.transmissionMapTransform)),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap,n(g.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(m.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(m.anisotropyMap.value=g.anisotropyMap,n(g.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap,n(g.specularColorMap,m.specularColorMapTransform)),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap,n(g.specularIntensityMap,m.specularIntensityMapTransform)))):s.isMeshMatcapMaterial?(r(e,s),v=e,(y=s).matcap&&(v.matcap.value=y.matcap)):s.isMeshDepthMaterial?r(e,s):s.isMeshDistanceMaterial?(r(e,s),function(e,n){let r=i.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,s)):s.isMeshNormalMaterial?r(e,s):s.isLineBasicMaterial?(x=e,b=s,x.diffuse.value.copy(b.color),x.opacity.value=b.opacity,b.map&&(x.map.value=b.map,n(b.map,x.mapTransform)),s.isLineDashedMaterial&&(E=e,w=s,E.dashSize.value=w.dashSize,E.totalSize.value=w.dashSize+w.gapSize,E.scale.value=w.scale)):s.isPointsMaterial?(M=e,C=s,S=a,T=o,M.diffuse.value.copy(C.color),M.opacity.value=C.opacity,M.size.value=C.size*S,M.scale.value=.5*T,C.map&&(M.map.value=C.map,n(C.map,M.uvTransform)),C.alphaMap&&(M.alphaMap.value=C.alphaMap,n(C.alphaMap,M.alphaMapTransform)),C.alphaTest>0&&(M.alphaTest.value=C.alphaTest)):s.isSpriteMaterial?(R=e,I=s,R.diffuse.value.copy(I.color),R.opacity.value=I.opacity,R.rotation.value=I.rotation,I.map&&(R.map.value=I.map,n(I.map,R.mapTransform)),I.alphaMap&&(R.alphaMap.value=I.alphaMap,n(I.alphaMap,R.alphaMapTransform)),I.alphaTest>0&&(R.alphaTest.value=I.alphaTest)):s.isShadowMaterial?(e.color.value.copy(s.color),e.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function oH(e,i,n,r){let s={},a={},o=[],l=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function h(e){let i={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(i.boundary=4,i.storage=4):e.isVector2?(i.boundary=8,i.storage=8):e.isVector3||e.isColor?(i.boundary=16,i.storage=12):e.isVector4?(i.boundary=16,i.storage=16):e.isMatrix3?(i.boundary=48,i.storage=48):e.isMatrix4?(i.boundary=64,i.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),i}function u(i){let n=i.target;n.removeEventListener("dispose",u);let r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(s[n.id]),delete s[n.id],delete a[n.id]}return{bind:function(e,i){let n=i.program;r.uniformBlockBinding(e,n)},update:function(n,c){let d=s[n.id];void 0===d&&(function(e){let i=e.uniforms,n=0;for(let e=0,r=i.length;e<r;e++){let r=Array.isArray(i[e])?i[e]:[i[e]];for(let e=0,i=r.length;e<i;e++){let i=r[e],s=Array.isArray(i.value)?i.value:[i.value];for(let e=0,r=s.length;e<r;e++){let r=h(s[e]),a=n%16;0!==a&&16-a<r.boundary&&(n+=16-a),i.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,n+=r.storage}}}let r=n%16;r>0&&(n+=16-r),e.__size=n,e.__cache={}}(n),d=function(i){let n=function(){for(let e=0;e<l;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();i.__bindingPointIndex=n;let r=e.createBuffer(),s=i.__size,a=i.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,s,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),s[n.id]=d,n.addEventListener("dispose",u));let p=c.program;r.updateUBOMapping(n,p);let f=i.render.frame;a[n.id]!==f&&(function(i){let n=s[i.id],r=i.uniforms,a=i.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let i=0,n=r.length;i<n;i++){let n=Array.isArray(r[i])?r[i]:[r[i]];for(let r=0,s=n.length;r<s;r++){let s=n[r];if(!0===function(e,i,n,r){let s=e.value,a=i+"_"+n;if(void 0===r[a])return"number"==typeof s||"boolean"==typeof s?r[a]=s:r[a]=s.clone(),!0;{let e=r[a];if("number"==typeof s||"boolean"==typeof s){if(e!==s)return r[a]=s,!0}else if(!1===e.equals(s))return e.copy(s),!0}return!1}(s,i,r,a)){let i=s.__offset,n=Array.isArray(s.value)?s.value:[s.value],r=0;for(let a=0;a<n.length;a++){let o=n[a],l=h(o);"number"==typeof o||"boolean"==typeof o?(s.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,i+r,s.__data)):o.isMatrix3?(s.__data[0]=o.elements[0],s.__data[1]=o.elements[1],s.__data[2]=o.elements[2],s.__data[3]=0,s.__data[4]=o.elements[3],s.__data[5]=o.elements[4],s.__data[6]=o.elements[5],s.__data[7]=0,s.__data[8]=o.elements[6],s.__data[9]=o.elements[7],s.__data[10]=o.elements[8],s.__data[11]=0):(o.toArray(s.__data,r),r+=l.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,i,s.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=f)},dispose:function(){for(let i in s)e.deleteBuffer(s[i]);o=[],s={},a={}}}}class oQ{constructor(e={}){var i;let n,r,s,a,o,l,u,c,d,p,f,m,g,A,v,y,E,w,M,C,S,T,R,I,B,L;let{canvas:P=iX(),context:D=null,depth:N=!0,stencil:O=!1,alpha:U=!1,antialias:k=!1,premultipliedAlpha:F=!0,preserveDrawingBuffer:z=!1,powerPreference:G="default",failIfMajorPerformanceCaveat:V=!1,multiviewStereo:j=!1}=e;if(this.isWebGLRenderer=!0,null!==D){if("undefined"!=typeof WebGLRenderingContext&&D instanceof WebGLRenderingContext)throw Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");n=D.getContextAttributes().alpha}else n=U;let H=new Uint32Array(4),Q=new Int32Array(4),W=null,q=null,X=[],K=[];this.domElement=P,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=tW,this._useLegacyLights=!1,this.toneMapping=ea,this.toneMappingExposure=1;let Y=this,J=!1,Z=0,$=0,ee=null,et=-1,ei=null,en=new ne,er=new ne,es=null,eo=new rA(0),el=0,eh=P.width,eu=P.height,ec=1,ed=null,ep=null,ef=new ne(0,0,eh,eu),em=new ne(0,0,eh,eu),eg=!1,eA=new s_,ev=!1,ey=!1,ex=new nk,e_=new nl,eb={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function eE(){return null===ee?ec:1}let ew=D;function eM(e,i){return P.getContext(e,i)}try{if("setAttribute"in P&&P.setAttribute("data-engine",`three.js r${h}`),P.addEventListener("webglcontextlost",eT,!1),P.addEventListener("webglcontextrestored",eR,!1),P.addEventListener("webglcontextcreationerror",eI,!1),null===ew){let e="webgl2";if(ew=eM(e,{alpha:!0,depth:N,stencil:O,antialias:k,premultipliedAlpha:F,preserveDrawingBuffer:z,powerPreference:G,failIfMajorPerformanceCaveat:V}),null===ew){if(eM(e))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}}}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function eC(){(r=new s1(ew)).init(),I=new oT(ew,r),s=new sD(ew,r,e,I),a=new oC(ew),o=new s4(ew),l=new od,u=new oS(ew,r,a,l,s,I,o),c=new sO(Y),d=new s0(Y),p=new sE(ew),B=new sL(ew,p),f=new s2(ew,p,o,B),m=new s8(ew,f,p,o),S=new s5(ew,s,u),E=new sN(l),g=new oc(Y,c,d,r,s,B,E),A=new oj(Y,l),v=new og,y=new ob(r),C=new sB(Y,c,d,a,m,n,F),M=new s6(Y,r,ew),w=new oM(Y,m,s),L=new oH(ew,o,s,a),T=new sP(ew,r,o),R=new s3(ew,r,o),o.programs=g.programs,Y.capabilities=s,Y.extensions=r,Y.properties=l,Y.renderLists=v,Y.shadowMap=w,Y.state=a,Y.info=o}eC();let eS="undefined"!=typeof navigator&&"xr"in navigator?new oz(Y,ew,r,j):new oP(Y);function eT(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),J=!0}function eR(){console.log("THREE.WebGLRenderer: Context Restored."),J=!1;let e=o.autoReset,i=w.enabled,n=w.autoUpdate,r=w.needsUpdate,s=w.type;eC(),o.autoReset=e,w.enabled=i,w.autoUpdate=n,w.needsUpdate=r,w.type=s}function eI(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function eB(e){var i;let n=e.target;n.removeEventListener("dispose",eB),function(e){let i=l.get(e).programs;void 0!==i&&(i.forEach(function(e){g.releaseProgram(e)}),e.isShaderMaterial&&g.releaseShaderCache(e))}(i=n),l.remove(i)}function eL(e,i,n){!0===e.transparent&&e.side===b&&!1===e.forceSinglePass?(e.side=_,e.needsUpdate=!0,eK(e,i,n),e.side=x,e.needsUpdate=!0,eK(e,i,n),e.side=b):eK(e,i,n)}this.xr=eS,this.getContext=function(){return ew},this.getContextAttributes=function(){return ew.getContextAttributes()},this.forceContextLoss=function(){let e=r.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=r.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return ec},this.setPixelRatio=function(e){void 0!==e&&(ec=e,this.setSize(eh,eu,!1))},this.getSize=function(e){return e.set(eh,eu)},this.setSize=function(e,i,n=!0){if(eS.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}eh=e,eu=i,P.width=Math.floor(e*ec),P.height=Math.floor(i*ec),!0===n&&(P.style.width=e+"px",P.style.height=i+"px"),this.setViewport(0,0,e,i)},this.getDrawingBufferSize=function(e){return e.set(eh*ec,eu*ec).floor()},this.setDrawingBufferSize=function(e,i,n){eh=e,eu=i,ec=n,P.width=Math.floor(e*n),P.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(en)},this.getViewport=function(e){return e.copy(ef)},this.setViewport=function(e,i,n,r){e.isVector4?ef.set(e.x,e.y,e.z,e.w):ef.set(e,i,n,r),a.viewport(en.copy(ef).multiplyScalar(ec).round())},this.getScissor=function(e){return e.copy(em)},this.setScissor=function(e,i,n,r){e.isVector4?em.set(e.x,e.y,e.z,e.w):em.set(e,i,n,r),a.scissor(er.copy(em).multiplyScalar(ec).round())},this.getScissorTest=function(){return eg},this.setScissorTest=function(e){a.setScissorTest(eg=e)},this.setOpaqueSort=function(e){ed=e},this.setTransparentSort=function(e){ep=e},this.getClearColor=function(e){return e.copy(C.getClearColor())},this.setClearColor=function(){C.setClearColor.apply(C,arguments)},this.getClearAlpha=function(){return C.getClearAlpha()},this.setClearAlpha=function(){C.setClearAlpha.apply(C,arguments)},this.clear=function(e=!0,i=!0,n=!0){let r=0;if(e){let e=!1;if(null!==ee){let i=ee.texture.format;e=i===e4||i===e3||i===e1}if(e){let e=ee.texture.type,i=e===eN||e===ez||e===ek||e===eQ||e===ej||e===eH,n=C.getClearColor(),r=C.getClearAlpha(),s=n.r,a=n.g,o=n.b;i?(H[0]=s,H[1]=a,H[2]=o,H[3]=r,ew.clearBufferuiv(ew.COLOR,0,H)):(Q[0]=s,Q[1]=a,Q[2]=o,Q[3]=r,ew.clearBufferiv(ew.COLOR,0,Q))}else r|=ew.COLOR_BUFFER_BIT}i&&(r|=ew.DEPTH_BUFFER_BIT),n&&(r|=ew.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(0xffffffff)),ew.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){P.removeEventListener("webglcontextlost",eT,!1),P.removeEventListener("webglcontextrestored",eR,!1),P.removeEventListener("webglcontextcreationerror",eI,!1),v.dispose(),y.dispose(),l.dispose(),c.dispose(),d.dispose(),m.dispose(),B.dispose(),L.dispose(),g.dispose(),eS.dispose(),eS.removeEventListener("sessionstart",eO),eS.removeEventListener("sessionend",eU),eF.stop()},this.renderBufferDirect=function(e,i,n,r,o,h){let m;null===i&&(i=eb);let g=o.isMesh&&0>o.matrixWorld.determinant(),v=function(e,i,n,r,o){var h,p;!0!==i.isScene&&(i=eb),u.resetTextureUnits();let f=i.fog,m=r.isMeshStandardMaterial?i.environment:null,g=null===ee?Y.outputColorSpace:!0===ee.isXRRenderTarget?ee.texture.colorSpace:tq,v=(r.isMeshStandardMaterial?d:c).get(r.envMap||m),y=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,x=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),_=!!n.morphAttributes.position,b=!!n.morphAttributes.normal,w=!!n.morphAttributes.color,C=ea;r.toneMapped&&(null===ee||!0===ee.isXRRenderTarget)&&(C=Y.toneMapping);let T=ee&&ee.isWebGLMultiviewRenderTarget?ee.numViews:0,R=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,I=void 0!==R?R.length:0,B=l.get(r),P=q.state.lights;if(!0===ev&&(!0===ey||e!==ei)){let i=e===ei&&r.id===et;E.setState(r,e,i)}let D=!1;r.version===B.__version?B.needsLights&&B.lightsStateVersion!==P.state.version?D=!0:B.outputColorSpace!==g?D=!0:o.isBatchedMesh&&!1===B.batching?D=!0:o.isBatchedMesh||!0!==B.batching?o.isInstancedMesh&&!1===B.instancing?D=!0:o.isInstancedMesh||!0!==B.instancing?o.isSkinnedMesh&&!1===B.skinning?D=!0:o.isSkinnedMesh||!0!==B.skinning?o.isInstancedMesh&&!0===B.instancingColor&&null===o.instanceColor?D=!0:o.isInstancedMesh&&!1===B.instancingColor&&null!==o.instanceColor?D=!0:o.isInstancedMesh&&!0===B.instancingMorph&&null===o.morphTexture?D=!0:o.isInstancedMesh&&!1===B.instancingMorph&&null!==o.morphTexture?D=!0:B.envMap!==v?D=!0:!0===r.fog&&B.fog!==f?D=!0:void 0!==B.numClippingPlanes&&(B.numClippingPlanes!==E.numPlanes||B.numIntersection!==E.numIntersection)?D=!0:B.vertexAlphas!==y?D=!0:B.vertexTangents!==x?D=!0:B.morphTargets!==_?D=!0:B.morphNormals!==b?D=!0:B.morphColors!==w?D=!0:B.toneMapping!==C?D=!0:B.morphTargetsCount!==I?D=!0:B.numMultiviewViews!==T&&(D=!0):D=!0:D=!0:D=!0:(D=!0,B.__version=r.version);let N=B.currentProgram;!0===D&&(N=eK(r,i,o));let O=!1,U=!1,k=!1,F=N.getUniforms(),z=B.uniforms;if(a.useProgram(N.program)&&(O=!0,U=!0,k=!0),r.id!==et&&(et=r.id,U=!0),O||ei!==e){N.numMultiviewViews>0?(M.updateCameraProjectionMatricesUniform(e,F),M.updateCameraViewMatricesUniform(e,F)):(F.setValue(ew,"projectionMatrix",e.projectionMatrix),F.setValue(ew,"viewMatrix",e.matrixWorldInverse));let i=F.map.cameraPosition;void 0!==i&&i.setValue(ew,e_.setFromMatrixPosition(e.matrixWorld)),s.logarithmicDepthBuffer&&F.setValue(ew,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&F.setValue(ew,"isOrthographic",!0===e.isOrthographicCamera),ei!==e&&(ei=e,U=!0,k=!0)}if(o.isSkinnedMesh){F.setOptional(ew,o,"bindMatrix"),F.setOptional(ew,o,"bindMatrixInverse");let e=o.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),F.setValue(ew,"boneTexture",e.boneTexture,u))}o.isBatchedMesh&&(F.setOptional(ew,o,"batchingTexture"),F.setValue(ew,"batchingTexture",o._matricesTexture,u));let G=n.morphAttributes;if((void 0!==G.position||void 0!==G.normal||void 0!==G.color)&&S.update(o,n,N),(U||B.receiveShadow!==o.receiveShadow)&&(B.receiveShadow=o.receiveShadow,F.setValue(ew,"receiveShadow",o.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(z.envMap.value=v,z.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1),r.isMeshStandardMaterial&&null===r.envMap&&null!==i.environment&&(z.envMapIntensity.value=i.environmentIntensity),U&&(F.setValue(ew,"toneMappingExposure",Y.toneMappingExposure),B.needsLights&&(h=z,p=k,h.ambientLightColor.needsUpdate=p,h.lightProbe.needsUpdate=p,h.directionalLights.needsUpdate=p,h.directionalLightShadows.needsUpdate=p,h.pointLights.needsUpdate=p,h.pointLightShadows.needsUpdate=p,h.spotLights.needsUpdate=p,h.spotLightShadows.needsUpdate=p,h.rectAreaLights.needsUpdate=p,h.hemisphereLights.needsUpdate=p),f&&!0===r.fog&&A.refreshFogUniforms(z,f),A.refreshMaterialUniforms(z,r,ec,eu,q.state.transmissionRenderTarget[e.id]),a2.upload(ew,eY(B),z,u)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(a2.upload(ew,eY(B),z,u),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&F.setValue(ew,"center",o.center),N.numMultiviewViews>0?M.updateObjectMatricesUniforms(o,e,F):(F.setValue(ew,"modelViewMatrix",o.modelViewMatrix),F.setValue(ew,"normalMatrix",o.normalMatrix)),F.setValue(ew,"modelMatrix",o.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){let e=r.uniformsGroups;for(let i=0,n=e.length;i<n;i++){let n=e[i];L.update(n,N),L.bind(n,N)}}return N}(e,i,n,r,o);a.setMaterial(r,g);let y=n.index,x=1;if(!0===r.wireframe){if(void 0===(y=f.getWireframeAttribute(n)))return;x=2}let _=n.drawRange,b=n.attributes.position,w=_.start*x,C=(_.start+_.count)*x;null!==h&&(w=Math.max(w,h.start*x),C=Math.min(C,(h.start+h.count)*x)),null!==y?(w=Math.max(w,0),C=Math.min(C,y.count)):null!=b&&(w=Math.max(w,0),C=Math.min(C,b.count));let I=C-w;if(I<0||I===1/0)return;B.setup(o,r,v,n,y);let P=T;if(null!==y&&(m=p.get(y),(P=R).setIndex(m)),o.isMesh)!0===r.wireframe?(a.setLineWidth(r.wireframeLinewidth*eE()),P.setMode(ew.LINES)):P.setMode(ew.TRIANGLES);else if(o.isLine){let e=r.linewidth;void 0===e&&(e=1),a.setLineWidth(e*eE()),o.isLineSegments?P.setMode(ew.LINES):o.isLineLoop?P.setMode(ew.LINE_LOOP):P.setMode(ew.LINE_STRIP)}else o.isPoints?P.setMode(ew.POINTS):o.isSprite&&P.setMode(ew.TRIANGLES);if(o.isBatchedMesh)null!==o._multiDrawInstances?P.renderMultiDrawInstances(o._multiDrawStarts,o._multiDrawCounts,o._multiDrawCount,o._multiDrawInstances):P.renderMultiDraw(o._multiDrawStarts,o._multiDrawCounts,o._multiDrawCount);else if(o.isInstancedMesh)P.renderInstances(w,I,o.count);else if(n.isInstancedBufferGeometry){let e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,i=Math.min(n.instanceCount,e);P.renderInstances(w,I,i)}else P.render(w,I)},this.compile=function(e,i,n=null){null===n&&(n=e),(q=y.get(n)).init(i),K.push(q),n.traverseVisible(function(e){e.isLight&&e.layers.test(i.layers)&&(q.pushLight(e),e.castShadow&&q.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(i.layers)&&(q.pushLight(e),e.castShadow&&q.pushShadow(e))}),q.setupLights(Y._useLegacyLights);let r=new Set;return e.traverse(function(e){let i=e.material;if(i){if(Array.isArray(i))for(let s=0;s<i.length;s++){let a=i[s];eL(a,n,e),r.add(a)}else eL(i,n,e),r.add(i)}}),K.pop(),q=null,r},this.compileAsync=function(e,i,n=null){let s=this.compile(e,i,n);return new Promise(i=>{function n(){if(s.forEach(function(e){l.get(e).currentProgram.isReady()&&s.delete(e)}),0===s.size){i(e);return}setTimeout(n,10)}null!==r.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let eD=null;function eO(){eF.stop()}function eU(){eF.start()}let eF=new sb;function eG(e,i,n,r){let s=e.opaque,o=e.transmissive,l=e.transparent;q.setupLightsView(n),!0===ev&&E.setGlobalState(Y.clippingPlanes,n),r&&a.viewport(en.copy(r)),s.length>0&&eq(s,i,n),o.length>0&&eq(o,i,n),l.length>0&&eq(l,i,n),a.buffers.depth.setTest(!0),a.buffers.depth.setMask(!0),a.buffers.color.setMask(!0),a.setPolygonOffset(!1)}function eW(e,i,n,s){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===q.state.transmissionRenderTarget[s.id]&&(q.state.transmissionRenderTarget[s.id]=new ni(1,1,{generateMipmaps:!0,type:r.has("EXT_color_buffer_half_float")||r.has("EXT_color_buffer_float")?eV:eN,minFilter:eP,samples:4,stencilBuffer:O,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));let a=q.state.transmissionRenderTarget[s.id],o=s.viewport||en;a.setSize(o.z,o.w);let l=Y.getRenderTarget();Y.setRenderTarget(a),Y.getClearColor(eo),(el=Y.getClearAlpha())<1&&Y.setClearColor(0xffffff,.5),Y.clear();let h=Y.toneMapping;Y.toneMapping=ea;let c=s.viewport;if(void 0!==s.viewport&&(s.viewport=void 0),q.setupLightsView(s),!0===ev&&E.setGlobalState(Y.clippingPlanes,s),eq(e,n,s),u.updateMultisampleRenderTarget(a),u.updateRenderTargetMipmap(a),!1===r.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,a=i.length;r<a;r++){let a=i[r],o=a.object,l=a.geometry,h=a.material,u=a.group;if(h.side===b&&o.layers.test(s.layers)){let i=h.side;h.side=_,h.needsUpdate=!0,eX(o,n,s,l,h,u),h.side=i,h.needsUpdate=!0,e=!0}}!0===e&&(u.updateMultisampleRenderTarget(a),u.updateRenderTargetMipmap(a))}Y.setRenderTarget(l),Y.setClearColor(eo,el),void 0!==c&&(s.viewport=c),Y.toneMapping=h}function eq(e,i,n){let r=!0===i.isScene?i.overrideMaterial:null;for(let s=0,a=e.length;s<a;s++){let a=e[s],o=a.object,l=a.geometry,h=null===r?a.material:r,u=a.group;o.layers.test(n.layers)&&eX(o,i,n,l,h,u)}}function eX(e,i,n,r,s,a){e.onBeforeRender(Y,i,n,r,s,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),s.onBeforeRender(Y,i,n,r,e,a),!0===s.transparent&&s.side===b&&!1===s.forceSinglePass?(s.side=_,s.needsUpdate=!0,Y.renderBufferDirect(n,i,r,s,e,a),s.side=x,s.needsUpdate=!0,Y.renderBufferDirect(n,i,r,s,e,a),s.side=b):Y.renderBufferDirect(n,i,r,s,e,a),e.onAfterRender(Y,i,n,r,s,a)}function eK(e,i,n){var r;!0!==i.isScene&&(i=eb);let s=l.get(e),a=q.state.lights,o=q.state.shadowsArray,h=a.state.version,u=g.getParameters(e,a.state,o,i,n),p=g.getProgramCacheKey(u),f=s.programs;s.environment=e.isMeshStandardMaterial?i.environment:null,s.fog=i.fog,s.envMap=(e.isMeshStandardMaterial?d:c).get(e.envMap||s.environment),s.envMapRotation=null!==s.environment&&null===e.envMap?i.environmentRotation:e.envMapRotation,void 0===f&&(e.addEventListener("dispose",eB),f=new Map,s.programs=f);let m=f.get(p);if(void 0!==m){if(s.currentProgram===m&&s.lightsStateVersion===h)return eJ(e,u),m}else u.uniforms=g.getUniforms(e),e.onBuild(n,u,Y),e.onBeforeCompile(u,Y),m=g.acquireProgram(u,p),f.set(p,m),s.uniforms=u.uniforms;let A=s.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(A.clippingPlanes=E.uniform),eJ(e,u),s.needsLights=(r=e).isMeshLambertMaterial||r.isMeshToonMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.isShadowMaterial||r.isShaderMaterial&&!0===r.lights,s.lightsStateVersion=h,s.needsLights&&(A.ambientLightColor.value=a.state.ambient,A.lightProbe.value=a.state.probe,A.directionalLights.value=a.state.directional,A.directionalLightShadows.value=a.state.directionalShadow,A.spotLights.value=a.state.spot,A.spotLightShadows.value=a.state.spotShadow,A.rectAreaLights.value=a.state.rectArea,A.ltc_1.value=a.state.rectAreaLTC1,A.ltc_2.value=a.state.rectAreaLTC2,A.pointLights.value=a.state.point,A.pointLightShadows.value=a.state.pointShadow,A.hemisphereLights.value=a.state.hemi,A.directionalShadowMap.value=a.state.directionalShadowMap,A.directionalShadowMatrix.value=a.state.directionalShadowMatrix,A.spotShadowMap.value=a.state.spotShadowMap,A.spotLightMatrix.value=a.state.spotLightMatrix,A.spotLightMap.value=a.state.spotLightMap,A.pointShadowMap.value=a.state.pointShadowMap,A.pointShadowMatrix.value=a.state.pointShadowMatrix),s.currentProgram=m,s.uniformsList=null,m}function eY(e){if(null===e.uniformsList){let i=e.currentProgram.getUniforms();e.uniformsList=a2.seqWithValue(i.seq,e.uniforms)}return e.uniformsList}function eJ(e,i){let n=l.get(e);n.outputColorSpace=i.outputColorSpace,n.batching=i.batching,n.instancing=i.instancing,n.instancingColor=i.instancingColor,n.instancingMorph=i.instancingMorph,n.skinning=i.skinning,n.morphTargets=i.morphTargets,n.morphNormals=i.morphNormals,n.morphColors=i.morphColors,n.morphTargetsCount=i.morphTargetsCount,n.numClippingPlanes=i.numClippingPlanes,n.numIntersection=i.numClipIntersection,n.vertexAlphas=i.vertexAlphas,n.vertexTangents=i.vertexTangents,n.toneMapping=i.toneMapping,n.numMultiviewViews=i.numMultiviewViews}eF.setAnimationLoop(function(e){eD&&eD(e)}),"undefined"!=typeof self&&eF.setContext(self),this.setAnimationLoop=function(e){eD=e,eS.setAnimationLoop(e),null===e?eF.stop():eF.start()},eS.addEventListener("sessionstart",eO),eS.addEventListener("sessionend",eU),this.render=function(e,i){if(void 0!==i&&!0!==i.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===J)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===i.parent&&!0===i.matrixWorldAutoUpdate&&i.updateMatrixWorld(),!0===eS.enabled&&!0===eS.isPresenting&&(!0===eS.cameraAutoUpdate&&eS.updateCamera(i),i=eS.getCamera()),!0===e.isScene&&e.onBeforeRender(Y,e,i,ee),(q=y.get(e,K.length)).init(i),K.push(q),ex.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),eA.setFromProjectionMatrix(ex),ey=this.localClippingEnabled,ev=E.init(this.clippingPlanes,ey),(W=v.get(e,X.length)).init(),X.push(W),function e(i,n,r,s){if(!1===i.visible)return;if(i.layers.test(n.layers)){if(i.isGroup)r=i.renderOrder;else if(i.isLOD)!0===i.autoUpdate&&i.update(n);else if(i.isLight)q.pushLight(i),i.castShadow&&q.pushShadow(i);else if(i.isSprite){if(!i.frustumCulled||eA.intersectsSprite(i)){s&&e_.setFromMatrixPosition(i.matrixWorld).applyMatrix4(ex);let e=m.update(i),n=i.material;n.visible&&W.push(i,e,n,r,e_.z,null)}}else if((i.isMesh||i.isLine||i.isPoints)&&(!i.frustumCulled||eA.intersectsObject(i))){let e=m.update(i),n=i.material;if(s&&(void 0!==i.boundingSphere?(null===i.boundingSphere&&i.computeBoundingSphere(),e_.copy(i.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),e_.copy(e.boundingSphere.center)),e_.applyMatrix4(i.matrixWorld).applyMatrix4(ex)),Array.isArray(n)){let s=e.groups;for(let a=0,o=s.length;a<o;a++){let o=s[a],l=n[o.materialIndex];l&&l.visible&&W.push(i,e,l,r,e_.z,o)}}else n.visible&&W.push(i,e,n,r,e_.z,null)}}let a=i.children;for(let i=0,o=a.length;i<o;i++)e(a[i],n,r,s)}(e,i,0,Y.sortObjects),W.finish(),!0===Y.sortObjects&&W.sort(ed,ep);let n=!1===eS.enabled||!1===eS.isPresenting||!1===eS.hasDepthSensing();n&&C.addToRenderList(W,e),this.info.render.frame++,!0===ev&&E.beginShadows();let r=q.state.shadowsArray;w.render(r,e,i),!0===ev&&E.endShadows(),!0===this.info.autoReset&&this.info.reset();let s=W.opaque,a=W.transmissive;if(q.setupLights(Y._useLegacyLights),i.isArrayCamera){let r=i.cameras;if(a.length>0)for(let i=0,n=r.length;i<n;i++)eW(s,a,e,r[i]);if(n&&C.render(e),eS.enabled&&eS.isMultiview)u.setDeferTextureUploads(!0),eG(W,e,i,i.cameras[0].viewport);else for(let i=0,n=r.length;i<n;i++){let n=r[i];eG(W,e,n,n.viewport)}}else a.length>0&&eW(s,a,e,i),n&&C.render(e),eG(W,e,i);null!==ee&&(u.updateMultisampleRenderTarget(ee),u.updateRenderTargetMipmap(ee)),!0===e.isScene&&e.onAfterRender(Y,e,i),u.runDeferredUploads(),eS.enabled&&eS.submitFrame&&eS.submitFrame(),B.resetDefaultState(),et=-1,ei=null,K.pop(),K.length>0?(q=K[K.length-1],!0===ev&&E.setGlobalState(Y.clippingPlanes,q.state.camera)):q=null,X.pop(),W=X.length>0?X[X.length-1]:null},this.setTexture2D=(i=!1,function(e,n){e&&e.isWebGLRenderTarget&&(i||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),i=!0),e=e.texture),u.setTexture2D(e,n)}),this.getActiveCubeFace=function(){return Z},this.getActiveMipmapLevel=function(){return $},this.getRenderTarget=function(){return ee},this.setRenderTargetTextures=function(e,i,n){l.get(e.texture).__webglTexture=i,l.get(e.depthTexture).__webglTexture=n;let s=l.get(e);s.__hasExternalTextures=!0,s.__autoAllocateDepthBuffer=void 0===n,s.__autoAllocateDepthBuffer||ee&&ee.isWebGLMultiviewRenderTarget||!0!==r.has("WEBGL_multisampled_render_to_texture")||(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),s.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,i){let n=l.get(e);n.__webglFramebuffer=i,n.__useDefaultFramebuffer=void 0===i},this.setRenderTarget=function(e,i=0,n=0){ee=e,Z=i,$=n;let r=!0,s=null,o=!1,h=!1;if(e){let c=l.get(e);void 0!==c.__useDefaultFramebuffer?(a.bindFramebuffer(ew.FRAMEBUFFER,null),r=!1):void 0===c.__webglFramebuffer?u.setupRenderTarget(e):c.__hasExternalTextures&&u.rebindTextures(e,l.get(e.texture).__webglTexture,l.get(e.depthTexture).__webglTexture);let d=e.texture;(d.isData3DTexture||d.isDataArrayTexture||d.isCompressedArrayTexture)&&(h=!0);let p=l.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(s=Array.isArray(p[i])?p[i][n]:p[i],o=!0):s=e.samples>0&&!1===u.useMultisampledRTT(e)?l.get(e).__webglMultisampledFramebuffer:Array.isArray(p)?p[n]:p,en.copy(e.viewport),er.copy(e.scissor),es=e.scissorTest}else en.copy(ef).multiplyScalar(ec).floor(),er.copy(em).multiplyScalar(ec).floor(),es=eg;if(a.bindFramebuffer(ew.FRAMEBUFFER,s)&&r&&a.drawBuffers(e,s),a.viewport(en),a.scissor(er),a.setScissorTest(es),o){let r=l.get(e.texture);ew.framebufferTexture2D(ew.FRAMEBUFFER,ew.COLOR_ATTACHMENT0,ew.TEXTURE_CUBE_MAP_POSITIVE_X+i,r.__webglTexture,n)}else if(h){let r=l.get(e.texture);ew.framebufferTextureLayer(ew.FRAMEBUFFER,ew.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i||0)}et=-1},this.readRenderTargetPixels=function(e,i,n,r,o,h,u){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let c=l.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==u&&(c=c[u]),c){a.bindFramebuffer(ew.FRAMEBUFFER,c);try{let a=e.texture,l=a.format,u=a.type;if(!s.textureFormatReadable(l)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!s.textureTypeReadable(u)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}i>=0&&i<=e.width-r&&n>=0&&n<=e.height-o&&ew.readPixels(i,n,r,o,I.convert(l),I.convert(u),h)}finally{let e=null!==ee?l.get(ee).__webglFramebuffer:null;a.bindFramebuffer(ew.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,i,n=0){let r=Math.pow(2,-n),s=Math.floor(i.image.width*r),o=Math.floor(i.image.height*r);u.setTexture2D(i,0),ew.copyTexSubImage2D(ew.TEXTURE_2D,n,0,0,e.x,e.y,s,o),a.unbindTexture()},this.copyTextureToTexture=function(e,i,n,r=0){let s=i.image.width,o=i.image.height,l=I.convert(n.format),h=I.convert(n.type);u.setTexture2D(n,0),ew.pixelStorei(ew.UNPACK_FLIP_Y_WEBGL,n.flipY),ew.pixelStorei(ew.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ew.pixelStorei(ew.UNPACK_ALIGNMENT,n.unpackAlignment),i.isDataTexture?ew.texSubImage2D(ew.TEXTURE_2D,r,e.x,e.y,s,o,l,h,i.image.data):i.isCompressedTexture?ew.compressedTexSubImage2D(ew.TEXTURE_2D,r,e.x,e.y,i.mipmaps[0].width,i.mipmaps[0].height,l,i.mipmaps[0].data):ew.texSubImage2D(ew.TEXTURE_2D,r,e.x,e.y,l,h,i.image),0===r&&n.generateMipmaps&&ew.generateMipmap(ew.TEXTURE_2D),a.unbindTexture()},this.copyTextureToTexture3D=function(e,i,n,r,s=0){let o;let l=e.max.x-e.min.x,h=e.max.y-e.min.y,c=e.max.z-e.min.z,d=I.convert(r.format),p=I.convert(r.type);if(r.isData3DTexture)u.setTexture3D(r,0),o=ew.TEXTURE_3D;else if(r.isDataArrayTexture||r.isCompressedArrayTexture)u.setTexture2DArray(r,0),o=ew.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ew.pixelStorei(ew.UNPACK_FLIP_Y_WEBGL,r.flipY),ew.pixelStorei(ew.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),ew.pixelStorei(ew.UNPACK_ALIGNMENT,r.unpackAlignment);let f=ew.getParameter(ew.UNPACK_ROW_LENGTH),m=ew.getParameter(ew.UNPACK_IMAGE_HEIGHT),g=ew.getParameter(ew.UNPACK_SKIP_PIXELS),A=ew.getParameter(ew.UNPACK_SKIP_ROWS),v=ew.getParameter(ew.UNPACK_SKIP_IMAGES),y=n.isCompressedTexture?n.mipmaps[s]:n.image;ew.pixelStorei(ew.UNPACK_ROW_LENGTH,y.width),ew.pixelStorei(ew.UNPACK_IMAGE_HEIGHT,y.height),ew.pixelStorei(ew.UNPACK_SKIP_PIXELS,e.min.x),ew.pixelStorei(ew.UNPACK_SKIP_ROWS,e.min.y),ew.pixelStorei(ew.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?ew.texSubImage3D(o,s,i.x,i.y,i.z,l,h,c,d,p,y.data):r.isCompressedArrayTexture?ew.compressedTexSubImage3D(o,s,i.x,i.y,i.z,l,h,c,d,y.data):ew.texSubImage3D(o,s,i.x,i.y,i.z,l,h,c,d,p,y),ew.pixelStorei(ew.UNPACK_ROW_LENGTH,f),ew.pixelStorei(ew.UNPACK_IMAGE_HEIGHT,m),ew.pixelStorei(ew.UNPACK_SKIP_PIXELS,g),ew.pixelStorei(ew.UNPACK_SKIP_ROWS,A),ew.pixelStorei(ew.UNPACK_SKIP_IMAGES,v),0===s&&r.generateMipmaps&&ew.generateMipmap(o),a.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?u.setTextureCube(e,0):e.isData3DTexture?u.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?u.setTexture2DArray(e,0):u.setTexture2D(e,0),a.unbindTexture()},this.resetState=function(){Z=0,$=0,ee=null,a.reset(),B.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return iS}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let i=this.getContext();i.drawingBufferColorSpace=e===tX?"display-p3":"srgb",i.unpackColorSpace=i1.workingColorSpace===tK?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class oW{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new rA(e),this.density=i}clone(){return new oW(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class oq{constructor(e,i=1,n=1e3){this.isFog=!0,this.name="",this.color=new rA(e),this.near=i,this.far=n}clone(){return new oq(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class oX extends rt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new nX,this.environmentIntensity=1,this.environmentRotation=new nX,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let i=super.toJSON(e);return null!==this.fog&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class oK{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=void 0!==e?e.length/i:0,this.usage=ig,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=iD()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return iY("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,n){e*=this.stride,n*=i.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=i.array[n+r];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=iD()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(i,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=iD()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}let oY=new nl;class oJ{constructor(e,i,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)oY.fromBufferAttribute(this,i),oY.applyMatrix4(e),this.setXYZ(i,oY.x,oY.y,oY.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)oY.fromBufferAttribute(this,i),oY.applyNormalMatrix(e),this.setXYZ(i,oY.x,oY.y,oY.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)oY.fromBufferAttribute(this,i),oY.transformDirection(e),this.setXYZ(i,oY.x,oY.y,oY.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=ik(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=iF(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=iF(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=iF(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=iF(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=iF(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=ik(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=ik(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=ik(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=ik(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array),r=iF(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,i,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=iF(i,this.array),n=iF(n,this.array),r=iF(r,this.array),s=iF(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new oJ(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[n+i])}return new rT(new this.array.constructor(e),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[n+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}}}class oZ extends rx{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new rA(0xffffff),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let o$=new nl,o0=new nl,o1=new nl,o2=new iG,o3=new iG,o4=new nk,o5=new nl,o6=new nl,o8=new nl,o7=new iG,o9=new iG,le=new iG;class lt extends rt{constructor(e=new oZ){if(super(),this.isSprite=!0,this.type="Sprite",void 0===s){s=new rQ;let e=new oK(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);s.setIndex([0,1,2,0,2,3]),s.setAttribute("position",new oJ(e,3,0,!1)),s.setAttribute("uv",new oJ(e,2,3,!1))}this.geometry=s,this.material=e,this.center=new iG(.5,.5)}raycast(e,i){let n,r;null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),o0.setFromMatrixScale(this.matrixWorld),o4.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),o1.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&o0.multiplyScalar(-o1.z);let s=this.material.rotation;0!==s&&(r=Math.cos(s),n=Math.sin(s));let a=this.center;li(o5.set(-.5,-.5,0),o1,a,o0,n,r),li(o6.set(.5,-.5,0),o1,a,o0,n,r),li(o8.set(.5,.5,0),o1,a,o0,n,r),o7.set(0,0),o9.set(1,0),le.set(1,1);let o=e.ray.intersectTriangle(o5,o6,o8,!1,o$);if(null===o&&(li(o6.set(-.5,.5,0),o1,a,o0,n,r),o9.set(0,1),null===(o=e.ray.intersectTriangle(o5,o8,o6,!1,o$))))return;let l=e.ray.origin.distanceTo(o$);l<e.near||l>e.far||i.push({distance:l,point:o$.clone(),uv:rd.getInterpolation(o$,o5,o6,o8,o7,o9,le,new iG),face:null,object:this})}copy(e,i){return super.copy(e,i),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function li(e,i,n,r,s,a){o2.subVectors(e,n).addScalar(.5).multiply(r),void 0!==s?(o3.x=a*o2.x-s*o2.y,o3.y=s*o2.x+a*o2.y):o3.copy(o2),e.copy(i),e.x+=o3.x,e.y+=o3.y,e.applyMatrix4(o4)}let ln=new nl,lr=new nl;class ls extends rt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let i=e.levels;for(let e=0,n=i.length;e<n;e++){let n=i[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,i=0,n=0){let r;i=Math.abs(i);let s=this.levels;for(r=0;r<s.length&&!(i<s[r].distance);r++);return s.splice(r,0,{distance:i,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let i=this.levels;if(i.length>0){let n,r;for(n=1,r=i.length;n<r;n++){let r=i[n].distance;if(i[n].object.visible&&(r-=r*i[n].hysteresis),e<r)break}return i[n-1].object}return null}raycast(e,i){if(this.levels.length>0){ln.setFromMatrixPosition(this.matrixWorld);let n=e.ray.origin.distanceTo(ln);this.getObjectForDistance(n).raycast(e,i)}}update(e){let i=this.levels;if(i.length>1){let n,r;ln.setFromMatrixPosition(e.matrixWorld),lr.setFromMatrixPosition(this.matrixWorld);let s=ln.distanceTo(lr)/e.zoom;for(n=1,i[0].object.visible=!0,r=i.length;n<r;n++){let e=i[n].distance;if(i[n].object.visible&&(e-=e*i[n].hysteresis),s>=e)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<r;n++)i[n].object.visible=!1}}toJSON(e){let i=super.toJSON(e);!1===this.autoUpdate&&(i.object.autoUpdate=!1),i.object.levels=[];let n=this.levels;for(let e=0,r=n.length;e<r;e++){let r=n[e];i.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return i}}let la=new nl,lo=new ne,ll=new ne,lh=new nl,lu=new nk,lc=new nl,ld=new nR,lp=new nk,lf=new nU;class lm extends r9{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=ef,this.bindMatrix=new nk,this.bindMatrixInverse=new nk,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let e=this.geometry;null===this.boundingBox&&(this.boundingBox=new nc),this.boundingBox.makeEmpty();let i=e.getAttribute("position");for(let e=0;e<i.count;e++)this.getVertexPosition(e,lc),this.boundingBox.expandByPoint(lc)}computeBoundingSphere(){let e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new nR),this.boundingSphere.makeEmpty();let i=e.getAttribute("position");for(let e=0;e<i.count;e++)this.getVertexPosition(e,lc),this.boundingSphere.expandByPoint(lc)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){let n=this.material,r=this.matrixWorld;if(void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),ld.copy(this.boundingSphere),ld.applyMatrix4(r),!1!==e.ray.intersectsSphere(ld))){if(lp.copy(r).invert(),lf.copy(e.ray).applyMatrix4(lp),null!==this.boundingBox&&!1===lf.intersectsBox(this.boundingBox))return;this._computeIntersections(e,i,lf)}}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,void 0===i&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new ne,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){e.fromBufferAttribute(i,n);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),i.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===ef?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===em?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){let n=this.skeleton,r=this.geometry;lo.fromBufferAttribute(r.attributes.skinIndex,e),ll.fromBufferAttribute(r.attributes.skinWeight,e),la.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let e=0;e<4;e++){let r=ll.getComponent(e);if(0!==r){let s=lo.getComponent(e);lu.multiplyMatrices(n.bones[s].matrixWorld,n.boneInverses[s]),i.addScaledVector(lh.copy(la).applyMatrix4(lu),r)}}return i.applyMatrix4(this.bindMatrixInverse)}}class lg extends rt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class lA extends i9{constructor(e=null,i=1,n=1,r,s,a,o,l,h=eM,u=eM,c,d){super(null,a,o,l,h,u,r,s,c,d),this.isDataTexture=!0,this.image={data:e,width:i,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let lv=new nk,ly=new nk;class lx{constructor(e=[],i=[]){this.uuid=iD(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===i.length)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,i=this.bones.length;e<i;e++)this.boneInverses.push(new nk)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){let i=new nk;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,i=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let s=e[r]?e[r].matrixWorld:ly;lv.multiplyMatrices(s,i[r]),lv.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new lx(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length),i=new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4);i.set(this.boneMatrices);let n=new lA(i,e,e,eK,eG);return n.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=n,this}getBoneByName(e){for(let i=0,n=this.bones.length;i<n;i++){let n=this.bones[i];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){let r=e.bones[n],s=i[r];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new lg),this.bones.push(s),this.boneInverses.push(new nk().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){let e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let i=this.bones,n=this.boneInverses;for(let r=0,s=i.length;r<s;r++){let s=i[r];e.bones.push(s.uuid);let a=n[r];e.boneInverses.push(a.toArray())}return e}}class l_ extends rT{constructor(e,i,n,r=1){super(e,i,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}let lb=new nk,lE=new nk,lw=[],lM=new nc,lC=new nk,lS=new r9,lT=new nR;class lR extends r9{constructor(e,i,n){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new l_(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,lC)}computeBoundingBox(){let e=this.geometry,i=this.count;null===this.boundingBox&&(this.boundingBox=new nc),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<i;n++)this.getMatrixAt(n,lb),lM.copy(e.boundingBox).applyMatrix4(lb),this.boundingBox.union(lM)}computeBoundingSphere(){let e=this.geometry,i=this.count;null===this.boundingSphere&&(this.boundingSphere=new nR),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<i;n++)this.getMatrixAt(n,lb),lT.copy(e.boundingSphere).applyMatrix4(lb),this.boundingSphere.union(lT)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,i){let n=i.morphTargetInfluences,r=this.morphTexture.source.data.data,s=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=r[s+e]}raycast(e,i){let n=this.matrixWorld,r=this.count;if(lS.geometry=this.geometry,lS.material=this.material,void 0!==lS.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),lT.copy(this.boundingSphere),lT.applyMatrix4(n),!1!==e.ray.intersectsSphere(lT)))for(let s=0;s<r;s++){this.getMatrixAt(s,lb),lE.multiplyMatrices(n,lb),lS.matrixWorld=lE,lS.raycast(e,lw);for(let e=0,n=lw.length;e<n;e++){let n=lw[e];n.instanceId=s,n.object=this,i.push(n)}lw.length=0}}setColorAt(e,i){null===this.instanceColor&&(this.instanceColor=new l_(new Float32Array(3*this.instanceMatrix.count),3)),i.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,i){let n=i.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new lA(new Float32Array(r*this.count),r,this.count,e0,eG));let s=this.morphTexture.source.data.data,a=0;for(let e=0;e<n.length;e++)a+=n[e];let o=this.geometry.morphTargetsRelative?1:1-a,l=r*e;s[l]=o,s.set(n,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function lI(e,i){return e.z-i.z}function lB(e,i){return i.z-e.z}let lL="batchId",lP=new nk,lD=new nk,lN=new nk,lO=new nk,lU=new s_,lk=new nc,lF=new nR,lz=new nl,lG=new class{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i){let n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});let s=n[this.index];r.push(s),this.index++,s.start=e.start,s.count=e.count,s.z=i}reset(){this.list.length=0,this.index=0}},lV=new r9,lj=[];class lH extends r9{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,i,n=2*i,r){super(new rQ,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=i,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount),i=new lA(new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4),e,e,eK,eG);this._matricesTexture=i}_initializeGeometry(e){let i=this.geometry,n=this._maxVertexCount,r=this._maxGeometryCount,s=this._maxIndexCount;if(!1===this._geometryInitialized){for(let r in e.attributes){let{array:s,itemSize:a,normalized:o}=e.getAttribute(r),l=new rT(new s.constructor(n*a),a,o);i.setAttribute(r,l)}if(null!==e.getIndex()){let e=n>65536?new Uint32Array(s):new Uint16Array(s);i.setIndex(new rT(e,1))}let a=r>65536?new Uint32Array(n):new Uint16Array(n);i.setAttribute(lL,new rT(a,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(lL))throw Error(`BatchedMesh: Geometry cannot use attribute "${lL}"`);let i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw Error('BatchedMesh: All geometries must consistently have "index".');for(let n in i.attributes){if(n===lL)continue;if(!e.hasAttribute(n))throw Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);let r=e.getAttribute(n),s=i.getAttribute(n);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nc);let e=this._geometryCount,i=this.boundingBox,n=this._active;i.makeEmpty();for(let r=0;r<e;r++)!1!==n[r]&&(this.getMatrixAt(r,lP),this.getBoundingBoxAt(r,lk).applyMatrix4(lP),i.union(lk))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new nR);let e=this._geometryCount,i=this.boundingSphere,n=this._active;i.makeEmpty();for(let r=0;r<e;r++)!1!==n[r]&&(this.getMatrixAt(r,lP),this.getBoundingSphereAt(r,lF).applyMatrix4(lP),i.union(lF))}addGeometry(e,i=-1,n=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw Error("BatchedMesh: Maximum geometry count reached.");let r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1},s=null,a=this._reservedRanges,o=this._drawRanges,l=this._bounds;0!==this._geometryCount&&(s=a[a.length-1]),-1===i?r.vertexCount=e.getAttribute("position").count:r.vertexCount=i,null===s?r.vertexStart=0:r.vertexStart=s.vertexStart+s.vertexCount;let h=e.getIndex(),u=null!==h;if(u&&(-1===n?r.indexCount=h.count:r.indexCount=n,null===s?r.indexStart=0:r.indexStart=s.indexStart+s.indexCount),-1!==r.indexStart&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let c=this._visibility,d=this._active,p=this._matricesTexture,f=this._matricesTexture.image.data;c.push(!0),d.push(!0);let m=this._geometryCount;this._geometryCount++,lN.toArray(f,16*m),p.needsUpdate=!0,a.push(r),o.push({start:u?r.indexStart:r.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new nc,sphereInitialized:!1,sphere:new nR});let g=this.geometry.getAttribute(lL);for(let e=0;e<r.vertexCount;e++)g.setX(r.vertexStart+e,m);return g.needsUpdate=!0,this.setGeometryAt(m,e),m}setGeometryAt(e,i){if(e>=this._geometryCount)throw Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);let n=this.geometry,r=null!==n.getIndex(),s=n.getIndex(),a=i.getIndex(),o=this._reservedRanges[e];if(r&&a.count>o.indexCount||i.attributes.position.count>o.vertexCount)throw Error("BatchedMesh: Reserved space not large enough for provided geometry.");let l=o.vertexStart,h=o.vertexCount;for(let e in n.attributes){if(e===lL)continue;let r=i.getAttribute(e),s=n.getAttribute(e);!function(e,i,n=0){let r=i.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==i.array.constructor){let s=e.count;for(let a=0;a<s;a++)for(let s=0;s<r;s++)i.setComponent(a+n,s,e.getComponent(a,s))}else i.array.set(e.array,n*r);i.needsUpdate=!0}(r,s,l);let a=r.itemSize;for(let e=r.count;e<h;e++){let i=l+e;for(let e=0;e<a;e++)s.setComponent(i,e,0)}s.needsUpdate=!0,s.addUpdateRange(l*a,h*a)}if(r){let e=o.indexStart;for(let i=0;i<a.count;i++)s.setX(e+i,l+a.getX(i));for(let i=a.count,n=o.indexCount;i<n;i++)s.setX(e+i,l);s.needsUpdate=!0,s.addUpdateRange(e,o.indexCount)}let u=this._bounds[e];null!==i.boundingBox?(u.box.copy(i.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,null!==i.boundingSphere?(u.sphere.copy(i.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;let c=this._drawRanges[e],d=i.getAttribute("position");return c.count=r?a.count:d.count,this._visibilityChanged=!0,e}deleteGeometry(e){let i=this._active;return e>=i.length||!1===i[e]||(i[e]=!1,this._visibilityChanged=!0),this}getInstanceCountAt(e){return null===this._multiDrawInstances?null:this._multiDrawInstances[e]}setInstanceCountAt(e,i){return null===this._multiDrawInstances&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[e]=i,e}getBoundingBoxAt(e,i){if(!1===this._active[e])return null;let n=this._bounds[e],r=n.box,s=this.geometry;if(!1===n.boxInitialized){r.makeEmpty();let i=s.index,a=s.attributes.position,o=this._drawRanges[e];for(let e=o.start,n=o.start+o.count;e<n;e++){let n=e;i&&(n=i.getX(n)),r.expandByPoint(lz.fromBufferAttribute(a,n))}n.boxInitialized=!0}return i.copy(r),i}getBoundingSphereAt(e,i){if(!1===this._active[e])return null;let n=this._bounds[e],r=n.sphere,s=this.geometry;if(!1===n.sphereInitialized){r.makeEmpty(),this.getBoundingBoxAt(e,lk),lk.getCenter(r.center);let i=s.index,a=s.attributes.position,o=this._drawRanges[e],l=0;for(let e=o.start,n=o.start+o.count;e<n;e++){let n=e;i&&(n=i.getX(n)),lz.fromBufferAttribute(a,n),l=Math.max(l,r.center.distanceToSquared(lz))}r.radius=Math.sqrt(l),n.sphereInitialized=!0}return i.copy(r),i}setMatrixAt(e,i){let n=this._active,r=this._matricesTexture,s=this._matricesTexture.image.data;return e>=this._geometryCount||!1===n[e]||(i.toArray(s,16*e),r.needsUpdate=!0),this}getMatrixAt(e,i){let n=this._active,r=this._matricesTexture.image.data;return e>=this._geometryCount||!1===n[e]?null:i.fromArray(r,16*e)}setVisibleAt(e,i){let n=this._visibility,r=this._active;return e>=this._geometryCount||!1===r[e]||n[e]===i||(n[e]=i,this._visibilityChanged=!0),this}getVisibleAt(e){let i=this._visibility,n=this._active;return!(e>=this._geometryCount)&&!1!==n[e]&&i[e]}raycast(e,i){let n=this._visibility,r=this._active,s=this._drawRanges,a=this._geometryCount,o=this.matrixWorld,l=this.geometry;lV.material=this.material,lV.geometry.index=l.index,lV.geometry.attributes=l.attributes,null===lV.geometry.boundingBox&&(lV.geometry.boundingBox=new nc),null===lV.geometry.boundingSphere&&(lV.geometry.boundingSphere=new nR);for(let l=0;l<a;l++){if(!n[l]||!r[l])continue;let a=s[l];lV.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(l,lV.matrixWorld).premultiply(o),this.getBoundingBoxAt(l,lV.geometry.boundingBox),this.getBoundingSphereAt(l,lV.geometry.boundingSphere),lV.raycast(e,lj);for(let e=0,n=lj.length;e<n;e++){let n=lj[e];n.object=this,n.batchId=l,i.push(n)}lj.length=0}lV.material=null,lV.geometry.index=null,lV.geometry.attributes={},lV.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(e=>({...e})),this._reservedRanges=e._reservedRanges.map(e=>({...e})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(e=>({boxInitialized:e.boxInitialized,box:e.box.clone(),sphereInitialized:e.sphereInitialized,sphere:e.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,i,n,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;let a=r.getIndex(),o=null===a?1:a.array.BYTES_PER_ELEMENT,l=this._active,h=this._visibility,u=this._multiDrawStarts,c=this._multiDrawCounts,d=this._drawRanges,p=this.perObjectFrustumCulled;p&&(lO.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),lU.setFromProjectionMatrix(lO,e.coordinateSystem));let f=0;if(this.sortObjects){lD.copy(this.matrixWorld).invert(),lz.setFromMatrixPosition(n.matrixWorld).applyMatrix4(lD);for(let e=0,i=h.length;e<i;e++)if(h[e]&&l[e]){this.getMatrixAt(e,lP),this.getBoundingSphereAt(e,lF).applyMatrix4(lP);let i=!1;if(p&&(i=!lU.intersectsSphere(lF)),!i){let i=lz.distanceTo(lF.center);lG.push(d[e],i)}}let e=lG.list,i=this.customSort;null===i?e.sort(s.transparent?lB:lI):i.call(this,e,n);for(let i=0,n=e.length;i<n;i++){let n=e[i];u[f]=n.start*o,c[f]=n.count,f++}lG.reset()}else for(let e=0,i=h.length;e<i;e++)if(h[e]&&l[e]){let i=!1;if(p&&(this.getMatrixAt(e,lP),this.getBoundingSphereAt(e,lF).applyMatrix4(lP),i=!lU.intersectsSphere(lF)),!i){let i=d[e];u[f]=i.start*o,c[f]=i.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,i,n,r,s,a){this.onBeforeRender(e,null,r,s,a)}}class lQ extends rx{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new rA(0xffffff),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}let lW=new nl,lq=new nl,lX=new nk,lK=new nU,lY=new nR,lJ=new nl,lZ=new nl;class l$ extends rt{constructor(e=new rQ,i=new lQ){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let i=e.attributes.position,n=[0];for(let e=1,r=i.count;e<r;e++)lW.fromBufferAttribute(i,e-1),lq.fromBufferAttribute(i,e),n[e]=n[e-1],n[e]+=lW.distanceTo(lq);e.setAttribute("lineDistance",new rU(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){let n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),lY.copy(n.boundingSphere),lY.applyMatrix4(r),lY.radius+=s,!1===e.ray.intersectsSphere(lY))return;lX.copy(r).invert(),lK.copy(e.ray).applyMatrix4(lX);let o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,h=this.isLineSegments?2:1,u=n.index,c=n.attributes.position;if(null!==u){let n=Math.max(0,a.start),r=Math.min(u.count,a.start+a.count);for(let s=n,a=r-1;s<a;s+=h){let n=l0(this,e,lK,l,u.getX(s),u.getX(s+1));n&&i.push(n)}if(this.isLineLoop){let s=l0(this,e,lK,l,u.getX(r-1),u.getX(n));s&&i.push(s)}}else{let n=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);for(let s=n,a=r-1;s<a;s+=h){let n=l0(this,e,lK,l,s,s+1);n&&i.push(n)}if(this.isLineLoop){let s=l0(this,e,lK,l,r-1,n);s&&i.push(s)}}}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++){let i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}function l0(e,i,n,r,s,a){let o=e.geometry.attributes.position;if(lW.fromBufferAttribute(o,s),lq.fromBufferAttribute(o,a),n.distanceSqToSegment(lW,lq,lJ,lZ)>r)return;lJ.applyMatrix4(e.matrixWorld);let l=i.ray.origin.distanceTo(lJ);if(!(l<i.near)&&!(l>i.far))return{distance:l,point:lZ.clone().applyMatrix4(e.matrixWorld),index:s,face:null,faceIndex:null,object:e}}let l1=new nl,l2=new nl;class l3 extends l${constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let i=e.attributes.position,n=[];for(let e=0,r=i.count;e<r;e+=2)l1.fromBufferAttribute(i,e),l2.fromBufferAttribute(i,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+l1.distanceTo(l2);e.setAttribute("lineDistance",new rU(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class l4 extends l${constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class l5 extends rx{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new rA(0xffffff),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let l6=new nk,l8=new nU,l7=new nR,l9=new nl;class he extends rt{constructor(e=new rQ,i=new l5){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){let n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),l7.copy(n.boundingSphere),l7.applyMatrix4(r),l7.radius+=s,!1===e.ray.intersectsSphere(l7))return;l6.copy(r).invert(),l8.copy(e.ray).applyMatrix4(l6);let o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,h=n.index,u=n.attributes.position;if(null!==h){let n=Math.max(0,a.start),s=Math.min(h.count,a.start+a.count);for(let a=n;a<s;a++){let n=h.getX(a);l9.fromBufferAttribute(u,n),ht(l9,n,l,r,e,i,this)}}else{let n=Math.max(0,a.start),s=Math.min(u.count,a.start+a.count);for(let a=n;a<s;a++)l9.fromBufferAttribute(u,a),ht(l9,a,l,r,e,i,this)}}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++){let i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}function ht(e,i,n,r,s,a,o){let l=l8.distanceSqToPoint(e);if(l<n){let n=new nl;l8.closestPointToPoint(e,n),n.applyMatrix4(r);let h=s.ray.origin.distanceTo(n);if(h<s.near||h>s.far)return;a.push({distance:h,distanceToRay:Math.sqrt(l),point:n,index:i,face:null,object:o})}}class hi extends i9{constructor(e,i,n,r,s,a,o,l,h){super(e,i,n,r,s,a,o,l,h),this.isVideoTexture=!0,this.minFilter=void 0!==a?a:eI,this.magFilter=void 0!==s?s:eI,this.generateMipmaps=!1;let u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function i(){u.needsUpdate=!0,e.requestVideoFrameCallback(i)})}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class hn extends i9{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=eM,this.minFilter=eM,this.generateMipmaps=!1,this.needsUpdate=!0}}class hr extends i9{constructor(e,i,n,r,s,a,o,l,h,u,c,d){super(null,a,o,l,h,u,r,s,c,d),this.isCompressedTexture=!0,this.image={width:i,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class hs extends hr{constructor(e,i,n,r,s,a){super(e,i,n,s,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=eE}}class ha extends hr{constructor(e,i,n){super(void 0,e[0].width,e[0].height,i,n,eA),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class ho extends i9{constructor(e,i,n,r,s,a,o,l,h){super(e,i,n,r,s,a,o,l,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class hl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){let n=this.getUtoTmapping(e);return this.getPoint(n,i)}getPoints(e=5){let i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return i}getSpacedPoints(e=5){let i=[];for(let n=0;n<=e;n++)i.push(this.getPointAt(n/e));return i}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let i=[],n,r=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=e;a++)i.push(s+=(n=this.getPoint(a/e)).distanceTo(r)),r=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){let n;let r=this.getLengths(),s=0,a=r.length;n=i||e*r[a-1];let o=0,l=a-1,h;for(;o<=l;)if((h=r[s=Math.floor(o+(l-o)/2)]-n)<0)o=s+1;else if(h>0)l=s-1;else{l=s;break}if(r[s=l]===n)return s/(a-1);let u=r[s],c=r[s+1];return(s+(n-u)/(c-u))/(a-1)}getTangent(e,i){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);let s=this.getPoint(n),a=this.getPoint(r),o=i||(s.isVector2?new iG:new nl);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,i){let n=this.getUtoTmapping(e);return this.getTangent(n,i)}computeFrenetFrames(e,i){let n=new nl,r=[],s=[],a=[],o=new nl,l=new nk;for(let i=0;i<=e;i++){let n=i/e;r[i]=this.getTangentAt(n,new nl)}s[0]=new nl,a[0]=new nl;let h=Number.MAX_VALUE,u=Math.abs(r[0].x),c=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=h&&(h=u,n.set(1,0,0)),c<=h&&(h=c,n.set(0,1,0)),d<=h&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],o),a[0].crossVectors(r[0],s[0]);for(let i=1;i<=e;i++){if(s[i]=s[i-1].clone(),a[i]=a[i-1].clone(),o.crossVectors(r[i-1],r[i]),o.length()>Number.EPSILON){o.normalize();let e=Math.acos(iN(r[i-1].dot(r[i]),-1,1));s[i].applyMatrix4(l.makeRotationAxis(o,e))}a[i].crossVectors(r[i],s[i])}if(!0===i){let i=Math.acos(iN(s[0].dot(s[e]),-1,1));i/=e,r[0].dot(o.crossVectors(s[0],s[e]))>0&&(i=-i);for(let n=1;n<=e;n++)s[n].applyMatrix4(l.makeRotationAxis(r[n],i*n)),a[n].crossVectors(r[n],s[n])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class hh extends hl{constructor(e=0,i=0,n=1,r=1,s=0,a=2*Math.PI,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,i=new iG){let n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);let a=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let e=Math.cos(this.aRotation),i=Math.sin(this.aRotation),n=o-this.aX,r=l-this.aY;o=n*e-r*i+this.aX,l=n*i+r*e+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class hu extends hh{constructor(e,i,n,r,s,a){super(e,i,n,n,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function hc(){let e=0,i=0,n=0,r=0;function s(s,a,o,l){e=s,i=o,n=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(e,i,n,r,a){s(i,n,a*(n-e),a*(r-i))},initNonuniformCatmullRom:function(e,i,n,r,a,o,l){let h=(i-e)/a-(n-e)/(a+o)+(n-i)/o,u=(n-i)/o-(r-i)/(o+l)+(r-n)/l;s(i,n,h*=o,u*=o)},calc:function(s){let a=s*s;return e+i*s+n*a+a*s*r}}}let hd=new nl,hp=new hc,hf=new hc,hm=new hc;class hg extends hl{constructor(e=[],i=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=n,this.tension=r}getPoint(e,i=new nl){let n,r;let s=this.points,a=s.length,o=(a-+!this.closed)*e,l=Math.floor(o),h=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a)+1)*a:0===h&&l===a-1&&(l=a-2,h=1),this.closed||l>0?n=s[(l-1)%a]:(hd.subVectors(s[0],s[1]).add(s[0]),n=hd);let u=s[l%a],c=s[(l+1)%a];if(this.closed||l+2<a?r=s[(l+2)%a]:(hd.subVectors(s[a-1],s[a-2]).add(s[a-1]),r=hd),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,i=Math.pow(n.distanceToSquared(u),e),s=Math.pow(u.distanceToSquared(c),e),a=Math.pow(c.distanceToSquared(r),e);s<1e-4&&(s=1),i<1e-4&&(i=s),a<1e-4&&(a=s),hp.initNonuniformCatmullRom(n.x,u.x,c.x,r.x,i,s,a),hf.initNonuniformCatmullRom(n.y,u.y,c.y,r.y,i,s,a),hm.initNonuniformCatmullRom(n.z,u.z,c.z,r.z,i,s,a)}else"catmullrom"===this.curveType&&(hp.initCatmullRom(n.x,u.x,c.x,r.x,this.tension),hf.initCatmullRom(n.y,u.y,c.y,r.y,this.tension),hm.initCatmullRom(n.z,u.z,c.z,r.z,this.tension));return i.set(hp.calc(h),hf.calc(h),hm.calc(h)),i}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){let n=this.points[i];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(new nl().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function hA(e,i,n,r,s){let a=(r-i)*.5,o=(s-n)*.5,l=e*e;return e*l*(2*n-2*r+a+o)+(-3*n+3*r-2*a-o)*l+a*e+n}function hv(e,i,n,r){return function(e,i){let n=1-e;return n*n*i}(e,i)+2*(1-e)*e*n+e*e*r}function hy(e,i,n,r,s){return function(e,i){let n=1-e;return n*n*n*i}(e,i)+function(e,i){let n=1-e;return 3*n*n*e*i}(e,n)+3*(1-e)*e*e*r+e*e*e*s}class hx extends hl{constructor(e=new iG,i=new iG,n=new iG,r=new iG){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=n,this.v3=r}getPoint(e,i=new iG){let n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(hy(e,n.x,r.x,s.x,a.x),hy(e,n.y,r.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class h_ extends hl{constructor(e=new nl,i=new nl,n=new nl,r=new nl){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=n,this.v3=r}getPoint(e,i=new nl){let n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(hy(e,n.x,r.x,s.x,a.x),hy(e,n.y,r.y,s.y,a.y),hy(e,n.z,r.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class hb extends hl{constructor(e=new iG,i=new iG){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new iG){return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new iG){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class hE extends hl{constructor(e=new nl,i=new nl){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new nl){return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new nl){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class hw extends hl{constructor(e=new iG,i=new iG,n=new iG){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new iG){let n=this.v0,r=this.v1,s=this.v2;return i.set(hv(e,n.x,r.x,s.x),hv(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class hM extends hl{constructor(e=new nl,i=new nl,n=new nl){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new nl){let n=this.v0,r=this.v1,s=this.v2;return i.set(hv(e,n.x,r.x,s.x),hv(e,n.y,r.y,s.y),hv(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class hC extends hl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new iG){let n=this.points,r=(n.length-1)*e,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],h=n[s>n.length-2?n.length-1:s+1],u=n[s>n.length-3?n.length-1:s+2];return i.set(hA(a,o.x,l.x,h.x,u.x),hA(a,o.y,l.y,h.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){let n=this.points[i];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(new iG().fromArray(n))}return this}}var hS=Object.freeze({__proto__:null,ArcCurve:hu,CatmullRomCurve3:hg,CubicBezierCurve:hx,CubicBezierCurve3:h_,EllipseCurve:hh,LineCurve:hb,LineCurve3:hE,QuadraticBezierCurve:hw,QuadraticBezierCurve3:hM,SplineCurve:hC});class hT extends hl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){let n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new hS[n](i,e))}return this}getPoint(e,i){let n=e*this.getLength(),r=this.getCurveLengths(),s=0;for(;s<r.length;){if(r[s]>=n){let e=r[s]-n,a=this.curves[s],o=a.getLength(),l=0===o?0:1-e/o;return a.getPointAt(l,i)}s++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],i=0;for(let n=0,r=this.curves.length;n<r;n++)e.push(i+=this.curves[n].getLength());return this.cacheLengths=e,e}getSpacedPoints(e=40){let i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){let i;let n=[];for(let r=0,s=this.curves;r<s.length;r++){let a=s[r],o=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let e=0;e<l.length;e++){let r=l[e];i&&i.equals(r)||(n.push(r),i=r)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let i=0,n=e.curves.length;i<n;i++){let n=e.curves[i];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,n=this.curves.length;i<n;i++){let n=this.curves[i];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,n=e.curves.length;i<n;i++){let n=e.curves[i];this.curves.push(new hS[n.type]().fromJSON(n))}return this}}class hR extends hT{constructor(e){super(),this.type="Path",this.currentPoint=new iG,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,n=e.length;i<n;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){let n=new hb(this.currentPoint.clone(),new iG(e,i));return this.curves.push(n),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,n,r){let s=new hw(this.currentPoint.clone(),new iG(e,i),new iG(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,i,n,r,s,a){let o=new hx(this.currentPoint.clone(),new iG(e,i),new iG(n,r),new iG(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){let i=new hC([this.currentPoint.clone()].concat(e));return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,n,r,s,a){let o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,i+l,n,r,s,a),this}absarc(e,i,n,r,s,a){return this.absellipse(e,i,n,n,r,s,a),this}ellipse(e,i,n,r,s,a,o,l){let h=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+h,i+u,n,r,s,a,o,l),this}absellipse(e,i,n,r,s,a,o,l){let h=new hh(e,i,n,r,s,a,o,l);if(this.curves.length>0){let e=h.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(h);let u=h.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class hI extends rQ{constructor(e=[new iG(0,-.5),new iG(.5,0),new iG(0,.5)],i=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:n,phiLength:r},i=Math.floor(i),r=iN(r,0,2*Math.PI);let s=[],a=[],o=[],l=[],h=[],u=1/i,c=new nl,d=new iG,p=new nl,f=new nl,m=new nl,g=0,A=0;for(let i=0;i<=e.length-1;i++)switch(i){case 0:g=e[i+1].x-e[i].x,A=e[i+1].y-e[i].y,p.x=+A,p.y=-g,p.z=0*A,m.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(m.x,m.y,m.z);break;default:g=e[i+1].x-e[i].x,A=e[i+1].y-e[i].y,p.x=+A,p.y=-g,p.z=0*A,f.copy(p),p.x+=m.x,p.y+=m.y,p.z+=m.z,p.normalize(),l.push(p.x,p.y,p.z),m.copy(f)}for(let s=0;s<=i;s++){let p=n+s*u*r,f=Math.sin(p),m=Math.cos(p);for(let n=0;n<=e.length-1;n++){c.x=e[n].x*f,c.y=e[n].y,c.z=e[n].x*m,a.push(c.x,c.y,c.z),d.x=s/i,d.y=n/(e.length-1),o.push(d.x,d.y);let r=l[3*n+0]*f,u=l[3*n+1],p=l[3*n+0]*m;h.push(r,u,p)}}for(let n=0;n<i;n++)for(let i=0;i<e.length-1;i++){let r=i+n*e.length,a=r+e.length,o=r+e.length+1,l=r+1;s.push(r,a,l),s.push(o,l,a)}this.setIndex(s),this.setAttribute("position",new rU(a,3)),this.setAttribute("uv",new rU(o,2)),this.setAttribute("normal",new rU(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hI(e.points,e.segments,e.phiStart,e.phiLength)}}class hB extends hI{constructor(e=1,i=1,n=4,r=8){let s=new hR;s.absarc(0,-i/2,e,1.5*Math.PI,0),s.absarc(0,i/2,e,0,.5*Math.PI),super(s.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:n,radialSegments:r}}static fromJSON(e){return new hB(e.radius,e.length,e.capSegments,e.radialSegments)}}class hL extends rQ{constructor(e=1,i=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:n,thetaLength:r},i=Math.max(3,i);let s=[],a=[],o=[],l=[],h=new nl,u=new iG;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let s=0,c=3;s<=i;s++,c+=3){let d=n+s/i*r;h.x=e*Math.cos(d),h.y=e*Math.sin(d),a.push(h.x,h.y,h.z),o.push(0,0,1),u.x=(a[c]/e+1)/2,u.y=(a[c+1]/e+1)/2,l.push(u.x,u.y)}for(let e=1;e<=i;e++)s.push(e,e+1,0);this.setIndex(s),this.setAttribute("position",new rU(a,3)),this.setAttribute("normal",new rU(o,3)),this.setAttribute("uv",new rU(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hL(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class hP extends rQ{constructor(e=1,i=1,n=1,r=32,s=1,a=!1,o=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};let h=this;r=Math.floor(r),s=Math.floor(s);let u=[],c=[],d=[],p=[],f=0,m=[],g=n/2,A=0;function v(n){let s=f,a=new iG,m=new nl,v=0,y=!0===n?e:i,x=!0===n?1:-1;for(let e=1;e<=r;e++)c.push(0,g*x,0),d.push(0,x,0),p.push(.5,.5),f++;let _=f;for(let e=0;e<=r;e++){let i=e/r*l+o,n=Math.cos(i),s=Math.sin(i);m.x=y*s,m.y=g*x,m.z=y*n,c.push(m.x,m.y,m.z),d.push(0,x,0),a.x=.5*n+.5,a.y=.5*s*x+.5,p.push(a.x,a.y),f++}for(let e=0;e<r;e++){let i=s+e,r=_+e;!0===n?u.push(r,r+1,i):u.push(r+1,r,i),v+=3}h.addGroup(A,v,!0===n?1:2),A+=v}(function(){let a=new nl,v=new nl,y=0,x=(i-e)/n;for(let h=0;h<=s;h++){let u=[],A=h/s,y=A*(i-e)+e;for(let e=0;e<=r;e++){let i=e/r,s=i*l+o,h=Math.sin(s),m=Math.cos(s);v.x=y*h,v.y=-A*n+g,v.z=y*m,c.push(v.x,v.y,v.z),a.set(h,x,m).normalize(),d.push(a.x,a.y,a.z),p.push(i,1-A),u.push(f++)}m.push(u)}for(let e=0;e<r;e++)for(let i=0;i<s;i++){let n=m[i][e],r=m[i+1][e],s=m[i+1][e+1],a=m[i][e+1];u.push(n,r,a),u.push(r,s,a),y+=6}h.addGroup(A,y,0),A+=y})(),!1===a&&(e>0&&v(!0),i>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new rU(c,3)),this.setAttribute("normal",new rU(d,3)),this.setAttribute("uv",new rU(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hP(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class hD extends hP{constructor(e=1,i=1,n=32,r=1,s=!1,a=0,o=2*Math.PI){super(0,e,i,n,r,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new hD(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class hN extends rQ{constructor(e=[],i=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:n,detail:r};let s=[],a=[];function o(e){s.push(e.x,e.y,e.z)}function l(i,n){let r=3*i;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function h(e,i,n,r){r<0&&1===e.x&&(a[i]=e.x-1),0===n.x&&0===n.z&&(a[i]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}(function(e){let n=new nl,r=new nl,s=new nl;for(let a=0;a<i.length;a+=3)l(i[a+0],n),l(i[a+1],r),l(i[a+2],s),function(e,i,n,r){let s=r+1,a=[];for(let r=0;r<=s;r++){a[r]=[];let o=e.clone().lerp(n,r/s),l=i.clone().lerp(n,r/s),h=s-r;for(let e=0;e<=h;e++)0===e&&r===s?a[r][e]=o:a[r][e]=o.clone().lerp(l,e/h)}for(let e=0;e<s;e++)for(let i=0;i<2*(s-e)-1;i++){let n=Math.floor(i/2);i%2==0?(o(a[e][n+1]),o(a[e+1][n]),o(a[e][n])):(o(a[e][n+1]),o(a[e+1][n+1]),o(a[e+1][n]))}}(n,r,s,e)})(r),function(e){let i=new nl;for(let n=0;n<s.length;n+=3)i.x=s[n+0],i.y=s[n+1],i.z=s[n+2],i.normalize().multiplyScalar(e),s[n+0]=i.x,s[n+1]=i.y,s[n+2]=i.z}(n),function(){let e=new nl;for(let n=0;n<s.length;n+=3){var i;e.x=s[n+0],e.y=s[n+1],e.z=s[n+2];let r=u(e)/2/Math.PI+.5,o=Math.atan2(-(i=e).y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5;a.push(r,1-o)}(function(){let e=new nl,i=new nl,n=new nl,r=new nl,o=new iG,l=new iG,c=new iG;for(let d=0,p=0;d<s.length;d+=9,p+=6){e.set(s[d+0],s[d+1],s[d+2]),i.set(s[d+3],s[d+4],s[d+5]),n.set(s[d+6],s[d+7],s[d+8]),o.set(a[p+0],a[p+1]),l.set(a[p+2],a[p+3]),c.set(a[p+4],a[p+5]),r.copy(e).add(i).add(n).divideScalar(3);let f=u(r);h(o,p+0,e,f),h(l,p+2,i,f),h(c,p+4,n,f)}})(),function(){for(let e=0;e<a.length;e+=6){let i=a[e+0],n=a[e+2],r=a[e+4],s=Math.max(i,n,r),o=Math.min(i,n,r);s>.9&&o<.1&&(i<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new rU(s,3)),this.setAttribute("normal",new rU(s.slice(),3)),this.setAttribute("uv",new rU(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hN(e.vertices,e.indices,e.radius,e.details)}}class hO extends hN{constructor(e=1,i=0){let n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new hO(e.radius,e.detail)}}let hU=new nl,hk=new nl,hF=new nl,hz=new rd;class hG extends rQ{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},null!==e){let n=Math.cos(iL*i),r=e.getIndex(),s=e.getAttribute("position"),a=r?r.count:s.count,o=[0,0,0],l=["a","b","c"],h=[,,,],u={},c=[];for(let e=0;e<a;e+=3){r?(o[0]=r.getX(e),o[1]=r.getX(e+1),o[2]=r.getX(e+2)):(o[0]=e,o[1]=e+1,o[2]=e+2);let{a:i,b:a,c:d}=hz;if(i.fromBufferAttribute(s,o[0]),a.fromBufferAttribute(s,o[1]),d.fromBufferAttribute(s,o[2]),hz.getNormal(hF),h[0]=`${Math.round(1e4*i.x)},${Math.round(1e4*i.y)},${Math.round(1e4*i.z)}`,h[1]=`${Math.round(1e4*a.x)},${Math.round(1e4*a.y)},${Math.round(1e4*a.z)}`,h[2]=`${Math.round(1e4*d.x)},${Math.round(1e4*d.y)},${Math.round(1e4*d.z)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){let i=(e+1)%3,r=h[e],s=h[i],a=hz[l[e]],d=hz[l[i]],p=`${r}_${s}`,f=`${s}_${r}`;f in u&&u[f]?(hF.dot(u[f].normal)<=n&&(c.push(a.x,a.y,a.z),c.push(d.x,d.y,d.z)),u[f]=null):p in u||(u[p]={index0:o[e],index1:o[i],normal:hF.clone()})}}for(let e in u)if(u[e]){let{index0:i,index1:n}=u[e];hU.fromBufferAttribute(s,i),hk.fromBufferAttribute(s,n),c.push(hU.x,hU.y,hU.z),c.push(hk.x,hk.y,hk.z)}this.setAttribute("position",new rU(c,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class hV extends hR{constructor(e){super(e),this.uuid=iD(),this.type="Shape",this.holes=[]}getPointsHoles(e){let i=[];for(let n=0,r=this.holes.length;n<r;n++)i[n]=this.holes[n].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,n=e.holes.length;i<n;i++){let n=e.holes[i];this.holes.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,n=this.holes.length;i<n;i++){let n=this.holes[i];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,n=e.holes.length;i<n;i++){let n=e.holes[i];this.holes.push(new hR().fromJSON(n))}return this}}let hj=function(e,i,n=2){let r,s,a,o,l,h,u;let c=i&&i.length,d=c?i[0]*n:e.length,p=hH(e,0,d,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(e,i,n,r){let s,a,o,l,h;let u=[];for(s=0,a=i.length;s<a;s++)o=i[s]*r,l=s<a-1?i[s+1]*r:e.length,(h=hH(e,o,l,r,!1))===h.next&&(h.steiner=!0),u.push(function(e){let i=e,n=e;do(i.x<n.x||i.x===n.x&&i.y<n.y)&&(n=i),i=i.next;while(i!==e);return n}(h));for(u.sort(hW),s=0;s<u.length;s++)n=function(e,i){let n=function(e,i){let n=i,r=-1/0,s,a=e.x,o=e.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){let e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=a&&e>r&&(r=e,s=n.x<n.next.x?n:n.next,e===a))return s}n=n.next}while(n!==i);if(!s)return null;let l=s,h=s.x,u=s.y,c=1/0,d;n=s;do{var p,f;a>=n.x&&n.x>=h&&a!==n.x&&hX(o<u?a:r,o,h,u,o<u?r:a,o,n.x,n.y)&&(d=Math.abs(o-n.y)/(a-n.x),h0(n,e)&&(d<c||d===c&&(n.x>s.x||n.x===s.x&&(p=s,f=n,0>hK(p.prev,p,f.prev)&&0>hK(f.next,p,p.next))))&&(s=n,c=d)),n=n.next}while(n!==l);return s}(e,i);if(!n)return i;let r=h1(n,e);return hQ(r,r.next),hQ(n,n.next)}(u[s],n);return n}(e,i,p,n)),e.length>80*n){r=a=e[0],s=o=e[1];for(let i=n;i<d;i+=n)l=e[i],h=e[i+1],l<r&&(r=l),h<s&&(s=h),l>a&&(a=l),h>o&&(o=h);u=0!==(u=Math.max(a-r,o-s))?32767/u:0}return function e(i,n,r,s,a,o,l){if(!i)return;!l&&o&&function(e,i,n,r){let s=e;do 0===s.z&&(s.z=hq(s.x,s.y,i,n,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let i,n,r,s,a,o,l,h,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,l=0,i=0;i<u&&(l++,r=r.nextZ);i++);for(h=u;l>0||h>0&&r;)0!==l&&(0===h||!r||n.z<=r.z)?(s=n,n=n.nextZ,l--):(s=r,r=r.nextZ,h--),a?a.nextZ=s:e=s,s.prevZ=a,a=s;n=r}a.nextZ=null,u*=2}while(o>1)}(s)}(i,s,a,o);let h=i,u,c;for(;i.prev!==i.next;){if(u=i.prev,c=i.next,o?function(e,i,n,r){let s=e.prev,a=e.next;if(hK(s,e,a)>=0)return!1;let o=s.x,l=e.x,h=a.x,u=s.y,c=e.y,d=a.y,p=o<l?o<h?o:h:l<h?l:h,f=u<c?u<d?u:d:c<d?c:d,m=o>l?o>h?o:h:l>h?l:h,g=u>c?u>d?u:d:c>d?c:d,A=hq(p,f,i,n,r),v=hq(m,g,i,n,r),y=e.prevZ,x=e.nextZ;for(;y&&y.z>=A&&x&&x.z<=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==s&&y!==a&&hX(o,u,l,c,h,d,y.x,y.y)&&hK(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==a&&hX(o,u,l,c,h,d,x.x,x.y)&&hK(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=A;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==s&&y!==a&&hX(o,u,l,c,h,d,y.x,y.y)&&hK(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==a&&hX(o,u,l,c,h,d,x.x,x.y)&&hK(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}(i,s,a,o):function(e){let i=e.prev,n=e.next;if(hK(i,e,n)>=0)return!1;let r=i.x,s=e.x,a=n.x,o=i.y,l=e.y,h=n.y,u=r<s?r<a?r:a:s<a?s:a,c=o<l?o<h?o:h:l<h?l:h,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>h?o:h:l>h?l:h,f=n.next;for(;f!==i;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&hX(r,o,s,l,a,h,f.x,f.y)&&hK(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}(i)){n.push(u.i/r|0),n.push(i.i/r|0),n.push(c.i/r|0),h3(i),i=c.next,h=c.next;continue}if((i=c)===h){l?1===l?e(i=function(e,i,n){let r=e;do{let s=r.prev,a=r.next.next;!hY(s,a)&&hJ(s,r,r.next,a)&&h0(s,a)&&h0(a,s)&&(i.push(s.i/n|0),i.push(r.i/n|0),i.push(a.i/n|0),h3(r),h3(r.next),r=e=a),r=r.next}while(r!==e);return hQ(r)}(hQ(i),n,r),n,r,s,a,o,2):2===l&&function(i,n,r,s,a,o){let l=i;do{let i=l.next.next;for(;i!==l.prev;){var h,u;if(l.i!==i.i&&(h=l,u=i,h.next.i!==u.i&&h.prev.i!==u.i&&!function(e,i){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==i.i&&n.next.i!==i.i&&hJ(n,n.next,e,i))return!0;n=n.next}while(n!==e);return!1}(h,u)&&(h0(h,u)&&h0(u,h)&&function(e,i){let n=e,r=!1,s=(e.x+i.x)/2,a=(e.y+i.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&s<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}(h,u)&&(hK(h.prev,h,u.prev)||hK(h,u.prev,u))||hY(h,u)&&hK(h.prev,h,h.next)>0&&hK(u.prev,u,u.next)>0))){let h=h1(l,i);l=hQ(l,l.next),h=hQ(h,h.next),e(l,n,r,s,a,o,0),e(h,n,r,s,a,o,0);return}i=i.next}l=l.next}while(l!==i)}(i,n,r,s,a,o):e(hQ(i),n,r,s,a,o,1);break}}}(p,f,n,r,s,u,0),f};function hH(e,i,n,r,s){let a,o;if(s===function(e,i,n,r){let s=0;for(let a=i,o=n-r;a<n;a+=r)s+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return s}(e,i,n,r)>0)for(a=i;a<n;a+=r)o=h2(a,e[a],e[a+1],o);else for(a=n-r;a>=i;a-=r)o=h2(a,e[a],e[a+1],o);return o&&hY(o,o.next)&&(h3(o),o=o.next),o}function hQ(e,i){if(!e)return e;i||(i=e);let n=e,r;do if(r=!1,!n.steiner&&(hY(n,n.next)||0===hK(n.prev,n,n.next))){if(h3(n),(n=i=n.prev)===n.next)break;r=!0}else n=n.next;while(r||n!==i);return i}function hW(e,i){return e.x-i.x}function hq(e,i,n,r,s){return(e=((e=((e=((e=((e=(e-n)*s|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(i=((i=((i=((i=((i=(i-r)*s|0)|i<<8)&0xff00ff)|i<<4)&0xf0f0f0f)|i<<2)&0x33333333)|i<<1)&0x55555555)<<1}function hX(e,i,n,r,s,a,o,l){return(s-o)*(i-l)>=(e-o)*(a-l)&&(e-o)*(r-l)>=(n-o)*(i-l)&&(n-o)*(a-l)>=(s-o)*(r-l)}function hK(e,i,n){return(i.y-e.y)*(n.x-i.x)-(i.x-e.x)*(n.y-i.y)}function hY(e,i){return e.x===i.x&&e.y===i.y}function hJ(e,i,n,r){let s=h$(hK(e,i,n)),a=h$(hK(e,i,r)),o=h$(hK(n,r,e)),l=h$(hK(n,r,i));return!!(s!==a&&o!==l||0===s&&hZ(e,n,i)||0===a&&hZ(e,r,i)||0===o&&hZ(n,e,r)||0===l&&hZ(n,i,r))}function hZ(e,i,n){return i.x<=Math.max(e.x,n.x)&&i.x>=Math.min(e.x,n.x)&&i.y<=Math.max(e.y,n.y)&&i.y>=Math.min(e.y,n.y)}function h$(e){return e>0?1:e<0?-1:0}function h0(e,i){return 0>hK(e.prev,e,e.next)?hK(e,i,e.next)>=0&&hK(e,e.prev,i)>=0:0>hK(e,i,e.prev)||0>hK(e,e.next,i)}function h1(e,i){let n=new h4(e.i,e.x,e.y),r=new h4(i.i,i.x,i.y),s=e.next,a=i.prev;return e.next=i,i.prev=e,n.next=s,s.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function h2(e,i,n,r){let s=new h4(e,i,n);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function h3(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function h4(e,i,n){this.i=e,this.x=i,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class h5{static area(e){let i=e.length,n=0;for(let r=i-1,s=0;s<i;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return .5*n}static isClockWise(e){return 0>h5.area(e)}static triangulateShape(e,i){let n=[],r=[],s=[];h6(e),h8(n,e);let a=e.length;i.forEach(h6);for(let e=0;e<i.length;e++)r.push(a),a+=i[e].length,h8(n,i[e]);let o=hj(n,r);for(let e=0;e<o.length;e+=3)s.push(o.slice(e,e+3));return s}}function h6(e){let i=e.length;i>2&&e[i-1].equals(e[0])&&e.pop()}function h8(e,i){for(let n=0;n<i.length;n++)e.push(i[n].x),e.push(i[n].y)}class h7 extends rQ{constructor(e=new hV([new iG(.5,.5),new iG(-.5,.5),new iG(-.5,-.5),new iG(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];let n=this,r=[],s=[];for(let a=0,o=e.length;a<o;a++)(function(e){let a,o,l,h;let u=[],c=void 0!==i.curveSegments?i.curveSegments:12,d=void 0!==i.steps?i.steps:1,p=void 0!==i.depth?i.depth:1,f=void 0===i.bevelEnabled||i.bevelEnabled,m=void 0!==i.bevelThickness?i.bevelThickness:.2,g=void 0!==i.bevelSize?i.bevelSize:m-.1,A=void 0!==i.bevelOffset?i.bevelOffset:0,v=void 0!==i.bevelSegments?i.bevelSegments:3,y=i.extrudePath,x=void 0!==i.UVGenerator?i.UVGenerator:h9,_,b=!1;y&&(_=y.getSpacedPoints(d),b=!0,f=!1,a=y.computeFrenetFrames(d,!1),o=new nl,l=new nl,h=new nl),f||(v=0,m=0,g=0,A=0);let E=e.extractPoints(c),w=E.shape,M=E.holes;if(!h5.isClockWise(w)){w=w.reverse();for(let e=0,i=M.length;e<i;e++){let i=M[e];h5.isClockWise(i)&&(M[e]=i.reverse())}}let C=h5.triangulateShape(w,M),S=w;for(let e=0,i=M.length;e<i;e++){let i=M[e];w=w.concat(i)}function T(e,i,n){return i||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(i,n)}let R=w.length,I=C.length;function B(e,i,n){let r,s,a;let o=e.x-i.x,l=e.y-i.y,h=n.x-e.x,u=n.y-e.y,c=o*o+l*l;if(Math.abs(o*u-l*h)>Number.EPSILON){let d=Math.sqrt(c),p=Math.sqrt(h*h+u*u),f=i.x-l/d,m=i.y+o/d,g=((n.x-u/p-f)*u-(n.y+h/p-m)*h)/(o*u-l*h),A=(r=f+o*g-e.x)*r+(s=m+l*g-e.y)*s;if(A<=2)return new iG(r,s);a=Math.sqrt(A/2)}else{let e=!1;o>Number.EPSILON?h>Number.EPSILON&&(e=!0):o<-Number.EPSILON?h<-Number.EPSILON&&(e=!0):Math.sign(l)===Math.sign(u)&&(e=!0),e?(r=-l,s=o,a=Math.sqrt(c)):(r=o,s=l,a=Math.sqrt(c/2))}return new iG(r/a,s/a)}let L=[];for(let e=0,i=S.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),L[e]=B(S[e],S[n],S[r]);let P=[],D,N=L.concat();for(let e=0,i=M.length;e<i;e++){let i=M[e];D=[];for(let e=0,n=i.length,r=n-1,s=e+1;e<n;e++,r++,s++)r===n&&(r=0),s===n&&(s=0),D[e]=B(i[e],i[r],i[s]);P.push(D),N=N.concat(D)}for(let e=0;e<v;e++){let i=e/v,n=m*Math.cos(i*Math.PI/2),r=g*Math.sin(i*Math.PI/2)+A;for(let e=0,i=S.length;e<i;e++){let i=T(S[e],L[e],r);k(i.x,i.y,-n)}for(let e=0,i=M.length;e<i;e++){let i=M[e];D=P[e];for(let e=0,s=i.length;e<s;e++){let s=T(i[e],D[e],r);k(s.x,s.y,-n)}}}let O=g+A;for(let e=0;e<R;e++){let i=f?T(w[e],N[e],O):w[e];b?(l.copy(a.normals[0]).multiplyScalar(i.x),o.copy(a.binormals[0]).multiplyScalar(i.y),h.copy(_[0]).add(l).add(o),k(h.x,h.y,h.z)):k(i.x,i.y,0)}for(let e=1;e<=d;e++)for(let i=0;i<R;i++){let n=f?T(w[i],N[i],O):w[i];b?(l.copy(a.normals[e]).multiplyScalar(n.x),o.copy(a.binormals[e]).multiplyScalar(n.y),h.copy(_[e]).add(l).add(o),k(h.x,h.y,h.z)):k(n.x,n.y,p/d*e)}for(let e=v-1;e>=0;e--){let i=e/v,n=m*Math.cos(i*Math.PI/2),r=g*Math.sin(i*Math.PI/2)+A;for(let e=0,i=S.length;e<i;e++){let i=T(S[e],L[e],r);k(i.x,i.y,p+n)}for(let e=0,i=M.length;e<i;e++){let i=M[e];D=P[e];for(let e=0,s=i.length;e<s;e++){let s=T(i[e],D[e],r);b?k(s.x,s.y+_[d-1].y,_[d-1].x+n):k(s.x,s.y,p+n)}}}function U(e,i){let s=e.length;for(;--s>=0;){let a=s,o=s-1;o<0&&(o=e.length-1);for(let e=0,s=d+2*v;e<s;e++){let s=R*e,l=R*(e+1);(function(e,i,s,a){z(e),z(i),z(a),z(i),z(s),z(a);let o=r.length/3,l=x.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);G(l[0]),G(l[1]),G(l[3]),G(l[1]),G(l[2]),G(l[3])})(i+a+s,i+o+s,i+o+l,i+a+l)}}}function k(e,i,n){u.push(e),u.push(i),u.push(n)}function F(e,i,s){z(e),z(i),z(s);let a=r.length/3,o=x.generateTopUV(n,r,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[2])}function z(e){r.push(u[3*e+0]),r.push(u[3*e+1]),r.push(u[3*e+2])}function G(e){s.push(e.x),s.push(e.y)}(function(){let e=r.length/3;if(f){let e=0,i=0*R;for(let e=0;e<I;e++){let n=C[e];F(n[2]+i,n[1]+i,n[0]+i)}i=R*(d+2*v);for(let e=0;e<I;e++){let n=C[e];F(n[0]+i,n[1]+i,n[2]+i)}}else{for(let e=0;e<I;e++){let i=C[e];F(i[2],i[1],i[0])}for(let e=0;e<I;e++){let i=C[e];F(i[0]+R*d,i[1]+R*d,i[2]+R*d)}}n.addGroup(e,r.length/3-e,0)})(),function(){let e=r.length/3,i=0;U(S,0),i+=S.length;for(let e=0,n=M.length;e<n;e++){let n=M[e];U(n,i),i+=n.length}n.addGroup(e,r.length/3-e,1)}()})(e[a]);this.setAttribute("position",new rU(r,3)),this.setAttribute("uv",new rU(s,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,i,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){let r=e[i];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},i),void 0!==i.extrudePath&&(n.options.extrudePath=i.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,i){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let s=i[e.shapes[r]];n.push(s)}let r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=new hS[r.type]().fromJSON(r)),new h7(n,e.options)}}let h9={generateTopUV:function(e,i,n,r,s){let a=i[3*n],o=i[3*n+1],l=i[3*r],h=i[3*r+1],u=i[3*s],c=i[3*s+1];return[new iG(a,o),new iG(l,h),new iG(u,c)]},generateSideWallUV:function(e,i,n,r,s,a){let o=i[3*n],l=i[3*n+1],h=i[3*n+2],u=i[3*r],c=i[3*r+1],d=i[3*r+2],p=i[3*s],f=i[3*s+1],m=i[3*s+2],g=i[3*a],A=i[3*a+1],v=i[3*a+2];return Math.abs(l-c)<Math.abs(o-u)?[new iG(o,1-h),new iG(u,1-d),new iG(p,1-m),new iG(g,1-v)]:[new iG(l,1-h),new iG(c,1-d),new iG(f,1-m),new iG(A,1-v)]}};class ue extends hN{constructor(e=1,i=0){let n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new ue(e.radius,e.detail)}}class ut extends hN{constructor(e=1,i=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new ut(e.radius,e.detail)}}class ui extends rQ{constructor(e=.5,i=1,n=32,r=1,s=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:a},n=Math.max(3,n);let o=[],l=[],h=[],u=[],c=e,d=(i-e)/(r=Math.max(1,r)),p=new nl,f=new iG;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){let r=s+e/n*a;p.x=c*Math.cos(r),p.y=c*Math.sin(r),l.push(p.x,p.y,p.z),h.push(0,0,1),f.x=(p.x/i+1)/2,f.y=(p.y/i+1)/2,u.push(f.x,f.y)}c+=d}for(let e=0;e<r;e++){let i=e*(n+1);for(let e=0;e<n;e++){let r=e+i,s=r+n+1,a=r+n+2,l=r+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new rU(l,3)),this.setAttribute("normal",new rU(h,3)),this.setAttribute("uv",new rU(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ui(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class un extends rQ{constructor(e=new hV([new iG(0,.5),new iG(-.5,-.5),new iG(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};let n=[],r=[],s=[],a=[],o=0,l=0;if(!1===Array.isArray(e))h(e);else for(let i=0;i<e.length;i++)h(e[i]),this.addGroup(o,l,i),o+=l,l=0;function h(e){let o=r.length/3,h=e.extractPoints(i),u=h.shape,c=h.holes;!1===h5.isClockWise(u)&&(u=u.reverse());for(let e=0,i=c.length;e<i;e++){let i=c[e];!0===h5.isClockWise(i)&&(c[e]=i.reverse())}let d=h5.triangulateShape(u,c);for(let e=0,i=c.length;e<i;e++){let i=c[e];u=u.concat(i)}for(let e=0,i=u.length;e<i;e++){let i=u[e];r.push(i.x,i.y,0),s.push(0,0,1),a.push(i.x,i.y)}for(let e=0,i=d.length;e<i;e++){let i=d[e],r=i[0]+o,s=i[1]+o,a=i[2]+o;n.push(r,s,a),l+=3}}this.setIndex(n),this.setAttribute("position",new rU(r,3)),this.setAttribute("normal",new rU(s,3)),this.setAttribute("uv",new rU(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,i){if(i.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){let r=e[n];i.shapes.push(r.uuid)}else i.shapes.push(e.uuid);return i}(this.parameters.shapes,e)}static fromJSON(e,i){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let s=i[e.shapes[r]];n.push(s)}return new un(n,e.curveSegments)}}class ur extends rQ{constructor(e=1,i=32,n=16,r=0,s=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:r,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));let l=Math.min(a+o,Math.PI),h=0,u=[],c=new nl,d=new nl,p=[],f=[],m=[],g=[];for(let p=0;p<=n;p++){let A=[],v=p/n,y=0;0===p&&0===a?y=.5/i:p===n&&l===Math.PI&&(y=-.5/i);for(let n=0;n<=i;n++){let l=n/i;c.x=-e*Math.cos(r+l*s)*Math.sin(a+v*o),c.y=e*Math.cos(a+v*o),c.z=e*Math.sin(r+l*s)*Math.sin(a+v*o),f.push(c.x,c.y,c.z),d.copy(c).normalize(),m.push(d.x,d.y,d.z),g.push(l+y,1-v),A.push(h++)}u.push(A)}for(let e=0;e<n;e++)for(let r=0;r<i;r++){let i=u[e][r+1],s=u[e][r],o=u[e+1][r],h=u[e+1][r+1];(0!==e||a>0)&&p.push(i,s,h),(e!==n-1||l<Math.PI)&&p.push(s,o,h)}this.setIndex(p),this.setAttribute("position",new rU(f,3)),this.setAttribute("normal",new rU(m,3)),this.setAttribute("uv",new rU(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ur(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class us extends hN{constructor(e=1,i=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new us(e.radius,e.detail)}}class ua extends rQ{constructor(e=1,i=.4,n=12,r=48,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);let a=[],o=[],l=[],h=[],u=new nl,c=new nl,d=new nl;for(let a=0;a<=n;a++)for(let p=0;p<=r;p++){let f=p/r*s,m=a/n*Math.PI*2;c.x=(e+i*Math.cos(m))*Math.cos(f),c.y=(e+i*Math.cos(m))*Math.sin(f),c.z=i*Math.sin(m),o.push(c.x,c.y,c.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),d.subVectors(c,u).normalize(),l.push(d.x,d.y,d.z),h.push(p/r),h.push(a/n)}for(let e=1;e<=n;e++)for(let i=1;i<=r;i++){let n=(r+1)*e+i-1,s=(r+1)*(e-1)+i-1,o=(r+1)*(e-1)+i,l=(r+1)*e+i;a.push(n,s,l),a.push(s,o,l)}this.setIndex(a),this.setAttribute("position",new rU(o,3)),this.setAttribute("normal",new rU(l,3)),this.setAttribute("uv",new rU(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ua(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class uo extends rQ{constructor(e=1,i=.4,n=64,r=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:n,radialSegments:r,p:s,q:a},n=Math.floor(n),r=Math.floor(r);let o=[],l=[],h=[],u=[],c=new nl,d=new nl,p=new nl,f=new nl,m=new nl,g=new nl,A=new nl;for(let o=0;o<=n;++o){let y=o/n*s*Math.PI*2;v(y,s,a,e,p),v(y+.01,s,a,e,f),g.subVectors(f,p),A.addVectors(f,p),m.crossVectors(g,A),A.crossVectors(m,g),m.normalize(),A.normalize();for(let e=0;e<=r;++e){let s=e/r*Math.PI*2,a=-i*Math.cos(s),f=i*Math.sin(s);c.x=p.x+(a*A.x+f*m.x),c.y=p.y+(a*A.y+f*m.y),c.z=p.z+(a*A.z+f*m.z),l.push(c.x,c.y,c.z),d.subVectors(c,p).normalize(),h.push(d.x,d.y,d.z),u.push(o/n),u.push(e/r)}}for(let e=1;e<=n;e++)for(let i=1;i<=r;i++){let n=(r+1)*(e-1)+(i-1),s=(r+1)*e+(i-1),a=(r+1)*e+i,l=(r+1)*(e-1)+i;o.push(n,s,l),o.push(s,a,l)}function v(e,i,n,r,s){let a=Math.cos(e),o=Math.sin(e),l=n/i*e,h=Math.cos(l);s.x=r*(2+h)*.5*a,s.y=r*(2+h)*o*.5,s.z=r*Math.sin(l)*.5}this.setIndex(o),this.setAttribute("position",new rU(l,3)),this.setAttribute("normal",new rU(h,3)),this.setAttribute("uv",new rU(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uo(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class ul extends rQ{constructor(e=new hM(new nl(-1,-1,0),new nl(-1,1,0),new nl(1,1,0)),i=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:n,radialSegments:r,closed:s};let a=e.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let o=new nl,l=new nl,h=new iG,u=new nl,c=[],d=[],p=[],f=[];function m(s){u=e.getPointAt(s/i,u);let h=a.normals[s],p=a.binormals[s];for(let e=0;e<=r;e++){let i=e/r*Math.PI*2,s=Math.sin(i),a=-Math.cos(i);l.x=a*h.x+s*p.x,l.y=a*h.y+s*p.y,l.z=a*h.z+s*p.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+n*l.x,o.y=u.y+n*l.y,o.z=u.z+n*l.z,c.push(o.x,o.y,o.z)}}(function(){for(let e=0;e<i;e++)m(e);m(!1===s?i:0),function(){for(let e=0;e<=i;e++)for(let n=0;n<=r;n++)h.x=e/i,h.y=n/r,p.push(h.x,h.y)}(),function(){for(let e=1;e<=i;e++)for(let i=1;i<=r;i++){let n=(r+1)*(e-1)+(i-1),s=(r+1)*e+(i-1),a=(r+1)*e+i,o=(r+1)*(e-1)+i;f.push(n,s,o),f.push(s,a,o)}}()})(),this.setIndex(f),this.setAttribute("position",new rU(c,3)),this.setAttribute("normal",new rU(d,3)),this.setAttribute("uv",new rU(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new ul(new hS[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class uh extends rQ{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){let i=[],n=new Set,r=new nl,s=new nl;if(null!==e.index){let a=e.attributes.position,o=e.index,l=e.groups;0===l.length&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,h=l.length;e<h;++e){let h=l[e],u=h.start,c=h.count;for(let e=u,l=u+c;e<l;e+=3)for(let l=0;l<3;l++){let h=o.getX(e+l),u=o.getX(e+(l+1)%3);r.fromBufferAttribute(a,h),s.fromBufferAttribute(a,u),!0===uu(r,s,n)&&(i.push(r.x,r.y,r.z),i.push(s.x,s.y,s.z))}}}else{let a=e.attributes.position;for(let e=0,o=a.count/3;e<o;e++)for(let o=0;o<3;o++){let l=3*e+o,h=3*e+(o+1)%3;r.fromBufferAttribute(a,l),s.fromBufferAttribute(a,h),!0===uu(r,s,n)&&(i.push(r.x,r.y,r.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new rU(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function uu(e,i,n){let r=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`,s=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(s)&&(n.add(r),n.add(s),!0)}var uc=Object.freeze({__proto__:null,BoxGeometry:st,CapsuleGeometry:hB,CircleGeometry:hL,ConeGeometry:hD,CylinderGeometry:hP,DodecahedronGeometry:hO,EdgesGeometry:hG,ExtrudeGeometry:h7,IcosahedronGeometry:ue,LatheGeometry:hI,OctahedronGeometry:ut,PlaneGeometry:sw,PolyhedronGeometry:hN,RingGeometry:ui,ShapeGeometry:un,SphereGeometry:ur,TetrahedronGeometry:us,TorusGeometry:ua,TorusKnotGeometry:uo,TubeGeometry:ul,WireframeGeometry:uh});class ud extends rx{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new rA(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class up extends sa{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class uf extends rx{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new rA(0xffffff),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rA(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tj,this.normalScale=new iG(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nX,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class um extends uf{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new iG(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return iN(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new rA(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new rA(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new rA(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class ug extends rx{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new rA(0xffffff),this.specular=new rA(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rA(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tj,this.normalScale=new iG(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nX,this.combine=en,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uA extends rx{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new rA(0xffffff),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rA(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tj,this.normalScale=new iG(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class uv extends rx{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tj,this.normalScale=new iG(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class uy extends rx{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new rA(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rA(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tj,this.normalScale=new iG(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nX,this.combine=en,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ux extends rx{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new rA(0xffffff),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tj,this.normalScale=new iG(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class u_ extends lQ{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function ub(e,i,n){return e&&(n||e.constructor!==i)?"number"==typeof i.BYTES_PER_ELEMENT?new i(e):Array.prototype.slice.call(e):e}function uE(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function uw(e){let i=e.length,n=Array(i);for(let e=0;e!==i;++e)n[e]=e;return n.sort(function(i,n){return e[i]-e[n]}),n}function uM(e,i,n){let r=e.length,s=new e.constructor(r);for(let a=0,o=0;o!==r;++a){let r=n[a]*i;for(let n=0;n!==i;++n)s[o++]=e[r+n]}return s}function uC(e,i,n,r){let s=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[s++];if(void 0===a)return;let o=a[r];if(void 0!==o){if(Array.isArray(o))do void 0!==(o=a[r])&&(i.push(a.time),n.push.apply(n,o)),a=e[s++];while(void 0!==a);else if(void 0!==o.toArray)do void 0!==(o=a[r])&&(i.push(a.time),o.toArray(n,n.length)),a=e[s++];while(void 0!==a);else do void 0!==(o=a[r])&&(i.push(a.time),n.push(o)),a=e[s++];while(void 0!==a)}}let uS={convertArray:ub,isTypedArray:uE,getKeyframeOrder:uw,sortedArray:uM,flattenJSON:uC,subclip:function(e,i,n,r,s=30){let a=e.clone();a.name=i;let o=[];for(let e=0;e<a.tracks.length;++e){let i=a.tracks[e],l=i.getValueSize(),h=[],u=[];for(let e=0;e<i.times.length;++e){let a=i.times[e]*s;if(!(a<n)&&!(a>=r)){h.push(i.times[e]);for(let n=0;n<l;++n)u.push(i.values[e*l+n])}}0!==h.length&&(i.times=ub(h,i.times.constructor),i.values=ub(u,i.values.constructor),o.push(i))}a.tracks=o;let l=1/0;for(let e=0;e<a.tracks.length;++e)l>a.tracks[e].times[0]&&(l=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*l);return a.resetDuration(),a},makeClipAdditive:function(e,i=0,n=e,r=30){r<=0&&(r=30);let s=n.tracks.length,a=i/r;for(let i=0;i<s;++i){let r;let s=n.tracks[i],o=s.ValueTypeName;if("bool"===o||"string"===o)continue;let l=e.tracks.find(function(e){return e.name===s.name&&e.ValueTypeName===o});if(void 0===l)continue;let h=0,u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let c=0,d=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=d/3);let p=s.times.length-1;if(a<=s.times[0]){let e=h,i=u-h;r=s.values.slice(e,i)}else if(a>=s.times[p]){let e=p*u+h,i=e+u-h;r=s.values.slice(e,i)}else{let e=s.createInterpolant(),i=h,n=u-h;e.evaluate(a),r=e.resultBuffer.slice(i,n)}"quaternion"===o&&new no().fromArray(r).normalize().conjugate().toArray(r);let f=l.times.length;for(let e=0;e<f;++e){let i=e*d+c;if("quaternion"===o)no.multiplyQuaternionsFlat(l.values,i,r,0,l.values,i);else{let e=d-2*c;for(let n=0;n<e;++n)l.values[i+n]-=r[n]}}}return e.blendMode=tU,e}};class uT{constructor(e,i,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new i.constructor(n),this.sampleValues=i,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let i=this.parameterPositions,n=this._cachedIndex,r=i[n],s=i[n-1];e:{t:{let a;i:{n:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<s)break n;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,e<(r=i[++n]))break t}a=i.length;break i}if(!(e>=s)){let o=i[1];e<o&&(n=2,s=o);for(let a=n-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=s,e>=(s=i[--n-1]))break t}a=n,n=0;break i}break e}for(;n<a;){let r=n+a>>>1;e<i[r]?a=r:n=r+1}if(r=i[n],void 0===(s=i[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let e=0;e!==r;++e)i[e]=n[s+e];return i}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}class uR extends uT{constructor(e,i,n,r){super(e,i,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:tP,endingEnd:tP}}intervalChanged_(e,i,n){let r=this.parameterPositions,s=e-2,a=e+1,o=r[s],l=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case tD:s=e,o=2*i-n;break;case tN:s=r.length-2,o=i+r[s]-r[s+1];break;default:s=e,o=n}if(void 0===l)switch(this.getSettings_().endingEnd){case tD:a=e,l=2*n-i;break;case tN:a=1,l=n+r[1]-r[0];break;default:a=e-1,l=i}let h=(n-i)*.5,u=this.valueSize;this._weightPrev=h/(i-o),this._weightNext=h/(l-n),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,u=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(n-i)/(r-i),m=f*f,g=m*f,A=-d*g+2*d*m-d*f,v=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*f+1,y=(-1-p)*g+(1.5+p)*m+.5*f,x=p*g-p*m;for(let e=0;e!==o;++e)s[e]=A*a[u+e]+v*a[h+e]+y*a[l+e]+x*a[c+e];return s}}class uI extends uT{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,u=(n-i)/(r-i),c=1-u;for(let e=0;e!==o;++e)s[e]=a[h+e]*c+a[l+e]*u;return s}}class uB extends uT{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class uL{constructor(e,i,n,r){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===i||0===i.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ub(i,this.TimeBufferType),this.values=ub(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let i;let n=e.constructor;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:ub(e.times,Array),values:ub(e.values,Array)};let n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new uB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new uI(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new uR(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case tI:i=this.InterpolantFactoryMethodDiscrete;break;case tB:i=this.InterpolantFactoryMethodLinear;break;case tL:i=this.InterpolantFactoryMethodSmooth}if(void 0===i){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(i)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return tI;case this.InterpolantFactoryMethodLinear:return tB;case this.InterpolantFactoryMethodSmooth:return tL}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]+=e}return this}scale(e){if(1!==e){let i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]*=e}return this}trim(e,i){let n=this.times,r=n.length,s=0,a=r-1;for(;s!==r&&n[s]<e;)++s;for(;-1!==a&&n[a]>i;)--a;if(++a,0!==s||a!==r){s>=a&&(s=(a=Math.max(a,1))-1);let e=this.getValueSize();this.times=n.slice(s,a),this.values=this.values.slice(s*e,a*e)}return this}validate(){let e=!0,i=this.getValueSize();i-Math.floor(i)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,r=this.values,s=n.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let i=0;i!==s;i++){let r=n[i];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,i,r),e=!1;break}if(null!==a&&a>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,i,r,a),e=!1;break}a=r}if(void 0!==r&&uE(r))for(let i=0,n=r.length;i!==n;++i){let n=r[i];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,i,n),e=!1;break}}return e}optimize(){let e=this.times.slice(),i=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===tL,s=e.length-1,a=1;for(let o=1;o<s;++o){let s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0])){if(r)s=!0;else{let e=o*n,r=e-n,a=e+n;for(let o=0;o!==n;++o){let n=i[e+o];if(n!==i[r+o]||n!==i[a+o]){s=!0;break}}}}if(s){if(o!==a){e[a]=e[o];let r=o*n,s=a*n;for(let e=0;e!==n;++e)i[s+e]=i[r+e]}++a}}if(s>0){e[a]=e[s];for(let e=s*n,r=a*n,o=0;o!==n;++o)i[r+o]=i[e+o];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*n)):(this.times=e,this.values=i),this}clone(){let e=this.times.slice(),i=this.values.slice(),n=new this.constructor(this.name,e,i);return n.createInterpolant=this.createInterpolant,n}}uL.prototype.TimeBufferType=Float32Array,uL.prototype.ValueBufferType=Float32Array,uL.prototype.DefaultInterpolation=tB;class uP extends uL{}uP.prototype.ValueTypeName="bool",uP.prototype.ValueBufferType=Array,uP.prototype.DefaultInterpolation=tI,uP.prototype.InterpolantFactoryMethodLinear=void 0,uP.prototype.InterpolantFactoryMethodSmooth=void 0;class uD extends uL{}uD.prototype.ValueTypeName="color";class uN extends uL{}uN.prototype.ValueTypeName="number";class uO extends uT{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(n-i)/(r-i),h=e*o;for(let e=h+o;h!==e;h+=4)no.slerpFlat(s,0,a,h-o,a,h,l);return s}}class uU extends uL{InterpolantFactoryMethodLinear(e){return new uO(this.times,this.values,this.getValueSize(),e)}}uU.prototype.ValueTypeName="quaternion",uU.prototype.DefaultInterpolation=tB,uU.prototype.InterpolantFactoryMethodSmooth=void 0;class uk extends uL{}uk.prototype.ValueTypeName="string",uk.prototype.ValueBufferType=Array,uk.prototype.DefaultInterpolation=tI,uk.prototype.InterpolantFactoryMethodLinear=void 0,uk.prototype.InterpolantFactoryMethodSmooth=void 0;class uF extends uL{}uF.prototype.ValueTypeName="vector";class uz{constructor(e="",i=-1,n=[],r=tO){this.name=e,this.tracks=n,this.duration=i,this.blendMode=r,this.uuid=iD(),this.duration<0&&this.resetDuration()}static parse(e){let i=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,s=n.length;e!==s;++e)i.push((function(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let i=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uN;case"vector":case"vector2":case"vector3":case"vector4":return uF;case"color":return uD;case"quaternion":return uU;case"bool":case"boolean":return uP;case"string":return uk}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let i=[],n=[];uC(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==i.parse?i.parse(e):new i(e.name,e.times,e.values,e.interpolation)})(n[e]).scale(r));let s=new this(e.name,e.duration,i,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){let i=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)i.push(uL.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,i,n,r){let s=i.length,a=[];for(let e=0;e<s;e++){let o=[],l=[];o.push((e+s-1)%s,e,(e+1)%s),l.push(0,1,0);let h=uw(o);o=uM(o,1,h),l=uM(l,1,h),r||0!==o[0]||(o.push(s),l.push(l[0])),a.push(new uN(".morphTargetInfluences["+i[e].name+"]",o,l).scale(1/n))}return new this(e,-1,a)}static findByName(e,i){let n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<n.length;e++)if(n[e].name===i)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,i,n){let r={},s=/^([\w-]*?)([\d]+)$/;for(let i=0,n=e.length;i<n;i++){let n=e[i],a=n.name.match(s);if(a&&a.length>1){let e=a[1],i=r[e];i||(r[e]=i=[]),i.push(n)}}let a=[];for(let e in r)a.push(this.CreateFromMorphTargetSequence(e,r[e],i,n));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(e,i,n,r,s){if(0!==n.length){let a=[],o=[];uC(n,a,o,r),0!==a.length&&s.push(new e(i,a,o))}},r=[],s=e.name||"default",a=e.fps||30,o=e.blendMode,l=e.length||-1,h=e.hierarchy||[];for(let e=0;e<h.length;e++){let s=h[e].keys;if(s&&0!==s.length){if(s[0].morphTargets){let e;let i={};for(e=0;e<s.length;e++)if(s[e].morphTargets)for(let n=0;n<s[e].morphTargets.length;n++)i[s[e].morphTargets[n]]=-1;for(let n in i){let i=[],a=[];for(let r=0;r!==s[e].morphTargets.length;++r){let r=s[e];i.push(r.time),a.push(+(r.morphTarget===n))}r.push(new uN(".morphTargetInfluence["+n+"]",i,a))}l=i.length*a}else{let a=".bones["+i[e].name+"]";n(uF,a+".position",s,"pos",r),n(uU,a+".quaternion",s,"rot",r),n(uF,a+".scale",s,"scl",r)}}}return 0===r.length?null:new this(s,l,r,o)}resetDuration(){let e=this.tracks,i=0;for(let n=0,r=e.length;n!==r;++n){let e=this.tracks[n];i=Math.max(i,e.times[e.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}let uG={enabled:!1,files:{},add:function(e,i){!1!==this.enabled&&(this.files[e]=i)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class uV{constructor(e,i,n){let r;let s=this,a=!1,o=0,l=0,h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=n,this.itemStart=function(e){l++,!1===a&&void 0!==s.onStart&&s.onStart(e,o,l),a=!0},this.itemEnd=function(e){o++,void 0!==s.onProgress&&s.onProgress(e,o,l),o===l&&(a=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(e){void 0!==s.onError&&s.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,i){return h.push(e,i),this},this.removeHandler=function(e){let i=h.indexOf(e);return -1!==i&&h.splice(i,2),this},this.getHandler=function(e){for(let i=0,n=h.length;i<n;i+=2){let n=h[i],r=h[i+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}let uj=new uV;class uH{constructor(e){this.manager=void 0!==e?e:uj,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){let n=this;return new Promise(function(r,s){n.load(e,r,i,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}uH.DEFAULT_MATERIAL_NAME="__DEFAULT";let uQ={};class uW extends Error{constructor(e,i){super(e),this.response=i}}class uq extends uH{constructor(e){super(e)}load(e,i,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let s=uG.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{i&&i(s),this.manager.itemEnd(e)},0),s;if(void 0!==uQ[e]){uQ[e].push({onLoad:i,onProgress:n,onError:r});return}uQ[e]=[],uQ[e].push({onLoad:i,onProgress:n,onError:r});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(i=>{if(200===i.status||0===i.status){if(0===i.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===i.body||void 0===i.body.getReader)return i;let n=uQ[e],r=i.body.getReader(),s=i.headers.get("X-File-Size")||i.headers.get("Content-Length"),a=s?parseInt(s):0,o=0!==a,l=0;return new Response(new ReadableStream({start(e){(function i(){r.read().then(({done:r,value:s})=>{if(r)e.close();else{let r=new ProgressEvent("progress",{lengthComputable:o,loaded:l+=s.byteLength,total:a});for(let e=0,i=n.length;e<i;e++){let i=n[e];i.onProgress&&i.onProgress(r)}e.enqueue(s),i()}})})()}}))}throw new uW(`fetch for "${i.url}" responded with ${i.status}: ${i.statusText}`,i)}).then(e=>{switch(l){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>new DOMParser().parseFromString(e,o));case"json":return e.json();default:if(void 0===o)return e.text();{let i=/charset="?([^;"\s]*)"?/i.exec(o),n=new TextDecoder(i&&i[1]?i[1].toLowerCase():void 0);return e.arrayBuffer().then(e=>n.decode(e))}}}).then(i=>{uG.add(e,i);let n=uQ[e];delete uQ[e];for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onLoad&&r.onLoad(i)}}).catch(i=>{let n=uQ[e];if(void 0===n)throw this.manager.itemError(e),i;delete uQ[e];for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onError&&r.onError(i)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class uX extends uH{constructor(e){super(e)}load(e,i,n,r){let s=this,a=new uq(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){try{i(s.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),s.manager.itemError(e)}},n,r)}parse(e){let i=[];for(let n=0;n<e.length;n++){let r=uz.parse(e[n]);i.push(r)}return i}}class uK extends uH{constructor(e){super(e)}load(e,i,n,r){let s=this,a=[],o=new hr,l=new uq(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let h=0;if(Array.isArray(e))for(let u=0,c=e.length;u<c;++u)!function(u){l.load(e[u],function(e){let n=s.parse(e,!0);a[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(h+=1)&&(1===n.mipmapCount&&(o.minFilter=eI),o.image=a,o.format=n.format,o.needsUpdate=!0,i&&i(o))},n,r)}(u);else l.load(e,function(e){let n=s.parse(e,!0);if(n.isCubemap){let e=n.mipmaps.length/n.mipmapCount;for(let i=0;i<e;i++){a[i]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)a[i].mipmaps.push(n.mipmaps[i*n.mipmapCount+e]),a[i].format=n.format,a[i].width=n.width,a[i].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=eI),o.format=n.format,o.needsUpdate=!0,i&&i(o)},n,r);return o}}class uY extends uH{constructor(e){super(e)}load(e,i,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,a=uG.get(e);if(void 0!==a)return s.manager.itemStart(e),setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a;let o=iq("img");function l(){u(),uG.add(e,this),i&&i(this),s.manager.itemEnd(e)}function h(i){u(),r&&r(i),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",h,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class uJ extends uH{constructor(e){super(e)}load(e,i,n,r){let s=new sp;s.colorSpace=tW;let a=new uY(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;for(let n=0;n<e.length;++n)!function(n){a.load(e[n],function(e){s.images[n]=e,6==++o&&(s.needsUpdate=!0,i&&i(s))},void 0,r)}(n);return s}}class uZ extends uH{constructor(e){super(e)}load(e,i,n,r){let s=this,a=new lA,o=new uq(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(e){let n;try{n=s.parse(e)}catch(e){if(void 0!==r)r(e);else{console.error(e);return}}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:eE,a.wrapT=void 0!==n.wrapT?n.wrapT:eE,a.magFilter=void 0!==n.magFilter?n.magFilter:eI,a.minFilter=void 0!==n.minFilter?n.minFilter:eI,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(a.colorSpace=n.colorSpace),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=eP),1===n.mipmapCount&&(a.minFilter=eI),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,i&&i(a,n)},n,r),a}}class u$ extends uH{constructor(e){super(e)}load(e,i,n,r){let s=new i9,a=new uY(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){s.image=e,s.needsUpdate=!0,void 0!==i&&i(s)},n,r),s}}class u0 extends rt{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new rA(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,void 0!==this.groundColor&&(i.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(i.object.distance=this.distance),void 0!==this.angle&&(i.object.angle=this.angle),void 0!==this.decay&&(i.object.decay=this.decay),void 0!==this.penumbra&&(i.object.penumbra=this.penumbra),void 0!==this.shadow&&(i.object.shadow=this.shadow.toJSON()),i}}class u1 extends u0{constructor(e,i,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(rt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new rA(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}let u2=new nk,u3=new nl,u4=new nl;class u5{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new iG(512,512),this.map=null,this.mapPass=null,this.matrix=new nk,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new s_,this._frameExtents=new iG(1,1),this._viewportCount=1,this._viewports=[new ne(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let i=this.camera,n=this.matrix;u3.setFromMatrixPosition(e.matrixWorld),i.position.copy(u3),u4.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(u4),i.updateMatrixWorld(),u2.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(u2),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(u2)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class u6 extends u5{constructor(){super(new sc(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let i=this.camera,n=2*iP*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||i.far;(n!==i.fov||r!==i.aspect||s!==i.far)&&(i.fov=n,i.aspect=r,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class u8 extends u0{constructor(e,i,n=0,r=Math.PI/3,s=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(rt.DEFAULT_UP),this.updateMatrix(),this.target=new rt,this.distance=n,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new u6}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let u7=new nk,u9=new nl,ce=new nl;class ct extends u5{constructor(){super(new sc(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new iG(4,2),this._viewportCount=6,this._viewports=[new ne(2,1,1,1),new ne(0,1,1,1),new ne(3,1,1,1),new ne(1,1,1,1),new ne(3,0,1,1),new ne(1,0,1,1)],this._cubeDirections=[new nl(1,0,0),new nl(-1,0,0),new nl(0,0,1),new nl(0,0,-1),new nl(0,1,0),new nl(0,-1,0)],this._cubeUps=[new nl(0,1,0),new nl(0,1,0),new nl(0,1,0),new nl(0,1,0),new nl(0,0,1),new nl(0,0,-1)]}updateMatrices(e,i=0){let n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),u9.setFromMatrixPosition(e.matrixWorld),n.position.copy(u9),ce.copy(n.position),ce.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(ce),n.updateMatrixWorld(),r.makeTranslation(-u9.x,-u9.y,-u9.z),u7.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(u7)}}class ci extends u0{constructor(e,i,n=0,r=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new ct}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class cn extends u5{constructor(){super(new sU(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class cr extends u0{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(rt.DEFAULT_UP),this.updateMatrix(),this.target=new rt,this.shadow=new cn}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class cs extends u0{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class ca extends u0{constructor(e,i,n=10,r=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class co{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new nl)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){let n=e.x,r=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*r),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*n),i.addScaledVector(a[4],n*r*1.092548),i.addScaledVector(a[5],r*s*1.092548),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],n*s*1.092548),i.addScaledVector(a[8],.546274*(n*n-r*r)),i}getIrradianceAt(e,i){let n=e.x,r=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],1.023328*r),i.addScaledVector(a[2],1.023328*s),i.addScaledVector(a[3],1.023328*n),i.addScaledVector(a[4],.858086*n*r),i.addScaledVector(a[5],.858086*r*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],.858086*n*s),i.addScaledVector(a[8],.429043*(n*n-r*r)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){let n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,i+3*r);return this}toArray(e=[],i=0){let n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,i+3*r);return e}static getBasisAt(e,i){let n=e.x,r=e.y,s=e.z;i[0]=.282095,i[1]=.488603*r,i[2]=.488603*s,i[3]=.488603*n,i[4]=1.092548*n*r,i[5]=1.092548*r*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*n*s,i[8]=.546274*(n*n-r*r)}}class cl extends u0{constructor(e=new co,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class ch extends uH{constructor(e){super(e),this.textures={}}load(e,i,n,r){let s=this,a=new uq(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(n){try{i(s.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),s.manager.itemError(e)}},n,r)}parse(e){let i=this.textures;function n(e){return void 0===i[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),i[e]}let r=ch.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=new rA().setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(r.dispersion=e.dispersion),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(let i in e.uniforms){let s=e.uniforms[i];switch(r.uniforms[i]={},s.type){case"t":r.uniforms[i].value=n(s.value);break;case"c":r.uniforms[i].value=new rA().setHex(s.value);break;case"v2":r.uniforms[i].value=new iG().fromArray(s.value);break;case"v3":r.uniforms[i].value=new nl().fromArray(s.value);break;case"v4":r.uniforms[i].value=new ne().fromArray(s.value);break;case"m3":r.uniforms[i].value=new iV().fromArray(s.value);break;case"m4":r.uniforms[i].value=new nk().fromArray(s.value);break;default:r.uniforms[i].value=s.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(let i in e.extensions)r.extensions[i]=e.extensions[i];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let i=e.normalScale;!1===Array.isArray(i)&&(i=[i,i]),r.normalScale=new iG().fromArray(i)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapRotation&&r.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=new iG().fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new({ShadowMaterial:ud,SpriteMaterial:oZ,RawShaderMaterial:up,ShaderMaterial:sa,PointsMaterial:l5,MeshPhysicalMaterial:um,MeshStandardMaterial:uf,MeshPhongMaterial:ug,MeshToonMaterial:uA,MeshNormalMaterial:uv,MeshLambertMaterial:uy,MeshDepthMaterial:oE,MeshDistanceMaterial:ow,MeshBasicMaterial:r_,MeshMatcapMaterial:ux,LineDashedMaterial:u_,LineBasicMaterial:lQ,Material:rx})[e]}}class cu{static decodeText(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let i="";for(let n=0,r=e.length;n<r;n++)i+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(i))}catch(e){return i}}static extractUrlBase(e){let i=e.lastIndexOf("/");return -1===i?"./":e.slice(0,i+1)}static resolveURL(e,i){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:i+e}}class cc extends rQ{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class cd extends uH{constructor(e){super(e)}load(e,i,n,r){let s=this,a=new uq(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(n){try{i(s.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),s.manager.itemError(e)}},n,r)}parse(e){let i={},n={};function r(e,r){if(void 0!==i[r])return i[r];let s=e.interleavedBuffers[r],a=function(e,i){if(void 0!==n[i])return n[i];let r=new Uint32Array(e.arrayBuffers[i]).buffer;return n[i]=r,r}(e,s.buffer),o=new oK(iW(s.type,a),s.stride);return o.uuid=s.uuid,i[r]=o,o}let s=e.isInstancedBufferGeometry?new cc:new rQ,a=e.data.index;if(void 0!==a){let e=iW(a.type,a.array);s.setIndex(new rT(e,1))}let o=e.data.attributes;for(let i in o){let n;let a=o[i];if(a.isInterleavedBufferAttribute)n=new oJ(r(e.data,a.data),a.itemSize,a.offset,a.normalized);else{let e=iW(a.type,a.array);n=new(a.isInstancedBufferAttribute?l_:rT)(e,a.itemSize,a.normalized)}void 0!==a.name&&(n.name=a.name),void 0!==a.usage&&n.setUsage(a.usage),s.setAttribute(i,n)}let l=e.data.morphAttributes;if(l)for(let i in l){let n=l[i],a=[];for(let i=0,s=n.length;i<s;i++){let s;let o=n[i];s=o.isInterleavedBufferAttribute?new oJ(r(e.data,o.data),o.itemSize,o.offset,o.normalized):new rT(iW(o.type,o.array),o.itemSize,o.normalized),void 0!==o.name&&(s.name=o.name),a.push(s)}s.morphAttributes[i]=a}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let h=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==h)for(let e=0,i=h.length;e!==i;++e){let i=h[e];s.addGroup(i.start,i.count,i.materialIndex)}let u=e.data.boundingSphere;if(void 0!==u){let e=new nl;void 0!==u.center&&e.fromArray(u.center),s.boundingSphere=new nR(e,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}class cp extends uH{constructor(e){super(e)}load(e,i,n,r){let s=this,a=""===this.path?cu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;let o=new uq(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){let a=null;try{a=JSON.parse(n)}catch(i){void 0!==r&&r(i),console.error("THREE:ObjectLoader: Can't parse "+e+".",i.message);return}let o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase()){void 0!==r&&r(Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(a,i)},n,r)}async loadAsync(e,i){let n=""===this.path?cu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;let r=new uq(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);let s=JSON.parse(await r.loadAsync(e,i)),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,i){let n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){void 0!==i&&i(h)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),h=this.parseObject(e.object,s,l,o,n),u=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,u),void 0!==i){let e=!1;for(let i in a)if(a[i].data instanceof HTMLImageElement){e=!0;break}!1===e&&i(h)}return h}async parseAsync(e){let i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,o,a,i),h=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,h),l}parseShapes(e){let i={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){let r=new hV().fromJSON(e[n]);i[r.uuid]=r}return i}parseSkeletons(e,i){let n={},r={};if(i.traverse(function(e){e.isBone&&(r[e.uuid]=e)}),void 0!==e)for(let i=0,s=e.length;i<s;i++){let s=new lx().fromJSON(e[i],r);n[s.uuid]=s}return n}parseGeometries(e,i){let n={};if(void 0!==e){let r=new cd;for(let s=0,a=e.length;s<a;s++){let a;let o=e[s];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(o);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?a=new THREE.LegacyJSONLoader().parse(o,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:o.type in uc?a=uc[o.type].fromJSON(o,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.userData&&(a.userData=o.userData),n[o.uuid]=a}}return n}parseMaterials(e,i){let n={},r={};if(void 0!==e){let s=new ch;s.setTextures(i);for(let i=0,a=e.length;i<a;i++){let a=e[i];void 0===n[a.uuid]&&(n[a.uuid]=s.parse(a)),r[a.uuid]=n[a.uuid]}}return r}parseAnimations(e){let i={};if(void 0!==e)for(let n=0;n<e.length;n++){let r=e[n],s=uz.parse(r);i[s.uuid]=s}return i}parseImages(e,i){let n;let r=this,s={};function a(e){if("string"==typeof e){var i;return i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e,r.manager.itemStart(i),n.load(i,function(){r.manager.itemEnd(i)},void 0,function(){r.manager.itemError(i),r.manager.itemEnd(i)})}return e.data?{data:iW(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(n=new uY(new uV(i))).setCrossOrigin(this.crossOrigin);for(let i=0,n=e.length;i<n;i++){let n=e[i],r=n.url;if(Array.isArray(r)){let e=[];for(let i=0,n=r.length;i<n;i++){let n=a(r[i]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new lA(n.data,n.width,n.height)))}s[n.uuid]=new i6(e)}else{let e=a(n.url);s[n.uuid]=new i6(e)}}}return s}async parseImagesAsync(e){let i;let n=this,r={};async function s(e){if("string"==typeof e){let r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;return await i.loadAsync(r)}return e.data?{data:iW(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(i=new uY(this.manager)).setCrossOrigin(this.crossOrigin);for(let i=0,n=e.length;i<n;i++){let n=e[i],a=n.url;if(Array.isArray(a)){let e=[];for(let i=0,n=a.length;i<n;i++){let n=a[i],r=await s(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new lA(r.data,r.width,r.height)))}r[n.uuid]=new i6(e)}else{let e=await s(n.url);r[n.uuid]=new i6(e)}}}return r}parseTextures(e,i){function n(e,i){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),i[e])}let r={};if(void 0!==e)for(let s=0,a=e.length;s<a;s++){let a;let o=e[s];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===i[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);let l=i[o.image],h=l.data;Array.isArray(h)?(a=new sp,6===h.length&&(a.needsUpdate=!0)):(a=h&&h.data?new lA:new i9,h&&(a.needsUpdate=!0)),a.source=l,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.mapping&&(a.mapping=n(o.mapping,cf)),void 0!==o.channel&&(a.channel=o.channel),void 0!==o.offset&&a.offset.fromArray(o.offset),void 0!==o.repeat&&a.repeat.fromArray(o.repeat),void 0!==o.center&&a.center.fromArray(o.center),void 0!==o.rotation&&(a.rotation=o.rotation),void 0!==o.wrap&&(a.wrapS=n(o.wrap[0],cm),a.wrapT=n(o.wrap[1],cm)),void 0!==o.format&&(a.format=o.format),void 0!==o.internalFormat&&(a.internalFormat=o.internalFormat),void 0!==o.type&&(a.type=o.type),void 0!==o.colorSpace&&(a.colorSpace=o.colorSpace),void 0!==o.minFilter&&(a.minFilter=n(o.minFilter,cg)),void 0!==o.magFilter&&(a.magFilter=n(o.magFilter,cg)),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),void 0!==o.flipY&&(a.flipY=o.flipY),void 0!==o.generateMipmaps&&(a.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(a.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(a.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(a.compareFunction=o.compareFunction),void 0!==o.userData&&(a.userData=o.userData),r[o.uuid]=a}return r}parseObject(e,i,n,r,s){let a,o,l;function h(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){let i=[];for(let r=0,s=e.length;r<s;r++){let s=e[r];void 0===n[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),i.push(n[s])}return i}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function c(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":a=new oX,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new rA(e.background):a.background=c(e.background)),void 0!==e.environment&&(a.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new oq(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new oW(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&a.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(a.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new sc(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new sU(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new cs(e.color,e.intensity);break;case"DirectionalLight":a=new cr(e.color,e.intensity);break;case"PointLight":a=new ci(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new ca(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new u8(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new u1(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new cl().fromJSON(e);break;case"SkinnedMesh":a=new lm(o=h(e.geometry),l=u(e.material)),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":a=new r9(o=h(e.geometry),l=u(e.material));break;case"InstancedMesh":o=h(e.geometry),l=u(e.material);let d=e.count,p=e.instanceMatrix,f=e.instanceColor;(a=new lR(o,l,d)).instanceMatrix=new l_(new Float32Array(p.array),16),void 0!==f&&(a.instanceColor=new l_(new Float32Array(f.array),f.itemSize));break;case"BatchedMesh":o=h(e.geometry),l=u(e.material),(a=new lH(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,l)).geometry=o,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(e=>{let i=new nc;i.min.fromArray(e.boxMin),i.max.fromArray(e.boxMax);let n=new nR;return n.radius=e.sphereRadius,n.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:i,sphereInitialized:e.sphereInitialized,sphere:n}}),a._maxGeometryCount=e.maxGeometryCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":a=new ls;break;case"Line":a=new l$(h(e.geometry),u(e.material));break;case"LineLoop":a=new l4(h(e.geometry),u(e.material));break;case"LineSegments":a=new l3(h(e.geometry),u(e.material));break;case"PointCloud":case"Points":a=new he(h(e.geometry),u(e.material));break;case"Sprite":a=new lt(u(e.material));break;case"Group":a=new oR;break;case"Bone":a=new lg;break;default:a=new rt}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){let o=e.children;for(let e=0;e<o.length;e++)a.add(this.parseObject(o[e],i,n,r,s))}if(void 0!==e.animations){let i=e.animations;for(let e=0;e<i.length;e++){let n=i[e];a.animations.push(s[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);let i=e.levels;for(let e=0;e<i.length;e++){let n=i[e],r=a.getObjectByProperty("uuid",n.object);void 0!==r&&a.addLevel(r,n.distance,n.hysteresis)}}return a}bindSkeletons(e,i){0!==Object.keys(i).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){let n=i[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}})}}let cf={UVMapping:eg,CubeReflectionMapping:eA,CubeRefractionMapping:ev,EquirectangularReflectionMapping:ey,EquirectangularRefractionMapping:ex,CubeUVReflectionMapping:e_},cm={RepeatWrapping:eb,ClampToEdgeWrapping:eE,MirroredRepeatWrapping:ew},cg={NearestFilter:eM,NearestMipmapNearestFilter:eC,NearestMipmapLinearFilter:eT,LinearFilter:eI,LinearMipmapNearestFilter:eB,LinearMipmapLinearFilter:eP};class cA extends uH{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,i,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,a=uG.get(e);if(void 0!==a){if(s.manager.itemStart(e),a.then){a.then(n=>{i&&i(n),s.manager.itemEnd(e)}).catch(e=>{r&&r(e)});return}return setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a}let o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader;let l=fetch(e,o).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(n){return uG.add(e,n),i&&i(n),s.manager.itemEnd(e),n}).catch(function(i){r&&r(i),uG.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});uG.add(e,l),s.manager.itemStart(e)}}class cv{static getContext(){return void 0===a&&(a=new(window.AudioContext||window.webkitAudioContext)),a}static setContext(e){a=e}}class cy extends uH{constructor(e){super(e)}load(e,i,n,r){let s=this,a=new uq(this.manager);function o(i){r?r(i):console.error(i),s.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(e){try{let n=e.slice(0);cv.getContext().decodeAudioData(n,function(e){i(e)}).catch(o)}catch(e){o(e)}},n,r)}}let cx=new nk,c_=new nk,cb=new nk;class cE{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new sc,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new sc,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){let i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){let n,r;i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,cb.copy(e.projectionMatrix);let s=i.eyeSep/2,a=s*i.near/i.focus,o=i.near*Math.tan(iL*i.fov*.5)/i.zoom;c_.elements[12]=-s,cx.elements[12]=s,n=-o*i.aspect+a,r=o*i.aspect+a,cb.elements[0]=2*i.near/(r-n),cb.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(cb),n=-o*i.aspect-a,r=o*i.aspect-a,cb.elements[0]=2*i.near/(r-n),cb.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(cb)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(c_),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(cx)}}class cw{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=cM(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let i=cM();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function cM(){return("undefined"==typeof performance?Date:performance).now()}let cC=new nl,cS=new no,cT=new nl,cR=new nl;class cI extends rt{constructor(){super(),this.type="AudioListener",this.context=cv.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new cw}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let i=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(cC,cS,cT),cR.set(0,0,-1).applyQuaternion(cS),i.positionX){let e=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(cC.x,e),i.positionY.linearRampToValueAtTime(cC.y,e),i.positionZ.linearRampToValueAtTime(cC.z,e),i.forwardX.linearRampToValueAtTime(cR.x,e),i.forwardY.linearRampToValueAtTime(cR.y,e),i.forwardZ.linearRampToValueAtTime(cR.z,e),i.upX.linearRampToValueAtTime(n.x,e),i.upY.linearRampToValueAtTime(n.y,e),i.upZ.linearRampToValueAtTime(n.z,e)}else i.setPosition(cC.x,cC.y,cC.z),i.setOrientation(cR.x,cR.y,cR.z,n.x,n.y,n.z)}}class cB extends rt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}let cL=new nl,cP=new no,cD=new nl,cN=new nl;class cO extends cB{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(cL,cP,cD),cN.set(0,0,1).applyQuaternion(cP);let i=this.panner;if(i.positionX){let e=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(cL.x,e),i.positionY.linearRampToValueAtTime(cL.y,e),i.positionZ.linearRampToValueAtTime(cL.z,e),i.orientationX.linearRampToValueAtTime(cN.x,e),i.orientationY.linearRampToValueAtTime(cN.y,e),i.orientationZ.linearRampToValueAtTime(cN.z,e)}else i.setPosition(cL.x,cL.y,cL.z),i.setOrientation(cN.x,cN.y,cN.z)}}class cU{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,i=this.getFrequencyData();for(let n=0;n<i.length;n++)e+=i[n];return e/i.length}}class ck{constructor(e,i,n){let r,s,a;switch(this.binding=e,this.valueSize=n,i){case"quaternion":r=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=Array(5*n);break;default:r=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){let n=this.buffer,r=this.valueSize,s=e*r+r,a=this.cumulativeWeight;if(0===a){for(let e=0;e!==r;++e)n[s+e]=n[e];a=i}else{a+=i;let e=i/a;this._mixBufferRegion(n,s,0,e,r)}this.cumulativeWeight=a}accumulateAdditive(e){let i=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(i,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){let i=this.valueSize,n=this.buffer,r=e*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){let e=i*this._origIndex;this._mixBufferRegion(n,r,e,1-s,i)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*i,1,i);for(let e=i,s=i+i;e!==s;++e)if(n[e]!==n[e+i]){o.setValue(n,r);break}}saveOriginalState(){let e=this.binding,i=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(i,r);for(let e=n;e!==r;++e)i[e]=i[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let n=e;n<i;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[i+n]=this.buffer[e+n]}_select(e,i,n,r,s){if(r>=.5)for(let r=0;r!==s;++r)e[i+r]=e[n+r]}_slerp(e,i,n,r){no.slerpFlat(e,i,e,i,e,n,r)}_slerpAdditive(e,i,n,r,s){let a=this._workIndex*s;no.multiplyQuaternionsFlat(e,a,e,i,e,n),no.slerpFlat(e,i,e,i,e,a,r)}_lerp(e,i,n,r,s){let a=1-r;for(let o=0;o!==s;++o){let s=i+o;e[s]=e[s]*a+e[n+o]*r}}_lerpAdditive(e,i,n,r,s){for(let a=0;a!==s;++a){let s=i+a;e[s]=e[s]+e[n+a]*r}}}let cF="\\[\\]\\.:\\/",cz=RegExp("["+cF+"]","g"),cG="[^"+cF+"]",cV="[^"+cF.replace("\\.","")+"]",cj=/((?:WC+[\/:])*)/.source.replace("WC",cG),cH=/(WCOD+)?/.source.replace("WCOD",cV),cQ=RegExp("^"+cj+cH+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",cG)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",cG)+"$"),cW=["material","materials","bones","map"];class cq{constructor(e,i,n){this.path=i,this.parsedPath=n||cq.parseTrackName(i),this.node=cq.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,n){return e&&e.isAnimationObjectGroup?new cq.Composite(e,i,n):new cq(e,i,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(cz,"")}static parseTrackName(e){let i=cQ.exec(e);if(null===i)throw Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let e=n.nodeName.substring(r+1);-1!==cW.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,i){if(void 0===i||""===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(i);if(void 0!==n)return n}if(e.children){let n=function(e){for(let r=0;r<e.length;r++){let s=e[r];if(s.name===i||s.uuid===i)return s;let a=n(s.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[i++]=n[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node,i=this.parsedPath,n=i.objectName,r=i.propertyName,s=i.propertyIndex;if(e||(e=cq.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let r=i.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let i=0;i<e.length;i++)if(e[i].name===r){r=i;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(void 0===e[n]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(void 0!==r){if(void 0===e[r]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[r]}}let a=e[r];if(void 0===a){console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+r+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===r){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}cq.Composite=class{constructor(e,i,n){let r=n||cq.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,r)}getValue(e,i){this.bind();let n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,i)}setValue(e,i){let n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,i)}bind(){let e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].bind()}unbind(){let e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].unbind()}},cq.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},cq.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},cq.prototype.GetterByBindingType=[cq.prototype._getValue_direct,cq.prototype._getValue_array,cq.prototype._getValue_arrayElement,cq.prototype._getValue_toArray],cq.prototype.SetterByBindingTypeAndVersioning=[[cq.prototype._setValue_direct,cq.prototype._setValue_direct_setNeedsUpdate,cq.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[cq.prototype._setValue_array,cq.prototype._setValue_array_setNeedsUpdate,cq.prototype._setValue_array_setMatrixWorldNeedsUpdate],[cq.prototype._setValue_arrayElement,cq.prototype._setValue_arrayElement_setNeedsUpdate,cq.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[cq.prototype._setValue_fromArray,cq.prototype._setValue_fromArray_setNeedsUpdate,cq.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class cX{constructor(){this.isAnimationObjectGroup=!0,this.uuid=iD(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){let e=this._objects,i=this._indicesByUUID,n=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length,o,l=e.length,h=this.nCachedObjects_;for(let u=0,c=arguments.length;u!==c;++u){let c=arguments[u],d=c.uuid,p=i[d];if(void 0===p){p=l++,i[d]=p,e.push(c);for(let e=0;e!==a;++e)s[e].push(new cq(c,n[e],r[e]))}else if(p<h){o=e[p];let l=--h,u=e[l];i[u.uuid]=p,e[p]=u,i[d]=l,e[l]=c;for(let e=0;e!==a;++e){let i=s[e],a=i[l],o=i[p];i[p]=a,void 0===o&&(o=new cq(c,n[e],r[e])),i[l]=o}}else e[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){let e=this._objects,i=this._indicesByUUID,n=this._bindings,r=n.length,s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){let o=arguments[a],l=o.uuid,h=i[l];if(void 0!==h&&h>=s){let a=s++,u=e[a];i[u.uuid]=h,e[h]=u,i[l]=a,e[a]=o;for(let e=0;e!==r;++e){let i=n[e],r=i[a],s=i[h];i[h]=r,i[a]=s}}}this.nCachedObjects_=s}uncache(){let e=this._objects,i=this._indicesByUUID,n=this._bindings,r=n.length,s=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){let l=arguments[o],h=l.uuid,u=i[h];if(void 0!==u){if(delete i[h],u<s){let o=--s,l=e[o],h=--a,c=e[h];i[l.uuid]=u,e[u]=l,i[c.uuid]=o,e[o]=c,e.pop();for(let e=0;e!==r;++e){let i=n[e],r=i[o],s=i[h];i[u]=r,i[o]=s,i.pop()}}else{let s=--a,o=e[s];s>0&&(i[o.uuid]=u),e[u]=o,e.pop();for(let e=0;e!==r;++e){let i=n[e];i[u]=i[s],i.pop()}}}}this.nCachedObjects_=s}subscribe_(e,i){let n=this._bindingsIndicesByPath,r=n[e],s=this._bindings;if(void 0!==r)return s[r];let a=this._paths,o=this._parsedPaths,l=this._objects,h=l.length,u=this.nCachedObjects_,c=Array(h);r=s.length,n[e]=r,a.push(e),o.push(i),s.push(c);for(let n=u,r=l.length;n!==r;++n){let r=l[n];c[n]=new cq(r,e,i)}return c}unsubscribe_(e){let i=this._bindingsIndicesByPath,n=i[e];if(void 0!==n){let r=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o];i[e[o]]=n,a[n]=l,a.pop(),s[n]=s[o],s.pop(),r[n]=r[o],r.pop()}}}class cK{constructor(e,i,n=null,r=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=n,this.blendMode=r;let s=i.tracks,a=s.length,o=Array(a),l={endingStart:tP,endingEnd:tP};for(let e=0;e!==a;++e){let i=s[e].createInterpolant(null);o[e]=i,i.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=tT,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,n){if(e.fadeOut(i),this.fadeIn(i),n){let n=this._clip.duration,r=e._clip.duration;e.warp(1,r/n,i),this.warp(n/r,1,i)}return this}crossFadeTo(e,i,n){return e.crossFadeFrom(this,i,n)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,n){let r=this._mixer,s=r.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);let l=o.parameterPositions,h=o.sampleValues;return l[0]=s,l[1]=s+n,h[0]=e/a,h[1]=i/a,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,n,r){if(!this.enabled){this._updateWeight(e);return}let s=this._startTime;if(null!==s){let r=(e-s)*n;r<0||0===n?i=0:(this._startTime=null,i=n*r)}i*=this._updateTimeScale(e);let a=this._updateTime(i),o=this._updateWeight(e);if(o>0){let e=this._interpolants,i=this._propertyBindings;if(this.blendMode===tU)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(a),i[n].accumulateAdditive(o);else for(let n=0,s=e.length;n!==s;++n)e[n].evaluate(a),i[n].accumulate(r,o)}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;let n=this._weightInterpolant;if(null!==n){let r=n.evaluate(e)[0];i*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;let n=this._timeScaleInterpolant;null!==n&&(i*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===i?this.paused=!0:this.timeScale=i))}return this._effectiveTimeScale=i,i}_updateTime(e){let i=this._clip.duration,n=this.loop,r=this.time+e,s=this._loopCount,a=n===tR;if(0===e)return -1===s?r:a&&(1&s)==1?i-r:r;if(n===tS){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));r:{if(r>=i)r=i;else if(r<0)r=0;else{this.time=r;break r}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=i||r<0){let n=Math.floor(r/i);r-=i*n,s+=Math.abs(n);let o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?i:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){let i=e<0;this._setEndings(i,!i,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(a&&(1&s)==1)return i-r}return r}_setEndings(e,i,n){let r=this._interpolantSettings;n?(r.endingStart=tD,r.endingEnd=tD):(e?r.endingStart=this.zeroSlopeAtStart?tD:tP:r.endingStart=tN,i?r.endingEnd=this.zeroSlopeAtEnd?tD:tP:r.endingEnd=tN)}_scheduleFading(e,i,n){let r=this._mixer,s=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+e,l[1]=n,this}}let cY=new Float32Array(1);class cJ extends iR{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){let n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,a=e._propertyBindings,o=e._interpolants,l=n.uuid,h=this._bindingsByRootAndName,u=h[l];void 0===u&&(u={},h[l]=u);for(let e=0;e!==s;++e){let s=r[e],h=s.name,c=u[h];if(void 0!==c)++c.referenceCount,a[e]=c;else{if(void 0!==(c=a[e])){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,l,h));continue}let r=i&&i._propertyBindings[e].binding.parsedPath;c=new ck(cq.create(n,h,r),s.ValueTypeName,s.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,l,h),a[e]=c}o[e].resultBuffer=c.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let i=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,i)}let i=e._propertyBindings;for(let e=0,n=i.length;e!==n;++e){let n=i[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let i=e._propertyBindings;for(let e=0,n=i.length;e!==n;++e){let n=i[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let i=e._cacheIndex;return null!==i&&i<this._nActiveActions}_addInactiveAction(e,i,n){let r=this._actions,s=this._actionsByClip,a=s[i];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[i]=a;else{let i=a.knownActions;e._byClipCacheIndex=i.length,i.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){let i=this._actions,n=i[i.length-1],r=e._cacheIndex;n._cacheIndex=r,i[r]=n,i.pop(),e._cacheIndex=null;let s=e._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,h=l[l.length-1],u=e._byClipCacheIndex;h._byClipCacheIndex=u,l[u]=h,l.pop(),e._byClipCacheIndex=null;let c=o.actionByRoot,d=(e._localRoot||this._root).uuid;delete c[d],0===l.length&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let i=e._propertyBindings;for(let e=0,n=i.length;e!==n;++e){let n=i[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){let i=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=i[r];e._cacheIndex=r,i[r]=e,s._cacheIndex=n,i[n]=s}_takeBackAction(e){let i=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=i[r];e._cacheIndex=r,i[r]=e,s._cacheIndex=n,i[n]=s}_addInactiveBinding(e,i,n){let r=this._bindingsByRootAndName,s=this._bindings,a=r[i];void 0===a&&(a={},r[i]=a),a[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){let i=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,a=this._bindingsByRootAndName,o=a[r],l=i[i.length-1],h=e._cacheIndex;l._cacheIndex=h,i[h]=l,i.pop(),delete o[s],0===Object.keys(o).length&&delete a[r]}_lendBinding(e){let i=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=i[r];e._cacheIndex=r,i[r]=e,s._cacheIndex=n,i[n]=s}_takeBackBinding(e){let i=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=i[r];e._cacheIndex=r,i[r]=e,s._cacheIndex=n,i[n]=s}_lendControlInterpolant(){let e=this._controlInterpolants,i=this._nActiveControlInterpolants++,n=e[i];return void 0===n&&((n=new uI(new Float32Array(2),new Float32Array(2),1,cY)).__cacheIndex=i,e[i]=n),n}_takeBackControlInterpolant(e){let i=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=i[r];e.__cacheIndex=r,i[r]=e,s.__cacheIndex=n,i[n]=s}clipAction(e,i,n){let r=i||this._root,s=r.uuid,a="string"==typeof e?uz.findByName(r,e):e,o=null!==a?a.uuid:e,l=this._actionsByClip[o],h=null;if(void 0===n&&(n=null!==a?a.blendMode:tO),void 0!==l){let e=l.actionByRoot[s];if(void 0!==e&&e.blendMode===n)return e;h=l.knownActions[0],null===a&&(a=h._clip)}if(null===a)return null;let u=new cK(this,a,i,n);return this._bindAction(u,h),this._addInactiveAction(u,o,s),u}existingAction(e,i){let n=i||this._root,r=n.uuid,s="string"==typeof e?uz.findByName(n,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){let e=this._actions,i=this._nActiveActions;for(let n=i-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;let i=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let o=0;o!==n;++o)i[o]._update(r,e,s,a);let o=this._bindings,l=this._nActiveBindings;for(let e=0;e!==l;++e)o[e].apply(a);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let i=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(void 0!==s){let e=s.knownActions;for(let n=0,r=e.length;n!==r;++n){let r=e[n];this._deactivateAction(r);let s=r._cacheIndex,a=i[i.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,a._cacheIndex=s,i[s]=a,i.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){let i=e.uuid,n=this._actionsByClip;for(let e in n){let r=n[e].actionByRoot[i];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}let r=this._bindingsByRootAndName[i];if(void 0!==r)for(let e in r){let i=r[e];i.restoreOriginalState(),this._removeInactiveBinding(i)}}uncacheAction(e,i){let n=this.existingAction(e,i);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class cZ{constructor(e){this.value=e}clone(){return new cZ(void 0===this.value.clone?this.value:this.value.clone())}}let c$=0;class c0 extends iR{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:c$++}),this.name="",this.usage=ig,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){let i=this.uniforms.indexOf(e);return -1!==i&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;let i=e.uniforms;this.uniforms.length=0;for(let e=0,n=i.length;e<n;e++){let n=Array.isArray(i[e])?i[e]:[i[e]];for(let e=0;e<n.length;e++)this.uniforms.push(n[e].clone())}return this}clone(){return new this.constructor().copy(this)}}class c1 extends oK{constructor(e,i,n=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){let i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class c2{constructor(e,i,n,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=n,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}let c3=new nk;class c4{constructor(e,i,n=0,r=1/0){this.ray=new nU(e,i),this.near=n,this.far=r,this.camera=null,this.layers=new nK,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return c3.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(c3),this}intersectObject(e,i=!0,n=[]){return c6(e,this,n,i),n.sort(c5),n}intersectObjects(e,i=!0,n=[]){for(let r=0,s=e.length;r<s;r++)c6(e[r],this,n,i);return n.sort(c5),n}}function c5(e,i){return e.distance-i.distance}function c6(e,i,n,r){if(e.layers.test(i.layers)&&e.raycast(i,n),!0===r){let r=e.children;for(let e=0,s=r.length;e<s;e++)c6(r[e],i,n,!0)}}class c8{constructor(e=1,i=0,n=0){return this.radius=e,this.phi=i,this.theta=n,this}set(e,i,n){return this.radius=e,this.phi=i,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+i*i+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(iN(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class c7{constructor(e=1,i=0,n=0){return this.radius=e,this.theta=i,this.y=n,this}set(e,i,n){return this.radius=e,this.theta=i,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=i,this}clone(){return new this.constructor().copy(this)}}let c9=new iG;class de{constructor(e=new iG(Infinity,Infinity),i=new iG(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){let n=c9.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,c9).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let dt=new nl,di=new nl;class dn{constructor(e=new nl,i=new nl){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){dt.subVectors(e,this.start),di.subVectors(this.end,this.start);let n=di.dot(di),r=di.dot(dt)/n;return i&&(r=iN(r,0,1)),r}closestPointToPoint(e,i,n){let r=this.closestPointToPointParameter(e,i);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}let dr=new nl;class ds extends rt{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";let n=new rQ,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,i=1;e<32;e++,i++){let n=e/32*Math.PI*2,s=i/32*Math.PI*2;r.push(Math.cos(n),Math.sin(n),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new rU(r,3));let s=new lQ({fog:!1,toneMapped:!1});this.cone=new l3(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);let e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),dr.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(dr),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}let da=new nl,dl=new nk,dh=new nk;class du extends l3{constructor(e){let i=function e(i){let n=[];!0===i.isBone&&n.push(i);for(let r=0;r<i.children.length;r++)n.push.apply(n,e(i.children[r]));return n}(e),n=new rQ,r=[],s=[],a=new rA(0,0,1),o=new rA(0,1,0);for(let e=0;e<i.length;e++){let n=i[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}n.setAttribute("position",new rU(r,3)),n.setAttribute("color",new rU(s,3)),super(n,new lQ({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let i=this.bones,n=this.geometry,r=n.getAttribute("position");dh.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<i.length;e++){let s=i[e];s.parent&&s.parent.isBone&&(dl.multiplyMatrices(dh,s.matrixWorld),da.setFromMatrixPosition(dl),r.setXYZ(n,da.x,da.y,da.z),dl.multiplyMatrices(dh,s.parent.matrixWorld),da.setFromMatrixPosition(dl),r.setXYZ(n+1,da.x,da.y,da.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}class dc extends r9{constructor(e,i,n){super(new ur(i,4,2),new r_({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}let dd=new nl,dp=new rA,df=new rA;class dm extends rt{constructor(e,i,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";let r=new ut(i);r.rotateY(.5*Math.PI),this.material=new r_({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);let s=new Float32Array(3*r.getAttribute("position").count);r.setAttribute("color",new rT(s,3)),this.add(new r9(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{let i=e.geometry.getAttribute("color");dp.copy(this.light.color),df.copy(this.light.groundColor);for(let e=0,n=i.count;e<n;e++){let r=e<n/2?dp:df;i.setXYZ(e,r.r,r.g,r.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(dd.setFromMatrixPosition(this.light.matrixWorld).negate())}}class dg extends l3{constructor(e=10,i=10,n=4473924,r=8947848){n=new rA(n),r=new rA(r);let s=i/2,a=e/i,o=e/2,l=[],h=[];for(let e=0,u=0,c=-o;e<=i;e++,c+=a){l.push(-o,0,c,o,0,c),l.push(c,0,-o,c,0,o);let i=e===s?n:r;i.toArray(h,u),u+=3,i.toArray(h,u),u+=3,i.toArray(h,u),u+=3,i.toArray(h,u),u+=3}let u=new rQ;u.setAttribute("position",new rU(l,3)),u.setAttribute("color",new rU(h,3)),super(u,new lQ({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class dA extends l3{constructor(e=10,i=16,n=8,r=64,s=4473924,a=8947848){s=new rA(s),a=new rA(a);let o=[],l=[];if(i>1)for(let n=0;n<i;n++){let r=n/i*(2*Math.PI),h=Math.sin(r)*e,u=Math.cos(r)*e;o.push(0,0,0),o.push(h,0,u);let c=1&n?s:a;l.push(c.r,c.g,c.b),l.push(c.r,c.g,c.b)}for(let i=0;i<n;i++){let h=1&i?s:a,u=e-e/n*i;for(let e=0;e<r;e++){let i=e/r*(2*Math.PI),n=Math.sin(i)*u,s=Math.cos(i)*u;o.push(n,0,s),l.push(h.r,h.g,h.b),n=Math.sin(i=(e+1)/r*(2*Math.PI))*u,s=Math.cos(i)*u,o.push(n,0,s),l.push(h.r,h.g,h.b)}}let h=new rQ;h.setAttribute("position",new rU(o,3)),h.setAttribute("color",new rU(l,3)),super(h,new lQ({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}let dv=new nl,dy=new nl,dx=new nl;class d_ extends rt{constructor(e,i,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===i&&(i=1);let r=new rQ;r.setAttribute("position",new rU([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));let s=new lQ({fog:!1,toneMapped:!1});this.lightPlane=new l$(r,s),this.add(this.lightPlane),(r=new rQ).setAttribute("position",new rU([0,0,0,0,0,1],3)),this.targetLine=new l$(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),dv.setFromMatrixPosition(this.light.matrixWorld),dy.setFromMatrixPosition(this.light.target.matrixWorld),dx.subVectors(dy,dv),this.lightPlane.lookAt(dy),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(dy),this.targetLine.scale.z=dx.length()}}let db=new nl,dE=new so;class dw extends l3{constructor(e){let i=new rQ,n=new lQ({color:0xffffff,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={};function o(e,i){l(e),l(i)}function l(e){r.push(0,0,0),s.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),i.setAttribute("position",new rU(r,3)),i.setAttribute("color",new rU(s,3)),super(i,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();let h=new rA(0xffaa00),u=new rA(0xff0000),c=new rA(43775),d=new rA(0xffffff),p=new rA(3355443);this.setColors(h,u,c,d,p)}setColors(e,i,n,r,s){let a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,i.r,i.g,i.b),a.setXYZ(25,i.r,i.g,i.b),a.setXYZ(26,i.r,i.g,i.b),a.setXYZ(27,i.r,i.g,i.b),a.setXYZ(28,i.r,i.g,i.b),a.setXYZ(29,i.r,i.g,i.b),a.setXYZ(30,i.r,i.g,i.b),a.setXYZ(31,i.r,i.g,i.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){let e=this.geometry,i=this.pointMap;dE.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),dM("c",i,e,dE,0,0,-1),dM("t",i,e,dE,0,0,1),dM("n1",i,e,dE,-1,-1,-1),dM("n2",i,e,dE,1,-1,-1),dM("n3",i,e,dE,-1,1,-1),dM("n4",i,e,dE,1,1,-1),dM("f1",i,e,dE,-1,-1,1),dM("f2",i,e,dE,1,-1,1),dM("f3",i,e,dE,-1,1,1),dM("f4",i,e,dE,1,1,1),dM("u1",i,e,dE,.7,1.1,-1),dM("u2",i,e,dE,-.7,1.1,-1),dM("u3",i,e,dE,0,2,-1),dM("cf1",i,e,dE,-1,0,1),dM("cf2",i,e,dE,1,0,1),dM("cf3",i,e,dE,0,-1,1),dM("cf4",i,e,dE,0,1,1),dM("cn1",i,e,dE,-1,0,-1),dM("cn2",i,e,dE,1,0,-1),dM("cn3",i,e,dE,0,-1,-1),dM("cn4",i,e,dE,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function dM(e,i,n,r,s,a,o){db.set(s,a,o).unproject(r);let l=i[e];if(void 0!==l){let e=n.getAttribute("position");for(let i=0,n=l.length;i<n;i++)e.setXYZ(l[i],db.x,db.y,db.z)}}let dC=new nc;class dS extends l3{constructor(e,i=0xffff00){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new rQ;s.setIndex(new rT(n,1)),s.setAttribute("position",new rT(r,3)),super(s,new lQ({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&dC.setFromObject(this.object),dC.isEmpty())return;let i=dC.min,n=dC.max,r=this.geometry.attributes.position,s=r.array;s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=i.x,s[4]=n.y,s[5]=n.z,s[6]=i.x,s[7]=i.y,s[8]=n.z,s[9]=n.x,s[10]=i.y,s[11]=n.z,s[12]=n.x,s[13]=n.y,s[14]=i.z,s[15]=i.x,s[16]=n.y,s[17]=i.z,s[18]=i.x,s[19]=i.y,s[20]=i.z,s[21]=n.x,s[22]=i.y,s[23]=i.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class dT extends l3{constructor(e,i=0xffff00){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new rQ;r.setIndex(new rT(n,1)),r.setAttribute("position",new rU([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new lQ({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class dR extends l${constructor(e,i=1,n=0xffff00){let r=new rQ;r.setAttribute("position",new rU([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new lQ({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;let s=new rQ;s.setAttribute("position",new rU([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new r9(s,new r_({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}let dI=new nl;class dB extends rt{constructor(e=new nl(0,0,1),i=new nl(0,0,0),n=1,r=0xffff00,s=.2*n,a=.2*s){super(),this.type="ArrowHelper",void 0===o&&((o=new rQ).setAttribute("position",new rU([0,0,0,0,1,0],3)),(l=new hP(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(i),this.line=new l$(o,new lQ({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new r9(l,new r_({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{dI.set(e.z,0,-e.x).normalize();let i=Math.acos(e.y);this.quaternion.setFromAxisAngle(dI,i)}}setLength(e,i=.2*e,n=.2*i){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(n,i,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class dL extends l3{constructor(e=1){let i=new rQ;i.setAttribute("position",new rU([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],3)),i.setAttribute("color",new rU([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new lQ({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,i,n){let r=new rA,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(i),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class dP{constructor(){this.type="ShapePath",this.color=new rA,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new hR,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,n,r){return this.currentPath.quadraticCurveTo(e,i,n,r),this}bezierCurveTo(e,i,n,r,s,a){return this.currentPath.bezierCurveTo(e,i,n,r,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){let i,n,r,s,a;let o=h5.isClockWise,l=this.subPaths;if(0===l.length)return[];let h=[];if(1===l.length)return n=l[0],(r=new hV).curves=n.curves,h.push(r),h;let u=!o(l[0].getPoints());u=e?!u:u;let c=[],d=[],p=[],f=0;d[0]=void 0,p[f]=[];for(let r=0,a=l.length;r<a;r++)i=o(s=(n=l[r]).getPoints()),(i=e?!i:i)?(!u&&d[f]&&f++,d[f]={s:new hV,p:s},d[f].s.curves=n.curves,u&&f++,p[f]=[]):p[f].push({h:n,p:s[0]});if(!d[0])return function(e){let i=[];for(let n=0,r=e.length;n<r;n++){let r=e[n],s=new hV;s.curves=r.curves,i.push(s)}return i}(l);if(d.length>1){let e=!1,i=0;for(let e=0,i=d.length;e<i;e++)c[e]=[];for(let n=0,r=d.length;n<r;n++){let r=p[n];for(let s=0;s<r.length;s++){let a=r[s],o=!0;for(let r=0;r<d.length;r++)(function(e,i){let n=i.length,r=!1;for(let s=n-1,a=0;a<n;s=a++){let n=i[s],o=i[a],l=o.x-n.x,h=o.y-n.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(n=i[a],l=-l,o=i[s],h=-h),e.y<n.y||e.y>o.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{let i=h*(e.x-n.x)-l*(e.y-n.y);if(0===i)return!0;if(i<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(o.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=o.x)return!0}}return r})(a.p,d[r].p)&&(n!==r&&i++,o?(o=!1,c[r].push(a)):e=!0);o&&c[n].push(a)}}i>0&&!1===e&&(p=c)}for(let e=0,i=d.length;e<i;e++){r=d[e].s,h.push(r),a=p[e];for(let e=0,i=a.length;e<i;e++)r.holes.push(a[e].h)}return h}}class dD extends ni{constructor(e=1,i=1,n=1,r={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,i,{...r,count:n}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:h}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=h)},"./node_modules/three/examples/jsm/libs/ktx-parse.module.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{KHR_DF_CHANNEL_RGBSDA_ALPHA:()=>ei,KHR_DF_CHANNEL_RGBSDA_BLUE:()=>$,KHR_DF_CHANNEL_RGBSDA_DEPTH:()=>et,KHR_DF_CHANNEL_RGBSDA_GREEN:()=>Z,KHR_DF_CHANNEL_RGBSDA_RED:()=>J,KHR_DF_CHANNEL_RGBSDA_STENCIL:()=>ee,KHR_DF_FLAG_ALPHA_PREMULTIPLIED:()=>y,KHR_DF_FLAG_ALPHA_STRAIGHT:()=>v,KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT:()=>h,KHR_DF_MODEL_ASTC:()=>g,KHR_DF_MODEL_ETC1:()=>f,KHR_DF_MODEL_ETC1S:()=>A,KHR_DF_MODEL_ETC2:()=>m,KHR_DF_MODEL_RGBSDA:()=>p,KHR_DF_MODEL_UNSPECIFIED:()=>d,KHR_DF_PRIMARIES_ACES:()=>Q,KHR_DF_PRIMARIES_ACESCC:()=>W,KHR_DF_PRIMARIES_ADOBERGB:()=>Y,KHR_DF_PRIMARIES_BT2020:()=>j,KHR_DF_PRIMARIES_BT601_EBU:()=>G,KHR_DF_PRIMARIES_BT601_SMPTE:()=>V,KHR_DF_PRIMARIES_BT709:()=>z,KHR_DF_PRIMARIES_CIEXYZ:()=>H,KHR_DF_PRIMARIES_DISPLAYP3:()=>K,KHR_DF_PRIMARIES_NTSC1953:()=>q,KHR_DF_PRIMARIES_PAL525:()=>X,KHR_DF_PRIMARIES_UNSPECIFIED:()=>F,KHR_DF_SAMPLE_DATATYPE_EXPONENT:()=>es,KHR_DF_SAMPLE_DATATYPE_FLOAT:()=>en,KHR_DF_SAMPLE_DATATYPE_LINEAR:()=>ea,KHR_DF_SAMPLE_DATATYPE_SIGNED:()=>er,KHR_DF_TRANSFER_ACESCC:()=>O,KHR_DF_TRANSFER_ACESCCT:()=>U,KHR_DF_TRANSFER_ADOBERGB:()=>k,KHR_DF_TRANSFER_BT1886:()=>S,KHR_DF_TRANSFER_DCIP3:()=>L,KHR_DF_TRANSFER_HLG_EOTF:()=>R,KHR_DF_TRANSFER_HLG_OETF:()=>T,KHR_DF_TRANSFER_ITU:()=>E,KHR_DF_TRANSFER_LINEAR:()=>_,KHR_DF_TRANSFER_NTSC:()=>w,KHR_DF_TRANSFER_PAL625_EOTF:()=>D,KHR_DF_TRANSFER_PAL_OETF:()=>P,KHR_DF_TRANSFER_PQ_EOTF:()=>I,KHR_DF_TRANSFER_PQ_OETF:()=>B,KHR_DF_TRANSFER_SLOG:()=>M,KHR_DF_TRANSFER_SLOG2:()=>C,KHR_DF_TRANSFER_SRGB:()=>b,KHR_DF_TRANSFER_ST240:()=>N,KHR_DF_TRANSFER_UNSPECIFIED:()=>x,KHR_DF_VENDORID_KHRONOS:()=>u,KHR_DF_VERSION:()=>c,KHR_SUPERCOMPRESSION_BASISLZ:()=>a,KHR_SUPERCOMPRESSION_NONE:()=>s,KHR_SUPERCOMPRESSION_ZLIB:()=>l,KHR_SUPERCOMPRESSION_ZSTD:()=>o,KTX2Container:()=>ns,VK_FORMAT_A1R5G5B5_UNORM_PACK16:()=>em,VK_FORMAT_A2B10G10R10_SINT_PACK32:()=>e$,VK_FORMAT_A2B10G10R10_SNORM_PACK32:()=>eJ,VK_FORMAT_A2B10G10R10_UINT_PACK32:()=>eZ,VK_FORMAT_A2B10G10R10_UNORM_PACK32:()=>eY,VK_FORMAT_A2R10G10B10_SINT_PACK32:()=>eK,VK_FORMAT_A2R10G10B10_SNORM_PACK32:()=>eq,VK_FORMAT_A2R10G10B10_UINT_PACK32:()=>eX,VK_FORMAT_A2R10G10B10_UNORM_PACK32:()=>eW,VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT:()=>nr,VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT:()=>nn,VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT:()=>ne,VK_FORMAT_ASTC_10x10_SRGB_BLOCK:()=>iI,VK_FORMAT_ASTC_10x10_UNORM_BLOCK:()=>iR,VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT:()=>i8,VK_FORMAT_ASTC_10x5_SRGB_BLOCK:()=>iw,VK_FORMAT_ASTC_10x5_UNORM_BLOCK:()=>iE,VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT:()=>i7,VK_FORMAT_ASTC_10x6_SRGB_BLOCK:()=>iC,VK_FORMAT_ASTC_10x6_UNORM_BLOCK:()=>iM,VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT:()=>i9,VK_FORMAT_ASTC_10x8_SRGB_BLOCK:()=>iT,VK_FORMAT_ASTC_10x8_UNORM_BLOCK:()=>iS,VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT:()=>nt,VK_FORMAT_ASTC_12x10_SRGB_BLOCK:()=>iL,VK_FORMAT_ASTC_12x10_UNORM_BLOCK:()=>iB,VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT:()=>ni,VK_FORMAT_ASTC_12x12_SRGB_BLOCK:()=>iD,VK_FORMAT_ASTC_12x12_UNORM_BLOCK:()=>iP,VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT:()=>i$,VK_FORMAT_ASTC_4x4_SRGB_BLOCK:()=>io,VK_FORMAT_ASTC_4x4_UNORM_BLOCK:()=>ia,VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT:()=>i0,VK_FORMAT_ASTC_5x4_SRGB_BLOCK:()=>ih,VK_FORMAT_ASTC_5x4_UNORM_BLOCK:()=>il,VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT:()=>i1,VK_FORMAT_ASTC_5x5_SRGB_BLOCK:()=>ic,VK_FORMAT_ASTC_5x5_UNORM_BLOCK:()=>iu,VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT:()=>i2,VK_FORMAT_ASTC_6x5_SRGB_BLOCK:()=>ip,VK_FORMAT_ASTC_6x5_UNORM_BLOCK:()=>id,VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT:()=>i3,VK_FORMAT_ASTC_6x6_SRGB_BLOCK:()=>ig,VK_FORMAT_ASTC_6x6_UNORM_BLOCK:()=>im,VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT:()=>i4,VK_FORMAT_ASTC_8x5_SRGB_BLOCK:()=>iv,VK_FORMAT_ASTC_8x5_UNORM_BLOCK:()=>iA,VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT:()=>i5,VK_FORMAT_ASTC_8x6_SRGB_BLOCK:()=>ix,VK_FORMAT_ASTC_8x6_UNORM_BLOCK:()=>iy,VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT:()=>i6,VK_FORMAT_ASTC_8x8_SRGB_BLOCK:()=>ib,VK_FORMAT_ASTC_8x8_UNORM_BLOCK:()=>i_,VK_FORMAT_B10G11R11_UFLOAT_PACK32:()=>tD,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16:()=>iF,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16:()=>iH,VK_FORMAT_B4G4R4A4_UNORM_PACK16:()=>eu,VK_FORMAT_B5G5R5A1_UNORM_PACK16:()=>ef,VK_FORMAT_B5G6R5_UNORM_PACK16:()=>ed,VK_FORMAT_B8G8R8A8_SINT:()=>eH,VK_FORMAT_B8G8R8A8_SNORM:()=>eV,VK_FORMAT_B8G8R8A8_SRGB:()=>eQ,VK_FORMAT_B8G8R8A8_UINT:()=>ej,VK_FORMAT_B8G8R8A8_UNORM:()=>eG,VK_FORMAT_B8G8R8_SINT:()=>eD,VK_FORMAT_B8G8R8_SNORM:()=>eL,VK_FORMAT_B8G8R8_SRGB:()=>eN,VK_FORMAT_B8G8R8_UINT:()=>eP,VK_FORMAT_B8G8R8_UNORM:()=>eB,VK_FORMAT_BC1_RGBA_SRGB_BLOCK:()=>tW,VK_FORMAT_BC1_RGBA_UNORM_BLOCK:()=>tQ,VK_FORMAT_BC1_RGB_SRGB_BLOCK:()=>tH,VK_FORMAT_BC1_RGB_UNORM_BLOCK:()=>tj,VK_FORMAT_BC2_SRGB_BLOCK:()=>tX,VK_FORMAT_BC2_UNORM_BLOCK:()=>tq,VK_FORMAT_BC3_SRGB_BLOCK:()=>tY,VK_FORMAT_BC3_UNORM_BLOCK:()=>tK,VK_FORMAT_BC4_SNORM_BLOCK:()=>tZ,VK_FORMAT_BC4_UNORM_BLOCK:()=>tJ,VK_FORMAT_BC5_SNORM_BLOCK:()=>t0,VK_FORMAT_BC5_UNORM_BLOCK:()=>t$,VK_FORMAT_BC6H_SFLOAT_BLOCK:()=>t2,VK_FORMAT_BC6H_UFLOAT_BLOCK:()=>t1,VK_FORMAT_BC7_SRGB_BLOCK:()=>t4,VK_FORMAT_BC7_UNORM_BLOCK:()=>t3,VK_FORMAT_D16_UNORM:()=>tO,VK_FORMAT_D16_UNORM_S8_UINT:()=>tz,VK_FORMAT_D24_UNORM_S8_UINT:()=>tG,VK_FORMAT_D32_SFLOAT:()=>tk,VK_FORMAT_D32_SFLOAT_S8_UINT:()=>tV,VK_FORMAT_E5B9G9R9_UFLOAT_PACK32:()=>tN,VK_FORMAT_EAC_R11G11_SNORM_BLOCK:()=>is,VK_FORMAT_EAC_R11G11_UNORM_BLOCK:()=>ir,VK_FORMAT_EAC_R11_SNORM_BLOCK:()=>ii,VK_FORMAT_EAC_R11_UNORM_BLOCK:()=>it,VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK:()=>t7,VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK:()=>t8,VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK:()=>ie,VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK:()=>t9,VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK:()=>t6,VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK:()=>t5,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16:()=>ik,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16:()=>ij,VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG:()=>iK,VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG:()=>iQ,VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG:()=>iY,VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG:()=>iW,VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG:()=>iJ,VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG:()=>iq,VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG:()=>iZ,VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG:()=>iX,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16:()=>iU,VK_FORMAT_R10X6G10X6_UNORM_2PACK16:()=>iO,VK_FORMAT_R10X6_UNORM_PACK16:()=>iN,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16:()=>iV,VK_FORMAT_R12X4G12X4_UNORM_2PACK16:()=>iG,VK_FORMAT_R12X4_UNORM_PACK16:()=>iz,VK_FORMAT_R16G16B16A16_SFLOAT:()=>th,VK_FORMAT_R16G16B16A16_SINT:()=>tl,VK_FORMAT_R16G16B16A16_SNORM:()=>ta,VK_FORMAT_R16G16B16A16_UINT:()=>to,VK_FORMAT_R16G16B16A16_UNORM:()=>ts,VK_FORMAT_R16G16B16_SFLOAT:()=>tr,VK_FORMAT_R16G16B16_SINT:()=>tn,VK_FORMAT_R16G16B16_SNORM:()=>tt,VK_FORMAT_R16G16B16_UINT:()=>ti,VK_FORMAT_R16G16B16_UNORM:()=>te,VK_FORMAT_R16G16_SFLOAT:()=>e9,VK_FORMAT_R16G16_SINT:()=>e7,VK_FORMAT_R16G16_SNORM:()=>e6,VK_FORMAT_R16G16_UINT:()=>e8,VK_FORMAT_R16G16_UNORM:()=>e5,VK_FORMAT_R16_SFLOAT:()=>e4,VK_FORMAT_R16_SINT:()=>e3,VK_FORMAT_R16_SNORM:()=>e1,VK_FORMAT_R16_UINT:()=>e2,VK_FORMAT_R16_UNORM:()=>e0,VK_FORMAT_R32G32B32A32_SFLOAT:()=>t_,VK_FORMAT_R32G32B32A32_SINT:()=>tx,VK_FORMAT_R32G32B32A32_UINT:()=>ty,VK_FORMAT_R32G32B32_SFLOAT:()=>tv,VK_FORMAT_R32G32B32_SINT:()=>tA,VK_FORMAT_R32G32B32_UINT:()=>tg,VK_FORMAT_R32G32_SFLOAT:()=>tm,VK_FORMAT_R32G32_SINT:()=>tf,VK_FORMAT_R32G32_UINT:()=>tp,VK_FORMAT_R32_SFLOAT:()=>td,VK_FORMAT_R32_SINT:()=>tc,VK_FORMAT_R32_UINT:()=>tu,VK_FORMAT_R4G4B4A4_UNORM_PACK16:()=>eh,VK_FORMAT_R4G4_UNORM_PACK8:()=>el,VK_FORMAT_R5G5B5A1_UNORM_PACK16:()=>ep,VK_FORMAT_R5G6B5_UNORM_PACK16:()=>ec,VK_FORMAT_R64G64B64A64_SFLOAT:()=>tP,VK_FORMAT_R64G64B64A64_SINT:()=>tL,VK_FORMAT_R64G64B64A64_UINT:()=>tB,VK_FORMAT_R64G64B64_SFLOAT:()=>tI,VK_FORMAT_R64G64B64_SINT:()=>tR,VK_FORMAT_R64G64B64_UINT:()=>tT,VK_FORMAT_R64G64_SFLOAT:()=>tS,VK_FORMAT_R64G64_SINT:()=>tC,VK_FORMAT_R64G64_UINT:()=>tM,VK_FORMAT_R64_SFLOAT:()=>tw,VK_FORMAT_R64_SINT:()=>tE,VK_FORMAT_R64_UINT:()=>tb,VK_FORMAT_R8G8B8A8_SINT:()=>eF,VK_FORMAT_R8G8B8A8_SNORM:()=>eU,VK_FORMAT_R8G8B8A8_SRGB:()=>ez,VK_FORMAT_R8G8B8A8_UINT:()=>ek,VK_FORMAT_R8G8B8A8_UNORM:()=>eO,VK_FORMAT_R8G8B8_SINT:()=>eR,VK_FORMAT_R8G8B8_SNORM:()=>eS,VK_FORMAT_R8G8B8_SRGB:()=>eI,VK_FORMAT_R8G8B8_UINT:()=>eT,VK_FORMAT_R8G8B8_UNORM:()=>eC,VK_FORMAT_R8G8_SINT:()=>ew,VK_FORMAT_R8G8_SNORM:()=>eb,VK_FORMAT_R8G8_SRGB:()=>eM,VK_FORMAT_R8G8_UINT:()=>eE,VK_FORMAT_R8G8_UNORM:()=>e_,VK_FORMAT_R8_SINT:()=>ey,VK_FORMAT_R8_SNORM:()=>eA,VK_FORMAT_R8_SRGB:()=>ex,VK_FORMAT_R8_UINT:()=>ev,VK_FORMAT_R8_UNORM:()=>eg,VK_FORMAT_S8_UINT:()=>tF,VK_FORMAT_UNDEFINED:()=>eo,VK_FORMAT_X8_D24_UNORM_PACK32:()=>tU,read:()=>nd,write:()=>nm});var r=n("./node_modules/buffer/index.js").Buffer;let s=0,a=1,o=2,l=3,h=0,u=0,c=2,d=0,p=1,f=160,m=161,g=162,A=163,v=0,y=1,x=0,_=1,b=2,E=3,w=4,M=5,C=6,S=7,T=8,R=9,I=10,B=11,L=12,P=13,D=14,N=15,O=16,U=17,k=18,F=0,z=1,G=2,V=3,j=4,H=5,Q=6,W=7,q=8,X=9,K=10,Y=11,J=0,Z=1,$=2,ee=13,et=14,ei=15,en=128,er=64,es=32,ea=16,eo=0,el=1,eh=2,eu=3,ec=4,ed=5,ep=6,ef=7,em=8,eg=9,eA=10,ev=13,ey=14,ex=15,e_=16,eb=17,eE=20,ew=21,eM=22,eC=23,eS=24,eT=27,eR=28,eI=29,eB=30,eL=31,eP=34,eD=35,eN=36,eO=37,eU=38,ek=41,eF=42,ez=43,eG=44,eV=45,ej=48,eH=49,eQ=50,eW=58,eq=59,eX=62,eK=63,eY=64,eJ=65,eZ=68,e$=69,e0=70,e1=71,e2=74,e3=75,e4=76,e5=77,e6=78,e8=81,e7=82,e9=83,te=84,tt=85,ti=88,tn=89,tr=90,ts=91,ta=92,to=95,tl=96,th=97,tu=98,tc=99,td=100,tp=101,tf=102,tm=103,tg=104,tA=105,tv=106,ty=107,tx=108,t_=109,tb=110,tE=111,tw=112,tM=113,tC=114,tS=115,tT=116,tR=117,tI=118,tB=119,tL=120,tP=121,tD=122,tN=123,tO=124,tU=125,tk=126,tF=127,tz=128,tG=129,tV=130,tj=131,tH=132,tQ=133,tW=134,tq=135,tX=136,tK=137,tY=138,tJ=139,tZ=140,t$=141,t0=142,t1=143,t2=144,t3=145,t4=146,t5=147,t6=148,t8=149,t7=150,t9=151,ie=152,it=153,ii=154,ir=155,is=156,ia=157,io=158,il=159,ih=160,iu=161,ic=162,id=163,ip=164,im=165,ig=166,iA=167,iv=168,iy=169,ix=170,i_=171,ib=172,iE=173,iw=174,iM=175,iC=176,iS=177,iT=178,iR=179,iI=180,iB=181,iL=182,iP=183,iD=184,iN=0x3b9d2b67,iO=0x3b9d2b68,iU=0x3b9d2b69,ik=0x3b9d2b6a,iF=0x3b9d2b6b,iz=0x3b9d2b71,iG=0x3b9d2b72,iV=0x3b9d2b73,ij=0x3b9d2b74,iH=0x3b9d2b75,iQ=1000054e3,iW=0x3b9b9cf1,iq=0x3b9b9cf2,iX=0x3b9b9cf3,iK=0x3b9b9cf4,iY=0x3b9b9cf5,iJ=0x3b9b9cf6,iZ=0x3b9b9cf7,i$=1000066e3,i0=0x3b9bcbd1,i1=0x3b9bcbd2,i2=0x3b9bcbd3,i3=0x3b9bcbd4,i4=0x3b9bcbd5,i5=0x3b9bcbd6,i6=0x3b9bcbd7,i8=0x3b9bcbd8,i7=0x3b9bcbd9,i9=0x3b9bcbda,ne=0x3b9bcbdb,nt=0x3b9bcbdc,ni=0x3b9bcbdd,nn=100034e4,nr=0x3b9ffa21;class ns{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class na{constructor(e,i,n,r){this._dataView=new DataView(e.buffer,e.byteOffset+i,n),this._littleEndian=r,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian)+0x100000000*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){let n=this._offset,r=0;for(;this._dataView.getUint8(this._offset)!==i&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}let no=new Uint8Array([0]),nl=[171,75,84,88,32,50,48,187,13,10,26,10];function nh(e){return"undefined"!=typeof TextEncoder?new TextEncoder().encode(e):r.from(e)}function nu(e){return"undefined"!=typeof TextDecoder?new TextDecoder().decode(e):r.from(e).toString("utf8")}function nc(e){let i=0;for(let n of e)i+=n.byteLength;let n=new Uint8Array(i),r=0;for(let i of e)n.set(new Uint8Array(i),r),r+=i.byteLength;return n}function nd(e){let i=new Uint8Array(e.buffer,e.byteOffset,nl.length);if(i[0]!==nl[0]||i[1]!==nl[1]||i[2]!==nl[2]||i[3]!==nl[3]||i[4]!==nl[4]||i[5]!==nl[5]||i[6]!==nl[6]||i[7]!==nl[7]||i[8]!==nl[8]||i[9]!==nl[9]||i[10]!==nl[10]||i[11]!==nl[11])throw Error("Missing KTX 2.0 identifier.");let n=new ns,r=17*Uint32Array.BYTES_PER_ELEMENT,s=new na(e,nl.length,r,!0);n.vkFormat=s._nextUint32(),n.typeSize=s._nextUint32(),n.pixelWidth=s._nextUint32(),n.pixelHeight=s._nextUint32(),n.pixelDepth=s._nextUint32(),n.layerCount=s._nextUint32(),n.faceCount=s._nextUint32();let a=s._nextUint32();n.supercompressionScheme=s._nextUint32();let o=s._nextUint32(),l=s._nextUint32(),h=s._nextUint32(),u=s._nextUint32(),c=s._nextUint64(),d=s._nextUint64(),p=new na(e,nl.length+r,3*a*8,!0);for(let i=0;i<a;i++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});let f=new na(e,o,l,!0),m={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},g=(m.descriptorBlockSize/4-6)/4;for(let e=0;e<g;e++){let i={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&i.channelType?(i.sampleLower=f._nextInt32(),i.sampleUpper=f._nextInt32()):(i.sampleLower=f._nextUint32(),i.sampleUpper=f._nextUint32()),m.samples[e]=i}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(m);let A=new na(e,h,u,!0);for(;A._offset<u;){let e=A._nextUint32(),i=A._scan(e),r=nu(i),s=A._scan(e-i.byteLength);n.keyValue[r]=r.match(/^ktx/i)?nu(s):s,A._offset%4&&A._skip(4-A._offset%4)}if(d<=0)return n;let v=new na(e,c,d,!0),y=v._nextUint16(),x=v._nextUint16(),_=v._nextUint32(),b=v._nextUint32(),E=v._nextUint32(),w=v._nextUint32(),M=[];for(let e=0;e<a;e++)M.push({imageFlags:v._nextUint32(),rgbSliceByteOffset:v._nextUint32(),rgbSliceByteLength:v._nextUint32(),alphaSliceByteOffset:v._nextUint32(),alphaSliceByteLength:v._nextUint32()});let C=c+v._offset,S=C+_,T=S+b,R=T+E,I=new Uint8Array(e.buffer,e.byteOffset+C,_),B=new Uint8Array(e.buffer,e.byteOffset+S,b),L=new Uint8Array(e.buffer,e.byteOffset+T,E),P=new Uint8Array(e.buffer,e.byteOffset+R,w);return n.globalData={endpointCount:y,selectorCount:x,imageDescs:M,endpointsData:I,selectorsData:B,tablesData:L,extendedData:P},n}function np(){return(np=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let nf={keepWriter:!1};function nm(e,i={}){i=np({},nf,i);let n=new ArrayBuffer(0);if(e.globalData){let i=new ArrayBuffer(20+5*e.globalData.imageDescs.length*4),r=new DataView(i);r.setUint16(0,e.globalData.endpointCount,!0),r.setUint16(2,e.globalData.selectorCount,!0),r.setUint32(4,e.globalData.endpointsData.byteLength,!0),r.setUint32(8,e.globalData.selectorsData.byteLength,!0),r.setUint32(12,e.globalData.tablesData.byteLength,!0),r.setUint32(16,e.globalData.extendedData.byteLength,!0);for(let i=0;i<e.globalData.imageDescs.length;i++){let n=e.globalData.imageDescs[i];r.setUint32(20+5*i*4+0,n.imageFlags,!0),r.setUint32(20+5*i*4+4,n.rgbSliceByteOffset,!0),r.setUint32(20+5*i*4+8,n.rgbSliceByteLength,!0),r.setUint32(20+5*i*4+12,n.alphaSliceByteOffset,!0),r.setUint32(20+5*i*4+16,n.alphaSliceByteLength,!0)}n=nc([i,e.globalData.endpointsData,e.globalData.selectorsData,e.globalData.tablesData,e.globalData.extendedData])}let r=[],s=e.keyValue;for(let n in i.keepWriter||(s=np({},e.keyValue,{KTXwriter:"KTX-Parse v0.3.1"})),s){let e=s[n],i=nh(n),a="string"==typeof e?nh(e):e,o=i.byteLength+1+a.byteLength+1,l=o%4?4-o%4:0;r.push(nc([new Uint32Array([o]),i,no,a,no,new Uint8Array(l).fill(0)]))}let a=nc(r);if(1!==e.dataFormatDescriptor.length||0!==e.dataFormatDescriptor[0].descriptorType)throw Error("Only BASICFORMAT Data Format Descriptor output supported.");let o=e.dataFormatDescriptor[0],l=new ArrayBuffer(28+16*o.samples.length),h=new DataView(l),u=24+16*o.samples.length;if(h.setUint32(0,l.byteLength,!0),h.setUint16(4,o.vendorId,!0),h.setUint16(6,o.descriptorType,!0),h.setUint16(8,o.versionNumber,!0),h.setUint16(10,u,!0),h.setUint8(12,o.colorModel),h.setUint8(13,o.colorPrimaries),h.setUint8(14,o.transferFunction),h.setUint8(15,o.flags),!Array.isArray(o.texelBlockDimension))throw Error("texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.");h.setUint8(16,o.texelBlockDimension[0]),h.setUint8(17,o.texelBlockDimension[1]),h.setUint8(18,o.texelBlockDimension[2]),h.setUint8(19,o.texelBlockDimension[3]);for(let e=0;e<8;e++)h.setUint8(20+e,o.bytesPlane[e]);for(let e=0;e<o.samples.length;e++){let i=o.samples[e],n=28+16*e;if(i.channelID)throw Error("channelID has been renamed to channelType.");h.setUint16(n+0,i.bitOffset,!0),h.setUint8(n+2,i.bitLength),h.setUint8(n+3,i.channelType),h.setUint8(n+4,i.samplePosition[0]),h.setUint8(n+5,i.samplePosition[1]),h.setUint8(n+6,i.samplePosition[2]),h.setUint8(n+7,i.samplePosition[3]),64&i.channelType?(h.setInt32(n+8,i.sampleLower,!0),h.setInt32(n+12,i.sampleUpper,!0)):(h.setUint32(n+8,i.sampleLower,!0),h.setUint32(n+12,i.sampleUpper,!0))}let c=nl.length+68+3*e.levels.length*8,d=c+l.byteLength,p=n.byteLength>0?d+a.byteLength:0;p%8&&(p+=8-p%8);let f=[],m=new DataView(new ArrayBuffer(3*e.levels.length*8)),g=(p||d+a.byteLength)+n.byteLength;for(let i=0;i<e.levels.length;i++){let n=e.levels[i];f.push(n.levelData),m.setBigUint64(24*i+0,BigInt(g),!0),m.setBigUint64(24*i+8,BigInt(n.levelData.byteLength),!0),m.setBigUint64(24*i+16,BigInt(n.uncompressedByteLength),!0),g+=n.levelData.byteLength}let A=new ArrayBuffer(68),v=new DataView(A);return v.setUint32(0,e.vkFormat,!0),v.setUint32(4,e.typeSize,!0),v.setUint32(8,e.pixelWidth,!0),v.setUint32(12,e.pixelHeight,!0),v.setUint32(16,e.pixelDepth,!0),v.setUint32(20,e.layerCount,!0),v.setUint32(24,e.faceCount,!0),v.setUint32(28,e.levels.length,!0),v.setUint32(32,e.supercompressionScheme,!0),v.setUint32(36,c,!0),v.setUint32(40,l.byteLength,!0),v.setUint32(44,d,!0),v.setUint32(48,a.byteLength,!0),v.setBigUint64(52,BigInt(n.byteLength>0?p:0),!0),v.setBigUint64(60,BigInt(n.byteLength),!0),new Uint8Array(nc([new Uint8Array(nl).buffer,A,m.buffer,l,a,new ArrayBuffer(p>0?p-(d+a.byteLength):0),n,...f]))}},"./node_modules/three/examples/jsm/libs/zstddec.module.js":(e,i,n)=>{"use strict";let r,s,a;n.r(i),n.d(i,{ZSTDDecoder:()=>h});var o=n("./node_modules/buffer/index.js").Buffer;let l={env:{emscripten_notify_memory_growth:function(e){a=new Uint8Array(s.exports.memory.buffer)}}};class h{init(){return r||(r="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+u).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,l)).then(this._init):WebAssembly.instantiate(o.from(u,"base64"),l).then(this._init))}_init(e){s=e.instance,l.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!s)throw Error("ZSTDDecoder: Await .init() before decoding.");let n=e.byteLength,r=s.exports.malloc(n);a.set(e,r),i=i||Number(s.exports.ZSTD_findDecompressedSize(r,n));let o=s.exports.malloc(i),l=s.exports.ZSTD_decompress(o,i,r,n),h=a.slice(o,o+l);return s.exports.free(r),s.exports.free(o),h}}let u="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ"},"./node_modules/three/examples/jsm/lights/LightProbeGenerator.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{LightProbeGenerator:()=>s});var r=n("./node_modules/three/build/three.module.js");class s{static fromCubeTexture(e){let i=0,n=new r.Vector3,s=new r.Vector3,o=new r.Color,l=[0,0,0,0,0,0,0,0,0],h=new r.SphericalHarmonics3,u=h.coefficients;for(let h=0;h<6;h++){let c=e.image[h],d=c.width,p=c.height,f=document.createElement("canvas");f.width=d,f.height=p;let m=f.getContext("2d");m.drawImage(c,0,0,d,p);let g=m.getImageData(0,0,d,p),A=g.data,v=g.width,y=2/v;for(let c=0,d=A.length;c<d;c+=4){o.setRGB(A[c]/255,A[c+1]/255,A[c+2]/255),a(o,e.colorSpace);let d=c/4,p=-1+(d%v+.5)*y,f=1-(Math.floor(d/v)+.5)*y;switch(h){case 0:n.set(-1,f,-p);break;case 1:n.set(1,f,p);break;case 2:n.set(-p,1,-f);break;case 3:n.set(-p,-1,f);break;case 4:n.set(-p,f,1);break;case 5:n.set(p,f,-1)}let m=n.lengthSq(),g=4/(Math.sqrt(m)*m);i+=g,s.copy(n).normalize(),r.SphericalHarmonics3.getBasisAt(s,l);for(let e=0;e<9;e++)u[e].x+=l[e]*o.r*g,u[e].y+=l[e]*o.g*g,u[e].z+=l[e]*o.b*g}}let c=4*Math.PI/i;for(let e=0;e<9;e++)u[e].x*=c,u[e].y*=c,u[e].z*=c;return new r.LightProbe(h)}static fromCubeRenderTarget(e,i){let n=0,s=new r.Vector3,o=new r.Vector3,l=new r.Color,h=[0,0,0,0,0,0,0,0,0],u=new r.SphericalHarmonics3,c=u.coefficients,d=i.texture.type;for(let u=0;u<6;u++){let p;let f=i.width;p=d===r.HalfFloatType?new Uint16Array(f*f*4):new Uint8Array(f*f*4),e.readRenderTargetPixels(i,0,0,f,f,p,u);let m=2/f;for(let e=0,g=p.length;e<g;e+=4){let g,A,v;d===r.HalfFloatType?(g=r.DataUtils.fromHalfFloat(p[e]),A=r.DataUtils.fromHalfFloat(p[e+1]),v=r.DataUtils.fromHalfFloat(p[e+2])):(g=p[e]/255,A=p[e+1]/255,v=p[e+2]/255),l.setRGB(g,A,v),a(l,i.texture.colorSpace);let y=e/4,x=-1+(y%f+.5)*m,_=1-(Math.floor(y/f)+.5)*m;switch(u){case 0:s.set(1,_,-x);break;case 1:s.set(-1,_,x);break;case 2:s.set(x,1,-_);break;case 3:s.set(x,-1,_);break;case 4:s.set(x,_,1);break;case 5:s.set(-x,_,-1)}let b=s.lengthSq(),E=4/(Math.sqrt(b)*b);n+=E,o.copy(s).normalize(),r.SphericalHarmonics3.getBasisAt(o,h);for(let e=0;e<9;e++)c[e].x+=h[e]*l.r*E,c[e].y+=h[e]*l.g*E,c[e].z+=h[e]*l.b*E}}let p=4*Math.PI/n;for(let e=0;e<9;e++)c[e].x*=p,c[e].y*=p,c[e].z*=p;return new r.LightProbe(u)}}function a(e,i){switch(i){case r.SRGBColorSpace:e.convertSRGBToLinear();break;case r.LinearSRGBColorSpace:case r.NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.")}return e}},"./node_modules/three/examples/jsm/loaders/DRACOLoader.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{DRACOLoader:()=>a});var r=n("./node_modules/three/build/three.module.js");let s=new WeakMap;class a extends r.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,n,s){let a=new r.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,e=>{this.parse(e,i,s)},n,s)}parse(e,i,n=()=>{}){this.decodeDracoFile(e,i,null,null,r.SRGBColorSpace).catch(n)}decodeDracoFile(e,i,n,s,a=r.LinearSRGBColorSpace,o=()=>{}){let l={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:a};return this.decodeGeometry(e,l).then(i).catch(o)}decodeGeometry(e,i){let n;let r=JSON.stringify(i);if(s.has(e)){let i=s.get(e);if(i.key===r)return i.promise;if(0===e.byteLength)throw Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let a=this.workerNextTaskID++,o=e.byteLength,l=this._getWorker(a,o).then(r=>(n=r,new Promise((r,s)=>{n._callbacks[a]={resolve:r,reject:s},n.postMessage({type:"decode",id:a,taskConfig:i,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return l.catch(()=>!0).then(()=>{n&&a&&this._releaseTask(n,a)}),s.set(e,{key:r,promise:l}),l}_createGeometry(e){let i=new r.BufferGeometry;e.index&&i.setIndex(new r.BufferAttribute(e.index.array,1));for(let n=0;n<e.attributes.length;n++){let s=e.attributes[n],a=s.name,o=s.array,l=s.itemSize,h=new r.BufferAttribute(o,l);"color"===a&&(this._assignVertexColorSpace(h,s.vertexColorSpace),h.normalized=o instanceof Float32Array==!1),i.setAttribute(a,h)}return i}_assignVertexColorSpace(e,i){if(i!==r.SRGBColorSpace)return;let n=new r.Color;for(let i=0,r=e.count;i<r;i++)n.fromBufferAttribute(e,i).convertSRGBToLinear(),e.setXYZ(i,n.r,n.g,n.b)}_loadLibrary(e,i){let n=new r.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(i),n.setWithCredentials(this.withCredentials),new Promise((i,r)=>{n.load(e,i,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,i=[];return e?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(i=>{let n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let r=o.toString(),s=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(i){let n=i.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,i){return e._taskLoad>i._taskLoad?-1:1});let n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=i,n._taskLoad+=i,n})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function o(){let e,i;onmessage=function(n){let r=n.data;switch(r.type){case"init":e=r.decoderConfig,i=new Promise(function(i){e.onModuleLoaded=function(e){i({draco:e})},DracoDecoderModule(e)});break;case"decode":let s=r.buffer,a=r.taskConfig;i.then(e=>{let i=e.draco,n=new i.Decoder;try{let e=function(e,i,n,r){let s,a;let o=r.attributeIDs,l=r.attributeTypes,h=i.GetEncodedGeometryType(n);if(h===e.TRIANGULAR_MESH)s=new e.Mesh,a=i.DecodeArrayToMesh(n,n.byteLength,s);else if(h===e.POINT_CLOUD)s=new e.PointCloud,a=i.DecodeArrayToPointCloud(n,n.byteLength,s);else throw Error("THREE.DRACOLoader: Unexpected geometry type.");if(!a.ok()||0===s.ptr)throw Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());let u={index:null,attributes:[]};for(let n in o){let a,h;let c=self[l[n]];if(r.useUniqueIDs)h=o[n],a=i.GetAttributeByUniqueId(s,h);else{if(-1===(h=i.GetAttributeId(s,e[o[n]])))continue;a=i.GetAttribute(s,h)}let d=function(e,i,n,r,s,a){let o=a.num_components(),l=n.num_points()*o,h=l*s.BYTES_PER_ELEMENT,u=function(e,i){switch(i){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,s),c=e._malloc(h);i.GetAttributeDataArrayForAllPoints(n,a,u,h,c);let d=new s(e.HEAPF32.buffer,c,l).slice();return e._free(c),{name:r,array:d,itemSize:o}}(e,i,s,n,c,a);"color"===n&&(d.vertexColorSpace=r.vertexColorSpace),u.attributes.push(d)}return h===e.TRIANGULAR_MESH&&(u.index=function(e,i,n){let r=3*n.num_faces(),s=4*r,a=e._malloc(s);i.GetTrianglesUInt32Array(n,s,a);let o=new Uint32Array(e.HEAPF32.buffer,a,r).slice();return e._free(a),{array:o,itemSize:1}}(e,i,s)),e.destroy(s),u}(i,n,new Int8Array(s),a),o=e.attributes.map(e=>e.array.buffer);e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{i.destroy(n)}})}}}},"./node_modules/three/examples/jsm/loaders/GLTFLoader.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{GLTFLoader:()=>a});var r=n("./node_modules/three/build/three.module.js"),s=n("./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js");class a extends r.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new d(e)}),this.register(function(e){return new p(e)}),this.register(function(e){return new b(e)}),this.register(function(e){return new E(e)}),this.register(function(e){return new w(e)}),this.register(function(e){return new m(e)}),this.register(function(e){return new g(e)}),this.register(function(e){return new A(e)}),this.register(function(e){return new v(e)}),this.register(function(e){return new c(e)}),this.register(function(e){return new y(e)}),this.register(function(e){return new f(e)}),this.register(function(e){return new _(e)}),this.register(function(e){return new x(e)}),this.register(function(e){return new h(e)}),this.register(function(e){return new M(e)}),this.register(function(e){return new C(e)})}load(e,i,n,s){let a;let o=this;if(""!==this.resourcePath)a=this.resourcePath;else if(""!==this.path){let i=r.LoaderUtils.extractUrlBase(e);a=r.LoaderUtils.resolveURL(i,this.path)}else a=r.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);let l=function(i){s?s(i):console.error(i),o.manager.itemError(e),o.manager.itemEnd(e)},h=new r.FileLoader(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(n){try{o.parse(n,a,function(n){i(n),o.manager.itemEnd(e)},l)}catch(e){l(e)}},n,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,n,r){let s;let a={},o={},h=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer){if(h.decode(new Uint8Array(e,0,4))===S){try{a[l.KHR_BINARY_GLTF]=new R(e)}catch(e){r&&r(e);return}s=JSON.parse(a[l.KHR_BINARY_GLTF].content)}else s=JSON.parse(h.decode(e))}else s=e;if(void 0===s.asset||s.asset.version[0]<2){r&&r(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let c=new Y(s,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let i=this.pluginCallbacks[e](c);i.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[i.name]=i,a[i.name]=!0}if(s.extensionsUsed)for(let e=0;e<s.extensionsUsed.length;++e){let i=s.extensionsUsed[e],n=s.extensionsRequired||[];switch(i){case l.KHR_MATERIALS_UNLIT:a[i]=new u;break;case l.KHR_DRACO_MESH_COMPRESSION:a[i]=new I(s,this.dracoLoader);break;case l.KHR_TEXTURE_TRANSFORM:a[i]=new B;break;case l.KHR_MESH_QUANTIZATION:a[i]=new L;break;default:n.indexOf(i)>=0&&void 0===o[i]&&console.warn('THREE.GLTFLoader: Unknown extension "'+i+'".')}}c.setExtensions(a),c.setPlugins(o),c.parse(n,r)}parseAsync(e,i){let n=this;return new Promise(function(r,s){n.parse(e,i,r,s)})}}function o(){let e={};return{get:function(i){return e[i]},add:function(i,n){e[i]=n},remove:function(i){delete e[i]},removeAll:function(){e={}}}}let l={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class h{constructor(e){this.parser=e,this.name=l.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,i=this.parser.json.nodes||[];for(let n=0,r=i.length;n<r;n++){let r=i[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){let i;let n=this.parser,s="light:"+e,a=n.cache.get(s);if(a)return a;let o=n.json,l=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],h=new r.Color(0xffffff);void 0!==l.color&&h.setRGB(l.color[0],l.color[1],l.color[2],r.LinearSRGBColorSpace);let u=void 0!==l.range?l.range:0;switch(l.type){case"directional":(i=new r.DirectionalLight(h)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new r.PointLight(h)).distance=u;break;case"spot":(i=new r.SpotLight(h)).distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=void 0!==l.spot.innerConeAngle?l.spot.innerConeAngle:0,l.spot.outerConeAngle=void 0!==l.spot.outerConeAngle?l.spot.outerConeAngle:Math.PI/4,i.angle=l.spot.outerConeAngle,i.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return i.position.set(0,0,0),i.decay=2,W(i,l),void 0!==l.intensity&&(i.intensity=l.intensity),i.name=n.createUniqueName(l.name||"light_"+e),a=Promise.resolve(i),n.cache.add(s,a),a}getDependency(e,i){if("light"===e)return this._loadLight(i)}createNodeAttachment(e){let i=this,n=this.parser,r=n.json.nodes[e],s=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then(function(e){return n._getNodeRef(i.cache,s,e)})}}class u{constructor(){this.name=l.KHR_MATERIALS_UNLIT}getMaterialType(){return r.MeshBasicMaterial}extendParams(e,i,n){let s=[];e.color=new r.Color(1,1,1),e.opacity=1;let a=i.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){let i=a.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],r.LinearSRGBColorSpace),e.opacity=i[3]}void 0!==a.baseColorTexture&&s.push(n.assignTexture(e,"map",a.baseColorTexture,r.SRGBColorSpace))}return Promise.all(s)}}class c{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){let n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(i.emissiveIntensity=r),Promise.resolve()}}class d{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let a=[],o=s.extensions[this.name];if(void 0!==o.clearcoatFactor&&(i.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&a.push(n.assignTexture(i,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(i.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&a.push(n.assignTexture(i,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(a.push(n.assignTexture(i,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){let e=o.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new r.Vector2(e,e)}return Promise.all(a)}}class p{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_DISPERSION}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=n.extensions[this.name];return i.dispersion=void 0!==r.dispersion?r.dispersion:0,Promise.resolve()}}class f{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],a=r.extensions[this.name];return void 0!==a.iridescenceFactor&&(i.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&s.push(n.assignTexture(i,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(i.iridescenceIOR=a.iridescenceIor),void 0===i.iridescenceThicknessRange&&(i.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(i.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(i.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&s.push(n.assignTexture(i,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class m{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_SHEEN}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let a=[];i.sheenColor=new r.Color(0,0,0),i.sheenRoughness=0,i.sheen=1;let o=s.extensions[this.name];if(void 0!==o.sheenColorFactor){let e=o.sheenColorFactor;i.sheenColor.setRGB(e[0],e[1],e[2],r.LinearSRGBColorSpace)}return void 0!==o.sheenRoughnessFactor&&(i.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&a.push(n.assignTexture(i,"sheenColorMap",o.sheenColorTexture,r.SRGBColorSpace)),void 0!==o.sheenRoughnessTexture&&a.push(n.assignTexture(i,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(a)}}class g{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(i.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&s.push(n.assignTexture(i,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class A{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_VOLUME}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let a=[],o=s.extensions[this.name];i.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&a.push(n.assignTexture(i,"thicknessMap",o.thicknessTexture)),i.attenuationDistance=o.attenuationDistance||1/0;let l=o.attenuationColor||[1,1,1];return i.attenuationColor=new r.Color().setRGB(l[0],l[1],l[2],r.LinearSRGBColorSpace),Promise.all(a)}}class v{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_IOR}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=n.extensions[this.name];return i.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class y{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_SPECULAR}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let a=[],o=s.extensions[this.name];i.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&a.push(n.assignTexture(i,"specularIntensityMap",o.specularTexture));let l=o.specularColorFactor||[1,1,1];return i.specularColor=new r.Color().setRGB(l[0],l[1],l[2],r.LinearSRGBColorSpace),void 0!==o.specularColorTexture&&a.push(n.assignTexture(i,"specularColorMap",o.specularColorTexture,r.SRGBColorSpace)),Promise.all(a)}}class x{constructor(e){this.parser=e,this.name=l.EXT_MATERIALS_BUMP}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],a=r.extensions[this.name];return i.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&s.push(n.assignTexture(i,"bumpMap",a.bumpTexture)),Promise.all(s)}}class _{constructor(e){this.parser=e,this.name=l.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,i){let n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let s=[],a=r.extensions[this.name];return void 0!==a.anisotropyStrength&&(i.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(i.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&s.push(n.assignTexture(i,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class b{constructor(e){this.parser=e,this.name=l.KHR_TEXTURE_BASISU}loadTexture(e){let i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let s=r.extensions[this.name],a=i.options.ktx2Loader;if(!a){if(!(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return i.loadTextureImage(e,s.source,a)}}class E{constructor(e){this.parser=e,this.name=l.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let i=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[i])return null;let a=s.extensions[i],o=r.images[a.source],l=n.textureLoader;if(o.uri){let e=n.options.manager.getHandler(o.uri);null!==e&&(l=e)}return this.detectSupport().then(function(s){if(s)return n.loadTextureImage(e,a.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(1===i.height)}})),this.isSupported}}class w{constructor(e){this.parser=e,this.name=l.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let i=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[i])return null;let a=s.extensions[i],o=r.images[a.source],l=n.textureLoader;if(o.uri){let e=n.options.manager.getHandler(o.uri);null!==e&&(l=e)}return this.detectSupport().then(function(s){if(s)return n.loadTextureImage(e,a.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){e(1===i.height)}})),this.isSupported}}class M{constructor(e){this.name=l.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let i=this.parser.json,n=i.bufferViews[e];if(!n.extensions||!n.extensions[this.name])return null;{let e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(!(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return r.then(function(i){let n=e.byteOffset||0,r=e.byteLength||0,a=e.count,o=e.byteStride,l=new Uint8Array(i,n,r);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(a,o,l,e.mode,e.filter).then(function(e){return e.buffer}):s.ready.then(function(){let i=new ArrayBuffer(a*o);return s.decodeGltfBuffer(new Uint8Array(i),a,o,l,e.mode,e.filter),i})})}}}class C{constructor(e){this.name=l.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let i=this.parser.json,n=i.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;for(let e of i.meshes[n.mesh].primitives)if(e.mode!==O.TRIANGLES&&e.mode!==O.TRIANGLE_STRIP&&e.mode!==O.TRIANGLE_FAN&&void 0!==e.mode)return null;let s=n.extensions[this.name].attributes,a=[],o={};for(let e in s)a.push(this.parser.getDependency("accessor",s[e]).then(i=>(o[e]=i,o[e])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(e=>{let i=e.pop(),n=i.isGroup?i.children:[i],s=e[0].count,a=[];for(let e of n){let i=new r.Matrix4,n=new r.Vector3,l=new r.Quaternion,h=new r.Vector3(1,1,1),u=new r.InstancedMesh(e.geometry,e.material,s);for(let e=0;e<s;e++)o.TRANSLATION&&n.fromBufferAttribute(o.TRANSLATION,e),o.ROTATION&&l.fromBufferAttribute(o.ROTATION,e),o.SCALE&&h.fromBufferAttribute(o.SCALE,e),u.setMatrixAt(e,i.compose(n,l,h));for(let i in o)if("_COLOR_0"===i){let e=o[i];u.instanceColor=new r.InstancedBufferAttribute(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&e.geometry.setAttribute(i,o[i]);r.Object3D.prototype.copy.call(u,e),this.parser.assignFinalMaterial(u),a.push(u)}return i.isGroup?(i.clear(),i.add(...a),i):a[0]}))}}let S="glTF",T={JSON:0x4e4f534a,BIN:5130562};class R{constructor(e){this.name=l.KHR_BINARY_GLTF,this.content=null,this.body=null;let i=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==S)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-12,s=new DataView(e,12),a=0;for(;a<r;){let i=s.getUint32(a,!0);a+=4;let r=s.getUint32(a,!0);if(a+=4,r===T.JSON){let r=new Uint8Array(e,12+a,i);this.content=n.decode(r)}else if(r===T.BIN){let n=12+a;this.body=e.slice(n,n+i)}a+=i}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class I{constructor(e,i){if(!i)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=l.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){let n=this.json,s=this.dracoLoader,a=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,l={},h={},u={};for(let e in o)l[G[e]||e.toLowerCase()]=o[e];for(let i in e.attributes){let r=G[i]||i.toLowerCase();if(void 0!==o[i]){let s=n.accessors[e.attributes[i]],a=U[s.componentType];u[r]=a.name,h[r]=!0===s.normalized}}return i.getDependency("bufferView",a).then(function(e){return new Promise(function(i,n){s.decodeDracoFile(e,function(e){for(let i in e.attributes){let n=e.attributes[i],r=h[i];void 0!==r&&(n.normalized=r)}i(e)},l,u,r.LinearSRGBColorSpace,n)})})}}class B{constructor(){this.name=l.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(void 0===i.texCoord||i.texCoord===e.channel)&&void 0===i.offset&&void 0===i.rotation&&void 0===i.scale||(e=e.clone(),void 0!==i.texCoord&&(e.channel=i.texCoord),void 0!==i.offset&&e.offset.fromArray(i.offset),void 0!==i.rotation&&(e.rotation=i.rotation),void 0!==i.scale&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class L{constructor(){this.name=l.KHR_MESH_QUANTIZATION}}class P extends r.Interpolant{constructor(e,i,n,r){super(e,i,n,r)}copySampleValue_(e){let i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let e=0;e!==r;e++)i[e]=n[s+e];return i}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=2*o,h=3*o,u=r-i,c=(n-i)/u,d=c*c,p=d*c,f=e*h,m=f-h,g=-2*p+3*d,A=p-d,v=1-g,y=A-d+c;for(let e=0;e!==o;e++){let i=a[m+e+o],n=a[m+e+l]*u,r=a[f+e+o],h=a[f+e]*u;s[e]=v*i+y*n+g*r+A*h}return s}}let D=new r.Quaternion;class N extends P{interpolate_(e,i,n,r){let s=super.interpolate_(e,i,n,r);return D.fromArray(s).normalize().toArray(s),s}}let O={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},U={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},k={9728:r.NearestFilter,9729:r.LinearFilter,9984:r.NearestMipmapNearestFilter,9985:r.LinearMipmapNearestFilter,9986:r.NearestMipmapLinearFilter,9987:r.LinearMipmapLinearFilter},F={33071:r.ClampToEdgeWrapping,33648:r.MirroredRepeatWrapping,10497:r.RepeatWrapping},z={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},G={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},V={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},j={CUBICSPLINE:void 0,LINEAR:r.InterpolateLinear,STEP:r.InterpolateDiscrete},H={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Q(e,i,n){for(let r in n.extensions)void 0===e[r]&&(i.userData.gltfExtensions=i.userData.gltfExtensions||{},i.userData.gltfExtensions[r]=n.extensions[r])}function W(e,i){void 0!==i.extras&&("object"==typeof i.extras?Object.assign(e.userData,i.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+i.extras))}function q(e){let i="",n=Object.keys(e).sort();for(let r=0,s=n.length;r<s;r++)i+=n[r]+":"+e[n[r]]+";";return i}function X(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let K=new r.Matrix4;class Y{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new o,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,a=-1;"undefined"!=typeof navigator&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),a=(s=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||s&&a<98?this.textureLoader=new r.TextureLoader(this.options.manager):this.textureLoader=new r.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new r.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){let n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){let a={scene:i[0][r.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:r.asset,parser:n,userData:{}};return Q(s,a,r),W(a,r),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){for(let e of a.scenes)e.updateMatrixWorld();e(a)})}).catch(i)}_markDefs(){let e=this.json.nodes||[],i=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=i.length;n<r;n++){let r=i[n].joints;for(let i=0,n=r.length;i<n;i++)e[r[i]].isBone=!0}for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,i){void 0!==i&&(void 0===e.refs[i]&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,n){if(e.refs[i]<=1)return n;let r=n.clone(),s=(e,i)=>{let n=this.associations.get(e);for(let[r,a]of(null!=n&&this.associations.set(i,n),e.children.entries()))s(a,i.children[r])};return s(n,r),r.name+="_instance_"+e.uses[i]++,r}_invokeOne(e){let i=Object.values(this.plugins);i.push(this);for(let n=0;n<i.length;n++){let r=e(i[n]);if(r)return r}return null}_invokeAll(e){let i=Object.values(this.plugins);i.unshift(this);let n=[];for(let r=0;r<i.length;r++){let s=e(i[r]);s&&n.push(s)}return n}getDependency(e,i){let n=e+":"+i,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(i);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(i)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(i)});break;case"accessor":r=this.loadAccessor(i);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(i)});break;case"buffer":r=this.loadBuffer(i);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(i)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(i)});break;case"skin":r=this.loadSkin(i);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(i)});break;case"camera":r=this.loadCamera(i);break;default:if(!(r=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,i)})))throw Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let i=this.cache.get(e);if(!i){let n=this;i=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(i,r){return n.getDependency(e,r)})),this.cache.add(e,i)}return i}loadBuffer(e){let i=this.json.buffers[e],n=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(void 0===i.uri&&0===e)return Promise.resolve(this.extensions[l.KHR_BINARY_GLTF].body);let s=this.options;return new Promise(function(e,a){n.load(r.LoaderUtils.resolveURL(i.uri,s.path),e,void 0,function(){a(Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){let i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(e){let n=i.byteLength||0,r=i.byteOffset||0;return e.slice(r,r+n)})}loadAccessor(e){let i=this,n=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse){let e=z[s.type],i=U[s.componentType],n=!0===s.normalized,a=new i(s.count*e);return Promise.resolve(new r.BufferAttribute(a,e,n))}let a=[];return void 0!==s.bufferView?a.push(this.getDependency("bufferView",s.bufferView)):a.push(null),void 0!==s.sparse&&(a.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(a).then(function(e){let a,o;let l=e[0],h=z[s.type],u=U[s.componentType],c=u.BYTES_PER_ELEMENT,d=c*h,p=s.byteOffset||0,f=void 0!==s.bufferView?n.bufferViews[s.bufferView].byteStride:void 0,m=!0===s.normalized;if(f&&f!==d){let e=Math.floor(p/f),n="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+e+":"+s.count,d=i.cache.get(n);d||(a=new u(l,e*f,s.count*f/c),d=new r.InterleavedBuffer(a,f/c),i.cache.add(n,d)),o=new r.InterleavedBufferAttribute(d,h,p%f/c,m)}else a=null===l?new u(s.count*h):new u(l,p,s.count*h),o=new r.BufferAttribute(a,h,m);if(void 0!==s.sparse){let i=z.SCALAR,n=U[s.sparse.indices.componentType],a=s.sparse.indices.byteOffset||0,c=s.sparse.values.byteOffset||0,d=new n(e[1],a,s.sparse.count*i),p=new u(e[2],c,s.sparse.count*h);null!==l&&(o=new r.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(let e=0,i=d.length;e<i;e++){let i=d[e];if(o.setX(i,p[e*h]),h>=2&&o.setY(i,p[e*h+1]),h>=3&&o.setZ(i,p[e*h+2]),h>=4&&o.setW(i,p[e*h+3]),h>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})}loadTexture(e){let i=this.json,n=this.options,r=i.textures[e].source,s=i.images[r],a=this.textureLoader;if(s.uri){let e=n.manager.getHandler(s.uri);null!==e&&(a=e)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,i,n){let s=this,a=this.json,o=a.textures[e],l=a.images[i],h=(l.uri||l.bufferView)+":"+o.sampler;if(this.textureCache[h])return this.textureCache[h];let u=this.loadImageSource(i,n).then(function(i){i.flipY=!1,i.name=o.name||l.name||"",""===i.name&&"string"==typeof l.uri&&!1===l.uri.startsWith("data:image/")&&(i.name=l.uri);let n=(a.samplers||{})[o.sampler]||{};return i.magFilter=k[n.magFilter]||r.LinearFilter,i.minFilter=k[n.minFilter]||r.LinearMipmapLinearFilter,i.wrapS=F[n.wrapS]||r.RepeatWrapping,i.wrapT=F[n.wrapT]||r.RepeatWrapping,s.associations.set(i,{textures:e}),i}).catch(function(){return null});return this.textureCache[h]=u,u}loadImageSource(e,i){let n=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let a=n.images[e],o=self.URL||self.webkitURL,l=a.uri||"",h=!1;if(void 0!==a.bufferView)l=this.getDependency("bufferView",a.bufferView).then(function(e){h=!0;let i=new Blob([e],{type:a.mimeType});return l=o.createObjectURL(i)});else if(void 0===a.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let u=Promise.resolve(l).then(function(e){return new Promise(function(n,a){let o=n;!0===i.isImageBitmapLoader&&(o=function(e){let i=new r.Texture(e);i.needsUpdate=!0,n(i)}),i.load(r.LoaderUtils.resolveURL(e,s.path),o,void 0,a)})}).then(function(e){var i;return!0===h&&o.revokeObjectURL(l),e.userData.mimeType=a.mimeType||((i=a.uri).search(/\.jpe?g($|\?)/i)>0||0===i.search(/^data\:image\/jpeg/)?"image/jpeg":i.search(/\.webp($|\?)/i)>0||0===i.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e});return this.sourceCache[e]=u,u}assignTexture(e,i,n,r){let s=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((a=a.clone()).channel=n.texCoord),s.extensions[l.KHR_TEXTURE_TRANSFORM]){let e=void 0!==n.extensions?n.extensions[l.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let i=s.associations.get(a);a=s.extensions[l.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),s.associations.set(a,i)}}return void 0!==r&&(a.colorSpace=r),e[i]=a,a})}assignFinalMaterial(e){let i=e.geometry,n=e.material,s=void 0===i.attributes.tangent,a=void 0!==i.attributes.color,o=void 0===i.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+n.uuid,i=this.cache.get(e);i||(i=new r.PointsMaterial,r.Material.prototype.copy.call(i,n),i.color.copy(n.color),i.map=n.map,i.sizeAttenuation=!1,this.cache.add(e,i)),n=i}else if(e.isLine){let e="LineBasicMaterial:"+n.uuid,i=this.cache.get(e);i||(i=new r.LineBasicMaterial,r.Material.prototype.copy.call(i,n),i.color.copy(n.color),i.map=n.map,this.cache.add(e,i)),n=i}if(s||a||o){let e="ClonedMaterial:"+n.uuid+":";s&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let i=this.cache.get(e);i||(i=n.clone(),a&&(i.vertexColors=!0),o&&(i.flatShading=!0),s&&(i.normalScale&&(i.normalScale.y*=-1),i.clearcoatNormalScale&&(i.clearcoatNormalScale.y*=-1)),this.cache.add(e,i),this.associations.set(i,this.associations.get(n))),n=i}e.material=n}getMaterialType(){return r.MeshStandardMaterial}loadMaterial(e){let i;let n=this,s=this.json,a=this.extensions,o=s.materials[e],h={},u=o.extensions||{},c=[];if(u[l.KHR_MATERIALS_UNLIT]){let e=a[l.KHR_MATERIALS_UNLIT];i=e.getMaterialType(),c.push(e.extendParams(h,o,n))}else{let s=o.pbrMetallicRoughness||{};if(h.color=new r.Color(1,1,1),h.opacity=1,Array.isArray(s.baseColorFactor)){let e=s.baseColorFactor;h.color.setRGB(e[0],e[1],e[2],r.LinearSRGBColorSpace),h.opacity=e[3]}void 0!==s.baseColorTexture&&c.push(n.assignTexture(h,"map",s.baseColorTexture,r.SRGBColorSpace)),h.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,h.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(c.push(n.assignTexture(h,"metalnessMap",s.metallicRoughnessTexture)),c.push(n.assignTexture(h,"roughnessMap",s.metallicRoughnessTexture))),i=this._invokeOne(function(i){return i.getMaterialType&&i.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(i){return i.extendMaterialParams&&i.extendMaterialParams(e,h)})))}!0===o.doubleSided&&(h.side=r.DoubleSide);let d=o.alphaMode||H.OPAQUE;if(d===H.BLEND?(h.transparent=!0,h.depthWrite=!1):(h.transparent=!1,d===H.MASK&&(h.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&i!==r.MeshBasicMaterial&&(c.push(n.assignTexture(h,"normalMap",o.normalTexture)),h.normalScale=new r.Vector2(1,1),void 0!==o.normalTexture.scale)){let e=o.normalTexture.scale;h.normalScale.set(e,e)}if(void 0!==o.occlusionTexture&&i!==r.MeshBasicMaterial&&(c.push(n.assignTexture(h,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(h.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&i!==r.MeshBasicMaterial){let e=o.emissiveFactor;h.emissive=new r.Color().setRGB(e[0],e[1],e[2],r.LinearSRGBColorSpace)}return void 0!==o.emissiveTexture&&i!==r.MeshBasicMaterial&&c.push(n.assignTexture(h,"emissiveMap",o.emissiveTexture,r.SRGBColorSpace)),Promise.all(c).then(function(){let r=new i(h);return o.name&&(r.name=o.name),W(r,o),n.associations.set(r,{materials:e}),o.extensions&&Q(a,r,o),r})}createUniqueName(e){let i=r.PropertyBinding.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){let i=this,n=this.extensions,s=this.primitiveCache,a=[];for(let o=0,h=e.length;o<h;o++){let h=e[o],u=function(e){let i;let n=e.extensions&&e.extensions[l.KHR_DRACO_MESH_COMPRESSION];if(i=n?"draco:"+n.bufferView+":"+n.indices+":"+q(n.attributes):e.indices+":"+q(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,r=e.targets.length;n<r;n++)i+=":"+q(e.targets[n]);return i}(h),c=s[u];if(c)a.push(c.promise);else{let e;e=h.extensions&&h.extensions[l.KHR_DRACO_MESH_COMPRESSION]?function(e){return n[l.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then(function(n){return J(n,e,i)})}(h):J(new r.BufferGeometry,h,i),s[u]={primitive:h,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){let i=this,n=this.json,a=this.extensions,o=n.meshes[e],l=o.primitives,h=[];for(let e=0,i=l.length;e<i;e++){var u;let i=void 0===l[e].material?(void 0===(u=this.cache).DefaultMaterial&&(u.DefaultMaterial=new r.MeshStandardMaterial({color:0xffffff,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.FrontSide})),u.DefaultMaterial):this.getDependency("material",l[e].material);h.push(i)}return h.push(i.loadGeometries(l)),Promise.all(h).then(function(n){let h=n.slice(0,n.length-1),u=n[n.length-1],c=[];for(let n=0,d=u.length;n<d;n++){let d;let p=u[n],f=l[n],m=h[n];if(f.mode===O.TRIANGLES||f.mode===O.TRIANGLE_STRIP||f.mode===O.TRIANGLE_FAN||void 0===f.mode)!0===(d=!0===o.isSkinnedMesh?new r.SkinnedMesh(p,m):new r.Mesh(p,m)).isSkinnedMesh&&d.normalizeSkinWeights(),f.mode===O.TRIANGLE_STRIP?d.geometry=(0,s.toTrianglesDrawMode)(d.geometry,r.TriangleStripDrawMode):f.mode===O.TRIANGLE_FAN&&(d.geometry=(0,s.toTrianglesDrawMode)(d.geometry,r.TriangleFanDrawMode));else if(f.mode===O.LINES)d=new r.LineSegments(p,m);else if(f.mode===O.LINE_STRIP)d=new r.Line(p,m);else if(f.mode===O.LINE_LOOP)d=new r.LineLoop(p,m);else if(f.mode===O.POINTS)d=new r.Points(p,m);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);Object.keys(d.geometry.morphAttributes).length>0&&function(e,i){if(e.updateMorphTargets(),void 0!==i.weights)for(let n=0,r=i.weights.length;n<r;n++)e.morphTargetInfluences[n]=i.weights[n];if(i.extras&&Array.isArray(i.extras.targetNames)){let n=i.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(d,o),d.name=i.createUniqueName(o.name||"mesh_"+e),W(d,o),f.extensions&&Q(a,d,f),i.assignFinalMaterial(d),c.push(d)}for(let n=0,r=c.length;n<r;n++)i.associations.set(c[n],{meshes:e,primitives:n});if(1===c.length)return o.extensions&&Q(a,c[0],o),c[0];let d=new r.Group;o.extensions&&Q(a,d,o),i.associations.set(d,{meshes:e});for(let e=0,i=c.length;e<i;e++)d.add(c[e]);return d})}loadCamera(e){let i;let n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===n.type?i=new r.PerspectiveCamera(r.MathUtils.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===n.type&&(i=new r.OrthographicCamera(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(i.name=this.createUniqueName(n.name)),W(i,n),Promise.resolve(i)}loadSkin(e){let i=this.json.skins[e],n=[];for(let e=0,r=i.joints.length;e<r;e++)n.push(this._loadNodeShallow(i.joints[e]));return void 0!==i.inverseBindMatrices?n.push(this.getDependency("accessor",i.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){let n=e.pop(),s=[],a=[];for(let o=0,l=e.length;o<l;o++){let l=e[o];if(l){s.push(l);let e=new r.Matrix4;null!==n&&e.fromArray(n.array,16*o),a.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[o])}return new r.Skeleton(s,a)})}loadAnimation(e){let i=this.json,n=this,s=i.animations[e],a=s.name?s.name:"animation_"+e,o=[],l=[],h=[],u=[],c=[];for(let e=0,i=s.channels.length;e<i;e++){let i=s.channels[e],n=s.samplers[i.sampler],r=i.target,a=r.node,d=void 0!==s.parameters?s.parameters[n.input]:n.input,p=void 0!==s.parameters?s.parameters[n.output]:n.output;void 0!==r.node&&(o.push(this.getDependency("node",a)),l.push(this.getDependency("accessor",d)),h.push(this.getDependency("accessor",p)),u.push(n),c.push(r))}return Promise.all([Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(u),Promise.all(c)]).then(function(e){let i=e[0],s=e[1],o=e[2],l=e[3],h=e[4],u=[];for(let e=0,r=i.length;e<r;e++){let r=i[e],a=s[e],c=o[e],d=l[e],p=h[e];if(void 0===r)continue;r.updateMatrix&&r.updateMatrix();let f=n._createAnimationTracks(r,a,c,d,p);if(f)for(let e=0;e<f.length;e++)u.push(f[e])}return new r.AnimationClip(a,void 0,u)})}createNodeMesh(e){let i=this.json,n=this,r=i.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){let i=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&i.traverse(function(e){if(e.isMesh)for(let i=0,n=r.weights.length;i<n;i++)e.morphTargetInfluences[i]=r.weights[i]}),i})}loadNode(e){let i=this.json.nodes[e],n=this._loadNodeShallow(e),r=[],s=i.children||[];for(let e=0,i=s.length;e<i;e++)r.push(this.getDependency("node",s[e]));let a=void 0===i.skin?Promise.resolve(null):this.getDependency("skin",i.skin);return Promise.all([n,Promise.all(r),a]).then(function(e){let i=e[0],n=e[1],r=e[2];null!==r&&i.traverse(function(e){e.isSkinnedMesh&&e.bind(r,K)});for(let e=0,r=n.length;e<r;e++)i.add(n[e]);return i})}_loadNodeShallow(e){let i=this.json,n=this.extensions,s=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let a=i.nodes[e],o=a.name?s.createUniqueName(a.name):"",l=[],h=s._invokeOne(function(i){return i.createNodeMesh&&i.createNodeMesh(e)});return h&&l.push(h),void 0!==a.camera&&l.push(s.getDependency("camera",a.camera).then(function(e){return s._getNodeRef(s.cameraCache,a.camera,e)})),s._invokeAll(function(i){return i.createNodeAttachment&&i.createNodeAttachment(e)}).forEach(function(e){l.push(e)}),this.nodeCache[e]=Promise.all(l).then(function(i){let l;if((l=!0===a.isBone?new r.Bone:i.length>1?new r.Group:1===i.length?i[0]:new r.Object3D)!==i[0])for(let e=0,n=i.length;e<n;e++)l.add(i[e]);if(a.name&&(l.userData.name=a.name,l.name=o),W(l,a),a.extensions&&Q(n,l,a),void 0!==a.matrix){let e=new r.Matrix4;e.fromArray(a.matrix),l.applyMatrix4(e)}else void 0!==a.translation&&l.position.fromArray(a.translation),void 0!==a.rotation&&l.quaternion.fromArray(a.rotation),void 0!==a.scale&&l.scale.fromArray(a.scale);return s.associations.has(l)||s.associations.set(l,{}),s.associations.get(l).nodes=e,l}),this.nodeCache[e]}loadScene(e){let i=this.extensions,n=this.json.scenes[e],s=this,a=new r.Group;n.name&&(a.name=s.createUniqueName(n.name)),W(a,n),n.extensions&&Q(i,a,n);let o=n.nodes||[],l=[];for(let e=0,i=o.length;e<i;e++)l.push(s.getDependency("node",o[e]));return Promise.all(l).then(function(e){for(let i=0,n=e.length;i<n;i++)a.add(e[i]);return s.associations=(e=>{let i=new Map;for(let[e,n]of s.associations)(e instanceof r.Material||e instanceof r.Texture)&&i.set(e,n);return e.traverse(e=>{let n=s.associations.get(e);null!=n&&i.set(e,n)}),i})(a),a})}_createAnimationTracks(e,i,n,s,a){let o;let l=[],h=e.name?e.name:e.uuid,u=[];switch(V[a.path]===V.weights?e.traverse(function(e){e.morphTargetInfluences&&u.push(e.name?e.name:e.uuid)}):u.push(h),V[a.path]){case V.weights:o=r.NumberKeyframeTrack;break;case V.rotation:o=r.QuaternionKeyframeTrack;break;case V.position:case V.scale:o=r.VectorKeyframeTrack;break;default:o=1===n.itemSize?r.NumberKeyframeTrack:r.VectorKeyframeTrack}let c=void 0!==s.interpolation?j[s.interpolation]:r.InterpolateLinear,d=this._getArrayFromAccessor(n);for(let e=0,n=u.length;e<n;e++){let n=new o(u[e]+"."+V[a.path],i.array,d,c);"CUBICSPLINE"===s.interpolation&&this._createCubicSplineTrackInterpolant(n),l.push(n)}return l}_getArrayFromAccessor(e){let i=e.array;if(e.normalized){let e=X(i.constructor),n=new Float32Array(i.length);for(let r=0,s=i.length;r<s;r++)n[r]=i[r]*e;i=n}return i}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof r.QuaternionKeyframeTrack?N:P)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function J(e,i,n){let s=i.attributes,a=[];for(let i in s){let r=G[i]||i.toLowerCase();r in e.attributes||a.push(function(i,r){return n.getDependency("accessor",i).then(function(i){e.setAttribute(r,i)})}(s[i],r))}if(void 0!==i.indices&&!e.index){let r=n.getDependency("accessor",i.indices).then(function(i){e.setIndex(i)});a.push(r)}return r.ColorManagement.workingColorSpace!==r.LinearSRGBColorSpace&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${r.ColorManagement.workingColorSpace}" not supported.`),W(e,i),function(e,i,n){let s=i.attributes,a=new r.Box3;if(void 0===s.POSITION)return;{let e=n.json.accessors[s.POSITION],i=e.min,o=e.max;if(void 0!==i&&void 0!==o){if(a.set(new r.Vector3(i[0],i[1],i[2]),new r.Vector3(o[0],o[1],o[2])),e.normalized){let i=X(U[e.componentType]);a.min.multiplyScalar(i),a.max.multiplyScalar(i)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let o=i.targets;if(void 0!==o){let e=new r.Vector3,i=new r.Vector3;for(let r=0,s=o.length;r<s;r++){let s=o[r];if(void 0!==s.POSITION){let r=n.json.accessors[s.POSITION],a=r.min,o=r.max;if(void 0!==a&&void 0!==o){if(i.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),i.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),i.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),r.normalized){let e=X(U[r.componentType]);i.multiplyScalar(e)}e.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;let l=new r.Sphere;a.getCenter(l.center),l.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=l}(e,i,n),Promise.all(a).then(function(){return void 0!==i.targets?function(e,i,n){let r=!1,s=!1,a=!1;for(let e=0,n=i.length;e<n;e++){let n=i[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(s=!0),void 0!==n.COLOR_0&&(a=!0),r&&s&&a)break}if(!r&&!s&&!a)return Promise.resolve(e);let o=[],l=[],h=[];for(let u=0,c=i.length;u<c;u++){let c=i[u];if(r){let i=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;o.push(i)}if(s){let i=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;l.push(i)}if(a){let i=void 0!==c.COLOR_0?n.getDependency("accessor",c.COLOR_0):e.attributes.color;h.push(i)}}return Promise.all([Promise.all(o),Promise.all(l),Promise.all(h)]).then(function(i){let n=i[0],o=i[1],l=i[2];return r&&(e.morphAttributes.position=n),s&&(e.morphAttributes.normal=o),a&&(e.morphAttributes.color=l),e.morphTargetsRelative=!0,e})}(e,i.targets,n):e})}},"./node_modules/three/examples/jsm/loaders/KTX2Loader.js":(e,i,n)=>{"use strict";let r;n.r(i),n.d(i,{KTX2Loader:()=>c});var s=n("./node_modules/three/build/three.module.js"),a=n("./node_modules/three/examples/jsm/utils/WorkerPool.js"),o=n("./node_modules/three/examples/jsm/libs/ktx-parse.module.js"),l=n("./node_modules/three/examples/jsm/libs/zstddec.module.js");let h=new WeakMap,u=0;class c extends s.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new a.WorkerPool,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){let e=new s.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);let i=e.loadAsync("basis_transcoder.js"),n=new s.FileLoader(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);let r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,r]).then(([e,i])=>{let n=c.BasisWorker.toString(),r=["/* constants */","let _EngineFormat = "+JSON.stringify(c.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(c.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(c.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r])),this.transcoderBinary=i,this.workerPool.setWorkerCreator(()=>{let e=new Worker(this.workerSourceURL),i=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:i},[i]),e})}),u>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),u++}return this.transcoderPending}load(e,i,n,r){if(null===this.workerConfig)throw Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let a=new s.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials),a.load(e,e=>{if(h.has(e))return h.get(e).promise.then(i).catch(r);this._createTexture(e).then(e=>i?i(e):null).catch(r)},n,r)}_createTextureFrom(e,i){let n;let{faces:r,width:a,height:l,format:h,type:u,error:c,dfdFlags:d}=e;if("error"===u)return Promise.reject(c);if(6===i.faceCount)n=new s.CompressedCubeTexture(r,h,s.UnsignedByteType);else{let e=r[0].mipmaps;n=i.layerCount>1?new s.CompressedArrayTexture(e,a,l,i.layerCount,h,s.UnsignedByteType):new s.CompressedTexture(e,a,l,h,s.UnsignedByteType)}return n.minFilter=1===r[0].mipmaps.length?s.LinearFilter:s.LinearMipmapLinearFilter,n.magFilter=s.LinearFilter,n.generateMipmaps=!1,n.needsUpdate=!0,n.colorSpace=g(i),n.premultiplyAlpha=!!(d&o.KHR_DF_FLAG_ALPHA_PREMULTIPLIED),n}async _createTexture(e,i={}){let n=(0,o.read)(new Uint8Array(e));if(n.vkFormat!==o.VK_FORMAT_UNDEFINED)return m(n);let r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e])).then(e=>this._createTextureFrom(e.data,n));return h.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),u--,this}}c.BasisFormat={ETC1S:0,UASTC_4x4:1},c.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},c.EngineFormat={RGBAFormat:s.RGBAFormat,RGBA_ASTC_4x4_Format:s.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:s.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:s.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:s.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:s.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:s.RGB_ETC1_Format,RGB_ETC2_Format:s.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:s.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:s.RGBA_S3TC_DXT1_Format},c.BasisWorker=function(){let e,i,n;let r=_EngineFormat,s=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(o){let c=o.data;switch(c.type){case"init":var d;e=c.config,d=c.transcoderBinary,i=new Promise(e=>{BASIS(n={wasmBinary:d,onRuntimeInitialized:e})}).then(()=>{n.initializeBasis(),void 0===n.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":i.then(()=>{try{let{faces:i,buffers:o,width:d,height:p,hasAlpha:f,format:m,dfdFlags:g}=function(i){let o=new n.KTX2File(new Uint8Array(i));function c(){o.close(),o.delete()}if(!o.isValid())throw c(),Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let d=o.isUASTC()?a.UASTC_4x4:a.ETC1S,p=o.getWidth(),f=o.getHeight(),m=o.getLayers()||1,g=o.getLevels(),A=o.getFaces(),v=o.getHasAlpha(),y=o.getDFDFlags(),{transcoderFormat:x,engineFormat:_}=function(i,n,o,c){let d,p;let f=i===a.ETC1S?l:h;for(let r=0;r<f.length;r++){let s=f[r];if(e[s.if]&&s.basisFormat.includes(i)&&(!c||!(s.transcoderFormat.length<2))&&(!s.needsPowerOfTwo||u(n)&&u(o)))return{transcoderFormat:d=s.transcoderFormat[+!!c],engineFormat:s.engineFormat[+!!c]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:d=s.RGBA32,engineFormat:r.RGBAFormat}}(d,p,f,v);if(!p||!f||!g)throw c(),Error("THREE.KTX2Loader:	Invalid texture");if(!o.startTranscoding())throw c(),Error("THREE.KTX2Loader: .startTranscoding failed");let b=[],E=[];for(let e=0;e<A;e++){let i=[];for(let n=0;n<g;n++){let r,s;let a=[];for(let i=0;i<m;i++){let l=o.getImageLevelInfo(n,i,e);0===e&&0===n&&0===i&&(l.origWidth%4!=0||l.origHeight%4!=0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),g>1?(r=l.origWidth,s=l.origHeight):(r=l.width,s=l.height);let h=new Uint8Array(o.getImageTranscodedSizeInBytes(n,i,0,x));if(!o.transcodeImage(h,n,i,e,x,0,-1,-1))throw c(),Error("THREE.KTX2Loader: .transcodeImage failed.");a.push(h)}let l=function(e){if(1===e.length)return e[0];let i=0;for(let n=0;n<e.length;n++)i+=e[n].byteLength;let n=new Uint8Array(i),r=0;for(let i=0;i<e.length;i++){let s=e[i];n.set(s,r),r+=s.byteLength}return n}(a);i.push({data:l,width:r,height:s}),E.push(l.buffer)}b.push({mipmaps:i,width:p,height:f,format:_})}return c(),{faces:b,buffers:E,width:p,height:f,hasAlpha:v,format:_,dfdFlags:y}}(c.buffer);self.postMessage({type:"transcode",id:c.id,faces:i,width:d,height:p,hasAlpha:f,format:m,dfdFlags:g},o)}catch(e){console.error(e),self.postMessage({type:"error",id:c.id,error:e.message})}})}});let o=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[r.RGBA_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=o.sort(function(e,i){return e.priorityETC1S-i.priorityETC1S}),h=o.sort(function(e,i){return e.priorityUASTC-i.priorityUASTC});function u(e){return e<=2||(e&e-1)==0&&0!==e}};let d=new Set([s.RGBAFormat,s.RGFormat,s.RedFormat]),p={[o.VK_FORMAT_R32G32B32A32_SFLOAT]:s.RGBAFormat,[o.VK_FORMAT_R16G16B16A16_SFLOAT]:s.RGBAFormat,[o.VK_FORMAT_R8G8B8A8_UNORM]:s.RGBAFormat,[o.VK_FORMAT_R8G8B8A8_SRGB]:s.RGBAFormat,[o.VK_FORMAT_R32G32_SFLOAT]:s.RGFormat,[o.VK_FORMAT_R16G16_SFLOAT]:s.RGFormat,[o.VK_FORMAT_R8G8_UNORM]:s.RGFormat,[o.VK_FORMAT_R8G8_SRGB]:s.RGFormat,[o.VK_FORMAT_R32_SFLOAT]:s.RedFormat,[o.VK_FORMAT_R16_SFLOAT]:s.RedFormat,[o.VK_FORMAT_R8_SRGB]:s.RedFormat,[o.VK_FORMAT_R8_UNORM]:s.RedFormat,[o.VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:s.RGBA_ASTC_6x6_Format,[o.VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:s.RGBA_ASTC_6x6_Format},f={[o.VK_FORMAT_R32G32B32A32_SFLOAT]:s.FloatType,[o.VK_FORMAT_R16G16B16A16_SFLOAT]:s.HalfFloatType,[o.VK_FORMAT_R8G8B8A8_UNORM]:s.UnsignedByteType,[o.VK_FORMAT_R8G8B8A8_SRGB]:s.UnsignedByteType,[o.VK_FORMAT_R32G32_SFLOAT]:s.FloatType,[o.VK_FORMAT_R16G16_SFLOAT]:s.HalfFloatType,[o.VK_FORMAT_R8G8_UNORM]:s.UnsignedByteType,[o.VK_FORMAT_R8G8_SRGB]:s.UnsignedByteType,[o.VK_FORMAT_R32_SFLOAT]:s.FloatType,[o.VK_FORMAT_R16_SFLOAT]:s.HalfFloatType,[o.VK_FORMAT_R8_SRGB]:s.UnsignedByteType,[o.VK_FORMAT_R8_UNORM]:s.UnsignedByteType,[o.VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:s.UnsignedByteType,[o.VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:s.UnsignedByteType};async function m(e){let i,n;let{vkFormat:a}=e;if(void 0===p[a])throw Error("THREE.KTX2Loader: Unsupported vkFormat.");e.supercompressionScheme===o.KHR_SUPERCOMPRESSION_ZSTD&&(r||(r=new Promise(async e=>{let i=new l.ZSTDDecoder;await i.init(),e(i)})),i=await r);let h=[];for(let n=0;n<e.levels.length;n++){let r,l;let u=Math.max(1,e.pixelWidth>>n),c=Math.max(1,e.pixelHeight>>n),d=e.pixelDepth?Math.max(1,e.pixelDepth>>n):0,p=e.levels[n];if(e.supercompressionScheme===o.KHR_SUPERCOMPRESSION_NONE)r=p.levelData;else if(e.supercompressionScheme===o.KHR_SUPERCOMPRESSION_ZSTD)r=i.decode(p.levelData,p.uncompressedByteLength);else throw Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");l=f[a]===s.FloatType?new Float32Array(r.buffer,r.byteOffset,r.byteLength/Float32Array.BYTES_PER_ELEMENT):f[a]===s.HalfFloatType?new Uint16Array(r.buffer,r.byteOffset,r.byteLength/Uint16Array.BYTES_PER_ELEMENT):r,h.push({data:l,width:u,height:c,depth:d})}if(d.has(p[a]))n=0===e.pixelDepth?new s.DataTexture(h[0].data,e.pixelWidth,e.pixelHeight):new s.Data3DTexture(h[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new s.CompressedTexture(h,e.pixelWidth,e.pixelHeight)}return n.mipmaps=h,n.type=f[a],n.format=p[a],n.colorSpace=g(e),n.needsUpdate=!0,Promise.resolve(n)}function g(e){let i=e.dataFormatDescriptor[0];return i.colorPrimaries===o.KHR_DF_PRIMARIES_BT709?i.transferFunction===o.KHR_DF_TRANSFER_SRGB?s.SRGBColorSpace:s.LinearSRGBColorSpace:i.colorPrimaries===o.KHR_DF_PRIMARIES_DISPLAYP3?i.transferFunction===o.KHR_DF_TRANSFER_SRGB?s.DisplayP3ColorSpace:s.LinearDisplayP3ColorSpace:i.colorPrimaries===o.KHR_DF_PRIMARIES_UNSPECIFIED?s.NoColorSpace:(console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${i.colorPrimaries}"`),s.NoColorSpace)}},"./node_modules/three/examples/jsm/loaders/MTLLoader.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{MTLLoader:()=>s});var r=n("./node_modules/three/build/three.module.js");class s extends r.Loader{constructor(e){super(e)}load(e,i,n,s){let a=this,o=""===this.path?r.LoaderUtils.extractUrlBase(e):this.path,l=new r.FileLoader(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(n){try{i(a.parse(n,o))}catch(i){s?s(i):console.error(i),a.manager.itemError(e)}},n,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){let n=e.split("\n"),r={},s=/\s+/,o={};for(let e=0;e<n.length;e++){let i=n[e];if(0===(i=i.trim()).length||"#"===i.charAt(0))continue;let a=i.indexOf(" "),l=a>=0?i.substring(0,a):i;l=l.toLowerCase();let h=a>=0?i.substring(a+1):"";if(h=h.trim(),"newmtl"===l)r={name:h},o[h]=r;else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){let e=h.split(s,3);r[l]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else r[l]=h}let l=new a(this.resourcePath||i,this.materialOptions);return l.setCrossOrigin(this.crossOrigin),l.setManager(this.manager),l.setMaterials(o),l}}class a{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:r.FrontSide,this.wrap=void 0!==this.options.wrap?this.options.wrap:r.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;let i={};for(let n in e){let r=e[n],s={};for(let e in i[n]=s,r){let i=!0,n=r[e],a=e.toLowerCase();switch(a){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(i=!1)}i&&(s[a]=n)}}return i}preload(){for(let e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(let i in this.materialsInfo)this.materialsArray[e]=this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){let i=this,n=this.materialsInfo[e],s={name:e,side:this.side};function a(e,n){var a,o;if(s[e])return;let l=i.getTextureParams(n,s),h=i.loadTexture((a=i.baseUrl,"string"!=typeof(o=l.url)||""===o?"":/^https?:\/\//i.test(o)?o:a+o));h.repeat.copy(l.scale),h.offset.copy(l.offset),h.wrapS=i.wrap,h.wrapT=i.wrap,("map"===e||"emissiveMap"===e)&&(h.colorSpace=r.SRGBColorSpace),s[e]=h}for(let e in n){let i;let o=n[e];if(""!==o)switch(e.toLowerCase()){case"kd":s.color=new r.Color().fromArray(o).convertSRGBToLinear();break;case"ks":s.specular=new r.Color().fromArray(o).convertSRGBToLinear();break;case"ke":s.emissive=new r.Color().fromArray(o).convertSRGBToLinear();break;case"map_kd":a("map",o);break;case"map_ks":a("specularMap",o);break;case"map_ke":a("emissiveMap",o);break;case"norm":a("normalMap",o);break;case"map_bump":case"bump":a("bumpMap",o);break;case"map_d":a("alphaMap",o),s.transparent=!0;break;case"ns":s.shininess=parseFloat(o);break;case"d":(i=parseFloat(o))<1&&(s.opacity=i,s.transparent=!0);break;case"tr":i=parseFloat(o),this.options&&this.options.invertTrProperty&&(i=1-i),i>0&&(s.opacity=1-i,s.transparent=!0)}}return this.materials[e]=new r.MeshPhongMaterial(s),this.materials[e]}getTextureParams(e,i){let n;let s={scale:new r.Vector2(1,1),offset:new r.Vector2(0,0)},a=e.split(/\s+/);return(n=a.indexOf("-bm"))>=0&&(i.bumpScale=parseFloat(a[n+1]),a.splice(n,2)),(n=a.indexOf("-s"))>=0&&(s.scale.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),(n=a.indexOf("-o"))>=0&&(s.offset.set(parseFloat(a[n+1]),parseFloat(a[n+2])),a.splice(n,4)),s.url=a.join(" ").trim(),s}loadTexture(e,i,n,s,a){let o=void 0!==this.manager?this.manager:r.DefaultLoadingManager,l=o.getHandler(e);null===l&&(l=new r.TextureLoader(o)),l.setCrossOrigin&&l.setCrossOrigin(this.crossOrigin);let h=l.load(e,n,s,a);return void 0!==i&&(h.mapping=i),h}}},"./node_modules/three/examples/jsm/loaders/OBJLoader.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{OBJLoader:()=>A});var r=n("./node_modules/three/build/three.module.js");let s=/^[og]\s*(.+)?/,a=/^mtllib /,o=/^usemtl /,l=/^usemap /,h=/\s+/,u=new r.Vector3,c=new r.Vector3,d=new r.Vector3,p=new r.Vector3,f=new r.Vector3,m=new r.Color;function g(){let e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&!1===this.object.fromDeclaration){this.object.name=e,this.object.fromDeclaration=!1!==i;return}let n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==i,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,i){let n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);let r={index:this.materials.length,name:e||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){let i={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return i.clone=this.clone.bind(i),i}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){let i=this.currentMaterial();if(i&&-1===i.groupEnd&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),i}},n&&n.name&&"function"==typeof n.clone){let e=n.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,i){let n=parseInt(e,10);return(n>=0?n-1:n+i/3)*3},parseNormalIndex:function(e,i){let n=parseInt(e,10);return(n>=0?n-1:n+i/3)*3},parseUVIndex:function(e,i){let n=parseInt(e,10);return(n>=0?n-1:n+i/2)*2},addVertex:function(e,i,n){let r=this.vertices,s=this.object.geometry.vertices;s.push(r[e+0],r[e+1],r[e+2]),s.push(r[i+0],r[i+1],r[i+2]),s.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){let i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){let i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,n){let r=this.normals,s=this.object.geometry.normals;s.push(r[e+0],r[e+1],r[e+2]),s.push(r[i+0],r[i+1],r[i+2]),s.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,i,n){let r=this.vertices,s=this.object.geometry.normals;u.fromArray(r,e),c.fromArray(r,i),d.fromArray(r,n),f.subVectors(d,c),p.subVectors(u,c),f.cross(p),f.normalize(),s.push(f.x,f.y,f.z),s.push(f.x,f.y,f.z),s.push(f.x,f.y,f.z)},addColor:function(e,i,n){let r=this.colors,s=this.object.geometry.colors;void 0!==r[e]&&s.push(r[e+0],r[e+1],r[e+2]),void 0!==r[i]&&s.push(r[i+0],r[i+1],r[i+2]),void 0!==r[n]&&s.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,i,n){let r=this.uvs,s=this.object.geometry.uvs;s.push(r[e+0],r[e+1]),s.push(r[i+0],r[i+1]),s.push(r[n+0],r[n+1])},addDefaultUV:function(){let e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){let i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,n,r,s,a,o,l,h){let u=this.vertices.length,c=this.parseVertexIndex(e,u),d=this.parseVertexIndex(i,u),p=this.parseVertexIndex(n,u);if(this.addVertex(c,d,p),this.addColor(c,d,p),void 0!==o&&""!==o){let e=this.normals.length;c=this.parseNormalIndex(o,e),d=this.parseNormalIndex(l,e),p=this.parseNormalIndex(h,e),this.addNormal(c,d,p)}else this.addFaceNormal(c,d,p);if(void 0!==r&&""!==r){let e=this.uvs.length;c=this.parseUVIndex(r,e),d=this.parseUVIndex(s,e),p=this.parseUVIndex(a,e),this.addUV(c,d,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";let i=this.vertices.length;for(let n=0,r=e.length;n<r;n++){let r=this.parseVertexIndex(e[n],i);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";let n=this.vertices.length,r=this.uvs.length;for(let i=0,r=e.length;i<r;i++)this.addVertexLine(this.parseVertexIndex(e[i],n));for(let e=0,n=i.length;e<n;e++)this.addUVLine(this.parseUVIndex(i[e],r))}};return e.startObject("",!1),e}class A extends r.Loader{constructor(e){super(e),this.materials=null}load(e,i,n,s){let a=this,o=new r.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){try{i(a.parse(n))}catch(i){s?s(i):console.error(i),a.manager.itemError(e)}},n,s)}setMaterials(e){return this.materials=e,this}parse(e){let i=new g;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));let n=e.split("\n"),u=[];for(let e=0,r=n.length;e<r;e++){let r=n[e].trimStart();if(0===r.length)continue;let c=r.charAt(0);if("#"!==c){if("v"===c){let e=r.split(h);switch(e[0]){case"v":i.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?(m.setRGB(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])).convertSRGBToLinear(),i.colors.push(m.r,m.g,m.b)):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":i.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===c){let e=r.slice(1).trim().split(h),n=[];for(let i=0,r=e.length;i<r;i++){let r=e[i];if(r.length>0){let e=r.split("/");n.push(e)}}let s=n[0];for(let e=1,r=n.length-1;e<r;e++){let r=n[e],a=n[e+1];i.addFace(s[0],r[0],a[0],s[1],r[1],a[1],s[2],r[2],a[2])}}else if("l"===c){let e=r.substring(1).trim().split(" "),n=[],s=[];if(-1===r.indexOf("/"))n=e;else for(let i=0,r=e.length;i<r;i++){let r=e[i].split("/");""!==r[0]&&n.push(r[0]),""!==r[1]&&s.push(r[1])}i.addLineGeometry(n,s)}else if("p"===c){let e=r.slice(1).trim().split(" ");i.addPointGeometry(e)}else if(null!==(u=s.exec(r))){let e=(" "+u[0].slice(1).trim()).slice(1);i.startObject(e)}else if(o.test(r))i.object.startMaterial(r.substring(7).trim(),i.materialLibraries);else if(a.test(r))i.materialLibraries.push(r.substring(7).trim());else if(l.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if((u=r.split(" ")).length>1){let e=u[1].trim().toLowerCase();i.object.smooth="0"!==e&&"off"!==e}else i.object.smooth=!0;let e=i.object.currentMaterial();e&&(e.smooth=i.object.smooth)}else{if("\0"===r)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}}}i.finalize();let c=new r.Group;if(c.materialLibraries=[].concat(i.materialLibraries),!0==(1!==i.objects.length||0!==i.objects[0].geometry.vertices.length))for(let e=0,n=i.objects.length;e<n;e++){let n;let s=i.objects[e],a=s.geometry,o=s.materials,l="Line"===a.type,h="Points"===a.type,u=!1;if(0===a.vertices.length)continue;let d=new r.BufferGeometry;d.setAttribute("position",new r.Float32BufferAttribute(a.vertices,3)),a.normals.length>0&&d.setAttribute("normal",new r.Float32BufferAttribute(a.normals,3)),a.colors.length>0&&(u=!0,d.setAttribute("color",new r.Float32BufferAttribute(a.colors,3))),!0===a.hasUVIndices&&d.setAttribute("uv",new r.Float32BufferAttribute(a.uvs,2));let p=[];for(let e=0,n=o.length;e<n;e++){let n=o[e],s=n.name+"_"+n.smooth+"_"+u,a=i.materials[s];if(null!==this.materials){if(a=this.materials.create(n.name),!l||!a||a instanceof r.LineBasicMaterial){if(h&&a&&!(a instanceof r.PointsMaterial)){let e=new r.PointsMaterial({size:10,sizeAttenuation:!1});r.Material.prototype.copy.call(e,a),e.color.copy(a.color),e.map=a.map,a=e}}else{let e=new r.LineBasicMaterial;r.Material.prototype.copy.call(e,a),e.color.copy(a.color),a=e}}void 0===a&&((a=l?new r.LineBasicMaterial:h?new r.PointsMaterial({size:1,sizeAttenuation:!1}):new r.MeshPhongMaterial).name=n.name,a.flatShading=!n.smooth,a.vertexColors=u,i.materials[s]=a),p.push(a)}if(p.length>1){for(let e=0,i=o.length;e<i;e++){let i=o[e];d.addGroup(i.groupStart,i.groupCount,e)}n=l?new r.LineSegments(d,p):h?new r.Points(d,p):new r.Mesh(d,p)}else n=l?new r.LineSegments(d,p[0]):h?new r.Points(d,p[0]):new r.Mesh(d,p[0]);n.name=s.name,c.add(n)}else if(i.vertices.length>0){let e=new r.PointsMaterial({size:1,sizeAttenuation:!1}),n=new r.BufferGeometry;n.setAttribute("position",new r.Float32BufferAttribute(i.vertices,3)),i.colors.length>0&&void 0!==i.colors[0]&&(n.setAttribute("color",new r.Float32BufferAttribute(i.colors,3)),e.vertexColors=!0);let s=new r.Points(n,e);c.add(s)}return c}}},"./node_modules/three/examples/jsm/math/OBB.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{OBB:()=>_});var r=n("./node_modules/three/build/three.module.js");let s={c:null,u:[new r.Vector3,new r.Vector3,new r.Vector3],e:[]},a={c:null,u:[new r.Vector3,new r.Vector3,new r.Vector3],e:[]},o=[[],[],[]],l=[[],[],[]],h=[],u=new r.Vector3,c=new r.Vector3,d=new r.Vector3,p=new r.Vector3,f=new r.Vector3,m=new r.Vector3,g=new r.Matrix3,A=new r.Box3,v=new r.Matrix4,y=new r.Matrix4,x=new r.Ray;class _{constructor(e=new r.Vector3,i=new r.Vector3,n=new r.Matrix3){this.center=e,this.halfSize=i,this.rotation=n}set(e,i,n){return this.center=e,this.halfSize=i,this.rotation=n,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return new this.constructor().copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,i){let n=this.halfSize;p.subVectors(e,this.center),this.rotation.extractBasis(u,c,d),i.copy(this.center);let s=r.MathUtils.clamp(p.dot(u),-n.x,n.x);i.add(u.multiplyScalar(s));let a=r.MathUtils.clamp(p.dot(c),-n.y,n.y);i.add(c.multiplyScalar(a));let o=r.MathUtils.clamp(p.dot(d),-n.z,n.z);return i.add(d.multiplyScalar(o)),i}containsPoint(e){return p.subVectors(e,this.center),this.rotation.extractBasis(u,c,d),Math.abs(p.dot(u))<=this.halfSize.x&&Math.abs(p.dot(c))<=this.halfSize.y&&Math.abs(p.dot(d))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(b.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,m),m.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,i=Number.EPSILON){let n,r;s.c=this.center,s.e[0]=this.halfSize.x,s.e[1]=this.halfSize.y,s.e[2]=this.halfSize.z,this.rotation.extractBasis(s.u[0],s.u[1],s.u[2]),a.c=e.center,a.e[0]=e.halfSize.x,a.e[1]=e.halfSize.y,a.e[2]=e.halfSize.z,e.rotation.extractBasis(a.u[0],a.u[1],a.u[2]);for(let e=0;e<3;e++)for(let i=0;i<3;i++)o[e][i]=s.u[e].dot(a.u[i]);p.subVectors(a.c,s.c),h[0]=p.dot(s.u[0]),h[1]=p.dot(s.u[1]),h[2]=p.dot(s.u[2]);for(let e=0;e<3;e++)for(let n=0;n<3;n++)l[e][n]=Math.abs(o[e][n])+i;for(let e=0;e<3;e++)if(n=s.e[e],r=a.e[0]*l[e][0]+a.e[1]*l[e][1]+a.e[2]*l[e][2],Math.abs(h[e])>n+r)return!1;for(let e=0;e<3;e++)if(n=s.e[0]*l[0][e]+s.e[1]*l[1][e]+s.e[2]*l[2][e],r=a.e[e],Math.abs(h[0]*o[0][e]+h[1]*o[1][e]+h[2]*o[2][e])>n+r)return!1;return n=s.e[1]*l[2][0]+s.e[2]*l[1][0],r=a.e[1]*l[0][2]+a.e[2]*l[0][1],!(Math.abs(h[2]*o[1][0]-h[1]*o[2][0])>n+r)&&(n=s.e[1]*l[2][1]+s.e[2]*l[1][1],r=a.e[0]*l[0][2]+a.e[2]*l[0][0],!(Math.abs(h[2]*o[1][1]-h[1]*o[2][1])>n+r)&&(n=s.e[1]*l[2][2]+s.e[2]*l[1][2],r=a.e[0]*l[0][1]+a.e[1]*l[0][0],!(Math.abs(h[2]*o[1][2]-h[1]*o[2][2])>n+r)&&(n=s.e[0]*l[2][0]+s.e[2]*l[0][0],r=a.e[1]*l[1][2]+a.e[2]*l[1][1],!(Math.abs(h[0]*o[2][0]-h[2]*o[0][0])>n+r)&&(n=s.e[0]*l[2][1]+s.e[2]*l[0][1],r=a.e[0]*l[1][2]+a.e[2]*l[1][0],!(Math.abs(h[0]*o[2][1]-h[2]*o[0][1])>n+r)&&(n=s.e[0]*l[2][2]+s.e[2]*l[0][2],r=a.e[0]*l[1][1]+a.e[1]*l[1][0],!(Math.abs(h[0]*o[2][2]-h[2]*o[0][2])>n+r)&&(n=s.e[0]*l[1][0]+s.e[1]*l[0][0],r=a.e[1]*l[2][2]+a.e[2]*l[2][1],!(Math.abs(h[1]*o[0][0]-h[0]*o[1][0])>n+r)&&(n=s.e[0]*l[1][1]+s.e[1]*l[0][1],r=a.e[0]*l[2][2]+a.e[2]*l[2][0],!(Math.abs(h[1]*o[0][1]-h[0]*o[1][1])>n+r)&&(n=s.e[0]*l[1][2]+s.e[1]*l[0][2],r=a.e[0]*l[2][1]+a.e[1]*l[2][0],!(Math.abs(h[1]*o[0][2]-h[0]*o[1][2])>n+r)))))))))}intersectsPlane(e){this.rotation.extractBasis(u,c,d);let i=this.halfSize.x*Math.abs(e.normal.dot(u))+this.halfSize.y*Math.abs(e.normal.dot(c))+this.halfSize.z*Math.abs(e.normal.dot(d));return Math.abs(e.normal.dot(this.center)-e.constant)<=i}intersectRay(e,i){return(this.getSize(f),A.setFromCenterAndSize(p.set(0,0,0),f),v.setFromMatrix3(this.rotation),v.setPosition(this.center),y.copy(v).invert(),x.copy(e).applyMatrix4(y),x.intersectBox(A,i))?i.applyMatrix4(v):null}intersectsRay(e){return null!==this.intersectRay(e,p)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){let i=e.elements,n=p.set(i[0],i[1],i[2]).length(),r=p.set(i[4],i[5],i[6]).length(),s=p.set(i[8],i[9],i[10]).length();0>e.determinant()&&(n=-n),g.setFromMatrix4(e);let a=1/n,o=1/r,l=1/s;return g.elements[0]*=a,g.elements[1]*=a,g.elements[2]*=a,g.elements[3]*=o,g.elements[4]*=o,g.elements[5]*=o,g.elements[6]*=l,g.elements[7]*=l,g.elements[8]*=l,this.rotation.multiply(g),this.halfSize.x*=n,this.halfSize.y*=r,this.halfSize.z*=s,p.setFromMatrixPosition(e),this.center.add(p),this}}let b=new _},"./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{computeMikkTSpaceTangents:()=>s,computeMorphedAttributes:()=>m,deepCloneAttribute:()=>l,deinterleaveAttribute:()=>u,deinterleaveGeometry:()=>c,estimateBytesUsed:()=>d,interleaveAttributes:()=>h,mergeAttributes:()=>o,mergeGeometries:()=>a,mergeGroups:()=>g,mergeVertices:()=>p,toCreasedNormals:()=>A,toTrianglesDrawMode:()=>f});var r=n("./node_modules/three/build/three.module.js");function s(e,i,n=!0){if(!i||!i.isReady)throw Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!e.hasAttribute("position")||!e.hasAttribute("normal")||!e.hasAttribute("uv"))throw Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function a(e){if(e.normalized||e.isInterleavedBufferAttribute){let i=new Float32Array(e.count*e.itemSize);for(let n=0,r=0;n<e.count;n++)i[r++]=e.getX(n),i[r++]=e.getY(n),e.itemSize>2&&(i[r++]=e.getZ(n));return i}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}let o=e.index?e.toNonIndexed():e,l=i.generateTangents(a(o.attributes.position),a(o.attributes.normal),a(o.attributes.uv));if(n)for(let e=3;e<l.length;e+=4)l[e]*=-1;return o.setAttribute("tangent",new r.BufferAttribute(l,4)),e!==o&&e.copy(o),e}function a(e,i=!1){let n=null!==e[0].index,s=new Set(Object.keys(e[0].attributes)),l=new Set(Object.keys(e[0].morphAttributes)),h={},u={},c=e[0].morphTargetsRelative,d=new r.BufferGeometry,p=0;for(let r=0;r<e.length;++r){let a=e[r],o=0;if(n!==(null!==a.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+r+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in a.attributes){if(!s.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+r+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===h[e]&&(h[e]=[]),h[e].push(a.attributes[e]),o++}if(o!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+r+". Make sure all geometries have the same number of attributes."),null;if(c!==a.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+r+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in a.morphAttributes){if(!l.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+r+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===u[e]&&(u[e]=[]),u[e].push(a.morphAttributes[e])}if(i){let e;if(n)e=a.index.count;else{if(void 0===a.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+r+". The geometry must have either an index or a position attribute"),null;e=a.attributes.position.count}d.addGroup(p,e,r),p+=e}}if(n){let i=0,n=[];for(let r=0;r<e.length;++r){let s=e[r].index;for(let e=0;e<s.count;++e)n.push(s.getX(e)+i);i+=e[r].attributes.position.count}d.setIndex(n)}for(let e in h){let i=o(h[e]);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" attribute."),null;d.setAttribute(e,i)}for(let e in u){let i=u[e][0].length;if(0===i)break;d.morphAttributes=d.morphAttributes||{},d.morphAttributes[e]=[];for(let n=0;n<i;++n){let i=[];for(let r=0;r<u[e].length;++r)i.push(u[e][r][n]);let r=o(i);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" morphAttribute."),null;d.morphAttributes[e].push(r)}}return d}function o(e){let i,n,s;let a=-1,o=0;for(let r=0;r<e.length;++r){let l=e[r];if(void 0===i&&(i=l.array.constructor),i!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=l.itemSize),n!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===s&&(s=l.normalized),s!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===a&&(a=l.gpuType),a!==l.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=l.count*n}let l=new i(o),h=new r.BufferAttribute(l,n,s),u=0;for(let i=0;i<e.length;++i){let r=e[i];if(r.isInterleavedBufferAttribute){let e=u/n;for(let i=0,s=r.count;i<s;i++)for(let s=0;s<n;s++){let n=r.getComponent(i,s);h.setComponent(i+e,s,n)}}else l.set(r.array,u);u+=r.count*n}return void 0!==a&&(h.gpuType=a),h}function l(e){return e.isInstancedInterleavedBufferAttribute||e.isInterleavedBufferAttribute?u(e):e.isInstancedBufferAttribute?new r.InstancedBufferAttribute().copy(e):new r.BufferAttribute().copy(e)}function h(e){let i;let n=0,s=0;for(let r=0,a=e.length;r<a;++r){let a=e[r];if(void 0===i&&(i=a.array.constructor),i!==a.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=a.array.length,s+=a.itemSize}let a=new r.InterleavedBuffer(new i(n),s),o=0,l=[],h=["getX","getY","getZ","getW"],u=["setX","setY","setZ","setW"];for(let i=0,n=e.length;i<n;i++){let n=e[i],s=n.itemSize,c=n.count,d=new r.InterleavedBufferAttribute(a,s,o,n.normalized);l.push(d),o+=s;for(let e=0;e<c;e++)for(let i=0;i<s;i++)d[u[i]](e,n[h[i]](e))}return l}function u(e){let i;let n=e.data.array.constructor,s=e.count,a=e.itemSize,o=e.normalized,l=new n(s*a);i=e.isInstancedInterleavedBufferAttribute?new r.InstancedBufferAttribute(l,a,o,e.meshPerAttribute):new r.BufferAttribute(l,a,o);for(let n=0;n<s;n++)i.setX(n,e.getX(n)),a>=2&&i.setY(n,e.getY(n)),a>=3&&i.setZ(n,e.getZ(n)),a>=4&&i.setW(n,e.getW(n));return i}function c(e){let i=e.attributes,n=e.morphTargets,r=new Map;for(let e in i){let n=i[e];n.isInterleavedBufferAttribute&&(r.has(n)||r.set(n,u(n)),i[e]=r.get(n))}for(let e in n){let i=n[e];i.isInterleavedBufferAttribute&&(r.has(i)||r.set(i,u(i)),n[e]=r.get(i))}}function d(e){let i=0;for(let n in e.attributes){let r=e.getAttribute(n);i+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}let n=e.getIndex();return i+(n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0)}function p(e,i=1e-4){i=Math.max(i,Number.EPSILON);let n={},s=e.getIndex(),a=e.getAttribute("position"),o=s?s.count:a.count,l=0,h=Object.keys(e.attributes),u={},c={},d=[],f=["getX","getY","getZ","getW"],m=["setX","setY","setZ","setW"];for(let i=0,n=h.length;i<n;i++){let n=h[i],s=e.attributes[n];u[n]=new r.BufferAttribute(new s.array.constructor(s.count*s.itemSize),s.itemSize,s.normalized);let a=e.morphAttributes[n];a&&(c[n]=new r.BufferAttribute(new a.array.constructor(a.count*a.itemSize),a.itemSize,a.normalized))}let g=.5*i,A=Math.pow(10,Math.log10(1/i)),v=g*A;for(let i=0;i<o;i++){let r=s?s.getX(i):i,a="";for(let i=0,n=h.length;i<n;i++){let n=h[i],s=e.getAttribute(n),o=s.itemSize;for(let e=0;e<o;e++)a+=`${~~(s[f[e]](r)*A+v)},`}if(a in n)d.push(n[a]);else{for(let i=0,n=h.length;i<n;i++){let n=h[i],s=e.getAttribute(n),a=e.morphAttributes[n],o=s.itemSize,d=u[n],p=c[n];for(let e=0;e<o;e++){let i=f[e],n=m[e];if(d[n](l,s[i](r)),a)for(let e=0,s=a.length;e<s;e++)p[e][n](l,a[e][i](r))}}n[a]=l,d.push(l),l++}}let y=e.clone();for(let i in e.attributes){let e=u[i];if(y.setAttribute(i,new r.BufferAttribute(e.array.slice(0,l*e.itemSize),e.itemSize,e.normalized)),i in c)for(let e=0;e<c[i].length;e++){let n=c[i][e];y.morphAttributes[i][e]=new r.BufferAttribute(n.array.slice(0,l*n.itemSize),n.itemSize,n.normalized)}}return y.setIndex(d),y}function f(e,i){if(i===r.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(i!==r.TriangleFanDrawMode&&i!==r.TriangleStripDrawMode)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),e;{let n=e.getIndex();if(null===n){let i=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)i.push(e);e.setIndex(i),n=e.getIndex()}let s=n.count-2,a=[];if(i===r.TriangleFanDrawMode)for(let e=1;e<=s;e++)a.push(n.getX(0)),a.push(n.getX(e)),a.push(n.getX(e+1));else for(let e=0;e<s;e++)e%2==0?(a.push(n.getX(e)),a.push(n.getX(e+1)),a.push(n.getX(e+2))):(a.push(n.getX(e+2)),a.push(n.getX(e+1)),a.push(n.getX(e)));a.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let o=e.clone();return o.setIndex(a),o.clearGroups(),o}}function m(e){let i,n,s,a,o,l,h,u,c,d;let p=new r.Vector3,f=new r.Vector3,m=new r.Vector3,g=new r.Vector3,A=new r.Vector3,v=new r.Vector3,y=new r.Vector3,x=new r.Vector3,_=new r.Vector3;function b(e,i,n,r,s,a,o,l){p.fromBufferAttribute(i,s),f.fromBufferAttribute(i,a),m.fromBufferAttribute(i,o);let h=e.morphTargetInfluences;if(n&&h){y.set(0,0,0),x.set(0,0,0),_.set(0,0,0);for(let e=0,i=n.length;e<i;e++){let i=h[e],l=n[e];0!==i&&(g.fromBufferAttribute(l,s),A.fromBufferAttribute(l,a),v.fromBufferAttribute(l,o),r?(y.addScaledVector(g,i),x.addScaledVector(A,i),_.addScaledVector(v,i)):(y.addScaledVector(g.sub(p),i),x.addScaledVector(A.sub(f),i),_.addScaledVector(v.sub(m),i)))}p.add(y),f.add(x),m.add(_)}e.isSkinnedMesh&&(e.applyBoneTransform(s,p),e.applyBoneTransform(a,f),e.applyBoneTransform(o,m)),l[3*s+0]=p.x,l[3*s+1]=p.y,l[3*s+2]=p.z,l[3*a+0]=f.x,l[3*a+1]=f.y,l[3*a+2]=f.z,l[3*o+0]=m.x,l[3*o+1]=m.y,l[3*o+2]=m.z}let E=e.geometry,w=e.material,M=E.index,C=E.attributes.position,S=E.morphAttributes.position,T=E.morphTargetsRelative,R=E.attributes.normal,I=E.morphAttributes.position,B=E.groups,L=E.drawRange,P=new Float32Array(C.count*C.itemSize),D=new Float32Array(R.count*R.itemSize);if(null!==M){if(Array.isArray(w))for(a=0,l=B.length;a<l;a++)for(c=Math.max((u=B[a]).start,L.start),d=Math.min(u.start+u.count,L.start+L.count),o=c,h=d;o<h;o+=3)i=M.getX(o),b(e,C,S,T,i,n=M.getX(o+1),s=M.getX(o+2),P),b(e,R,I,T,i,n,s,D);else for(c=Math.max(0,L.start),d=Math.min(M.count,L.start+L.count),a=c,l=d;a<l;a+=3)i=M.getX(a),b(e,C,S,T,i,n=M.getX(a+1),s=M.getX(a+2),P),b(e,R,I,T,i,n,s,D)}else if(Array.isArray(w))for(a=0,l=B.length;a<l;a++)for(c=Math.max((u=B[a]).start,L.start),d=Math.min(u.start+u.count,L.start+L.count),o=c,h=d;o<h;o+=3)b(e,C,S,T,i=o,n=o+1,s=o+2,P),b(e,R,I,T,i,n,s,D);else for(c=Math.max(0,L.start),d=Math.min(C.count,L.start+L.count),a=c,l=d;a<l;a+=3)b(e,C,S,T,i=a,n=a+1,s=a+2,P),b(e,R,I,T,i,n,s,D);return{positionAttribute:C,normalAttribute:R,morphedPositionAttribute:new r.Float32BufferAttribute(P,3),morphedNormalAttribute:new r.Float32BufferAttribute(D,3)}}function g(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let i=e.groups;if(i=i.sort((e,i)=>e.materialIndex!==i.materialIndex?e.materialIndex-i.materialIndex:e.start-i.start),null===e.getIndex()){let i=e.getAttribute("position"),n=[];for(let e=0;e<i.count;e+=3)n.push(e,e+1,e+2);e.setIndex(n)}let n=e.getIndex(),r=[];for(let e=0;e<i.length;e++){let s=i[e],a=s.start,o=a+s.count;for(let e=a;e<o;e++)r.push(n.getX(e))}e.dispose(),e.setIndex(r);let s=0;for(let e=0;e<i.length;e++){let n=i[e];n.start=s,s+=n.count}let a=i[0];e.groups=[a];for(let n=1;n<i.length;n++){let r=i[n];a.materialIndex===r.materialIndex?a.count+=r.count:(a=r,e.groups.push(a))}return e}function A(e,i=Math.PI/3){let n=Math.cos(i),s=(1+1e-10)*100,a=[new r.Vector3,new r.Vector3,new r.Vector3],o=new r.Vector3,l=new r.Vector3,h=new r.Vector3,u=new r.Vector3;function c(e){let i=~~(e.x*s),n=~~(e.y*s),r=~~(e.z*s);return`${i},${n},${r}`}let d=e.index?e.toNonIndexed():e,p=d.attributes.position,f={};for(let e=0,i=p.count/3;e<i;e++){let i=3*e,n=a[0].fromBufferAttribute(p,i+0),s=a[1].fromBufferAttribute(p,i+1),h=a[2].fromBufferAttribute(p,i+2);o.subVectors(h,s),l.subVectors(n,s);let u=new r.Vector3().crossVectors(o,l).normalize();for(let e=0;e<3;e++){let i=c(a[e]);i in f||(f[i]=[]),f[i].push(u)}}let m=new Float32Array(3*p.count),g=new r.BufferAttribute(m,3,!1);for(let e=0,i=p.count/3;e<i;e++){let i=3*e,r=a[0].fromBufferAttribute(p,i+0),s=a[1].fromBufferAttribute(p,i+1),d=a[2].fromBufferAttribute(p,i+2);o.subVectors(d,s),l.subVectors(r,s),h.crossVectors(o,l).normalize();for(let e=0;e<3;e++){let r=f[c(a[e])];u.set(0,0,0);for(let e=0,i=r.length;e<i;e++){let i=r[e];h.dot(i)>n&&u.add(i)}u.normalize(),g.setXYZ(i+e,u.x,u.y,u.z)}}return d.setAttribute("normal",g),d}},"./node_modules/three/examples/jsm/utils/WorkerPool.js":(e,i,n)=>{"use strict";n.r(i),n.d(i,{WorkerPool:()=>r});class r{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){let i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return -1}_onMessage(e,i){let n=this.workersResolve[e];if(n&&n(i),this.queue.length){let{resolve:i,msg:n,transfer:r}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(n,r)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(n=>{let r=this._getIdleWorker();-1!==r?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,i)):this.queue.push({resolve:n,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}},"./src/lib/three.mjs":(e,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>f});var r=n("./node_modules/three/build/three.module.js"),s=n("./node_modules/three/examples/jsm/loaders/DRACOLoader.js"),a=n("./node_modules/three/examples/jsm/loaders/GLTFLoader.js"),o=n("./node_modules/three/examples/jsm/loaders/KTX2Loader.js"),l=n("./node_modules/three/examples/jsm/math/OBB.js"),h=n("./node_modules/three/examples/jsm/loaders/OBJLoader.js"),u=n("./node_modules/three/examples/jsm/loaders/MTLLoader.js"),c=n("./node_modules/three/examples/jsm/utils/BufferGeometryUtils.js"),d=n("./node_modules/three/examples/jsm/lights/LightProbeGenerator.js"),p={...r};p.DRACOLoader=s.DRACOLoader,p.GLTFLoader=a.GLTFLoader,p.KTX2Loader=o.KTX2Loader,p.OBJLoader=h.OBJLoader,p.MTLLoader=u.MTLLoader,p.OBB=l.OBB,p.BufferGeometryUtils=c,p.LightProbeGenerator=d.LightProbeGenerator;let f=p},"./package.json":e=>{"use strict";e.exports=JSON.parse('{"name":"aframe","version":"1.6.0","description":"A web framework for building virtual reality experiences.","homepage":"https://aframe.io/","main":"dist/aframe-master.js","scripts":{"dev":"cross-env INSPECTOR_VERSION=dev webpack serve --port 8080","dist":"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"webpack --config webpack.config.js","dist:min":"webpack --config webpack.prod.config.js","docs":"markserv --dir docs --port 9001","preghpages":"node ./scripts/preghpages.js","ghpages":"ghpages -p gh-pages/","lint":"standardx -v | snazzy","lint:fix":"standardx --fix","precommit":"npm run lint","prepush":"node scripts/testOnlyCheck.js","prerelease":"node scripts/release.js 1.5.0 1.6.0","start":"npm run dev","start:https":"npm run dev -- --server-type https","test":"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:nobrowser":"NO_BROWSER=true npm test","test:node":"node --experimental-require-module ./node_modules/mocha/bin/mocha --ui tdd tests/node"},"repository":"aframevr/aframe","license":"MIT","files":["dist/*","docs/**/*","src/**/*","vendor/**/*"],"dependencies":{"buffer":"^6.0.3","debug":"^4.3.4","deep-assign":"^2.0.0","load-bmfont":"^1.2.3","super-animejs":"^3.1.0","three":"npm:super-three@0.164.0","three-bmfont-text":"dmarcos/three-bmfont-text#eed4878795be9b3e38cf6aec6b903f56acd1f695","webvr-polyfill":"^0.10.12"},"devDependencies":{"@babel/core":"^7.17.10","babel-loader":"^8.2.5","babel-plugin-istanbul":"^6.1.1","chai":"^4.3.6","chai-shallow-deep-equal":"^1.4.0","chalk":"^1.1.3","cross-env":"^7.0.3","css-loader":"^6.7.1","eslint":"^8.45.0","eslint-config-semistandard":"^17.0.0","eslint-config-standard-jsx":"^11.0.0","ghpages":"0.0.8","git-rev":"^0.2.1","glob":"^8.0.3","husky":"^0.11.7","jsdom":"^24.0.0","jsdom-global":"^3.0.2","karma":"^6.4.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^3.1.1","karma-coverage":"^2.2.0","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-sinon-chai":"^2.0.2","karma-webpack":"^5.0.0","markserv":"github:sukima/markserv#feature/fix-broken-websoketio-link","mocha":"^10.0.0","replace-in-file":"^2.5.3","shelljs":"^0.7.7","shx":"^0.2.2","sinon":"<12.0.0","sinon-chai":"^3.7.0","snazzy":"^5.0.0","standardx":"^7.0.0","style-loader":"^3.3.1","too-wordy":"ngokevin/too-wordy","webpack":"^5.73.0","webpack-cli":"^4.10.0","webpack-dev-server":"^4.11.0","webpack-merge":"^5.8.0","write-good":"^1.0.8"},"link":true,"standardx":{"ignore":["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},"keywords":["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","quest","meta","web-components","webvr","webxr"],"engines":{"node":">= 4.6.0","npm":">= 2.15.9"}}')}},i={};function n(r){var s=i[r];if(void 0!==s)return s.exports;var a=i[r]={id:r,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}return n.m=e,n.n=e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return n.d(i,{a:i}),i},n.d=(e,i)=>{for(var r in i)n.o(i,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.b=document.baseURI||self.location.href,n.nc=void 0,n("./src/index.js")})(),e.exports=n()},84245:function(e){e.exports=function(e){!function(e){if(!e)throw Error("Eventify cannot use falsy object as events subject");for(var i=["on","fire","off"],n=0;n<i.length;++n)if(e.hasOwnProperty(i[n]))throw Error("Subject cannot be eventified, since it already has property '"+i[n]+"'")}(e);var i,n,r=(i=e,n=Object.create(null),{on:function(e,r,s){if("function"!=typeof r)throw Error("callback is expected to be a function");var a=n[e];return a||(a=n[e]=[]),a.push({callback:r,ctx:s}),i},off:function(e,r){if(void 0===e)return n=Object.create(null),i;if(n[e]){if("function"!=typeof r)delete n[e];else for(var s=n[e],a=0;a<s.length;++a)s[a].callback===r&&s.splice(a,1)}return i},fire:function(e){var r,s=n[e];if(!s)return i;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var a=0;a<s.length;++a){var o=s[a];o.callback.apply(o.ctx,r)}return i}});return e.on=r.on,e.off=r.off,e.fire=r.fire,e}},16505:function(e,i,n){e.exports=function(e,i){if(!e)throw Error("Graph structure cannot be undefined");var a=(i&&i.createSimulator||n(45818))(i);if(Array.isArray(i))throw Error("Physics settings is expected to be an object");var o=e.version>19?function(i){var n=e.getLinks(i);return n?1+n.size/3:1}:function(i){var n=e.getLinks(i);return n?1+n.length/3:1};i&&"function"==typeof i.nodeMass&&(o=i.nodeMass);var l=new Map,h={},u=0,c=a.settings.springTransform||s;u=0,e.forEachNode(function(e){A(e.id),u+=1}),e.forEachLink(v),e.on("changed",g);var d=!1,p={step:function(){if(0===u)return f(!0),!0;var e=a.step();p.lastMove=e,p.fire("step");var i=e/u<=.01;return f(i),i},getNodePosition:function(e){return x(e).pos},setNodePosition:function(e){var i=x(e);i.setPosition.apply(i,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(e){var i=h[e];if(i)return{from:i.from.pos,to:i.to.pos}},getGraphRect:function(){return a.getBBox()},forEachBody:m,pinNode:function(e,i){x(e.id).isPinned=!!i},isNodePinned:function(e){return x(e.id).isPinned},dispose:function(){e.off("changed",g),p.fire("disposed")},getBody:function(e){return l.get(e)},getSpring:function(i,n){var r;if(void 0===n)r="object"!=typeof i?i:i.id;else{var s=e.hasLink(i,n);if(!s)return;r=s.id}return h[r]},getForceVectorLength:function(){var e=0,i=0;return m(function(n){e+=Math.abs(n.force.x),i+=Math.abs(n.force.y)}),Math.sqrt(e*e+i*i)},simulator:a,graph:e,lastMove:0};return r(p),p;function f(e){var i;d!==e&&(d=e,i=e,p.fire("stable",i))}function m(e){l.forEach(e)}function g(i){for(var n=0;n<i.length;++n){var r=i[n];"add"===r.changeType?(r.node&&A(r.node.id),r.link&&v(r.link)):"remove"===r.changeType&&(r.node&&function(e){var i=e.id,n=l.get(i);n&&(l.delete(i),a.removeBody(n))}(r.node),r.link&&function(i){var n=h[i.id];if(n){var r=e.getNode(i.fromId),s=e.getNode(i.toId);r&&y(r.id),s&&y(s.id),delete h[i.id],a.removeSpring(n)}}(r.link))}u=e.getNodesCount()}function A(i){var n=l.get(i);if(!n){var r,s=e.getNode(i);if(!s)throw Error("initBody() was called with unknown node id");var o=s.position;if(!o){var h=function(e){var i=[];if(!e.links)return i;for(var n=Math.min(e.links.length,2),r=0;r<n;++r){var s=e.links[r],a=s.fromId!==e.id?l.get(s.fromId):l.get(s.toId);a&&a.pos&&i.push(a)}return i}(s);o=a.getBestNewBodyPosition(h)}(n=a.addBodyAt(o)).id=i,l.set(i,n),y(i),(r=s)&&(r.isPinned||r.data&&r.data.isPinned)&&(n.isPinned=!0)}}function v(e){y(e.fromId),y(e.toId);var i=l.get(e.fromId),n=l.get(e.toId),r=a.addSpring(i,n,e.length);c(e,r),h[e.id]=r}function y(e){var i=l.get(e);if(i.mass=o(e),Number.isNaN(i.mass))throw Error("Node mass should be a number")}function x(e){var i=l.get(e);return i||(A(e),i=l.get(e)),i}},e.exports.simulator=n(45818);var r=n(84245);function s(){}},15189:function(e,i,n){let r=n(16422);e.exports=function(e){return function(i,n){let s=n&&n.indent||0,a=n&&void 0!==n.join?n.join:"\n",o=Array(s+1).join(" "),l=[];for(let n=0;n<e;++n){let e=r(n),s=0===n?"":o;l.push(s+i.replace(/{var}/g,e))}return l.join(a)}}},30891:function(e,i,n){e.exports=function(e){return Function("bodies","settings","random",s(e))},e.exports.generateFunctionBody=s;let r=n(15189);function s(e){let i=r(e);return`
  var boundingBox = {
    ${i("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${i("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${i("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${i("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${i("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${i("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${i("var max_{var} = -Infinity;",{indent:4})}
    ${i("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${i("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${i("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${i("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${i("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${i("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}},6410:function(e,i,n){let r=n(15189);function s(e,i){return`
${o(e,i)}
${a(e,i)}
return {Body: Body, Vector: Vector};
`}function a(e){let i=r(e),n=i("{var}",{join:", "});return`
function Body(${n}) {
  this.isPinned = false;
  this.pos = new Vector(${n});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${n}) {
  ${i("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function o(e,i){let n=r(e),s="";i&&(s=`${n("\n   var v{var};\nObject.defineProperty(this, '{var}', {\n  set: function(v) { \n    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n    v{var} = v; \n  },\n  get: function() { return v{var}; }\n});")}`);let a=n("{var}",{join:", "});return`function Vector(${a}) {
  ${s}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${n('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${n("this.{var} = v.{var};",{indent:4})}
    } else {
      ${n('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${n("this.{var} = ",{join:""})}0;
  };`}e.exports=function(e,i){let{Body:n}=Function(s(e,i))();return n},e.exports.generateCreateBodyFunctionBody=s,e.exports.getVectorCode=o,e.exports.getBodyCode=a},36647:function(e,i,n){let r=n(15189);function s(e){let i=r(e);return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${i("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}e.exports=function(e){return Function("options",s(e))},e.exports.generateCreateDragForceFunctionBody=s},34079:function(e,i,n){let r=n(15189);function s(e){let i=r(e);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${i("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${i("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${i("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${i("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}e.exports=function(e){return Function("options","random",s(e))},e.exports.generateCreateSpringForceFunctionBody=s},51763:function(e,i,n){let r=n(15189);function s(e){let i=r(e);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${i("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${i("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${i("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${i("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${i("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${i("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${i("body.pos.{var} += d{var};",{indent:4})}

    ${i("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${i("t{var} * t{var}",{join:" + "})})/length;
`}e.exports=function(e){return Function("bodies","timeStep","adaptiveTimeStepWeight",s(e))},e.exports.generateIntegratorFunctionBody=s},1584:function(e,i,n){let r=n(15189),s=n(16422);function a(e){let i=r(e),n=Math.pow(2,e);return`
${c()}
${u(e)}
${o(e)}
${h(e)}
${l(e)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${function(e){let i=[];for(let r=0;r<n;++r)i.push(`${e}quad${r} = null;`);return i.join("\n")}("      node.")}
      node.body = null;
      node.mass = ${i("node.mass_{var} = ",{join:""})}0;
      ${i("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${i("var d{var};",{indent:4})}
    var r; 
    ${i("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${i("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${i("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${i("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${i("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${i("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${s(0)} - node.min_${s(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${i("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${function(){let e=Array(11).join(" "),i=[];for(let r=0;r<n;++r)i.push(e+`if (node.quad${r}) {`),i.push(e+`  queue[pushIdx] = node.quad${r};`),i.push(e+"  queueLength += 1;"),i.push(e+"  pushIdx += 1;"),i.push(e+"}");return i.join("\n")}()}
        }
      }
    }

    ${i("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${i("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${i("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${i("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${i("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${i("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${i("root.min_{var} = {var}min;",{indent:4})}
    ${i("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${i("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${i("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${i("var min_{var} = node.min_{var};",{indent:8})}
        ${i("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${function(i){let n=[],r=Array(9).join(" ");for(let i=0;i<e;++i)n.push(r+`if (${s(i)} > max_${s(i)}) {`),n.push(r+`  quadIdx = quadIdx + ${Math.pow(2,i)};`),n.push(r+`  min_${s(i)} = max_${s(i)};`),n.push(r+`  max_${s(i)} = node.max_${s(i)};`),n.push(r+"}");return n.join("\n")}(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${i("child.min_{var} = min_{var};",{indent:10})}
          ${i("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${i("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${i("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`}function o(e){let i=r(e);return`
  function isSamePosition(point1, point2) {
    ${i("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${i("d{var} < 1e-8",{join:" && "})};
  }  
`}function l(e){var i=Math.pow(2,e);return`
function setChild(node, idx, child) {
  ${function(){let e=[];for(let n=0;n<i;++n){let i=0===n?"  ":"  else ";e.push(`${i}if (idx === ${n}) node.quad${n} = child;`)}return e.join("\n")}()}
}`}function h(e){return`function getChild(node, idx) {
${function(){let i=[],n=Math.pow(2,e);for(let e=0;e<n;++e)i.push(`  if (idx === ${e}) return node.quad${e};`);return i.join("\n")}()}
  return null;
}`}function u(e){let i=r(e),n=Math.pow(2,e);return`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${function(e){let i=[];for(let r=0;r<n;++r)i.push(`${e}quad${r} = null;`);return i.join("\n")}("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${i("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${i("this.min_{var} = 0;",{indent:2})}
  ${i("this.max_{var} = 0;",{indent:2})}
}
`}function c(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}e.exports=function(e){return Function(a(e))()},e.exports.generateQuadTreeFunctionBody=a,e.exports.getInsertStackCode=c,e.exports.getQuadNodeCode=u,e.exports.isSamePosition=o,e.exports.getChildBodyCode=h,e.exports.setChildBodyCode=l},16422:function(e){e.exports=function(e){return 0===e?"x":1===e?"y":2===e?"z":"c"+(e+1)}},45818:function(e,i,n){e.exports=function(e){var i=n(68403),c=n(35510),d=n(84245);if(e){if(void 0!==e.springCoeff)throw Error("springCoeff was renamed to springCoefficient");if(void 0!==e.dragCoeff)throw Error("dragCoeff was renamed to dragCoefficient")}var p=u[(e=c(e,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1})).dimensions];if(!p){var f=e.dimensions;p={Body:r(f,e.debug),createQuadTree:s(f),createBounds:a(f),createDragForce:o(f),createSpringForce:l(f),integrate:h(f)},u[f]=p}var m=p.Body,g=p.createQuadTree,A=p.createBounds,v=p.createDragForce,y=p.createSpringForce,x=p.integrate,_=e=>new m(e),b=n(78712).random(42),E=[],w=[],M=g(e,b),C=A(E,e,b),S=y(e,b),T=v(e),R=[],I=new Map,B=0;D("nbody",function(){if(0!==E.length){M.insertBodies(E);for(var e=E.length;e--;){var i=E[e];i.isPinned||(i.reset(),M.updateBodyForce(i),T.update(i))}}}),D("spring",function(){for(var e=w.length;e--;)S.update(w[e])});var L={bodies:E,quadTree:M,springs:w,settings:e,addForce:D,removeForce:function(e){var i=R.indexOf(I.get(e));i<0||(R.splice(i,1),I.delete(e))},getForces:function(){return I},step:function(){for(var i=0;i<R.length;++i)R[i](B);var n=x(E,e.timeStep,e.adaptiveTimeStepWeight);return B+=1,n},addBody:function(e){if(!e)throw Error("Body is required");return E.push(e),e},addBodyAt:function(e){if(!e)throw Error("Body position is required");var i=_(e);return E.push(i),i},removeBody:function(e){if(e){var i=E.indexOf(e);if(!(i<0))return E.splice(i,1),0===E.length&&C.reset(),!0}},addSpring:function(e,n,r,s){if(!e||!n)throw Error("Cannot add null spring to force simulator");"number"!=typeof r&&(r=-1);var a=new i(e,n,r,s>=0?s:-1);return w.push(a),a},getTotalMovement:function(){return 0},removeSpring:function(e){if(e){var i=w.indexOf(e);if(i>-1)return w.splice(i,1),!0}},getBestNewBodyPosition:function(e){return C.getBestNewPosition(e)},getBBox:P,getBoundingBox:P,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(i){return void 0!==i?(e.gravity=i,M.options({gravity:i}),this):e.gravity},theta:function(i){return void 0!==i?(e.theta=i,M.options({theta:i}),this):e.theta},random:b};return function(e,i){for(var n in e)(function(e,i,n){e.hasOwnProperty(n)&&"function"!=typeof i[n]&&(Number.isFinite(e[n])?i[n]=function(r){if(void 0!==r){if(!Number.isFinite(r))throw Error("Value of "+n+" should be a valid number.");return e[n]=r,i}return e[n]}:i[n]=function(r){return void 0!==r?(e[n]=r,i):e[n]})})(e,i,n)}(e,L),d(L),L;function P(){return C.update(),C.box}function D(e,i){if(I.has(e))throw Error("Force "+e+" is already added");I.set(e,i),R.push(i)}};var r=n(6410),s=n(1584),a=n(30891),o=n(36647),l=n(34079),h=n(51763),u={}},68403:function(e){e.exports=function(e,i,n,r){this.from=e,this.to=i,this.length=n,this.coefficient=r}},54736:function(e,i,n){e.exports=function(e){if("uniqueLinkId"in(e=e||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),e.multigraph=e.uniqueLinkId),void 0===e.multigraph&&(e.multigraph=!1),"function"!=typeof Map)throw Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var i,n=new Map,h=new Map,u={},c=0,d=e.multigraph?function(e,i,n){var r=l(e,i),s=u.hasOwnProperty(r);if(s||S(e,i)){s||(u[r]=0);var a="@"+ ++u[r];r=l(e+a,i+a)}return new o(e,i,n,r)}:function(e,i,n){var r=l(e,i),s=h.get(r);return s?(s.data=n,s):new o(e,i,n,r)},p=[],f=T,m=T,g=T,A=T,v={version:20,addNode:_,addLink:function(e,i,n){g();var r=b(e)||_(e),s=b(i)||_(i),o=d(e,i,n),l=h.has(o.id);return h.set(o.id,o),a(r,o),e!==i&&a(s,o),f(o,l?"update":"add"),A(),o},removeLink:function(e,i){return void 0!==i&&(e=S(e,i)),C(e)},removeNode:E,getNode:b,getNodeCount:w,getLinkCount:M,getEdgeCount:M,getLinksCount:M,getNodesCount:w,getLinks:function(e){var i=b(e);return i?i.links:null},forEachNode:B,forEachLinkedNode:function(e,i,r){var s=b(e);if(s&&s.links&&"function"==typeof i)return r?function(e,i,r){for(var s=e.values(),a=s.next();!a.done;){var o=a.value;if(o.fromId===i&&r(n.get(o.toId),o))return!0;a=s.next()}}(s.links,e,i):function(e,i,r){for(var s=e.values(),a=s.next();!a.done;){var o=a.value,l=o.fromId===i?o.toId:o.fromId;if(r(n.get(l),o))return!0;a=s.next()}}(s.links,e,i)},forEachLink:function(e){if("function"==typeof e)for(var i=h.values(),n=i.next();!n.done;){if(e(n.value))return!0;n=i.next()}},beginUpdate:g,endUpdate:A,clear:function(){g(),B(function(e){E(e.id)}),A()},hasLink:S,hasNode:b,getLink:S};return r(v),i=v.on,v.on=function(){return v.beginUpdate=g=R,v.endUpdate=A=I,f=y,m=x,v.on=i,i.apply(v,arguments)},v;function y(e,i){p.push({link:e,changeType:i})}function x(e,i){p.push({node:e,changeType:i})}function _(e,i){if(void 0===e)throw Error("Invalid node identifier");g();var r=b(e);return r?(r.data=i,m(r,"update")):(r=new s(e,i),m(r,"add")),n.set(e,r),A(),r}function b(e){return n.get(e)}function E(e){var i=b(e);if(!i)return!1;g();var r=i.links;return r&&(r.forEach(C),i.links=null),n.delete(e),m(i,"remove"),A(),!0}function w(){return n.size}function M(){return h.size}function C(e){if(!e||!h.get(e.id))return!1;g(),h.delete(e.id);var i=b(e.fromId),n=b(e.toId);return i&&i.links.delete(e),n&&n.links.delete(e),f(e,"remove"),A(),!0}function S(e,i){if(void 0!==e&&void 0!==i)return h.get(l(e,i))}function T(){}function R(){c+=1}function I(){0==(c-=1)&&p.length>0&&(v.fire("changed",p),p.length=0)}function B(e){if("function"!=typeof e)throw Error("Function is expected to iterate over graph nodes. You passed "+e);for(var i=n.values(),r=i.next();!r.done;){if(e(r.value))return!0;r=i.next()}}};var r=n(84245);function s(e,i){this.id=e,this.links=null,this.data=i}function a(e,i){e.links?e.links.add(i):e.links=new Set([i])}function o(e,i,n,r){this.fromId=e,this.toId=i,this.data=n,this.id=r}function l(e,i){return e.toString()+"\uD83D\uDC49 "+i.toString()}},35510:function(e){e.exports=function e(i,n){var r;if(i||(i={}),n){for(r in n)if(n.hasOwnProperty(r)){var s=i.hasOwnProperty(r),a=typeof n[r];s&&typeof i[r]===a?"object"===a&&(i[r]=e(i[r],n[r])):i[r]=n[r]}}return i}},78712:function(e){function i(e){return new n("number"==typeof e?e:+new Date)}function n(e){this.seed=e}function r(e){return Math.sqrt(2*Math.PI/e)*Math.pow(1/Math.E*(e+1/(12*e-1/(10*e))),e)}function s(){var e=this.seed;return e=(0xb55a4f09^(e=(e=((e=(e=(0xc761c23c^(e=e+0x7ed55d16+(e<<12)&0xffffffff)^e>>>19)&0xffffffff)+0x165667b1+(e<<5)&0xffffffff)+0xd3a2646c^e<<9)&0xffffffff)+0xfd7046c5+(e<<3)&0xffffffff)^e>>>16)&0xffffffff,this.seed=e,(0xfffffff&e)/0x10000000}e.exports=i,e.exports.random=i,e.exports.randomIterator=function(e,n){var r=n||i();if("function"!=typeof r.next)throw Error("customRandom does not match expected API: next() function is missing");return{forEach:function(i){var n,s,a;for(n=e.length-1;n>0;--n)a=e[s=r.next(n+1)],e[s]=e[n],e[n]=a,i(a);e.length&&i(e[0])},shuffle:function(){var i,n,s;for(i=e.length-1;i>0;--i)s=e[n=r.next(i+1)],e[n]=e[i],e[i]=s;return e}}},n.prototype.next=function(e){return Math.floor(this.nextDouble()*e)},n.prototype.nextDouble=s,n.prototype.uniform=s,n.prototype.gaussian=function(){var e,i,n;do e=(i=2*this.nextDouble()-1)*i+(n=2*this.nextDouble()-1)*n;while(e>=1||0===e);return i*Math.sqrt(-2*Math.log(e)/e)},n.prototype.levy=function(){var e=Math.pow(r(2.5)*Math.sin(1.5*Math.PI/2)/(1.5*r(1.25)*1.189207115002721),.6666666666666666);return this.gaussian()*e/Math.pow(Math.abs(this.gaussian()),.6666666666666666)}},59694:function(e){var i,n;window,n=function(){return function(e){var i={};function n(r){if(i[r])return i[r].exports;var s=i[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=i,n.d=function(e,i,r){n.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,i){if(1&i&&(e=n(e)),8&i||4&i&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var s in e)n.d(r,s,(function(i){return e[i]}).bind(null,s));return r},n.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(i,"a",i),i},n.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},n.p="",n(n.s=0)}([function(e,i,n){"use strict";n.r(i);var r,s=function(e,i){var n=i.x-e.x,r=i.y-e.y;return Math.sqrt(n*n+r*r)},a=function(e){return Math.PI/180*e},o=new Map,l=function(e){o.has(e)&&clearTimeout(o.get(e)),o.set(e,setTimeout(e,100))},h=function(e,i,n){for(var r,s=i.split(/[ ,]+/g),a=0;a<s.length;a+=1)r=s[a],e.addEventListener?e.addEventListener(r,n,!1):e.attachEvent&&e.attachEvent(r,n)},u=function(e,i,n){for(var r,s=i.split(/[ ,]+/g),a=0;a<s.length;a+=1)r=s[a],e.removeEventListener?e.removeEventListener(r,n):e.detachEvent&&e.detachEvent(r,n)},c=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},d=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},p=function(e,i){i.top||i.right||i.bottom||i.left?(e.style.top=i.top,e.style.right=i.right,e.style.bottom=i.bottom,e.style.left=i.left):(e.style.left=i.x+"px",e.style.top=i.y+"px")},f=function(e,i,n){var r=m(e);for(var s in r)if(r.hasOwnProperty(s)){if("string"==typeof i)r[s]=i+" "+n;else{for(var a="",o=0,l=i.length;o<l;o+=1)a+=i[o]+" "+n+", ";r[s]=a.slice(0,-2)}}return r},m=function(e){var i={};return i[e]="",["webkit","Moz","o"].forEach(function(n){i[n+e.charAt(0).toUpperCase()+e.slice(1)]=""}),i},g=function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n]);return e},A=function(e,i){if(e.length)for(var n=0,r=e.length;n<r;n+=1)i(e[n]);else i(e)},v="ontouchstart"in window,y=!!window.PointerEvent,x=!!window.MSPointerEvent,_={start:"mousedown",move:"mousemove",end:"mouseup"},b={};function E(){}function w(e,i){return this.identifier=i.identifier,this.position=i.position,this.frontPosition=i.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(i),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=w.id,w.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function M(e,i){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=e,this.id=M.id,M.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(i),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var n=getComputedStyle(this.options.zone.parentElement);return n&&"flex"===n.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}function C(e){var i=this;i.ids={},i.index=0,i.collections=[],i.scroll=d(),i.config(e),i.prepareCollections();var n=function(){var e;i.collections.forEach(function(n){n.forEach(function(n){e=n.el.getBoundingClientRect(),n.position={x:i.scroll.x+e.left,y:i.scroll.y+e.top}})})};h(window,"resize",function(){l(n)});var r=function(){i.scroll=d()};return h(window,"scroll",function(){l(r)}),i.collections}y?r={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:x?r={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:v?(r={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},b=_):r=_,E.prototype.on=function(e,i){var n,r=e.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],this._handlers_[n]=this._handlers_[n]||[],this._handlers_[n].push(i);return this},E.prototype.off=function(e,i){return this._handlers_=this._handlers_||{},void 0===e?this._handlers_={}:void 0===i?this._handlers_[e]=null:this._handlers_[e]&&this._handlers_[e].indexOf(i)>=0&&this._handlers_[e].splice(this._handlers_[e].indexOf(i),1),this},E.prototype.trigger=function(e,i){var n,r=this,s=e.split(/[ ,]+/g);r._handlers_=r._handlers_||{};for(var a=0;a<s.length;a+=1)n=s[a],r._handlers_[n]&&r._handlers_[n].length&&r._handlers_[n].forEach(function(e){e.call(r,{type:n,target:r},i)})},E.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=function(e,i){var n={};for(var r in e)e.hasOwnProperty(r)&&i.hasOwnProperty(r)?n[r]=i[r]:e.hasOwnProperty(r)&&(n[r]=e[r]);return n}(this.options,e))},E.prototype.bindEvt=function(e,i){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[i]=function(){"function"==typeof n["on"+i]?n["on"+i].apply(n,arguments):console.warn('[WARNING] : Missing "on'+i+'" handler.')},h(e,r[i],n._domHandlers_[i]),b[i]&&h(e,b[i],n._domHandlers_[i]),n},E.prototype.unbindEvt=function(e,i){return this._domHandlers_=this._domHandlers_||{},u(e,r[i],this._domHandlers_[i]),b[i]&&u(e,b[i],this._domHandlers_[i]),delete this._domHandlers_[i],this},w.prototype=new E,w.constructor=w,w.id=0,w.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},w.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",i=function(e,i){var n=m(e);for(var r in n)n.hasOwnProperty(r)&&(n[r]="50%");return n}("borderRadius",0),n=f("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},g(r.el,n),"circle"===this.options.shape&&g(r.back,i),g(r.front,i),this.applyStyles(r),this},w.prototype.applyStyles=function(e){for(var i in this.ui)if(this.ui.hasOwnProperty(i))for(var n in e[i])this.ui[i].style[n]=e[i][n];return this},w.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},w.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},w.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},w.prototype.show=function(e){var i=this;return i.options.dataOnly||(clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.addToDom(),i.restCallback(),setTimeout(function(){i.ui.el.style.opacity=1},0),i.showTimeout=setTimeout(function(){i.trigger("shown",i.instance),"function"==typeof e&&e.call(this)},i.options.fadeTime)),i},w.prototype.hide=function(e){var i=this;if(i.options.dataOnly)return i;if(i.ui.el.style.opacity=i.options.restOpacity,clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.removeTimeout=setTimeout(function(){var n="dynamic"===i.options.mode?"none":"block";i.ui.el.style.display=n,"function"==typeof e&&e.call(i),i.trigger("hidden",i.instance)},i.options.fadeTime),i.options.restJoystick){var n=i.options.restJoystick,r={};r.x=!0===n||!1!==n.x?0:i.instance.frontPosition.x,r.y=!0===n||!1!==n.y?0:i.instance.frontPosition.y,i.setPosition(e,r)}return i},w.prototype.setPosition=function(e,i){var n=this;n.frontPosition={x:i.x,y:i.y};var r=n.options.fadeTime+"ms",s={};s.front=f("transition",["transform"],r);var a={front:{}};a.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(s),n.applyStyles(a),n.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(n),n.restCallback()},n.options.fadeTime)},w.prototype.restCallback=function(){var e={};e.front=f("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},w.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},w.prototype.computeDirection=function(e){var i,n,r,s=e.angle.radian,a=Math.PI/4,o=Math.PI/2;if(s>a&&s<3*a&&!e.lockX?i="up":s>-a&&s<=a&&!e.lockY?i="left":s>-(3*a)&&s<=-a&&!e.lockX?i="down":e.lockY||(i="right"),e.lockY||(n=s>-o&&s<o?"left":"right"),e.lockX||(r=s>0?"up":"down"),e.force>this.options.threshold){var l,h={};for(l in this.direction)this.direction.hasOwnProperty(l)&&(h[l]=this.direction[l]);var u={};for(l in this.direction={x:n,y:r,angle:i},e.direction=this.direction,h)h[l]===this.direction[l]&&(u[l]=!0);if(u.x&&u.y&&u.angle)return e;u.x&&u.y||this.trigger("plain",e),u.x||this.trigger("plain:"+n,e),u.y||this.trigger("plain:"+r,e),u.angle||this.trigger("dir dir:"+i,e)}else this.resetDirection();return e},M.prototype=new E,M.constructor=M,M.id=0,M.prototype.prepareNipples=function(){var e=this.nipples;e.on=this.on.bind(this),e.off=this.off.bind(this),e.options=this.options,e.destroy=this.destroy.bind(this),e.ids=this.ids,e.id=this.id,e.processOnMove=this.processOnMove.bind(this),e.processOnEnd=this.processOnEnd.bind(this),e.get=function(i){if(void 0===i)return e[0];for(var n=0,r=e.length;n<r;n+=1)if(e[n].identifier===i)return e[n];return!1}},M.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},M.prototype.begin=function(){var e=this.options;if("static"===e.mode){var i=this.createNipple(e.position,this.manager.getIdentifier());i.add(),this.idles.push(i)}},M.prototype.createNipple=function(e,i){var n=this.manager.scroll,r={},s=this.options,a=this.parentIsFlex?n.x:n.x+this.box.left,o=this.parentIsFlex?n.y:n.y+this.box.top;if(e.x&&e.y)r={x:e.x-a,y:e.y-o};else if(e.top||e.right||e.bottom||e.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left,l.style.position="absolute",s.zone.appendChild(l);var h=l.getBoundingClientRect();s.zone.removeChild(l),r=e,e={x:h.left+n.x,y:h.top+n.y}}var u=new w(this,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:i,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(p(u.ui.el,r),p(u.ui.front,u.frontPosition)),this.nipples.push(u),this.trigger("added "+u.identifier+":added",u),this.manager.trigger("added "+u.identifier+":added",u),this.bindNipple(u),u},M.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},M.prototype.bindNipple=function(e){var i,n=this,r=function(e,r){i=e.type+" "+r.id+":"+e.type,n.trigger(i,r)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)},M.prototype.pressureFn=function(e,i,n){var r=this,s=0;clearInterval(r.pressureIntervals[n]),r.pressureIntervals[n]=setInterval((function(){var n=e.force||e.pressure||e.webkitForce||0;n!==s&&(i.trigger("pressure",n),r.trigger("pressure "+i.identifier+":pressure",n),s=n)}).bind(r),100)},M.prototype.onstart=function(e){var i=this,n=i.options,r=e;return e=c(e),i.updateBox(),A(e,function(s){i.actives.length<n.maxNumberOfNipples?i.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(i.manager.ids).forEach(function(n){if(0>Object.values(r.touches).findIndex(function(e){return e.identifier===n})){var s=[e[0]];s.identifier=n,i.processOnEnd(s)}}),i.actives.length<n.maxNumberOfNipples&&i.processOnStart(s))}),i.manager.bindDocument(),!1},M.prototype.processOnStart=function(e){var i,n=this,r=n.options,a=n.manager.getIdentifier(e),o=e.force||e.pressure||e.webkitForce||0,l={x:e.pageX,y:e.pageY},h=n.getOrCreate(a,l);h.identifier!==a&&n.manager.removeIdentifier(h.identifier),h.identifier=a;var u=function(i){i.trigger("start",i),n.trigger("start "+i.id+":start",i),i.show(),o>0&&n.pressureFn(e,i,i.identifier),n.processOnMove(e)};if((i=n.idles.indexOf(h))>=0&&n.idles.splice(i,1),n.actives.push(h),n.ids.push(h.identifier),"semi"!==r.mode)u(h);else{if(!(s(l,h.position)<=r.catchDistance))return h.destroy(),void n.processOnStart(e);u(h)}return h},M.prototype.getOrCreate=function(e,i){var n,r=this.options;return/(semi|static)/.test(r.mode)?(n=this.idles[0])?(this.idles.splice(0,1),n):"semi"===r.mode?this.createNipple(i,e):(console.warn("Coudln't find the needed nipple."),!1):n=this.createNipple(i,e)},M.prototype.processOnMove=function(e){var i=this.options,n=this.manager.getIdentifier(e),r=this.nipples.get(n),o=this.manager.scroll;if(isNaN(e.buttons)?0!==e.pressure:0!==e.buttons){if(!r)return console.error("Found zombie joystick with ID "+n),void this.manager.removeIdentifier(n);if(i.dynamicPage){var l,h,u=r.el.getBoundingClientRect();r.position={x:o.x+u.left,y:o.y+u.top}}r.identifier=n;var c=r.options.size/2,d={x:e.pageX,y:e.pageY};i.lockX&&(d.y=r.position.y),i.lockY&&(d.x=r.position.x);var p,f,m,g,A,v,y,x,_,b=s(d,r.position),E=(p=d,m=(f=r.position).x-p.x,180/Math.PI*Math.atan2(f.y-p.y,m)),w=a(E),M=b/c,C={distance:b,position:d};if("circle"===r.options.shape?(g=Math.min(b,c),v=r.position,y=g,_={x:0,y:0},x=a(x=E),_.x=v.x-y*Math.cos(x),_.y=v.y-y*Math.sin(x),A=_):(l=d,h=r.position,g=s(A={x:Math.min(Math.max(l.x,h.x-c),h.x+c),y:Math.min(Math.max(l.y,h.y-c),h.y+c)},r.position)),i.follow){if(b>c){var S=d.x-A.x,T=d.y-A.y;r.position.x+=S,r.position.y+=T,r.el.style.top=r.position.y-(this.box.top+o.y)+"px",r.el.style.left=r.position.x-(this.box.left+o.x)+"px",b=s(d,r.position)}}else d=A,b=g;var R=d.x-r.position.x,I=d.y-r.position.y;r.frontPosition={x:R,y:I},i.dataOnly||(r.ui.front.style.transform="translate("+R+"px,"+I+"px)");var B={identifier:r.identifier,position:d,force:M,pressure:e.force||e.pressure||e.webkitForce||0,distance:b,angle:{radian:w,degree:E},vector:{x:R/c,y:-I/c},raw:C,instance:r,lockX:i.lockX,lockY:i.lockY};(B=r.computeDirection(B)).angle={radian:a(180-E),degree:180-E},r.trigger("move",B),this.trigger("move "+r.id+":move",B)}else this.processOnEnd(e)},M.prototype.processOnEnd=function(e){var i=this,n=i.options,r=i.manager.getIdentifier(e),s=i.nipples.get(r),a=i.manager.removeIdentifier(s.identifier);s&&(n.dataOnly||s.hide(function(){"dynamic"===n.mode&&(s.trigger("removed",s),i.trigger("removed "+s.id+":removed",s),i.manager.trigger("removed "+s.id+":removed",s),s.destroy())}),clearInterval(i.pressureIntervals[s.identifier]),s.resetDirection(),s.trigger("end",s),i.trigger("end "+s.id+":end",s),i.ids.indexOf(s.identifier)>=0&&i.ids.splice(i.ids.indexOf(s.identifier),1),i.actives.indexOf(s)>=0&&i.actives.splice(i.actives.indexOf(s),1),/(semi|static)/.test(n.mode)?i.idles.push(s):i.nipples.indexOf(s)>=0&&i.nipples.splice(i.nipples.indexOf(s),1),i.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(i.manager.ids[a.id]=a.identifier))},M.prototype.onDestroyed=function(e,i){this.nipples.indexOf(i)>=0&&this.nipples.splice(this.nipples.indexOf(i),1),this.actives.indexOf(i)>=0&&this.actives.splice(this.actives.indexOf(i),1),this.idles.indexOf(i)>=0&&this.idles.splice(this.idles.indexOf(i),1),this.ids.indexOf(i.identifier)>=0&&this.ids.splice(this.ids.indexOf(i.identifier),1),this.manager.removeIdentifier(i.identifier),this.manager.unbindDocument()},M.prototype.destroy=function(){for(var e in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(e){e.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(e)&&clearInterval(this.pressureIntervals[e]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()},C.prototype=new E,C.constructor=C,C.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(i){var n;return e.collections.every(function(e){return!(n=e.get(i))}),n}},C.prototype.create=function(e){return this.createCollection(e)},C.prototype.createCollection=function(e){var i=new M(this,e);return this.bindCollection(i),this.collections.push(i),i},C.prototype.bindCollection=function(e){var i,n=this,r=function(e,r){i=e.type+" "+r.id+":"+e.type,n.trigger(i,r)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)},C.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},C.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},C.prototype.getIdentifier=function(e){var i;return e?void 0===(i=void 0===e.identifier?e.pointerId:e.identifier)&&(i=this.latest||0):i=this.index,void 0===this.ids[i]&&(this.ids[i]=this.index,this.index+=1),this.latest=i,this.ids[i]},C.prototype.removeIdentifier=function(e){var i={};for(var n in this.ids)if(this.ids[n]===e){i.id=n,i.identifier=this.ids[n],delete this.ids[n];break}return i},C.prototype.onmove=function(e){return this.onAny("move",e),!1},C.prototype.onend=function(e){return this.onAny("end",e),!1},C.prototype.oncancel=function(e){return this.onAny("end",e),!1},C.prototype.onAny=function(e,i){var n,r=this,s="processOn"+e.charAt(0).toUpperCase()+e.slice(1);return A(i=c(i),function(e){n=r.getIdentifier(e),A(r.collections,(function(e,i,n){n.ids.indexOf(i)>=0&&(n[s](e),e._found_=!0)}).bind(null,e,n)),e._found_||r.removeIdentifier(n)}),!1},C.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(e){e.destroy()}),this.off()},C.prototype.onDestroyed=function(e,i){if(0>this.collections.indexOf(i))return!1;this.collections.splice(this.collections.indexOf(i),1)};var S=new C;i.default={create:function(e){return S.create(e)},factory:S}}]).default},e.exports=n()},37964:function(e,i,n){"use strict";n.r(i),n.d(i,{default:()=>r});var r=function(e){return"function"==typeof e?e:"string"==typeof e?function(i){return i[e]}:function(i){return e}}},1466:function(e,i,n){"use strict";let r;n.d(i,{CJI:()=>te,D1R:()=>c,DvJ:()=>tj,FM8:()=>I,Hyl:()=>iB,Ilk:()=>ts,JOQ:()=>t$,KI_:()=>d,Kj0:()=>tG,Ltg:()=>X,M8C:()=>R,Mig:()=>re,N$j:()=>id,OdW:()=>iA,Ox3:()=>n9,PMe:()=>n2,Pa4:()=>Y,TUv:()=>ic,TlE:()=>td,Tme:()=>e$,USm:()=>eO,Vkp:()=>B,Wl3:()=>s,YBo:()=>nw,ZAu:()=>t9,Zp0:()=>rt,_fP:()=>K,a$l:()=>tm,aNw:()=>nj,cPb:()=>tK,cek:()=>n8,dSO:()=>l,dUE:()=>nN,dpR:()=>nK,ehD:()=>a,ejS:()=>iI,hH6:()=>nW,iDF:()=>nh,iKG:()=>t7,iLg:()=>nU,iUV:()=>ru,m7l:()=>nz,nls:()=>iv,qlB:()=>tp,rpg:()=>h,u9r:()=>tE,uWy:()=>u,vBJ:()=>th,x12:()=>iC,xEZ:()=>q,xo$:()=>nv,xoR:()=>nE,xsS:()=>ie,yC1:()=>nF,yGw:()=>eC,yxD:()=>nX});let s=0,a=2,o="attached",l=303,h=1e3,u=1001,c=1008,d="srgb",p="srgb-linear",f="display-p3-linear",m="linear",g="srgb",A="rec709";class v{addEventListener(e,i){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(i)&&n[e].push(i)}hasEventListener(e,i){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(i)}removeEventListener(e,i){if(void 0===this._listeners)return;let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(i);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let i=this._listeners[e.type];if(void 0!==i){e.target=this;let n=i.slice(0);for(let i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}let y=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],x=1234567,_=Math.PI/180,b=180/Math.PI;function E(){let e=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0;return(y[255&e]+y[e>>8&255]+y[e>>16&255]+y[e>>24&255]+"-"+y[255&i]+y[i>>8&255]+"-"+y[i>>16&15|64]+y[i>>24&255]+"-"+y[63&n|128]+y[n>>8&255]+"-"+y[n>>16&255]+y[n>>24&255]+y[255&r]+y[r>>8&255]+y[r>>16&255]+y[r>>24&255]).toLowerCase()}function w(e,i,n){return Math.max(i,Math.min(n,e))}function M(e,i){return(e%i+i)%i}function C(e,i,n){return(1-n)*e+n*i}function S(e,i){switch(i.constructor){case Float32Array:return e;case Uint32Array:return e/0xffffffff;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/0x7fffffff,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function T(e,i){switch(i.constructor){case Float32Array:return e;case Uint32Array:return Math.round(0xffffffff*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(0x7fffffff*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}let R={DEG2RAD:_,RAD2DEG:b,generateUUID:E,clamp:w,euclideanModulo:M,mapLinear:function(e,i,n,r,s){return r+(e-i)*(s-r)/(n-i)},inverseLerp:function(e,i,n){return e!==i?(n-e)/(i-e):0},lerp:C,damp:function(e,i,n,r){return C(e,i,1-Math.exp(-n*r))},pingpong:function(e,i=1){return i-Math.abs(M(e,2*i)-i)},smoothstep:function(e,i,n){return e<=i?0:e>=n?1:(e=(e-i)/(n-i))*e*(3-2*e)},smootherstep:function(e,i,n){return e<=i?0:e>=n?1:(e=(e-i)/(n-i))*e*e*(e*(6*e-15)+10)},randInt:function(e,i){return e+Math.floor(Math.random()*(i-e+1))},randFloat:function(e,i){return e+Math.random()*(i-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(x=e);let i=x+=0x6d2b79f5;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/0x100000000},degToRad:function(e){return e*_},radToDeg:function(e){return e*b},isPowerOfTwo:function(e){return(e&e-1)==0&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,i,n,r,s){let a=Math.cos,o=Math.sin,l=a(n/2),h=o(n/2),u=a((i+r)/2),c=o((i+r)/2),d=a((i-r)/2),p=o((i-r)/2),f=a((r-i)/2),m=o((r-i)/2);switch(s){case"XYX":e.set(l*c,h*d,h*p,l*u);break;case"YZY":e.set(h*p,l*c,h*d,l*u);break;case"ZXZ":e.set(h*d,h*p,l*c,l*u);break;case"XZX":e.set(l*c,h*m,h*f,l*u);break;case"YXY":e.set(h*f,l*c,h*m,l*u);break;case"ZYZ":e.set(h*m,h*f,l*c,l*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}},normalize:T,denormalize:S};class I{constructor(e=0,i=0){I.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let i=this.x,n=this.y,r=e.elements;return this.x=r[0]*i+r[3]*n+r[6],this.y=r[1]*i+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===i?Math.PI/2:Math.acos(w(this.dot(e)/i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){let n=Math.cos(i),r=Math.sin(i),s=this.x-e.x,a=this.y-e.y;return this.x=s*n-a*r+e.x,this.y=s*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class B{constructor(e,i,n,r,s,a,o,l,h){B.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,i,n,r,s,a,o,l,h)}set(e,i,n,r,s,a,o,l,h){let u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=n,u[7]=a,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let n=e.elements,r=i.elements,s=this.elements,a=n[0],o=n[3],l=n[6],h=n[1],u=n[4],c=n[7],d=n[2],p=n[5],f=n[8],m=r[0],g=r[3],A=r[6],v=r[1],y=r[4],x=r[7],_=r[2],b=r[5],E=r[8];return s[0]=a*m+o*v+l*_,s[3]=a*g+o*y+l*b,s[6]=a*A+o*x+l*E,s[1]=h*m+u*v+c*_,s[4]=h*g+u*y+c*b,s[7]=h*A+u*x+c*E,s[2]=d*m+p*v+f*_,s[5]=d*g+p*y+f*b,s[8]=d*A+p*x+f*E,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8];return i*a*u-i*o*h-n*s*u+n*o*l+r*s*h-r*a*l}invert(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=u*a-o*h,d=o*l-u*s,p=h*s-a*l,f=i*c+n*d+r*p;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);let m=1/f;return e[0]=c*m,e[1]=(r*h-u*n)*m,e[2]=(o*n-r*a)*m,e[3]=d*m,e[4]=(u*i-r*l)*m,e[5]=(r*s-o*i)*m,e[6]=p*m,e[7]=(n*l-h*i)*m,e[8]=(a*i-n*s)*m,this}transpose(){let e;let i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,r,s,a,o){let l=Math.cos(s),h=Math.sin(s);return this.set(n*l,n*h,-n*(l*a+h*o)+a+e,-r*h,r*l,-r*(-h*a+l*o)+o+i,0,0,1),this}scale(e,i){return this.premultiply(L.makeScale(e,i)),this}rotate(e){return this.premultiply(L.makeRotation(-e)),this}translate(e,i){return this.premultiply(L.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){let i=this.elements,n=e.elements;for(let e=0;e<9;e++)if(i[e]!==n[e])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){let n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let L=new B;function P(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let D={},N=new B().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),O=new B().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),U={[p]:{transfer:m,primaries:A,toReference:e=>e,fromReference:e=>e},[d]:{transfer:g,primaries:A,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[f]:{transfer:m,primaries:"p3",toReference:e=>e.applyMatrix3(O),fromReference:e=>e.applyMatrix3(N)},"display-p3":{transfer:g,primaries:"p3",toReference:e=>e.convertSRGBToLinear().applyMatrix3(O),fromReference:e=>e.applyMatrix3(N).convertLinearToSRGB()}},k=new Set([p,f]),F={enabled:!0,_workingColorSpace:p,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(colorSpace){if(!k.has(colorSpace))throw Error(`Unsupported working color space, "${colorSpace}".`);this._workingColorSpace=colorSpace},convert:function(e,i,n){if(!1===this.enabled||i===n||!i||!n)return e;let r=U[i].toReference;return(0,U[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,i){return this.convert(e,this._workingColorSpace,i)},toWorkingColorSpace:function(e,i){return this.convert(e,i,this._workingColorSpace)},getPrimaries:function(e){return U[e].primaries},getTransfer:function(e){return""===e?m:U[e].transfer}};function z(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function G(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class V{static getDataURL(e){let i;if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)i=e;else{void 0===r&&(r=P("canvas")),r.width=e.width,r.height=e.height;let n=r.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),i=r}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let i=P("canvas");i.width=e.width,i.height=e.height;let n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height);let r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let e=0;e<s.length;e++)s[e]=255*z(s[e]/255);return n.putImageData(r,0,0),i}if(!e.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e;{let i=e.data.slice(0);for(let e=0;e<i.length;e++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[e]=Math.floor(255*z(i[e]/255)):i[e]=z(i[e]);return{data:i,width:e.width,height:e.height}}}}let j=0;class H{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:j++}),this.uuid=E(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let i=void 0===e||"string"==typeof e;if(!i&&void 0!==e.images[this.uuid])return e.images[this.uuid];let n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let i=0,n=r.length;i<n;i++)r[i].isDataTexture?e.push(Q(r[i].image)):e.push(Q(r[i]))}else e=Q(r);n.url=e}return i||(e.images[this.uuid]=n),n}}function Q(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?V.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let W=0;class q extends v{constructor(e=q.DEFAULT_IMAGE,i=q.DEFAULT_MAPPING,n=u,r=u,s=1006,a=c,o=1023,l=1009,h=q.DEFAULT_ANISOTROPY,d=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:W++}),this.uuid=E(),this.name="",this.source=new H(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=l,this.offset=new I(0,0),this.repeat=new I(1,1),this.center=new I(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new B,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let i=void 0===e||"string"==typeof e;if(!i&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case h:e.x=e.x-Math.floor(e.x);break;case u:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case h:e.y=e.y-Math.floor(e.y);break;case u:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}q.DEFAULT_IMAGE=null,q.DEFAULT_MAPPING=300,q.DEFAULT_ANISOTROPY=1;class X{constructor(e=0,i=0,n=0,r=1){X.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,r){return this.x=e,this.y=i,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let i=this.x,n=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*i+a[4]*n+a[8]*r+a[12]*s,this.y=a[1]*i+a[5]*n+a[9]*r+a[13]*s,this.z=a[2]*i+a[6]*n+a[10]*r+a[14]*s,this.w=a[3]*i+a[7]*n+a[11]*r+a[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,r,s;let a=e.elements,o=a[0],l=a[4],h=a[8],u=a[1],c=a[5],d=a[9],p=a[2],f=a[6],m=a[10];if(.01>Math.abs(l-u)&&.01>Math.abs(h-p)&&.01>Math.abs(d-f)){if(.1>Math.abs(l+u)&&.1>Math.abs(h+p)&&.1>Math.abs(d+f)&&.1>Math.abs(o+c+m-3))return this.set(1,0,0,0),this;i=Math.PI;let e=(o+1)/2,a=(c+1)/2,g=(m+1)/2,A=(l+u)/4,v=(h+p)/4,y=(d+f)/4;return e>a&&e>g?e<.01?(n=0,r=.707106781,s=.707106781):(r=A/(n=Math.sqrt(e)),s=v/n):a>g?a<.01?(n=.707106781,r=0,s=.707106781):(n=A/(r=Math.sqrt(a)),s=y/r):g<.01?(n=.707106781,r=.707106781,s=0):(n=v/(s=Math.sqrt(g)),r=y/s),this.set(n,r,s,i),this}let g=Math.sqrt((f-d)*(f-d)+(h-p)*(h-p)+(u-l)*(u-l));return .001>Math.abs(g)&&(g=1),this.x=(f-d)/g,this.y=(h-p)/g,this.z=(u-l)/g,this.w=Math.acos((o+c+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class K{constructor(e=0,i=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=n,this._w=r}static slerpFlat(e,i,n,r,s,a,o){let l=n[r+0],h=n[r+1],u=n[r+2],c=n[r+3],d=s[a+0],p=s[a+1],f=s[a+2],m=s[a+3];if(0===o){e[i+0]=l,e[i+1]=h,e[i+2]=u,e[i+3]=c;return}if(1===o){e[i+0]=d,e[i+1]=p,e[i+2]=f,e[i+3]=m;return}if(c!==m||l!==d||h!==p||u!==f){let e=1-o,i=l*d+h*p+u*f+c*m,n=i>=0?1:-1,r=1-i*i;if(r>Number.EPSILON){let s=Math.sqrt(r),a=Math.atan2(s,i*n);e=Math.sin(e*a)/s,o=Math.sin(o*a)/s}let s=o*n;if(l=l*e+d*s,h=h*e+p*s,u=u*e+f*s,c=c*e+m*s,e===1-o){let e=1/Math.sqrt(l*l+h*h+u*u+c*c);l*=e,h*=e,u*=e,c*=e}}e[i]=l,e[i+1]=h,e[i+2]=u,e[i+3]=c}static multiplyQuaternionsFlat(e,i,n,r,s,a){let o=n[r],l=n[r+1],h=n[r+2],u=n[r+3],c=s[a],d=s[a+1],p=s[a+2],f=s[a+3];return e[i]=o*f+u*c+l*p-h*d,e[i+1]=l*f+u*d+h*c-o*p,e[i+2]=h*f+u*p+o*d-l*c,e[i+3]=u*f-o*c-l*d-h*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,n,r){return this._x=e,this._y=i,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){let n=e._x,r=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,h=o(n/2),u=o(r/2),c=o(s/2),d=l(n/2),p=l(r/2),f=l(s/2);switch(a){case"XYZ":this._x=d*u*c+h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c-d*p*f;break;case"YXZ":this._x=d*u*c+h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c+d*p*f;break;case"ZXY":this._x=d*u*c-h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c-d*p*f;break;case"ZYX":this._x=d*u*c-h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c+d*p*f;break;case"YZX":this._x=d*u*c+h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c-d*p*f;break;case"XZY":this._x=d*u*c-h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===i&&this._onChangeCallback(),this}setFromAxisAngle(e,i){let n=i/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let i=e.elements,n=i[0],r=i[4],s=i[8],a=i[1],o=i[5],l=i[9],h=i[2],u=i[6],c=i[10],d=n+o+c;if(d>0){let e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(u-l)*e,this._y=(s-h)*e,this._z=(a-r)*e}else if(n>o&&n>c){let e=2*Math.sqrt(1+n-o-c);this._w=(u-l)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(s+h)/e}else if(o>c){let e=2*Math.sqrt(1+o-n-c);this._w=(s-h)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(l+u)/e}else{let e=2*Math.sqrt(1+c-n-o);this._w=(a-r)/e,this._x=(s+h)/e,this._y=(l+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let n=e.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x),this._w=n,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(w(this.dot(e),-1,1)))}rotateTowards(e,i){let n=this.angleTo(e);if(0===n)return this;let r=Math.min(1,i/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){let n=e._x,r=e._y,s=e._z,a=e._w,o=i._x,l=i._y,h=i._z,u=i._w;return this._x=n*u+a*o+r*h-s*l,this._y=r*u+a*l+s*o-n*h,this._z=s*u+a*h+n*l-r*o,this._w=a*u-n*o-r*l-s*h,this._onChangeCallback(),this}slerp(e,i){if(0===i)return this;if(1===i)return this.copy(e);let n=this._x,r=this._y,s=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=s,this;let l=1-o*o;if(l<=Number.EPSILON){let e=1-i;return this._w=e*a+i*this._w,this._x=e*n+i*this._x,this._y=e*r+i*this._y,this._z=e*s+i*this._z,this.normalize(),this}let h=Math.sqrt(l),u=Math.atan2(h,o),c=Math.sin((1-i)*u)/h,d=Math.sin(i*u)/h;return this._w=a*c+this._w*d,this._x=n*c+this._x*d,this._y=r*c+this._y*d,this._z=s*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,i,n){return this.copy(e).slerp(i,n)}random(){let e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(i),s*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Y{constructor(e=0,i=0,n=0){Y.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return void 0===n&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(Z.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(Z.setFromAxisAngle(e,i))}applyMatrix3(e){let i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6]*r,this.y=s[1]*i+s[4]*n+s[7]*r,this.z=s[2]*i+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let i=this.x,n=this.y,r=this.z,s=e.elements,a=1/(s[3]*i+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*i+s[4]*n+s[8]*r+s[12])*a,this.y=(s[1]*i+s[5]*n+s[9]*r+s[13])*a,this.z=(s[2]*i+s[6]*n+s[10]*r+s[14])*a,this}applyQuaternion(e){let i=this.x,n=this.y,r=this.z,s=e.x,a=e.y,o=e.z,l=e.w,h=2*(a*r-o*n),u=2*(o*i-s*r),c=2*(s*n-a*i);return this.x=i+l*h+a*c-o*u,this.y=n+l*u+o*h-s*c,this.z=r+l*c+s*u-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[4]*n+s[8]*r,this.y=s[1]*i+s[5]*n+s[9]*r,this.z=s[2]*i+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){let n=e.x,r=e.y,s=e.z,a=i.x,o=i.y,l=i.z;return this.x=r*l-s*o,this.y=s*a-n*l,this.z=n*o-r*a,this}projectOnVector(e){let i=e.lengthSq();if(0===i)return this.set(0,0,0);let n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return J.copy(this).projectOnVector(e),this.sub(J)}reflect(e){return this.sub(J.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===i?Math.PI/2:Math.acos(w(this.dot(e)/i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return i*i+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){let r=Math.sin(i)*e;return this.x=r*Math.sin(n),this.y=Math.cos(i)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){let i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){let i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,4*i)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,3*i)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=Math.random()*Math.PI*2,i=2*Math.random()-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let J=new Y,Z=new K;class ${constructor(e=new Y(Infinity,Infinity,Infinity),i=new Y(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i+=3)this.expandByPoint(et.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,n=e.count;i<n;i++)this.expandByPoint(et.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){let n=et.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);let n=e.geometry;if(void 0!==n){let r=n.getAttribute("position");if(!0===i&&void 0!==r&&!0!==e.isInstancedMesh)for(let i=0,n=r.count;i<n;i++)!0===e.isMesh?e.getVertexPosition(i,et):et.fromBufferAttribute(r,i),et.applyMatrix4(e.matrixWorld),this.expandByPoint(et);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),ei.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),ei.copy(n.boundingBox)),ei.applyMatrix4(e.matrixWorld),this.union(ei)}let r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],i);return this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)&&!(e.z<this.min.z)&&!(e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)&&!(e.max.z<this.min.z)&&!(e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,et),et.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,n;return e.normal.x>0?(i=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),i<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(eh),eu.subVectors(this.max,eh),en.subVectors(e.a,eh),er.subVectors(e.b,eh),es.subVectors(e.c,eh),ea.subVectors(er,en),eo.subVectors(es,er),el.subVectors(en,es);let i=[0,-ea.z,ea.y,0,-eo.z,eo.y,0,-el.z,el.y,ea.z,0,-ea.x,eo.z,0,-eo.x,el.z,0,-el.x,-ea.y,ea.x,0,-eo.y,eo.x,0,-el.y,el.x,0];return!!(ep(i,en,er,es,eu)&&ep(i=[1,0,0,0,1,0,0,0,1],en,er,es,eu))&&(ec.crossVectors(ea,eo),ep(i=[ec.x,ec.y,ec.z],en,er,es,eu))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,et).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(et).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ee[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ee[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ee[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ee[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ee[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ee[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ee[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ee[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ee)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let ee=[new Y,new Y,new Y,new Y,new Y,new Y,new Y,new Y],et=new Y,ei=new $,en=new Y,er=new Y,es=new Y,ea=new Y,eo=new Y,el=new Y,eh=new Y,eu=new Y,ec=new Y,ed=new Y;function ep(e,i,n,r,s){for(let a=0,o=e.length-3;a<=o;a+=3){ed.fromArray(e,a);let o=s.x*Math.abs(ed.x)+s.y*Math.abs(ed.y)+s.z*Math.abs(ed.z),l=i.dot(ed),h=n.dot(ed),u=r.dot(ed);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>o)return!1}return!0}let ef=new $,em=new Y,eg=new Y;class eA{constructor(e=new Y,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){let n=this.center;void 0!==i?n.copy(i):ef.setFromPoints(e).getCenter(n);let r=0;for(let i=0,s=e.length;i<s;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){let n=this.center.distanceToSquared(e);return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;em.subVectors(e,this.center);let i=em.lengthSq();if(i>this.radius*this.radius){let e=Math.sqrt(i),n=(e-this.radius)*.5;this.center.addScaledVector(em,n/e),this.radius+=n}return this}union(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(eg.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(em.copy(e.center).add(eg)),this.expandByPoint(em.copy(e.center).sub(eg)))),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}let ev=new Y,ey=new Y,ex=new Y,e_=new Y,eb=new Y,eE=new Y,ew=new Y;class eM{constructor(e=new Y,i=new Y(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ev)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);let n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let i=ev.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(ev.copy(this.origin).addScaledVector(this.direction,i),ev.distanceToSquared(e))}distanceSqToSegment(e,i,n,r){let s,a,o,l;ey.copy(e).add(i).multiplyScalar(.5),ex.copy(i).sub(e).normalize(),e_.copy(this.origin).sub(ey);let h=.5*e.distanceTo(i),u=-this.direction.dot(ex),c=e_.dot(this.direction),d=-e_.dot(ex),p=e_.lengthSq(),f=Math.abs(1-u*u);if(f>0){if(s=u*d-c,a=u*c-d,l=h*f,s>=0){if(a>=-l){if(a<=l){let e=1/f;s*=e,a*=e,o=s*(s+u*a+2*c)+a*(u*s+a+2*d)+p}else o=-(s=Math.max(0,-(u*(a=h)+c)))*s+a*(a+2*d)+p}else o=-(s=Math.max(0,-(u*(a=-h)+c)))*s+a*(a+2*d)+p}else a<=-l?(a=(s=Math.max(0,-(-u*h+c)))>0?-h:Math.min(Math.max(-h,-d),h),o=-s*s+a*(a+2*d)+p):a<=l?(s=0,o=(a=Math.min(Math.max(-h,-d),h))*(a+2*d)+p):(a=(s=Math.max(0,-(u*h+c)))>0?h:Math.min(Math.max(-h,-d),h),o=-s*s+a*(a+2*d)+p)}else a=u>0?-h:h,o=-(s=Math.max(0,-(u*a+c)))*s+a*(a+2*d)+p;return n&&n.copy(this.origin).addScaledVector(this.direction,s),r&&r.copy(ey).addScaledVector(ex,a),o}intersectSphere(e,i){ev.subVectors(e.center,this.origin);let n=ev.dot(this.direction),r=ev.dot(ev)-n*n,s=e.radius*e.radius;if(r>s)return null;let a=Math.sqrt(s-r),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let i=e.normal.dot(this.direction);if(0===i)return 0===e.distanceToPoint(this.origin)?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/i;return n>=0?n:null}intersectPlane(e,i){let n=this.distanceToPlane(e);return null===n?null:this.at(n,i)}intersectsPlane(e){let i=e.distanceToPoint(this.origin);return!!(0===i||e.normal.dot(this.direction)*i<0)}intersectBox(e,i){let n,r,s,a,o,l;let h=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return(h>=0?(n=(e.min.x-d.x)*h,r=(e.max.x-d.x)*h):(n=(e.max.x-d.x)*h,r=(e.min.x-d.x)*h),u>=0?(s=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),n>a||s>r)?null:((s>n||isNaN(n))&&(n=s),(a<r||isNaN(r))&&(r=a),c>=0?(o=(e.min.z-d.z)*c,l=(e.max.z-d.z)*c):(o=(e.max.z-d.z)*c,l=(e.min.z-d.z)*c),n>l||o>r)?null:((o>n||n!=n)&&(n=o),(l<r||r!=r)&&(r=l),r<0)?null:this.at(n>=0?n:r,i)}intersectsBox(e){return null!==this.intersectBox(e,ev)}intersectTriangle(e,i,n,r,s){let a;eb.subVectors(i,e),eE.subVectors(n,e),ew.crossVectors(eb,eE);let o=this.direction.dot(ew);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}e_.subVectors(this.origin,e);let l=a*this.direction.dot(eE.crossVectors(e_,eE));if(l<0)return null;let h=a*this.direction.dot(eb.cross(e_));if(h<0||l+h>o)return null;let u=-a*e_.dot(ew);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class eC{constructor(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g){eC.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g)}set(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g){let A=this.elements;return A[0]=e,A[4]=i,A[8]=n,A[12]=r,A[1]=s,A[5]=a,A[9]=o,A[13]=l,A[2]=h,A[6]=u,A[10]=c,A[14]=d,A[3]=p,A[7]=f,A[11]=m,A[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new eC().fromArray(this.elements)}copy(e){let i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){let i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){let i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){let i=this.elements,n=e.elements,r=1/eS.setFromMatrixColumn(e,0).length(),s=1/eS.setFromMatrixColumn(e,1).length(),a=1/eS.setFromMatrixColumn(e,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=0,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=0,i[8]=n[8]*a,i[9]=n[9]*a,i[10]=n[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){let i=this.elements,n=e.x,r=e.y,s=e.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(r),h=Math.sin(r),u=Math.cos(s),c=Math.sin(s);if("XYZ"===e.order){let e=a*u,n=a*c,r=o*u,s=o*c;i[0]=l*u,i[4]=-l*c,i[8]=h,i[1]=n+r*h,i[5]=e-s*h,i[9]=-o*l,i[2]=s-e*h,i[6]=r+n*h,i[10]=a*l}else if("YXZ"===e.order){let e=l*u,n=l*c,r=h*u,s=h*c;i[0]=e+s*o,i[4]=r*o-n,i[8]=a*h,i[1]=a*c,i[5]=a*u,i[9]=-o,i[2]=n*o-r,i[6]=s+e*o,i[10]=a*l}else if("ZXY"===e.order){let e=l*u,n=l*c,r=h*u,s=h*c;i[0]=e-s*o,i[4]=-a*c,i[8]=r+n*o,i[1]=n+r*o,i[5]=a*u,i[9]=s-e*o,i[2]=-a*h,i[6]=o,i[10]=a*l}else if("ZYX"===e.order){let e=a*u,n=a*c,r=o*u,s=o*c;i[0]=l*u,i[4]=r*h-n,i[8]=e*h+s,i[1]=l*c,i[5]=s*h+e,i[9]=n*h-r,i[2]=-h,i[6]=o*l,i[10]=a*l}else if("YZX"===e.order){let e=a*l,n=a*h,r=o*l,s=o*h;i[0]=l*u,i[4]=s-e*c,i[8]=r*c+n,i[1]=c,i[5]=a*u,i[9]=-o*u,i[2]=-h*u,i[6]=n*c+r,i[10]=e-s*c}else if("XZY"===e.order){let e=a*l,n=a*h,r=o*l,s=o*h;i[0]=l*u,i[4]=-c,i[8]=h*u,i[1]=e*c+s,i[5]=a*u,i[9]=n*c-r,i[2]=r*c-n,i[6]=o*u,i[10]=s*c+e}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(eR,e,eI)}lookAt(e,i,n){let r=this.elements;return eP.subVectors(e,i),0===eP.lengthSq()&&(eP.z=1),eP.normalize(),eB.crossVectors(n,eP),0===eB.lengthSq()&&(1===Math.abs(n.z)?eP.x+=1e-4:eP.z+=1e-4,eP.normalize(),eB.crossVectors(n,eP)),eB.normalize(),eL.crossVectors(eP,eB),r[0]=eB.x,r[4]=eL.x,r[8]=eP.x,r[1]=eB.y,r[5]=eL.y,r[9]=eP.y,r[2]=eB.z,r[6]=eL.z,r[10]=eP.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let n=e.elements,r=i.elements,s=this.elements,a=n[0],o=n[4],l=n[8],h=n[12],u=n[1],c=n[5],d=n[9],p=n[13],f=n[2],m=n[6],g=n[10],A=n[14],v=n[3],y=n[7],x=n[11],_=n[15],b=r[0],E=r[4],w=r[8],M=r[12],C=r[1],S=r[5],T=r[9],R=r[13],I=r[2],B=r[6],L=r[10],P=r[14],D=r[3],N=r[7],O=r[11],U=r[15];return s[0]=a*b+o*C+l*I+h*D,s[4]=a*E+o*S+l*B+h*N,s[8]=a*w+o*T+l*L+h*O,s[12]=a*M+o*R+l*P+h*U,s[1]=u*b+c*C+d*I+p*D,s[5]=u*E+c*S+d*B+p*N,s[9]=u*w+c*T+d*L+p*O,s[13]=u*M+c*R+d*P+p*U,s[2]=f*b+m*C+g*I+A*D,s[6]=f*E+m*S+g*B+A*N,s[10]=f*w+m*T+g*L+A*O,s[14]=f*M+m*R+g*P+A*U,s[3]=v*b+y*C+x*I+_*D,s[7]=v*E+y*S+x*B+_*N,s[11]=v*w+y*T+x*L+_*O,s[15]=v*M+y*R+x*P+_*U,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){let e=this.elements,i=e[0],n=e[4],r=e[8],s=e[12],a=e[1],o=e[5],l=e[9],h=e[13],u=e[2],c=e[6],d=e[10],p=e[14],f=e[3],m=e[7];return f*(+s*l*c-r*h*c-s*o*d+n*h*d+r*o*p-n*l*p)+m*(+i*l*p-i*h*d+s*a*d-r*a*p+r*h*u-s*l*u)+e[11]*(+i*h*c-i*o*p-s*a*c+n*a*p+s*o*u-n*h*u)+e[15]*(-r*o*u-i*l*c+i*o*d+r*a*c-n*a*d+n*l*u)}transpose(){let e;let i=this.elements;return e=i[1],i[1]=i[4],i[4]=e,e=i[2],i[2]=i[8],i[8]=e,e=i[6],i[6]=i[9],i[9]=e,e=i[3],i[3]=i[12],i[12]=e,e=i[7],i[7]=i[13],i[13]=e,e=i[11],i[11]=i[14],i[14]=e,this}setPosition(e,i,n){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=n),this}invert(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],A=e[15],v=c*g*h-m*d*h+m*l*p-o*g*p-c*l*A+o*d*A,y=f*d*h-u*g*h-f*l*p+a*g*p+u*l*A-a*d*A,x=u*m*h-f*c*h+f*o*p-a*m*p-u*o*A+a*c*A,_=f*c*l-u*m*l-f*o*d+a*m*d+u*o*g-a*c*g,b=i*v+n*y+r*x+s*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let E=1/b;return e[0]=v*E,e[1]=(m*d*s-c*g*s-m*r*p+n*g*p+c*r*A-n*d*A)*E,e[2]=(o*g*s-m*l*s+m*r*h-n*g*h-o*r*A+n*l*A)*E,e[3]=(c*l*s-o*d*s-c*r*h+n*d*h+o*r*p-n*l*p)*E,e[4]=y*E,e[5]=(u*g*s-f*d*s+f*r*p-i*g*p-u*r*A+i*d*A)*E,e[6]=(f*l*s-a*g*s-f*r*h+i*g*h+a*r*A-i*l*A)*E,e[7]=(a*d*s-u*l*s+u*r*h-i*d*h-a*r*p+i*l*p)*E,e[8]=x*E,e[9]=(f*c*s-u*m*s-f*n*p+i*m*p+u*n*A-i*c*A)*E,e[10]=(a*m*s-f*o*s+f*n*h-i*m*h-a*n*A+i*o*A)*E,e[11]=(u*o*s-a*c*s-u*n*h+i*c*h+a*n*p-i*o*p)*E,e[12]=_*E,e[13]=(u*m*r-f*c*r+f*n*d-i*m*d-u*n*g+i*c*g)*E,e[14]=(f*o*r-a*m*r-f*n*l+i*m*l+a*n*g-i*o*g)*E,e[15]=(a*c*r-u*o*r+u*n*l-i*c*l-a*n*d+i*o*d)*E,this}scale(e){let i=this.elements,n=e.x,r=e.y,s=e.z;return i[0]*=n,i[4]*=r,i[8]*=s,i[1]*=n,i[5]*=r,i[9]*=s,i[2]*=n,i[6]*=r,i[10]*=s,i[3]*=n,i[7]*=r,i[11]*=s,this}getMaxScaleOnAxis(){let e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.sqrt(Math.max(i,e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){let i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){let n=Math.cos(i),r=Math.sin(i),s=1-n,a=e.x,o=e.y,l=e.z,h=s*a,u=s*o;return this.set(h*a+n,h*o-r*l,h*l+r*o,0,h*o+r*l,u*o+n,u*l-r*a,0,h*l-r*o,u*l+r*a,s*l*l+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,r,s,a){return this.set(1,n,s,0,e,1,a,0,i,r,1,0,0,0,0,1),this}compose(e,i,n){let r=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,h=s+s,u=a+a,c=o+o,d=s*h,p=s*u,f=s*c,m=a*u,g=a*c,A=o*c,v=l*h,y=l*u,x=l*c,_=n.x,b=n.y,E=n.z;return r[0]=(1-(m+A))*_,r[1]=(p+x)*_,r[2]=(f-y)*_,r[3]=0,r[4]=(p-x)*b,r[5]=(1-(d+A))*b,r[6]=(g+v)*b,r[7]=0,r[8]=(f+y)*E,r[9]=(g-v)*E,r[10]=(1-(d+m))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,n){let r=this.elements,s=eS.set(r[0],r[1],r[2]).length(),a=eS.set(r[4],r[5],r[6]).length(),o=eS.set(r[8],r[9],r[10]).length();0>this.determinant()&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],eT.copy(this);let l=1/s,h=1/a,u=1/o;return eT.elements[0]*=l,eT.elements[1]*=l,eT.elements[2]*=l,eT.elements[4]*=h,eT.elements[5]*=h,eT.elements[6]*=h,eT.elements[8]*=u,eT.elements[9]*=u,eT.elements[10]*=u,i.setFromRotationMatrix(eT),n.x=s,n.y=a,n.z=o,this}makePerspective(e,i,n,r,s,a,o=2e3){let l,h;let u=this.elements;if(2e3===o)l=-(a+s)/(a-s),h=-2*a*s/(a-s);else if(2001===o)l=-a/(a-s),h=-a*s/(a-s);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return u[0]=2*s/(i-e),u[4]=0,u[8]=(i+e)/(i-e),u[12]=0,u[1]=0,u[5]=2*s/(n-r),u[9]=(n+r)/(n-r),u[13]=0,u[2]=0,u[6]=0,u[10]=l,u[14]=h,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,i,n,r,s,a,o=2e3){let l,h;let u=this.elements,c=1/(i-e),d=1/(n-r),p=1/(a-s);if(2e3===o)l=(a+s)*p,h=-2*p;else if(2001===o)l=s*p,h=-1*p;else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return u[0]=2*c,u[4]=0,u[8]=0,u[12]=-((i+e)*c),u[1]=0,u[5]=2*d,u[9]=0,u[13]=-((n+r)*d),u[2]=0,u[6]=0,u[10]=h,u[14]=-l,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){let i=this.elements,n=e.elements;for(let e=0;e<16;e++)if(i[e]!==n[e])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){let n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}}let eS=new Y,eT=new eC,eR=new Y(0,0,0),eI=new Y(1,1,1),eB=new Y,eL=new Y,eP=new Y,eD=new eC,eN=new K;class eO{constructor(e=0,i=0,n=0,r=eO.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,r=this._order){return this._x=e,this._y=i,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){let r=e.elements,s=r[0],a=r[4],o=r[8],l=r[1],h=r[5],u=r[9],c=r[2],d=r[6],p=r[10];switch(i){case"XYZ":this._y=Math.asin(w(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,h),this._z=0);break;case"YXZ":this._x=Math.asin(-w(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(w(d,-1,1)),.9999999>Math.abs(d)?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-w(c,-1,1)),.9999999>Math.abs(c)?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(w(l,-1,1)),.9999999>Math.abs(l)?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-w(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return eD.makeRotationFromQuaternion(e),this.setFromRotationMatrix(eD,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return eN.setFromEuler(this),this.setFromQuaternion(eN,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}eO.DEFAULT_ORDER="XYZ";class eU{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let ek=0,eF=new Y,ez=new K,eG=new eC,eV=new Y,ej=new Y,eH=new Y,eQ=new K,eW=new Y(1,0,0),eq=new Y(0,1,0),eX=new Y(0,0,1),eK={type:"added"},eY={type:"removed"},eJ={type:"childadded",child:null},eZ={type:"childremoved",child:null};class e$ extends v{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ek++}),this.uuid=E(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=e$.DEFAULT_UP.clone();let e=new Y,i=new eO,n=new K,r=new Y(1,1,1);i._onChange(function(){n.setFromEuler(i,!1)}),n._onChange(function(){i.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new eC},normalMatrix:{value:new B}}),this.matrix=new eC,this.matrixWorld=new eC,this.matrixAutoUpdate=e$.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=e$.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new eU,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return ez.setFromAxisAngle(e,i),this.quaternion.multiply(ez),this}rotateOnWorldAxis(e,i){return ez.setFromAxisAngle(e,i),this.quaternion.premultiply(ez),this}rotateX(e){return this.rotateOnAxis(eW,e)}rotateY(e){return this.rotateOnAxis(eq,e)}rotateZ(e){return this.rotateOnAxis(eX,e)}translateOnAxis(e,i){return eF.copy(e).applyQuaternion(this.quaternion),this.position.add(eF.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(eW,e)}translateY(e){return this.translateOnAxis(eq,e)}translateZ(e){return this.translateOnAxis(eX,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(eG.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?eV.copy(e):eV.set(e,i,n);let r=this.parent;this.updateWorldMatrix(!0,!1),ej.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?eG.lookAt(ej,eV,this.up):eG.lookAt(eV,ej,this.up),this.quaternion.setFromRotationMatrix(eG),r&&(eG.extractRotation(r.matrixWorld),ez.setFromRotationMatrix(eG),this.quaternion.premultiply(ez.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(eK),eJ.child=e,this.dispatchEvent(eJ),eJ.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let i=this.children.indexOf(e);return -1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(eY),eZ.child=e,this.dispatchEvent(eZ),eZ.child=null),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),eG.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),eG.multiply(e.parent.matrixWorld)),e.applyMatrix4(eG),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(eK),eJ.child=e,this.dispatchEvent(eJ),eJ.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectByProperty(e,i);if(void 0!==r)return r}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);let r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ej,e,eH),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ej,eQ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);let i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverseVisible(e)}traverseAncestors(e){let i=this.parent;null!==i&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let i=this.children;for(let n=0,r=i.length;n<r;n++){let r=i[n];(!0===r.matrixWorldAutoUpdate||!0===e)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,i){let n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){let e=this.children;for(let i=0,n=e.length;i<n;i++){let n=e[i];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){let i=void 0===e||"string"==typeof e,n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let r={};function s(i,n){return void 0===i[n.uuid]&&(i[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);let i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){let n=i.shapes;if(Array.isArray(n))for(let i=0,r=n.length;i<r;i++){let r=n[i];s(e.shapes,r)}else s(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){let i=[];for(let n=0,r=this.material.length;n<r;n++)i.push(s(e.materials,this.material[n]));r.material=i}else r.material=s(e.materials,this.material)}if(this.children.length>0){r.children=[];for(let i=0;i<this.children.length;i++)r.children.push(this.children[i].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let i=0;i<this.animations.length;i++){let n=this.animations[i];r.animations.push(s(e.animations,n))}}if(i){let i=a(e.geometries),r=a(e.materials),s=a(e.textures),o=a(e.images),l=a(e.shapes),h=a(e.skeletons),u=a(e.animations),c=a(e.nodes);i.length>0&&(n.geometries=i),r.length>0&&(n.materials=r),s.length>0&&(n.textures=s),o.length>0&&(n.images=o),l.length>0&&(n.shapes=l),h.length>0&&(n.skeletons=h),u.length>0&&(n.animations=u),c.length>0&&(n.nodes=c)}return n.object=r,n;function a(e){let i=[];for(let n in e){let r=e[n];delete r.metadata,i.push(r)}return i}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===i)for(let i=0;i<e.children.length;i++){let n=e.children[i];this.add(n.clone())}return this}}e$.DEFAULT_UP=new Y(0,1,0),e$.DEFAULT_MATRIX_AUTO_UPDATE=!0,e$.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let e0=new Y,e1=new Y,e2=new Y,e3=new Y,e4=new Y,e5=new Y,e6=new Y,e8=new Y,e7=new Y,e9=new Y;class te{constructor(e=new Y,i=new Y,n=new Y){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,r){r.subVectors(n,i),e0.subVectors(e,i),r.cross(e0);let s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,i,n,r,s){e0.subVectors(r,i),e1.subVectors(n,i),e2.subVectors(e,i);let a=e0.dot(e0),o=e0.dot(e1),l=e0.dot(e2),h=e1.dot(e1),u=e1.dot(e2),c=a*h-o*o;if(0===c)return s.set(0,0,0),null;let d=1/c,p=(h*l-o*u)*d,f=(a*u-o*l)*d;return s.set(1-p-f,f,p)}static containsPoint(e,i,n,r){return null!==this.getBarycoord(e,i,n,r,e3)&&e3.x>=0&&e3.y>=0&&e3.x+e3.y<=1}static getInterpolation(e,i,n,r,s,a,o,l){return null===this.getBarycoord(e,i,n,r,e3)?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,e3.x),l.addScaledVector(a,e3.y),l.addScaledVector(o,e3.z),l)}static isFrontFacing(e,i,n,r){return e0.subVectors(n,i),e1.subVectors(e,i),0>e0.cross(e1).dot(r)}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,r){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,n,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return e0.subVectors(this.c,this.b),e1.subVectors(this.a,this.b),.5*e0.cross(e1).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return te.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return te.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,r,s){return te.getInterpolation(e,this.a,this.b,this.c,i,n,r,s)}containsPoint(e){return te.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return te.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){let n,r;let s=this.a,a=this.b,o=this.c;e4.subVectors(a,s),e5.subVectors(o,s),e8.subVectors(e,s);let l=e4.dot(e8),h=e5.dot(e8);if(l<=0&&h<=0)return i.copy(s);e7.subVectors(e,a);let u=e4.dot(e7),c=e5.dot(e7);if(u>=0&&c<=u)return i.copy(a);let d=l*c-u*h;if(d<=0&&l>=0&&u<=0)return n=l/(l-u),i.copy(s).addScaledVector(e4,n);e9.subVectors(e,o);let p=e4.dot(e9),f=e5.dot(e9);if(f>=0&&p<=f)return i.copy(o);let m=p*h-l*f;if(m<=0&&h>=0&&f<=0)return r=h/(h-f),i.copy(s).addScaledVector(e5,r);let g=u*f-p*c;if(g<=0&&c-u>=0&&p-f>=0)return e6.subVectors(o,a),r=(c-u)/(c-u+(p-f)),i.copy(a).addScaledVector(e6,r);let A=1/(g+m+d);return n=m*A,r=d*A,i.copy(s).addScaledVector(e4,n).addScaledVector(e5,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let tt={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},ti={h:0,s:0,l:0},tn={h:0,s:0,l:0};function tr(e,i,n){return(n<0&&(n+=1),n>1&&(n-=1),n<1/6)?e+(i-e)*6*n:n<.5?i:n<2/3?e+(i-e)*6*(2/3-n):e}class ts{constructor(e,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,n)}set(e,i,n){return void 0===i&&void 0===n?e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e):this.setRGB(e,i,n),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=d){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,F.toWorkingColorSpace(this,i),this}setRGB(e,i,n,r=F.workingColorSpace){return this.r=e,this.g=i,this.b=n,F.toWorkingColorSpace(this,r),this}setHSL(e,i,n,r=F.workingColorSpace){if(e=M(e,1),i=w(i,0,1),n=w(n,0,1),0===i)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+i):n+i-n*i,s=2*n-r;this.r=tr(s,r,e+1/3),this.g=tr(s,r,e),this.b=tr(s,r,e-1/3)}return F.toWorkingColorSpace(this,r),this}setStyle(e,i=d){let n;function r(i){void 0!==i&&1>parseFloat(i)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;let a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=n[1],s=r.length;if(3===s)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,i);if(6===s)return this.setHex(parseInt(r,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=d){let n=tt[e.toLowerCase()];return void 0!==n?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=z(e.r),this.g=z(e.g),this.b=z(e.b),this}copyLinearToSRGB(e){return this.r=G(e.r),this.g=G(e.g),this.b=G(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=d){return F.fromWorkingColorSpace(ta.copy(this),e),65536*Math.round(w(255*ta.r,0,255))+256*Math.round(w(255*ta.g,0,255))+Math.round(w(255*ta.b,0,255))}getHexString(e=d){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=F.workingColorSpace){let n,r;F.fromWorkingColorSpace(ta.copy(this),i);let s=ta.r,a=ta.g,o=ta.b,l=Math.max(s,a,o),h=Math.min(s,a,o),u=(h+l)/2;if(h===l)n=0,r=0;else{let e=l-h;switch(r=u<=.5?e/(l+h):e/(2-l-h),l){case s:n=(a-o)/e+6*(a<o);break;case a:n=(o-s)/e+2;break;case o:n=(s-a)/e+4}n/=6}return e.h=n,e.s=r,e.l=u,e}getRGB(e,i=F.workingColorSpace){return F.fromWorkingColorSpace(ta.copy(this),i),e.r=ta.r,e.g=ta.g,e.b=ta.b,e}getStyle(e=d){F.fromWorkingColorSpace(ta.copy(this),e);let i=ta.r,n=ta.g,r=ta.b;return e!==d?`color(${e} ${i.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*i)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,i,n){return this.getHSL(ti),this.setHSL(ti.h+e,ti.s+i,ti.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,n){return this.r=e.r+(i.r-e.r)*n,this.g=e.g+(i.g-e.g)*n,this.b=e.b+(i.b-e.b)*n,this}lerpHSL(e,i){this.getHSL(ti),e.getHSL(tn);let n=C(ti.h,tn.h,i),r=C(ti.s,tn.s,i),s=C(ti.l,tn.l,i);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let i=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*i+s[3]*n+s[6]*r,this.g=s[1]*i+s[4]*n+s[7]*r,this.b=s[2]*i+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let ta=new ts;ts.NAMES=tt;let to=0;class tl extends v{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:to++}),this.uuid=E(),this.name="",this.type="Material",this.blending=1,this.side=s,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ts(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let i in e){let n=e[i];if(void 0===n){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}let r=this[i];if(void 0===r){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[i]=n}}toJSON(e){let i=void 0===e||"string"==typeof e;i&&(e={textures:{},images:{}});let n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){let i=[];for(let n in e){let r=e[n];delete r.metadata,i.push(r)}return i}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),this.side!==s&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),100!==this.blendEquation&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),7680!==this.stencilFail&&(n.stencilFail=this.stencilFail),7680!==this.stencilZFail&&(n.stencilZFail=this.stencilZFail),7680!==this.stencilZPass&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),i){let i=r(e.textures),s=r(e.images);i.length>0&&(n.textures=i),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let i=e.clippingPlanes,n=null;if(null!==i){let e=i.length;n=Array(e);for(let r=0;r!==e;++r)n[r]=i[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class th extends tl{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ts(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new eO,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let tu=new Y,tc=new I;class td{constructor(e,i,n=!1){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=void 0!==e?e.length/i:0,this.normalized=n,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){var e;return(e="THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead.")in D||(D[e]=!0,console.warn(e)),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,n){e*=this.itemSize,n*=i.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=i.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let i=0,n=this.count;i<n;i++)tc.fromBufferAttribute(this,i),tc.applyMatrix3(e),this.setXY(i,tc.x,tc.y);else if(3===this.itemSize)for(let i=0,n=this.count;i<n;i++)tu.fromBufferAttribute(this,i),tu.applyMatrix3(e),this.setXYZ(i,tu.x,tu.y,tu.z);return this}applyMatrix4(e){for(let i=0,n=this.count;i<n;i++)tu.fromBufferAttribute(this,i),tu.applyMatrix4(e),this.setXYZ(i,tu.x,tu.y,tu.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)tu.fromBufferAttribute(this,i),tu.applyNormalMatrix(e),this.setXYZ(i,tu.x,tu.y,tu.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)tu.fromBufferAttribute(this,i),tu.transformDirection(e),this.setXYZ(i,tu.x,tu.y,tu.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let n=this.array[e*this.itemSize+i];return this.normalized&&(n=S(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=T(n,this.array)),this.array[e*this.itemSize+i]=n,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=S(i,this.array)),i}setX(e,i){return this.normalized&&(i=T(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=S(i,this.array)),i}setY(e,i){return this.normalized&&(i=T(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=S(i,this.array)),i}setZ(e,i){return this.normalized&&(i=T(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=S(i,this.array)),i}setW(e,i){return this.normalized&&(i=T(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=T(i,this.array),n=T(n,this.array)),this.array[e+0]=i,this.array[e+1]=n,this}setXYZ(e,i,n,r){return e*=this.itemSize,this.normalized&&(i=T(i,this.array),n=T(n,this.array),r=T(r,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,i,n,r,s){return e*=this.itemSize,this.normalized&&(i=T(i,this.array),n=T(n,this.array),r=T(r,this.array),s=T(s,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class tp extends td{constructor(e,i,n){super(new Uint16Array(e),i,n)}}class tf extends td{constructor(e,i,n){super(new Uint32Array(e),i,n)}}class tm extends td{constructor(e,i,n){super(new Float32Array(e),i,n)}}let tg=0,tA=new eC,tv=new e$,ty=new Y,tx=new $,t_=new $,tb=new Y;class tE extends v{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:tg++}),this.uuid=E(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(!function(e){for(let i=e.length-1;i>=0;--i)if(e[i]>=65535)return!0;return!1}(e)?tp:tf)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){let i=this.attributes.position;void 0!==i&&(i.applyMatrix4(e),i.needsUpdate=!0);let n=this.attributes.normal;if(void 0!==n){let i=new B().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}let r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return tA.makeRotationFromQuaternion(e),this.applyMatrix4(tA),this}rotateX(e){return tA.makeRotationX(e),this.applyMatrix4(tA),this}rotateY(e){return tA.makeRotationY(e),this.applyMatrix4(tA),this}rotateZ(e){return tA.makeRotationZ(e),this.applyMatrix4(tA),this}translate(e,i,n){return tA.makeTranslation(e,i,n),this.applyMatrix4(tA),this}scale(e,i,n){return tA.makeScale(e,i,n),this.applyMatrix4(tA),this}lookAt(e){return tv.lookAt(e),tv.updateMatrix(),this.applyMatrix4(tv.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ty).negate(),this.translate(ty.x,ty.y,ty.z),this}setFromPoints(e){let i=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new tm(i,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new $);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Y(-1/0,-1/0,-1/0),new Y(Infinity,Infinity,Infinity));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),i)for(let e=0,n=i.length;e<n;e++){let n=i[e];tx.setFromBufferAttribute(n),this.morphTargetsRelative?(tb.addVectors(this.boundingBox.min,tx.min),this.boundingBox.expandByPoint(tb),tb.addVectors(this.boundingBox.max,tx.max),this.boundingBox.expandByPoint(tb)):(this.boundingBox.expandByPoint(tx.min),this.boundingBox.expandByPoint(tx.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new eA);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Y,1/0);return}if(e){let n=this.boundingSphere.center;if(tx.setFromBufferAttribute(e),i)for(let e=0,n=i.length;e<n;e++){let n=i[e];t_.setFromBufferAttribute(n),this.morphTargetsRelative?(tb.addVectors(tx.min,t_.min),tx.expandByPoint(tb),tb.addVectors(tx.max,t_.max),tx.expandByPoint(tb)):(tx.expandByPoint(t_.min),tx.expandByPoint(t_.max))}tx.getCenter(n);let r=0;for(let i=0,s=e.count;i<s;i++)tb.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(tb));if(i)for(let s=0,a=i.length;s<a;s++){let a=i[s],o=this.morphTargetsRelative;for(let i=0,s=a.count;i<s;i++)tb.fromBufferAttribute(a,i),o&&(ty.fromBufferAttribute(e,i),tb.add(ty)),r=Math.max(r,n.distanceToSquared(tb))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,i=this.attributes;if(null===e||void 0===i.position||void 0===i.normal||void 0===i.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=i.position,r=i.normal,s=i.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new td(new Float32Array(4*n.count),4));let a=this.getAttribute("tangent"),o=[],l=[];for(let e=0;e<n.count;e++)o[e]=new Y,l[e]=new Y;let h=new Y,u=new Y,c=new Y,d=new I,p=new I,f=new I,m=new Y,g=new Y,A=this.groups;0===A.length&&(A=[{start:0,count:e.count}]);for(let i=0,r=A.length;i<r;++i){let r=A[i],a=r.start,v=r.count;for(let i=a,r=a+v;i<r;i+=3)!function(e,i,r){h.fromBufferAttribute(n,e),u.fromBufferAttribute(n,i),c.fromBufferAttribute(n,r),d.fromBufferAttribute(s,e),p.fromBufferAttribute(s,i),f.fromBufferAttribute(s,r),u.sub(h),c.sub(h),p.sub(d),f.sub(d);let a=1/(p.x*f.y-f.x*p.y);isFinite(a)&&(m.copy(u).multiplyScalar(f.y).addScaledVector(c,-p.y).multiplyScalar(a),g.copy(c).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(a),o[e].add(m),o[i].add(m),o[r].add(m),l[e].add(g),l[i].add(g),l[r].add(g))}(e.getX(i+0),e.getX(i+1),e.getX(i+2))}let v=new Y,y=new Y,x=new Y,_=new Y;function b(e){x.fromBufferAttribute(r,e),_.copy(x);let i=o[e];v.copy(i),v.sub(x.multiplyScalar(x.dot(i))).normalize(),y.crossVectors(_,i);let n=y.dot(l[e]);a.setXYZW(e,v.x,v.y,v.z,n<0?-1:1)}for(let i=0,n=A.length;i<n;++i){let n=A[i],r=n.start,s=n.count;for(let i=r,n=r+s;i<n;i+=3)b(e.getX(i+0)),b(e.getX(i+1)),b(e.getX(i+2))}}computeVertexNormals(){let e=this.index,i=this.getAttribute("position");if(void 0!==i){let n=this.getAttribute("normal");if(void 0===n)n=new td(new Float32Array(3*i.count),3),this.setAttribute("normal",n);else for(let e=0,i=n.count;e<i;e++)n.setXYZ(e,0,0,0);let r=new Y,s=new Y,a=new Y,o=new Y,l=new Y,h=new Y,u=new Y,c=new Y;if(e)for(let d=0,p=e.count;d<p;d+=3){let p=e.getX(d+0),f=e.getX(d+1),m=e.getX(d+2);r.fromBufferAttribute(i,p),s.fromBufferAttribute(i,f),a.fromBufferAttribute(i,m),u.subVectors(a,s),c.subVectors(r,s),u.cross(c),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),h.fromBufferAttribute(n,m),o.add(u),l.add(u),h.add(u),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z),n.setXYZ(m,h.x,h.y,h.z)}else for(let e=0,o=i.count;e<o;e+=3)r.fromBufferAttribute(i,e+0),s.fromBufferAttribute(i,e+1),a.fromBufferAttribute(i,e+2),u.subVectors(a,s),c.subVectors(r,s),u.cross(c),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)tb.fromBufferAttribute(e,i),tb.normalize(),e.setXYZ(i,tb.x,tb.y,tb.z)}toNonIndexed(){function e(e,i){let n=e.array,r=e.itemSize,s=e.normalized,a=new n.constructor(i.length*r),o=0,l=0;for(let s=0,h=i.length;s<h;s++){o=e.isInterleavedBufferAttribute?i[s]*e.data.stride+e.offset:i[s]*r;for(let e=0;e<r;e++)a[l++]=n[o++]}return new td(a,r,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let i=new tE,n=this.index.array,r=this.attributes;for(let s in r){let a=e(r[s],n);i.setAttribute(s,a)}let s=this.morphAttributes;for(let r in s){let a=[],o=s[r];for(let i=0,r=o.length;i<r;i++){let r=e(o[i],n);a.push(r)}i.morphAttributes[r]=a}i.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let e=0,n=a.length;e<n;e++){let n=a[e];i.addGroup(n.start,n.count,n.materialIndex)}return i}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let i=this.parameters;for(let n in i)void 0!==i[n]&&(e[n]=i[n]);return e}e.data={attributes:{}};let i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});let n=this.attributes;for(let i in n){let r=n[i];e.data.attributes[i]=r.toJSON(e.data)}let r={},s=!1;for(let i in this.morphAttributes){let n=this.morphAttributes[i],a=[];for(let i=0,r=n.length;i<r;i++){let r=n[i];a.push(r.toJSON(e.data))}a.length>0&&(r[i]=a,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let i={};this.name=e.name;let n=e.index;null!==n&&this.setIndex(n.clone(i));let r=e.attributes;for(let e in r){let n=r[e];this.setAttribute(e,n.clone(i))}let s=e.morphAttributes;for(let e in s){let n=[],r=s[e];for(let e=0,s=r.length;e<s;e++)n.push(r[e].clone(i));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let e=0,i=a.length;e<i;e++){let i=a[e];this.addGroup(i.start,i.count,i.materialIndex)}let o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());let l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let tw=new eC,tM=new eM,tC=new eA,tS=new Y,tT=new Y,tR=new Y,tI=new Y,tB=new Y,tL=new Y,tP=new I,tD=new I,tN=new I,tO=new Y,tU=new Y,tk=new Y,tF=new Y,tz=new Y;class tG extends e${constructor(e=new tE,i=new th){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++){let i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}getVertexPosition(e,i){let n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;i.fromBufferAttribute(r,e);let o=this.morphTargetInfluences;if(s&&o){tL.set(0,0,0);for(let n=0,r=s.length;n<r;n++){let r=o[n],l=s[n];0!==r&&(tB.fromBufferAttribute(l,e),a?tL.addScaledVector(tB,r):tL.addScaledVector(tB.sub(i),r))}i.add(tL)}return i}raycast(e,i){let n=this.geometry,r=this.material,s=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),tC.copy(n.boundingSphere),tC.applyMatrix4(s),tM.copy(e.ray).recast(e.near),!1===tC.containsPoint(tM.origin)&&(null===tM.intersectSphere(tC,tS)||tM.origin.distanceToSquared(tS)>(e.far-e.near)**2)||(tw.copy(s).invert(),tM.copy(e.ray).applyMatrix4(tw),null!==n.boundingBox&&!1===tM.intersectsBox(n.boundingBox)))return;this._computeIntersections(e,i,tM)}}_computeIntersections(e,i,n){let r;let s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,h=s.attributes.uv,u=s.attributes.uv1,c=s.attributes.normal,d=s.groups,p=s.drawRange;if(null!==o){if(Array.isArray(a))for(let s=0,l=d.length;s<l;s++){let l=d[s],f=a[l.materialIndex],m=Math.max(l.start,p.start),g=Math.min(o.count,Math.min(l.start+l.count,p.start+p.count));for(let s=m;s<g;s+=3){let a=o.getX(s);(r=tV(this,f,e,n,h,u,c,a,o.getX(s+1),o.getX(s+2)))&&(r.faceIndex=Math.floor(s/3),r.face.materialIndex=l.materialIndex,i.push(r))}}else{let s=Math.max(0,p.start),l=Math.min(o.count,p.start+p.count);for(let d=s;d<l;d+=3){let s=o.getX(d);(r=tV(this,a,e,n,h,u,c,s,o.getX(d+1),o.getX(d+2)))&&(r.faceIndex=Math.floor(d/3),i.push(r))}}}else if(void 0!==l){if(Array.isArray(a))for(let s=0,o=d.length;s<o;s++){let o=d[s],f=a[o.materialIndex],m=Math.max(o.start,p.start),g=Math.min(l.count,Math.min(o.start+o.count,p.start+p.count));for(let s=m;s<g;s+=3)(r=tV(this,f,e,n,h,u,c,s,s+1,s+2))&&(r.faceIndex=Math.floor(s/3),r.face.materialIndex=o.materialIndex,i.push(r))}else{let s=Math.max(0,p.start),o=Math.min(l.count,p.start+p.count);for(let l=s;l<o;l+=3)(r=tV(this,a,e,n,h,u,c,l,l+1,l+2))&&(r.faceIndex=Math.floor(l/3),i.push(r))}}}}function tV(e,i,n,r,a,o,l,h,u,c){e.getVertexPosition(h,tT),e.getVertexPosition(u,tR),e.getVertexPosition(c,tI);let d=function(e,i,n,r,a,o,l,h){let u;if(null===(1===i.side?r.intersectTriangle(l,o,a,!0,h):r.intersectTriangle(a,o,l,i.side===s,h)))return null;tz.copy(h),tz.applyMatrix4(e.matrixWorld);let c=n.ray.origin.distanceTo(tz);return c<n.near||c>n.far?null:{distance:c,point:tz.clone(),object:e}}(e,i,n,r,tT,tR,tI,tF);if(d){a&&(tP.fromBufferAttribute(a,h),tD.fromBufferAttribute(a,u),tN.fromBufferAttribute(a,c),d.uv=te.getInterpolation(tF,tT,tR,tI,tP,tD,tN,new I)),o&&(tP.fromBufferAttribute(o,h),tD.fromBufferAttribute(o,u),tN.fromBufferAttribute(o,c),d.uv1=te.getInterpolation(tF,tT,tR,tI,tP,tD,tN,new I)),l&&(tO.fromBufferAttribute(l,h),tU.fromBufferAttribute(l,u),tk.fromBufferAttribute(l,c),d.normal=te.getInterpolation(tF,tT,tR,tI,tO,tU,tk,new Y),d.normal.dot(r.direction)>0&&d.normal.multiplyScalar(-1));let e={a:h,b:u,c:c,normal:new Y,materialIndex:0};te.getNormal(tT,tR,tI,e.normal),d.face=e}return d}class tj extends tE{constructor(e=1,i=1,n=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:a};let o=this;r=Math.floor(r),s=Math.floor(s);let l=[],h=[],u=[],c=[],d=0,p=0;function f(e,i,n,r,s,a,f,m,g,A,v){let y=a/g,x=f/A,_=a/2,b=f/2,E=m/2,w=g+1,M=A+1,C=0,S=0,T=new Y;for(let a=0;a<M;a++){let o=a*x-b;for(let l=0;l<w;l++){let d=l*y-_;T[e]=d*r,T[i]=o*s,T[n]=E,h.push(T.x,T.y,T.z),T[e]=0,T[i]=0,T[n]=m>0?1:-1,u.push(T.x,T.y,T.z),c.push(l/g),c.push(1-a/A),C+=1}}for(let e=0;e<A;e++)for(let i=0;i<g;i++){let n=d+i+w*e,r=d+i+w*(e+1),s=d+(i+1)+w*(e+1),a=d+(i+1)+w*e;l.push(n,r,a),l.push(r,s,a),S+=6}o.addGroup(p,S,v),p+=S,d+=C}f("z","y","x",-1,-1,n,i,e,a=Math.floor(a),s,0),f("z","y","x",1,-1,n,i,-e,a,s,1),f("x","z","y",1,1,e,n,i,r,a,2),f("x","z","y",1,-1,e,n,-i,r,a,3),f("x","y","z",1,-1,e,i,n,r,s,4),f("x","y","z",-1,-1,e,i,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new tm(h,3)),this.setAttribute("normal",new tm(u,3)),this.setAttribute("uv",new tm(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tj(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function tH(e){let i={};for(let n=0;n<e.length;n++){let r=function(e){let i={};for(let n in e)for(let r in i[n]={},e[n]){let s=e[n][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),i[n][r]=null):i[n][r]=s.clone():Array.isArray(s)?i[n][r]=s.slice():i[n][r]=s}return i}(e[n]);for(let e in r)i[e]=r[e]}return i}class tQ extends e${constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new eC,this.projectionMatrix=new eC,this.projectionMatrixInverse=new eC,this.coordinateSystem=2e3}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let tW=new Y,tq=new I,tX=new I;class tK extends tQ{constructor(e=50,i=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let i=.5*this.getFilmHeight()/e;this.fov=2*b*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*_*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*b*Math.atan(Math.tan(.5*_*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,n){tW.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(tW.x,tW.y).multiplyScalar(-e/tW.z),tW.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(tW.x,tW.y).multiplyScalar(-e/tW.z)}getViewSize(e,i){return this.getViewBounds(e,tq,tX),i.subVectors(tX,tq)}setViewOffset(e,i,n,r,s,a){this.aspect=e/i,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,i=e*Math.tan(.5*_*this.fov)/this.zoom,n=2*i,r=this.aspect*n,s=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,o=a.fullHeight;s+=a.offsetX*r/e,i-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}let o=this.filmOffset;0!==o&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,i,i-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,null!==this.view&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}let tY=new Y,tJ=new Y,tZ=new B;class t${constructor(e=new Y(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,n,r){return this.normal.set(e,i,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,n){let r=tY.subVectors(n,i).cross(tJ.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){let n=e.delta(tY),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?i.copy(e.start):null;let s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:i.copy(e.start).addScaledVector(n,s)}intersectsLine(e){let i=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return i<0&&n>0||n<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){let n=i||tZ.getNormalMatrix(e),r=this.coplanarPoint(tY).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}let t0=new eA,t1=new Y;class t2{constructor(e=new t$,i=new t$,n=new t$,r=new t$,s=new t$,a=new t$){this.planes=[e,i,n,r,s,a]}set(e,i,n,r,s,a){let o=this.planes;return o[0].copy(e),o[1].copy(i),o[2].copy(n),o[3].copy(r),o[4].copy(s),o[5].copy(a),this}copy(e){let i=this.planes;for(let n=0;n<6;n++)i[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,i=2e3){let n=this.planes,r=e.elements,s=r[0],a=r[1],o=r[2],l=r[3],h=r[4],u=r[5],c=r[6],d=r[7],p=r[8],f=r[9],m=r[10],g=r[11],A=r[12],v=r[13],y=r[14],x=r[15];if(n[0].setComponents(l-s,d-h,g-p,x-A).normalize(),n[1].setComponents(l+s,d+h,g+p,x+A).normalize(),n[2].setComponents(l+a,d+u,g+f,x+v).normalize(),n[3].setComponents(l-a,d-u,g-f,x-v).normalize(),n[4].setComponents(l-o,d-c,g-m,x-y).normalize(),2e3===i)n[5].setComponents(l+o,d+c,g+m,x+y).normalize();else if(2001===i)n[5].setComponents(o,c,m,y).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),t0.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let i=e.geometry;null===i.boundingSphere&&i.computeBoundingSphere(),t0.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(t0)}intersectsSprite(e){return t0.center.set(0,0,0),t0.radius=.7071067811865476,t0.applyMatrix4(e.matrixWorld),this.intersectsSphere(t0)}intersectsSphere(e){let i=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(i[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){let i=this.planes;for(let n=0;n<6;n++){let r=i[n];if(t1.x=r.normal.x>0?e.max.x:e.min.x,t1.y=r.normal.y>0?e.max.y:e.min.y,t1.z=r.normal.z>0?e.max.z:e.min.z,0>r.distanceToPoint(t1))return!1}return!0}containsPoint(e){let i=this.planes;for(let n=0;n<6;n++)if(0>i[n].distanceToPoint(e))return!1;return!0}clone(){return new this.constructor().copy(this)}}class t3 extends tE{constructor(e=1,i=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:n,heightSegments:r};let s=e/2,a=i/2,o=Math.floor(n),l=Math.floor(r),h=o+1,u=l+1,c=e/o,d=i/l,p=[],f=[],m=[],g=[];for(let e=0;e<u;e++){let i=e*d-a;for(let n=0;n<h;n++){let r=n*c-s;f.push(r,-i,0),m.push(0,0,1),g.push(n/o),g.push(1-e/l)}}for(let e=0;e<l;e++)for(let i=0;i<o;i++){let n=i+h*e,r=i+h*(e+1),s=i+1+h*(e+1),a=i+1+h*e;p.push(n,r,a),p.push(r,s,a)}this.setIndex(p),this.setAttribute("position",new tm(f,3)),this.setAttribute("normal",new tm(m,3)),this.setAttribute("uv",new tm(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new t3(e.width,e.height,e.widthSegments,e.heightSegments)}}let t4="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",t5="#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n	uniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",t6={common:{diffuse:{value:new ts(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new B},alphaMap:{value:null},alphaMapTransform:{value:new B},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new B}},envmap:{envMap:{value:null},envMapRotation:{value:new B},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new B}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new B}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new B},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new B},normalScale:{value:new I(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new B},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new B}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new B}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new B}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ts(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ts(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new B},alphaTest:{value:0},uvTransform:{value:new B}},sprite:{diffuse:{value:new ts(0xffffff)},opacity:{value:1},center:{value:new I(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new B},alphaMap:{value:null},alphaMapTransform:{value:new B},alphaTest:{value:0}}},t8={basic:{uniforms:tH([t6.common,t6.specularmap,t6.envmap,t6.aomap,t6.lightmap,t6.fog]),vertexShader:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}"},lambert:{uniforms:tH([t6.common,t6.specularmap,t6.envmap,t6.aomap,t6.lightmap,t6.emissivemap,t6.bumpmap,t6.normalmap,t6.displacementmap,t6.fog,t6.lights,{emissive:{value:new ts(0)}}]),vertexShader:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",fragmentShader:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}"},phong:{uniforms:tH([t6.common,t6.specularmap,t6.envmap,t6.aomap,t6.lightmap,t6.emissivemap,t6.bumpmap,t6.normalmap,t6.displacementmap,t6.fog,t6.lights,{emissive:{value:new ts(0)},specular:{value:new ts(1118481)},shininess:{value:30}}]),vertexShader:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",fragmentShader:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}"},standard:{uniforms:tH([t6.common,t6.envmap,t6.aomap,t6.lightmap,t6.emissivemap,t6.bumpmap,t6.normalmap,t6.displacementmap,t6.roughnessmap,t6.metalnessmap,t6.fog,t6.lights,{emissive:{value:new ts(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:t4,fragmentShader:t5},toon:{uniforms:tH([t6.common,t6.aomap,t6.lightmap,t6.emissivemap,t6.bumpmap,t6.normalmap,t6.displacementmap,t6.gradientmap,t6.fog,t6.lights,{emissive:{value:new ts(0)}}]),vertexShader:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",fragmentShader:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}"},matcap:{uniforms:tH([t6.common,t6.bumpmap,t6.normalmap,t6.displacementmap,t6.fog,{matcap:{value:null}}]),vertexShader:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",fragmentShader:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}"},points:{uniforms:tH([t6.points,t6.fog]),vertexShader:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}"},dashed:{uniforms:tH([t6.common,t6.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}"},depth:{uniforms:tH([t6.common,t6.displacementmap]),vertexShader:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",fragmentShader:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#endif\n}"},normal:{uniforms:tH([t6.common,t6.bumpmap,t6.normalmap,t6.displacementmap,{opacity:{value:1}}]),vertexShader:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",fragmentShader:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}"},sprite:{uniforms:tH([t6.sprite,t6.fog]),vertexShader:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n	vec2 scale;\n	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"},background:{uniforms:{uvTransform:{value:new B},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",fragmentShader:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}"},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new B}},vertexShader:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",fragmentShader:"#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}"},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}"},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}"},distanceRGBA:{uniforms:tH([t6.common,t6.displacementmap,{referencePosition:{value:new Y},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",fragmentShader:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}"},shadow:{uniforms:tH([t6.lights,t6.fog,{color:{value:new ts(0)},opacity:{value:1}}]),vertexShader:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",fragmentShader:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"}};t8.physical={uniforms:tH([t8.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new B},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new B},clearcoatNormalScale:{value:new I(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new B},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new B},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new B},sheen:{value:0},sheenColor:{value:new ts(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new B},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new B},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new B},transmissionSamplerSize:{value:new I},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new B},attenuationDistance:{value:0},attenuationColor:{value:new ts(0)},specularColor:{value:new ts(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new B},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new B},anisotropyVector:{value:new I},anisotropyMap:{value:null},anisotropyMapTransform:{value:new B}}]),vertexShader:t4,fragmentShader:t5};class t7 extends tQ{constructor(e=-1,i=1,n=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=n,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,i,n,r,s,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=n-e,a=n+e,o=r+i,l=r-i;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,i=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=e*this.view.offsetX,a=s+e*this.view.width,o-=i*this.view.offsetY,l=o-i*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,null!==this.view&&(i.object.view=Object.assign({},this.view)),i}}new class extends q{constructor(e,i,n,r,s,a,o,l,h,u){if(1026!==(u=void 0!==u?u:1026)&&1027!==u)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===u&&(n=1014),void 0===n&&1027===u&&(n=1020),super(null,r,s,a,o,l,u,n,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=void 0!==o?o:1003,this.minFilter=void 0!==l?l:1003,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let i=super.toJSON(e);return null!==this.compareFunction&&(i.compareFunction=this.compareFunction),i}}(1,1).compareFunction=515,new Float32Array(16),new Float32Array(9),new Float32Array(4);class t9 extends e${constructor(){super(),this.isGroup=!0,this.type="Group"}}class ie extends e${constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new eO,this.environmentIntensity=1,this.environmentRotation=new eO,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let i=super.toJSON(e);return null!==this.fog&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}let it=new Y,ii=new X,ir=new X,is=new Y,ia=new eC,io=new Y,il=new eA,ih=new eC,iu=new eM;class ic extends tG{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=o,this.bindMatrix=new eC,this.bindMatrixInverse=new eC,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let e=this.geometry;null===this.boundingBox&&(this.boundingBox=new $),this.boundingBox.makeEmpty();let i=e.getAttribute("position");for(let e=0;e<i.count;e++)this.getVertexPosition(e,io),this.boundingBox.expandByPoint(io)}computeBoundingSphere(){let e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new eA),this.boundingSphere.makeEmpty();let i=e.getAttribute("position");for(let e=0;e<i.count;e++)this.getVertexPosition(e,io),this.boundingSphere.expandByPoint(io)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){let n=this.material,r=this.matrixWorld;if(void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),il.copy(this.boundingSphere),il.applyMatrix4(r),!1!==e.ray.intersectsSphere(il))){if(ih.copy(r).invert(),iu.copy(e.ray).applyMatrix4(ih),null!==this.boundingBox&&!1===iu.intersectsBox(this.boundingBox))return;this._computeIntersections(e,i,iu)}}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,void 0===i&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new X,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){e.fromBufferAttribute(i,n);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),i.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===o?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){let n=this.skeleton,r=this.geometry;ii.fromBufferAttribute(r.attributes.skinIndex,e),ir.fromBufferAttribute(r.attributes.skinWeight,e),it.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let e=0;e<4;e++){let r=ir.getComponent(e);if(0!==r){let s=ii.getComponent(e);ia.multiplyMatrices(n.bones[s].matrixWorld,n.boneInverses[s]),i.addScaledVector(is.copy(it).applyMatrix4(ia),r)}}return i.applyMatrix4(this.bindMatrixInverse)}}class id extends e${constructor(){super(),this.isBone=!0,this.type="Bone"}}class ip extends q{constructor(e=null,i=1,n=1,r,s,a,o,l,h=1003,u=1003,c,d){super(null,a,o,l,h,u,r,s,c,d),this.isDataTexture=!0,this.image={data:e,width:i,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let im=new eC,ig=new eC;class iA{constructor(e=[],i=[]){this.uuid=E(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===i.length)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,i=this.bones.length;e<i;e++)this.boneInverses.push(new eC)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){let i=new eC;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,i=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let s=e[r]?e[r].matrixWorld:ig;im.multiplyMatrices(s,i[r]),im.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new iA(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length),i=new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4);i.set(this.boneMatrices);let n=new ip(i,e,e,1023,1015);return n.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=n,this}getBoneByName(e){for(let i=0,n=this.bones.length;i<n;i++){let n=this.bones[i];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){let r=e.bones[n],s=i[r];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new id),this.bones.push(s),this.boneInverses.push(new eC().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){let e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let i=this.bones,n=this.boneInverses;for(let r=0,s=i.length;r<s;r++){let s=i[r];e.bones.push(s.uuid);let a=n[r];e.boneInverses.push(a.toArray())}return e}}class iv extends tl{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ts(0xffffff),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}let iy=new Y,ix=new Y,i_=new eC,ib=new eM,iE=new eA,iw=new Y,iM=new Y;class iC extends e${constructor(e=new tE,i=new iv){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let i=e.attributes.position,n=[0];for(let e=1,r=i.count;e<r;e++)iy.fromBufferAttribute(i,e-1),ix.fromBufferAttribute(i,e),n[e]=n[e-1],n[e]+=iy.distanceTo(ix);e.setAttribute("lineDistance",new tm(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){let n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),iE.copy(n.boundingSphere),iE.applyMatrix4(r),iE.radius+=s,!1===e.ray.intersectsSphere(iE))return;i_.copy(r).invert(),ib.copy(e.ray).applyMatrix4(i_);let o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,h=this.isLineSegments?2:1,u=n.index,c=n.attributes.position;if(null!==u){let n=Math.max(0,a.start),r=Math.min(u.count,a.start+a.count);for(let s=n,a=r-1;s<a;s+=h){let n=iS(this,e,ib,l,u.getX(s),u.getX(s+1));n&&i.push(n)}if(this.isLineLoop){let s=iS(this,e,ib,l,u.getX(r-1),u.getX(n));s&&i.push(s)}}else{let n=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);for(let s=n,a=r-1;s<a;s+=h){let n=iS(this,e,ib,l,s,s+1);n&&i.push(n)}if(this.isLineLoop){let s=iS(this,e,ib,l,r-1,n);s&&i.push(s)}}}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++){let i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}function iS(e,i,n,r,s,a){let o=e.geometry.attributes.position;if(iy.fromBufferAttribute(o,s),ix.fromBufferAttribute(o,a),n.distanceSqToSegment(iy,ix,iw,iM)>r)return;iw.applyMatrix4(e.matrixWorld);let l=i.ray.origin.distanceTo(iw);if(!(l<i.near)&&!(l>i.far))return{distance:l,point:iM.clone().applyMatrix4(e.matrixWorld),index:s,face:null,faceIndex:null,object:e}}let iT=new Y,iR=new Y;class iI extends iC{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let i=e.attributes.position,n=[];for(let e=0,r=i.count;e<r;e+=2)iT.fromBufferAttribute(i,e),iR.fromBufferAttribute(i,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+iT.distanceTo(iR);e.setAttribute("lineDistance",new tm(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class iB{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){let n=this.getUtoTmapping(e);return this.getPoint(n,i)}getPoints(e=5){let i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return i}getSpacedPoints(e=5){let i=[];for(let n=0;n<=e;n++)i.push(this.getPointAt(n/e));return i}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let i=[],n,r=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=e;a++)i.push(s+=(n=this.getPoint(a/e)).distanceTo(r)),r=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){let n;let r=this.getLengths(),s=0,a=r.length;n=i||e*r[a-1];let o=0,l=a-1,h;for(;o<=l;)if((h=r[s=Math.floor(o+(l-o)/2)]-n)<0)o=s+1;else if(h>0)l=s-1;else{l=s;break}if(r[s=l]===n)return s/(a-1);let u=r[s],c=r[s+1];return(s+(n-u)/(c-u))/(a-1)}getTangent(e,i){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);let s=this.getPoint(n),a=this.getPoint(r),o=i||(s.isVector2?new I:new Y);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,i){let n=this.getUtoTmapping(e);return this.getTangent(n,i)}computeFrenetFrames(e,i){let n=new Y,r=[],s=[],a=[],o=new Y,l=new eC;for(let i=0;i<=e;i++){let n=i/e;r[i]=this.getTangentAt(n,new Y)}s[0]=new Y,a[0]=new Y;let h=Number.MAX_VALUE,u=Math.abs(r[0].x),c=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=h&&(h=u,n.set(1,0,0)),c<=h&&(h=c,n.set(0,1,0)),d<=h&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],o),a[0].crossVectors(r[0],s[0]);for(let i=1;i<=e;i++){if(s[i]=s[i-1].clone(),a[i]=a[i-1].clone(),o.crossVectors(r[i-1],r[i]),o.length()>Number.EPSILON){o.normalize();let e=Math.acos(w(r[i-1].dot(r[i]),-1,1));s[i].applyMatrix4(l.makeRotationAxis(o,e))}a[i].crossVectors(r[i],s[i])}if(!0===i){let i=Math.acos(w(s[0].dot(s[e]),-1,1));i/=e,r[0].dot(o.crossVectors(s[0],s[e]))>0&&(i=-i);for(let n=1;n<=e;n++)s[n].applyMatrix4(l.makeRotationAxis(r[n],i*n)),a[n].crossVectors(r[n],s[n])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class iL extends iB{constructor(e=0,i=0,n=1,r=1,s=0,a=2*Math.PI,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,i=new I){let n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);let a=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let e=Math.cos(this.aRotation),i=Math.sin(this.aRotation),n=o-this.aX,r=l-this.aY;o=n*e-r*i+this.aX,l=n*i+r*e+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function iP(){let e=0,i=0,n=0,r=0;function s(s,a,o,l){e=s,i=o,n=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(e,i,n,r,a){s(i,n,a*(n-e),a*(r-i))},initNonuniformCatmullRom:function(e,i,n,r,a,o,l){let h=(i-e)/a-(n-e)/(a+o)+(n-i)/o,u=(n-i)/o-(r-i)/(o+l)+(r-n)/l;s(i,n,h*=o,u*=o)},calc:function(s){let a=s*s;return e+i*s+n*a+a*s*r}}}let iD=new Y,iN=new iP,iO=new iP,iU=new iP;function ik(e,i,n,r,s){let a=(r-i)*.5,o=(s-n)*.5,l=e*e;return e*l*(2*n-2*r+a+o)+(-3*n+3*r-2*a-o)*l+a*e+n}function iF(e,i,n,r){return function(e,i){let n=1-e;return n*n*i}(e,i)+2*(1-e)*e*n+e*e*r}function iz(e,i,n,r,s){return function(e,i){let n=1-e;return n*n*n*i}(e,i)+function(e,i){let n=1-e;return 3*n*n*e*i}(e,n)+3*(1-e)*e*e*r+e*e*e*s}class iG extends iB{constructor(e=new I,i=new I,n=new I,r=new I){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=n,this.v3=r}getPoint(e,i=new I){let n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(iz(e,n.x,r.x,s.x,a.x),iz(e,n.y,r.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class iV extends iB{constructor(e=new I,i=new I){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new I){return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new I){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ij extends iB{constructor(e=new I,i=new I,n=new I){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new I){let n=this.v0,r=this.v1,s=this.v2;return i.set(iF(e,n.x,r.x,s.x),iF(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class iH extends iB{constructor(e=new Y,i=new Y,n=new Y){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new Y){let n=this.v0,r=this.v1,s=this.v2;return i.set(iF(e,n.x,r.x,s.x),iF(e,n.y,r.y,s.y),iF(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class iQ extends iB{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new I){let n=this.points,r=(n.length-1)*e,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],h=n[s>n.length-2?n.length-1:s+1],u=n[s>n.length-3?n.length-1:s+2];return i.set(ik(a,o.x,l.x,h.x,u.x),ik(a,o.y,l.y,h.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){let n=this.points[i];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(new I().fromArray(n))}return this}}var iW=Object.freeze({__proto__:null,ArcCurve:class extends iL{constructor(e,i,n,r,s,a){super(e,i,n,n,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends iB{constructor(e=[],i=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=n,this.tension=r}getPoint(e,i=new Y){let n,r;let s=this.points,a=s.length,o=(a-+!this.closed)*e,l=Math.floor(o),h=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a)+1)*a:0===h&&l===a-1&&(l=a-2,h=1),this.closed||l>0?n=s[(l-1)%a]:(iD.subVectors(s[0],s[1]).add(s[0]),n=iD);let u=s[l%a],c=s[(l+1)%a];if(this.closed||l+2<a?r=s[(l+2)%a]:(iD.subVectors(s[a-1],s[a-2]).add(s[a-1]),r=iD),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,i=Math.pow(n.distanceToSquared(u),e),s=Math.pow(u.distanceToSquared(c),e),a=Math.pow(c.distanceToSquared(r),e);s<1e-4&&(s=1),i<1e-4&&(i=s),a<1e-4&&(a=s),iN.initNonuniformCatmullRom(n.x,u.x,c.x,r.x,i,s,a),iO.initNonuniformCatmullRom(n.y,u.y,c.y,r.y,i,s,a),iU.initNonuniformCatmullRom(n.z,u.z,c.z,r.z,i,s,a)}else"catmullrom"===this.curveType&&(iN.initCatmullRom(n.x,u.x,c.x,r.x,this.tension),iO.initCatmullRom(n.y,u.y,c.y,r.y,this.tension),iU.initCatmullRom(n.z,u.z,c.z,r.z,this.tension));return i.set(iN.calc(h),iO.calc(h),iU.calc(h)),i}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){let n=this.points[i];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(new Y().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:iG,CubicBezierCurve3:class extends iB{constructor(e=new Y,i=new Y,n=new Y,r=new Y){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=n,this.v3=r}getPoint(e,i=new Y){let n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(iz(e,n.x,r.x,s.x,a.x),iz(e,n.y,r.y,s.y,a.y),iz(e,n.z,r.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},EllipseCurve:iL,LineCurve:iV,LineCurve3:class extends iB{constructor(e=new Y,i=new Y){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new Y){return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Y){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:ij,QuadraticBezierCurve3:iH,SplineCurve:iQ});class iq extends iB{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){let n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new iW[n](i,e))}return this}getPoint(e,i){let n=e*this.getLength(),r=this.getCurveLengths(),s=0;for(;s<r.length;){if(r[s]>=n){let e=r[s]-n,a=this.curves[s],o=a.getLength(),l=0===o?0:1-e/o;return a.getPointAt(l,i)}s++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],i=0;for(let n=0,r=this.curves.length;n<r;n++)e.push(i+=this.curves[n].getLength());return this.cacheLengths=e,e}getSpacedPoints(e=40){let i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){let i;let n=[];for(let r=0,s=this.curves;r<s.length;r++){let a=s[r],o=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let e=0;e<l.length;e++){let r=l[e];i&&i.equals(r)||(n.push(r),i=r)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let i=0,n=e.curves.length;i<n;i++){let n=e.curves[i];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,n=this.curves.length;i<n;i++){let n=this.curves[i];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,n=e.curves.length;i<n;i++){let n=e.curves[i];this.curves.push(new iW[n.type]().fromJSON(n))}return this}}class iX extends iq{constructor(e){super(),this.type="Path",this.currentPoint=new I,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,n=e.length;i<n;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){let n=new iV(this.currentPoint.clone(),new I(e,i));return this.curves.push(n),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,n,r){let s=new ij(this.currentPoint.clone(),new I(e,i),new I(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,i,n,r,s,a){let o=new iG(this.currentPoint.clone(),new I(e,i),new I(n,r),new I(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){let i=new iQ([this.currentPoint.clone()].concat(e));return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,n,r,s,a){let o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,i+l,n,r,s,a),this}absarc(e,i,n,r,s,a){return this.absellipse(e,i,n,n,r,s,a),this}ellipse(e,i,n,r,s,a,o,l){let h=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+h,i+u,n,r,s,a,o,l),this}absellipse(e,i,n,r,s,a,o,l){let h=new iL(e,i,n,r,s,a,o,l);if(this.curves.length>0){let e=h.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(h);let u=h.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class iK extends tE{constructor(e=[new I(0,-.5),new I(.5,0),new I(0,.5)],i=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:n,phiLength:r},i=Math.floor(i),r=w(r,0,2*Math.PI);let s=[],a=[],o=[],l=[],h=[],u=1/i,c=new Y,d=new I,p=new Y,f=new Y,m=new Y,g=0,A=0;for(let i=0;i<=e.length-1;i++)switch(i){case 0:g=e[i+1].x-e[i].x,A=e[i+1].y-e[i].y,p.x=+A,p.y=-g,p.z=0*A,m.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(m.x,m.y,m.z);break;default:g=e[i+1].x-e[i].x,A=e[i+1].y-e[i].y,p.x=+A,p.y=-g,p.z=0*A,f.copy(p),p.x+=m.x,p.y+=m.y,p.z+=m.z,p.normalize(),l.push(p.x,p.y,p.z),m.copy(f)}for(let s=0;s<=i;s++){let p=n+s*u*r,f=Math.sin(p),m=Math.cos(p);for(let n=0;n<=e.length-1;n++){c.x=e[n].x*f,c.y=e[n].y,c.z=e[n].x*m,a.push(c.x,c.y,c.z),d.x=s/i,d.y=n/(e.length-1),o.push(d.x,d.y);let r=l[3*n+0]*f,u=l[3*n+1],p=l[3*n+0]*m;h.push(r,u,p)}}for(let n=0;n<i;n++)for(let i=0;i<e.length-1;i++){let r=i+n*e.length,a=r+e.length,o=r+e.length+1,l=r+1;s.push(r,a,l),s.push(o,l,a)}this.setIndex(s),this.setAttribute("position",new tm(a,3)),this.setAttribute("uv",new tm(o,2)),this.setAttribute("normal",new tm(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iK(e.points,e.segments,e.phiStart,e.phiLength)}}class iY extends iK{constructor(e=1,i=1,n=4,r=8){let s=new iX;s.absarc(0,-i/2,e,1.5*Math.PI,0),s.absarc(0,i/2,e,0,.5*Math.PI),super(s.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:n,radialSegments:r}}static fromJSON(e){return new iY(e.radius,e.length,e.capSegments,e.radialSegments)}}class iJ extends tE{constructor(e=1,i=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:n,thetaLength:r},i=Math.max(3,i);let s=[],a=[],o=[],l=[],h=new Y,u=new I;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let s=0,c=3;s<=i;s++,c+=3){let d=n+s/i*r;h.x=e*Math.cos(d),h.y=e*Math.sin(d),a.push(h.x,h.y,h.z),o.push(0,0,1),u.x=(a[c]/e+1)/2,u.y=(a[c+1]/e+1)/2,l.push(u.x,u.y)}for(let e=1;e<=i;e++)s.push(e,e+1,0);this.setIndex(s),this.setAttribute("position",new tm(a,3)),this.setAttribute("normal",new tm(o,3)),this.setAttribute("uv",new tm(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iJ(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class iZ extends tE{constructor(e=1,i=1,n=1,r=32,s=1,a=!1,o=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};let h=this;r=Math.floor(r),s=Math.floor(s);let u=[],c=[],d=[],p=[],f=0,m=[],g=n/2,A=0;function v(n){let s=f,a=new I,m=new Y,v=0,y=!0===n?e:i,x=!0===n?1:-1;for(let e=1;e<=r;e++)c.push(0,g*x,0),d.push(0,x,0),p.push(.5,.5),f++;let _=f;for(let e=0;e<=r;e++){let i=e/r*l+o,n=Math.cos(i),s=Math.sin(i);m.x=y*s,m.y=g*x,m.z=y*n,c.push(m.x,m.y,m.z),d.push(0,x,0),a.x=.5*n+.5,a.y=.5*s*x+.5,p.push(a.x,a.y),f++}for(let e=0;e<r;e++){let i=s+e,r=_+e;!0===n?u.push(r,r+1,i):u.push(r+1,r,i),v+=3}h.addGroup(A,v,!0===n?1:2),A+=v}(function(){let a=new Y,v=new Y,y=0,x=(i-e)/n;for(let h=0;h<=s;h++){let u=[],A=h/s,y=A*(i-e)+e;for(let e=0;e<=r;e++){let i=e/r,s=i*l+o,h=Math.sin(s),m=Math.cos(s);v.x=y*h,v.y=-A*n+g,v.z=y*m,c.push(v.x,v.y,v.z),a.set(h,x,m).normalize(),d.push(a.x,a.y,a.z),p.push(i,1-A),u.push(f++)}m.push(u)}for(let e=0;e<r;e++)for(let i=0;i<s;i++){let n=m[i][e],r=m[i+1][e],s=m[i+1][e+1],a=m[i][e+1];u.push(n,r,a),u.push(r,s,a),y+=6}h.addGroup(A,y,0),A+=y})(),!1===a&&(e>0&&v(!0),i>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new tm(c,3)),this.setAttribute("normal",new tm(d,3)),this.setAttribute("uv",new tm(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iZ(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class i$ extends iZ{constructor(e=1,i=1,n=32,r=1,s=!1,a=0,o=2*Math.PI){super(0,e,i,n,r,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new i$(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class i0 extends tE{constructor(e=[],i=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:n,detail:r};let s=[],a=[];function o(e){s.push(e.x,e.y,e.z)}function l(i,n){let r=3*i;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function h(e,i,n,r){r<0&&1===e.x&&(a[i]=e.x-1),0===n.x&&0===n.z&&(a[i]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}(function(e){let n=new Y,r=new Y,s=new Y;for(let a=0;a<i.length;a+=3)l(i[a+0],n),l(i[a+1],r),l(i[a+2],s),function(e,i,n,r){let s=r+1,a=[];for(let r=0;r<=s;r++){a[r]=[];let o=e.clone().lerp(n,r/s),l=i.clone().lerp(n,r/s),h=s-r;for(let e=0;e<=h;e++)0===e&&r===s?a[r][e]=o:a[r][e]=o.clone().lerp(l,e/h)}for(let e=0;e<s;e++)for(let i=0;i<2*(s-e)-1;i++){let n=Math.floor(i/2);i%2==0?(o(a[e][n+1]),o(a[e+1][n]),o(a[e][n])):(o(a[e][n+1]),o(a[e+1][n+1]),o(a[e+1][n]))}}(n,r,s,e)})(r),function(e){let i=new Y;for(let n=0;n<s.length;n+=3)i.x=s[n+0],i.y=s[n+1],i.z=s[n+2],i.normalize().multiplyScalar(e),s[n+0]=i.x,s[n+1]=i.y,s[n+2]=i.z}(n),function(){let e=new Y;for(let n=0;n<s.length;n+=3){var i;e.x=s[n+0],e.y=s[n+1],e.z=s[n+2];let r=u(e)/2/Math.PI+.5,o=Math.atan2(-(i=e).y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5;a.push(r,1-o)}(function(){let e=new Y,i=new Y,n=new Y,r=new Y,o=new I,l=new I,c=new I;for(let d=0,p=0;d<s.length;d+=9,p+=6){e.set(s[d+0],s[d+1],s[d+2]),i.set(s[d+3],s[d+4],s[d+5]),n.set(s[d+6],s[d+7],s[d+8]),o.set(a[p+0],a[p+1]),l.set(a[p+2],a[p+3]),c.set(a[p+4],a[p+5]),r.copy(e).add(i).add(n).divideScalar(3);let f=u(r);h(o,p+0,e,f),h(l,p+2,i,f),h(c,p+4,n,f)}})(),function(){for(let e=0;e<a.length;e+=6){let i=a[e+0],n=a[e+2],r=a[e+4],s=Math.max(i,n,r),o=Math.min(i,n,r);s>.9&&o<.1&&(i<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new tm(s,3)),this.setAttribute("normal",new tm(s.slice(),3)),this.setAttribute("uv",new tm(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new i0(e.vertices,e.indices,e.radius,e.details)}}class i1 extends i0{constructor(e=1,i=0){let n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new i1(e.radius,e.detail)}}class i2 extends iX{constructor(e){super(e),this.uuid=E(),this.type="Shape",this.holes=[]}getPointsHoles(e){let i=[];for(let n=0,r=this.holes.length;n<r;n++)i[n]=this.holes[n].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,n=e.holes.length;i<n;i++){let n=e.holes[i];this.holes.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,n=this.holes.length;i<n;i++){let n=this.holes[i];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,n=e.holes.length;i<n;i++){let n=e.holes[i];this.holes.push(new iX().fromJSON(n))}return this}}let i3=function(e,i,n=2){let r,s,a,o,l,h,u;let c=i&&i.length,d=c?i[0]*n:e.length,p=i4(e,0,d,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(e,i,n,r){let s,a,o,l,h;let u=[];for(s=0,a=i.length;s<a;s++)o=i[s]*r,l=s<a-1?i[s+1]*r:e.length,(h=i4(e,o,l,r,!1))===h.next&&(h.steiner=!0),u.push(function(e){let i=e,n=e;do(i.x<n.x||i.x===n.x&&i.y<n.y)&&(n=i),i=i.next;while(i!==e);return n}(h));for(u.sort(i6),s=0;s<u.length;s++)n=function(e,i){let n=function(e,i){let n=i,r=-1/0,s,a=e.x,o=e.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){let e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=a&&e>r&&(r=e,s=n.x<n.next.x?n:n.next,e===a))return s}n=n.next}while(n!==i);if(!s)return null;let l=s,h=s.x,u=s.y,c=1/0,d;n=s;do{var p,f;a>=n.x&&n.x>=h&&a!==n.x&&i7(o<u?a:r,o,h,u,o<u?r:a,o,n.x,n.y)&&(d=Math.abs(o-n.y)/(a-n.x),nr(n,e)&&(d<c||d===c&&(n.x>s.x||n.x===s.x&&(p=s,f=n,0>i9(p.prev,p,f.prev)&&0>i9(f.next,p,p.next))))&&(s=n,c=d)),n=n.next}while(n!==l);return s}(e,i);if(!n)return i;let r=ns(n,e);return i5(r,r.next),i5(n,n.next)}(u[s],n);return n}(e,i,p,n)),e.length>80*n){r=a=e[0],s=o=e[1];for(let i=n;i<d;i+=n)l=e[i],h=e[i+1],l<r&&(r=l),h<s&&(s=h),l>a&&(a=l),h>o&&(o=h);u=0!==(u=Math.max(a-r,o-s))?32767/u:0}return function e(i,n,r,s,a,o,l){if(!i)return;!l&&o&&function(e,i,n,r){let s=e;do 0===s.z&&(s.z=i8(s.x,s.y,i,n,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let i,n,r,s,a,o,l,h,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,l=0,i=0;i<u&&(l++,r=r.nextZ);i++);for(h=u;l>0||h>0&&r;)0!==l&&(0===h||!r||n.z<=r.z)?(s=n,n=n.nextZ,l--):(s=r,r=r.nextZ,h--),a?a.nextZ=s:e=s,s.prevZ=a,a=s;n=r}a.nextZ=null,u*=2}while(o>1)}(s)}(i,s,a,o);let h=i,u,c;for(;i.prev!==i.next;){if(u=i.prev,c=i.next,o?function(e,i,n,r){let s=e.prev,a=e.next;if(i9(s,e,a)>=0)return!1;let o=s.x,l=e.x,h=a.x,u=s.y,c=e.y,d=a.y,p=o<l?o<h?o:h:l<h?l:h,f=u<c?u<d?u:d:c<d?c:d,m=o>l?o>h?o:h:l>h?l:h,g=u>c?u>d?u:d:c>d?c:d,A=i8(p,f,i,n,r),v=i8(m,g,i,n,r),y=e.prevZ,x=e.nextZ;for(;y&&y.z>=A&&x&&x.z<=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==s&&y!==a&&i7(o,u,l,c,h,d,y.x,y.y)&&i9(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==a&&i7(o,u,l,c,h,d,x.x,x.y)&&i9(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=A;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==s&&y!==a&&i7(o,u,l,c,h,d,y.x,y.y)&&i9(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==a&&i7(o,u,l,c,h,d,x.x,x.y)&&i9(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}(i,s,a,o):function(e){let i=e.prev,n=e.next;if(i9(i,e,n)>=0)return!1;let r=i.x,s=e.x,a=n.x,o=i.y,l=e.y,h=n.y,u=r<s?r<a?r:a:s<a?s:a,c=o<l?o<h?o:h:l<h?l:h,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>h?o:h:l>h?l:h,f=n.next;for(;f!==i;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&i7(r,o,s,l,a,h,f.x,f.y)&&i9(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}(i)){n.push(u.i/r|0),n.push(i.i/r|0),n.push(c.i/r|0),no(i),i=c.next,h=c.next;continue}if((i=c)===h){l?1===l?e(i=function(e,i,n){let r=e;do{let s=r.prev,a=r.next.next;!ne(s,a)&&nt(s,r,r.next,a)&&nr(s,a)&&nr(a,s)&&(i.push(s.i/n|0),i.push(r.i/n|0),i.push(a.i/n|0),no(r),no(r.next),r=e=a),r=r.next}while(r!==e);return i5(r)}(i5(i),n,r),n,r,s,a,o,2):2===l&&function(i,n,r,s,a,o){let l=i;do{let i=l.next.next;for(;i!==l.prev;){var h,u;if(l.i!==i.i&&(h=l,u=i,h.next.i!==u.i&&h.prev.i!==u.i&&!function(e,i){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==i.i&&n.next.i!==i.i&&nt(n,n.next,e,i))return!0;n=n.next}while(n!==e);return!1}(h,u)&&(nr(h,u)&&nr(u,h)&&function(e,i){let n=e,r=!1,s=(e.x+i.x)/2,a=(e.y+i.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&s<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}(h,u)&&(i9(h.prev,h,u.prev)||i9(h,u.prev,u))||ne(h,u)&&i9(h.prev,h,h.next)>0&&i9(u.prev,u,u.next)>0))){let h=ns(l,i);l=i5(l,l.next),h=i5(h,h.next),e(l,n,r,s,a,o,0),e(h,n,r,s,a,o,0);return}i=i.next}l=l.next}while(l!==i)}(i,n,r,s,a,o):e(i5(i),n,r,s,a,o,1);break}}}(p,f,n,r,s,u,0),f};function i4(e,i,n,r,s){let a,o;if(s===function(e,i,n,r){let s=0;for(let a=i,o=n-r;a<n;a+=r)s+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return s}(e,i,n,r)>0)for(a=i;a<n;a+=r)o=na(a,e[a],e[a+1],o);else for(a=n-r;a>=i;a-=r)o=na(a,e[a],e[a+1],o);return o&&ne(o,o.next)&&(no(o),o=o.next),o}function i5(e,i){if(!e)return e;i||(i=e);let n=e,r;do if(r=!1,!n.steiner&&(ne(n,n.next)||0===i9(n.prev,n,n.next))){if(no(n),(n=i=n.prev)===n.next)break;r=!0}else n=n.next;while(r||n!==i);return i}function i6(e,i){return e.x-i.x}function i8(e,i,n,r,s){return(e=((e=((e=((e=((e=(e-n)*s|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(i=((i=((i=((i=((i=(i-r)*s|0)|i<<8)&0xff00ff)|i<<4)&0xf0f0f0f)|i<<2)&0x33333333)|i<<1)&0x55555555)<<1}function i7(e,i,n,r,s,a,o,l){return(s-o)*(i-l)>=(e-o)*(a-l)&&(e-o)*(r-l)>=(n-o)*(i-l)&&(n-o)*(a-l)>=(s-o)*(r-l)}function i9(e,i,n){return(i.y-e.y)*(n.x-i.x)-(i.x-e.x)*(n.y-i.y)}function ne(e,i){return e.x===i.x&&e.y===i.y}function nt(e,i,n,r){let s=nn(i9(e,i,n)),a=nn(i9(e,i,r)),o=nn(i9(n,r,e)),l=nn(i9(n,r,i));return!!(s!==a&&o!==l||0===s&&ni(e,n,i)||0===a&&ni(e,r,i)||0===o&&ni(n,e,r)||0===l&&ni(n,i,r))}function ni(e,i,n){return i.x<=Math.max(e.x,n.x)&&i.x>=Math.min(e.x,n.x)&&i.y<=Math.max(e.y,n.y)&&i.y>=Math.min(e.y,n.y)}function nn(e){return e>0?1:e<0?-1:0}function nr(e,i){return 0>i9(e.prev,e,e.next)?i9(e,i,e.next)>=0&&i9(e,e.prev,i)>=0:0>i9(e,i,e.prev)||0>i9(e,e.next,i)}function ns(e,i){let n=new nl(e.i,e.x,e.y),r=new nl(i.i,i.x,i.y),s=e.next,a=i.prev;return e.next=i,i.prev=e,n.next=s,s.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function na(e,i,n,r){let s=new nl(e,i,n);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function no(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function nl(e,i,n){this.i=e,this.x=i,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class nh{static area(e){let i=e.length,n=0;for(let r=i-1,s=0;s<i;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return .5*n}static isClockWise(e){return 0>nh.area(e)}static triangulateShape(e,i){let n=[],r=[],s=[];nu(e),nc(n,e);let a=e.length;i.forEach(nu);for(let e=0;e<i.length;e++)r.push(a),a+=i[e].length,nc(n,i[e]);let o=i3(n,r);for(let e=0;e<o.length;e+=3)s.push(o.slice(e,e+3));return s}}function nu(e){let i=e.length;i>2&&e[i-1].equals(e[0])&&e.pop()}function nc(e,i){for(let n=0;n<i.length;n++)e.push(i[n].x),e.push(i[n].y)}class nd extends tE{constructor(e=new i2([new I(.5,.5),new I(-.5,.5),new I(-.5,-.5),new I(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];let n=this,r=[],s=[];for(let a=0,o=e.length;a<o;a++)!function(e){let a,o,l,h;let u=[],c=void 0!==i.curveSegments?i.curveSegments:12,d=void 0!==i.steps?i.steps:1,p=void 0!==i.depth?i.depth:1,f=void 0===i.bevelEnabled||i.bevelEnabled,m=void 0!==i.bevelThickness?i.bevelThickness:.2,g=void 0!==i.bevelSize?i.bevelSize:m-.1,A=void 0!==i.bevelOffset?i.bevelOffset:0,v=void 0!==i.bevelSegments?i.bevelSegments:3,y=i.extrudePath,x=void 0!==i.UVGenerator?i.UVGenerator:np,_,b=!1;y&&(_=y.getSpacedPoints(d),b=!0,f=!1,a=y.computeFrenetFrames(d,!1),o=new Y,l=new Y,h=new Y),f||(v=0,m=0,g=0,A=0);let E=e.extractPoints(c),w=E.shape,M=E.holes;if(!nh.isClockWise(w)){w=w.reverse();for(let e=0,i=M.length;e<i;e++){let i=M[e];nh.isClockWise(i)&&(M[e]=i.reverse())}}let C=nh.triangulateShape(w,M),S=w;for(let e=0,i=M.length;e<i;e++){let i=M[e];w=w.concat(i)}function T(e,i,n){return i||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(i,n)}let R=w.length,B=C.length;function L(e,i,n){let r,s,a;let o=e.x-i.x,l=e.y-i.y,h=n.x-e.x,u=n.y-e.y,c=o*o+l*l;if(Math.abs(o*u-l*h)>Number.EPSILON){let d=Math.sqrt(c),p=Math.sqrt(h*h+u*u),f=i.x-l/d,m=i.y+o/d,g=((n.x-u/p-f)*u-(n.y+h/p-m)*h)/(o*u-l*h),A=(r=f+o*g-e.x)*r+(s=m+l*g-e.y)*s;if(A<=2)return new I(r,s);a=Math.sqrt(A/2)}else{let e=!1;o>Number.EPSILON?h>Number.EPSILON&&(e=!0):o<-Number.EPSILON?h<-Number.EPSILON&&(e=!0):Math.sign(l)===Math.sign(u)&&(e=!0),e?(r=-l,s=o,a=Math.sqrt(c)):(r=o,s=l,a=Math.sqrt(c/2))}return new I(r/a,s/a)}let P=[];for(let e=0,i=S.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),P[e]=L(S[e],S[n],S[r]);let D=[],N,O=P.concat();for(let e=0,i=M.length;e<i;e++){let i=M[e];N=[];for(let e=0,n=i.length,r=n-1,s=e+1;e<n;e++,r++,s++)r===n&&(r=0),s===n&&(s=0),N[e]=L(i[e],i[r],i[s]);D.push(N),O=O.concat(N)}for(let e=0;e<v;e++){let i=e/v,n=m*Math.cos(i*Math.PI/2),r=g*Math.sin(i*Math.PI/2)+A;for(let e=0,i=S.length;e<i;e++){let i=T(S[e],P[e],r);F(i.x,i.y,-n)}for(let e=0,i=M.length;e<i;e++){let i=M[e];N=D[e];for(let e=0,s=i.length;e<s;e++){let s=T(i[e],N[e],r);F(s.x,s.y,-n)}}}let U=g+A;for(let e=0;e<R;e++){let i=f?T(w[e],O[e],U):w[e];b?(l.copy(a.normals[0]).multiplyScalar(i.x),o.copy(a.binormals[0]).multiplyScalar(i.y),h.copy(_[0]).add(l).add(o),F(h.x,h.y,h.z)):F(i.x,i.y,0)}for(let e=1;e<=d;e++)for(let i=0;i<R;i++){let n=f?T(w[i],O[i],U):w[i];b?(l.copy(a.normals[e]).multiplyScalar(n.x),o.copy(a.binormals[e]).multiplyScalar(n.y),h.copy(_[e]).add(l).add(o),F(h.x,h.y,h.z)):F(n.x,n.y,p/d*e)}for(let e=v-1;e>=0;e--){let i=e/v,n=m*Math.cos(i*Math.PI/2),r=g*Math.sin(i*Math.PI/2)+A;for(let e=0,i=S.length;e<i;e++){let i=T(S[e],P[e],r);F(i.x,i.y,p+n)}for(let e=0,i=M.length;e<i;e++){let i=M[e];N=D[e];for(let e=0,s=i.length;e<s;e++){let s=T(i[e],N[e],r);b?F(s.x,s.y+_[d-1].y,_[d-1].x+n):F(s.x,s.y,p+n)}}}function k(e,i){let s=e.length;for(;--s>=0;){let a=s,o=s-1;o<0&&(o=e.length-1);for(let e=0,s=d+2*v;e<s;e++){let s=R*e,l=R*(e+1);!function(e,i,s,a){G(e),G(i),G(a),G(i),G(s),G(a);let o=r.length/3,l=x.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);V(l[0]),V(l[1]),V(l[3]),V(l[1]),V(l[2]),V(l[3])}(i+a+s,i+o+s,i+o+l,i+a+l)}}}function F(e,i,n){u.push(e),u.push(i),u.push(n)}function z(e,i,s){G(e),G(i),G(s);let a=r.length/3,o=x.generateTopUV(n,r,a-3,a-2,a-1);V(o[0]),V(o[1]),V(o[2])}function G(e){r.push(u[3*e+0]),r.push(u[3*e+1]),r.push(u[3*e+2])}function V(e){s.push(e.x),s.push(e.y)}(function(){let e=r.length/3;if(f){let e=0,i=0*R;for(let e=0;e<B;e++){let n=C[e];z(n[2]+i,n[1]+i,n[0]+i)}i=R*(d+2*v);for(let e=0;e<B;e++){let n=C[e];z(n[0]+i,n[1]+i,n[2]+i)}}else{for(let e=0;e<B;e++){let i=C[e];z(i[2],i[1],i[0])}for(let e=0;e<B;e++){let i=C[e];z(i[0]+R*d,i[1]+R*d,i[2]+R*d)}}n.addGroup(e,r.length/3-e,0)})(),function(){let e=r.length/3,i=0;k(S,0),i+=S.length;for(let e=0,n=M.length;e<n;e++){let n=M[e];k(n,i),i+=n.length}n.addGroup(e,r.length/3-e,1)}()}(e[a]);this.setAttribute("position",new tm(r,3)),this.setAttribute("uv",new tm(s,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,i,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){let r=e[i];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},i),void 0!==i.extrudePath&&(n.options.extrudePath=i.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,i){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let s=i[e.shapes[r]];n.push(s)}let r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=new iW[r.type]().fromJSON(r)),new nd(n,e.options)}}let np={generateTopUV:function(e,i,n,r,s){let a=i[3*n],o=i[3*n+1],l=i[3*r],h=i[3*r+1],u=i[3*s],c=i[3*s+1];return[new I(a,o),new I(l,h),new I(u,c)]},generateSideWallUV:function(e,i,n,r,s,a){let o=i[3*n],l=i[3*n+1],h=i[3*n+2],u=i[3*r],c=i[3*r+1],d=i[3*r+2],p=i[3*s],f=i[3*s+1],m=i[3*s+2],g=i[3*a],A=i[3*a+1],v=i[3*a+2];return Math.abs(l-c)<Math.abs(o-u)?[new I(o,1-h),new I(u,1-d),new I(p,1-m),new I(g,1-v)]:[new I(l,1-h),new I(c,1-d),new I(f,1-m),new I(A,1-v)]}};class nf extends i0{constructor(e=1,i=0){let n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new nf(e.radius,e.detail)}}class nm extends i0{constructor(e=1,i=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new nm(e.radius,e.detail)}}class ng extends tE{constructor(e=.5,i=1,n=32,r=1,s=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:a},n=Math.max(3,n);let o=[],l=[],h=[],u=[],c=e,d=(i-e)/(r=Math.max(1,r)),p=new Y,f=new I;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){let r=s+e/n*a;p.x=c*Math.cos(r),p.y=c*Math.sin(r),l.push(p.x,p.y,p.z),h.push(0,0,1),f.x=(p.x/i+1)/2,f.y=(p.y/i+1)/2,u.push(f.x,f.y)}c+=d}for(let e=0;e<r;e++){let i=e*(n+1);for(let e=0;e<n;e++){let r=e+i,s=r+n+1,a=r+n+2,l=r+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new tm(l,3)),this.setAttribute("normal",new tm(h,3)),this.setAttribute("uv",new tm(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ng(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class nA extends tE{constructor(e=new i2([new I(0,.5),new I(-.5,-.5),new I(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};let n=[],r=[],s=[],a=[],o=0,l=0;if(!1===Array.isArray(e))h(e);else for(let i=0;i<e.length;i++)h(e[i]),this.addGroup(o,l,i),o+=l,l=0;function h(e){let o=r.length/3,h=e.extractPoints(i),u=h.shape,c=h.holes;!1===nh.isClockWise(u)&&(u=u.reverse());for(let e=0,i=c.length;e<i;e++){let i=c[e];!0===nh.isClockWise(i)&&(c[e]=i.reverse())}let d=nh.triangulateShape(u,c);for(let e=0,i=c.length;e<i;e++){let i=c[e];u=u.concat(i)}for(let e=0,i=u.length;e<i;e++){let i=u[e];r.push(i.x,i.y,0),s.push(0,0,1),a.push(i.x,i.y)}for(let e=0,i=d.length;e<i;e++){let i=d[e],r=i[0]+o,s=i[1]+o,a=i[2]+o;n.push(r,s,a),l+=3}}this.setIndex(n),this.setAttribute("position",new tm(r,3)),this.setAttribute("normal",new tm(s,3)),this.setAttribute("uv",new tm(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,i){if(i.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){let r=e[n];i.shapes.push(r.uuid)}else i.shapes.push(e.uuid);return i}(this.parameters.shapes,e)}static fromJSON(e,i){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let s=i[e.shapes[r]];n.push(s)}return new nA(n,e.curveSegments)}}class nv extends tE{constructor(e=1,i=32,n=16,r=0,s=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:r,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));let l=Math.min(a+o,Math.PI),h=0,u=[],c=new Y,d=new Y,p=[],f=[],m=[],g=[];for(let p=0;p<=n;p++){let A=[],v=p/n,y=0;0===p&&0===a?y=.5/i:p===n&&l===Math.PI&&(y=-.5/i);for(let n=0;n<=i;n++){let l=n/i;c.x=-e*Math.cos(r+l*s)*Math.sin(a+v*o),c.y=e*Math.cos(a+v*o),c.z=e*Math.sin(r+l*s)*Math.sin(a+v*o),f.push(c.x,c.y,c.z),d.copy(c).normalize(),m.push(d.x,d.y,d.z),g.push(l+y,1-v),A.push(h++)}u.push(A)}for(let e=0;e<n;e++)for(let r=0;r<i;r++){let i=u[e][r+1],s=u[e][r],o=u[e+1][r],h=u[e+1][r+1];(0!==e||a>0)&&p.push(i,s,h),(e!==n-1||l<Math.PI)&&p.push(s,o,h)}this.setIndex(p),this.setAttribute("position",new tm(f,3)),this.setAttribute("normal",new tm(m,3)),this.setAttribute("uv",new tm(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class ny extends i0{constructor(e=1,i=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new ny(e.radius,e.detail)}}class nx extends tE{constructor(e=1,i=.4,n=12,r=48,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);let a=[],o=[],l=[],h=[],u=new Y,c=new Y,d=new Y;for(let a=0;a<=n;a++)for(let p=0;p<=r;p++){let f=p/r*s,m=a/n*Math.PI*2;c.x=(e+i*Math.cos(m))*Math.cos(f),c.y=(e+i*Math.cos(m))*Math.sin(f),c.z=i*Math.sin(m),o.push(c.x,c.y,c.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),d.subVectors(c,u).normalize(),l.push(d.x,d.y,d.z),h.push(p/r),h.push(a/n)}for(let e=1;e<=n;e++)for(let i=1;i<=r;i++){let n=(r+1)*e+i-1,s=(r+1)*(e-1)+i-1,o=(r+1)*(e-1)+i,l=(r+1)*e+i;a.push(n,s,l),a.push(s,o,l)}this.setIndex(a),this.setAttribute("position",new tm(o,3)),this.setAttribute("normal",new tm(l,3)),this.setAttribute("uv",new tm(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nx(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class n_ extends tE{constructor(e=1,i=.4,n=64,r=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:n,radialSegments:r,p:s,q:a},n=Math.floor(n),r=Math.floor(r);let o=[],l=[],h=[],u=[],c=new Y,d=new Y,p=new Y,f=new Y,m=new Y,g=new Y,A=new Y;for(let o=0;o<=n;++o){let y=o/n*s*Math.PI*2;v(y,s,a,e,p),v(y+.01,s,a,e,f),g.subVectors(f,p),A.addVectors(f,p),m.crossVectors(g,A),A.crossVectors(m,g),m.normalize(),A.normalize();for(let e=0;e<=r;++e){let s=e/r*Math.PI*2,a=-i*Math.cos(s),f=i*Math.sin(s);c.x=p.x+(a*A.x+f*m.x),c.y=p.y+(a*A.y+f*m.y),c.z=p.z+(a*A.z+f*m.z),l.push(c.x,c.y,c.z),d.subVectors(c,p).normalize(),h.push(d.x,d.y,d.z),u.push(o/n),u.push(e/r)}}for(let e=1;e<=n;e++)for(let i=1;i<=r;i++){let n=(r+1)*(e-1)+(i-1),s=(r+1)*e+(i-1),a=(r+1)*e+i,l=(r+1)*(e-1)+i;o.push(n,s,l),o.push(s,a,l)}function v(e,i,n,r,s){let a=Math.cos(e),o=Math.sin(e),l=n/i*e,h=Math.cos(l);s.x=r*(2+h)*.5*a,s.y=r*(2+h)*o*.5,s.z=r*Math.sin(l)*.5}this.setIndex(o),this.setAttribute("position",new tm(l,3)),this.setAttribute("normal",new tm(h,3)),this.setAttribute("uv",new tm(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new n_(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class nb extends tE{constructor(e=new iH(new Y(-1,-1,0),new Y(-1,1,0),new Y(1,1,0)),i=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:n,radialSegments:r,closed:s};let a=e.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let o=new Y,l=new Y,h=new I,u=new Y,c=[],d=[],p=[],f=[];function m(s){u=e.getPointAt(s/i,u);let h=a.normals[s],p=a.binormals[s];for(let e=0;e<=r;e++){let i=e/r*Math.PI*2,s=Math.sin(i),a=-Math.cos(i);l.x=a*h.x+s*p.x,l.y=a*h.y+s*p.y,l.z=a*h.z+s*p.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+n*l.x,o.y=u.y+n*l.y,o.z=u.z+n*l.z,c.push(o.x,o.y,o.z)}}(function(){for(let e=0;e<i;e++)m(e);m(!1===s?i:0),function(){for(let e=0;e<=i;e++)for(let n=0;n<=r;n++)h.x=e/i,h.y=n/r,p.push(h.x,h.y)}(),function(){for(let e=1;e<=i;e++)for(let i=1;i<=r;i++){let n=(r+1)*(e-1)+(i-1),s=(r+1)*e+(i-1),a=(r+1)*e+i,o=(r+1)*(e-1)+i;f.push(n,s,o),f.push(s,a,o)}}()})(),this.setIndex(f),this.setAttribute("position",new tm(c,3)),this.setAttribute("normal",new tm(d,3)),this.setAttribute("uv",new tm(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new nb(new iW[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class nE extends tl{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ts(0xffffff),this.specular=new ts(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new I(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new eO,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nw extends tl{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ts(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new I(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new eO,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function nM(e,i,n){return e&&(n||e.constructor!==i)?"number"==typeof i.BYTES_PER_ELEMENT?new i(e):Array.prototype.slice.call(e):e}function nC(e,i,n){let r=e.length,s=new e.constructor(r);for(let a=0,o=0;o!==r;++a){let r=n[a]*i;for(let n=0;n!==i;++n)s[o++]=e[r+n]}return s}function nS(e,i,n,r){let s=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[s++];if(void 0===a)return;let o=a[r];if(void 0!==o){if(Array.isArray(o))do void 0!==(o=a[r])&&(i.push(a.time),n.push.apply(n,o)),a=e[s++];while(void 0!==a);else if(void 0!==o.toArray)do void 0!==(o=a[r])&&(i.push(a.time),o.toArray(n,n.length)),a=e[s++];while(void 0!==a);else do void 0!==(o=a[r])&&(i.push(a.time),n.push(o)),a=e[s++];while(void 0!==a)}}class nT{constructor(e,i,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new i.constructor(n),this.sampleValues=i,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let i=this.parameterPositions,n=this._cachedIndex,r=i[n],s=i[n-1];e:{t:{let a;i:{n:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<s)break n;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,e<(r=i[++n]))break t}a=i.length;break i}if(!(e>=s)){let o=i[1];e<o&&(n=2,s=o);for(let a=n-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=s,e>=(s=i[--n-1]))break t}a=n,n=0;break i}break e}for(;n<a;){let r=n+a>>>1;e<i[r]?a=r:n=r+1}if(r=i[n],void 0===(s=i[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let e=0;e!==r;++e)i[e]=n[s+e];return i}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}class nR extends nT{constructor(e,i,n,r){super(e,i,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,i,n){let r=this.parameterPositions,s=e-2,a=e+1,o=r[s],l=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:s=e,o=2*i-n;break;case 2402:s=r.length-2,o=i+r[s]-r[s+1];break;default:s=e,o=n}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:a=e,l=2*n-i;break;case 2402:a=1,l=n+r[1]-r[0];break;default:a=e-1,l=i}let h=(n-i)*.5,u=this.valueSize;this._weightPrev=h/(i-o),this._weightNext=h/(l-n),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,u=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(n-i)/(r-i),m=f*f,g=m*f,A=-d*g+2*d*m-d*f,v=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*f+1,y=(-1-p)*g+(1.5+p)*m+.5*f,x=p*g-p*m;for(let e=0;e!==o;++e)s[e]=A*a[u+e]+v*a[h+e]+y*a[l+e]+x*a[c+e];return s}}class nI extends nT{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,u=(n-i)/(r-i),c=1-u;for(let e=0;e!==o;++e)s[e]=a[h+e]*c+a[l+e]*u;return s}}class nB extends nT{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class nL{constructor(e,i,n,r){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===i||0===i.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=nM(i,this.TimeBufferType),this.values=nM(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let i;let n=e.constructor;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:nM(e.times,Array),values:nM(e.values,Array)};let n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new nB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new nI(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new nR(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case 2300:i=this.InterpolantFactoryMethodDiscrete;break;case 2301:i=this.InterpolantFactoryMethodLinear;break;case 2302:i=this.InterpolantFactoryMethodSmooth}if(void 0===i){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(i)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]+=e}return this}scale(e){if(1!==e){let i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]*=e}return this}trim(e,i){let n=this.times,r=n.length,s=0,a=r-1;for(;s!==r&&n[s]<e;)++s;for(;-1!==a&&n[a]>i;)--a;if(++a,0!==s||a!==r){s>=a&&(s=(a=Math.max(a,1))-1);let e=this.getValueSize();this.times=n.slice(s,a),this.values=this.values.slice(s*e,a*e)}return this}validate(){let e=!0,i=this.getValueSize();i-Math.floor(i)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,r=this.values,s=n.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let i=0;i!==s;i++){let r=n[i];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,i,r),e=!1;break}if(null!==a&&a>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,i,r,a),e=!1;break}a=r}if(void 0!==r){if(ArrayBuffer.isView(r)&&!(r instanceof DataView))for(let i=0,n=r.length;i!==n;++i){let n=r[i];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,i,n),e=!1;break}}}return e}optimize(){let e=this.times.slice(),i=this.values.slice(),n=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1,a=1;for(let o=1;o<s;++o){let s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0])){if(r)s=!0;else{let e=o*n,r=e-n,a=e+n;for(let o=0;o!==n;++o){let n=i[e+o];if(n!==i[r+o]||n!==i[a+o]){s=!0;break}}}}if(s){if(o!==a){e[a]=e[o];let r=o*n,s=a*n;for(let e=0;e!==n;++e)i[s+e]=i[r+e]}++a}}if(s>0){e[a]=e[s];for(let e=s*n,r=a*n,o=0;o!==n;++o)i[r+o]=i[e+o];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*n)):(this.times=e,this.values=i),this}clone(){let e=this.times.slice(),i=this.values.slice(),n=new this.constructor(this.name,e,i);return n.createInterpolant=this.createInterpolant,n}}nL.prototype.TimeBufferType=Float32Array,nL.prototype.ValueBufferType=Float32Array,nL.prototype.DefaultInterpolation=2301;class nP extends nL{}nP.prototype.ValueTypeName="bool",nP.prototype.ValueBufferType=Array,nP.prototype.DefaultInterpolation=2300,nP.prototype.InterpolantFactoryMethodLinear=void 0,nP.prototype.InterpolantFactoryMethodSmooth=void 0;class nD extends nL{}nD.prototype.ValueTypeName="color";class nN extends nL{}nN.prototype.ValueTypeName="number";class nO extends nT{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(n-i)/(r-i),h=e*o;for(let e=h+o;h!==e;h+=4)K.slerpFlat(s,0,a,h-o,a,h,l);return s}}class nU extends nL{InterpolantFactoryMethodLinear(e){return new nO(this.times,this.values,this.getValueSize(),e)}}nU.prototype.ValueTypeName="quaternion",nU.prototype.DefaultInterpolation=2301,nU.prototype.InterpolantFactoryMethodSmooth=void 0;class nk extends nL{}nk.prototype.ValueTypeName="string",nk.prototype.ValueBufferType=Array,nk.prototype.DefaultInterpolation=2300,nk.prototype.InterpolantFactoryMethodLinear=void 0,nk.prototype.InterpolantFactoryMethodSmooth=void 0;class nF extends nL{}nF.prototype.ValueTypeName="vector";class nz{constructor(e="",i=-1,n=[],r=2500){this.name=e,this.tracks=n,this.duration=i,this.blendMode=r,this.uuid=E(),this.duration<0&&this.resetDuration()}static parse(e){let i=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,s=n.length;e!==s;++e)i.push((function(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let i=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return nN;case"vector":case"vector2":case"vector3":case"vector4":return nF;case"color":return nD;case"quaternion":return nU;case"bool":case"boolean":return nP;case"string":return nk}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let i=[],n=[];nS(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==i.parse?i.parse(e):new i(e.name,e.times,e.values,e.interpolation)})(n[e]).scale(r));let s=new this(e.name,e.duration,i,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){let i=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)i.push(nL.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,i,n,r){let s=i.length,a=[];for(let e=0;e<s;e++){let o=[],l=[];o.push((e+s-1)%s,e,(e+1)%s),l.push(0,1,0);let h=function(e){let i=e.length,n=Array(i);for(let e=0;e!==i;++e)n[e]=e;return n.sort(function(i,n){return e[i]-e[n]}),n}(o);o=nC(o,1,h),l=nC(l,1,h),r||0!==o[0]||(o.push(s),l.push(l[0])),a.push(new nN(".morphTargetInfluences["+i[e].name+"]",o,l).scale(1/n))}return new this(e,-1,a)}static findByName(e,i){let n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<n.length;e++)if(n[e].name===i)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,i,n){let r={},s=/^([\w-]*?)([\d]+)$/;for(let i=0,n=e.length;i<n;i++){let n=e[i],a=n.name.match(s);if(a&&a.length>1){let e=a[1],i=r[e];i||(r[e]=i=[]),i.push(n)}}let a=[];for(let e in r)a.push(this.CreateFromMorphTargetSequence(e,r[e],i,n));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(e,i,n,r,s){if(0!==n.length){let a=[],o=[];nS(n,a,o,r),0!==a.length&&s.push(new e(i,a,o))}},r=[],s=e.name||"default",a=e.fps||30,o=e.blendMode,l=e.length||-1,h=e.hierarchy||[];for(let e=0;e<h.length;e++){let s=h[e].keys;if(s&&0!==s.length){if(s[0].morphTargets){let e;let i={};for(e=0;e<s.length;e++)if(s[e].morphTargets)for(let n=0;n<s[e].morphTargets.length;n++)i[s[e].morphTargets[n]]=-1;for(let n in i){let i=[],a=[];for(let r=0;r!==s[e].morphTargets.length;++r){let r=s[e];i.push(r.time),a.push(+(r.morphTarget===n))}r.push(new nN(".morphTargetInfluence["+n+"]",i,a))}l=i.length*a}else{let a=".bones["+i[e].name+"]";n(nF,a+".position",s,"pos",r),n(nU,a+".quaternion",s,"rot",r),n(nF,a+".scale",s,"scl",r)}}}return 0===r.length?null:new this(s,l,r,o)}resetDuration(){let e=this.tracks,i=0;for(let n=0,r=e.length;n!==r;++n){let e=this.tracks[n];i=Math.max(i,e.times[e.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}let nG={enabled:!1,files:{},add:function(e,i){!1!==this.enabled&&(this.files[e]=i)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},nV=new class{constructor(e,i,n){let r;let s=this,a=!1,o=0,l=0,h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=n,this.itemStart=function(e){l++,!1===a&&void 0!==s.onStart&&s.onStart(e,o,l),a=!0},this.itemEnd=function(e){o++,void 0!==s.onProgress&&s.onProgress(e,o,l),o===l&&(a=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(e){void 0!==s.onError&&s.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,i){return h.push(e,i),this},this.removeHandler=function(e){let i=h.indexOf(e);return -1!==i&&h.splice(i,2),this},this.getHandler=function(e){for(let i=0,n=h.length;i<n;i+=2){let n=h[i],r=h[i+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}};class nj{constructor(e){this.manager=void 0!==e?e:nV,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){let n=this;return new Promise(function(r,s){n.load(e,r,i,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}nj.DEFAULT_MATERIAL_NAME="__DEFAULT";let nH={};class nQ extends Error{constructor(e,i){super(e),this.response=i}}class nW extends nj{constructor(e){super(e)}load(e,i,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let s=nG.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{i&&i(s),this.manager.itemEnd(e)},0),s;if(void 0!==nH[e]){nH[e].push({onLoad:i,onProgress:n,onError:r});return}nH[e]=[],nH[e].push({onLoad:i,onProgress:n,onError:r});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(i=>{if(200===i.status||0===i.status){if(0===i.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===i.body||void 0===i.body.getReader)return i;let n=nH[e],r=i.body.getReader(),s=i.headers.get("X-File-Size")||i.headers.get("Content-Length"),a=s?parseInt(s):0,o=0!==a,l=0;return new Response(new ReadableStream({start(e){(function i(){r.read().then(({done:r,value:s})=>{if(r)e.close();else{let r=new ProgressEvent("progress",{lengthComputable:o,loaded:l+=s.byteLength,total:a});for(let e=0,i=n.length;e<i;e++){let i=n[e];i.onProgress&&i.onProgress(r)}e.enqueue(s),i()}})})()}}))}throw new nQ(`fetch for "${i.url}" responded with ${i.status}: ${i.statusText}`,i)}).then(e=>{switch(l){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>new DOMParser().parseFromString(e,o));case"json":return e.json();default:if(void 0===o)return e.text();{let i=/charset="?([^;"\s]*)"?/i.exec(o),n=new TextDecoder(i&&i[1]?i[1].toLowerCase():void 0);return e.arrayBuffer().then(e=>n.decode(e))}}}).then(i=>{nG.add(e,i);let n=nH[e];delete nH[e];for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onLoad&&r.onLoad(i)}}).catch(i=>{let n=nH[e];if(void 0===n)throw this.manager.itemError(e),i;delete nH[e];for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onError&&r.onError(i)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class nq extends nj{constructor(e){super(e)}load(e,i,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,a=nG.get(e);if(void 0!==a)return s.manager.itemStart(e),setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a;let o=P("img");function l(){u(),nG.add(e,this),i&&i(this),s.manager.itemEnd(e)}function h(i){u(),r&&r(i),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",h,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class nX extends nj{constructor(e){super(e)}load(e,i,n,r){let s=this,a=new ip,o=new nW(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(e){let n;try{n=s.parse(e)}catch(e){if(void 0!==r)r(e);else{console.error(e);return}}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:u,a.wrapT=void 0!==n.wrapT?n.wrapT:u,a.magFilter=void 0!==n.magFilter?n.magFilter:1006,a.minFilter=void 0!==n.minFilter?n.minFilter:1006,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(a.colorSpace=n.colorSpace),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=c),1===n.mipmapCount&&(a.minFilter=1006),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,i&&i(a,n)},n,r),a}}class nK extends nj{constructor(e){super(e)}load(e,i,n,r){let s=new q,a=new nq(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){s.image=e,s.needsUpdate=!0,void 0!==i&&i(s)},n,r),s}}class nY extends e${constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new ts(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,void 0!==this.groundColor&&(i.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(i.object.distance=this.distance),void 0!==this.angle&&(i.object.angle=this.angle),void 0!==this.decay&&(i.object.decay=this.decay),void 0!==this.penumbra&&(i.object.penumbra=this.penumbra),void 0!==this.shadow&&(i.object.shadow=this.shadow.toJSON()),i}}let nJ=new eC,nZ=new Y,n$=new Y;class n0{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new I(512,512),this.map=null,this.mapPass=null,this.matrix=new eC,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new t2,this._frameExtents=new I(1,1),this._viewportCount=1,this._viewports=[new X(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let i=this.camera,n=this.matrix;nZ.setFromMatrixPosition(e.matrixWorld),i.position.copy(nZ),n$.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(n$),i.updateMatrixWorld(),nJ.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nJ),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(nJ)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class n1 extends n0{constructor(){super(new tK(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let i=this.camera,n=2*b*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||i.far;(n!==i.fov||r!==i.aspect||s!==i.far)&&(i.fov=n,i.aspect=r,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class n2 extends nY{constructor(e,i,n=0,r=Math.PI/3,s=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(e$.DEFAULT_UP),this.updateMatrix(),this.target=new e$,this.distance=n,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new n1}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let n3=new eC,n4=new Y,n5=new Y;class n6 extends n0{constructor(){super(new tK(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new I(4,2),this._viewportCount=6,this._viewports=[new X(2,1,1,1),new X(0,1,1,1),new X(3,1,1,1),new X(1,1,1,1),new X(3,0,1,1),new X(1,0,1,1)],this._cubeDirections=[new Y(1,0,0),new Y(-1,0,0),new Y(0,0,1),new Y(0,0,-1),new Y(0,1,0),new Y(0,-1,0)],this._cubeUps=[new Y(0,1,0),new Y(0,1,0),new Y(0,1,0),new Y(0,1,0),new Y(0,0,1),new Y(0,0,-1)]}updateMatrices(e,i=0){let n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),n4.setFromMatrixPosition(e.matrixWorld),n.position.copy(n4),n5.copy(n.position),n5.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(n5),n.updateMatrixWorld(),r.makeTranslation(-n4.x,-n4.y,-n4.z),n3.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n3)}}class n8 extends nY{constructor(e,i,n=0,r=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new n6}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class n7 extends n0{constructor(){super(new t7(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class n9 extends nY{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(e$.DEFAULT_UP),this.updateMatrix(),this.target=new e$,this.shadow=new n7}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class re extends nY{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class rt{static decodeText(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let i="";for(let n=0,r=e.length;n<r;n++)i+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(i))}catch(e){return i}}static extractUrlBase(e){let i=e.lastIndexOf("/");return -1===i?"./":e.slice(0,i+1)}static resolveURL(e,i){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:i+e}}let ri="\\[\\]\\.:\\/",rn=RegExp("["+ri+"]","g"),rr="[^"+ri+"]",rs="[^"+ri.replace("\\.","")+"]",ra=/((?:WC+[\/:])*)/.source.replace("WC",rr),ro=/(WCOD+)?/.source.replace("WCOD",rs),rl=RegExp("^"+ra+ro+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rr)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rr)+"$"),rh=["material","materials","bones","map"];class ru{constructor(e,i,n){this.path=i,this.parsedPath=n||ru.parseTrackName(i),this.node=ru.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,n){return e&&e.isAnimationObjectGroup?new ru.Composite(e,i,n):new ru(e,i,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(rn,"")}static parseTrackName(e){let i=rl.exec(e);if(null===i)throw Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let e=n.nodeName.substring(r+1);-1!==rh.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,i){if(void 0===i||""===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(i);if(void 0!==n)return n}if(e.children){let n=function(e){for(let r=0;r<e.length;r++){let s=e[r];if(s.name===i||s.uuid===i)return s;let a=n(s.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[i++]=n[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node,i=this.parsedPath,n=i.objectName,r=i.propertyName,s=i.propertyIndex;if(e||(e=ru.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let r=i.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let i=0;i<e.length;i++)if(e[i].name===r){r=i;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(void 0===e[n]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(void 0!==r){if(void 0===e[r]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[r]}}let a=e[r];if(void 0===a){console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+r+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===r){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ru.Composite=class{constructor(e,i,n){let r=n||ru.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,r)}getValue(e,i){this.bind();let n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,i)}setValue(e,i){let n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,i)}bind(){let e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].bind()}unbind(){let e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].unbind()}},ru.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ru.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ru.prototype.GetterByBindingType=[ru.prototype._getValue_direct,ru.prototype._getValue_array,ru.prototype._getValue_arrayElement,ru.prototype._getValue_toArray],ru.prototype.SetterByBindingTypeAndVersioning=[[ru.prototype._setValue_direct,ru.prototype._setValue_direct_setNeedsUpdate,ru.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ru.prototype._setValue_array,ru.prototype._setValue_array_setNeedsUpdate,ru.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ru.prototype._setValue_arrayElement,ru.prototype._setValue_arrayElement_setNeedsUpdate,ru.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ru.prototype._setValue_fromArray,ru.prototype._setValue_fromArray_setNeedsUpdate,ru.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"164"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="164")},23842:function(e,i,n){"use strict";function r(e,i){let n;if(void 0===i)for(let i of e)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);else{let r=-1;for(let s of e)null!=(s=i(s,++r,e))&&(n<s||void 0===n&&s>=s)&&(n=s)}return n}n.d(i,{Z:()=>r})},99696:function(e,i,n){"use strict";function r(e,i){let n;if(void 0===i)for(let i of e)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);else{let r=-1;for(let s of e)null!=(s=i(s,++r,e))&&(n>s||void 0===n&&s>=s)&&(n=s)}return n}n.d(i,{Z:()=>r})},64171:function(e,i,n){"use strict";function r(e,i,n){var r,s=1;function a(){var a,o,l=r.length,h=0,u=0,c=0;for(a=0;a<l;++a)h+=(o=r[a]).x||0,u+=o.y||0,c+=o.z||0;for(h=(h/l-e)*s,u=(u/l-i)*s,c=(c/l-n)*s,a=0;a<l;++a)o=r[a],h&&(o.x-=h),u&&(o.y-=u),c&&(o.z-=c)}return null==e&&(e=0),null==i&&(i=0),null==n&&(n=0),a.initialize=function(e){r=e},a.x=function(i){return arguments.length?(e=+i,a):e},a.y=function(e){return arguments.length?(i=+e,a):i},a.z=function(e){return arguments.length?(n=+e,a):n},a.strength=function(e){return arguments.length?(s=+e,a):s},a}n.d(i,{Z:()=>r})},36499:function(e,i,n){"use strict";function r(e){return function(){return e}}n.d(i,{Z:()=>r})},79306:function(e,i,n){"use strict";function r(e){return(e()-.5)*1e-6}n.d(i,{Z:()=>r})},83585:function(e,i,n){"use strict";n.d(i,{Z:()=>l});var r=n(36499),s=n(79306);function a(e){return e.index}function o(e,i){var n=e.get(i);if(!n)throw Error("node not found: "+i);return n}function l(e){var i,n,l,h,u,c,d,p=a,f=function(e){return 1/Math.min(u[e.source.index],u[e.target.index])},m=(0,r.Z)(30),g=1;function A(r){for(var a=0,o=e.length;a<g;++a)for(var l,u,p,f,m,A=0,v=0,y=0,x=0;A<o;++A)u=(l=e[A]).source,v=(p=l.target).x+p.vx-u.x-u.vx||(0,s.Z)(d),h>1&&(y=p.y+p.vy-u.y-u.vy||(0,s.Z)(d)),h>2&&(x=p.z+p.vz-u.z-u.vz||(0,s.Z)(d)),f=((f=Math.sqrt(v*v+y*y+x*x))-n[A])/f*r*i[A],v*=f,y*=f,x*=f,p.vx-=v*(m=c[A]),h>1&&(p.vy-=y*m),h>2&&(p.vz-=x*m),u.vx+=v*(m=1-m),h>1&&(u.vy+=y*m),h>2&&(u.vz+=x*m)}function v(){if(l){var r,s,a=l.length,h=e.length,d=new Map(l.map((e,i)=>[p(e,i,l),e]));for(r=0,u=Array(a);r<h;++r)(s=e[r]).index=r,"object"!=typeof s.source&&(s.source=o(d,s.source)),"object"!=typeof s.target&&(s.target=o(d,s.target)),u[s.source.index]=(u[s.source.index]||0)+1,u[s.target.index]=(u[s.target.index]||0)+1;for(r=0,c=Array(h);r<h;++r)s=e[r],c[r]=u[s.source.index]/(u[s.source.index]+u[s.target.index]);i=Array(h),y(),n=Array(h),x()}}function y(){if(l)for(var n=0,r=e.length;n<r;++n)i[n]=+f(e[n],n,e)}function x(){if(l)for(var i=0,r=e.length;i<r;++i)n[i]=+m(e[i],i,e)}return null==e&&(e=[]),A.initialize=function(e,...i){l=e,d=i.find(e=>"function"==typeof e)||Math.random,h=i.find(e=>[1,2,3].includes(e))||2,v()},A.links=function(i){return arguments.length?(e=i,v(),A):e},A.id=function(e){return arguments.length?(p=e,A):p},A.iterations=function(e){return arguments.length?(g=+e,A):g},A.strength=function(e){return arguments.length?(f="function"==typeof e?e:(0,r.Z)(+e),y(),A):f},A.distance=function(e){return arguments.length?(m="function"==typeof e?e:(0,r.Z)(+e),x(),A):m},A}},876:function(e,i,n){"use strict";function r(e,i,n){if(isNaN(i))return e;var r,s,a,o,l,h,u=e._root,c={data:n},d=e._x0,p=e._x1;if(!u)return e._root=c,e;for(;u.length;)if((o=i>=(s=(d+p)/2))?d=s:p=s,r=u,!(u=u[l=+o]))return r[l]=c,e;if(i===(a=+e._x.call(null,u.data)))return c.next=u,r?r[l]=c:e._root=c,e;do r=r?r[l]=[,,]:e._root=[,,],(o=i>=(s=(d+p)/2))?d=s:p=s;while((l=+o)==(h=+(a>=s)));return r[h]=u,r[l]=c,e}function s(e,i,n){this.node=e,this.x0=i,this.x1=n}function a(e){return e[0]}function o(e,i){var n=new l(null==i?a:i,NaN,NaN);return null==e?n:n.addAll(e)}function l(e,i,n){this._x=e,this._x0=i,this._x1=n,this._root=void 0}function h(e){for(var i={data:e.data},n=i;e=e.next;)n=n.next={data:e.data};return i}n.d(i,{Z:()=>L});var u=o.prototype=l.prototype;function c(e,i,n,r){if(isNaN(i)||isNaN(n))return e;var s,a,o,l,h,u,c,d,p,f=e._root,m={data:r},g=e._x0,A=e._y0,v=e._x1,y=e._y1;if(!f)return e._root=m,e;for(;f.length;)if((u=i>=(a=(g+v)/2))?g=a:v=a,(c=n>=(o=(A+y)/2))?A=o:y=o,s=f,!(f=f[d=c<<1|u]))return s[d]=m,e;if(l=+e._x.call(null,f.data),h=+e._y.call(null,f.data),i===l&&n===h)return m.next=f,s?s[d]=m:e._root=m,e;do s=s?s[d]=[,,,,]:e._root=[,,,,],(u=i>=(a=(g+v)/2))?g=a:v=a,(c=n>=(o=(A+y)/2))?A=o:y=o;while((d=c<<1|u)==(p=(h>=o)<<1|l>=a));return s[p]=f,s[d]=m,e}function d(e,i,n,r,s){this.node=e,this.x0=i,this.y0=n,this.x1=r,this.y1=s}function p(e){return e[0]}function f(e){return e[1]}function m(e,i,n){var r=new g(null==i?p:i,null==n?f:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function g(e,i,n,r,s,a){this._x=e,this._y=i,this._x0=n,this._y0=r,this._x1=s,this._y1=a,this._root=void 0}function A(e){for(var i={data:e.data},n=i;e=e.next;)n=n.next={data:e.data};return i}u.copy=function(){var e,i,n=new l(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=h(r),n;for(e=[{source:r,target:n._root=[,,]}];r=e.pop();)for(var s=0;s<2;++s)(i=r.source[s])&&(i.length?e.push({source:i,target:r.target[s]=[,,]}):r.target[s]=h(i));return n},u.add=function(e){let i=+this._x.call(null,e);return r(this.cover(i),i,e)},u.addAll=function(e){Array.isArray(e)||(e=Array.from(e));let i=e.length,n=new Float64Array(i),s=1/0,a=-1/0;for(let r=0,o;r<i;++r)!isNaN(o=+this._x.call(null,e[r]))&&(n[r]=o,o<s&&(s=o),o>a&&(a=o));if(s>a)return this;this.cover(s).cover(a);for(let s=0;s<i;++s)r(this,n[s],e[s]);return this},u.cover=function(e){if(isNaN(e*=1))return this;var i=this._x0,n=this._x1;if(isNaN(i))n=(i=Math.floor(e))+1;else{for(var r,s,a=n-i||1,o=this._root;i>e||e>=n;)switch(s=+(e<i),(r=[,,])[s]=o,o=r,a*=2,s){case 0:n=i+a;break;case 1:i=n-a}this._root&&this._root.length&&(this._root=o)}return this._x0=i,this._x1=n,this},u.data=function(){var e=[];return this.visit(function(i){if(!i.length)do e.push(i.data);while(i=i.next)}),e},u.extent=function(e){return arguments.length?this.cover(+e[0][0]).cover(+e[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},u.find=function(e,i){var n,r,a,o,l,h=this._x0,u=this._x1,c=[],d=this._root;for(d&&c.push(new s(d,h,u)),null==i?i=1/0:(h=e-i,u=e+i);o=c.pop();)if((d=o.node)&&!((r=o.x0)>u)&&!((a=o.x1)<h)){if(d.length){var p=(r+a)/2;c.push(new s(d[1],p,a),new s(d[0],r,p)),(l=+(e>=p))&&(o=c[c.length-1],c[c.length-1]=c[c.length-1-l],c[c.length-1-l]=o)}else{var f=Math.abs(e-+this._x.call(null,d.data));f<i&&(i=f,h=e-f,u=e+f,n=d.data)}}return n},u.remove=function(e){if(isNaN(a=+this._x.call(null,e)))return this;var i,n,r,s,a,o,l,h,u,c=this._root,d=this._x0,p=this._x1;if(!c)return this;if(c.length)for(;;){if((l=a>=(o=(d+p)/2))?d=o:p=o,i=c,!(c=c[h=+l]))return this;if(!c.length)break;i[h+1&1]&&(n=i,u=h)}for(;c.data!==e;)if(r=c,!(c=c.next))return this;return((s=c.next)&&delete c.next,r)?s?r.next=s:delete r.next:i?(s?i[h]=s:delete i[h],(c=i[0]||i[1])&&c===(i[1]||i[0])&&!c.length&&(n?n[u]=c:this._root=c)):this._root=s,this},u.removeAll=function(e){for(var i=0,n=e.length;i<n;++i)this.remove(e[i]);return this},u.root=function(){return this._root},u.size=function(){var e=0;return this.visit(function(i){if(!i.length)do++e;while(i=i.next)}),e},u.visit=function(e){var i,n,r,a,o=[],l=this._root;for(l&&o.push(new s(l,this._x0,this._x1));i=o.pop();)if(!e(l=i.node,r=i.x0,a=i.x1)&&l.length){var h=(r+a)/2;(n=l[1])&&o.push(new s(n,h,a)),(n=l[0])&&o.push(new s(n,r,h))}return this},u.visitAfter=function(e){var i,n=[],r=[];for(this._root&&n.push(new s(this._root,this._x0,this._x1));i=n.pop();){var a=i.node;if(a.length){var o,l=i.x0,h=i.x1,u=(l+h)/2;(o=a[0])&&n.push(new s(o,l,u)),(o=a[1])&&n.push(new s(o,u,h))}r.push(i)}for(;i=r.pop();)e(i.node,i.x0,i.x1);return this},u.x=function(e){return arguments.length?(this._x=e,this):this._x};var v=m.prototype=g.prototype;function y(e,i,n,r,s){if(isNaN(i)||isNaN(n)||isNaN(r))return e;var a,o,l,h,u,c,d,p,f,m,g,A,v=e._root,y={data:s},x=e._x0,_=e._y0,b=e._z0,E=e._x1,w=e._y1,M=e._z1;if(!v)return e._root=y,e;for(;v.length;)if((p=i>=(o=(x+E)/2))?x=o:E=o,(f=n>=(l=(_+w)/2))?_=l:w=l,(m=r>=(h=(b+M)/2))?b=h:M=h,a=v,!(v=v[g=m<<2|f<<1|p]))return a[g]=y,e;if(u=+e._x.call(null,v.data),c=+e._y.call(null,v.data),d=+e._z.call(null,v.data),i===u&&n===c&&r===d)return y.next=v,a?a[g]=y:e._root=y,e;do a=a?a[g]=Array(8):e._root=Array(8),(p=i>=(o=(x+E)/2))?x=o:E=o,(f=n>=(l=(_+w)/2))?_=l:w=l,(m=r>=(h=(b+M)/2))?b=h:M=h;while((g=m<<2|f<<1|p)==(A=(d>=h)<<2|(c>=l)<<1|u>=o));return a[A]=v,a[g]=y,e}function x(e,i,n,r,s,a,o){this.node=e,this.x0=i,this.y0=n,this.z0=r,this.x1=s,this.y1=a,this.z1=o}v.copy=function(){var e,i,n=new g(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=A(r),n;for(e=[{source:r,target:n._root=[,,,,]}];r=e.pop();)for(var s=0;s<4;++s)(i=r.source[s])&&(i.length?e.push({source:i,target:r.target[s]=[,,,,]}):r.target[s]=A(i));return n},v.add=function(e){let i=+this._x.call(null,e),n=+this._y.call(null,e);return c(this.cover(i,n),i,n,e)},v.addAll=function(e){var i,n,r,s,a=e.length,o=Array(a),l=Array(a),h=1/0,u=1/0,d=-1/0,p=-1/0;for(n=0;n<a;++n)!(isNaN(r=+this._x.call(null,i=e[n]))||isNaN(s=+this._y.call(null,i)))&&(o[n]=r,l[n]=s,r<h&&(h=r),r>d&&(d=r),s<u&&(u=s),s>p&&(p=s));if(h>d||u>p)return this;for(this.cover(h,u).cover(d,p),n=0;n<a;++n)c(this,o[n],l[n],e[n]);return this},v.cover=function(e,i){if(isNaN(e*=1)||isNaN(i*=1))return this;var n=this._x0,r=this._y0,s=this._x1,a=this._y1;if(isNaN(n))s=(n=Math.floor(e))+1,a=(r=Math.floor(i))+1;else{for(var o,l,h=s-n||1,u=this._root;n>e||e>=s||r>i||i>=a;)switch(l=(i<r)<<1|e<n,(o=[,,,,])[l]=u,u=o,h*=2,l){case 0:s=n+h,a=r+h;break;case 1:n=s-h,a=r+h;break;case 2:s=n+h,r=a-h;break;case 3:n=s-h,r=a-h}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=s,this._y1=a,this},v.data=function(){var e=[];return this.visit(function(i){if(!i.length)do e.push(i.data);while(i=i.next)}),e},v.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},v.find=function(e,i,n){var r,s,a,o,l,h,u,c=this._x0,p=this._y0,f=this._x1,m=this._y1,g=[],A=this._root;for(A&&g.push(new d(A,c,p,f,m)),null==n?n=1/0:(c=e-n,p=i-n,f=e+n,m=i+n,n*=n);h=g.pop();)if((A=h.node)&&!((s=h.x0)>f)&&!((a=h.y0)>m)&&!((o=h.x1)<c)&&!((l=h.y1)<p)){if(A.length){var v=(s+o)/2,y=(a+l)/2;g.push(new d(A[3],v,y,o,l),new d(A[2],s,y,v,l),new d(A[1],v,a,o,y),new d(A[0],s,a,v,y)),(u=(i>=y)<<1|e>=v)&&(h=g[g.length-1],g[g.length-1]=g[g.length-1-u],g[g.length-1-u]=h)}else{var x=e-+this._x.call(null,A.data),_=i-+this._y.call(null,A.data),b=x*x+_*_;if(b<n){var E=Math.sqrt(n=b);c=e-E,p=i-E,f=e+E,m=i+E,r=A.data}}}return r},v.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var i,n,r,s,a,o,l,h,u,c,d,p,f=this._root,m=this._x0,g=this._y0,A=this._x1,v=this._y1;if(!f)return this;if(f.length)for(;;){if((u=a>=(l=(m+A)/2))?m=l:A=l,(c=o>=(h=(g+v)/2))?g=h:v=h,i=f,!(f=f[d=c<<1|u]))return this;if(!f.length)break;(i[d+1&3]||i[d+2&3]||i[d+3&3])&&(n=i,p=d)}for(;f.data!==e;)if(r=f,!(f=f.next))return this;return((s=f.next)&&delete f.next,r)?s?r.next=s:delete r.next:i?(s?i[d]=s:delete i[d],(f=i[0]||i[1]||i[2]||i[3])&&f===(i[3]||i[2]||i[1]||i[0])&&!f.length&&(n?n[p]=f:this._root=f)):this._root=s,this},v.removeAll=function(e){for(var i=0,n=e.length;i<n;++i)this.remove(e[i]);return this},v.root=function(){return this._root},v.size=function(){var e=0;return this.visit(function(i){if(!i.length)do++e;while(i=i.next)}),e},v.visit=function(e){var i,n,r,s,a,o,l=[],h=this._root;for(h&&l.push(new d(h,this._x0,this._y0,this._x1,this._y1));i=l.pop();)if(!e(h=i.node,r=i.x0,s=i.y0,a=i.x1,o=i.y1)&&h.length){var u=(r+a)/2,c=(s+o)/2;(n=h[3])&&l.push(new d(n,u,c,a,o)),(n=h[2])&&l.push(new d(n,r,c,u,o)),(n=h[1])&&l.push(new d(n,u,s,a,c)),(n=h[0])&&l.push(new d(n,r,s,u,c))}return this},v.visitAfter=function(e){var i,n=[],r=[];for(this._root&&n.push(new d(this._root,this._x0,this._y0,this._x1,this._y1));i=n.pop();){var s=i.node;if(s.length){var a,o=i.x0,l=i.y0,h=i.x1,u=i.y1,c=(o+h)/2,p=(l+u)/2;(a=s[0])&&n.push(new d(a,o,l,c,p)),(a=s[1])&&n.push(new d(a,c,l,h,p)),(a=s[2])&&n.push(new d(a,o,p,c,u)),(a=s[3])&&n.push(new d(a,c,p,h,u))}r.push(i)}for(;i=r.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this},v.x=function(e){return arguments.length?(this._x=e,this):this._x},v.y=function(e){return arguments.length?(this._y=e,this):this._y};let _=(e,i,n,r,s,a)=>Math.sqrt((e-r)**2+(i-s)**2+(n-a)**2);function b(e){return e[0]}function E(e){return e[1]}function w(e){return e[2]}function M(e,i,n,r){var s=new C(null==i?b:i,null==n?E:n,null==r?w:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==e?s:s.addAll(e)}function C(e,i,n,r,s,a,o,l,h){this._x=e,this._y=i,this._z=n,this._x0=r,this._y0=s,this._z0=a,this._x1=o,this._y1=l,this._z1=h,this._root=void 0}function S(e){for(var i={data:e.data},n=i;e=e.next;)n=n.next={data:e.data};return i}var T=M.prototype=C.prototype;T.copy=function(){var e,i,n=new C(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=S(r),n;for(e=[{source:r,target:n._root=Array(8)}];r=e.pop();)for(var s=0;s<8;++s)(i=r.source[s])&&(i.length?e.push({source:i,target:r.target[s]=Array(8)}):r.target[s]=S(i));return n},T.add=function(e){let i=+this._x.call(null,e),n=+this._y.call(null,e),r=+this._z.call(null,e);return y(this.cover(i,n,r),i,n,r,e)},T.addAll=function(e){Array.isArray(e)||(e=Array.from(e));let i=e.length,n=new Float64Array(i),r=new Float64Array(i),s=new Float64Array(i),a=1/0,o=1/0,l=1/0,h=-1/0,u=-1/0,c=-1/0;for(let d=0,p,f,m,g;d<i;++d)!(isNaN(f=+this._x.call(null,p=e[d]))||isNaN(m=+this._y.call(null,p))||isNaN(g=+this._z.call(null,p)))&&(n[d]=f,r[d]=m,s[d]=g,f<a&&(a=f),f>h&&(h=f),m<o&&(o=m),m>u&&(u=m),g<l&&(l=g),g>c&&(c=g));if(a>h||o>u||l>c)return this;this.cover(a,o,l).cover(h,u,c);for(let a=0;a<i;++a)y(this,n[a],r[a],s[a],e[a]);return this},T.cover=function(e,i,n){if(isNaN(e*=1)||isNaN(i*=1)||isNaN(n*=1))return this;var r=this._x0,s=this._y0,a=this._z0,o=this._x1,l=this._y1,h=this._z1;if(isNaN(r))o=(r=Math.floor(e))+1,l=(s=Math.floor(i))+1,h=(a=Math.floor(n))+1;else{for(var u,c,d=o-r||1,p=this._root;r>e||e>=o||s>i||i>=l||a>n||n>=h;)switch(c=(n<a)<<2|(i<s)<<1|e<r,(u=Array(8))[c]=p,p=u,d*=2,c){case 0:o=r+d,l=s+d,h=a+d;break;case 1:r=o-d,l=s+d,h=a+d;break;case 2:o=r+d,s=l-d,h=a+d;break;case 3:r=o-d,s=l-d,h=a+d;break;case 4:o=r+d,l=s+d,a=h-d;break;case 5:r=o-d,l=s+d,a=h-d;break;case 6:o=r+d,s=l-d,a=h-d;break;case 7:r=o-d,s=l-d,a=h-d}this._root&&this._root.length&&(this._root=p)}return this._x0=r,this._y0=s,this._z0=a,this._x1=o,this._y1=l,this._z1=h,this},T.data=function(){var e=[];return this.visit(function(i){if(!i.length)do e.push(i.data);while(i=i.next)}),e},T.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1],+e[0][2]).cover(+e[1][0],+e[1][1],+e[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},T.find=function(e,i,n,r){var s,a,o,l,h,u,c,d,p,f=this._x0,m=this._y0,g=this._z0,A=this._x1,v=this._y1,y=this._z1,_=[],b=this._root;for(b&&_.push(new x(b,f,m,g,A,v,y)),null==r?r=1/0:(f=e-r,m=i-r,g=n-r,A=e+r,v=i+r,y=n+r,r*=r);d=_.pop();)if((b=d.node)&&!((a=d.x0)>A)&&!((o=d.y0)>v)&&!((l=d.z0)>y)&&!((h=d.x1)<f)&&!((u=d.y1)<m)&&!((c=d.z1)<g)){if(b.length){var E=(a+h)/2,w=(o+u)/2,M=(l+c)/2;_.push(new x(b[7],E,w,M,h,u,c),new x(b[6],a,w,M,E,u,c),new x(b[5],E,o,M,h,w,c),new x(b[4],a,o,M,E,w,c),new x(b[3],E,w,l,h,u,M),new x(b[2],a,w,l,E,u,M),new x(b[1],E,o,l,h,w,M),new x(b[0],a,o,l,E,w,M)),(p=(n>=M)<<2|(i>=w)<<1|e>=E)&&(d=_[_.length-1],_[_.length-1]=_[_.length-1-p],_[_.length-1-p]=d)}else{var C=e-+this._x.call(null,b.data),S=i-+this._y.call(null,b.data),T=n-+this._z.call(null,b.data),R=C*C+S*S+T*T;if(R<r){var I=Math.sqrt(r=R);f=e-I,m=i-I,g=n-I,A=e+I,v=i+I,y=n+I,s=b.data}}}return s},T.findAllWithinRadius=function(e,i,n,r){let s=[],a=e-r,o=i-r,l=n-r,h=e+r,u=i+r,c=n+r;return this.visit((d,p,f,m,g,A,v)=>{if(!d.length)do{let a=d.data;_(e,i,n,this._x(a),this._y(a),this._z(a))<=r&&s.push(a)}while(d=d.next);return p>h||f>u||m>c||g<a||A<o||v<l}),s},T.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e))||isNaN(l=+this._z.call(null,e)))return this;var i,n,r,s,a,o,l,h,u,c,d,p,f,m,g,A=this._root,v=this._x0,y=this._y0,x=this._z0,_=this._x1,b=this._y1,E=this._z1;if(!A)return this;if(A.length)for(;;){if((d=a>=(h=(v+_)/2))?v=h:_=h,(p=o>=(u=(y+b)/2))?y=u:b=u,(f=l>=(c=(x+E)/2))?x=c:E=c,i=A,!(A=A[m=f<<2|p<<1|d]))return this;if(!A.length)break;(i[m+1&7]||i[m+2&7]||i[m+3&7]||i[m+4&7]||i[m+5&7]||i[m+6&7]||i[m+7&7])&&(n=i,g=m)}for(;A.data!==e;)if(r=A,!(A=A.next))return this;return((s=A.next)&&delete A.next,r)?s?r.next=s:delete r.next:i?(s?i[m]=s:delete i[m],(A=i[0]||i[1]||i[2]||i[3]||i[4]||i[5]||i[6]||i[7])&&A===(i[7]||i[6]||i[5]||i[4]||i[3]||i[2]||i[1]||i[0])&&!A.length&&(n?n[g]=A:this._root=A)):this._root=s,this},T.removeAll=function(e){for(var i=0,n=e.length;i<n;++i)this.remove(e[i]);return this},T.root=function(){return this._root},T.size=function(){var e=0;return this.visit(function(i){if(!i.length)do++e;while(i=i.next)}),e},T.visit=function(e){var i,n,r,s,a,o,l,h,u=[],c=this._root;for(c&&u.push(new x(c,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=u.pop();)if(!e(c=i.node,r=i.x0,s=i.y0,a=i.z0,o=i.x1,l=i.y1,h=i.z1)&&c.length){var d=(r+o)/2,p=(s+l)/2,f=(a+h)/2;(n=c[7])&&u.push(new x(n,d,p,f,o,l,h)),(n=c[6])&&u.push(new x(n,r,p,f,d,l,h)),(n=c[5])&&u.push(new x(n,d,s,f,o,p,h)),(n=c[4])&&u.push(new x(n,r,s,f,d,p,h)),(n=c[3])&&u.push(new x(n,d,p,a,o,l,f)),(n=c[2])&&u.push(new x(n,r,p,a,d,l,f)),(n=c[1])&&u.push(new x(n,d,s,a,o,p,f)),(n=c[0])&&u.push(new x(n,r,s,a,d,p,f))}return this},T.visitAfter=function(e){var i,n=[],r=[];for(this._root&&n.push(new x(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=n.pop();){var s=i.node;if(s.length){var a,o=i.x0,l=i.y0,h=i.z0,u=i.x1,c=i.y1,d=i.z1,p=(o+u)/2,f=(l+c)/2,m=(h+d)/2;(a=s[0])&&n.push(new x(a,o,l,h,p,f,m)),(a=s[1])&&n.push(new x(a,p,l,h,u,f,m)),(a=s[2])&&n.push(new x(a,o,f,h,p,c,m)),(a=s[3])&&n.push(new x(a,p,f,h,u,c,m)),(a=s[4])&&n.push(new x(a,o,l,m,p,f,d)),(a=s[5])&&n.push(new x(a,p,l,m,u,f,d)),(a=s[6])&&n.push(new x(a,o,f,m,p,c,d)),(a=s[7])&&n.push(new x(a,p,f,m,u,c,d))}r.push(i)}for(;i=r.pop();)e(i.node,i.x0,i.y0,i.z0,i.x1,i.y1,i.z1);return this},T.x=function(e){return arguments.length?(this._x=e,this):this._x},T.y=function(e){return arguments.length?(this._y=e,this):this._y},T.z=function(e){return arguments.length?(this._z=e,this):this._z};var R=n(36499),I=n(79306),B=n(46510);function L(){var e,i,n,r,s,a,l=(0,R.Z)(-30),h=1,u=1/0,c=.81;function d(r){var a,l=e.length,h=(1===i?o(e,B.x):2===i?m(e,B.x,B.y):3===i?M(e,B.x,B.y,B.z):null).visitAfter(f);for(s=r,a=0;a<l;++a)n=e[a],h.visit(g)}function p(){if(e){var i,n,r=e.length;for(i=0,a=Array(r);i<r;++i)a[(n=e[i]).index]=+l(n,i,e)}}function f(e){var n,r,s,o,l,h,u=0,c=0,d=e.length;if(d){for(s=o=l=h=0;h<d;++h)(n=e[h])&&(r=Math.abs(n.value))&&(u+=n.value,c+=r,s+=r*(n.x||0),o+=r*(n.y||0),l+=r*(n.z||0));u*=Math.sqrt(4/d),e.x=s/c,i>1&&(e.y=o/c),i>2&&(e.z=l/c)}else{(n=e).x=n.data.x,i>1&&(n.y=n.data.y),i>2&&(n.z=n.data.z);do u+=a[n.data.index];while(n=n.next)}e.value=u}function g(e,o,l,d,p){if(!e.value)return!0;var f=[l,d,p][i-1],m=e.x-n.x,g=i>1?e.y-n.y:0,A=i>2?e.z-n.z:0,v=f-o,y=m*m+g*g+A*A;if(v*v/c<y)return y<u&&(0===m&&(y+=(m=(0,I.Z)(r))*m),i>1&&0===g&&(y+=(g=(0,I.Z)(r))*g),i>2&&0===A&&(y+=(A=(0,I.Z)(r))*A),y<h&&(y=Math.sqrt(h*y)),n.vx+=m*e.value*s/y,i>1&&(n.vy+=g*e.value*s/y),i>2&&(n.vz+=A*e.value*s/y)),!0;if(!e.length&&!(y>=u)){(e.data!==n||e.next)&&(0===m&&(y+=(m=(0,I.Z)(r))*m),i>1&&0===g&&(y+=(g=(0,I.Z)(r))*g),i>2&&0===A&&(y+=(A=(0,I.Z)(r))*A),y<h&&(y=Math.sqrt(h*y)));do e.data!==n&&(v=a[e.data.index]*s/y,n.vx+=m*v,i>1&&(n.vy+=g*v),i>2&&(n.vz+=A*v));while(e=e.next)}}return d.initialize=function(n,...s){e=n,r=s.find(e=>"function"==typeof e)||Math.random,i=s.find(e=>[1,2,3].includes(e))||2,p()},d.strength=function(e){return arguments.length?(l="function"==typeof e?e:(0,R.Z)(+e),p(),d):l},d.distanceMin=function(e){return arguments.length?(h=e*e,d):Math.sqrt(h)},d.distanceMax=function(e){return arguments.length?(u=e*e,d):Math.sqrt(u)},d.theta=function(e){return arguments.length?(c=e*e,d):Math.sqrt(c)},d}},80633:function(e,i,n){"use strict";n.d(i,{Z:()=>s});var r=n(36499);function s(e,i,n,s){var a,o,l,h,u=(0,r.Z)(.1);function c(e){for(var r=0,u=a.length;r<u;++r){var c=a[r],d=c.x-i||1e-6,p=(c.y||0)-n||1e-6,f=(c.z||0)-s||1e-6,m=Math.sqrt(d*d+p*p+f*f),g=(h[r]-m)*l[r]*e/m;c.vx+=d*g,o>1&&(c.vy+=p*g),o>2&&(c.vz+=f*g)}}function d(){if(a){var i,n=a.length;for(i=0,l=Array(n),h=Array(n);i<n;++i)h[i]=+e(a[i],i,a),l[i]=isNaN(h[i])?0:+u(a[i],i,a)}}return"function"!=typeof e&&(e=(0,r.Z)(+e)),null==i&&(i=0),null==n&&(n=0),null==s&&(s=0),c.initialize=function(e,...i){a=e,o=i.find(e=>[1,2,3].includes(e))||2,d()},c.strength=function(e){return arguments.length?(u="function"==typeof e?e:(0,r.Z)(+e),d(),c):u},c.radius=function(i){return arguments.length?(e="function"==typeof i?i:(0,r.Z)(+i),d(),c):e},c.x=function(e){return arguments.length?(i=+e,c):i},c.y=function(e){return arguments.length?(n=+e,c):n},c.z=function(e){return arguments.length?(s=+e,c):s},c}},46510:function(e,i,n){"use strict";n.d(i,{z:()=>l,y:()=>o,x:()=>a,Z:()=>c});var r=n(64744),s=n(85969);function a(e){return e.x}function o(e){return e.y}function l(e){return e.z}var h=Math.PI*(3-Math.sqrt(5)),u=20*Math.PI/(9+Math.sqrt(221));function c(e,i){let n;var a,o=Math.min(3,Math.max(1,Math.round(i=i||2))),l=1,c=.001,d=1-Math.pow(.001,1/300),p=0,f=.6,m=new Map,g=(0,s.HT)(y),A=(0,r.Z)("tick","end"),v=(n=1,()=>(n=(1664525*n+0x3c6ef35f)%0x100000000)/0x100000000);function y(){x(),A.call("tick",a),l<c&&(g.stop(),A.call("end",a))}function x(i){var n,r,s=e.length;void 0===i&&(i=1);for(var h=0;h<i;++h)for(l+=(p-l)*d,m.forEach(function(e){e(l)}),n=0;n<s;++n)null==(r=e[n]).fx?r.x+=r.vx*=f:(r.x=r.fx,r.vx=0),o>1&&(null==r.fy?r.y+=r.vy*=f:(r.y=r.fy,r.vy=0)),o>2&&(null==r.fz?r.z+=r.vz*=f:(r.z=r.fz,r.vz=0));return a}function _(){for(var i,n=0,r=e.length;n<r;++n){if((i=e[n]).index=n,null!=i.fx&&(i.x=i.fx),null!=i.fy&&(i.y=i.fy),null!=i.fz&&(i.z=i.fz),isNaN(i.x)||o>1&&isNaN(i.y)||o>2&&isNaN(i.z)){var s=10*(o>2?Math.cbrt(.5+n):o>1?Math.sqrt(.5+n):n),a=n*h,l=n*u;1===o?i.x=s:2===o?(i.x=s*Math.cos(a),i.y=s*Math.sin(a)):(i.x=s*Math.sin(a)*Math.cos(l),i.y=s*Math.cos(a),i.z=s*Math.sin(a)*Math.sin(l))}(isNaN(i.vx)||o>1&&isNaN(i.vy)||o>2&&isNaN(i.vz))&&(i.vx=0,o>1&&(i.vy=0),o>2&&(i.vz=0))}}function b(i){return i.initialize&&i.initialize(e,v,o),i}return null==e&&(e=[]),_(),a={tick:x,restart:function(){return g.restart(y),a},stop:function(){return g.stop(),a},numDimensions:function(e){return arguments.length?(o=Math.min(3,Math.max(1,Math.round(e))),m.forEach(b),a):o},nodes:function(i){return arguments.length?(e=i,_(),m.forEach(b),a):e},alpha:function(e){return arguments.length?(l=+e,a):l},alphaMin:function(e){return arguments.length?(c=+e,a):c},alphaDecay:function(e){return arguments.length?(d=+e,a):+d},alphaTarget:function(e){return arguments.length?(p=+e,a):p},velocityDecay:function(e){return arguments.length?(f=1-e,a):1-f},randomSource:function(e){return arguments.length?(v=e,m.forEach(b),a):v},force:function(e,i){return arguments.length>1?(null==i?m.delete(e):m.set(e,b(i)),a):m.get(e)},find:function(){var i,n,r,s,a,l,h=Array.prototype.slice.call(arguments),u=h.shift()||0,c=(o>1?h.shift():null)||0,d=(o>2?h.shift():null)||0,p=h.shift()||1/0,f=0,m=e.length;for(p*=p,f=0;f<m;++f)i=u-(a=e[f]).x,(s=i*i+(n=c-(a.y||0))*n+(r=d-(a.z||0))*r)<p&&(l=a,p=s);return l},on:function(e,i){return arguments.length>1?(A.on(e,i),a):A.on(e)}}}},79865:function(e,i,n){"use strict";n.d(i,{Z:()=>r});let r=function(e){for(var i=e.length/6|0,n=Array(i),r=0;r<i;)n[r]="#"+e.slice(6*r,6*++r);return n}("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928")},83413:function(e,i,n){"use strict";n.d(i,{Z:()=>function e(){var i=new r,n=[],s=[],a=l;function h(e){let r=i.get(e);if(void 0===r){if(a!==l)return a;i.set(e,r=n.push(e)-1)}return s[r%s.length]}return h.domain=function(e){if(!arguments.length)return n.slice();for(let s of(n=[],i=new r,e))i.has(s)||i.set(s,n.push(s)-1);return h},h.range=function(e){return arguments.length?(s=Array.from(e),h):s.slice()},h.unknown=function(e){return arguments.length?(a=e,h):a},h.copy=function(){return e(n,s).unknown(a)},o.apply(h,arguments),h}});class r extends Map{constructor(e,i=a){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:i}}),null!=e)for(let[i,n]of e)this.set(i,n)}get(e){return super.get(s(this,e))}has(e){return super.has(s(this,e))}set(e,i){return super.set(function({_intern:e,_key:i},n){let r=i(n);return e.has(r)?e.get(r):(e.set(r,n),n)}(this,e),i)}delete(e){return super.delete(function({_intern:e,_key:i},n){let r=i(n);return e.has(r)&&(n=e.get(r),e.delete(r)),n}(this,e))}}function s({_intern:e,_key:i},n){let r=i(n);return e.has(r)?e.get(r):n}function a(e){return null!==e&&"object"==typeof e?e.valueOf():e}function o(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e)}return this}let l=Symbol("implicit")},57105:function(e,i,n){"use strict";n.d(i,{Z:()=>l});var r,s=n(80287);function a(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}var o=(Object.defineProperty(r=function e(i,n){var r=n.default,s=n.triggerUpdate,a=n.onChange;(function(e,i){if(!(e instanceof i))throw TypeError("Cannot call a class as a function")})(this,e),this.name=i,this.defaultVal=void 0===r?null:r,this.triggerUpdate=void 0===s||s,this.onChange=void 0===a?function(e,i){}:a},"prototype",{writable:!1}),r);function l(e){var i=e.stateInit,n=void 0===i?function(){return{}}:i,r=e.props,l=void 0===r?{}:r,h=e.methods,u=void 0===h?{}:h,c=e.aliases,d=void 0===c?{}:c,p=e.init,f=void 0===p?function(){}:p,m=e.update,g=void 0===m?function(){}:m,A=Object.keys(l).map(function(e){return new o(e,l[e])});return function e(){for(var i=arguments.length,r=Array(i),o=0;o<i;o++)r[o]=arguments[o];var l=!!(this instanceof e?this.constructor:void 0),h=l?r.shift():void 0,c=r[0],p=void 0===c?{}:c,m=Object.assign({},n instanceof Function?n(p):n,{initialised:!1}),v={};function y(e){return x(e,p),_(),y}var x=function(e,i){f.call(y,e,m,i),m.initialised=!0},_=(0,s.Z)(function(){m.initialised&&(g.call(y,m,v),v={})},1);return A.forEach(function(e){var i,n,r,s,a,o,l,h;y[e.name]=(n=(i=e).name,s=void 0!==(r=i.triggerUpdate)&&r,o=void 0===(a=i.onChange)?function(e,i){}:a,h=void 0===(l=i.defaultVal)?null:l,function(e){var i=m[n];if(!arguments.length)return i;var r=void 0===e?h:e;return m[n]=r,o.call(y,r,m,i),v.hasOwnProperty(n)||(v[n]=i),s&&_(),y})}),Object.keys(u).forEach(function(e){y[e]=function(){for(var i,n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=u[e]).call.apply(i,[y,m].concat(r))}}),Object.entries(d).forEach(function(e){var i=function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{a=(n=n.call(e)).next;for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,2)||function(e,i){if(e){if("string"==typeof e)return a(e,2);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,i):void 0}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=i[0],r=i[1];return y[n]=y[r]}),y.resetProps=function(){return A.forEach(function(e){y[e.name](e.defaultVal)}),y},y.resetProps(),m._rerender=_,l&&h&&y(h),y}}},80287:function(e,i,n){"use strict";n.d(i,{Z:()=>I});var r=n(58641),s="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,o=s||a||Function("return this")();let l=function(){return o.Date.now()};var h=/\s/;let u=function(e){for(var i=e.length;i--&&h.test(e.charAt(i)););return i};var c=/^\s+/,d=o.Symbol,p=Object.prototype,f=p.hasOwnProperty,m=p.toString,g=d?d.toStringTag:void 0;let A=function(e){var i=f.call(e,g),n=e[g];try{e[g]=void 0;var r=!0}catch(e){}var s=m.call(e);return r&&(i?e[g]=n:delete e[g]),s};var v=Object.prototype.toString,y=d?d.toStringTag:void 0;let x=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":y&&y in Object(e)?A(e):v.call(e)},_=function(e){return"symbol"==typeof e||null!=e&&"object"==typeof e&&"[object Symbol]"==x(e)};var b=0/0,E=/^[-+]0x[0-9a-f]+$/i,w=/^0b[01]+$/i,M=/^0o[0-7]+$/i,C=parseInt;let S=function(e){if("number"==typeof e)return e;if(_(e))return b;if((0,r.Z)(e)){var i,n="function"==typeof e.valueOf?e.valueOf():e;e=(0,r.Z)(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=(i=e)?i.slice(0,u(i)+1).replace(c,""):i;var s=w.test(e);return s||M.test(e)?C(e.slice(2),s?2:8):E.test(e)?b:+e};var T=Math.max,R=Math.min;let I=function(e,i,n){var s,a,o,h,u,c,d=0,p=!1,f=!1,m=!0;if("function"!=typeof e)throw TypeError("Expected a function");function g(i){var n=s,r=a;return s=a=void 0,d=i,h=e.apply(r,n)}function A(e){var n=e-c,r=e-d;return void 0===c||n>=i||n<0||f&&r>=o}function v(){var e,n,r,s=l();if(A(s))return y(s);u=setTimeout(v,(e=s-c,n=s-d,r=i-e,f?R(r,o-n):r))}function y(e){return(u=void 0,m&&s)?g(e):(s=a=void 0,h)}function x(){var e,n=l(),r=A(n);if(s=arguments,a=this,c=n,r){if(void 0===u)return d=e=c,u=setTimeout(v,i),p?g(e):h;if(f)return clearTimeout(u),u=setTimeout(v,i),g(c)}return void 0===u&&(u=setTimeout(v,i)),h}return i=S(i)||0,(0,r.Z)(n)&&(p=!!n.leading,o=(f="maxWait"in n)?T(S(n.maxWait)||0,i):o,m="trailing"in n?!!n.trailing:m),x.cancel=function(){void 0!==u&&clearTimeout(u),d=0,s=c=a=u=void 0},x.flush=function(){return void 0===u?h:y(l())},x}},58641:function(e,i,n){"use strict";n.d(i,{Z:()=>r});let r=function(e){var i=typeof e;return null!=e&&("object"==i||"function"==i)}},47112:function(e,i,n){"use strict";let r,s,a,o,l;n.r(i),n.d(i,{ForceGraph2D:()=>yo,ForceGraphAR:()=>ys,ForceGraphVR:()=>yr,ForceGraph3D:()=>ya});var h,u,c=n(67294);function d(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{if(a=(n=n.call(e)).next,0===i){if(Object(n)!==n)return;h=!1}else for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,i)||p(e,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,i){if(e){if("string"==typeof e)return f(e,i);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,i)}}function f(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}var m=function(e,i){var n,r=new Set(i);return Object.assign.apply(Object,[{}].concat(function(e){if(Array.isArray(e))return f(e)}(n=Object.entries(e).filter(function(e){var i=d(e,1)[0];return!r.has(i)}).map(function(e){var i,n,r,s=d(e,2),a=s[0],o=s[1];return n={},(r="symbol"==typeof(i=function(e,i){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(r=a,"string"))?i:String(i))in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||p(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))};function g(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function A(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,i){if(e){if("string"==typeof e)return g(e,i);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,i):void 0}}function y(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.wrapperElementType,r=void 0===n?"div":n,s=i.nodeMapper,a=void 0===s?function(e){return e}:s,o=i.methodNames,l=void 0===o?[]:o,h=i.initPropNames,u=void 0===h?[]:h;return(0,c.forwardRef)(function(i,n){var s=(0,c.useRef)(),o=(0,c.useMemo)(function(){return e(Object.fromEntries(u.filter(function(e){return i.hasOwnProperty(e)}).map(function(e){return[e,i[e]]})))},[]);x(function(){o(a(s.current))},c.useLayoutEffect),x(function(){return o._destructor instanceof Function?o._destructor:void 0});var h=(0,c.useCallback)(function(e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return o[e]instanceof Function?o[e].apply(o,n):void 0},[o]),d=(0,c.useRef)({});return Object.keys(m(i,[].concat(A(l),A(u)))).filter(function(e){return d.current[e]!==i[e]}).forEach(function(e){return h(e,i[e])}),d.current=i,(0,c.useImperativeHandle)(n,function(){return Object.fromEntries(l.map(function(e){return[e,function(){for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return h.apply(void 0,[e].concat(n))}]}))},[h]),c.createElement(r,{ref:s})})}function x(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.useEffect,r=(0,c.useRef)(),s=(0,c.useRef)(!1),a=(0,c.useRef)(!1),o=function(e){if(Array.isArray(e))return e}(i=(0,c.useState)(0))||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{a=(n=n.call(e)).next;for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(i,2)||v(i,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();o[0];var l=o[1];s.current&&(a.current=!0),n(function(){return s.current||(r.current=e(),s.current=!0),l(function(e){return e+1}),function(){a.current&&r.current&&r.current()}},[])}n(75569),n(60401),n(31359);var _=n(57105),b=n(37964),E=n(16019),w=n(64222),M=n(20727);function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var S=n(86143);function T(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(T=function(){return!!e})()}function R(e){var i="function"==typeof Map?new Map:void 0;return(R=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(i){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,n)}function n(){return function(e,i,n){if(T())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,i);var s=new(e.bind.apply(e,r));return n&&(0,S.Z)(s,n.prototype),s}(e,arguments,C(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),(0,S.Z)(n,e)})(e)}var I=function(e){function i(i){var n;return n=e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+i+" for more information.")||this,(0,w.Z)(n)}return(0,M.Z)(i,e),i}(R(Error));function B(e,i){return e.substr(-i.length)===i}var L=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function P(e){return"string"!=typeof e?e:e.match(L)?parseFloat(e):e}var D=function(e){return function(i,n){void 0===n&&(n="16px");var r=i,s=n;if("string"==typeof i){if(!B(i,"px"))throw new I(69,e,i);r=P(i)}if("string"==typeof n){if(!B(n,"px"))throw new I(70,e,n);s=P(n)}if("string"==typeof r)throw new I(71,i,e);if("string"==typeof s)throw new I(72,n,e);return""+r/s+e}};function N(e){return Math.round(255*e)}function O(e,i,n){return N(e)+","+N(i)+","+N(n)}function U(e,i,n,r){if(void 0===r&&(r=O),0===i)return r(n,n,n);var s=(e%360+360)%360/60,a=(1-Math.abs(2*n-1))*i,o=a*(1-Math.abs(s%2-1)),l=0,h=0,u=0;s>=0&&s<1?(l=a,h=o):s>=1&&s<2?(l=o,h=a):s>=2&&s<3?(h=a,u=o):s>=3&&s<4?(h=o,u=a):s>=4&&s<5?(l=o,u=a):s>=5&&s<6&&(l=a,u=o);var c=n-a/2;return r(l+c,h+c,u+c)}D("em"),D("rem");var k={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},F=/^#[a-fA-F0-9]{6}$/,z=/^#[a-fA-F0-9]{8}$/,G=/^#[a-fA-F0-9]{3}$/,V=/^#[a-fA-F0-9]{4}$/,j=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,H=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Q=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,W=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function q(e){if("string"!=typeof e)throw new I(3);var i=function(e){if("string"!=typeof e)return e;var i=e.toLowerCase();return k[i]?"#"+k[i]:e}(e);if(i.match(F))return{red:parseInt(""+i[1]+i[2],16),green:parseInt(""+i[3]+i[4],16),blue:parseInt(""+i[5]+i[6],16)};if(i.match(z)){var n=parseFloat((parseInt(""+i[7]+i[8],16)/255).toFixed(2));return{red:parseInt(""+i[1]+i[2],16),green:parseInt(""+i[3]+i[4],16),blue:parseInt(""+i[5]+i[6],16),alpha:n}}if(i.match(G))return{red:parseInt(""+i[1]+i[1],16),green:parseInt(""+i[2]+i[2],16),blue:parseInt(""+i[3]+i[3],16)};if(i.match(V)){var r=parseFloat((parseInt(""+i[4]+i[4],16)/255).toFixed(2));return{red:parseInt(""+i[1]+i[1],16),green:parseInt(""+i[2]+i[2],16),blue:parseInt(""+i[3]+i[3],16),alpha:r}}var s=j.exec(i);if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10)};var a=H.exec(i.substring(0,50));if(a)return{red:parseInt(""+a[1],10),green:parseInt(""+a[2],10),blue:parseInt(""+a[3],10),alpha:parseFloat(""+a[4])>1?parseFloat(""+a[4])/100:parseFloat(""+a[4])};var o=Q.exec(i);if(o){var l="rgb("+U(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",h=j.exec(l);if(!h)throw new I(4,i,l);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10)}}var u=W.exec(i.substring(0,50));if(u){var c="rgb("+U(parseInt(""+u[1],10),parseInt(""+u[2],10)/100,parseInt(""+u[3],10)/100)+")",d=j.exec(c);if(!d)throw new I(4,i,c);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10),alpha:parseFloat(""+u[4])>1?parseFloat(""+u[4])/100:parseFloat(""+u[4])}}throw new I(5)}function X(e){return function(e){var i,n=e.red/255,r=e.green/255,s=e.blue/255,a=Math.max(n,r,s),o=Math.min(n,r,s),l=(a+o)/2;if(a===o)return void 0!==e.alpha?{hue:0,saturation:0,lightness:l,alpha:e.alpha}:{hue:0,saturation:0,lightness:l};var h=a-o,u=l>.5?h/(2-a-o):h/(a+o);switch(a){case n:i=(r-s)/h+6*(r<s);break;case r:i=(s-n)/h+2;break;default:i=(n-r)/h+4}return(i*=60,void 0!==e.alpha)?{hue:i,saturation:u,lightness:l,alpha:e.alpha}:{hue:i,saturation:u,lightness:l}}(q(e))}var K=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function Y(e){var i=e.toString(16);return 1===i.length?"0"+i:i}function J(e){return Y(Math.round(255*e))}function Z(e,i,n){return K("#"+J(e)+J(i)+J(n))}function $(e,i,n){if("number"==typeof e&&"number"==typeof i&&"number"==typeof n)return K("#"+Y(e)+Y(i)+Y(n));if("object"==typeof e&&void 0===i&&void 0===n)return K("#"+Y(e.red)+Y(e.green)+Y(e.blue));throw new I(6)}function ee(e,i,n,r){if("string"==typeof e&&"number"==typeof i){var s=q(e);return"rgba("+s.red+","+s.green+","+s.blue+","+i+")"}if("number"==typeof e&&"number"==typeof i&&"number"==typeof n&&"number"==typeof r)return r>=1?$(e,i,n):"rgba("+e+","+i+","+n+","+r+")";if("object"==typeof e&&void 0===i&&void 0===n&&void 0===r)return e.alpha>=1?$(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new I(7)}function et(e){if("object"!=typeof e)throw new I(8);if("number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&"number"==typeof e.alpha)return ee(e);if("number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&("number"!=typeof e.alpha||void 0===e.alpha))return $(e);if("number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&"number"==typeof e.alpha)return function(e,i,n,r){if("object"==typeof e){var s;return e.alpha>=1?(s=e.hue,U(s,e.saturation,e.lightness,Z)):"rgba("+U(e.hue,e.saturation,e.lightness)+","+e.alpha+")"}throw new I(2)}(e);if("number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&("number"!=typeof e.alpha||void 0===e.alpha))return function(e,i,n){if("object"==typeof e){var r;return r=e.hue,U(r,e.saturation,e.lightness,Z)}throw new I(1)}(e);throw new I(8)}function ei(e){return function e(i,n,r){return function(){var s=r.concat(Array.prototype.slice.call(arguments));return s.length>=n?i.apply(this,s):e(i,n,s)}}(e,e.length,[])}function en(e,i,n){return Math.max(e,Math.min(i,n))}ei(function(e,i){if("transparent"===i)return i;var n=X(i);return et((0,E.Z)({},n,{hue:n.hue+parseFloat(e)}))}),ei(function(e,i){if("transparent"===i)return i;var n=X(i);return et((0,E.Z)({},n,{lightness:en(0,1,n.lightness-parseFloat(e))}))}),ei(function(e,i){if("transparent"===i)return i;var n=X(i);return et((0,E.Z)({},n,{saturation:en(0,1,n.saturation-parseFloat(e))}))}),ei(function(e,i){if("transparent"===i)return i;var n=X(i);return et((0,E.Z)({},n,{lightness:en(0,1,n.lightness+parseFloat(e))}))});var er=ei(function(e,i,n){if("transparent"===i)return n;if("transparent"===n)return i;if(0===e)return n;var r=q(i),s=(0,E.Z)({},r,{alpha:"number"==typeof r.alpha?r.alpha:1}),a=q(n),o=(0,E.Z)({},a,{alpha:"number"==typeof a.alpha?a.alpha:1}),l=s.alpha-o.alpha,h=2*parseFloat(e)-1,u=((h*l==-1?h:h+l)/(1+h*l)+1)/2,c=1-u;return ee({red:Math.floor(s.red*u+o.red*c),green:Math.floor(s.green*u+o.green*c),blue:Math.floor(s.blue*u+o.blue*c),alpha:s.alpha*parseFloat(e)+o.alpha*(1-parseFloat(e))})}),es=ei(function(e,i){if("transparent"===i)return i;var n=q(i),r="number"==typeof n.alpha?n.alpha:1;return ee((0,E.Z)({},n,{alpha:en(0,1,(100*r+100*parseFloat(e))/100)}))});function ea(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function eo(e,i,n){var r;return(i="symbol"==typeof(r=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(i,"string"))?r:r+"")in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function el(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function eh(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?el(Object(n),!0).forEach(function(i){eo(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):el(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function eu(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{if(a=(n=n.call(e)).next,0===i);else for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,i)||ed(e,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ec(e){return function(e){if(Array.isArray(e))return ea(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ed(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ed(e,i){if(e){if("string"==typeof e)return ea(e,i);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ea(e,i):void 0}}ei(function(e,i){if("transparent"===i)return i;var n=X(i);return et((0,E.Z)({},n,{saturation:en(0,1,n.saturation+parseFloat(e))}))}),ei(function(e,i){return"transparent"===i?i:et((0,E.Z)({},X(i),{hue:parseFloat(e)}))}),ei(function(e,i){return"transparent"===i?i:et((0,E.Z)({},X(i),{lightness:parseFloat(e)}))}),ei(function(e,i){return"transparent"===i?i:et((0,E.Z)({},X(i),{saturation:parseFloat(e)}))}),ei(function(e,i){return"transparent"===i?i:er(parseFloat(e),"rgb(0, 0, 0)",i)}),ei(function(e,i){return"transparent"===i?i:er(parseFloat(e),"rgb(255, 255, 255)",i)}),ei(function(e,i){if("transparent"===i)return i;var n=q(i),r="number"==typeof n.alpha?n.alpha:1;return ee((0,E.Z)({},n,{alpha:en(0,1,+(100*r-100*parseFloat(e)).toFixed(2)/100)}))}),!function(e,i){void 0===i&&(i={});var n=i.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===n&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(".graph-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: Sans-serif;\n  z-index: 1000;\n}");var ep=(0,_.Z)({props:{width:{default:window.innerWidth,triggerUpdate:!1,onChange:function(e,i){i.container&&(i.container.style.width="".concat(e,"px"))}},height:{default:window.innerHeight,triggerUpdate:!1,onChange:function(e,i){i.container&&(i.container.style.height="".concat(e,"px"))}},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},backgroundColor:{default:"#002"},showNavInfo:{default:!0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeLabel:{default:"name"},nodeDesc:{default:"desc"},onNodeHover:{},onNodeClick:{},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkLabel:{default:"name"},linkDesc:{default:"desc"},onLinkHover:{},onLinkClick:{},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:eh(eh({},Object.assign.apply(Object,[{}].concat(ec(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map(function(e){return eo({},e,function(i){for(var n=i.forcegraph.components.forcegraph,r=arguments.length,s=Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];var o=n[e].apply(n,s);return o===n?this:o})}))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(e,i){e.innerHTML="",i.container=document.createElement("div"),e.appendChild(i.container),i.container.style.position="relative",i.container.style.width="".concat(i.width,"px"),i.container.style.height="".concat(i.height,"px"),i.container.appendChild(i.navInfo=document.createElement("div")),i.navInfo.className="graph-nav-info",i.navInfo.textContent="Mouse drag: look, gamepad/arrow/wasd keys: move";var n,r,s,a,o,l=document.createElement("a-scene");l.setAttribute("embedded",""),l.appendChild(i.sky=document.createElement("a-sky")),i.sky.setAttribute("radius",3e3),l.appendChild(n=document.createElement("a-entity")),n.setAttribute("position","0 0 300"),n.setAttribute("movement-controls","controls: gamepad, touch; fly: true; speed: 7"),n.appendChild(r=document.createElement("a-entity")),r.setAttribute("camera",""),r.setAttribute("position","0 0 0"),r.setAttribute("look-controls","pointerLockEnabled: false"),r.setAttribute("wasd-controls","fly: true; acceleration: 700"),r.appendChild(s=document.createElement("a-text")),s.setAttribute("position","0 -0.3 -1"),s.setAttribute("width",2),s.setAttribute("align","center"),s.setAttribute("color","lavender"),s.setAttribute("value",""),r.appendChild(a=document.createElement("a-text")),a.setAttribute("position","0 -0.4 -1"),a.setAttribute("width",1.3),a.setAttribute("align","center"),a.setAttribute("color","lavender"),a.setAttribute("value",""),i.raycasterEls=[],l.appendChild(o=document.createElement("a-entity")),o.setAttribute("cursor","rayOrigin: mouse; mouseCursorStylesEnabled: true"),o.setAttribute("raycaster","objects: [forcegraph]; interval: 100"),i.raycasterEls.push(o),["left","right"].forEach(function(e){var r;n.appendChild(r=document.createElement("a-entity")),r.setAttribute("laser-controls","hand: ".concat(e,"; model: false;")),r.setAttribute("raycaster","objects: [forcegraph]; interval: 100; lineColor: steelblue; lineOpacity: 0.85"),i.raycasterEls.push(r)}),l.appendChild(i.forcegraph=document.createElement("a-entity")),i.forcegraph.setAttribute("forcegraph",null),i.container.appendChild(l),i.forcegraph.setAttribute("forcegraph",Object.assign.apply(Object,ec(["node","link"].map(function(e){var n={node:"Node",link:"Link"}[e];return eo({},"on".concat(n,"Hover"),function(r,o){var l=r&&(0,b.default)(i["".concat(e,"Label")])(r)||"",h=r&&(0,b.default)(i["".concat(e,"Desc")])(r)||"";s.setAttribute("value",l),a.setAttribute("value",h),i["on".concat(n,"Hover")]&&i["on".concat(n,"Hover")](r,o)})}))))},update:function(e,i){if(i.hasOwnProperty("backgroundColor")){var n=q(e.backgroundColor).alpha;void 0===n&&(n=1),e.sky.setAttribute("color",es(1,e.backgroundColor)),e.sky.setAttribute("opacity",n)}i.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none");var r=["onNodeHover","onLinkHover","onNodeClick","onLinkClick"].some(function(i){return e[i]})||["nodeLabel","linkLabel"].some(function(i){return"name"!==e[i]})||["nodeDesc","linkDesc"].some(function(i){return"desc"!==e[i]});e.raycasterEls.forEach(function(e){return e.setAttribute("raycaster",r?"objects: [forcegraph]; interval: 100":"objects: __none__")});var s=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","onNodeClick","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","onLinkClick","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],a=Object.assign.apply(Object,[{}].concat(ec(Object.entries(e).filter(function(e){var n=eu(e,2),r=n[0],a=n[1];return i.hasOwnProperty(r)&&-1!==s.indexOf(r)&&null!=a}).map(function(e){var i=eu(e,2);return eo({},i[0],i[1])})),ec(Object.entries(e.graphData).map(function(e){var i=eu(e,2);return eo({},i[0],i[1])}))));e.forcegraph.setAttribute("forcegraph",a)}}),ef=n(45697);function em(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function eg(e,i,n){var r;return(i="symbol"==typeof(r=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(i,"string"))?r:r+"")in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function eA(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ev(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?eA(Object(n),!0).forEach(function(i){eg(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function ey(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{if(a=(n=n.call(e)).next,0===i);else for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,i)||e_(e,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ex(e){return function(e){if(Array.isArray(e))return em(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||e_(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e_(e,i){if(e){if("string"==typeof e)return em(e,i);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?em(e,i):void 0}}var eb=(0,_.Z)({props:{width:{},height:{},yOffset:{default:1.5},glScale:{default:200},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},onNodeHover:{},onNodeClick:{},onLinkHover:{},onLinkClick:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:ev(ev({},Object.assign.apply(Object,[{}].concat(ex(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map(function(e){return eg({},e,function(i){for(var n=i.forcegraph.components.forcegraph,r=arguments.length,s=Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];var o=n[e].apply(n,s);return o===n?this:o})}))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(e,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=r.markerAttrs;e.innerHTML="",i.container=document.createElement("div"),e.appendChild(i.container);var a=document.createElement("a-scene");a.setAttribute("embedded",""),a.setAttribute("vr-mode-ui","enabled: false"),a.setAttribute("arjs","debugUIEnabled: false;");var o=document.createElement("a-marker");Object.entries(void 0===s?{preset:"hiro"}:s).forEach(function(e){var i=ey(e,2),n=i[0],r=i[1];return o.setAttribute(n,r)}),a.appendChild(o),a.appendChild(n=document.createElement("a-entity")),n.setAttribute("cursor"),n.setAttribute("raycaster","objects: [forcegraph]"),i.forcegraph=document.createElement("a-entity"),i.forcegraph.setAttribute("forcegraph",null),o.appendChild(i.forcegraph);var l=document.createElement("a-entity");l.setAttribute("camera",""),a.appendChild(l),i.container.appendChild(a)},update:function(e,i){i.hasOwnProperty("width")&&e.width&&(e.container.style.width="".concat(e.width,"px")),i.hasOwnProperty("height")&&e.height&&(e.container.style.height="".concat(e.height,"px")),i.hasOwnProperty("glScale")&&e.forcegraph.setAttribute("scale",ex([,,,]).map(function(){return 1/e.glScale}).join(" ")),i.hasOwnProperty("yOffset")&&e.forcegraph.setAttribute("position","0 ".concat(e.yOffset," 0"));var n=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","onNodeHover","onNodeClick","onLinkHover","onLinkClick","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],r=Object.assign.apply(Object,[{}].concat(ex(Object.entries(e).filter(function(e){var r=ey(e,2),s=r[0],a=r[1];return i.hasOwnProperty(s)&&-1!==n.indexOf(s)&&null!=a}).map(function(e){var i=ey(e,2);return eg({},i[0],i[1])})),ex(Object.entries(e.graphData).map(function(e){var i=ey(e,2);return eg({},i[0],i[1])}))));e.forcegraph.setAttribute("forcegraph",r)}}),eE=n(67591);let ew=new eE.JOQ,eM=new eE.FM8,eC=new eE.Pa4,eS=new eE.FM8,eT=new eE.FM8,eR=new eE.Pa4,eI=new eE.Pa4,eB=new eE.yGw,eL=new eE.Pa4,eP=new eE.Pa4,eD=null,eN=null,eO=[],eU={NONE:-1,PAN:0,ROTATE:1};class ek extends eE.ZXd{constructor(e,i,n=null){super(i,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new eE.iMs,this.mouseButtons={LEFT:eE.RsA.PAN,MIDDLE:eE.RsA.PAN,RIGHT:eE.RsA.ROTATE},this.touches={ONE:eE.QmN.PAN},this._onPointerMove=eF.bind(this),this._onPointerDown=ez.bind(this),this._onPointerCancel=eG.bind(this),this._onContextMenu=eV.bind(this),null!==n&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){let i=this.domElement.getBoundingClientRect();eM.x=(e.clientX-i.left)/i.width*2-1,eM.y=-(e.clientY-i.top)/i.height*2+1}_updateState(e){let i;if("touch"===e.pointerType)i=this.touches.ONE;else switch(e.button){case 0:i=this.mouseButtons.LEFT;break;case 1:i=this.mouseButtons.MIDDLE;break;case 2:i=this.mouseButtons.RIGHT;break;default:i=null}switch(i){case eE.RsA.PAN:case eE.QmN.PAN:this.state=eU.PAN;break;case eE.RsA.ROTATE:case eE.QmN.ROTATE:this.state=eU.ROTATE;break;default:this.state=eU.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function eF(e){let i=this.object,n=this.domElement,r=this.raycaster;if(!1!==this.enabled){if(this._updatePointer(e),r.setFromCamera(eM,i),eD)this.state===eU.PAN?r.ray.intersectPlane(ew,eR)&&eD.position.copy(eR.sub(eC).applyMatrix4(eB)):this.state===eU.ROTATE&&(eS.subVectors(eM,eT).multiplyScalar(this.rotateSpeed),eD.rotateOnWorldAxis(eL,eS.x),eD.rotateOnWorldAxis(eP.normalize(),-eS.y)),this.dispatchEvent({type:"drag",object:eD}),eT.copy(eM);else if("mouse"===e.pointerType||"pen"===e.pointerType){if(eO.length=0,r.setFromCamera(eM,i),r.intersectObjects(this.objects,this.recursive,eO),eO.length>0){let e=eO[0].object;ew.setFromNormalAndCoplanarPoint(i.getWorldDirection(ew.normal),eI.setFromMatrixPosition(e.matrixWorld)),eN!==e&&null!==eN&&(this.dispatchEvent({type:"hoveroff",object:eN}),n.style.cursor="auto",eN=null),eN!==e&&(this.dispatchEvent({type:"hoveron",object:e}),n.style.cursor="pointer",eN=e)}else null!==eN&&(this.dispatchEvent({type:"hoveroff",object:eN}),n.style.cursor="auto",eN=null)}eT.copy(eM)}}function ez(e){let i=this.object,n=this.domElement,r=this.raycaster;!1!==this.enabled&&(this._updatePointer(e),this._updateState(e),eO.length=0,r.setFromCamera(eM,i),r.intersectObjects(this.objects,this.recursive,eO),eO.length>0&&(eD=!0===this.transformGroup?function e(i,n=null){return(i.isGroup&&(n=i),null===i.parent)?n:e(i.parent,n)}(eO[0].object):eO[0].object,ew.setFromNormalAndCoplanarPoint(i.getWorldDirection(ew.normal),eI.setFromMatrixPosition(eD.matrixWorld)),r.ray.intersectPlane(ew,eR)&&(this.state===eU.PAN?(eB.copy(eD.parent.matrixWorld).invert(),eC.copy(eR).sub(eI.setFromMatrixPosition(eD.matrixWorld))):this.state===eU.ROTATE&&(eL.set(0,1,0).applyQuaternion(i.quaternion).normalize(),eP.set(1,0,0).applyQuaternion(i.quaternion).normalize())),n.style.cursor="move",this.dispatchEvent({type:"dragstart",object:eD})),eT.copy(eM))}function eG(){!1!==this.enabled&&(eD&&(this.dispatchEvent({type:"dragend",object:eD}),eD=null),this.domElement.style.cursor=eN?"pointer":"auto",this.state=eU.NONE)}function eV(e){!1!==this.enabled&&e.preventDefault()}var ej=n(74435);function eH(){let e=null,i=!1,n=null,r=null;function s(i,a){n(i,a),r=e.requestAnimationFrame(s)}return{start:function(){!0!==i&&null!==n&&(r=e.requestAnimationFrame(s),i=!0)},stop:function(){e.cancelAnimationFrame(r),i=!1},setAnimationLoop:function(e){n=e},setContext:function(i){e=i}}}function eQ(e){let i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);let r=i.get(n);r&&(e.deleteBuffer(r.buffer),i.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){let e=i.get(n);(!e||e.version<n.version)&&i.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version});return}let s=i.get(n);if(void 0===s)i.set(n,function(i,n){let r;let s=i.array,a=i.usage,o=s.byteLength,l=e.createBuffer();if(e.bindBuffer(n,l),e.bufferData(n,s,a),i.onUploadCallback(),s instanceof Float32Array)r=e.FLOAT;else if(s instanceof Uint16Array)r=i.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(s instanceof Int16Array)r=e.SHORT;else if(s instanceof Uint32Array)r=e.UNSIGNED_INT;else if(s instanceof Int32Array)r=e.INT;else if(s instanceof Int8Array)r=e.BYTE;else if(s instanceof Uint8Array)r=e.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)r=e.UNSIGNED_BYTE;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);return{buffer:l,type:r,bytesPerElement:s.BYTES_PER_ELEMENT,version:i.version,size:o}}(n,r));else if(s.version<n.version){if(s.size!==n.array.byteLength)throw Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(i,n,r){let s=n.array,a=n.updateRanges;if(e.bindBuffer(r,i),0===a.length)e.bufferSubData(r,0,s);else{a.sort((e,i)=>e.start-i.start);let i=0;for(let e=1;e<a.length;e++){let n=a[i],r=a[e];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):a[++i]=r}a.length=i+1;for(let i=0,n=a.length;i<n;i++){let n=a[i];e.bufferSubData(r,n.start*s.BYTES_PER_ELEMENT,s,n.start,n.count)}n.clearUpdateRanges()}n.onUploadCallback()}(s.buffer,n,r),s.version=n.version}}}}let eW={alphahash_fragment:"#ifdef USE_ALPHAHASH\n	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n	const float ALPHA_HASH_SCALE = 0.05;\n	float hash2D( vec2 value ) {\n		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n	}\n	float hash3D( vec3 value ) {\n		return hash2D( vec2( hash2D( value.xy ), value.z ) );\n	}\n	float getAlphaHashThreshold( vec3 position ) {\n		float maxDeriv = max(\n			length( dFdx( position.xyz ) ),\n			length( dFdy( position.xyz ) )\n		);\n		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n		vec2 pixScales = vec2(\n			exp2( floor( log2( pixScale ) ) ),\n			exp2( ceil( log2( pixScale ) ) )\n		);\n		vec2 alpha = vec2(\n			hash3D( floor( pixScales.x * position.xyz ) ),\n			hash3D( floor( pixScales.y * position.xyz ) )\n		);\n		float lerpFactor = fract( log2( pixScale ) );\n		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n		float a = min( lerpFactor, 1.0 - lerpFactor );\n		vec3 cases = vec3(\n			x * x / ( 2.0 * a * ( 1.0 - a ) ),\n			( x - 0.5 * a ) / ( 1.0 - a ),\n			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n		);\n		float threshold = ( x < ( 1.0 - a ) )\n			? ( ( x < a ) ? cases.x : cases.y )\n			: cases.z;\n		return clamp( threshold , 1.0e-6, 1.0 );\n	}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n	#ifdef ALPHA_TO_COVERAGE\n	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n	if ( diffuseColor.a == 0.0 ) discard;\n	#else\n	if ( diffuseColor.a < alphaTest ) discard;\n	#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_CLEARCOAT ) \n		clearcoatSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_SHEEN ) \n		sheenSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n	#if ! defined( GL_ANGLE_multi_draw )\n	#define gl_DrawID _gl_DrawID\n	uniform int _gl_DrawID;\n	#endif\n	uniform highp sampler2D batchingTexture;\n	uniform highp usampler2D batchingIdTexture;\n	mat4 getBatchingMatrix( const in float i ) {\n		int size = textureSize( batchingTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n	float getIndirectIndex( const in int i ) {\n		int size = textureSize( batchingIdTexture, 0 ).x;\n		int x = i % size;\n		int y = i / size;\n		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n	}\n#endif\n#ifdef USE_BATCHING_COLOR\n	uniform sampler2D batchingColorTexture;\n	vec3 getBatchingColor( const in float i ) {\n		int size = textureSize( batchingColorTexture, 0 ).x;\n		int j = int( i );\n		int x = j % size;\n		int y = j / size;\n		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n	}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n	vPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n	const mat3 XYZ_TO_REC709 = mat3(\n		 3.2404542, -0.9692660,  0.0556434,\n		-1.5371385,  1.8760108, -0.2040259,\n		-0.4985314,  0.0415560,  1.0572252\n	);\n	vec3 Fresnel0ToIor( vec3 fresnel0 ) {\n		vec3 sqrtF0 = sqrt( fresnel0 );\n		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n	}\n	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n	}\n	float IorToFresnel0( float transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n	}\n	vec3 evalSensitivity( float OPD, vec3 shift ) {\n		float phase = 2.0 * PI * OPD * 1.0e-9;\n		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n		xyz /= 1.0685e-7;\n		vec3 rgb = XYZ_TO_REC709 * xyz;\n		return rgb;\n	}\n	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n		vec3 I;\n		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n		float cosTheta2Sq = 1.0 - sinTheta2Sq;\n		if ( cosTheta2Sq < 0.0 ) {\n			return vec3( 1.0 );\n		}\n		float cosTheta2 = sqrt( cosTheta2Sq );\n		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n		float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n		float T121 = 1.0 - R12;\n		float phi12 = 0.0;\n		if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n		float phi21 = PI - phi12;\n		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n		vec3 phi23 = vec3( 0.0 );\n		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n		vec3 phi = vec3( phi21 ) + phi23;\n		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n		vec3 r123 = sqrt( R123 );\n		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n		vec3 C0 = R12 + Rs;\n		I = C0;\n		vec3 Cm = Rs - T121;\n		for ( int m = 1; m <= 2; ++ m ) {\n			Cm *= r123;\n			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n			I += Cm * Sm;\n		}\n		return max( I, vec3( 0.0 ) );\n	}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vBumpMapUv );\n		vec2 dSTdy = dFdy( vBumpMapUv );\n		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#ifdef ALPHA_TO_COVERAGE\n		float distanceToPlane, distanceGradient;\n		float clipOpacity = 1.0;\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n			distanceGradient = fwidth( distanceToPlane ) / 2.0;\n			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			if ( clipOpacity == 0.0 ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			float unionClipOpacity = 1.0;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n				distanceGradient = fwidth( distanceToPlane ) / 2.0;\n				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			}\n			#pragma unroll_loop_end\n			clipOpacity *= 1.0 - unionClipOpacity;\n		#endif\n		diffuseColor.a *= clipOpacity;\n		if ( diffuseColor.a == 0.0 ) discard;\n	#else\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			bool clipped = true;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n			}\n			#pragma unroll_loop_end\n			if ( clipped ) discard;\n		#endif\n	#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n	varying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n	vColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n	varying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		uv.x += filterInt * 3.0 * cubeUV_minTileSize;\n		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n		uv.x *= CUBEUV_TEXEL_WIDTH;\n		uv.y *= CUBEUV_TEXEL_HEIGHT;\n		#ifdef texture2DGradEXT\n			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n		#else\n			return texture2D( envMap, uv ).rgb;\n		#endif\n	}\n	#define cubeUV_r0 1.0\n	#define cubeUV_m0 - 2.0\n	#define cubeUV_r1 0.8\n	#define cubeUV_m1 - 1.0\n	#define cubeUV_r4 0.4\n	#define cubeUV_m4 2.0\n	#define cubeUV_r5 0.305\n	#define cubeUV_m5 3.0\n	#define cubeUV_r6 0.21\n	#define cubeUV_m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= cubeUV_r1 ) {\n			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n		} else if ( roughness >= cubeUV_r4 ) {\n			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n		} else if ( roughness >= cubeUV_r5 ) {\n			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n		} else if ( roughness >= cubeUV_r6 ) {\n			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n	vec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n	mat3 bm = mat3( batchingMatrix );\n	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n	transformedNormal = bm * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = bm * transformedTangent;\n	#endif\n#endif\n#ifdef USE_INSTANCING\n	mat3 im = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n	transformedNormal = im * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = im * transformedTangent;\n	#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n		emissiveColor = sRGBTransferEOTF( emissiveColor );\n	#endif\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n	return value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	uniform mat3 envMapRotation;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n	vec3 getIBLIrradiance( const in vec3 normal ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 reflectVec = reflect( - viewDir, normal );\n			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	#ifdef USE_ANISOTROPY\n		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n			#ifdef ENVMAP_TYPE_CUBE_UV\n				vec3 bentNormal = cross( bitangent, viewDir );\n				bentNormal = normalize( cross( bentNormal, bitangent ) );\n				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n				return getIBLRadiance( viewDir, bentNormal, roughness );\n			#else\n				return vec3( 0.0 );\n			#endif\n		}\n	#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return vec3( texture2D( gradientMap, coord ).r );\n	#else\n		vec2 fw = fwidth( coord ) * 0.5;\n		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n	#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n	vec3 diffuseColor;\n	float specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Lambert\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n	uniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n	if ( cutoffDistance > 0.0 ) {\n		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n	}\n	return distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n		float dotNL = dot( normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	material.ior = ior;\n	#ifdef USE_SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularColorFactor = specularColor;\n		#ifdef USE_SPECULAR_COLORMAP\n			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n		#endif\n		#ifdef USE_SPECULAR_INTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularColorFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n	material.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	material.iridescence = iridescence;\n	material.iridescenceIOR = iridescenceIOR;\n	#ifdef USE_IRIDESCENCEMAP\n		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n	#endif\n	#ifdef USE_IRIDESCENCE_THICKNESSMAP\n		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n	#else\n		material.iridescenceThickness = iridescenceThicknessMaximum;\n	#endif\n#endif\n#ifdef USE_SHEEN\n	material.sheenColor = sheenColor;\n	#ifdef USE_SHEEN_COLORMAP\n		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n	#endif\n	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	#ifdef USE_ANISOTROPYMAP\n		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n	#else\n		vec2 anisotropyV = anisotropyVector;\n	#endif\n	material.anisotropy = length( anisotropyV );\n	if( material.anisotropy == 0.0 ) {\n		anisotropyV = vec2( 1.0, 0.0 );\n	} else {\n		anisotropyV /= material.anisotropy;\n		material.anisotropy = saturate( material.anisotropy );\n	}\n	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	float dispersion;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_IRIDESCENCE\n		float iridescence;\n		float iridescenceIOR;\n		float iridescenceThickness;\n		vec3 iridescenceFresnel;\n		vec3 iridescenceF0;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenColor;\n		float sheenRoughness;\n	#endif\n	#ifdef IOR\n		float ior;\n	#endif\n	#ifdef USE_TRANSMISSION\n		float transmission;\n		float transmissionAlpha;\n		float thickness;\n		float attenuationDistance;\n		vec3 attenuationColor;\n	#endif\n	#ifdef USE_ANISOTROPY\n		float anisotropy;\n		float alphaT;\n		vec3 anisotropyT;\n		vec3 anisotropyB;\n	#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n		float v = 0.5 / ( gv + gl );\n		return saturate(v);\n	}\n	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n		float a2 = alphaT * alphaB;\n		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n		highp float v2 = dot( v, v );\n		float w2 = a2 / v2;\n		return RECIPROCAL_PI * a2 * pow2 ( w2 );\n	}\n#endif\n#ifdef USE_CLEARCOAT\n	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n		vec3 f0 = material.clearcoatF0;\n		float f90 = material.clearcoatF90;\n		float roughness = material.clearcoatRoughness;\n		float alpha = pow2( roughness );\n		vec3 halfDir = normalize( lightDir + viewDir );\n		float dotNL = saturate( dot( normal, lightDir ) );\n		float dotNV = saturate( dot( normal, viewDir ) );\n		float dotNH = saturate( dot( normal, halfDir ) );\n		float dotVH = saturate( dot( viewDir, halfDir ) );\n		vec3 F = F_Schlick( f0, f90, dotVH );\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n		return F * ( V * D );\n	}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n	vec3 f0 = material.specularColor;\n	float f90 = material.specularF90;\n	float roughness = material.roughness;\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	#ifdef USE_IRIDESCENCE\n		F = mix( F, material.iridescenceFresnel, material.iridescence );\n	#endif\n	#ifdef USE_ANISOTROPY\n		float dotTL = dot( material.anisotropyT, lightDir );\n		float dotTV = dot( material.anisotropyT, viewDir );\n		float dotTH = dot( material.anisotropyT, halfDir );\n		float dotBL = dot( material.anisotropyB, lightDir );\n		float dotBV = dot( material.anisotropyB, viewDir );\n		float dotBH = dot( material.anisotropyB, halfDir );\n		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n	#else\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n	#endif\n	return F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n	float alpha = pow2( roughness );\n	float invAlpha = 1.0 / alpha;\n	float cos2h = dotNH * dotNH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float D = D_Charlie( sheenRoughness, dotNH );\n	float V = V_Neubelt( dotNV, dotNL );\n	return sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float r2 = roughness * roughness;\n	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n	return saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	#ifdef USE_IRIDESCENCE\n		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n	#else\n		vec3 Fr = specularColor;\n	#endif\n	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometryNormal;\n		vec3 viewDir = geometryViewDir;\n		vec3 position = geometryPosition;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n	#endif\n	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	#ifdef USE_IRIDESCENCE\n		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n	#else\n		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	#endif\n	vec3 totalScattering = singleScattering + multiScattering;\n	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n	geometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n	float dotNVi = saturate( dot( normal, geometryViewDir ) );\n	if ( material.iridescenceThickness == 0.0 ) {\n		material.iridescence = 0.0;\n	} else {\n		material.iridescence = saturate( material.iridescence );\n	}\n	if ( material.iridescence > 0.0 ) {\n		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n	}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometryPosition, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	vec4 spotColor;\n	vec3 spotLightCoord;\n	bool inSpotLightMap;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometryPosition, directLight );\n		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n		#else\n		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#endif\n		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n		#endif\n		#undef SPOT_LIGHT_MAP_INDEX\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	#if defined( USE_LIGHT_PROBES )\n		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n	#endif\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometryNormal );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	#ifdef USE_ANISOTROPY\n		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n	#else\n		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n	#endif\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	vFragDepth = 1.0 + gl_Position.w;\n	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 sampledDiffuseColor = texture2D( map, vMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n	#endif\n	diffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	#if defined( USE_POINTS_UV )\n		vec2 uv = vUv;\n	#else\n		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n	#endif\n#endif\n#ifdef USE_MAP\n	diffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n	varying vec2 vUv;\n#else\n	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n		uniform mat3 uvTransform;\n	#endif\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n	float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n	}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n	vColor *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		#if defined( USE_COLOR_ALPHA )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n		#elif defined( USE_COLOR )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n		#endif\n	}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n	}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	#ifndef USE_INSTANCING_MORPH\n		uniform float morphTargetBaseInfluence;\n		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n	#endif\n	uniform sampler2DArray morphTargetsTexture;\n	uniform ivec2 morphTargetsTextureSize;\n	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n		int y = texelIndex / morphTargetsTextureSize.x;\n		int x = texelIndex - y * morphTargetsTextureSize.x;\n		ivec3 morphUV = ivec3( x, y, morphTargetIndex );\n		return texelFetch( morphTargetsTexture, morphUV, 0 );\n	}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n	}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal *= faceDirection;\n	#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n	#ifdef USE_TANGENT\n		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn = getTangentFrame( - vViewPosition, normal,\n		#if defined( USE_NORMALMAP )\n			vNormalMapUv\n		#elif defined( USE_CLEARCOAT_NORMALMAP )\n			vClearcoatNormalMapUv\n		#else\n			vUv\n		#endif\n		);\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn[0] *= faceDirection;\n		tbn[1] *= faceDirection;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	#ifdef USE_TANGENT\n		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn2[0] *= faceDirection;\n		tbn2[1] *= faceDirection;\n	#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	normal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( uv.st );\n		vec2 st1 = dFdy( uv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n		return mat3( T * scale, B * scale, N );\n	}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	clearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n	uniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n	if( v <= 0.0 )\n		return vec4( 0., 0., 0., 0. );\n	if( v >= 1.0 )\n		return vec4( 1., 1., 1., 1. );\n	float vuf;\n	float af = modf( v * PackFactors.a, vuf );\n	float bf = modf( vuf * ShiftRight8, vuf );\n	float gf = modf( vuf * ShiftRight8, vuf );\n	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n	if( v <= 0.0 )\n		return vec3( 0., 0., 0. );\n	if( v >= 1.0 )\n		return vec3( 1., 1., 1. );\n	float vuf;\n	float bf = modf( v * PackFactors.b, vuf );\n	float gf = modf( vuf * ShiftRight8, vuf );\n	return vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n	if( v <= 0.0 )\n		return vec2( 0., 0. );\n	if( v >= 1.0 )\n		return vec2( 1., 1. );\n	float vuf;\n	float gf = modf( v * 256., vuf );\n	return vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n	return dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n	mvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		float hard_shadow = step( compare , distribution.x );\n		if (hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x ;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return mix( 1.0, shadow, shadowIntensity );\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		float shadow = 1.0;\n		vec3 lightToPosition = shadowCoord.xyz;\n		\n		float lightToPositionLength = length( lightToPosition );\n		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;\n			vec3 bd3D = normalize( lightToPosition );\n			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n				shadow = (\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n				) * ( 1.0 / 9.0 );\n			#else\n				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n			#endif\n		}\n		return mix( 1.0, shadow, shadowIntensity );\n	}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		struct SpotLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n	vec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n		shadowWorldPosition = worldPosition;\n		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n		#endif\n		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	uniform highp sampler2D boneTexture;\n	mat4 getBoneMatrix( const in float i ) {\n		int size = textureSize( boneTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n	vec3( 1.6605, - 0.1246, - 0.0182 ),\n	vec3( - 0.5876, 1.1329, - 0.1006 ),\n	vec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n	vec3( 0.6274, 0.0691, 0.0164 ),\n	vec3( 0.3293, 0.9195, 0.0880 ),\n	vec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n	vec3 x2 = x * x;\n	vec3 x4 = x2 * x2;\n	return + 15.5 * x4 * x2\n		- 40.14 * x4 * x\n		+ 31.96 * x4\n		- 6.868 * x2 * x\n		+ 0.4298 * x2\n		+ 0.1191 * x\n		- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n	const mat3 AgXInsetMatrix = mat3(\n		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n	);\n	const mat3 AgXOutsetMatrix = mat3(\n		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n	);\n	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;\n	color *= toneMappingExposure;\n	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n	color = AgXInsetMatrix * color;\n	color = max( color, 1e-10 );	color = log2( color );\n	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n	color = clamp( color, 0.0, 1.0 );\n	color = agxDefaultContrastApprox( color );\n	color = AgXOutsetMatrix * color;\n	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n	color = clamp( color, 0.0, 1.0 );\n	return color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n	const float StartCompression = 0.8 - 0.04;\n	const float Desaturation = 0.15;\n	color *= toneMappingExposure;\n	float x = min( color.r, min( color.g, color.b ) );\n	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n	color -= offset;\n	float peak = max( color.r, max( color.g, color.b ) );\n	if ( peak < StartCompression ) return color;\n	float d = 1. - StartCompression;\n	float newPeak = 1. - d * d / ( peak + d - StartCompression );\n	color *= newPeak / peak;\n	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n	return mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n	material.transmission = transmission;\n	material.transmissionAlpha = 1.0;\n	material.thickness = thickness;\n	material.attenuationDistance = attenuationDistance;\n	material.attenuationColor = attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmitted = getIBLVolumeRefraction(\n		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n		material.attenuationColor, material.attenuationDistance );\n	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	float w0( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n	}\n	float w1( float a ) {\n		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n	}\n	float w2( float a ){\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n	}\n	float w3( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * a * a );\n	}\n	float g0( float a ) {\n		return w0( a ) + w1( a );\n	}\n	float g1( float a ) {\n		return w2( a ) + w3( a );\n	}\n	float h0( float a ) {\n		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n	}\n	float h1( float a ) {\n		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n	}\n	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n		uv = uv * texelSize.zw + 0.5;\n		vec2 iuv = floor( uv );\n		vec2 fuv = fract( uv );\n		float g0x = g0( fuv.x );\n		float g1x = g1( fuv.x );\n		float h0x = h0( fuv.x );\n		float h1x = h1( fuv.x );\n		float h0y = h0( fuv.y );\n		float h1y = h1( fuv.y );\n		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n	}\n	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n		vec2 fLodSizeInv = 1.0 / fLodSize;\n		vec2 cLodSizeInv = 1.0 / cLodSize;\n		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n		return mix( fSample, cSample, fract( lod ) );\n	}\n	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( const in float roughness, const in float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n	}\n	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n		if ( isinf( attenuationDistance ) ) {\n			return vec3( 1.0 );\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n		const in vec3 attenuationColor, const in float attenuationDistance ) {\n		vec4 transmittedLight;\n		vec3 transmittance;\n		#ifdef USE_DISPERSION\n			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n			for ( int i = 0; i < 3; i ++ ) {\n				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n				vec3 refractedRayExit = position + transmissionRay;\n				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n				vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n				refractionCoords += 1.0;\n				refractionCoords /= 2.0;\n				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n				transmittedLight[ i ] = transmissionSample[ i ];\n				transmittedLight.a += transmissionSample.a;\n				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n			}\n			transmittedLight.a /= 3.0;\n		#else\n			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n			vec3 refractedRayExit = position + transmissionRay;\n			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n			vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n			refractionCoords += 1.0;\n			refractionCoords /= 2.0;\n			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n		#endif\n		vec3 attenuatedColor = transmittance * transmittedLight.rgb;\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n	}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform mat3 mapTransform;\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform mat3 alphaMapTransform;\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	uniform mat3 lightMapTransform;\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	uniform mat3 aoMapTransform;\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	uniform mat3 bumpMapTransform;\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	uniform mat3 normalMapTransform;\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	uniform mat3 displacementMapTransform;\n	varying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	uniform mat3 emissiveMapTransform;\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	uniform mat3 metalnessMapTransform;\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	uniform mat3 roughnessMapTransform;\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	uniform mat3 anisotropyMapTransform;\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	uniform mat3 clearcoatMapTransform;\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform mat3 clearcoatNormalMapTransform;\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform mat3 clearcoatRoughnessMapTransform;\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	uniform mat3 sheenColorMapTransform;\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	uniform mat3 sheenRoughnessMapTransform;\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	uniform mat3 iridescenceMapTransform;\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform mat3 iridescenceThicknessMapTransform;\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	uniform mat3 specularMapTransform;\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	uniform mat3 specularColorMapTransform;\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	uniform mat3 specularIntensityMapTransform;\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	vUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_BATCHING\n		worldPosition = batchingMatrix * worldPosition;\n	#endif\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#elif DEPTH_PACKING == 3202\n		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n	#elif DEPTH_PACKING == 3203\n		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n	#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n	uniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix[ 3 ];\n	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"},eq={common:{diffuse:{value:new eE.Ilk(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new eE.Vkp},alphaMap:{value:null},alphaMapTransform:{value:new eE.Vkp},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new eE.Vkp}},envmap:{envMap:{value:null},envMapRotation:{value:new eE.Vkp},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new eE.Vkp}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new eE.Vkp}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new eE.Vkp},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new eE.Vkp},normalScale:{value:new eE.FM8(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new eE.Vkp},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new eE.Vkp}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new eE.Vkp}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new eE.Vkp}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new eE.Ilk(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new eE.Ilk(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new eE.Vkp},alphaTest:{value:0},uvTransform:{value:new eE.Vkp}},sprite:{diffuse:{value:new eE.Ilk(0xffffff)},opacity:{value:1},center:{value:new eE.FM8(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new eE.Vkp},alphaMap:{value:null},alphaMapTransform:{value:new eE.Vkp},alphaTest:{value:0}}},eX={basic:{uniforms:(0,eE.Rhp)([eq.common,eq.specularmap,eq.envmap,eq.aomap,eq.lightmap,eq.fog]),vertexShader:eW.meshbasic_vert,fragmentShader:eW.meshbasic_frag},lambert:{uniforms:(0,eE.Rhp)([eq.common,eq.specularmap,eq.envmap,eq.aomap,eq.lightmap,eq.emissivemap,eq.bumpmap,eq.normalmap,eq.displacementmap,eq.fog,eq.lights,{emissive:{value:new eE.Ilk(0)}}]),vertexShader:eW.meshlambert_vert,fragmentShader:eW.meshlambert_frag},phong:{uniforms:(0,eE.Rhp)([eq.common,eq.specularmap,eq.envmap,eq.aomap,eq.lightmap,eq.emissivemap,eq.bumpmap,eq.normalmap,eq.displacementmap,eq.fog,eq.lights,{emissive:{value:new eE.Ilk(0)},specular:{value:new eE.Ilk(1118481)},shininess:{value:30}}]),vertexShader:eW.meshphong_vert,fragmentShader:eW.meshphong_frag},standard:{uniforms:(0,eE.Rhp)([eq.common,eq.envmap,eq.aomap,eq.lightmap,eq.emissivemap,eq.bumpmap,eq.normalmap,eq.displacementmap,eq.roughnessmap,eq.metalnessmap,eq.fog,eq.lights,{emissive:{value:new eE.Ilk(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:eW.meshphysical_vert,fragmentShader:eW.meshphysical_frag},toon:{uniforms:(0,eE.Rhp)([eq.common,eq.aomap,eq.lightmap,eq.emissivemap,eq.bumpmap,eq.normalmap,eq.displacementmap,eq.gradientmap,eq.fog,eq.lights,{emissive:{value:new eE.Ilk(0)}}]),vertexShader:eW.meshtoon_vert,fragmentShader:eW.meshtoon_frag},matcap:{uniforms:(0,eE.Rhp)([eq.common,eq.bumpmap,eq.normalmap,eq.displacementmap,eq.fog,{matcap:{value:null}}]),vertexShader:eW.meshmatcap_vert,fragmentShader:eW.meshmatcap_frag},points:{uniforms:(0,eE.Rhp)([eq.points,eq.fog]),vertexShader:eW.points_vert,fragmentShader:eW.points_frag},dashed:{uniforms:(0,eE.Rhp)([eq.common,eq.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:eW.linedashed_vert,fragmentShader:eW.linedashed_frag},depth:{uniforms:(0,eE.Rhp)([eq.common,eq.displacementmap]),vertexShader:eW.depth_vert,fragmentShader:eW.depth_frag},normal:{uniforms:(0,eE.Rhp)([eq.common,eq.bumpmap,eq.normalmap,eq.displacementmap,{opacity:{value:1}}]),vertexShader:eW.meshnormal_vert,fragmentShader:eW.meshnormal_frag},sprite:{uniforms:(0,eE.Rhp)([eq.sprite,eq.fog]),vertexShader:eW.sprite_vert,fragmentShader:eW.sprite_frag},background:{uniforms:{uvTransform:{value:new eE.Vkp},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:eW.background_vert,fragmentShader:eW.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new eE.Vkp}},vertexShader:eW.backgroundCube_vert,fragmentShader:eW.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:eW.cube_vert,fragmentShader:eW.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:eW.equirect_vert,fragmentShader:eW.equirect_frag},distanceRGBA:{uniforms:(0,eE.Rhp)([eq.common,eq.displacementmap,{referencePosition:{value:new eE.Pa4},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:eW.distanceRGBA_vert,fragmentShader:eW.distanceRGBA_frag},shadow:{uniforms:(0,eE.Rhp)([eq.lights,eq.fog,{color:{value:new eE.Ilk(0)},opacity:{value:1}}]),vertexShader:eW.shadow_vert,fragmentShader:eW.shadow_frag}};eX.physical={uniforms:(0,eE.Rhp)([eX.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new eE.Vkp},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new eE.Vkp},clearcoatNormalScale:{value:new eE.FM8(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new eE.Vkp},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new eE.Vkp},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new eE.Vkp},sheen:{value:0},sheenColor:{value:new eE.Ilk(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new eE.Vkp},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new eE.Vkp},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new eE.Vkp},transmissionSamplerSize:{value:new eE.FM8},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new eE.Vkp},attenuationDistance:{value:0},attenuationColor:{value:new eE.Ilk(0)},specularColor:{value:new eE.Ilk(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new eE.Vkp},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new eE.Vkp},anisotropyVector:{value:new eE.FM8},anisotropyMap:{value:null},anisotropyMapTransform:{value:new eE.Vkp}}]),vertexShader:eW.meshphysical_vert,fragmentShader:eW.meshphysical_frag};let eK={r:0,b:0,g:0},eY=new eE.USm,eJ=new eE.yGw;function eZ(e,i,n,r,s,a,o){let l,h;let u=new eE.Ilk(0),c=+(!0!==a),d=null,p=0,f=null;function m(e){let r=!0===e.isScene?e.background:null;return r&&r.isTexture&&(r=(e.backgroundBlurriness>0?n:i).get(r)),r}function g(i,n){i.getRGB(eK,(0,eE.oDz)(e)),r.buffers.color.setClear(eK.r,eK.g,eK.b,n,o)}return{getClearColor:function(){return u},setClearColor:function(e,i=1){u.set(e),g(u,c=i)},getClearAlpha:function(){return c},setClearAlpha:function(e){g(u,c=e)},render:function(i){let n=!1,s=m(i);null===s?g(u,c):s&&s.isColor&&(g(s,1),n=!0);let a=e.xr.getEnvironmentBlendMode();"additive"===a?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===a&&r.buffers.color.setClear(0,0,0,0,o),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(i,n){let r=m(n);r&&(r.isCubeTexture||r.mapping===eE.g8_)?(void 0===h&&((h=new eE.Kj0(new eE.DvJ(1,1,1),new eE.jyz({name:"BackgroundCubeMaterial",uniforms:(0,eE.dwf)(eX.backgroundCube.uniforms),vertexShader:eX.backgroundCube.vertexShader,fragmentShader:eX.backgroundCube.fragmentShader,side:eE._Li,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(e,i,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),eY.copy(n.backgroundRotation),eY.x*=-1,eY.y*=-1,eY.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(eY.y*=-1,eY.z*=-1),h.material.uniforms.envMap.value=r,h.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,h.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(eJ.makeRotationFromEuler(eY)),h.material.toneMapped=eE.epp.getTransfer(r.colorSpace)!==eE.j17,(d!==r||p!==r.version||f!==e.toneMapping)&&(h.material.needsUpdate=!0,d=r,p=r.version,f=e.toneMapping),h.layers.enableAll(),i.unshift(h,h.geometry,h.material,0,0,null)):r&&r.isTexture&&(void 0===l&&((l=new eE.Kj0(new eE._12(2,2),new eE.jyz({name:"BackgroundMaterial",uniforms:(0,eE.dwf)(eX.background.uniforms),vertexShader:eX.background.vertexShader,fragmentShader:eX.background.fragmentShader,side:eE.Wl3,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=eE.epp.getTransfer(r.colorSpace)!==eE.j17,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),(d!==r||p!==r.version||f!==e.toneMapping)&&(l.material.needsUpdate=!0,d=r,p=r.version,f=e.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==h&&(h.geometry.dispose(),h.material.dispose()),void 0!==l&&(l.geometry.dispose(),l.material.dispose())}}}function e$(e,i){let n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},s=u(null),a=s,o=!1;function l(i){return e.bindVertexArray(i)}function h(i){return e.deleteVertexArray(i)}function u(e){let i=[],r=[],s=[];for(let e=0;e<n;e++)i[e]=0,r[e]=0,s[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:i,enabledAttributes:r,attributeDivisors:s,object:e,attributes:{},index:null}}function c(){let e=a.newAttributes;for(let i=0,n=e.length;i<n;i++)e[i]=0}function d(e){p(e,0)}function p(i,n){let r=a.newAttributes,s=a.enabledAttributes,o=a.attributeDivisors;r[i]=1,0===s[i]&&(e.enableVertexAttribArray(i),s[i]=1),o[i]!==n&&(e.vertexAttribDivisor(i,n),o[i]=n)}function f(){let i=a.newAttributes,n=a.enabledAttributes;for(let r=0,s=n.length;r<s;r++)n[r]!==i[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function m(i,n,r,s,a,o,l){!0===l?e.vertexAttribIPointer(i,n,r,a,o):e.vertexAttribPointer(i,n,r,s,a,o)}function g(){A(),o=!0,a!==s&&l((a=s).object)}function A(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:function(n,s,h,g,A){let v=!1,y=function(i,n,s){let a=!0===s.wireframe,o=r[i.id];void 0===o&&(o={},r[i.id]=o);let l=o[n.id];void 0===l&&(l={},o[n.id]=l);let h=l[a];return void 0===h&&(h=u(e.createVertexArray()),l[a]=h),h}(g,h,s);a!==y&&l((a=y).object),(v=function(e,i,n,r){let s=a.attributes,o=i.attributes,l=0,h=n.getAttributes();for(let i in h)if(h[i].location>=0){let n=s[i],r=o[i];if(void 0===r&&("instanceMatrix"===i&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===i&&e.instanceColor&&(r=e.instanceColor)),void 0===n||n.attribute!==r||r&&n.data!==r.data)return!0;l++}return a.attributesNum!==l||a.index!==r}(n,g,h,A))&&function(e,i,n,r){let s={},o=i.attributes,l=0,h=n.getAttributes();for(let i in h)if(h[i].location>=0){let n=o[i];void 0===n&&("instanceMatrix"===i&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===i&&e.instanceColor&&(n=e.instanceColor));let r={};r.attribute=n,n&&n.data&&(r.data=n.data),s[i]=r,l++}a.attributes=s,a.attributesNum=l,a.index=r}(n,g,h,A),null!==A&&i.update(A,e.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(n,r,s,a){c();let o=a.attributes,l=s.getAttributes(),h=r.defaultAttributeValues;for(let r in l){let s=l[r];if(s.location>=0){let l=o[r];if(void 0===l&&("instanceMatrix"===r&&n.instanceMatrix&&(l=n.instanceMatrix),"instanceColor"===r&&n.instanceColor&&(l=n.instanceColor)),void 0!==l){let r=l.normalized,o=l.itemSize,h=i.get(l);if(void 0===h)continue;let u=h.buffer,c=h.type,f=h.bytesPerElement,g=c===e.INT||c===e.UNSIGNED_INT||l.gpuType===eE.Kz5;if(l.isInterleavedBufferAttribute){let i=l.data,h=i.stride,A=l.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<s.locationSize;e++)p(s.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<s.locationSize;e++)d(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)m(s.location+e,o/s.locationSize,c,r,h*f,(A+o/s.locationSize*e)*f,g)}else{if(l.isInstancedBufferAttribute){for(let e=0;e<s.locationSize;e++)p(s.location+e,l.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=l.meshPerAttribute*l.count)}else for(let e=0;e<s.locationSize;e++)d(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)m(s.location+e,o/s.locationSize,c,r,o*f,o/s.locationSize*e*f,g)}}else if(void 0!==h){let i=h[r];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(s.location,i);break;case 3:e.vertexAttrib3fv(s.location,i);break;case 4:e.vertexAttrib4fv(s.location,i);break;default:e.vertexAttrib1fv(s.location,i)}}}}f()}(n,s,h,g),null!==A&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.get(A).buffer))},reset:g,resetDefaultState:A,dispose:function(){for(let e in g(),r){let i=r[e];for(let e in i){let n=i[e];for(let e in n)h(n[e].object),delete n[e];delete i[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;let i=r[e.id];for(let e in i){let n=i[e];for(let e in n)h(n[e].object),delete n[e];delete i[e]}delete r[e.id]},releaseStatesOfProgram:function(e){for(let i in r){let n=r[i];if(void 0===n[e.id])continue;let s=n[e.id];for(let e in s)h(s[e].object),delete s[e];delete n[e.id]}},initAttributes:c,enableAttribute:d,disableUnusedAttributes:f}}function e0(e,i,n){let r;function s(i,s,a){0!==a&&(e.drawArraysInstanced(r,i,s,a),n.update(s,r,a))}this.setMode=function(e){r=e},this.render=function(i,s){e.drawArrays(r,i,s),n.update(s,r,1)},this.renderInstances=s,this.renderMultiDraw=function(e,s,a){if(0===a)return;i.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,s,0,a);let o=0;for(let e=0;e<a;e++)o+=s[e];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,a,o,l){if(0===o)return;let h=i.get("WEBGL_multi_draw");if(null===h)for(let i=0;i<e.length;i++)s(e[i],a[i],l[i]);else{h.multiDrawArraysInstancedWEBGL(r,e,0,a,0,l,0,o);let i=0;for(let e=0;e<o;e++)i+=a[e]*l[e];n.update(i,r,1)}}}function e1(e,i,n,r){let s;function a(i){if("highp"===i){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";i="mediump"}return"mediump"===i&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp",l=a(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let h=!0===n.logarithmicDepthBuffer,u=!0===n.reverseDepthBuffer&&i.has("EXT_clip_control"),c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),m=e.getParameter(e.MAX_VERTEX_ATTRIBS),g=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),A=e.getParameter(e.MAX_VARYING_VECTORS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==s)return s;if(!0===i.has("EXT_texture_filter_anisotropic")){let n=i.get("EXT_texture_filter_anisotropic");s=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s},getMaxPrecision:a,textureFormatReadable:function(i){return i===eE.wk1||r.convert(i)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){let s=n===eE.cLu&&(i.has("EXT_color_buffer_half_float")||i.has("EXT_color_buffer_float"));return n===eE.ywz||r.convert(n)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)||n===eE.VzW||!!s},precision:o,logarithmicDepthBuffer:h,reverseDepthBuffer:u,maxTextures:c,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:g,maxVaryings:A,maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:d>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function e2(e){let i=this,n=null,r=0,s=!1,a=!1,o=new eE.JOQ,l=new eE.Vkp,h={value:null,needsUpdate:!1};function u(e,n,r,s){let a=null!==e?e.length:0,u=null;if(0!==a){if(u=h.value,!0!==s||null===u){let i=r+4*a,s=n.matrixWorldInverse;l.getNormalMatrix(s),(null===u||u.length<i)&&(u=new Float32Array(i));for(let i=0,n=r;i!==a;++i,n+=4)o.copy(e[i]).applyMatrix4(s,l),o.normal.toArray(u,n),u[n+3]=o.constant}h.value=u,h.needsUpdate=!0}return i.numPlanes=a,i.numIntersection=0,u}this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i){let n=0!==e.length||i||0!==r||s;return s=i,r=e.length,n},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,i){n=u(e,i,0)},this.setState=function(o,l,c){let d=o.clippingPlanes,p=o.clipIntersection,f=o.clipShadows,m=e.get(o);if(s&&null!==d&&0!==d.length&&(!a||f)){let e=a?0:r,i=4*e,s=m.clippingState||null;h.value=s,s=u(d,l,i,c);for(let e=0;e!==i;++e)s[e]=n[e];m.clippingState=s,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=e}else a?u(null):(h.value!==n&&(h.value=n,h.needsUpdate=r>0),i.numPlanes=r,i.numIntersection=0)}}function e3(e){let i=new WeakMap;function n(e,i){return i===eE.dSO?e.mapping=eE.fY$:i===eE.Bf4&&(e.mapping=eE.vxC),e}function r(e){let n=e.target;n.removeEventListener("dispose",r);let s=i.get(n);void 0!==s&&(i.delete(n),s.dispose())}return{get:function(s){if(s&&s.isTexture){let a=s.mapping;if(a===eE.dSO||a===eE.Bf4){if(i.has(s))return n(i.get(s).texture,s.mapping);{let a=s.image;if(!a||!(a.height>0))return null;{let o=new eE.oAp(a.height);return o.fromEquirectangularTexture(e,s),i.set(s,o),s.addEventListener("dispose",r),n(o.texture,s.mapping)}}}}return s},dispose:function(){i=new WeakMap}}}let e4=[.125,.215,.35,.446,.526,.582],e5=new eE.iKG,e6=new eE.Ilk,e8=null,e7=0,e9=0,te=!1,tt=(1+Math.sqrt(5))/2,ti=1/tt,tn=[new eE.Pa4(-tt,ti,0),new eE.Pa4(tt,ti,0),new eE.Pa4(-ti,0,tt),new eE.Pa4(ti,0,tt),new eE.Pa4(0,tt,-ti),new eE.Pa4(0,tt,ti),new eE.Pa4(-1,1,-1),new eE.Pa4(1,1,-1),new eE.Pa4(-1,1,1),new eE.Pa4(1,1,1)];class tr{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,n=.1,r=100){e8=this._renderer.getRenderTarget(),e7=this._renderer.getActiveCubeFace(),e9=this._renderer.getActiveMipmapLevel(),te=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);let s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=tl(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=to(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(e8,e7,e9),this._renderer.xr.enabled=te,e.scissorTest=!1,ta(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===eE.fY$||e.mapping===eE.vxC?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),e8=this._renderer.getRenderTarget(),e7=this._renderer.getActiveCubeFace(),e9=this._renderer.getActiveMipmapLevel(),te=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;let n=i||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:eE.wem,minFilter:eE.wem,generateMipmaps:!1,type:eE.cLu,format:eE.wk1,colorSpace:eE.GUF,depthBuffer:!1},r=ts(e,i,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ts(e,i,n);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){let i=[],n=[],r=[],s=e,a=e-4+1+e4.length;for(let o=0;o<a;o++){let a=Math.pow(2,s);n.push(a);let l=1/a;o>e-4?l=e4[o-e+4-1]:0===o&&(l=0),r.push(l);let h=1/(a-2),u=-h,c=1+h,d=[u,u,c,u,c,c,u,u,c,c,u,c],p=new Float32Array(108),f=new Float32Array(72),m=new Float32Array(36);for(let e=0;e<6;e++){let i=e%3*2/3-1,n=e>2?0:-1,r=[i,n,0,i+2/3,n,0,i+2/3,n+1,0,i,n,0,i+2/3,n+1,0,i,n+1,0];p.set(r,18*e),f.set(d,12*e);let s=[e,e,e,e,e,e];m.set(s,6*e)}let g=new eE.u9r;g.setAttribute("position",new eE.TlE(p,3)),g.setAttribute("uv",new eE.TlE(f,2)),g.setAttribute("faceIndex",new eE.TlE(m,1)),i.push(g),s>4&&s--}return{lodPlanes:i,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,i,n){let r=new Float32Array(20),s=new eE.Pa4(0,1,0);return new eE.jyz({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/i,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:th(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:eE.jFi,depthTest:!1,depthWrite:!1})}(r,e,i)}return r}_compileMaterial(e){let i=new eE.Kj0(this._lodPlanes[0],e);this._renderer.compile(i,e5)}_sceneToCubeUV(e,i,n,r){let s=new eE.cPb(90,1,i,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,h=l.autoClear,u=l.toneMapping;l.getClearColor(e6),l.toneMapping=eE.uL9,l.autoClear=!1;let c=new eE.vBJ({name:"PMREM.Background",side:eE._Li,depthWrite:!1,depthTest:!1}),d=new eE.Kj0(new eE.DvJ,c),p=!1,f=e.background;f?f.isColor&&(c.color.copy(f),e.background=null,p=!0):(c.color.copy(e6),p=!0);for(let i=0;i<6;i++){let n=i%3;0===n?(s.up.set(0,a[i],0),s.lookAt(o[i],0,0)):1===n?(s.up.set(0,0,a[i]),s.lookAt(0,o[i],0)):(s.up.set(0,a[i],0),s.lookAt(0,0,o[i]));let h=this._cubeSize;ta(r,n*h,i>2?h:0,h,h),l.setRenderTarget(r),p&&l.render(d,s),l.render(e,s)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=u,l.autoClear=h,e.background=f}_textureToCubeUV(e,i){let n=this._renderer,r=e.mapping===eE.fY$||e.mapping===eE.vxC;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=tl()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=to());let s=r?this._cubemapMaterial:this._equirectMaterial,a=new eE.Kj0(this._lodPlanes[0],s);s.uniforms.envMap.value=e;let o=this._cubeSize;ta(i,0,0,3*o,2*o),n.setRenderTarget(i),n.render(a,e5)}_applyPMREM(e){let i=this._renderer,n=i.autoClear;i.autoClear=!1;let r=this._lodPlanes.length;for(let i=1;i<r;i++){let n=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),s=tn[(r-i-1)%tn.length];this._blur(e,i-1,i,n,s)}i.autoClear=n}_blur(e,i,n,r,s){let a=this._pingPongRenderTarget;this._halfBlur(e,a,i,n,r,"latitudinal",s),this._halfBlur(a,e,n,n,r,"longitudinal",s)}_halfBlur(e,i,n,r,s,a,o){let l=this._renderer,h=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let u=new eE.Kj0(this._lodPlanes[r],h),c=h.uniforms,d=this._sizeLods[n]-1,p=isFinite(s)?Math.PI/(2*d):2*Math.PI/39,f=s/p,m=isFinite(s)?1+Math.floor(3*f):20;m>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);let g=[],A=0;for(let e=0;e<20;++e){let i=e/f,n=Math.exp(-i*i/2);g.push(n),0===e?A+=n:e<m&&(A+=2*n)}for(let e=0;e<g.length;e++)g[e]=g[e]/A;c.envMap.value=e.texture,c.samples.value=m,c.weights.value=g,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);let{_lodMax:v}=this;c.dTheta.value=p,c.mipInt.value=v-n;let y=this._sizeLods[r],x=4*(this._cubeSize-y);ta(i,3*y*(r>v-4?r-v+4:0),x,3*y,2*y),l.setRenderTarget(i),l.render(u,e5)}}function ts(e,i,n){let r=new eE.dd2(e,i,n);return r.texture.mapping=eE.g8_,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function ta(e,i,n,r,s){e.viewport.set(i,n,r,s),e.scissor.set(i,n,r,s)}function to(){return new eE.jyz({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:th(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:eE.jFi,depthTest:!1,depthWrite:!1})}function tl(){return new eE.jyz({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:th(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:eE.jFi,depthTest:!1,depthWrite:!1})}function th(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function tu(e){let i=new WeakMap,n=null;function r(e){let n=e.target;n.removeEventListener("dispose",r);let s=i.get(n);void 0!==s&&(i.delete(n),s.dispose())}return{get:function(s){if(s&&s.isTexture){let a=s.mapping,o=a===eE.dSO||a===eE.Bf4,l=a===eE.fY$||a===eE.vxC;if(o||l){let a=i.get(s),h=void 0!==a?a.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==h)return null===n&&(n=new tr(e)),(a=o?n.fromEquirectangular(s,a):n.fromCubemap(s,a)).texture.pmremVersion=s.pmremVersion,i.set(s,a),a.texture;if(void 0!==a)return a.texture;{let h=s.image;return o&&h&&h.height>0||l&&h&&function(e){let i=0;for(let n=0;n<6;n++)void 0!==e[n]&&i++;return 6===i}(h)?(null===n&&(n=new tr(e)),(a=o?n.fromEquirectangular(s):n.fromCubemap(s)).texture.pmremVersion=s.pmremVersion,i.set(s,a),s.addEventListener("dispose",r),a.texture):null}}}return s},dispose:function(){i=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function tc(e){let i={};function n(n){let r;if(void 0!==i[n])return i[n];switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return i[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){let i=n(e);return null===i&&(0,eE.O4K)("THREE.WebGLRenderer: "+e+" extension not supported."),i}}}function td(e,i,n,r){let s={},a=new WeakMap;function o(e){let l=e.target;for(let e in null!==l.index&&i.remove(l.index),l.attributes)i.remove(l.attributes[e]);l.removeEventListener("dispose",o),delete s[l.id];let h=a.get(l);h&&(i.remove(h),a.delete(l)),r.releaseStatesOfGeometry(l),!0===l.isInstancedBufferGeometry&&delete l._maxInstanceCount,n.memory.geometries--}function l(e){let n=[],r=e.index,s=e.attributes.position,o=0;if(null!==r){let e=r.array;o=r.version;for(let i=0,r=e.length;i<r;i+=3){let r=e[i+0],s=e[i+1],a=e[i+2];n.push(r,s,s,a,a,r)}}else{if(void 0===s)return;let e=s.array;o=s.version;for(let i=0,r=e.length/3-1;i<r;i+=3){let e=i+0,r=i+1,s=i+2;n.push(e,r,r,s,s,e)}}let l=new((0,eE.H7L)(n)?eE.lCJ:eE.qlB)(n,1);l.version=o;let h=a.get(e);h&&i.remove(h),a.set(e,l)}return{get:function(e,i){return!0===s[i.id]||(i.addEventListener("dispose",o),s[i.id]=!0,n.memory.geometries++),i},update:function(n){let r=n.attributes;for(let n in r)i.update(r[n],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){let i=a.get(e);if(i){let n=e.index;null!==n&&i.version<n.version&&l(e)}else l(e);return a.get(e)}}}function tp(e,i,n){let r,s,a;function o(i,o,l){0!==l&&(e.drawElementsInstanced(r,o,s,i*a,l),n.update(o,r,l))}this.setMode=function(e){r=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(i,o){e.drawElements(r,o,s,i*a),n.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(e,a,o){if(0===o)return;i.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,a,0,s,e,0,o);let l=0;for(let e=0;e<o;e++)l+=a[e];n.update(l,r,1)},this.renderMultiDrawInstances=function(e,l,h,u){if(0===h)return;let c=i.get("WEBGL_multi_draw");if(null===c)for(let i=0;i<e.length;i++)o(e[i]/a,l[i],u[i]);else{c.multiDrawElementsInstancedWEBGL(r,l,0,s,e,0,u,0,h);let i=0;for(let e=0;e<h;e++)i+=l[e]*u[e];n.update(i,r,1)}}}function tf(e){let i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(n,r,s){switch(i.calls++,r){case e.TRIANGLES:i.triangles+=n/3*s;break;case e.LINES:i.lines+=n/2*s;break;case e.LINE_STRIP:i.lines+=s*(n-1);break;case e.LINE_LOOP:i.lines+=s*n;break;case e.POINTS:i.points+=s*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function tm(e,i,n){let r=new WeakMap,s=new eE.Ltg;return{update:function(a,o,l){let h=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,c=void 0!==u?u.length:0,d=r.get(o);if(void 0===d||d.count!==c){void 0!==d&&d.texture.dispose();let e=void 0!==o.morphAttributes.position,n=void 0!==o.morphAttributes.normal,a=void 0!==o.morphAttributes.color,l=o.morphAttributes.position||[],h=o.morphAttributes.normal||[],u=o.morphAttributes.color||[],p=0;!0===e&&(p=1),!0===n&&(p=2),!0===a&&(p=3);let f=o.attributes.position.count*p,m=1;f>i.maxTextureSize&&(m=Math.ceil(f/i.maxTextureSize),f=i.maxTextureSize);let g=new Float32Array(f*m*4*c),A=new eE.p3g(g,f,m,c);A.type=eE.VzW,A.needsUpdate=!0;let v=4*p;for(let i=0;i<c;i++){let r=l[i],o=h[i],c=u[i],d=f*m*4*i;for(let i=0;i<r.count;i++){let l=i*v;!0===e&&(s.fromBufferAttribute(r,i),g[d+l+0]=s.x,g[d+l+1]=s.y,g[d+l+2]=s.z,g[d+l+3]=0),!0===n&&(s.fromBufferAttribute(o,i),g[d+l+4]=s.x,g[d+l+5]=s.y,g[d+l+6]=s.z,g[d+l+7]=0),!0===a&&(s.fromBufferAttribute(c,i),g[d+l+8]=s.x,g[d+l+9]=s.y,g[d+l+10]=s.z,g[d+l+11]=4===c.itemSize?s.w:1)}}d={count:c,texture:A,size:new eE.FM8(f,m)},r.set(o,d),o.addEventListener("dispose",function e(){A.dispose(),r.delete(o),o.removeEventListener("dispose",e)})}if(!0===a.isInstancedMesh&&null!==a.morphTexture)l.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{let i=0;for(let e=0;e<h.length;e++)i+=h[e];let n=o.morphTargetsRelative?1:1-i;l.getUniforms().setValue(e,"morphTargetBaseInfluence",n),l.getUniforms().setValue(e,"morphTargetInfluences",h)}l.getUniforms().setValue(e,"morphTargetsTexture",d.texture,n),l.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}}}function tg(e,i,n,r){let s=new WeakMap;function a(e){let i=e.target;i.removeEventListener("dispose",a),n.remove(i.instanceMatrix),null!==i.instanceColor&&n.remove(i.instanceColor)}return{update:function(o){let l=r.render.frame,h=o.geometry,u=i.get(o,h);if(s.get(u)!==l&&(i.update(u),s.set(u,l)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),s.get(o)!==l&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),s.set(o,l))),o.isSkinnedMesh){let e=o.skeleton;s.get(e)!==l&&(e.update(),s.set(e,l))}return u},dispose:function(){s=new WeakMap}}}let tA=new eE.xEZ,tv=new eE.$YQ(1,1),ty=new eE.p3g,tx=new eE.JUT,t_=new eE.BtG,tb=[],tE=[],tw=new Float32Array(16),tM=new Float32Array(9),tC=new Float32Array(4);function tS(e,i,n){let r=e[0];if(r<=0||r>0)return e;let s=i*n,a=tb[s];if(void 0===a&&(a=new Float32Array(s),tb[s]=a),0!==i){r.toArray(a,0);for(let r=1,s=0;r!==i;++r)s+=n,e[r].toArray(a,s)}return a}function tT(e,i){if(e.length!==i.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==i[n])return!1;return!0}function tR(e,i){for(let n=0,r=i.length;n<r;n++)e[n]=i[n]}function tI(e,i){let n=tE[i];void 0===n&&(n=new Int32Array(i),tE[i]=n);for(let r=0;r!==i;++r)n[r]=e.allocateTextureUnit();return n}function tB(e,i){let n=this.cache;n[0]!==i&&(e.uniform1f(this.addr,i),n[0]=i)}function tL(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y)&&(e.uniform2f(this.addr,i.x,i.y),n[0]=i.x,n[1]=i.y);else{if(tT(n,i))return;e.uniform2fv(this.addr,i),tR(n,i)}}function tP(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z)&&(e.uniform3f(this.addr,i.x,i.y,i.z),n[0]=i.x,n[1]=i.y,n[2]=i.z);else if(void 0!==i.r)(n[0]!==i.r||n[1]!==i.g||n[2]!==i.b)&&(e.uniform3f(this.addr,i.r,i.g,i.b),n[0]=i.r,n[1]=i.g,n[2]=i.b);else{if(tT(n,i))return;e.uniform3fv(this.addr,i),tR(n,i)}}function tD(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z||n[3]!==i.w)&&(e.uniform4f(this.addr,i.x,i.y,i.z,i.w),n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=i.w);else{if(tT(n,i))return;e.uniform4fv(this.addr,i),tR(n,i)}}function tN(e,i){let n=this.cache,r=i.elements;if(void 0===r){if(tT(n,i))return;e.uniformMatrix2fv(this.addr,!1,i),tR(n,i)}else{if(tT(n,r))return;tC.set(r),e.uniformMatrix2fv(this.addr,!1,tC),tR(n,r)}}function tO(e,i){let n=this.cache,r=i.elements;if(void 0===r){if(tT(n,i))return;e.uniformMatrix3fv(this.addr,!1,i),tR(n,i)}else{if(tT(n,r))return;tM.set(r),e.uniformMatrix3fv(this.addr,!1,tM),tR(n,r)}}function tU(e,i){let n=this.cache,r=i.elements;if(void 0===r){if(tT(n,i))return;e.uniformMatrix4fv(this.addr,!1,i),tR(n,i)}else{if(tT(n,r))return;tw.set(r),e.uniformMatrix4fv(this.addr,!1,tw),tR(n,r)}}function tk(e,i){let n=this.cache;n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i)}function tF(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y)&&(e.uniform2i(this.addr,i.x,i.y),n[0]=i.x,n[1]=i.y);else{if(tT(n,i))return;e.uniform2iv(this.addr,i),tR(n,i)}}function tz(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z)&&(e.uniform3i(this.addr,i.x,i.y,i.z),n[0]=i.x,n[1]=i.y,n[2]=i.z);else{if(tT(n,i))return;e.uniform3iv(this.addr,i),tR(n,i)}}function tG(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z||n[3]!==i.w)&&(e.uniform4i(this.addr,i.x,i.y,i.z,i.w),n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=i.w);else{if(tT(n,i))return;e.uniform4iv(this.addr,i),tR(n,i)}}function tV(e,i){let n=this.cache;n[0]!==i&&(e.uniform1ui(this.addr,i),n[0]=i)}function tj(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y)&&(e.uniform2ui(this.addr,i.x,i.y),n[0]=i.x,n[1]=i.y);else{if(tT(n,i))return;e.uniform2uiv(this.addr,i),tR(n,i)}}function tH(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z)&&(e.uniform3ui(this.addr,i.x,i.y,i.z),n[0]=i.x,n[1]=i.y,n[2]=i.z);else{if(tT(n,i))return;e.uniform3uiv(this.addr,i),tR(n,i)}}function tQ(e,i){let n=this.cache;if(void 0!==i.x)(n[0]!==i.x||n[1]!==i.y||n[2]!==i.z||n[3]!==i.w)&&(e.uniform4ui(this.addr,i.x,i.y,i.z,i.w),n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=i.w);else{if(tT(n,i))return;e.uniform4uiv(this.addr,i),tR(n,i)}}function tW(e,i,n){let r;let s=this.cache,a=n.allocateTextureUnit();s[0]!==a&&(e.uniform1i(this.addr,a),s[0]=a),this.type===e.SAMPLER_2D_SHADOW?(tv.compareFunction=eE.M$G,r=tv):r=tA,n.setTexture2D(i||r,a)}function tq(e,i,n){let r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),n.setTexture3D(i||tx,s)}function tX(e,i,n){let r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),n.setTextureCube(i||t_,s)}function tK(e,i,n){let r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),n.setTexture2DArray(i||ty,s)}function tY(e,i){e.uniform1fv(this.addr,i)}function tJ(e,i){let n=tS(i,this.size,2);e.uniform2fv(this.addr,n)}function tZ(e,i){let n=tS(i,this.size,3);e.uniform3fv(this.addr,n)}function t$(e,i){let n=tS(i,this.size,4);e.uniform4fv(this.addr,n)}function t0(e,i){let n=tS(i,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function t1(e,i){let n=tS(i,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function t2(e,i){let n=tS(i,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function t3(e,i){e.uniform1iv(this.addr,i)}function t4(e,i){e.uniform2iv(this.addr,i)}function t5(e,i){e.uniform3iv(this.addr,i)}function t6(e,i){e.uniform4iv(this.addr,i)}function t8(e,i){e.uniform1uiv(this.addr,i)}function t7(e,i){e.uniform2uiv(this.addr,i)}function t9(e,i){e.uniform3uiv(this.addr,i)}function ie(e,i){e.uniform4uiv(this.addr,i)}function it(e,i,n){let r=this.cache,s=i.length,a=tI(n,s);tT(r,a)||(e.uniform1iv(this.addr,a),tR(r,a));for(let e=0;e!==s;++e)n.setTexture2D(i[e]||tA,a[e])}function ii(e,i,n){let r=this.cache,s=i.length,a=tI(n,s);tT(r,a)||(e.uniform1iv(this.addr,a),tR(r,a));for(let e=0;e!==s;++e)n.setTexture3D(i[e]||tx,a[e])}function ir(e,i,n){let r=this.cache,s=i.length,a=tI(n,s);tT(r,a)||(e.uniform1iv(this.addr,a),tR(r,a));for(let e=0;e!==s;++e)n.setTextureCube(i[e]||t_,a[e])}function is(e,i,n){let r=this.cache,s=i.length,a=tI(n,s);tT(r,a)||(e.uniform1iv(this.addr,a),tR(r,a));for(let e=0;e!==s;++e)n.setTexture2DArray(i[e]||ty,a[e])}class ia{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.setValue=function(e){switch(e){case 5126:return tB;case 35664:return tL;case 35665:return tP;case 35666:return tD;case 35674:return tN;case 35675:return tO;case 35676:return tU;case 5124:case 35670:return tk;case 35667:case 35671:return tF;case 35668:case 35672:return tz;case 35669:case 35673:return tG;case 5125:return tV;case 36294:return tj;case 36295:return tH;case 36296:return tQ;case 35678:case 36198:case 36298:case 36306:case 35682:return tW;case 35679:case 36299:case 36307:return tq;case 35680:case 36300:case 36308:case 36293:return tX;case 36289:case 36303:case 36311:case 36292:return tK}}(i.type)}}class io{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=function(e){switch(e){case 5126:return tY;case 35664:return tJ;case 35665:return tZ;case 35666:return t$;case 35674:return t0;case 35675:return t1;case 35676:return t2;case 5124:case 35670:return t3;case 35667:case 35671:return t4;case 35668:case 35672:return t5;case 35669:case 35673:return t6;case 5125:return t8;case 36294:return t7;case 36295:return t9;case 36296:return ie;case 35678:case 36198:case 36298:case 36306:case 35682:return it;case 35679:case 36299:case 36307:return ii;case 35680:case 36300:case 36308:case 36293:return ir;case 36289:case 36303:case 36311:case 36292:return is}}(i.type)}}class il{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,n){let r=this.seq;for(let s=0,a=r.length;s!==a;++s){let a=r[s];a.setValue(e,i[a.id],n)}}}let ih=/(\w+)(\])?(\[|\.)?/g;function iu(e,i){e.seq.push(i),e.map[i.id]=i}class ic{constructor(e,i){this.seq=[],this.map={};let n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){let n=e.getActiveUniform(i,r),s=e.getUniformLocation(i,n.name);!function(e,i,n){let r=e.name,s=r.length;for(ih.lastIndex=0;;){let a=ih.exec(r),o=ih.lastIndex,l=a[1],h="]"===a[2],u=a[3];if(h&&(l|=0),void 0===u||"["===u&&o+2===s){iu(n,void 0===u?new ia(l,e,i):new io(l,e,i));break}{let e=n.map[l];void 0===e&&iu(n,e=new il(l)),n=e}}}(n,s,this)}}setValue(e,i,n,r){let s=this.map[i];void 0!==s&&s.setValue(e,n,r)}setOptional(e,i,n){let r=i[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,i,n,r){for(let s=0,a=i.length;s!==a;++s){let a=i[s],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}}static seqWithValue(e,i){let n=[];for(let r=0,s=e.length;r!==s;++r){let s=e[r];s.id in i&&n.push(s)}return n}}function id(e,i,n){let r=e.createShader(i);return e.shaderSource(r,n),e.compileShader(r),r}let ip=0,im=new eE.Vkp;function ig(e,i,n){let r=e.getShaderParameter(i,e.COMPILE_STATUS),s=e.getShaderInfoLog(i).trim();if(r&&""===s)return"";let a=/ERROR: 0:(\d+)/.exec(s);if(!a)return s;{let r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+s+"\n\n"+function(e,i){let n=e.split("\n"),r=[],s=Math.max(i-6,0),a=Math.min(i+6,n.length);for(let e=s;e<a;e++){let s=e+1;r.push(`${s===i?">":" "} ${s}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(i),r)}}let iA=new eE.Pa4;function iv(e){return""!==e}function iy(e,i){let n=i.numSpotLightShadows+i.numSpotLightMaps-i.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,i.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,i.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,i.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,i.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,i.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,i.numPointLightShadows)}function ix(e,i){return e.replace(/NUM_CLIPPING_PLANES/g,i.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,i.numClippingPlanes-i.numClipIntersection)}let i_=/^[ \t]*#include +<([\w\d./]+)>/gm;function ib(e){return e.replace(i_,iw)}let iE=new Map;function iw(e,i){let n=eW[i];if(void 0===n){let e=iE.get(i);if(void 0!==e)n=eW[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',i,e);else throw Error("Can not resolve #include <"+i+">")}return ib(n)}let iM=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function iC(e){return e.replace(iM,iS)}function iS(e,i,n,r){let s="";for(let e=parseInt(i);e<parseInt(n);e++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return s}function iT(e){let i=`precision ${e.precision} float;
	precision ${e.precision} int;
	precision ${e.precision} sampler2D;
	precision ${e.precision} samplerCube;
	precision ${e.precision} sampler3D;
	precision ${e.precision} sampler2DArray;
	precision ${e.precision} sampler2DShadow;
	precision ${e.precision} samplerCubeShadow;
	precision ${e.precision} sampler2DArrayShadow;
	precision ${e.precision} isampler2D;
	precision ${e.precision} isampler3D;
	precision ${e.precision} isamplerCube;
	precision ${e.precision} isampler2DArray;
	precision ${e.precision} usampler2D;
	precision ${e.precision} usampler3D;
	precision ${e.precision} usamplerCube;
	precision ${e.precision} usampler2DArray;
	`;return"highp"===e.precision?i+="\n#define HIGH_PRECISION":"mediump"===e.precision?i+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(i+="\n#define LOW_PRECISION"),i}function iR(e,i,n,r){let s,a,o,l,h,u;let c=e.getContext(),d=n.defines,p=n.vertexShader,f=n.fragmentShader,m=(h="SHADOWMAP_TYPE_BASIC",n.shadowMapType===eE._iA?h="SHADOWMAP_TYPE_PCF":n.shadowMapType===eE.ntZ?h="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===eE.dwk&&(h="SHADOWMAP_TYPE_VSM"),h),g=function(e){let i="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case eE.fY$:case eE.vxC:i="ENVMAP_TYPE_CUBE";break;case eE.g8_:i="ENVMAP_TYPE_CUBE_UV"}return i}(n),A=(u="ENVMAP_MODE_REFLECTION",n.envMap&&n.envMapMode===eE.vxC&&(u="ENVMAP_MODE_REFRACTION"),u),v=function(e){let i="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case eE.Ns1:i="ENVMAP_BLENDING_MULTIPLY";break;case eE.qhX:i="ENVMAP_BLENDING_MIX";break;case eE.NDo:i="ENVMAP_BLENDING_ADD"}return i}(n),y=function(e){let i=e.envMapCubeUVHeight;if(null===i)return null;let n=Math.log2(i)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:1/i,maxMip:n}}(n),x=[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(iv).join("\n"),_=function(e){let i=[];for(let n in e){let r=e[n];!1!==r&&i.push("#define "+n+" "+r)}return i.join("\n")}(d),b=c.createProgram(),E=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((s=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,_].filter(iv).join("\n")).length>0&&(s+="\n"),(a=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,_].filter(iv).join("\n")).length>0&&(a+="\n")):(s=[iT(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,_,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+A:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+m:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(iv).join("\n"),a=[iT(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,_,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+g:"",n.envMap?"#define "+A:"",n.envMap?"#define "+v:"",y?"#define CUBEUV_TEXEL_WIDTH "+y.texelWidth:"",y?"#define CUBEUV_TEXEL_HEIGHT "+y.texelHeight:"",y?"#define CUBEUV_MAX_MIP "+y.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+m:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==eE.uL9?"#define TONE_MAPPING":"",n.toneMapping!==eE.uL9?eW.tonemapping_pars_fragment:"",n.toneMapping!==eE.uL9?function(e,i){let n;switch(i){case eE.EoG:n="Linear";break;case eE.CdI:n="Reinhard";break;case eE.YGz:n="Cineon";break;case eE.LY2:n="ACESFilmic";break;case eE.Bgp:n="AgX";break;case eE.ORg:n="Neutral";break;case eE.dZ3:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",i),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",eW.colorspace_pars_fragment,function(e,i){let n=function(e){eE.epp._getMatrix(im,eE.epp.workingColorSpace,e);let i=`mat3( ${im.elements.map(e=>e.toFixed(4))} )`;switch(eE.epp.getTransfer(e)){case eE.l6D:return[i,"LinearTransferOETF"];case eE.j17:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[i,"LinearTransferOETF"]}}(i);return`vec4 ${e}( vec4 value ) {
	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );
}`}("linearToOutputTexel",n.outputColorSpace),function(){eE.epp.getLuminanceCoefficients(iA);let e=iA.x.toFixed(4),i=iA.y.toFixed(4),n=iA.z.toFixed(4);return`float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( ${e}, ${i}, ${n} );
	return dot( weights, rgb );
}`}(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(iv).join("\n")),p=ix(p=iy(p=ib(p),n),n),f=ix(f=iy(f=ib(f),n),n),p=iC(p),f=iC(f),!0!==n.isRawShaderMaterial&&(E="#version 300 es\n",s=[x,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+s,a=["#define varying in",n.glslVersion===eE.LSk?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===eE.LSk?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);let w=E+s+p,M=E+a+f,C=id(c,c.VERTEX_SHADER,w),S=id(c,c.FRAGMENT_SHADER,M);function T(i){if(e.debug.checkShaderErrors){let n=c.getProgramInfoLog(b).trim(),r=c.getShaderInfoLog(C).trim(),o=c.getShaderInfoLog(S).trim(),l=!0,h=!0;if(!1===c.getProgramParameter(b,c.LINK_STATUS)){if(l=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(c,b,C,S);else{let e=ig(c,C,"vertex"),r=ig(c,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+c.getError()+" - VALIDATE_STATUS "+c.getProgramParameter(b,c.VALIDATE_STATUS)+"\n\nMaterial Name: "+i.name+"\nMaterial Type: "+i.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+r)}}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):(""===r||""===o)&&(h=!1);h&&(i.diagnostics={runnable:l,programLog:n,vertexShader:{log:r,prefix:s},fragmentShader:{log:o,prefix:a}})}c.deleteShader(C),c.deleteShader(S),o=new ic(c,b),l=function(e,i){let n={},r=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let r=e.getActiveAttrib(i,s),a=r.name,o=1;r.type===e.FLOAT_MAT2&&(o=2),r.type===e.FLOAT_MAT3&&(o=3),r.type===e.FLOAT_MAT4&&(o=4),n[a]={type:r.type,location:e.getAttribLocation(i,a),locationSize:o}}return n}(c,b)}c.attachShader(b,C),c.attachShader(b,S),void 0!==n.index0AttributeName?c.bindAttribLocation(b,0,n.index0AttributeName):!0===n.morphTargets&&c.bindAttribLocation(b,0,"position"),c.linkProgram(b),this.getUniforms=function(){return void 0===o&&T(this),o},this.getAttributes=function(){return void 0===l&&T(this),l};let R=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===R&&(R=c.getProgramParameter(b,37297)),R},this.destroy=function(){r.releaseStatesOfProgram(this),c.deleteProgram(b),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=ip++,this.cacheKey=i,this.usedTimes=1,this.program=b,this.vertexShader=C,this.fragmentShader=S,this}let iI=0;class iB{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let i=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(i),s=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(s)&&(a.add(s),s.usedTimes++),this}remove(e){for(let i of this.materialCache.get(e))i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let i=this.materialCache,n=i.get(e);return void 0===n&&(n=new Set,i.set(e,n)),n}_getShaderStage(e){let i=this.shaderCache,n=i.get(e);return void 0===n&&(n=new iL(e),i.set(e,n)),n}}class iL{constructor(e){this.id=iI++,this.code=e,this.usedTimes=0}}function iP(e,i,n,r,s,a,o){let l=new eE.S9g,h=new iB,u=new Set,c=[],d=s.logarithmicDepthBuffer,p=s.vertexTextures,f=s.precision,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(e){return(u.add(e),0===e)?"uv":`uv${e}`}return{getParameters:function(a,l,c,A,v){let y,x,_,b;let E=A.fog,w=v.geometry,M=a.isMeshStandardMaterial?A.environment:null,C=(a.isMeshStandardMaterial?n:i).get(a.envMap||M),S=C&&C.mapping===eE.g8_?C.image.height:null,T=m[a.type];null!==a.precision&&(f=s.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead.");let R=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,I=void 0!==R?R.length:0,B=0;if(void 0!==w.morphAttributes.position&&(B=1),void 0!==w.morphAttributes.normal&&(B=2),void 0!==w.morphAttributes.color&&(B=3),T){let e=eX[T];y=e.vertexShader,x=e.fragmentShader}else y=a.vertexShader,x=a.fragmentShader,h.update(a),_=h.getVertexShaderID(a),b=h.getFragmentShaderID(a);let L=e.getRenderTarget(),P=e.state.buffers.depth.getReversed(),D=!0===v.isInstancedMesh,N=!0===v.isBatchedMesh,O=!!a.map,U=!!a.matcap,k=!!C,F=!!a.aoMap,z=!!a.lightMap,G=!!a.bumpMap,V=!!a.normalMap,j=!!a.displacementMap,H=!!a.emissiveMap,Q=!!a.metalnessMap,W=!!a.roughnessMap,q=a.anisotropy>0,X=a.clearcoat>0,K=a.dispersion>0,Y=a.iridescence>0,J=a.sheen>0,Z=a.transmission>0,$=q&&!!a.anisotropyMap,ee=X&&!!a.clearcoatMap,et=X&&!!a.clearcoatNormalMap,ei=X&&!!a.clearcoatRoughnessMap,en=Y&&!!a.iridescenceMap,er=Y&&!!a.iridescenceThicknessMap,es=J&&!!a.sheenColorMap,ea=J&&!!a.sheenRoughnessMap,eo=!!a.specularMap,el=!!a.specularColorMap,eh=!!a.specularIntensityMap,eu=Z&&!!a.transmissionMap,ec=Z&&!!a.thicknessMap,ed=!!a.gradientMap,ep=!!a.alphaMap,ef=a.alphaTest>0,em=!!a.alphaHash,eg=!!a.extensions,eA=eE.uL9;a.toneMapped&&(null===L||!0===L.isXRRenderTarget)&&(eA=e.toneMapping);let ev={shaderID:T,shaderType:a.type,shaderName:a.name,vertexShader:y,fragmentShader:x,defines:a.defines,customVertexShaderID:_,customFragmentShaderID:b,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,batching:N,batchingColor:N&&null!==v._colorsTexture,instancing:D,instancingColor:D&&null!==v.instanceColor,instancingMorph:D&&null!==v.morphTexture,supportsVertexTextures:p,outputColorSpace:null===L?e.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:eE.GUF,alphaToCoverage:!!a.alphaToCoverage,map:O,matcap:U,envMap:k,envMapMode:k&&C.mapping,envMapCubeUVHeight:S,aoMap:F,lightMap:z,bumpMap:G,normalMap:V,displacementMap:p&&j,emissiveMap:H,normalMapObjectSpace:V&&a.normalMapType===eE.PA7,normalMapTangentSpace:V&&a.normalMapType===eE.IOt,metalnessMap:Q,roughnessMap:W,anisotropy:q,anisotropyMap:$,clearcoat:X,clearcoatMap:ee,clearcoatNormalMap:et,clearcoatRoughnessMap:ei,dispersion:K,iridescence:Y,iridescenceMap:en,iridescenceThicknessMap:er,sheen:J,sheenColorMap:es,sheenRoughnessMap:ea,specularMap:eo,specularColorMap:el,specularIntensityMap:eh,transmission:Z,transmissionMap:eu,thicknessMap:ec,gradientMap:ed,opaque:!1===a.transparent&&a.blending===eE.bdR&&!1===a.alphaToCoverage,alphaMap:ep,alphaTest:ef,alphaHash:em,combine:a.combine,mapUv:O&&g(a.map.channel),aoMapUv:F&&g(a.aoMap.channel),lightMapUv:z&&g(a.lightMap.channel),bumpMapUv:G&&g(a.bumpMap.channel),normalMapUv:V&&g(a.normalMap.channel),displacementMapUv:j&&g(a.displacementMap.channel),emissiveMapUv:H&&g(a.emissiveMap.channel),metalnessMapUv:Q&&g(a.metalnessMap.channel),roughnessMapUv:W&&g(a.roughnessMap.channel),anisotropyMapUv:$&&g(a.anisotropyMap.channel),clearcoatMapUv:ee&&g(a.clearcoatMap.channel),clearcoatNormalMapUv:et&&g(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ei&&g(a.clearcoatRoughnessMap.channel),iridescenceMapUv:en&&g(a.iridescenceMap.channel),iridescenceThicknessMapUv:er&&g(a.iridescenceThicknessMap.channel),sheenColorMapUv:es&&g(a.sheenColorMap.channel),sheenRoughnessMapUv:ea&&g(a.sheenRoughnessMap.channel),specularMapUv:eo&&g(a.specularMap.channel),specularColorMapUv:el&&g(a.specularColorMap.channel),specularIntensityMapUv:eh&&g(a.specularIntensityMap.channel),transmissionMapUv:eu&&g(a.transmissionMap.channel),thicknessMapUv:ec&&g(a.thicknessMap.channel),alphaMapUv:ep&&g(a.alphaMap.channel),vertexTangents:!!w.attributes.tangent&&(V||q),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!w.attributes.color&&4===w.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!w.attributes.uv&&(O||ep),fog:!!E,useFog:!0===a.fog,fogExp2:!!E&&E.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:d,reverseDepthBuffer:P,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==w.morphAttributes.position,morphNormals:void 0!==w.morphAttributes.normal,morphColors:void 0!==w.morphAttributes.color,morphTargetsCount:I,morphTextureStride:B,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numLightProbes:l.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:eA,decodeVideoTexture:O&&!0===a.map.isVideoTexture&&eE.epp.getTransfer(a.map.colorSpace)===eE.j17,decodeVideoTextureEmissive:H&&!0===a.emissiveMap.isVideoTexture&&eE.epp.getTransfer(a.emissiveMap.colorSpace)===eE.j17,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===eE.ehD,flipSided:a.side===eE._Li,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:eg&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(eg&&!0===a.extensions.multiDraw||N)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return ev.vertexUv1s=u.has(1),ev.vertexUv2s=u.has(2),ev.vertexUv3s=u.has(3),u.clear(),ev},getProgramCacheKey:function(i){var n,r,s,a;let o=[];if(i.shaderID?o.push(i.shaderID):(o.push(i.customVertexShaderID),o.push(i.customFragmentShaderID)),void 0!==i.defines)for(let e in i.defines)o.push(e),o.push(i.defines[e]);return!1===i.isRawShaderMaterial&&(n=o,r=i,n.push(r.precision),n.push(r.outputColorSpace),n.push(r.envMapMode),n.push(r.envMapCubeUVHeight),n.push(r.mapUv),n.push(r.alphaMapUv),n.push(r.lightMapUv),n.push(r.aoMapUv),n.push(r.bumpMapUv),n.push(r.normalMapUv),n.push(r.displacementMapUv),n.push(r.emissiveMapUv),n.push(r.metalnessMapUv),n.push(r.roughnessMapUv),n.push(r.anisotropyMapUv),n.push(r.clearcoatMapUv),n.push(r.clearcoatNormalMapUv),n.push(r.clearcoatRoughnessMapUv),n.push(r.iridescenceMapUv),n.push(r.iridescenceThicknessMapUv),n.push(r.sheenColorMapUv),n.push(r.sheenRoughnessMapUv),n.push(r.specularMapUv),n.push(r.specularColorMapUv),n.push(r.specularIntensityMapUv),n.push(r.transmissionMapUv),n.push(r.thicknessMapUv),n.push(r.combine),n.push(r.fogExp2),n.push(r.sizeAttenuation),n.push(r.morphTargetsCount),n.push(r.morphAttributeCount),n.push(r.numDirLights),n.push(r.numPointLights),n.push(r.numSpotLights),n.push(r.numSpotLightMaps),n.push(r.numHemiLights),n.push(r.numRectAreaLights),n.push(r.numDirLightShadows),n.push(r.numPointLightShadows),n.push(r.numSpotLightShadows),n.push(r.numSpotLightShadowsWithMaps),n.push(r.numLightProbes),n.push(r.shadowMapType),n.push(r.toneMapping),n.push(r.numClippingPlanes),n.push(r.numClipIntersection),n.push(r.depthPacking),s=o,a=i,l.disableAll(),a.supportsVertexTextures&&l.enable(0),a.instancing&&l.enable(1),a.instancingColor&&l.enable(2),a.instancingMorph&&l.enable(3),a.matcap&&l.enable(4),a.envMap&&l.enable(5),a.normalMapObjectSpace&&l.enable(6),a.normalMapTangentSpace&&l.enable(7),a.clearcoat&&l.enable(8),a.iridescence&&l.enable(9),a.alphaTest&&l.enable(10),a.vertexColors&&l.enable(11),a.vertexAlphas&&l.enable(12),a.vertexUv1s&&l.enable(13),a.vertexUv2s&&l.enable(14),a.vertexUv3s&&l.enable(15),a.vertexTangents&&l.enable(16),a.anisotropy&&l.enable(17),a.alphaHash&&l.enable(18),a.batching&&l.enable(19),a.dispersion&&l.enable(20),a.batchingColor&&l.enable(21),s.push(l.mask),l.disableAll(),a.fog&&l.enable(0),a.useFog&&l.enable(1),a.flatShading&&l.enable(2),a.logarithmicDepthBuffer&&l.enable(3),a.reverseDepthBuffer&&l.enable(4),a.skinning&&l.enable(5),a.morphTargets&&l.enable(6),a.morphNormals&&l.enable(7),a.morphColors&&l.enable(8),a.premultipliedAlpha&&l.enable(9),a.shadowMapEnabled&&l.enable(10),a.doubleSided&&l.enable(11),a.flipSided&&l.enable(12),a.useDepthPacking&&l.enable(13),a.dithering&&l.enable(14),a.transmission&&l.enable(15),a.sheen&&l.enable(16),a.opaque&&l.enable(17),a.pointsUvs&&l.enable(18),a.decodeVideoTexture&&l.enable(19),a.decodeVideoTextureEmissive&&l.enable(20),a.alphaToCoverage&&l.enable(21),s.push(l.mask),o.push(e.outputColorSpace)),o.push(i.customProgramCacheKey),o.join()},getUniforms:function(e){let i;let n=m[e.type];if(n){let e=eX[n];i=eE.rDY.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(i,n){let r;for(let e=0,i=c.length;e<i;e++){let i=c[e];if(i.cacheKey===n){r=i,++r.usedTimes;break}}return void 0===r&&(r=new iR(e,n,i,a),c.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){let i=c.indexOf(e);c[i]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){h.remove(e)},programs:c,dispose:function(){h.dispose()}}}function iD(){let e=new WeakMap;return{has:function(i){return e.has(i)},get:function(i){let n=e.get(i);return void 0===n&&(n={},e.set(i,n)),n},remove:function(i){e.delete(i)},update:function(i,n,r){e.get(i)[n]=r},dispose:function(){e=new WeakMap}}}function iN(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.material.id!==i.material.id?e.material.id-i.material.id:e.z!==i.z?e.z-i.z:e.id-i.id}function iO(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.z!==i.z?i.z-e.z:e.id-i.id}function iU(){let e=[],i=0,n=[],r=[],s=[];function a(n,r,s,a,o,l){let h=e[i];return void 0===h?(h={id:n.id,object:n,geometry:r,material:s,groupOrder:a,renderOrder:n.renderOrder,z:o,group:l},e[i]=h):(h.id=n.id,h.object=n,h.geometry=r,h.material=s,h.groupOrder=a,h.renderOrder=n.renderOrder,h.z=o,h.group=l),i++,h}return{opaque:n,transmissive:r,transparent:s,init:function(){i=0,n.length=0,r.length=0,s.length=0},push:function(e,i,o,l,h,u){let c=a(e,i,o,l,h,u);o.transmission>0?r.push(c):!0===o.transparent?s.push(c):n.push(c)},unshift:function(e,i,o,l,h,u){let c=a(e,i,o,l,h,u);o.transmission>0?r.unshift(c):!0===o.transparent?s.unshift(c):n.unshift(c)},finish:function(){for(let n=i,r=e.length;n<r;n++){let i=e[n];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.group=null}},sort:function(e,i){n.length>1&&n.sort(e||iN),r.length>1&&r.sort(i||iO),s.length>1&&s.sort(i||iO)}}}function ik(){let e=new WeakMap;return{get:function(i,n){let r;let s=e.get(i);return void 0===s?(r=new iU,e.set(i,[r])):n>=s.length?(r=new iU,s.push(r)):r=s[n],r},dispose:function(){e=new WeakMap}}}function iF(){let e={};return{get:function(i){let n;if(void 0!==e[i.id])return e[i.id];switch(i.type){case"DirectionalLight":n={direction:new eE.Pa4,color:new eE.Ilk};break;case"SpotLight":n={position:new eE.Pa4,direction:new eE.Pa4,color:new eE.Ilk,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new eE.Pa4,color:new eE.Ilk,distance:0,decay:0};break;case"HemisphereLight":n={direction:new eE.Pa4,skyColor:new eE.Ilk,groundColor:new eE.Ilk};break;case"RectAreaLight":n={color:new eE.Ilk,position:new eE.Pa4,halfWidth:new eE.Pa4,halfHeight:new eE.Pa4}}return e[i.id]=n,n}}}let iz=0;function iG(e,i){return 2*!!i.castShadow-2*!!e.castShadow+ +!!i.map-+!!e.map}function iV(e){let i=new iF,n=function(){let e={};return{get:function(i){let n;if(void 0!==e[i.id])return e[i.id];switch(i.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new eE.FM8};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new eE.FM8,shadowCameraNear:1,shadowCameraFar:1e3}}return e[i.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new eE.Pa4);let s=new eE.Pa4,a=new eE.yGw,o=new eE.yGw;return{setup:function(s){let a=0,o=0,l=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let h=0,u=0,c=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,y=0;s.sort(iG);for(let e=0,x=s.length;e<x;e++){let x=s[e],_=x.color,b=x.intensity,E=x.distance,w=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)a+=_.r*b,o+=_.g*b,l+=_.b*b;else if(x.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(x.sh.coefficients[e],b);y++}else if(x.isDirectionalLight){let e=i.get(x);if(e.color.copy(x.color).multiplyScalar(x.intensity),x.castShadow){let e=x.shadow,i=n.get(x);i.shadowIntensity=e.intensity,i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=w,r.directionalShadowMatrix[h]=x.shadow.matrix,f++}r.directional[h]=e,h++}else if(x.isSpotLight){let e=i.get(x);e.position.setFromMatrixPosition(x.matrixWorld),e.color.copy(_).multiplyScalar(b),e.distance=E,e.coneCos=Math.cos(x.angle),e.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),e.decay=x.decay,r.spot[c]=e;let s=x.shadow;if(x.map&&(r.spotLightMap[A]=x.map,A++,s.updateMatrices(x),x.castShadow&&v++),r.spotLightMatrix[c]=s.matrix,x.castShadow){let e=n.get(x);e.shadowIntensity=s.intensity,e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[c]=e,r.spotShadowMap[c]=w,g++}c++}else if(x.isRectAreaLight){let e=i.get(x);e.color.copy(_).multiplyScalar(b),e.halfWidth.set(.5*x.width,0,0),e.halfHeight.set(0,.5*x.height,0),r.rectArea[d]=e,d++}else if(x.isPointLight){let e=i.get(x);if(e.color.copy(x.color).multiplyScalar(x.intensity),e.distance=x.distance,e.decay=x.decay,x.castShadow){let e=x.shadow,i=n.get(x);i.shadowIntensity=e.intensity,i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=w,r.pointShadowMatrix[u]=x.shadow.matrix,m++}r.point[u]=e,u++}else if(x.isHemisphereLight){let e=i.get(x);e.skyColor.copy(x.color).multiplyScalar(b),e.groundColor.copy(x.groundColor).multiplyScalar(b),r.hemi[p]=e,p++}}d>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=eq.LTC_FLOAT_1,r.rectAreaLTC2=eq.LTC_FLOAT_2):(r.rectAreaLTC1=eq.LTC_HALF_1,r.rectAreaLTC2=eq.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=l;let x=r.hash;(x.directionalLength!==h||x.pointLength!==u||x.spotLength!==c||x.rectAreaLength!==d||x.hemiLength!==p||x.numDirectionalShadows!==f||x.numPointShadows!==m||x.numSpotShadows!==g||x.numSpotMaps!==A||x.numLightProbes!==y)&&(r.directional.length=h,r.spot.length=c,r.rectArea.length=d,r.point.length=u,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=m,r.spotLightMatrix.length=g+A-v,r.spotLightMap.length=A,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=y,x.directionalLength=h,x.pointLength=u,x.spotLength=c,x.rectAreaLength=d,x.hemiLength=p,x.numDirectionalShadows=f,x.numPointShadows=m,x.numSpotShadows=g,x.numSpotMaps=A,x.numLightProbes=y,r.version=iz++)},setupView:function(e,i){let n=0,l=0,h=0,u=0,c=0,d=i.matrixWorldInverse;for(let i=0,p=e.length;i<p;i++){let p=e[i];if(p.isDirectionalLight){let e=r.directional[n];e.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(d),n++}else if(p.isSpotLight){let e=r.spot[h];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(d),h++}else if(p.isRectAreaLight){let e=r.rectArea[u];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(d),o.identity(),a.copy(p.matrixWorld),a.premultiply(d),o.extractRotation(a),e.halfWidth.set(.5*p.width,0,0),e.halfHeight.set(0,.5*p.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),u++}else if(p.isPointLight){let e=r.point[l];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(d),l++}else if(p.isHemisphereLight){let e=r.hemi[c];e.direction.setFromMatrixPosition(p.matrixWorld),e.direction.transformDirection(d),c++}}},state:r}}function ij(e){let i=new iV(e),n=[],r=[],s={lightsArray:n,shadowsArray:r,camera:null,lights:i,transmissionRenderTarget:{}};return{init:function(e){s.camera=e,n.length=0,r.length=0},state:s,setupLights:function(){i.setup(n)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function iH(e){let i=new WeakMap;return{get:function(n,r=0){let s;let a=i.get(n);return void 0===a?(s=new ij(e),i.set(n,[s])):r>=a.length?(s=new ij(e),a.push(s)):s=a[r],s},dispose:function(){i=new WeakMap}}}function iQ(e,i,n){let r=new eE.iWj,s=new eE.FM8,a=new eE.FM8,o=new eE.Ltg,l=new eE.lRF({depthPacking:eE.mSO}),h=new eE.Lun,u={},c=n.maxTextureSize,d={[eE.Wl3]:eE._Li,[eE._Li]:eE.Wl3,[eE.ehD]:eE.ehD},p=new eE.jyz({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new eE.FM8},radius:{value:4}},vertexShader:"void main() {\n	gl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n	const float samples = float( VSM_SAMPLES );\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=p.clone();f.defines.HORIZONTAL_PASS=1;let m=new eE.u9r;m.setAttribute("position",new eE.TlE(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new eE.Kj0(m,p),A=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=eE._iA;let v=this.type;function y(i,n,r,s){let a=null,o=!0===r.isPointLight?i.customDistanceMaterial:i.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===r.isPointLight?h:l,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){let e=a.uuid,i=n.uuid,r=u[e];void 0===r&&(r={},u[e]=r);let s=r[i];void 0===s&&(s=a.clone(),r[i]=s,n.addEventListener("dispose",x)),a=s}return a.visible=n.visible,a.wireframe=n.wireframe,s===eE.dwk?a.side=null!==n.shadowSide?n.shadowSide:n.side:a.side=null!==n.shadowSide?n.shadowSide:d[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=r),a}function x(e){for(let i in e.target.removeEventListener("dispose",x),u){let n=u[i],r=e.target.uuid;r in n&&(n[r].dispose(),delete n[r])}}this.render=function(n,l,h){if(!1===A.enabled||!1===A.autoUpdate&&!1===A.needsUpdate||0===n.length)return;let u=e.getRenderTarget(),d=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),x=e.state;x.setBlending(eE.jFi),x.buffers.color.setClear(1,1,1,1),x.buffers.depth.setTest(!0),x.setScissorTest(!1);let _=v!==eE.dwk&&this.type===eE.dwk,b=v===eE.dwk&&this.type!==eE.dwk;for(let u=0,d=n.length;u<d;u++){let d=n[u],m=d.shadow;if(void 0===m){console.warn("THREE.WebGLShadowMap:",d,"has no shadow.");continue}if(!1===m.autoUpdate&&!1===m.needsUpdate)continue;s.copy(m.mapSize);let A=m.getFrameExtents();if(s.multiply(A),a.copy(m.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(a.x=Math.floor(c/A.x),s.x=a.x*A.x,m.mapSize.x=a.x),s.y>c&&(a.y=Math.floor(c/A.y),s.y=a.y*A.y,m.mapSize.y=a.y)),null===m.map||!0===_||!0===b){let e=this.type!==eE.dwk?{minFilter:eE.TyD,magFilter:eE.TyD}:{};null!==m.map&&m.map.dispose(),m.map=new eE.dd2(s.x,s.y,e),m.map.texture.name=d.name+".shadowMap",m.camera.updateProjectionMatrix()}e.setRenderTarget(m.map),e.clear();let v=m.getViewportCount();for(let n=0;n<v;n++){let s=m.getViewport(n);o.set(a.x*s.x,a.y*s.y,a.x*s.z,a.y*s.w),x.viewport(o),m.updateMatrices(d,n),r=m.getFrustum(),function n(s,a,o,l,h){if(!1===s.visible)return;if(s.layers.test(a.layers)&&(s.isMesh||s.isLine||s.isPoints)&&(s.castShadow||s.receiveShadow&&h===eE.dwk)&&(!s.frustumCulled||r.intersectsObject(s))){s.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,s.matrixWorld);let n=i.update(s),r=s.material;if(Array.isArray(r)){let i=n.groups;for(let u=0,c=i.length;u<c;u++){let c=i[u],d=r[c.materialIndex];if(d&&d.visible){let i=y(s,d,l,h);s.onBeforeShadow(e,s,a,o,n,i,c),e.renderBufferDirect(o,null,n,i,s,c),s.onAfterShadow(e,s,a,o,n,i,c)}}}else if(r.visible){let i=y(s,r,l,h);s.onBeforeShadow(e,s,a,o,n,i,null),e.renderBufferDirect(o,null,n,i,s,null),s.onAfterShadow(e,s,a,o,n,i,null)}}let u=s.children;for(let e=0,i=u.length;e<i;e++)n(u[e],a,o,l,h)}(l,h,m.camera,d,this.type)}!0!==m.isPointLightShadow&&this.type===eE.dwk&&function(n,r){let a=i.update(g);p.defines.VSM_SAMPLES!==n.blurSamples&&(p.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,p.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new eE.dd2(s.x,s.y)),p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,p,g,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,f,g,null)}(m,h),m.needsUpdate=!1}v=this.type,A.needsUpdate=!1,e.setRenderTarget(u,d,m)}}let iW={[eE.BVF]:eE.Se2,[eE.Zr5]:eE.w$m,[eE.eD]:eE.M6v,[eE.vCF]:eE.ksN,[eE.Se2]:eE.BVF,[eE.w$m]:eE.Zr5,[eE.M6v]:eE.eD,[eE.ksN]:eE.vCF};function iq(e,i){let n=new function(){let i=!1,n=new eE.Ltg,r=null,s=new eE.Ltg(0,0,0,0);return{setMask:function(n){r===n||i||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){i=e},setClear:function(i,r,a,o,l){!0===l&&(i*=o,r*=o,a*=o),n.set(i,r,a,o),!1===s.equals(n)&&(e.clearColor(i,r,a,o),s.copy(n))},reset:function(){i=!1,r=null,s.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,s=null,a=null,o=null;return{setReversed:function(e){if(r!==e){let e=i.get("EXT_clip_control");r?e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT):e.clipControlEXT(e.LOWER_LEFT_EXT,e.NEGATIVE_ONE_TO_ONE_EXT);let n=o;o=null,this.setClear(n)}r=e},getReversed:function(){return r},setTest:function(i){i?G(e.DEPTH_TEST):V(e.DEPTH_TEST)},setMask:function(i){s===i||n||(e.depthMask(i),s=i)},setFunc:function(i){if(r&&(i=iW[i]),a!==i){switch(i){case eE.BVF:e.depthFunc(e.NEVER);break;case eE.Se2:e.depthFunc(e.ALWAYS);break;case eE.Zr5:e.depthFunc(e.LESS);break;case eE.vCF:e.depthFunc(e.LEQUAL);break;case eE.eD:e.depthFunc(e.EQUAL);break;case eE.ksN:e.depthFunc(e.GEQUAL);break;case eE.w$m:e.depthFunc(e.GREATER);break;case eE.M6v:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}a=i}},setLocked:function(e){n=e},setClear:function(i){o!==i&&(r&&(i=1-i),e.clearDepth(i),o=i)},reset:function(){n=!1,s=null,a=null,o=null,r=!1}}},s=new function(){let i=!1,n=null,r=null,s=null,a=null,o=null,l=null,h=null,u=null;return{setTest:function(n){i||(n?G(e.STENCIL_TEST):V(e.STENCIL_TEST))},setMask:function(r){n===r||i||(e.stencilMask(r),n=r)},setFunc:function(i,n,o){(r!==i||s!==n||a!==o)&&(e.stencilFunc(i,n,o),r=i,s=n,a=o)},setOp:function(i,n,r){(o!==i||l!==n||h!==r)&&(e.stencilOp(i,n,r),o=i,l=n,h=r)},setLocked:function(e){i=e},setClear:function(i){u!==i&&(e.clearStencil(i),u=i)},reset:function(){i=!1,n=null,r=null,s=null,a=null,o=null,l=null,h=null,u=null}}},a=new WeakMap,o=new WeakMap,l={},h={},u=new WeakMap,c=[],d=null,p=!1,f=null,m=null,g=null,A=null,v=null,y=null,x=null,_=new eE.Ilk(0,0,0),b=0,E=!1,w=null,M=null,C=null,S=null,T=null,R=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),I=!1,B=0,L=e.getParameter(e.VERSION);-1!==L.indexOf("WebGL")?I=parseFloat(/^WebGL (\d)/.exec(L)[1])>=1:-1!==L.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(L)[1])>=2);let P=null,D={},N=e.getParameter(e.SCISSOR_BOX),O=e.getParameter(e.VIEWPORT),U=new eE.Ltg().fromArray(N),k=new eE.Ltg().fromArray(O);function F(i,n,r,s){let a=new Uint8Array(4),o=e.createTexture();e.bindTexture(i,o),e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<r;o++)i===e.TEXTURE_3D||i===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}let z={};function G(i){!0!==l[i]&&(e.enable(i),l[i]=!0)}function V(i){!1!==l[i]&&(e.disable(i),l[i]=!1)}z[e.TEXTURE_2D]=F(e.TEXTURE_2D,e.TEXTURE_2D,1),z[e.TEXTURE_CUBE_MAP]=F(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),z[e.TEXTURE_2D_ARRAY]=F(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),z[e.TEXTURE_3D]=F(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),s.setClear(0),G(e.DEPTH_TEST),r.setFunc(eE.vCF),W(!1),q(eE.tm_),G(e.CULL_FACE),Q(eE.jFi);let j={[eE.bGH]:e.FUNC_ADD,[eE.Wbm]:e.FUNC_SUBTRACT,[eE.rOj]:e.FUNC_REVERSE_SUBTRACT};j[eE.r_]=e.MIN,j[eE.Sm8]=e.MAX;let H={[eE.c8b]:e.ZERO,[eE.ghN]:e.ONE,[eE.KhW]:e.SRC_COLOR,[eE.k74]:e.SRC_ALPHA,[eE.RlZ]:e.SRC_ALPHA_SATURATE,[eE.Vdb]:e.DST_COLOR,[eE.fSK]:e.DST_ALPHA,[eE.iWC]:e.ONE_MINUS_SRC_COLOR,[eE.LgZ]:e.ONE_MINUS_SRC_ALPHA,[eE.Wpd]:e.ONE_MINUS_DST_COLOR,[eE.Hy8]:e.ONE_MINUS_DST_ALPHA,[eE._wr]:e.CONSTANT_COLOR,[eE.Cy]:e.ONE_MINUS_CONSTANT_COLOR,[eE.jes]:e.CONSTANT_ALPHA,[eE.NKc]:e.ONE_MINUS_CONSTANT_ALPHA};function Q(i,n,r,s,a,o,l,h,u,c){if(i===eE.jFi){!0===p&&(V(e.BLEND),p=!1);return}if(!1===p&&(G(e.BLEND),p=!0),i!==eE.Xaj){if(i!==f||c!==E){if((m!==eE.bGH||v!==eE.bGH)&&(e.blendEquation(e.FUNC_ADD),m=eE.bGH,v=eE.bGH),c)switch(i){case eE.bdR:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case eE.WMw:e.blendFunc(e.ONE,e.ONE);break;case eE.N4l:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case eE.M5h:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",i)}else switch(i){case eE.bdR:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case eE.WMw:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case eE.N4l:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case eE.M5h:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",i)}g=null,A=null,y=null,x=null,_.set(0,0,0),b=0,f=i,E=c}return}a=a||n,o=o||r,l=l||s,(n!==m||a!==v)&&(e.blendEquationSeparate(j[n],j[a]),m=n,v=a),(r!==g||s!==A||o!==y||l!==x)&&(e.blendFuncSeparate(H[r],H[s],H[o],H[l]),g=r,A=s,y=o,x=l),(!1===h.equals(_)||u!==b)&&(e.blendColor(h.r,h.g,h.b,u),_.copy(h),b=u),f=i,E=!1}function W(i){w!==i&&(i?e.frontFace(e.CW):e.frontFace(e.CCW),w=i)}function q(i){i!==eE.PeU?(G(e.CULL_FACE),i!==M&&(i===eE.tm_?e.cullFace(e.BACK):i===eE.S2y?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):V(e.CULL_FACE),M=i}function X(i,n,r){i?(G(e.POLYGON_OFFSET_FILL),(S!==n||T!==r)&&(e.polygonOffset(n,r),S=n,T=r)):V(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:s},enable:G,disable:V,bindFramebuffer:function(i,n){return h[i]!==n&&(e.bindFramebuffer(i,n),h[i]=n,i===e.DRAW_FRAMEBUFFER&&(h[e.FRAMEBUFFER]=n),i===e.FRAMEBUFFER&&(h[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(i,n){let r=c,s=!1;if(i){void 0===(r=u.get(n))&&(r=[],u.set(n,r));let a=i.textures;if(r.length!==a.length||r[0]!==e.COLOR_ATTACHMENT0){for(let i=0,n=a.length;i<n;i++)r[i]=e.COLOR_ATTACHMENT0+i;r.length=a.length,s=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,s=!0);s&&e.drawBuffers(r)},useProgram:function(i){return d!==i&&(e.useProgram(i),d=i,!0)},setBlending:Q,setMaterial:function(i,a){i.side===eE.ehD?V(e.CULL_FACE):G(e.CULL_FACE);let o=i.side===eE._Li;a&&(o=!o),W(o),i.blending===eE.bdR&&!1===i.transparent?Q(eE.jFi):Q(i.blending,i.blendEquation,i.blendSrc,i.blendDst,i.blendEquationAlpha,i.blendSrcAlpha,i.blendDstAlpha,i.blendColor,i.blendAlpha,i.premultipliedAlpha),r.setFunc(i.depthFunc),r.setTest(i.depthTest),r.setMask(i.depthWrite),n.setMask(i.colorWrite);let l=i.stencilWrite;s.setTest(l),l&&(s.setMask(i.stencilWriteMask),s.setFunc(i.stencilFunc,i.stencilRef,i.stencilFuncMask),s.setOp(i.stencilFail,i.stencilZFail,i.stencilZPass)),X(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits),!0===i.alphaToCoverage?G(e.SAMPLE_ALPHA_TO_COVERAGE):V(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:q,setLineWidth:function(i){i!==C&&(I&&e.lineWidth(i),C=i)},setPolygonOffset:X,setScissorTest:function(i){i?G(e.SCISSOR_TEST):V(e.SCISSOR_TEST)},activeTexture:function(i){void 0===i&&(i=e.TEXTURE0+R-1),P!==i&&(e.activeTexture(i),P=i)},bindTexture:function(i,n,r){void 0===r&&(r=null===P?e.TEXTURE0+R-1:P);let s=D[r];void 0===s&&(s={type:void 0,texture:void 0},D[r]=s),(s.type!==i||s.texture!==n)&&(P!==r&&(e.activeTexture(r),P=r),e.bindTexture(i,n||z[i]),s.type=i,s.texture=n)},unbindTexture:function(){let i=D[P];void 0!==i&&void 0!==i.type&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(i,n){let r=o.get(n);void 0===r&&(r=new WeakMap,o.set(n,r));let s=r.get(i);void 0===s&&(s=e.getUniformBlockIndex(n,i.name),r.set(i,s))},uniformBlockBinding:function(i,n){let r=o.get(n).get(i);a.get(n)!==r&&(e.uniformBlockBinding(n,r,i.__bindingPointIndex),a.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(i){!1===U.equals(i)&&(e.scissor(i.x,i.y,i.z,i.w),U.copy(i))},viewport:function(i){!1===k.equals(i)&&(e.viewport(i.x,i.y,i.z,i.w),k.copy(i))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),r.setReversed(!1),e.clearDepth(1),e.stencilMask(0xffffffff),e.stencilFunc(e.ALWAYS,0,0xffffffff),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),l={},P=null,D={},h={},u=new WeakMap,c=[],d=null,p=!1,f=null,m=null,g=null,A=null,v=null,y=null,x=null,_=new eE.Ilk(0,0,0),b=0,E=!1,w=null,M=null,C=null,S=null,T=null,U.set(0,0,e.canvas.width,e.canvas.height),k.set(0,0,e.canvas.width,e.canvas.height),n.reset(),r.reset(),s.reset()}}}function iX(e,i,n,r,s,a,o){let l;let h=i.has("WEBGL_multisampled_render_to_texture")?i.get("WEBGL_multisampled_render_to_texture"):null,u="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new eE.FM8,d=new WeakMap,p=new WeakMap,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,i){return f?new OffscreenCanvas(e,i):(0,eE.cac)("canvas")}function g(e,i,n){let r=1,s=G(e);if((s.width>n||s.height>n)&&(r=n/Math.max(s.width,s.height)),r<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){let n=Math.floor(r*s.width),a=Math.floor(r*s.height);void 0===l&&(l=m(n,a));let o=i?m(n,a):l;return o.width=n,o.height=a,o.getContext("2d").drawImage(e,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+s.width+"x"+s.height+") to ("+n+"x"+a+")."),o}"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+s.width+"x"+s.height+").")}return e}function A(e){return e.generateMipmaps}function v(i){e.generateMipmap(i)}function y(n,r,s,a,o=!1){if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=r;if(r===e.RED&&(s===e.FLOAT&&(l=e.R32F),s===e.HALF_FLOAT&&(l=e.R16F),s===e.UNSIGNED_BYTE&&(l=e.R8)),r===e.RED_INTEGER&&(s===e.UNSIGNED_BYTE&&(l=e.R8UI),s===e.UNSIGNED_SHORT&&(l=e.R16UI),s===e.UNSIGNED_INT&&(l=e.R32UI),s===e.BYTE&&(l=e.R8I),s===e.SHORT&&(l=e.R16I),s===e.INT&&(l=e.R32I)),r===e.RG&&(s===e.FLOAT&&(l=e.RG32F),s===e.HALF_FLOAT&&(l=e.RG16F),s===e.UNSIGNED_BYTE&&(l=e.RG8)),r===e.RG_INTEGER&&(s===e.UNSIGNED_BYTE&&(l=e.RG8UI),s===e.UNSIGNED_SHORT&&(l=e.RG16UI),s===e.UNSIGNED_INT&&(l=e.RG32UI),s===e.BYTE&&(l=e.RG8I),s===e.SHORT&&(l=e.RG16I),s===e.INT&&(l=e.RG32I)),r===e.RGB_INTEGER&&(s===e.UNSIGNED_BYTE&&(l=e.RGB8UI),s===e.UNSIGNED_SHORT&&(l=e.RGB16UI),s===e.UNSIGNED_INT&&(l=e.RGB32UI),s===e.BYTE&&(l=e.RGB8I),s===e.SHORT&&(l=e.RGB16I),s===e.INT&&(l=e.RGB32I)),r===e.RGBA_INTEGER&&(s===e.UNSIGNED_BYTE&&(l=e.RGBA8UI),s===e.UNSIGNED_SHORT&&(l=e.RGBA16UI),s===e.UNSIGNED_INT&&(l=e.RGBA32UI),s===e.BYTE&&(l=e.RGBA8I),s===e.SHORT&&(l=e.RGBA16I),s===e.INT&&(l=e.RGBA32I)),r===e.RGB&&s===e.UNSIGNED_INT_5_9_9_9_REV&&(l=e.RGB9_E5),r===e.RGBA){let i=o?eE.l6D:eE.epp.getTransfer(a);s===e.FLOAT&&(l=e.RGBA32F),s===e.HALF_FLOAT&&(l=e.RGBA16F),s===e.UNSIGNED_BYTE&&(l=i===eE.j17?e.SRGB8_ALPHA8:e.RGBA8),s===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),s===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return(l===e.R16F||l===e.R32F||l===e.RG16F||l===e.RG32F||l===e.RGBA16F||l===e.RGBA32F)&&i.get("EXT_color_buffer_float"),l}function x(i,n){let r;return i?null===n||n===eE.JQ4||n===eE.wJv?r=e.DEPTH24_STENCIL8:n===eE.VzW?r=e.DEPTH32F_STENCIL8:n===eE.LsT&&(r=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===eE.JQ4||n===eE.wJv?r=e.DEPTH_COMPONENT24:n===eE.VzW?r=e.DEPTH_COMPONENT32F:n===eE.LsT&&(r=e.DEPTH_COMPONENT16),r}function _(e,i){return!0===A(e)||e.isFramebufferTexture&&e.minFilter!==eE.TyD&&e.minFilter!==eE.wem?Math.log2(Math.max(i.width,i.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?i.mipmaps.length:1}function b(e){let i=e.target;i.removeEventListener("dispose",b),function(e){let i=r.get(e);if(void 0===i.__webglInit)return;let n=e.source,s=p.get(n);if(s){let r=s[i.__cacheKey];r.usedTimes--,0===r.usedTimes&&w(e),0===Object.keys(s).length&&p.delete(n)}r.remove(e)}(i),i.isVideoTexture&&d.delete(i)}function E(i){let n=i.target;n.removeEventListener("dispose",E),function(i){let n=r.get(i);if(i.depthTexture&&(i.depthTexture.dispose(),r.remove(i.depthTexture)),i.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let r=0;r<n.__webglFramebuffer[i].length;r++)e.deleteFramebuffer(n.__webglFramebuffer[i][r]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let i=0;i<n.__webglFramebuffer.length;i++)e.deleteFramebuffer(n.__webglFramebuffer[i]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let i=0;i<n.__webglColorRenderbuffer.length;i++)n.__webglColorRenderbuffer[i]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[i]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}let s=i.textures;for(let i=0,n=s.length;i<n;i++){let n=r.get(s[i]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),o.memory.textures--),r.remove(s[i])}r.remove(i)}(n)}function w(i){let n=r.get(i);e.deleteTexture(n.__webglTexture);let s=i.source,a=p.get(s);delete a[n.__cacheKey],o.memory.textures--}let M=0;function C(i,s){let a=r.get(i);if(i.isVideoTexture&&function(e){let i=o.render.frame;d.get(e)!==i&&(d.set(e,i),e.update())}(i),!1===i.isRenderTargetTexture&&i.version>0&&a.__version!==i.version){let e=i.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===e.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{L(a,i,s);return}}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+s)}let S={[eE.rpg]:e.REPEAT,[eE.uWy]:e.CLAMP_TO_EDGE,[eE.OoA]:e.MIRRORED_REPEAT},T={[eE.TyD]:e.NEAREST,[eE.YLQ]:e.NEAREST_MIPMAP_NEAREST,[eE.aH4]:e.NEAREST_MIPMAP_LINEAR,[eE.wem]:e.LINEAR,[eE.qyh]:e.LINEAR_MIPMAP_NEAREST,[eE.D1R]:e.LINEAR_MIPMAP_LINEAR},R={[eE.xoQ]:e.NEVER,[eE.T6w]:e.ALWAYS,[eE.D67]:e.LESS,[eE.M$G]:e.LEQUAL,[eE.F1y]:e.EQUAL,[eE.Jjb]:e.GEQUAL,[eE.Zen]:e.GREATER,[eE.O78]:e.NOTEQUAL};function I(n,a){if(a.type===eE.VzW&&!1===i.has("OES_texture_float_linear")&&(a.magFilter===eE.wem||a.magFilter===eE.qyh||a.magFilter===eE.aH4||a.magFilter===eE.D1R||a.minFilter===eE.wem||a.minFilter===eE.qyh||a.minFilter===eE.aH4||a.minFilter===eE.D1R)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,S[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,S[a.wrapT]),(n===e.TEXTURE_3D||n===e.TEXTURE_2D_ARRAY)&&e.texParameteri(n,e.TEXTURE_WRAP_R,S[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,T[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,T[a.minFilter]),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,R[a.compareFunction])),!0===i.has("EXT_texture_filter_anisotropic")&&a.magFilter!==eE.TyD&&(a.minFilter===eE.aH4||a.minFilter===eE.D1R)&&(a.type!==eE.VzW||!1!==i.has("OES_texture_float_linear"))&&(a.anisotropy>1||r.get(a).__currentAnisotropy)){let o=i.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,s.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}function B(i,n){let r=!1;void 0===i.__webglInit&&(i.__webglInit=!0,n.addEventListener("dispose",b));let s=n.source,a=p.get(s);void 0===a&&(a={},p.set(s,a));let l=function(e){let i=[];return i.push(e.wrapS),i.push(e.wrapT),i.push(e.wrapR||0),i.push(e.magFilter),i.push(e.minFilter),i.push(e.anisotropy),i.push(e.internalFormat),i.push(e.format),i.push(e.type),i.push(e.generateMipmaps),i.push(e.premultiplyAlpha),i.push(e.flipY),i.push(e.unpackAlignment),i.push(e.colorSpace),i.join()}(n);if(l!==i.__cacheKey){void 0===a[l]&&(a[l]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[l].usedTimes++;let s=a[i.__cacheKey];void 0!==s&&(a[i.__cacheKey].usedTimes--,0===s.usedTimes&&w(n)),i.__cacheKey=l,i.__webglTexture=a[l].texture}return r}function L(i,o,l){let h=e.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(h=e.TEXTURE_2D_ARRAY),o.isData3DTexture&&(h=e.TEXTURE_3D);let u=B(i,o),c=o.source;n.bindTexture(h,i.__webglTexture,e.TEXTURE0+l);let d=r.get(c);if(c.version!==d.__version||!0===u){let i;n.activeTexture(e.TEXTURE0+l);let r=eE.epp.getPrimaries(eE.epp.workingColorSpace),p=o.colorSpace===eE.aCh?null:eE.epp.getPrimaries(o.colorSpace),f=o.colorSpace===eE.aCh||r===p?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);let m=g(o.image,!1,s.maxTextureSize);m=z(o,m);let b=a.convert(o.format,o.colorSpace),E=a.convert(o.type),w=y(o.internalFormat,b,E,o.colorSpace,o.isVideoTexture);I(h,o);let M=o.mipmaps,C=!0!==o.isVideoTexture,S=void 0===d.__version||!0===u,T=c.dataReady,R=_(o,m);if(o.isDepthTexture)w=x(o.format===eE.brP,o.type),S&&(C?n.texStorage2D(e.TEXTURE_2D,1,w,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,w,m.width,m.height,0,b,E,null));else if(o.isDataTexture){if(M.length>0){C&&S&&n.texStorage2D(e.TEXTURE_2D,R,w,M[0].width,M[0].height);for(let r=0,s=M.length;r<s;r++)i=M[r],C?T&&n.texSubImage2D(e.TEXTURE_2D,r,0,0,i.width,i.height,b,E,i.data):n.texImage2D(e.TEXTURE_2D,r,w,i.width,i.height,0,b,E,i.data);o.generateMipmaps=!1}else C?(S&&n.texStorage2D(e.TEXTURE_2D,R,w,m.width,m.height),T&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,b,E,m.data)):n.texImage2D(e.TEXTURE_2D,0,w,m.width,m.height,0,b,E,m.data)}else if(o.isCompressedTexture){if(o.isCompressedArrayTexture){C&&S&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,w,M[0].width,M[0].height,m.depth);for(let r=0,s=M.length;r<s;r++)if(i=M[r],o.format!==eE.wk1){if(null!==b){if(C){if(T){if(o.layerUpdates.size>0){let s=(0,eE.EcG)(i.width,i.height,o.format,o.type);for(let a of o.layerUpdates){let o=i.data.subarray(a*s/i.data.BYTES_PER_ELEMENT,(a+1)*s/i.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,r,0,0,a,i.width,i.height,1,b,o)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,r,0,0,0,i.width,i.height,m.depth,b,i.data)}}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,r,w,i.width,i.height,m.depth,0,i.data,0,0)}else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}else C?T&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,r,0,0,0,i.width,i.height,m.depth,b,E,i.data):n.texImage3D(e.TEXTURE_2D_ARRAY,r,w,i.width,i.height,m.depth,0,b,E,i.data)}else{C&&S&&n.texStorage2D(e.TEXTURE_2D,R,w,M[0].width,M[0].height);for(let r=0,s=M.length;r<s;r++)i=M[r],o.format!==eE.wk1?null!==b?C?T&&n.compressedTexSubImage2D(e.TEXTURE_2D,r,0,0,i.width,i.height,b,i.data):n.compressedTexImage2D(e.TEXTURE_2D,r,w,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?T&&n.texSubImage2D(e.TEXTURE_2D,r,0,0,i.width,i.height,b,E,i.data):n.texImage2D(e.TEXTURE_2D,r,w,i.width,i.height,0,b,E,i.data)}}else if(o.isDataArrayTexture){if(C){if(S&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,w,m.width,m.height,m.depth),T){if(o.layerUpdates.size>0){let i=(0,eE.EcG)(m.width,m.height,o.format,o.type);for(let r of o.layerUpdates){let s=m.data.subarray(r*i/m.data.BYTES_PER_ELEMENT,(r+1)*i/m.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,m.width,m.height,1,b,E,s)}o.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,b,E,m.data)}}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,w,m.width,m.height,m.depth,0,b,E,m.data)}else if(o.isData3DTexture)C?(S&&n.texStorage3D(e.TEXTURE_3D,R,w,m.width,m.height,m.depth),T&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,b,E,m.data)):n.texImage3D(e.TEXTURE_3D,0,w,m.width,m.height,m.depth,0,b,E,m.data);else if(o.isFramebufferTexture){if(S){if(C)n.texStorage2D(e.TEXTURE_2D,R,w,m.width,m.height);else{let i=m.width,r=m.height;for(let s=0;s<R;s++)n.texImage2D(e.TEXTURE_2D,s,w,i,r,0,b,E,null),i>>=1,r>>=1}}}else if(M.length>0){if(C&&S){let i=G(M[0]);n.texStorage2D(e.TEXTURE_2D,R,w,i.width,i.height)}for(let r=0,s=M.length;r<s;r++)i=M[r],C?T&&n.texSubImage2D(e.TEXTURE_2D,r,0,0,b,E,i):n.texImage2D(e.TEXTURE_2D,r,w,b,E,i);o.generateMipmaps=!1}else if(C){if(S){let i=G(m);n.texStorage2D(e.TEXTURE_2D,R,w,i.width,i.height)}T&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,b,E,m)}else n.texImage2D(e.TEXTURE_2D,0,w,b,E,m);A(o)&&v(h),d.__version=c.version,o.onUpdate&&o.onUpdate(o)}i.__version=o.version}function P(i,s,o,l,u,c){let d=a.convert(o.format,o.colorSpace),p=a.convert(o.type),f=y(o.internalFormat,d,p,o.colorSpace),m=r.get(s),g=r.get(o);if(g.__renderTarget=s,!m.__hasExternalTextures){let i=Math.max(1,s.width>>c),r=Math.max(1,s.height>>c);u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?n.texImage3D(u,c,f,i,r,s.depth,0,d,p,null):n.texImage2D(u,c,f,i,r,0,d,p,null)}n.bindFramebuffer(e.FRAMEBUFFER,i),F(s)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,u,g.__webglTexture,0,k(s)):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,u,g.__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function D(i,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,i),n.depthBuffer){let s=n.depthTexture,a=s&&s.isDepthTexture?s.type:null,o=x(n.stencilBuffer,a),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=k(n);F(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,o,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,o,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,o,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,i)}else{let i=n.textures;for(let s=0;s<i.length;s++){let o=i[s],l=a.convert(o.format,o.colorSpace),u=a.convert(o.type),c=y(o.internalFormat,l,u,o.colorSpace),d=k(n);r&&!1===F(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,c,n.width,n.height):F(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function N(i){let s=r.get(i),a=!0===i.isWebGLCubeRenderTarget;if(s.__boundDepthTexture!==i.depthTexture){let e=i.depthTexture;if(s.__depthDisposeCallback&&s.__depthDisposeCallback(),e){let i=()=>{delete s.__boundDepthTexture,delete s.__depthDisposeCallback,e.removeEventListener("dispose",i)};e.addEventListener("dispose",i),s.__depthDisposeCallback=i}s.__boundDepthTexture=e}if(i.depthTexture&&!s.__autoAllocateDepthBuffer){if(a)throw Error("target.depthTexture not supported in Cube render targets");!function(i,s){if(s&&s.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,i),!(s.depthTexture&&s.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");let a=r.get(s.depthTexture);a.__renderTarget=s,a.__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),C(s.depthTexture,0);let o=a.__webglTexture,l=k(s);if(s.depthTexture.format===eE.qkB)F(s)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else if(s.depthTexture.format===eE.brP)F(s)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0);else throw Error("Unknown depthTexture format")}(s.__webglFramebuffer,i)}else if(a){s.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer[r]),void 0===s.__webglDepthbuffer[r])s.__webglDepthbuffer[r]=e.createRenderbuffer(),D(s.__webglDepthbuffer[r],i,!1);else{let n=i.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,a=s.__webglDepthbuffer[r];e.bindRenderbuffer(e.RENDERBUFFER,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,a)}}else if(n.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer),void 0===s.__webglDepthbuffer)s.__webglDepthbuffer=e.createRenderbuffer(),D(s.__webglDepthbuffer,i,!1);else{let n=i.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,r=s.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,r)}n.bindFramebuffer(e.FRAMEBUFFER,null)}let O=[],U=[];function k(e){return Math.min(s.maxSamples,e.samples)}function F(e){let n=r.get(e);return e.samples>0&&!0===i.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function z(e,i){let n=e.colorSpace,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==eE.GUF&&n!==eE.aCh&&(eE.epp.getTransfer(n)===eE.j17?(r!==eE.wk1||s!==eE.ywz)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),i}function G(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){let e=M;return e>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+s.maxTextures),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=C,this.setTexture2DArray=function(i,s){let a=r.get(i);if(i.version>0&&a.__version!==i.version){L(a,i,s);return}n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+s)},this.setTexture3D=function(i,s){let a=r.get(i);if(i.version>0&&a.__version!==i.version){L(a,i,s);return}n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+s)},this.setTextureCube=function(i,o){let l=r.get(i);if(i.version>0&&l.__version!==i.version){(function(i,o,l){if(6!==o.image.length)return;let h=B(i,o),u=o.source;n.bindTexture(e.TEXTURE_CUBE_MAP,i.__webglTexture,e.TEXTURE0+l);let c=r.get(u);if(u.version!==c.__version||!0===h){let i;n.activeTexture(e.TEXTURE0+l);let r=eE.epp.getPrimaries(eE.epp.workingColorSpace),d=o.colorSpace===eE.aCh?null:eE.epp.getPrimaries(o.colorSpace),p=o.colorSpace===eE.aCh||r===d?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);let f=o.isCompressedTexture||o.image[0].isCompressedTexture,m=o.image[0]&&o.image[0].isDataTexture,x=[];for(let e=0;e<6;e++)f||m?x[e]=m?o.image[e].image:o.image[e]:x[e]=g(o.image[e],!0,s.maxCubemapSize),x[e]=z(o,x[e]);let b=x[0],E=a.convert(o.format,o.colorSpace),w=a.convert(o.type),M=y(o.internalFormat,E,w,o.colorSpace),C=!0!==o.isVideoTexture,S=void 0===c.__version||!0===h,T=u.dataReady,R=_(o,b);if(I(e.TEXTURE_CUBE_MAP,o),f){C&&S&&n.texStorage2D(e.TEXTURE_CUBE_MAP,R,M,b.width,b.height);for(let r=0;r<6;r++){i=x[r].mipmaps;for(let s=0;s<i.length;s++){let a=i[s];o.format!==eE.wk1?null!==E?C?T&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s,0,0,a.width,a.height,E,a.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s,M,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s,0,0,a.width,a.height,E,w,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s,M,a.width,a.height,0,E,w,a.data)}}}else{if(i=o.mipmaps,C&&S){i.length>0&&R++;let r=G(x[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,R,M,r.width,r.height)}for(let r=0;r<6;r++)if(m){C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,0,0,x[r].width,x[r].height,E,w,x[r].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,M,x[r].width,x[r].height,0,E,w,x[r].data);for(let s=0;s<i.length;s++){let a=i[s].image[r].image;C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s+1,0,0,a.width,a.height,E,w,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s+1,M,a.width,a.height,0,E,w,a.data)}}else{C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,0,0,E,w,x[r]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,M,E,w,x[r]);for(let s=0;s<i.length;s++){let a=i[s];C?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s+1,0,0,E,w,a.image[r]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,s+1,M,E,w,a.image[r])}}}A(o)&&v(e.TEXTURE_CUBE_MAP),c.__version=u.version,o.onUpdate&&o.onUpdate(o)}i.__version=o.version})(l,i,o);return}n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture,e.TEXTURE0+o)},this.rebindTextures=function(i,n,s){let a=r.get(i);void 0!==n&&P(a.__webglFramebuffer,i,i.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==s&&N(i)},this.setupRenderTarget=function(i){let s=i.texture,l=r.get(i),h=r.get(s);i.addEventListener("dispose",E);let u=i.textures,c=!0===i.isWebGLCubeRenderTarget,d=u.length>1;if(!d&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=s.version,o.memory.textures++),c){l.__webglFramebuffer=[];for(let i=0;i<6;i++)if(s.mipmaps&&s.mipmaps.length>0){l.__webglFramebuffer[i]=[];for(let n=0;n<s.mipmaps.length;n++)l.__webglFramebuffer[i][n]=e.createFramebuffer()}else l.__webglFramebuffer[i]=e.createFramebuffer()}else{if(s.mipmaps&&s.mipmaps.length>0){l.__webglFramebuffer=[];for(let i=0;i<s.mipmaps.length;i++)l.__webglFramebuffer[i]=e.createFramebuffer()}else l.__webglFramebuffer=e.createFramebuffer();if(d)for(let i=0,n=u.length;i<n;i++){let n=r.get(u[i]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}if(i.samples>0&&!1===F(i)){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,l.__webglMultisampledFramebuffer);for(let n=0;n<u.length;n++){let r=u[n];l.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,l.__webglColorRenderbuffer[n]);let s=a.convert(r.format,r.colorSpace),o=a.convert(r.type),h=y(r.internalFormat,s,o,r.colorSpace,!0===i.isXRRenderTarget),c=k(i);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,h,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,l.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),i.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),D(l.__webglDepthRenderbuffer,i,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){n.bindTexture(e.TEXTURE_CUBE_MAP,h.__webglTexture),I(e.TEXTURE_CUBE_MAP,s);for(let n=0;n<6;n++)if(s.mipmaps&&s.mipmaps.length>0)for(let r=0;r<s.mipmaps.length;r++)P(l.__webglFramebuffer[n][r],i,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else P(l.__webglFramebuffer[n],i,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);A(s)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){for(let s=0,a=u.length;s<a;s++){let a=u[s],o=r.get(a);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),I(e.TEXTURE_2D,a),P(l.__webglFramebuffer,i,a,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,0),A(a)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((i.isWebGL3DRenderTarget||i.isWebGLArrayRenderTarget)&&(r=i.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,h.__webglTexture),I(r,s),s.mipmaps&&s.mipmaps.length>0)for(let n=0;n<s.mipmaps.length;n++)P(l.__webglFramebuffer[n],i,s,e.COLOR_ATTACHMENT0,r,n);else P(l.__webglFramebuffer,i,s,e.COLOR_ATTACHMENT0,r,0);A(s)&&v(r),n.unbindTexture()}i.depthBuffer&&N(i)},this.updateRenderTargetMipmap=function(i){let s=i.textures;for(let a=0,o=s.length;a<o;a++){let o=s[a];if(A(o)){let s=i.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:i.isWebGL3DRenderTarget?e.TEXTURE_3D:i.isWebGLArrayRenderTarget||i.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,a=r.get(o).__webglTexture;n.bindTexture(s,a),v(s),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(i){if(i.samples>0){if(!1===F(i)){let s=i.textures,a=i.width,o=i.height,l=e.COLOR_BUFFER_BIT,h=i.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=r.get(i),d=s.length>1;if(d)for(let i=0;i<s.length;i++)n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let n=0;n<s.length;n++){if(i.resolveDepthBuffer&&(i.depthBuffer&&(l|=e.DEPTH_BUFFER_BIT),i.stencilBuffer&&i.resolveStencilBuffer&&(l|=e.STENCIL_BUFFER_BIT)),d){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);let i=r.get(s[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,l,e.NEAREST),!0===u&&(O.length=0,U.length=0,O.push(e.COLOR_ATTACHMENT0+n),i.depthBuffer&&!1===i.resolveDepthBuffer&&(O.push(h),U.push(h),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,U)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,O))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let i=0;i<s.length;i++){n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,c.__webglColorRenderbuffer[i]);let a=r.get(s[i]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}else if(i.depthBuffer&&!1===i.resolveDepthBuffer&&u){let n=i.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}}},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=P,this.useMultisampledRTT=F}function iK(e,i){return{convert:function(n,r=eE.aCh){let s;let a=eE.epp.getTransfer(r);if(n===eE.ywz)return e.UNSIGNED_BYTE;if(n===eE.k0A)return e.UNSIGNED_SHORT_4_4_4_4;if(n===eE.irR)return e.UNSIGNED_SHORT_5_5_5_1;if(n===eE.tQZ)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===eE.T95)return e.BYTE;if(n===eE.iAb)return e.SHORT;if(n===eE.LsT)return e.UNSIGNED_SHORT;if(n===eE.Kz5)return e.INT;if(n===eE.JQ4)return e.UNSIGNED_INT;if(n===eE.VzW)return e.FLOAT;if(n===eE.cLu)return e.HALF_FLOAT;if(n===eE.OTo)return e.ALPHA;if(n===eE.UCm)return e.RGB;if(n===eE.wk1)return e.RGBA;if(n===eE.Y8D)return e.LUMINANCE;if(n===eE.cRx)return e.LUMINANCE_ALPHA;if(n===eE.qkB)return e.DEPTH_COMPONENT;if(n===eE.brP)return e.DEPTH_STENCIL;if(n===eE.hEm)return e.RED;if(n===eE.D9w)return e.RED_INTEGER;if(n===eE.av9)return e.RG;if(n===eE.CtA)return e.RG_INTEGER;if(n===eE.E2K)return e.RGBA_INTEGER;if(n===eE.wuA||n===eE.BFQ||n===eE.v3W||n===eE.ILR){if(a===eE.j17){if(null===(s=i.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===eE.wuA)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===eE.BFQ)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===eE.v3W)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===eE.ILR)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(s=i.get("WEBGL_compressed_texture_s3tc")))return null;if(n===eE.wuA)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===eE.BFQ)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===eE.v3W)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===eE.ILR)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(n===eE._AM||n===eE.vCx||n===eE.eaV||n===eE.CaW){if(null===(s=i.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===eE._AM)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===eE.vCx)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===eE.eaV)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===eE.CaW)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===eE.fto||n===eE.l0P||n===eE.ekQ){if(null===(s=i.get("WEBGL_compressed_texture_etc")))return null;if(n===eE.fto||n===eE.l0P)return a===eE.j17?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===eE.ekQ)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===eE.ptH||n===eE.jZA||n===eE.y2t||n===eE.gi4||n===eE.Djp||n===eE.BG$||n===eE.NYV||n===eE.xJs||n===eE.pKu||n===eE.GG6||n===eE.Gih||n===eE.FUD||n===eE.iiP||n===eE.SvJ){if(null===(s=i.get("WEBGL_compressed_texture_astc")))return null;if(n===eE.ptH)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===eE.jZA)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===eE.y2t)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===eE.gi4)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===eE.Djp)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===eE.BG$)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===eE.NYV)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===eE.xJs)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===eE.pKu)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===eE.GG6)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===eE.Gih)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===eE.FUD)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===eE.iiP)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===eE.SvJ)return a===eE.j17?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===eE.bsb||n===eE.f2y||n===eE.QO2){if(null===(s=i.get("EXT_texture_compression_bptc")))return null;if(n===eE.bsb)return a===eE.j17?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===eE.f2y)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===eE.QO2)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===eE.HdW||n===eE.vuL||n===eE.ZTh||n===eE.lGU){if(null===(s=i.get("EXT_texture_compression_rgtc")))return null;if(n===eE.bsb)return s.COMPRESSED_RED_RGTC1_EXT;if(n===eE.vuL)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===eE.ZTh)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===eE.lGU)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===eE.wJv?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}let iY={type:"move"};class iJ{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new eE.ZAu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new eE.ZAu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new eE.Pa4,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new eE.Pa4),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new eE.ZAu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new eE.Pa4,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new eE.Pa4),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let i=this._hand;if(i)for(let n of e.hand.values())this._getHandJoint(i,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,i,n){let r=null,s=null,a=null,o=this._targetRay,l=this._grip,h=this._hand;if(e&&"visible-blurred"!==i.session.visibilityState){if(h&&e.hand){for(let r of(a=!0,e.hand.values())){let e=i.getJointPose(r,n),s=this._getHandJoint(h,r);null!==e&&(s.matrix.fromArray(e.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,s.jointRadius=e.radius),s.visible=null!==e}let r=h.joints["index-finger-tip"],s=h.joints["thumb-tip"],o=r.position.distanceTo(s.position);h.inputState.pinching&&o>.025?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&o<=.015&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&null!==(s=i.getPose(e.gripSpace,n))&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1);null!==o&&(null===(r=i.getPose(e.targetRaySpace,n))&&null!==s&&(r=s),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(iY)))}return null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),null!==h&&(h.visible=null!==a),this}_getHandJoint(e,i){if(void 0===e.joints[i.jointName]){let n=new eE.ZAu;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[i.jointName]=n,e.add(n)}return e.joints[i.jointName]}}let iZ=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,i$=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class i0{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,n){if(null===this.texture){let r=new eE.xEZ;e.properties.get(r).__webglTexture=i.texture,(i.depthNear!==n.depthNear||i.depthFar!==n.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){let i=e.cameras[0].viewport,n=new eE.jyz({vertexShader:iZ,fragmentShader:i$,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new eE.Kj0(new eE._12(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class i1 extends eE.pBf{constructor(e,i){super();let n=this,r=null,s=1,a=null,o="local-floor",l=1,h=null,u=null,c=null,d=null,p=null,f=null,m=new i0,g=i.getContextAttributes(),A=null,v=null,y=[],x=[],_=new eE.FM8,b=null,E=new eE.cPb;E.viewport=new eE.Ltg;let w=new eE.cPb;w.viewport=new eE.Ltg;let M=[E,w],C=new eE.HkE,S=null,T=null;function R(e){let i=x.indexOf(e.inputSource);if(-1===i)return;let n=y[i];void 0!==n&&(n.update(e.inputSource,e.frame,h||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function I(){r.removeEventListener("select",R),r.removeEventListener("selectstart",R),r.removeEventListener("selectend",R),r.removeEventListener("squeeze",R),r.removeEventListener("squeezestart",R),r.removeEventListener("squeezeend",R),r.removeEventListener("end",I),r.removeEventListener("inputsourceschange",B);for(let e=0;e<y.length;e++){let i=x[e];null!==i&&(x[e]=null,y[e].disconnect(i))}S=null,T=null,m.reset(),e.setRenderTarget(A),p=null,d=null,c=null,r=null,v=null,O.stop(),n.isPresenting=!1,e.setPixelRatio(b),e.setSize(_.width,_.height,!1),n.dispatchEvent({type:"sessionend"})}function B(e){for(let i=0;i<e.removed.length;i++){let n=e.removed[i],r=x.indexOf(n);r>=0&&(x[r]=null,y[r].disconnect(n))}for(let i=0;i<e.added.length;i++){let n=e.added[i],r=x.indexOf(n);if(-1===r){for(let e=0;e<y.length;e++){if(e>=x.length){x.push(n),r=e;break}if(null===x[e]){x[e]=n,r=e;break}}if(-1===r)break}let s=y[r];s&&s.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let i=y[e];return void 0===i&&(i=new iJ,y[e]=i),i.getTargetRaySpace()},this.getControllerGrip=function(e){let i=y[e];return void 0===i&&(i=new iJ,y[e]=i),i.getGripSpace()},this.getHand=function(e){let i=y[e];return void 0===i&&(i=new iJ,y[e]=i),i.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||a},this.setReferenceSpace=function(e){h=e},this.getBaseLayer=function(){return null!==d?d:p},this.getBinding=function(){return c},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(u){if(null!==(r=u)){if(A=e.getRenderTarget(),r.addEventListener("select",R),r.addEventListener("selectstart",R),r.addEventListener("selectend",R),r.addEventListener("squeeze",R),r.addEventListener("squeezestart",R),r.addEventListener("squeezeend",R),r.addEventListener("end",I),r.addEventListener("inputsourceschange",B),!0!==g.xrCompatible&&await i.makeXRCompatible(),b=e.getPixelRatio(),e.getSize(_),void 0!==r.enabledFeatures&&r.enabledFeatures.includes("layers")){let n=null,a=null,o=null;g.depth&&(o=g.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,n=g.stencil?eE.brP:eE.qkB,a=g.stencil?eE.wJv:eE.JQ4);let l={colorFormat:i.RGBA8,depthFormat:o,scaleFactor:s};d=(c=new XRWebGLBinding(r,i)).createProjectionLayer(l),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),v=new eE.dd2(d.textureWidth,d.textureHeight,{format:eE.wk1,type:eE.ywz,depthTexture:new eE.$YQ(d.textureWidth,d.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:4*!!g.antialias,resolveDepthBuffer:!1===d.ignoreDepthValues})}else{let n={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(r,i,n),r.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),v=new eE.dd2(p.framebufferWidth,p.framebufferHeight,{format:eE.wk1,type:eE.ywz,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}v.isXRRenderTarget=!0,this.setFoveation(l),h=null,a=await r.requestReferenceSpace(o),O.setContext(r),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};let L=new eE.Pa4,P=new eE.Pa4;function D(e,i){null===i?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(i.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){var i,n,s;if(null===r)return;let a=e.near,o=e.far;null!==m.texture&&(m.depthNear>0&&(a=m.depthNear),m.depthFar>0&&(o=m.depthFar)),C.near=w.near=E.near=a,C.far=w.far=E.far=o,(S!==C.near||T!==C.far)&&(r.updateRenderState({depthNear:C.near,depthFar:C.far}),S=C.near,T=C.far),E.layers.mask=2|e.layers.mask,w.layers.mask=4|e.layers.mask,C.layers.mask=E.layers.mask|w.layers.mask;let l=e.parent,h=C.cameras;D(C,l);for(let e=0;e<h.length;e++)D(h[e],l);2===h.length?function(e,i,n){L.setFromMatrixPosition(i.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);let r=L.distanceTo(P),s=i.projectionMatrix.elements,a=n.projectionMatrix.elements,o=s[14]/(s[10]-1),l=s[14]/(s[10]+1),h=(s[9]+1)/s[5],u=(s[9]-1)/s[5],c=(s[8]-1)/s[0],d=(a[8]+1)/a[0],p=r/(-c+d),f=-(p*c);if(i.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===s[10])e.projectionMatrix.copy(i.projectionMatrix),e.projectionMatrixInverse.copy(i.projectionMatrixInverse);else{let i=o+p,n=l+p;e.projectionMatrix.makePerspective(o*c-f,o*d+(r-f),h*l/n*i,u*l/n*i,i,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(C,E,w):C.projectionMatrix.copy(E.projectionMatrix),i=e,n=C,null===(s=l)?i.matrix.copy(n.matrixWorld):(i.matrix.copy(s.matrixWorld),i.matrix.invert(),i.matrix.multiply(n.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(n.projectionMatrix),i.projectionMatrixInverse.copy(n.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=2*eE.I3e*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)},this.getCamera=function(){return C},this.getFoveation=function(){if(null!==d||null!==p)return l},this.setFoveation=function(e){l=e,null!==d&&(d.fixedFoveation=e),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(C)};let N=null,O=new eH;O.setAnimationLoop(function(i,s){if(u=s.getViewerPose(h||a),f=s,null!==u){let i=u.views;null!==p&&(e.setRenderTargetFramebuffer(v,p.framebuffer),e.setRenderTarget(v));let n=!1;i.length!==C.cameras.length&&(C.cameras.length=0,n=!0);for(let r=0;r<i.length;r++){let s=i[r],a=null;if(null!==p)a=p.getViewport(s);else{let i=c.getViewSubImage(d,s);a=i.viewport,0===r&&(e.setRenderTargetTextures(v,i.colorTexture,d.ignoreDepthValues?void 0:i.depthStencilTexture),e.setRenderTarget(v))}let o=M[r];void 0===o&&((o=new eE.cPb).layers.enable(r),o.viewport=new eE.Ltg,M[r]=o),o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(s.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===r&&(C.matrix.copy(o.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),!0===n&&C.cameras.push(o)}let s=r.enabledFeatures;if(s&&s.includes("depth-sensing")){let n=c.getDepthInformation(i[0]);n&&n.isValid&&n.texture&&m.init(e,n,r.renderState)}}for(let e=0;e<y.length;e++){let i=x[e],n=y[e];null!==i&&void 0!==n&&n.update(i,s,h||a)}N&&N(i,s),s.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:s}),f=null}),this.setAnimationLoop=function(e){N=e},this.dispose=function(){}}}let i2=new eE.USm,i3=new eE.yGw;function i4(e,i){function n(e,i){!0===e.matrixAutoUpdate&&e.updateMatrix(),i.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,r.side===eE._Li&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),r.side===eE._Li&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);let s=i.get(r),a=s.envMap,o=s.envMapRotation;a&&(e.envMap.value=a,i2.copy(o),i2.x*=-1,i2.y*=-1,i2.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(i2.y*=-1,i2.z*=-1),e.envMapRotation.value.setFromMatrix4(i3.makeRotationFromEuler(i2)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(i,n){n.color.getRGB(i.fogColor.value,(0,eE.oDz)(e)),n.isFog?(i.fogNear.value=n.near,i.fogFar.value=n.far):n.isFogExp2&&(i.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,s,a,o,l){var h,u,c,d,p,f,m,g,A,v,y,x,_,b,E,w,M,C,S,T,R;s.isMeshBasicMaterial?r(e,s):s.isMeshLambertMaterial?r(e,s):s.isMeshToonMaterial?(r(e,s),h=e,(u=s).gradientMap&&(h.gradientMap.value=u.gradientMap)):s.isMeshPhongMaterial?(r(e,s),c=e,d=s,c.specular.value.copy(d.specular),c.shininess.value=Math.max(d.shininess,1e-4)):s.isMeshStandardMaterial?(r(e,s),p=e,f=s,p.metalness.value=f.metalness,f.metalnessMap&&(p.metalnessMap.value=f.metalnessMap,n(f.metalnessMap,p.metalnessMapTransform)),p.roughness.value=f.roughness,f.roughnessMap&&(p.roughnessMap.value=f.roughnessMap,n(f.roughnessMap,p.roughnessMapTransform)),f.envMap&&(p.envMapIntensity.value=f.envMapIntensity),s.isMeshPhysicalMaterial&&(m=e,g=s,A=l,m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap,n(g.sheenColorMap,m.sheenColorMapTransform)),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap,n(g.sheenRoughnessMap,m.sheenRoughnessMapTransform))),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap,n(g.clearcoatMap,m.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,n(g.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(m.clearcoatNormalMap.value=g.clearcoatNormalMap,n(g.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===eE._Li&&m.clearcoatNormalScale.value.negate())),g.dispersion>0&&(m.dispersion.value=g.dispersion),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap,n(g.iridescenceMap,m.iridescenceMapTransform)),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap,n(g.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=A.texture,m.transmissionSamplerSize.value.set(A.width,A.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap,n(g.transmissionMap,m.transmissionMapTransform)),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap,n(g.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(m.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(m.anisotropyMap.value=g.anisotropyMap,n(g.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap,n(g.specularColorMap,m.specularColorMapTransform)),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap,n(g.specularIntensityMap,m.specularIntensityMapTransform)))):s.isMeshMatcapMaterial?(r(e,s),v=e,(y=s).matcap&&(v.matcap.value=y.matcap)):s.isMeshDepthMaterial?r(e,s):s.isMeshDistanceMaterial?(r(e,s),function(e,n){let r=i.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,s)):s.isMeshNormalMaterial?r(e,s):s.isLineBasicMaterial?(x=e,_=s,x.diffuse.value.copy(_.color),x.opacity.value=_.opacity,_.map&&(x.map.value=_.map,n(_.map,x.mapTransform)),s.isLineDashedMaterial&&(b=e,E=s,b.dashSize.value=E.dashSize,b.totalSize.value=E.dashSize+E.gapSize,b.scale.value=E.scale)):s.isPointsMaterial?(w=e,M=s,C=a,S=o,w.diffuse.value.copy(M.color),w.opacity.value=M.opacity,w.size.value=M.size*C,w.scale.value=.5*S,M.map&&(w.map.value=M.map,n(M.map,w.uvTransform)),M.alphaMap&&(w.alphaMap.value=M.alphaMap,n(M.alphaMap,w.alphaMapTransform)),M.alphaTest>0&&(w.alphaTest.value=M.alphaTest)):s.isSpriteMaterial?(T=e,R=s,T.diffuse.value.copy(R.color),T.opacity.value=R.opacity,T.rotation.value=R.rotation,R.map&&(T.map.value=R.map,n(R.map,T.mapTransform)),R.alphaMap&&(T.alphaMap.value=R.alphaMap,n(R.alphaMap,T.alphaMapTransform)),R.alphaTest>0&&(T.alphaTest.value=R.alphaTest)):s.isShadowMaterial?(e.color.value.copy(s.color),e.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function i5(e,i,n,r){let s={},a={},o=[],l=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function h(e){let i={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(i.boundary=4,i.storage=4):e.isVector2?(i.boundary=8,i.storage=8):e.isVector3||e.isColor?(i.boundary=16,i.storage=12):e.isVector4?(i.boundary=16,i.storage=16):e.isMatrix3?(i.boundary=48,i.storage=48):e.isMatrix4?(i.boundary=64,i.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),i}function u(i){let n=i.target;n.removeEventListener("dispose",u);let r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(s[n.id]),delete s[n.id],delete a[n.id]}return{bind:function(e,i){let n=i.program;r.uniformBlockBinding(e,n)},update:function(n,c){let d=s[n.id];void 0===d&&(function(e){let i=e.uniforms,n=0;for(let e=0,r=i.length;e<r;e++){let r=Array.isArray(i[e])?i[e]:[i[e]];for(let e=0,i=r.length;e<i;e++){let i=r[e],s=Array.isArray(i.value)?i.value:[i.value];for(let e=0,r=s.length;e<r;e++){let r=h(s[e]),a=n%16,o=a%r.boundary,l=a+o;n+=o,0!==l&&16-l<r.storage&&(n+=16-l),i.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,n+=r.storage}}}let r=n%16;r>0&&(n+=16-r),e.__size=n,e.__cache={}}(n),d=function(i){let n=function(){for(let e=0;e<l;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();i.__bindingPointIndex=n;let r=e.createBuffer(),s=i.__size,a=i.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,s,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),s[n.id]=d,n.addEventListener("dispose",u));let p=c.program;r.updateUBOMapping(n,p);let f=i.render.frame;a[n.id]!==f&&(function(i){let n=s[i.id],r=i.uniforms,a=i.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let i=0,n=r.length;i<n;i++){let n=Array.isArray(r[i])?r[i]:[r[i]];for(let r=0,s=n.length;r<s;r++){let s=n[r];if(!0===function(e,i,n,r){let s=e.value,a=i+"_"+n;if(void 0===r[a])return"number"==typeof s||"boolean"==typeof s?r[a]=s:r[a]=s.clone(),!0;{let e=r[a];if("number"==typeof s||"boolean"==typeof s){if(e!==s)return r[a]=s,!0}else if(!1===e.equals(s))return e.copy(s),!0}return!1}(s,i,r,a)){let i=s.__offset,n=Array.isArray(s.value)?s.value:[s.value],r=0;for(let a=0;a<n.length;a++){let o=n[a],l=h(o);"number"==typeof o||"boolean"==typeof o?(s.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,i+r,s.__data)):o.isMatrix3?(s.__data[0]=o.elements[0],s.__data[1]=o.elements[1],s.__data[2]=o.elements[2],s.__data[3]=0,s.__data[4]=o.elements[3],s.__data[5]=o.elements[4],s.__data[6]=o.elements[5],s.__data[7]=0,s.__data[8]=o.elements[6],s.__data[9]=o.elements[7],s.__data[10]=o.elements[8],s.__data[11]=0):(o.toArray(s.__data,r),r+=l.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,i,s.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=f)},dispose:function(){for(let i in s)e.deleteBuffer(s[i]);o=[],s={},a={}}}}let i6=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class i8{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=!0===e.object.isSkinnedMesh,this.refreshUniforms=i6,this.renderId=0}firstInitialization(e){return!1===this.renderObjects.has(e)&&(this.getRenderObjectData(e),!0)}getRenderObjectData(e){let i=this.renderObjects.get(e);if(void 0===i){let{geometry:n,material:r,object:s}=e;if(i={material:this.getMaterialData(r),geometry:{attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(i.center=s.center.clone()),s.morphTargetInfluences&&(i.morphTargetInfluences=s.morphTargetInfluences.slice()),null!==e.bundle&&(i.version=e.bundle.version),i.material.transmission>0){let{width:n,height:r}=e.context;i.bufferWidth=n,i.bufferHeight=r}this.renderObjects.set(e,i)}return i}getAttributesData(e){let i={};for(let n in e){let r=e[n];i[n]={version:r.version}}return i}containsNode(e){let i=e.material;for(let e in i)if(i[e]&&i[e].isNode)return!0;return null!==e.renderer.nodes.modelViewMatrix||null!==e.renderer.nodes.modelNormalViewMatrix}getMaterialData(e){let i={};for(let n of this.refreshUniforms){let r=e[n];null!=r&&("object"==typeof r&&void 0!==r.clone?!0===r.isTexture?i[n]={id:r.id,version:r.version}:i[n]=r.clone():i[n]=r)}return i}equals(e){let{object:i,material:n,geometry:r}=e,s=this.getRenderObjectData(e);if(!0!==s.worldMatrix.equals(i.matrixWorld))return s.worldMatrix.copy(i.matrixWorld),!1;let a=s.material;for(let e in a){let i=a[e],r=n[e];if(void 0!==i.equals){if(!1===i.equals(r))return i.copy(r),!1}else if(!0===r.isTexture){if(i.id!==r.id||i.version!==r.version)return i.id=r.id,i.version=r.version,!1}else if(i!==r)return a[e]=r,!1}if(a.transmission>0){let{width:i,height:n}=e.context;if(s.bufferWidth!==i||s.bufferHeight!==n)return s.bufferWidth=i,s.bufferHeight=n,!1}let o=s.geometry,l=r.attributes,h=o.attributes,u=Object.keys(h),c=Object.keys(l);if(u.length!==c.length)return s.geometry.attributes=this.getAttributesData(l),!1;for(let e of u){let i=h[e],n=l[e];if(void 0===n)return delete h[e],!1;if(i.version!==n.version)return i.version=n.version,!1}let d=r.index,p=o.indexVersion,f=d?d.version:null;if(p!==f)return o.indexVersion=f,!1;if(o.drawRange.start!==r.drawRange.start||o.drawRange.count!==r.drawRange.count)return o.drawRange.start=r.drawRange.start,o.drawRange.count=r.drawRange.count,!1;if(s.morphTargetInfluences){let e=!1;for(let n=0;n<s.morphTargetInfluences.length;n++)s.morphTargetInfluences[n]!==i.morphTargetInfluences[n]&&(e=!0);if(e)return!0}return s.center&&!1===s.center.equals(i.center)?s.center.copy(i.center):null!==e.bundle&&(s.version=e.bundle.version),!0}needsRefresh(e,i){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;let{renderId:n}=i;if(this.renderId!==n)return this.renderId=n,!0;let r=!0===e.object.static,s=null!==e.bundle&&!0===e.bundle.static&&this.getRenderObjectData(e).version===e.bundle.version;return!r&&!s&&!0!==this.equals(e)}}function i7(e,i=0){let n=0xdeadbeef^i,r=0x41c6ce57^i;if(e instanceof Array)for(let i=0,s;i<e.length;i++)n=Math.imul(n^(s=e[i]),0x9e3779b1),r=Math.imul(r^s,0x5f356495);else for(let i=0,s;i<e.length;i++)n=Math.imul(n^(s=e.charCodeAt(i)),0x9e3779b1),r=Math.imul(r^s,0x5f356495);return n=Math.imul(n^n>>>16,0x85ebca6b)^Math.imul(r^r>>>13,0xc2b2ae35),0x100000000*(2097151&(r=Math.imul(r^r>>>16,0x85ebca6b)^Math.imul(n^n>>>13,0xc2b2ae35)))+(n>>>0)}let i9=e=>i7(e),ne=e=>i7(e),nt=(...e)=>i7(e);function ni(e,i=!1){let n=[];for(let{property:r,childNode:s}of(!0===e.isNode&&(n.push(e.id),e=e.getSelf()),nn(e)))n.push(n,i7(r.slice(0,-4)),s.getCacheKey(i));return i7(n)}function*nn(e,i=!1){for(let n in e){if(!0===n.startsWith("_"))continue;let r=e[n];if(!0===Array.isArray(r))for(let e=0;e<r.length;e++){let s=r[e];s&&(!0===s.isNode||i&&"function"==typeof s.toJSON)&&(yield{property:n,index:e,childNode:s})}else if(r&&!0===r.isNode)yield{property:n,childNode:r};else if("object"==typeof r)for(let e in r){let s=r[e];s&&(!0===s.isNode||i&&"function"==typeof s.toJSON)&&(yield{property:n,index:e,childNode:s})}}}let nr=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),ns=new WeakMap;function na(e){if(null==e)return null;let i=typeof e;if(!0===e.isNode)return"node";if("number"===i)return"float";if("boolean"===i)return"bool";if("string"===i)return"string";if("function"===i)return"shader";else if(!0===e.isVector2)return"vec2";else if(!0===e.isVector3)return"vec3";else if(!0===e.isVector4)return"vec4";else if(!0===e.isMatrix3)return"mat3";else if(!0===e.isMatrix4)return"mat4";else if(!0===e.isColor)return"color";else if(e instanceof ArrayBuffer)return"ArrayBuffer";return null}function no(e,...i){let n=e?e.slice(-4):void 0;if(1===i.length&&("vec2"===n?i=[i[0],i[0]]:"vec3"===n?i=[i[0],i[0],i[0]]:"vec4"===n&&(i=[i[0],i[0],i[0],i[0]])),"color"===e)return new eE.Ilk(...i);if("vec2"===n)return new eE.FM8(...i);if("vec3"===n)return new eE.Pa4(...i);if("vec4"===n)return new eE.Ltg(...i);if("mat3"===n)return new eE.Vkp(...i);else if("mat4"===n)return new eE.yGw(...i);else if("bool"===e)return i[0]||!1;else if("float"===e||"int"===e||"uint"===e)return i[0]||0;else if("string"===e)return i[0]||"";else if("ArrayBuffer"===e)return function(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}(i[0]);return null}function nl(e){let i=ns.get(e);return void 0===i&&(i={},ns.set(e,i)),i}let nh={VERTEX:"vertex"},nu={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},nc={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},nd=["setup","analyze","generate"],np=["fragment","vertex","compute"],nf=["x","y","z","w"],nm=0;class ng extends eE.pBf{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=nu.NONE,this.updateBeforeType=nu.NONE,this.updateAfterType=nu.NONE,this.uuid=eE.M8C.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:nm++})}set needsUpdate(e){!0===e&&this.version++}get type(){return this.constructor.type}onUpdate(e,i){return this.updateType=i,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,nu.FRAME)}onRenderUpdate(e){return this.onUpdate(e,nu.RENDER)}onObjectUpdate(e){return this.onUpdate(e,nu.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(let{childNode:e}of nn(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){for(let i of(e(this),this.getChildren()))i.traverse(e)}getCacheKey(e=!1){return(!0===(e=e||this.version!==this._cacheKeyVersion)||null===this._cacheKey)&&(this._cacheKey=nt(ni(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){let i=this.getNodeType(e);return e.getElementType(i)}getNodeType(e){let i=e.getNodeProperties(this);return i.outputNode?i.outputNode.getNodeType(e):this.nodeType}getShared(e){let i=this.getHash(e);return e.getNodeFromHash(i)||this}setup(e){let i=e.getNodeProperties(this),n=0;for(let e of this.getChildren())i["node"+n++]=e;return i.outputNode||null}analyze(e){if(1===e.increaseUsage(this))for(let i of Object.values(e.getNodeProperties(this)))i&&!0===i.isNode&&i.build(e)}generate(e,i){let{outputNode:n}=e.getNodeProperties(this);if(n&&!0===n.isNode)return n.build(e,i)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,i=null){let n=this.getShared(e);if(this!==n)return n.build(e,i);e.addNode(this),e.addChain(this);let r=null,s=e.getBuildStage();if("setup"===s){this.updateReference(e);let i=e.getNodeProperties(this);if(!0!==i.initialized){i.initialized=!0;let n=this.setup(e),r=n&&!0===n.isNode;for(let n of Object.values(i))n&&!0===n.isNode&&n.build(e);r&&n.build(e),i.outputNode=n}}else if("analyze"===s)this.analyze(e);else if("generate"===s){if(1===this.generate.length){let n=this.getNodeType(e),s=e.getDataFromNode(this);void 0===(r=s.snippet)?(r=this.generate(e)||"",s.snippet=r):void 0!==s.flowCodes&&void 0!==e.context.nodeBlock&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),r=e.format(r,n,i)}else r=this.generate(e,i)||""}return e.removeChain(this),e.addSequentialNode(this),r}getSerializeChildren(){return nn(this)}serialize(e){let i=this.getSerializeChildren(),n={};for(let{property:r,index:s,childNode:a}of i)void 0!==s?(void 0===n[r]&&(n[r]=Number.isInteger(s)?[]:{}),n[r][s]=a.toJSON(e.meta).uuid):n[r]=a.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(void 0!==e.inputNodes){let i=e.meta.nodes;for(let n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){let r=[];for(let s of e.inputNodes[n])r.push(i[s]);this[n]=r}else if("object"==typeof e.inputNodes[n]){let r={};for(let s in e.inputNodes[n]){let a=e.inputNodes[n][s];r[s]=i[a]}this[n]=r}else{let r=e.inputNodes[n];this[n]=i[r]}}}toJSON(e){let{uuid:i,type:n}=this,r=void 0===e||"string"==typeof e;r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[i];function a(e){let i=[];for(let n in e){let r=e[n];delete r.metadata,i.push(r)}return i}if(void 0===s&&(s={uuid:i,type:n,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!==r&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta),r){let i=a(e.textures),n=a(e.images),r=a(e.nodes);i.length>0&&(s.textures=i),n.length>0&&(s.images=n),r.length>0&&(s.nodes=r)}return s}}class nA extends ng{static get type(){return"ArrayElementNode"}constructor(e,i){super(),this.node=e,this.indexNode=i,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){let i=this.node.build(e),n=this.indexNode.build(e,"uint");return`${i}[ ${n} ]`}}class nv extends ng{static get type(){return"ConvertNode"}constructor(e,i){super(),this.node=e,this.convertTo=i}getNodeType(e){let i=this.node.getNodeType(e),n=null;for(let r of this.convertTo.split("|"))(null===n||e.getTypeLength(i)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,i){let n=this.node,r=this.getNodeType(e),s=n.build(e,r);return e.format(s,r,i)}}class ny extends ng{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,i){if("generate"===e.getBuildStage()){let n=e.getVectorType(this.getNodeType(e,i)),r=e.getDataFromNode(this);if(void 0!==r.propertyName)return e.format(r.propertyName,n,i);if("void"!==n&&"void"!==i&&this.hasDependencies(e)){let s=super.build(e,n),a=e.getVarFromNode(this,null,n),o=e.getPropertyName(a);return e.addLineFlowCode(`${o} = ${s}`,this),r.snippet=s,r.propertyName=o,e.format(r.propertyName,n,i)}}return super.build(e,i)}}class nx extends ny{static get type(){return"JoinNode"}constructor(e=[],i=null){super(i),this.nodes=e}getNodeType(e){return null!==this.nodeType?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((i,n)=>i+e.getTypeLength(n.getNodeType(e)),0))}generate(e,i){let n=this.getNodeType(e),r=this.nodes,s=e.getComponentType(n),a=[];for(let i of r){let n=i.build(e),r=e.getComponentType(i.getNodeType(e));r!==s&&(n=e.format(n,r,s)),a.push(n)}let o=`${e.getType(n)}( ${a.join(", ")} )`;return e.format(o,n,i)}}let n_=nf.join("");class nb extends ng{static get type(){return"SplitNode"}constructor(e,i="x"){super(),this.node=e,this.components=i,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(let i of this.components)e=Math.max(nf.indexOf(i)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,i){let n=this.node,r=e.getTypeLength(n.getNodeType(e)),s=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));let o=n.build(e,a);s=this.components.length===r&&this.components===n_.slice(0,this.components.length)?e.format(o,a,i):e.format(`${o}.${this.components}`,this.getNodeType(e),i)}else s=n.build(e,i);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class nE extends ny{static get type(){return"SetNode"}constructor(e,i,n){super(),this.sourceNode=e,this.components=i,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){let{sourceNode:i,components:n,targetNode:r}=this,s=this.getNodeType(e),a=e.getComponentType(r.getNodeType(e)),o=e.getTypeFromLength(n.length,a),l=r.build(e,o),h=i.build(e,s),u=e.getTypeLength(s),c=[];for(let e=0;e<u;e++){let i=nf[e];i===n[0]?(c.push(l),e+=n.length-1):c.push(h+"."+i)}return`${e.getType(s)}( ${c.join(", ")} )`}}class nw extends ny{static get type(){return"FlipNode"}constructor(e,i){super(),this.sourceNode=e,this.components=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){let{components:i,sourceNode:n}=this,r=this.getNodeType(e),s=n.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+" = "+s,this);let l=e.getTypeLength(r),h=[],u=0;for(let e=0;e<l;e++){let n=nf[e];n===i[u]?(h.push("1.0 - "+o+"."+n),u++):h.push(o+"."+n)}return`${e.getType(r)}( ${h.join(", ")} )`}}class nM extends ng{static get type(){return"InputNode"}constructor(e,i=null){super(i),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?na(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=na(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=function(e){let i="",n=new Uint8Array(e);for(let e=0;e<n.length;e++)i+=String.fromCharCode(n[e]);return btoa(i)}(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?no(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class nC extends nM{static get type(){return"ConstNode"}constructor(e,i=null){super(e,i),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,i){let n=this.getNodeType(e);return e.format(this.generateConst(e),n,i)}}let nS=null,nT=new Map;function nR(e,i){if(nT.has(e)){console.warn(`Redefinition of method chaining ${e}`);return}if("function"!=typeof i)throw Error(`Node element ${e} is not a function`);nT.set(e,i)}let nI=e=>e.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),nB=e=>nI(e).split("").sort().join(""),nL={setup:(e,i)=>e(n1(i.shift()),...i),get(e,i,n){if("string"==typeof i&&void 0===e[i]){if(!0!==e.isStackNode&&"assign"===i)return(...e)=>(nS.assign(n,...e),n);if(nT.has(i)){let r=nT.get(i);return e.isStackNode?(...e)=>n.add(r(...e)):(...e)=>r(n,...e)}if("self"===i)return e;else if(i.endsWith("Assign")&&nT.has(i.slice(0,i.length-6))){let r=nT.get(i.slice(0,i.length-6));return e.isStackNode?(...e)=>n.assign(e[0],r(...e)):(...e)=>n.assign(r(n,...e))}else if(!0===/^[xyzwrgbastpq]{1,4}$/.test(i))return n0(new nb(n,i=nI(i)));else if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(i))return i=nB(i.slice(3).toLowerCase()),n=>n0(new nE(e,i,n));else if(!0===/^flip[XYZWRGBASTPQ]{1,4}$/.test(i))return i=nB(i.slice(4).toLowerCase()),()=>n0(new nw(n0(e),i));else if("width"===i||"height"===i||"depth"===i)return"width"===i?i="x":"height"===i?i="y":"depth"===i&&(i="z"),n0(new nb(e,i));else if(!0===/^\d+$/.test(i))return n0(new nA(n,new nC(Number(i),"uint")))}return Reflect.get(e,i,n)},set:(e,i,n,r)=>"string"==typeof i&&void 0===e[i]&&(!0===/^[xyzwrgbastpq]{1,4}$/.test(i)||"width"===i||"height"===i||"depth"===i||!0===/^\d+$/.test(i))?(r[i].assign(n),!0):Reflect.set(e,i,n,r)},nP=new WeakMap,nD=new WeakMap,nN=function(e,i=null){let n=na(e);if("node"===n){let i=nP.get(e);return void 0===i&&(i=new Proxy(e,nL),nP.set(e,i),nP.set(i,i)),i}return null===i&&("float"===n||"boolean"===n)||n&&"shader"!==n&&"string"!==n?n0(nX(e,i)):"shader"===n?n5(e):e},nO=function(e,i=null){for(let n in e)e[n]=n0(e[n],i);return e},nU=function(e,i=null){let n=e.length;for(let r=0;r<n;r++)e[r]=n0(e[r],i);return e},nk=function(e,i=null,n=null,r=null){let s=e=>n0(null!==r?Object.assign(e,r):e);return null===i?(...i)=>s(new e(...n2(i))):null!==n?(n=n0(n),(...r)=>s(new e(i,...n2(r),n))):(...n)=>s(new e(i,...n2(n)))},nF=function(e,...i){return n0(new e(...n2(i)))};class nz extends ng{constructor(e,i){super(),this.shaderNode=e,this.inputNodes=i}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){let{shaderNode:i,inputNodes:n}=this,r=e.getNodeProperties(i);if(r.onceOutput)return r.onceOutput;let s=null;if(i.layout){let r=nD.get(e.constructor);void 0===r&&(r=new WeakMap,nD.set(e.constructor,r));let a=r.get(i);void 0===a&&(a=n0(e.buildFunctionNode(i)),r.set(i,a)),null!==e.currentFunctionNode&&e.currentFunctionNode.includes.push(a),s=n0(a.call(n))}else{let r=i.jsFunc;s=n0(null!==n?r(n,e):r(e))}return i.once&&(r.onceOutput=s),s}getOutputNode(e){let i=e.getNodeProperties(this);return null===i.outputNode&&(i.outputNode=this.setupOutput(e)),i.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,i){return this.getOutputNode(e).build(e,i)}}class nG extends ng{constructor(e,i){super(i),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return n1(e),n0(new nz(this,e))}setup(){return this.call()}}let nV=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],nj=new Map;for(let e of[!1,!0])nj.set(e,new nC(e));let nH=new Map;for(let e of[0,1,2,3])nH.set(e,new nC(e,"uint"));let nQ=new Map([...nH].map(e=>new nC(e.value,"int")));for(let e of[-1,-2])nQ.set(e,new nC(e,"int"));let nW=new Map([...nQ].map(e=>new nC(e.value)));for(let e of nV)nW.set(e,new nC(e));for(let e of nV)nW.set(-e,new nC(-e));let nq=new Map([...nj,...nW]),nX=(e,i)=>nq.has(e)?nq.get(e):!0===e.isNode?e:new nC(e,i),nK=e=>{try{return e.getNodeType()}catch(e){return}},nY=function(e,i=null){return(...n)=>{if((0===n.length||!["bool","float","int","uint"].includes(e)&&n.every(e=>"object"!=typeof e))&&(n=[no(e,...n)]),1===n.length&&null!==i&&i.has(n[0]))return n0(i.get(n[0]));if(1===n.length){let i=nX(n[0],e);return nK(i)===e?n0(i):n0(new nv(i,e))}return n0(new nx(n.map(e=>nX(e)),e))}},nJ=e=>"object"==typeof e&&null!==e?e.value:e,nZ=e=>null!=e?e.nodeType||e.convertTo||("string"==typeof e?e:null):null;function n$(e,i){return new Proxy(new nG(e,i),nL)}let n0=(e,i=null)=>nN(e,i),n1=(e,i=null)=>new nO(e,i),n2=(e,i=null)=>new nU(e,i),n3=(...e)=>new nk(...e),n4=(...e)=>new nF(...e),n5=(e,i)=>{let n=new n$(e,i),r=(...e)=>{let i;return n1(e),i=e[0]&&e[0].isNode?[...e]:e[0],n.call(i)};return r.shaderNode=n,r.setLayout=e=>(n.setLayout(e),r),r.once=()=>(n.once=!0,r),r};nR("toGlobal",e=>(e.global=!0,e));let n6=e=>{nS=e},n8=()=>nS,n7=(...e)=>nS.If(...e);nR("append",function(e){return nS&&nS.add(e),e});let n9=new nY("color"),re=new nY("float",nW),rt=new nY("int",nQ),ri=new nY("uint",nH),rn=new nY("bool",nj),rr=new nY("vec2"),rs=new nY("ivec2"),ra=new nY("uvec2"),ro=new nY("bvec2"),rl=new nY("vec3"),rh=new nY("ivec3"),ru=new nY("uvec3"),rc=new nY("bvec3"),rd=new nY("vec4"),rp=new nY("ivec4"),rf=new nY("uvec4"),rm=new nY("bvec4"),rg=new nY("mat2"),rA=new nY("mat3"),rv=new nY("mat4");nR("toColor",n9),nR("toFloat",re),nR("toInt",rt),nR("toUint",ri),nR("toBool",rn),nR("toVec2",rr),nR("toIVec2",rs),nR("toUVec2",ra),nR("toBVec2",ro),nR("toVec3",rl),nR("toIVec3",rh),nR("toUVec3",ru),nR("toBVec3",rc),nR("toVec4",rd),nR("toIVec4",rp),nR("toUVec4",rf),nR("toBVec4",rm),nR("toMat2",rg),nR("toMat3",rA),nR("toMat4",rv),nR("element",n3(nA)),nR("convert",(e,i)=>n0(new nv(n0(e),i)));class ry extends ng{static get type(){return"UniformGroupNode"}constructor(e,i=!1,n=1){super("string"),this.name=e,this.shared=i,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}let rx=(e,i=0)=>new ry(e,!0,i),r_=rx("frame"),rb=rx("render"),rE=new ry("object");class rw extends nM{static get type(){return"UniformNode"}constructor(e,i=null){super(e,i),this.isUniformNode=!0,this.name="",this.groupNode=rE}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,i){let n=this.getSelf();return e=e.bind(n),super.onUpdate(i=>{let r=e(i,n);void 0!==r&&(this.value=r)},i)}generate(e,i){let n=this.getNodeType(e),r=this.getUniformHash(e),s=e.getNodeFromHash(r);void 0===s&&(e.setHashNode(this,r),s=this);let a=s.getInputType(e),o=e.getUniformFromNode(s,a,e.shaderStage,this.name||e.context.label),l=e.getPropertyName(o);return void 0!==e.context.label&&delete e.context.label,e.format(l,n,i)}}let rM=(e,i)=>{let n=nZ(i||e);return n0(new rw(e&&!0===e.isNode?e.node&&e.node.value||e.value:e,n))};class rC extends ng{static get type(){return"PropertyNode"}constructor(e,i=null,n=!1){super(e),this.name=i,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let i;return!0===this.varying?(i=e.getVaryingFromNode(this,this.name)).needsInterpolation=!0:i=e.getVarFromNode(this,this.name),e.getPropertyName(i)}}let rS=(e,i)=>n0(new rC(e,i)),rT=(e,i)=>n0(new rC(e,i,!0)),rR=n4(rC,"vec4","DiffuseColor"),rI=n4(rC,"vec3","EmissiveColor"),rB=n4(rC,"float","Roughness"),rL=n4(rC,"float","Metalness"),rP=n4(rC,"float","Clearcoat"),rD=n4(rC,"float","ClearcoatRoughness"),rN=n4(rC,"vec3","Sheen"),rO=n4(rC,"float","SheenRoughness"),rU=n4(rC,"float","Iridescence"),rk=n4(rC,"float","IridescenceIOR"),rF=n4(rC,"float","IridescenceThickness"),rz=n4(rC,"float","AlphaT"),rG=n4(rC,"float","Anisotropy"),rV=n4(rC,"vec3","AnisotropyT"),rj=n4(rC,"vec3","AnisotropyB"),rH=n4(rC,"color","SpecularColor"),rQ=n4(rC,"float","SpecularF90"),rW=n4(rC,"float","Shininess"),rq=n4(rC,"vec4","Output"),rX=n4(rC,"float","dashSize"),rK=n4(rC,"float","gapSize"),rY=n4(rC,"float","IOR"),rJ=n4(rC,"float","Transmission"),rZ=n4(rC,"float","Thickness"),r$=n4(rC,"float","AttenuationDistance"),r0=n4(rC,"color","AttenuationColor"),r1=n4(rC,"float","Dispersion");nR("assign",n3(class extends ny{static get type(){return"AssignNode"}constructor(e,i){super(),this.targetNode=e,this.sourceNode=i}hasDependencies(){return!1}getNodeType(e,i){return"void"!==i?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){let{targetNode:i}=this;if(!1===e.isAvailable("swizzleAssign")&&i.isSplitNode&&i.components.length>1){let n=e.getTypeLength(i.node.getNodeType(e));return nf.join("").slice(0,n)!==i.components}return!1}generate(e,i){let n;let{targetNode:r,sourceNode:s}=this,a=this.needsSplitAssign(e),o=r.getNodeType(e),l=r.context({assign:!0}).build(e),h=s.build(e,o),u=s.getNodeType(e),c=e.getDataFromNode(this);if(!0===c.initialized)"void"!==i&&(n=l);else if(a){let s=e.getVarFromNode(this,null,o),a=e.getPropertyName(s);e.addLineFlowCode(`${a} = ${h}`,this);let u=r.node.context({assign:!0}).build(e);for(let i=0;i<r.components.length;i++){let n=r.components[i];e.addLineFlowCode(`${u}.${n} = ${a}[ ${i} ]`,this)}"void"!==i&&(n=l)}else n=`${l} = ${h}`,("void"===i||"void"===u)&&(e.addLineFlowCode(n,this),"void"!==i&&(n=l));return c.initialized=!0,e.format(n,o,i)}}));class r2 extends ny{static get type(){return"FunctionCallNode"}constructor(e=null,i={}){super(),this.functionNode=e,this.parameters=i}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){let i=[],n=this.functionNode,r=n.getInputs(e),s=this.parameters,a=(i,n)=>{let r;let s=n.type;return"pointer"===s?"&"+i.build(e):i.build(e,s)};if(Array.isArray(s))for(let e=0;e<s.length;e++)i.push(a(s[e],r[e]));else for(let e of r){let n=s[e.name];if(void 0!==n)i.push(a(n,e));else throw Error(`FunctionCallNode: Input '${e.name}' not found in FunctionNode.`)}let o=n.build(e,"property");return`${o}( ${i.join(", ")} )`}}nR("call",(e,...i)=>(i=i.length>1||i[0]&&!0===i[0].isNode?n2(i):n1(i[0]),n0(new r2(n0(e),i))));class r3 extends ny{static get type(){return"OperatorNode"}constructor(e,i,n,...r){if(super(),r.length>0){let s=new r3(e,i,n);for(let i=0;i<r.length-1;i++)s=new r3(e,s,r[i]);i=s,n=r[r.length-1]}this.op=e,this.aNode=i,this.bNode=n}getNodeType(e,i){let n=this.op,r=this.aNode,s=this.bNode,a=r.getNodeType(e),o=void 0!==s?s.getNodeType(e):null;if("void"===a||"void"===o)return"void";if("%"===n)return a;if("~"===n||"&"===n||"|"===n||"^"===n||">>"===n||"<<"===n)return e.getIntegerType(a);if("!"===n||"=="===n||"&&"===n||"||"===n||"^^"===n)return"bool";if("<"===n||">"===n||"<="===n||">="===n){let n=i?e.getTypeLength(i):Math.max(e.getTypeLength(a),e.getTypeLength(o));return n>1?`bvec${n}`:"bool"}else{if("float"===a&&e.isMatrix(o))return o;if(e.isMatrix(a)&&e.isVector(o))return e.getVectorFromMatrix(a);if(e.isVector(a)&&e.isMatrix(o))return e.getVectorFromMatrix(o);else if(e.getTypeLength(o)>e.getTypeLength(a))return o;return a}}generate(e,i){let n=this.op,r=this.aNode,s=this.bNode,a=this.getNodeType(e,i),o=null,l=null;"void"!==a?(o=r.getNodeType(e),l=void 0!==s?s.getNodeType(e):null,"<"===n||">"===n||"<="===n||">="===n||"=="===n?e.isVector(o)?l=o:o!==l&&(o=l="float"):">>"===n||"<<"===n?(o=a,l=e.changeComponentType(l,"uint")):e.isMatrix(o)&&e.isVector(l)?l=e.getVectorFromMatrix(o):o=e.isVector(o)&&e.isMatrix(l)?e.getVectorFromMatrix(l):l=a):o=l=a;let h=r.build(e,o),u=void 0!==s?s.build(e,l):null,c=e.getTypeLength(i),d=e.getFunctionOperator(n);if("void"!==i){if("<"===n&&c>1)return e.useComparisonMethod?e.format(`${e.getMethod("lessThan",i)}( ${h}, ${u} )`,a,i):e.format(`( ${h} < ${u} )`,a,i);if("<="===n&&c>1)return e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",i)}( ${h}, ${u} )`,a,i):e.format(`( ${h} <= ${u} )`,a,i);if(">"===n&&c>1)return e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",i)}( ${h}, ${u} )`,a,i):e.format(`( ${h} > ${u} )`,a,i);else if(">="===n&&c>1)return e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",i)}( ${h}, ${u} )`,a,i):e.format(`( ${h} >= ${u} )`,a,i);else if("!"===n||"~"===n)return e.format(`(${n}${h})`,o,i);else if(d)return e.format(`${d}( ${h}, ${u} )`,a,i);else return e.format(`( ${h} ${n} ${u} )`,a,i)}if("void"!==o)return d?e.format(`${d}( ${h}, ${u} )`,a,i):e.format(`${h} ${n} ${u}`,a,i)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}let r4=n3(r3,"+"),r5=n3(r3,"-"),r6=n3(r3,"*"),r8=n3(r3,"/"),r7=n3(r3,"%"),r9=n3(r3,"=="),se=n3(r3,"!="),st=n3(r3,"<"),si=n3(r3,">"),sn=n3(r3,"<="),sr=n3(r3,">="),ss=n3(r3,"&&"),sa=n3(r3,"||"),so=n3(r3,"!"),sl=n3(r3,"^^"),sh=n3(r3,"&"),su=n3(r3,"~"),sc=n3(r3,"|"),sd=n3(r3,"^"),sp=n3(r3,"<<"),sf=n3(r3,">>");nR("add",r4),nR("sub",r5),nR("mul",r6),nR("div",r8),nR("modInt",r7),nR("equal",r9),nR("notEqual",se),nR("lessThan",st),nR("greaterThan",si),nR("lessThanEqual",sn),nR("greaterThanEqual",sr),nR("and",ss),nR("or",sa),nR("not",so),nR("xor",sl),nR("bitAnd",sh),nR("bitNot",su),nR("bitOr",sc),nR("bitXor",sd),nR("shiftLeft",sp),nR("shiftRight",sf),nR("remainder",(...e)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),r7(...e)));class sm extends ny{static get type(){return"MathNode"}constructor(e,i,n=null,r=null){super(),this.method=e,this.aNode=i,this.bNode=n,this.cNode=r}getInputType(e){let i=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(i)?0:e.getTypeLength(i),a=e.isMatrix(n)?0:e.getTypeLength(n),o=e.isMatrix(r)?0:e.getTypeLength(r);if(s>a&&s>o);else if(a>o)return n;else if(o>s)return r;return i}getNodeType(e){let i=this.method;if(i===sm.LENGTH||i===sm.DISTANCE||i===sm.DOT)return"float";if(i===sm.CROSS)return"vec3";if(i===sm.ALL)return"bool";if(i===sm.EQUALS)return e.changeComponentType(this.aNode.getNodeType(e),"bool");if(i===sm.MOD)return this.aNode.getNodeType(e);else return this.getInputType(e)}generate(e,i){let n=this.method,r=this.getNodeType(e),s=this.getInputType(e),a=this.aNode,o=this.bNode,l=this.cNode,h=e.renderer.coordinateSystem;if(n===sm.TRANSFORM_DIRECTION){let n=a,r=o;return e.isMatrix(n.getNodeType(e))?r=rd(rl(r),0):n=rd(rl(n),0),sI(r6(n,r).xyz).build(e,i)}if(n===sm.NEGATE)return e.format("( - "+a.build(e,s)+" )",r,i);if(n===sm.ONE_MINUS)return r5(1,a).build(e,i);{if(n===sm.RECIPROCAL)return r8(1,a).build(e,i);if(n===sm.DIFFERENCE)return sk(r5(a,o)).build(e,i);let u=[];return n===sm.CROSS||n===sm.MOD?u.push(a.build(e,r),o.build(e,r)):h===eE._RZ&&n===sm.STEP?u.push(a.build(e,1===e.getTypeLength(a.getNodeType(e))?"float":s),o.build(e,s)):h===eE._RZ&&(n===sm.MIN||n===sm.MAX)||n===sm.MOD?u.push(a.build(e,s),o.build(e,1===e.getTypeLength(o.getNodeType(e))?"float":s)):n===sm.REFRACT?u.push(a.build(e,s),o.build(e,s),l.build(e,"float")):n===sm.MIX?u.push(a.build(e,s),o.build(e,s),l.build(e,1===e.getTypeLength(l.getNodeType(e))?"float":s)):(h===eE.JCZ&&n===sm.ATAN&&null!==o&&(n="atan2"),u.push(a.build(e,s)),null!==o&&u.push(o.build(e,s)),null!==l&&u.push(l.build(e,s))),e.format(`${e.getMethod(n,r)}( ${u.join(", ")} )`,r,i)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}sm.ALL="all",sm.ANY="any",sm.RADIANS="radians",sm.DEGREES="degrees",sm.EXP="exp",sm.EXP2="exp2",sm.LOG="log",sm.LOG2="log2",sm.SQRT="sqrt",sm.INVERSE_SQRT="inversesqrt",sm.FLOOR="floor",sm.CEIL="ceil",sm.NORMALIZE="normalize",sm.FRACT="fract",sm.SIN="sin",sm.COS="cos",sm.TAN="tan",sm.ASIN="asin",sm.ACOS="acos",sm.ATAN="atan",sm.ABS="abs",sm.SIGN="sign",sm.LENGTH="length",sm.NEGATE="negate",sm.ONE_MINUS="oneMinus",sm.DFDX="dFdx",sm.DFDY="dFdy",sm.ROUND="round",sm.RECIPROCAL="reciprocal",sm.TRUNC="trunc",sm.FWIDTH="fwidth",sm.TRANSPOSE="transpose",sm.BITCAST="bitcast",sm.EQUALS="equals",sm.MIN="min",sm.MAX="max",sm.MOD="mod",sm.STEP="step",sm.REFLECT="reflect",sm.DISTANCE="distance",sm.DIFFERENCE="difference",sm.DOT="dot",sm.CROSS="cross",sm.POW="pow",sm.TRANSFORM_DIRECTION="transformDirection",sm.MIX="mix",sm.CLAMP="clamp",sm.REFRACT="refract",sm.SMOOTHSTEP="smoothstep",sm.FACEFORWARD="faceforward";let sg=re(1e-6),sA=re(Math.PI),sv=n3(sm,sm.ALL),sy=n3(sm,sm.ANY),sx=n3(sm,sm.RADIANS),s_=n3(sm,sm.DEGREES),sb=n3(sm,sm.EXP),sE=n3(sm,sm.EXP2),sw=n3(sm,sm.LOG),sM=n3(sm,sm.LOG2),sC=n3(sm,sm.SQRT),sS=n3(sm,sm.INVERSE_SQRT),sT=n3(sm,sm.FLOOR),sR=n3(sm,sm.CEIL),sI=n3(sm,sm.NORMALIZE),sB=n3(sm,sm.FRACT),sL=n3(sm,sm.SIN),sP=n3(sm,sm.COS),sD=n3(sm,sm.TAN),sN=n3(sm,sm.ASIN),sO=n3(sm,sm.ACOS),sU=n3(sm,sm.ATAN),sk=n3(sm,sm.ABS),sF=n3(sm,sm.SIGN),sz=n3(sm,sm.LENGTH),sG=n3(sm,sm.NEGATE),sV=n3(sm,sm.ONE_MINUS),sj=n3(sm,sm.DFDX),sH=n3(sm,sm.DFDY),sQ=n3(sm,sm.ROUND),sW=n3(sm,sm.RECIPROCAL),sq=n3(sm,sm.TRUNC),sX=n3(sm,sm.FWIDTH),sK=n3(sm,sm.TRANSPOSE);sm.BITCAST;let sY=n3(sm,sm.EQUALS),sJ=n3(sm,sm.MIN),sZ=n3(sm,sm.MAX),s$=n3(sm,sm.MOD),s0=n3(sm,sm.STEP),s1=n3(sm,sm.REFLECT),s2=n3(sm,sm.DISTANCE),s3=n3(sm,sm.DIFFERENCE),s4=n3(sm,sm.DOT),s5=n3(sm,sm.CROSS),s6=n3(sm,sm.POW),s8=n3(sm,sm.POW,2),s7=n3(sm,sm.POW,3),s9=n3(sm,sm.POW,4),ae=n3(sm,sm.TRANSFORM_DIRECTION),at=n3(sm,sm.MIX),ai=(e,i=0,n=1)=>n0(new sm(sm.CLAMP,n0(e),n0(i),n0(n))),an=n3(sm,sm.REFRACT),ar=n3(sm,sm.SMOOTHSTEP),as=n3(sm,sm.FACEFORWARD),aa=n5(([e])=>sB(sL(s$(s4(e.xy,rr(12.9898,78.233)),sA)).mul(43758.5453)));nR("all",sv),nR("any",sy),nR("equals",sY),nR("radians",sx),nR("degrees",s_),nR("exp",sb),nR("exp2",sE),nR("log",sw),nR("log2",sM),nR("sqrt",sC),nR("inverseSqrt",sS),nR("floor",sT),nR("ceil",sR),nR("normalize",sI),nR("fract",sB),nR("sin",sL),nR("cos",sP),nR("tan",sD),nR("asin",sN),nR("acos",sO),nR("atan",sU),nR("abs",sk),nR("sign",sF),nR("length",sz),nR("lengthSq",e=>s4(e,e)),nR("negate",sG),nR("oneMinus",sV),nR("dFdx",sj),nR("dFdy",sH),nR("round",sQ),nR("reciprocal",sW),nR("trunc",sq),nR("fwidth",sX),nR("atan2",(e,i)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),sU(e,i))),nR("min",sJ),nR("max",sZ),nR("mod",s$),nR("step",s0),nR("reflect",s1),nR("distance",s2),nR("dot",s4),nR("cross",s5),nR("pow",s6),nR("pow2",s8),nR("pow3",s7),nR("pow4",s9),nR("transformDirection",ae),nR("mix",(e,i,n)=>at(i,n,e)),nR("clamp",ai),nR("refract",an),nR("smoothstep",(e,i,n)=>ar(i,n,e)),nR("faceForward",as),nR("difference",s3),nR("saturate",e=>ai(e)),nR("cbrt",e=>r6(sF(e),s6(sk(e),1/3))),nR("transpose",sK),nR("rand",aa);let ao=n3(class extends ng{static get type(){return"ConditionalNode"}constructor(e,i,n=null){super(),this.condNode=e,this.ifNode=i,this.elseNode=n}getNodeType(e){let{ifNode:i,elseNode:n}=e.getNodeProperties(this);if(void 0===i)return this.setup(e),this.getNodeType(e);let r=i.getNodeType(e);if(null!==n){let i=n.getNodeType(e);if(e.getTypeLength(i)>e.getTypeLength(r))return i}return r}setup(e){let i=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=s,null!==r&&(e.getDataFromNode(r).parentNodeBlock=s);let a=e.getNodeProperties(this);a.condNode=i,a.ifNode=n.context({nodeBlock:n}),a.elseNode=r?r.context({nodeBlock:r}):null}generate(e,i){let n=this.getNodeType(e),r=e.getDataFromNode(this);if(void 0!==r.nodeProperty)return r.nodeProperty;let{condNode:s,ifNode:a,elseNode:o}=e.getNodeProperties(this),l="void"!==i,h=l?rS(n).build(e):"";r.nodeProperty=h;let u=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${u} ) {

`).addFlowTab();let c=a.build(e,n);if(c&&(c=l?h+" = "+c+";":"return "+c+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+c+"\n\n"+e.tab+"}"),null!==o){e.addFlowCode(" else {\n\n").addFlowTab();let i=o.build(e,n);i&&(i=l?h+" = "+i+";":"return "+i+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+i+"\n\n"+e.tab+"}\n\n")}else e.addFlowCode("\n\n");return e.format(h,n,i)}});nR("select",ao),nR("cond",(...e)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),ao(...e)));class al extends ng{static get type(){return"ContextNode"}constructor(e,i={}){super(),this.isContextNode=!0,this.node=e,this.value=i}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){let i=e.getContext();e.setContext({...e.context,...this.value});let n=this.node.build(e);return e.setContext(i),n}generate(e,i){let n=e.getContext();e.setContext({...e.context,...this.value});let r=this.node.build(e,i);return e.setContext(n),r}}let ah=n3(al);nR("context",ah),nR("label",(e,i)=>ah(e,{label:i}));class au extends ng{static get type(){return"VarNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){let{node:i,name:n}=this,r=e.getVarFromNode(this,n,e.getVectorType(this.getNodeType(e))),s=e.getPropertyName(r),a=i.build(e,r.type);return e.addLineFlowCode(`${s} = ${a}`,this),s}}let ac=n3(au);nR("toVar",(...e)=>ac(...e).append()),nR("temp",e=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),ac(e)));let ad=n3(class extends ng{static get type(){return"VaryingNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){let i=e.getNodeProperties(this),n=i.varying;if(void 0===n){let r=this.name,s=this.getNodeType(e);i.varying=n=e.getVaryingFromNode(this,r,s),i.node=this.node}return n.needsInterpolation||(n.needsInterpolation="fragment"===e.shaderStage),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){let i=e.getNodeProperties(this),n=this.setupVarying(e),r="fragment"===e.shaderStage&&!0===i.reassignPosition&&e.context.needsPositionReassign;if(void 0===i.propertyName||r){let s=this.getNodeType(e),a=e.getPropertyName(n,nh.VERTEX);e.flowNodeFromShaderStage(nh.VERTEX,this.node,s,a),i.propertyName=a,r?i.reassignPosition=!1:void 0===i.reassignPosition&&e.context.isPositionNodeInput&&(i.reassignPosition=!0)}return e.getPropertyName(n)}});nR("varying",ad),nR("vertexStage",e=>ad(e));let ap=n5(([e])=>{let i=e.mul(.9478672986).add(.0521327014).pow(2.4);return at(i,e.mul(.0773993808),e.lessThanEqual(.04045))}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),af=n5(([e])=>{let i=e.pow(.41666).mul(1.055).sub(.055);return at(i,e.mul(12.92),e.lessThanEqual(.0031308))}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),am="WorkingColorSpace",ag="OutputColorSpace";class aA extends ny{static get type(){return"ColorSpaceNode"}constructor(e,i,n){super("vec4"),this.colorNode=e,this.source=i,this.target=n}resolveColorSpace(e,i){return i===am?eE.epp.workingColorSpace:i===ag?e.context.outputColorSpace||e.renderer.outputColorSpace:i}setup(e){let{colorNode:i}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target),s=i;return!1!==eE.epp.enabled&&n!==r&&n&&r&&(eE.epp.getTransfer(n)===eE.j17&&(s=rd(ap(s.rgb),s.a)),eE.epp.getPrimaries(n)!==eE.epp.getPrimaries(r)&&(s=rd(rA(eE.epp._getMatrix(new eE.Vkp,n,r)).mul(s.rgb),s.a)),eE.epp.getTransfer(r)===eE.j17&&(s=rd(af(s.rgb),s.a))),s}}let av=(e,i)=>n0(new aA(n0(e),i,am));nR("toOutputColorSpace",e=>n0(new aA(n0(e),am,ag))),nR("toWorkingColorSpace",e=>n0(new aA(n0(e),ag,am))),nR("workingToColorSpace",(e,i)=>n0(new aA(n0(e),am,i))),nR("colorSpaceToWorking",av);let ay=class extends nA{static get type(){return"ReferenceElementNode"}constructor(e,i){super(e,i),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){let i=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(i,n,r)}};class ax extends ng{static get type(){return"ReferenceBaseNode"}constructor(e,i,n=null,r=null){super(),this.property=e,this.uniformType=i,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=nu.OBJECT}setGroup(e){return this.group=e,this}element(e){return n0(new ay(this,n0(e)))}setNodeType(e){let i=rM(null,e).getSelf();null!==this.group&&i.setGroup(this.group),this.node=i}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){let{properties:i}=this,n=e[i[0]];for(let e=1;e<i.length;e++)n=n[i[e]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}let a_=(e,i,n)=>n0(new ax(e,i,n));class ab extends ax{static get type(){return"RendererReferenceNode"}constructor(e,i,n=null){super(e,i,n),this.renderer=n,this.setGroup(rb)}updateReference(e){return this.reference=null!==this.renderer?this.renderer:e.renderer,this.reference}}class aE extends ny{static get type(){return"ToneMappingNode"}constructor(e,i=aM,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=i,this.colorNode=n}customCacheKey(){return nt(this.toneMapping)}setup(e){let i=this.colorNode||e.context.color,n=this.toneMapping;if(n===eE.uL9)return i;let r=null,s=e.renderer.library.getToneMappingFunction(n);return null!==s?r=rd(s(i.rgb,this.exposureNode),i.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=i),r}}let aw=(e,i,n)=>n0(new aE(e,n0(i),n0(n))),aM=((e,i,n=null)=>n0(new ab(e,i,n)))("toneMappingExposure","float");nR("toneMapping",(e,i,n)=>aw(i,n,e));class aC extends nM{static get type(){return"BufferAttributeNode"}constructor(e,i=null,n=0,r=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferStride=n,this.bufferOffset=r,this.usage=eE.W2J,this.instanced=!1,this.attribute=null,this.global=!0,e&&!0===e.isBufferAttribute&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(0===this.bufferStride&&0===this.bufferOffset){let i=e.globalCache.getData(this.value);return void 0===i&&(i={node:this},e.globalCache.setData(this.value,i)),i.node.uuid}return this.uuid}getNodeType(e){return null===this.bufferType&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(null!==this.attribute)return;let i=this.getNodeType(e),n=this.value,r=e.getTypeLength(i),s=this.bufferStride||r,a=this.bufferOffset,o=!0===n.isInterleavedBuffer?n:new eE.vpT(n,s),l=new eE.kB5(o,r,a);o.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){let i=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,i),r=e.getPropertyName(n),s=null;return"vertex"===e.shaderStage||"compute"===e.shaderStage?(this.name=r,s=r):s=ad(this).build(e,i),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}let aS=(e,i=null,n=0,r=0)=>n0(new aC(e,i,n,r)),aT=(e,i=null,n=0,r=0)=>aS(e,i,n,r).setUsage(eE.dj0),aR=(e,i=null,n=0,r=0)=>aS(e,i,n,r).setInstanced(!0),aI=(e,i=null,n=0,r=0)=>aT(e,i,n,r).setInstanced(!0);nR("toAttribute",e=>aS(e.value));class aB extends ng{static get type(){return"ComputeNode"}constructor(e,i,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=i,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=nu.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){let{count:e,workgroupSize:i}=this,n=i[0];for(let e=1;e<i.length;e++)n*=i[e];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}generate(e){let{shaderStage:i}=e;if("compute"===i){let i=this.computeNode.build(e,"void");""!==i&&e.addLineFlowCode(i,this)}}}nR("compute",(e,i,n)=>n0(new aB(n0(e),i,n)));class aL extends ng{static get type(){return"CacheNode"}constructor(e,i=!0){super(),this.node=e,this.parent=i,this.isCacheNode=!0}getNodeType(e){let i=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);let r=this.node.getNodeType(e);return e.setCache(i),r}build(e,...i){let n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);let s=this.node.build(e,...i);return e.setCache(n),s}}let aP=(e,i)=>n0(new aL(n0(e),i));nR("cache",aP),nR("bypass",n3(class extends ng{static get type(){return"BypassNode"}constructor(e,i){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=i}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){let i=this.callNode.build(e,"void");return""!==i&&e.addLineFlowCode(i,this),this.outputNode.build(e)}}));class aD extends ng{static get type(){return"RemapNode"}constructor(e,i,n,r=re(0),s=re(1)){super(),this.node=e,this.inLowNode=i,this.inHighNode=n,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){let{node:e,inLowNode:i,inHighNode:n,outLowNode:r,outHighNode:s,doClamp:a}=this,o=e.sub(i).div(n.sub(i));return!0===a&&(o=o.clamp()),o.mul(s.sub(r)).add(r)}}let aN=n3(aD,null,null,{doClamp:!1}),aO=n3(aD);nR("remap",aN),nR("remapClamp",aO);class aU extends ng{static get type(){return"ExpressionNode"}constructor(e="",i="void"){super(i),this.snippet=e}generate(e,i){let n=this.getNodeType(e),r=this.snippet;if("void"!==n)return e.format(`( ${r} )`,n,i);e.addLineFlowCode(r,this)}}let ak=n3(aU);nR("discard",e=>(e?ao(e,ak("discard")):ak("discard")).append());class aF extends ny{static get type(){return"RenderOutputNode"}constructor(e,i,n){super("vec4"),this.colorNode=e,this.toneMapping=i,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:e}){let i=this.colorNode||e.color,n=(null!==this.toneMapping?this.toneMapping:e.toneMapping)||eE.uL9,r=(null!==this.outputColorSpace?this.outputColorSpace:e.outputColorSpace)||eE.aCh;return n!==eE.uL9&&(i=i.toneMapping(n)),r!==eE.aCh&&r!==eE.epp.workingColorSpace&&(i=i.workingToColorSpace(r)),i}}nR("renderOutput",(e,i=null,n=null)=>n0(new aF(n0(e),i,n)));class az extends ng{static get type(){return"AttributeNode"}constructor(e,i=null){super(i),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let i=this.nodeType;if(null===i){let n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){let r=e.geometry.getAttribute(n);i=e.getTypeFromAttribute(r)}else i="float"}return i}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){let i=this.getAttributeName(e),n=this.getNodeType(e);if(!0!==e.hasGeometryAttribute(i))return console.warn(`AttributeNode: Vertex attribute "${i}" not found on geometry.`),e.generateConst(n);{let r=e.geometry.getAttribute(i),s=e.getTypeFromAttribute(r),a=e.getAttribute(i,s);return"vertex"===e.shaderStage?e.format(a.name,s,n):ad(this).build(e,n)}}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}let aG=(e,i)=>n0(new az(e,i)),aV=(e=0)=>aG("uv"+(e>0?e:""),"vec2"),aj=n3(class extends ng{static get type(){return"TextureSizeNode"}constructor(e,i=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=i}generate(e,i){let n=this.textureNode.build(e,"property"),r=null===this.levelNode?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),i)}}),aH=n3(class extends rw{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=nu.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){let e=this.texture,i=e.images,n=i&&i.length>0?i[0]&&i[0].image||i[0]:e.image;if(n&&void 0!==n.width){let{width:e,height:i}=n;this.value=Math.log2(Math.max(e,i))}}});class aQ extends rw{static get type(){return"TextureNode"}constructor(e,i=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=i,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=nu.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(null===i)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===eE.JQ4?"uvec4":this.value.type===eE.Kz5?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return aV(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return null===this._matrixUniform&&(this._matrixUniform=rM(this.value.matrix)),this._matrixUniform.mul(rl(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?nu.RENDER:nu.NONE,this}setupUV(e,i){let n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&!0===n.flipY||!0===n.isRenderTargetTexture||!0===n.isFramebufferTexture||!0===n.isDepthTexture)&&(i=this.sampler?i.flipY():i.setY(rt(aj(this,this.levelNode).y).sub(i.y).sub(1))),i}setup(e){let i=e.getNodeProperties(this);i.referenceNode=this.referenceNode;let n=this.value;if(!n||!0!==n.isTexture)throw Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(null===r||!0===e.context.forceUVContext)&&e.context.getUV&&(r=e.context.getUV(this)),r||(r=this.getDefaultUV()),!0===this.updateMatrix&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;null===s&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),i.uvNode=r,i.levelNode=s,i.biasNode=this.biasNode,i.compareNode=this.compareNode,i.gradNode=this.gradNode,i.depthNode=this.depthNode}generateUV(e,i){return i.build(e,!0===this.sampler?"vec2":"ivec2")}generateSnippet(e,i,n,r,s,a,o,l){let h;let u=this.value;return r?e.generateTextureLevel(u,i,n,r,a):s?e.generateTextureBias(u,i,n,s,a):l?e.generateTextureGrad(u,i,n,l,a):o?e.generateTextureCompare(u,i,n,o,a):!1===this.sampler?e.generateTextureLoad(u,i,n,a):e.generateTexture(u,i,n,a)}generate(e,i){let n=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if("sampler"===i)return s+"_sampler";if(e.isReference(i))return s;{let a=e.getDataFromNode(this),o=a.propertyName;if(void 0===o){let{uvNode:i,levelNode:n,biasNode:l,compareNode:h,depthNode:u,gradNode:c}=r,d=this.generateUV(e,i),p=n?n.build(e,"float"):null,f=l?l.build(e,"float"):null,m=u?u.build(e,"int"):null,g=h?h.build(e,"float"):null,A=c?[c[0].build(e,"vec2"),c[1].build(e,"vec2")]:null,v=e.getVarFromNode(this);o=e.getPropertyName(v);let y=this.generateSnippet(e,s,d,p,f,m,g,A);e.addLineFlowCode(`${o} = ${y}`,this),a.snippet=y,a.propertyName=o}let l=o,h=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(l=av(ak(l,h),n.colorSpace).setup(e).build(e,h)),e.format(l,h,i)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){let i=this.clone();return i.uvNode=n0(e),i.referenceNode=this.getSelf(),n0(i)}blur(e){let i=this.clone();return i.biasNode=n0(e).mul(aH(i)),i.referenceNode=this.getSelf(),n0(i)}level(e){let i=this.clone();return i.levelNode=n0(e),i.referenceNode=this.getSelf(),n0(i)}size(e){return aj(this,e)}bias(e){let i=this.clone();return i.biasNode=n0(e),i.referenceNode=this.getSelf(),n0(i)}compare(e){let i=this.clone();return i.compareNode=n0(e),i.referenceNode=this.getSelf(),n0(i)}grad(e,i){let n=this.clone();return n.gradNode=[n0(e),n0(i)],n.referenceNode=this.getSelf(),n0(n)}depth(e){let i=this.clone();return i.depthNode=n0(e),i.referenceNode=this.getSelf(),n0(i)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){let e=this.value,i=this._matrixUniform;null!==i&&(i.value=e.matrix),!0===e.matrixAutoUpdate&&e.updateMatrix()}clone(){let e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}let aW=n3(aQ),aq=(...e)=>aW(...e).setSampler(!1),aX=rM("float").label("cameraNear").setGroup(rb).onRenderUpdate(({camera:e})=>e.near),aK=rM("float").label("cameraFar").setGroup(rb).onRenderUpdate(({camera:e})=>e.far),aY=rM("mat4").label("cameraProjectionMatrix").setGroup(rb).onRenderUpdate(({camera:e})=>e.projectionMatrix),aJ=rM("mat4").label("cameraViewMatrix").setGroup(rb).onRenderUpdate(({camera:e})=>e.matrixWorldInverse),aZ=rM(new eE.Pa4).label("cameraPosition").setGroup(rb).onRenderUpdate(({camera:e},i)=>i.value.setFromMatrixPosition(e.matrixWorld));class a$ extends ng{static get type(){return"Object3DNode"}constructor(e,i=null){super(),this.scope=e,this.object3d=i,this.updateType=nu.OBJECT,this._uniformNode=new rw(null)}getNodeType(){let e=this.scope;return e===a$.WORLD_MATRIX?"mat4":e===a$.POSITION||e===a$.VIEW_POSITION||e===a$.DIRECTION||e===a$.SCALE?"vec3":void 0}update(e){let i=this.object3d,n=this._uniformNode,r=this.scope;if(r===a$.WORLD_MATRIX)n.value=i.matrixWorld;else if(r===a$.POSITION)n.value=n.value||new eE.Pa4,n.value.setFromMatrixPosition(i.matrixWorld);else if(r===a$.SCALE)n.value=n.value||new eE.Pa4,n.value.setFromMatrixScale(i.matrixWorld);else if(r===a$.DIRECTION)n.value=n.value||new eE.Pa4,i.getWorldDirection(n.value);else if(r===a$.VIEW_POSITION){let r=e.camera;n.value=n.value||new eE.Pa4,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}}generate(e){let i=this.scope;return i===a$.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(i===a$.POSITION||i===a$.VIEW_POSITION||i===a$.DIRECTION||i===a$.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}a$.WORLD_MATRIX="worldMatrix",a$.POSITION="position",a$.SCALE="scale",a$.VIEW_POSITION="viewPosition",a$.DIRECTION="direction",a$.DIRECTION,a$.WORLD_MATRIX;let a0=n3(a$,a$.POSITION);a$.SCALE,a$.VIEW_POSITION;class a1 extends a${static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}a1.DIRECTION;let a2=n4(a1,a1.WORLD_MATRIX);a1.POSITION,a1.SCALE,a1.VIEW_POSITION;let a3=rM(new eE.Vkp).onObjectUpdate(({object:e},i)=>i.value.getNormalMatrix(e.matrixWorld)),a4=n5(e=>e.renderer.nodes.modelViewMatrix||a5).once()().toVar("modelViewMatrix"),a5=aJ.mul(a2),a6=aG("position","vec3"),a8=a6.varying("positionLocal"),a7=a6.varying("positionPrevious"),a9=a2.mul(a8).xyz.varying("v_positionWorld").context({needsPositionReassign:!0}),oe=a8.transformDirection(a2).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),ot=n5(e=>e.context.setupPositionView(),"vec3").once()().varying("v_positionView").context({needsPositionReassign:!0}),oi=ot.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection"),on=re(n4(class extends ng{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){let{renderer:i,material:n}=e;return i.coordinateSystem===eE._RZ&&n.side===eE._Li?"false":e.getFrontFacing()}})).mul(2).sub(1),or=aG("normal","vec3"),os=n5(e=>!1===e.geometry.hasAttribute("normal")?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),rl(0,1,0)):or,"vec3").once()().toVar("normalLocal"),oa=ot.dFdx().cross(ot.dFdy()).normalize().toVar("normalFlat"),oo=n5(e=>{let i;return!0===e.material.flatShading?oa:ad(op(os),"v_normalView").normalize()},"vec3").once()().toVar("normalView"),ol=ad(oo.transformDirection(aJ),"v_normalWorld").normalize().toVar("normalWorld"),oh=n5(e=>e.context.setupNormal(),"vec3").once()().mul(on).toVar("transformedNormalView"),ou=oh.transformDirection(aJ).toVar("transformedNormalWorld"),oc=n5(e=>e.context.setupClearcoatNormal(),"vec3").once()().mul(on).toVar("transformedClearcoatNormalView"),od=n5(([e,i=a2])=>{let n=rA(i),r=e.div(rl(n[0].dot(n[0]),n[1].dot(n[1]),n[2].dot(n[2])));return n.mul(r).xyz}),op=n5(([e],i)=>{let n=i.renderer.nodes.modelNormalViewMatrix;if(null!==n)return n.transformDirection(e);let r=a3.mul(e);return aJ.transformDirection(r)}),of=rM(0).onReference(({material:e})=>e).onRenderUpdate(({material:e})=>e.refractionRatio),om=oi.negate().reflect(oh),og=oi.negate().refract(oh,of),oA=om.transformDirection(aJ).toVar("reflectVector"),ov=og.transformDirection(aJ).toVar("reflectVector"),oy=n3(class extends aQ{static get type(){return"CubeTextureNode"}constructor(e,i=null,n=null,r=null){super(e,i,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){let e=this.value;return e.mapping===eE.fY$?oA:e.mapping===eE.vxC?ov:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),rl(0,0,0))}setUpdateMatrix(){}setupUV(e,i){let n=this.value;return e.renderer.coordinateSystem!==eE.JCZ&&n.isRenderTargetTexture?i:rl(i.x.negate(),i.yz)}generateUV(e,i){return i.build(e,"vec3")}});class ox extends rw{static get type(){return"BufferNode"}constructor(e,i,n=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}let o_=(e,i,n)=>n0(new ox(e,i,n));class ob extends nA{static get type(){return"UniformArrayElementNode"}constructor(e,i){super(e,i),this.isArrayBufferElementNode=!0}generate(e){let i=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(i,r,n)}}class oE extends ox{static get type(){return"UniformArrayNode"}constructor(e,i=null){super(null),this.array=e,this.elementType=null===i?na(e[0]):i,this.paddedType=this.getPaddedType(),this.updateType=nu.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){let e=this.elementType,i="vec4";return"mat2"===e?i="mat2":!0===/mat/.test(e)?i="mat4":"i"===e.charAt(0)?i="ivec4":"u"===e.charAt(0)&&(i="uvec4"),i}update(){let{array:e,value:i}=this,n=this.elementType;if("float"===n||"int"===n||"uint"===n)for(let n=0;n<e.length;n++)i[4*n]=e[n];else if("color"===n)for(let n=0;n<e.length;n++){let r=4*n,s=e[n];i[r]=s.r,i[r+1]=s.g,i[r+2]=s.b||0}else if("mat2"===n)for(let n=0;n<e.length;n++){let r=4*n,s=e[n];i[r]=s.elements[0],i[r+1]=s.elements[1],i[r+2]=s.elements[2],i[r+3]=s.elements[3]}else if("mat3"===n)for(let n=0;n<e.length;n++){let r=16*n,s=e[n];i[r]=s.elements[0],i[r+1]=s.elements[1],i[r+2]=s.elements[2],i[r+4]=s.elements[3],i[r+5]=s.elements[4],i[r+6]=s.elements[5],i[r+8]=s.elements[6],i[r+9]=s.elements[7],i[r+10]=s.elements[8],i[r+15]=1}else if("mat4"===n)for(let n=0;n<e.length;n++){let r=16*n,s=e[n];for(let e=0;e<s.elements.length;e++)i[r+e]=s.elements[e]}else for(let n=0;n<e.length;n++){let r=4*n,s=e[n];i[r]=s.x,i[r+1]=s.y,i[r+2]=s.z||0,i[r+3]=s.w||0}}setup(e){let i=this.array.length,n=this.elementType,r=Float32Array,s=this.paddedType,a=e.getTypeLength(s);return"i"===n.charAt(0)&&(r=Int32Array),"u"===n.charAt(0)&&(r=Uint32Array),this.value=new r(i*a),this.bufferCount=i,this.bufferType=s,super.setup(e)}element(e){return n0(new ob(this,n0(e)))}}let ow=(e,i)=>n0(new oE(e,i));class oM extends nA{static get type(){return"ReferenceElementNode"}constructor(e,i){super(e,i),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){let i=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(i,n,r)}}class oC extends ng{static get type(){return"ReferenceNode"}constructor(e,i,n=null,r=null){super(),this.property=e,this.uniformType=i,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=nu.OBJECT}element(e){return n0(new oM(this,n0(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let i=null;i=null!==this.count?o_(null,e,this.count):Array.isArray(this.getValueFromReference())?ow(null,e):"texture"===e?aW(null):"cubeTexture"===e?oy(null):rM(null,e),null!==this.group&&i.setGroup(this.group),null!==this.name&&i.label(this.name),this.node=i.getSelf()}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){let{properties:i}=this,n=e[i[0]];for(let e=1;e<i.length;e++)n=n[i[e]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}let oS=(e,i,n)=>n0(new oC(e,i,n)),oT=(e,i,n,r)=>n0(new oC(e,i,r,n));class oR extends oC{static get type(){return"MaterialReferenceNode"}constructor(e,i,n=null){super(e,i,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=null!==this.material?this.material:e.material,this.reference}}let oI=(e,i,n=null)=>n0(new oR(e,i,n)),oB=n5(e=>(!1===e.geometry.hasAttribute("tangent")&&e.geometry.computeTangents(),aG("tangent","vec4")))(),oL=oB.xyz.toVar("tangentLocal"),oP=a4.mul(rd(oL,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),oD=ad(oo.cross(oP).mul(oB.w).xyz,"v_bitangentView").normalize().toVar("bitangentView"),oN=rA(oP,oD,oo),oO=at(rj.cross(oi).cross(rj).normalize(),oh,rG.mul(rB.oneMinus()).oneMinus().pow2().pow2()).normalize(),oU=n5(e=>{let{eye_pos:i,surf_norm:n,mapN:r,uv:s}=e,a=i.dFdx(),o=i.dFdy(),l=s.dFdx(),h=s.dFdy(),u=o.cross(n),c=n.cross(a),d=u.mul(l.x).add(c.mul(h.x)),p=u.mul(l.y).add(c.mul(h.y)),f=d.dot(d).max(p.dot(p)),m=on.mul(f.inverseSqrt());return r4(d.mul(r.x,m),p.mul(r.y,m),n.mul(r.z)).normalize()}),ok=n3(class extends ny{static get type(){return"NormalMapNode"}constructor(e,i=null){super("vec3"),this.node=e,this.scaleNode=i,this.normalMapType=eE.IOt}setup(e){let{normalMapType:i,scaleNode:n}=this,r=this.node.mul(2).sub(1);null!==n&&(r=rl(r.xy.mul(n),r.z));let s=null;return i===eE.PA7?s=op(r):i===eE.IOt&&(s=!0===e.hasGeometryAttribute("tangent")?oN.mul(r).normalize():oU({eye_pos:ot,surf_norm:oo,mapN:r,uv:aV()})),s}}),oF=n5(({textureNode:e,bumpScale:i})=>{let n=i=>e.cache().context({getUV:e=>i(e.uvNode||aV()),forceUVContext:!0}),r=re(n(e=>e));return rr(re(n(e=>e.add(e.dFdx()))).sub(r),re(n(e=>e.add(e.dFdy()))).sub(r)).mul(i)}),oz=n5(e=>{let{surf_pos:i,surf_norm:n,dHdxy:r}=e,s=i.dFdx().normalize(),a=i.dFdy().normalize().cross(n),o=n.cross(s),l=s.dot(a).mul(on),h=l.sign().mul(r.x.mul(a).add(r.y.mul(o)));return l.abs().mul(n).sub(h).normalize()}),oG=n3(class extends ny{static get type(){return"BumpMapNode"}constructor(e,i=null){super("vec3"),this.textureNode=e,this.scaleNode=i}setup(){let e=null!==this.scaleNode?this.scaleNode:1;return oz({surf_pos:ot,surf_norm:oo,dHdxy:oF({textureNode:this.textureNode,bumpScale:e})})}}),oV=new Map;class oj extends ng{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,i){let n=oV.get(e);return void 0===n&&(n=oI(e,i),oV.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache("map"===e?"map":e+"Map","texture")}setup(e){let i=e.context.material,n=this.scope,r=null;if(n===oj.COLOR){let e=void 0!==i.color?this.getColor(n):rl();r=i.map&&!0===i.map.isTexture?e.mul(this.getTexture("map")):e}else if(n===oj.OPACITY){let e=this.getFloat(n);r=i.alphaMap&&!0===i.alphaMap.isTexture?e.mul(this.getTexture("alpha")):e}else if(n===oj.SPECULAR_STRENGTH)r=i.specularMap&&!0===i.specularMap.isTexture?this.getTexture("specular").r:re(1);else if(n===oj.SPECULAR_INTENSITY){let e=this.getFloat(n);r=i.specularIntensityMap&&!0===i.specularIntensityMap.isTexture?e.mul(this.getTexture(n).a):e}else if(n===oj.SPECULAR_COLOR){let e=this.getColor(n);r=i.specularColorMap&&!0===i.specularColorMap.isTexture?e.mul(this.getTexture(n).rgb):e}else if(n===oj.ROUGHNESS){let e=this.getFloat(n);r=i.roughnessMap&&!0===i.roughnessMap.isTexture?e.mul(this.getTexture(n).g):e}else if(n===oj.METALNESS){let e=this.getFloat(n);r=i.metalnessMap&&!0===i.metalnessMap.isTexture?e.mul(this.getTexture(n).b):e}else if(n===oj.EMISSIVE){let e=this.getFloat("emissiveIntensity"),s=this.getColor(n).mul(e);r=i.emissiveMap&&!0===i.emissiveMap.isTexture?s.mul(this.getTexture(n)):s}else if(n===oj.NORMAL)i.normalMap?(r=ok(this.getTexture("normal"),this.getCache("normalScale","vec2"))).normalMapType=i.normalMapType:r=i.bumpMap?oG(this.getTexture("bump").r,this.getFloat("bumpScale")):oo;else if(n===oj.CLEARCOAT){let e=this.getFloat(n);r=i.clearcoatMap&&!0===i.clearcoatMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===oj.CLEARCOAT_ROUGHNESS){let e=this.getFloat(n);r=i.clearcoatRoughnessMap&&!0===i.clearcoatRoughnessMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===oj.CLEARCOAT_NORMAL)r=i.clearcoatNormalMap?ok(this.getTexture(n),this.getCache(n+"Scale","vec2")):oo;else if(n===oj.SHEEN){let e=this.getColor("sheenColor").mul(this.getFloat("sheen"));r=i.sheenColorMap&&!0===i.sheenColorMap.isTexture?e.mul(this.getTexture("sheenColor").rgb):e}else if(n===oj.SHEEN_ROUGHNESS){let e=this.getFloat(n);r=(r=i.sheenRoughnessMap&&!0===i.sheenRoughnessMap.isTexture?e.mul(this.getTexture(n).a):e).clamp(.07,1)}else if(n===oj.ANISOTROPY){if(i.anisotropyMap&&!0===i.anisotropyMap.isTexture){let e=this.getTexture(n);r=rg(lm.x,lm.y,lm.y.negate(),lm.x).mul(e.rg.mul(2).sub(rr(1)).normalize().mul(e.b))}else r=lm}else if(n===oj.IRIDESCENCE_THICKNESS){let e=oS("1","float",i.iridescenceThicknessRange);if(i.iridescenceThicknessMap){let s=oS("0","float",i.iridescenceThicknessRange);r=e.sub(s).mul(this.getTexture(n).g).add(s)}else r=e}else if(n===oj.TRANSMISSION){let e=this.getFloat(n);r=i.transmissionMap?e.mul(this.getTexture(n).r):e}else if(n===oj.THICKNESS){let e=this.getFloat(n);r=i.thicknessMap?e.mul(this.getTexture(n).g):e}else if(n===oj.IOR)r=this.getFloat(n);else if(n===oj.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===oj.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{let i=this.getNodeType(e);r=this.getCache(n,i)}return r}}oj.ALPHA_TEST="alphaTest",oj.COLOR="color",oj.OPACITY="opacity",oj.SHININESS="shininess",oj.SPECULAR="specular",oj.SPECULAR_STRENGTH="specularStrength",oj.SPECULAR_INTENSITY="specularIntensity",oj.SPECULAR_COLOR="specularColor",oj.REFLECTIVITY="reflectivity",oj.ROUGHNESS="roughness",oj.METALNESS="metalness",oj.NORMAL="normal",oj.CLEARCOAT="clearcoat",oj.CLEARCOAT_ROUGHNESS="clearcoatRoughness",oj.CLEARCOAT_NORMAL="clearcoatNormal",oj.EMISSIVE="emissive",oj.ROTATION="rotation",oj.SHEEN="sheen",oj.SHEEN_ROUGHNESS="sheenRoughness",oj.ANISOTROPY="anisotropy",oj.IRIDESCENCE="iridescence",oj.IRIDESCENCE_IOR="iridescenceIOR",oj.IRIDESCENCE_THICKNESS="iridescenceThickness",oj.IOR="ior",oj.TRANSMISSION="transmission",oj.THICKNESS="thickness",oj.ATTENUATION_DISTANCE="attenuationDistance",oj.ATTENUATION_COLOR="attenuationColor",oj.LINE_SCALE="scale",oj.LINE_DASH_SIZE="dashSize",oj.LINE_GAP_SIZE="gapSize",oj.LINE_WIDTH="linewidth",oj.LINE_DASH_OFFSET="dashOffset",oj.POINT_WIDTH="pointWidth",oj.DISPERSION="dispersion",oj.LIGHT_MAP="light",oj.AO="ao";let oH=n4(oj,oj.ALPHA_TEST),oQ=n4(oj,oj.COLOR),oW=n4(oj,oj.SHININESS),oq=n4(oj,oj.EMISSIVE),oX=n4(oj,oj.OPACITY),oK=n4(oj,oj.SPECULAR),oY=n4(oj,oj.SPECULAR_INTENSITY),oJ=n4(oj,oj.SPECULAR_COLOR),oZ=n4(oj,oj.SPECULAR_STRENGTH),o$=n4(oj,oj.REFLECTIVITY),o0=n4(oj,oj.ROUGHNESS),o1=n4(oj,oj.METALNESS),o2=n4(oj,oj.NORMAL).context({getUV:null}),o3=n4(oj,oj.CLEARCOAT),o4=n4(oj,oj.CLEARCOAT_ROUGHNESS),o5=n4(oj,oj.CLEARCOAT_NORMAL).context({getUV:null}),o6=n4(oj,oj.ROTATION),o8=n4(oj,oj.SHEEN),o7=n4(oj,oj.SHEEN_ROUGHNESS),o9=n4(oj,oj.ANISOTROPY),le=n4(oj,oj.IRIDESCENCE),lt=n4(oj,oj.IRIDESCENCE_IOR),li=n4(oj,oj.IRIDESCENCE_THICKNESS),ln=n4(oj,oj.TRANSMISSION),lr=n4(oj,oj.THICKNESS),ls=n4(oj,oj.IOR),la=n4(oj,oj.ATTENUATION_DISTANCE),lo=n4(oj,oj.ATTENUATION_COLOR),ll=n4(oj,oj.LINE_SCALE),lh=n4(oj,oj.LINE_DASH_SIZE),lu=n4(oj,oj.LINE_GAP_SIZE);oj.LINE_WIDTH;let lc=n4(oj,oj.LINE_DASH_OFFSET);oj.POINT_WIDTH;let ld=n4(oj,oj.DISPERSION),lp=n4(oj,oj.LIGHT_MAP),lf=n4(oj,oj.AO),lm=rM(new eE.FM8).onReference(function(e){return e.material}).onRenderUpdate(function({material:e}){this.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation))}),lg=n5(e=>e.context.setupModelViewProjection(),"vec4").once()().varying("v_modelViewProjection");class lA extends ng{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){let i,n;let r=this.getNodeType(e),s=this.scope;if(s===lA.VERTEX)i=e.getVertexIndex();else if(s===lA.INSTANCE)i=e.getInstanceIndex();else if(s===lA.DRAW)i=e.getDrawIndex();else if(s===lA.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(s===lA.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(s===lA.SUBGROUP)i=e.getSubgroupIndex();else throw Error("THREE.IndexNode: Unknown scope: "+s);return"vertex"===e.shaderStage||"compute"===e.shaderStage?i:ad(this).build(e,r)}}lA.VERTEX="vertex",lA.INSTANCE="instance",lA.SUBGROUP="subgroup",lA.INVOCATION_LOCAL="invocationLocal",lA.INVOCATION_SUBGROUP="invocationSubgroup",lA.DRAW="draw";let lv=n4(lA,lA.VERTEX),ly=n4(lA,lA.INSTANCE);lA.SUBGROUP,lA.INVOCATION_SUBGROUP,lA.INVOCATION_LOCAL;let lx=n4(lA,lA.DRAW);class l_ extends ng{static get type(){return"InstanceNode"}constructor(e,i,n){super("void"),this.count=e,this.instanceMatrix=i,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=nu.FRAME,this.buffer=null,this.bufferColor=null}setup(e){let{count:i,instanceMatrix:n,instanceColor:r}=this,{instanceMatrixNode:s,instanceColorNode:a}=this;if(null===s){if(i<=1e3)s=o_(n.array,"mat4",Math.max(i,1)).element(ly);else{let e=new eE.$TI(n.array,16,1);this.buffer=e;let i=n.usage===eE.dj0?aI:aR;s=rv(i(e,"vec4",16,0),i(e,"vec4",16,4),i(e,"vec4",16,8),i(e,"vec4",16,12))}this.instanceMatrixNode=s}if(r&&null===a){let e=new eE.lb7(r.array,3),i=r.usage===eE.dj0?aI:aR;this.bufferColor=e,a=rl(i(e,"vec3",3,0)),this.instanceColorNode=a}let o=s.mul(a8).xyz;if(a8.assign(o),e.hasGeometryAttribute("normal")){let e=od(os,s);os.assign(e)}null!==this.instanceColorNode&&rT("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==eE.dj0&&null!==this.buffer&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==eE.dj0&&null!==this.bufferColor&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}let lb=n3(class extends l_{static get type(){return"InstancedMeshNode"}constructor(e){let{count:i,instanceMatrix:n,instanceColor:r}=e;super(i,n,r),this.instancedMesh=e}}),lE=n3(class extends ng{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){null===this.batchingIdNode&&(null===e.getDrawIndex()?this.batchingIdNode=ly:this.batchingIdNode=lx);let i=n5(([e])=>{let i=aj(aq(this.batchMesh._indirectTexture),0),n=rt(e).modInt(rt(i)),r=rt(e).div(rt(i));return aq(this.batchMesh._indirectTexture,rs(n,r)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(rt(this.batchingIdNode)),n=this.batchMesh._matricesTexture,r=aj(aq(n),0),s=re(i).mul(4).toInt().toVar(),a=s.modInt(r),o=s.div(rt(r)),l=rv(aq(n,rs(a,o)),aq(n,rs(a.add(1),o)),aq(n,rs(a.add(2),o)),aq(n,rs(a.add(3),o))),h=this.batchMesh._colorsTexture;if(null!==h){let e=n5(([e])=>{let i=aj(aq(h),0).x;return aq(h,rs(e.modInt(i),e.div(i))).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);rT("vec3","vBatchColor").assign(e)}let u=rA(l);a8.assign(l.mul(a8));let c=os.div(rl(u[0].dot(u[0]),u[1].dot(u[1]),u[2].dot(u[2]))),d=u.mul(c).xyz;os.assign(d),e.hasGeometryAttribute("tangent")&&oL.mulAssign(u)}}),lw=new WeakMap;class lM extends ng{static get type(){return"SkinningNode"}constructor(e,i=!1){let n,r,s;super("void"),this.skinnedMesh=e,this.useReference=i,this.updateType=nu.OBJECT,this.skinIndexNode=aG("skinIndex","uvec4"),this.skinWeightNode=aG("skinWeight","vec4"),i?(n=oS("bindMatrix","mat4"),r=oS("bindMatrixInverse","mat4"),s=oT("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(n=rM(e.bindMatrix,"mat4"),r=rM(e.bindMatrixInverse,"mat4"),s=o_(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=n,this.bindMatrixInverseNode=r,this.boneMatricesNode=s,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,i=a8){let{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:a}=this,o=e.element(n.x),l=e.element(n.y),h=e.element(n.z),u=e.element(n.w),c=s.mul(i),d=r4(o.mul(r.x).mul(c),l.mul(r.y).mul(c),h.mul(r.z).mul(c),u.mul(r.w).mul(c));return a.mul(d).xyz}getSkinnedNormal(e=this.boneMatricesNode,i=os){let{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:a}=this,o=e.element(n.x),l=e.element(n.y),h=e.element(n.z),u=e.element(n.w),c=r4(r.x.mul(o),r.y.mul(l),r.z.mul(h),r.w.mul(u));return(c=a.mul(c).mul(s)).transformDirection(i).xyz}getPreviousSkinnedPosition(e){let i=e.object;return null===this.previousBoneMatricesNode&&(i.skeleton.previousBoneMatrices=new Float32Array(i.skeleton.boneMatrices),this.previousBoneMatricesNode=oT("skeleton.previousBoneMatrices","mat4",i.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,a7)}needsPreviousBoneMatrices(e){let i=e.renderer.getMRT();return i&&i.has("velocity")||!0===nl(e.object).useVelocity}setup(e){this.needsPreviousBoneMatrices(e)&&a7.assign(this.getPreviousSkinnedPosition(e));let i=this.getSkinnedPosition();if(a8.assign(i),e.hasGeometryAttribute("normal")){let i=this.getSkinnedNormal();os.assign(i),e.hasGeometryAttribute("tangent")&&oL.assign(i)}}generate(e,i){if("void"!==i)return a8.build(e,i)}update(e){let i=(this.useReference?e.object:this.skinnedMesh).skeleton;lw.get(i)!==e.frameId&&(lw.set(i,e.frameId),null!==this.previousBoneMatricesNode&&i.previousBoneMatrices.set(i.boneMatrices),i.update())}}let lC=e=>n0(new lM(e,!0));class lS extends ng{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){let i=e.getNodeProperties(this);if(void 0!==i.stackNode)return i;let n={};for(let e=0,i=this.params.length-1;e<i;e++){let i=this.params[e],r=!0!==i.isNode&&i.name||this.getVarName(e),s=!0!==i.isNode&&i.type||"int";n[r]=ak(r,s)}let r=e.addStack();return i.returnsNode=this.params[this.params.length-1](n,r,e),i.stackNode=r,e.removeStack(),i}getNodeType(e){let{returnsNode:i}=this.getProperties(e);return i?i.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){let i=this.getProperties(e),n=this.params,r=i.stackNode;for(let i=0,r=n.length-1;i<r;i++){let r=n[i],s=null,a=null,o=null,l=null,h=null,u=null;r.isNode?(l="int",o=this.getVarName(i),s="0",a=r.build(e,l),h="<"):(l=r.type||"int",o=r.name||this.getVarName(i),s=r.start,a=r.end,h=r.condition,u=r.update,"number"==typeof s?s=e.generateConst(l,s):s&&s.isNode&&(s=s.build(e,l)),"number"==typeof a?a=e.generateConst(l,a):a&&a.isNode&&(a=a.build(e,l)),void 0!==s&&void 0===a?(s+=" - 1",a="0",h=">="):void 0!==a&&void 0===s&&(s="0",h="<"),void 0===h&&(h=Number(s)>Number(a)?">=":"<"));let c={start:s,end:a},d=c.start,p=c.end,f="",m="",g="";u||(u="int"===l||"uint"===l?h.includes("<")?"++":"--":h.includes("<")?"+= 1.":"-= 1."),f+=e.getVar(l,o)+" = "+d,m+=o+" "+h+" "+p,g+=o+" "+u;let A=`for ( ${f}; ${m}; ${g} )`;e.addFlowCode((0===i?"\n":"")+e.tab+A+" {\n\n").addFlowTab()}let s=r.build(e,"void"),a=i.returnsNode?i.returnsNode.build(e):"";e.removeFlowTab().addFlowCode("\n"+e.tab+s);for(let i=0,n=this.params.length-1;i<n;i++)e.addFlowCode((0===i?"":e.tab)+"}\n\n").removeFlowTab();return e.addFlowTab(),a}}let lT=(...e)=>n0(new lS(n2(e,"int"))).append(),lR=()=>ak("break").append(),lI=new WeakMap,lB=new eE.Ltg,lL=n5(({bufferMap:e,influence:i,stride:n,width:r,depth:s,offset:a})=>{let o=rt(lv).mul(n).add(a),l=o.div(r);return aq(e,rs(o.sub(l.mul(r)),l)).depth(s).mul(i)}),lP=n3(class extends ng{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=rM(1),this.updateType=nu.OBJECT}setup(e){let{geometry:i}=e,n=void 0!==i.morphAttributes.position,r=i.hasAttribute("normal")&&void 0!==i.morphAttributes.normal,s=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,a=void 0!==s?s.length:0,{texture:o,stride:l,size:h}=function(e){let i=void 0!==e.morphAttributes.position,n=void 0!==e.morphAttributes.normal,r=void 0!==e.morphAttributes.color,s=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=void 0!==s?s.length:0,o=lI.get(e);if(void 0===o||o.count!==a){void 0!==o&&o.texture.dispose();let s=e.morphAttributes.position||[],l=e.morphAttributes.normal||[],h=e.morphAttributes.color||[],u=0;!0===i&&(u=1),!0===n&&(u=2),!0===r&&(u=3);let c=e.attributes.position.count*u,d=1;c>4096&&(d=Math.ceil(c/4096),c=4096);let p=new Float32Array(c*d*4*a),f=new eE.p3g(p,c,d,a);f.type=eE.VzW,f.needsUpdate=!0;let m=4*u;for(let e=0;e<a;e++){let a=s[e],o=l[e],u=h[e],f=c*d*4*e;for(let e=0;e<a.count;e++){let s=e*m;!0===i&&(lB.fromBufferAttribute(a,e),p[f+s+0]=lB.x,p[f+s+1]=lB.y,p[f+s+2]=lB.z,p[f+s+3]=0),!0===n&&(lB.fromBufferAttribute(o,e),p[f+s+4]=lB.x,p[f+s+5]=lB.y,p[f+s+6]=lB.z,p[f+s+7]=0),!0===r&&(lB.fromBufferAttribute(u,e),p[f+s+8]=lB.x,p[f+s+9]=lB.y,p[f+s+10]=lB.z,p[f+s+11]=4===u.itemSize?lB.w:1)}}o={count:a,texture:f,stride:u,size:new eE.FM8(c,d)},lI.set(e,o),e.addEventListener("dispose",function i(){f.dispose(),lI.delete(e),e.removeEventListener("dispose",i)})}return o}(i);!0===n&&a8.mulAssign(this.morphBaseInfluence),!0===r&&os.mulAssign(this.morphBaseInfluence);let u=rt(h.width);lT(a,({i:e})=>{let i=re(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?i.assign(aq(this.mesh.morphTexture,rs(rt(e).add(1),rt(ly))).r):i.assign(oS("morphTargetInfluences","float").element(e).toVar()),!0===n&&a8.addAssign(lL({bufferMap:o,influence:i,stride:l,width:u,depth:e,offset:rt(0)})),!0===r&&os.addAssign(lL({bufferMap:o,influence:i,stride:l,width:u,depth:e,offset:rt(1)}))})}update(){let e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,i)=>e+i,0)}});class lD extends ng{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class lN extends lD{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}let lO=n3(class extends al{static get type(){return"LightingContextNode"}constructor(e,i=null,n=null,r=null){super(e),this.lightingModel=i,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){let{backdropNode:e,backdropAlphaNode:i}=this,n=rl().toVar("directDiffuse"),r=rl().toVar("directSpecular"),s=rl().toVar("indirectDiffuse"),a=rl().toVar("indirectSpecular");return{radiance:rl().toVar("radiance"),irradiance:rl().toVar("irradiance"),iblIrradiance:rl().toVar("iblIrradiance"),ambientOcclusion:re(1).toVar("ambientOcclusion"),reflectedLight:{directDiffuse:n,directSpecular:r,indirectDiffuse:s,indirectSpecular:a},backdrop:e,backdropAlpha:i}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}});class lU extends lD{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}class lk extends ng{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===lk.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=nu.NONE;return(this.scope===lk.SIZE||this.scope===lk.VIEWPORT)&&(e=nu.RENDER),this.updateType=e,e}update({renderer:e}){let i=e.getRenderTarget();this.scope===lk.VIEWPORT?null!==i?s.copy(i.viewport):(e.getViewport(s),s.multiplyScalar(e.getPixelRatio())):null!==i?(r.width=i.width,r.height=i.height):e.getDrawingBufferSize(r)}setup(){let e=this.scope,i=null;return e===lk.SIZE?rM(r||(r=new eE.FM8)):e===lk.VIEWPORT?rM(s||(s=new eE.Ltg)):rr(lG.div(lz))}generate(e){if(this.scope===lk.COORDINATE){let i=e.getFragCoord();if(e.isFlipY()){let n=e.getNodeProperties(lz).outputNode.build(e);i=`${e.getType("vec2")}( ${i}.x, ${n}.y - ${i}.y )`}return i}return super.generate(e)}}lk.COORDINATE="coordinate",lk.VIEWPORT="viewport",lk.SIZE="size",lk.UV="uv";let lF=n4(lk,lk.UV),lz=n4(lk,lk.SIZE),lG=n4(lk,lk.COORDINATE),lV=n4(lk,lk.VIEWPORT);lV.zw,lV.xy;let lj=new eE.FM8;class lH extends aQ{static get type(){return"ViewportTextureNode"}constructor(e=lF,i=null,n=null){null===n&&((n=new eE.Wzm).minFilter=eE.D1R),super(n,e,i),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=nu.FRAME}updateBefore(e){let i=e.renderer;i.getDrawingBufferSize(lj);let n=this.value;(n.image.width!==lj.width||n.image.height!==lj.height)&&(n.image.width=lj.width,n.image.height=lj.height,n.needsUpdate=!0);let r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,i.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){let e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}let lQ=n3(lH,null,null,{generateMipmaps:!0}),lW=null,lq=n3(class extends lH{static get type(){return"ViewportDepthTextureNode"}constructor(e=lF,i=null){null===lW&&(lW=new eE.$YQ),super(e,i,lW)}});class lX extends ng{static get type(){return"ViewportDepthNode"}constructor(e,i=null){super("float"),this.scope=e,this.valueNode=i,this.isViewportDepthNode=!0}generate(e){let{scope:i}=this;return i===lX.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){let{scope:i}=this,n=this.valueNode,r=null;return i===lX.DEPTH_BASE?null!==n&&(r=l$().assign(n)):i===lX.DEPTH?r=e.isPerspectiveCamera?lY(ot.z,aX,aK):lK(ot.z,aX,aK):i===lX.LINEAR_DEPTH&&(r=null!==n?e.isPerspectiveCamera?lK(lJ(n,aX,aK),aX,aK):n:lK(ot.z,aX,aK)),r}}lX.DEPTH_BASE="depthBase",lX.DEPTH="depth",lX.LINEAR_DEPTH="linearDepth";let lK=(e,i,n)=>e.add(i).div(i.sub(n)),lY=(e,i,n)=>i.add(e).mul(n).div(n.sub(i).mul(e)),lJ=(e,i,n)=>i.mul(n).div(n.sub(i).mul(e).sub(n)),lZ=(e,i,n)=>{i=i.max(1e-6).toVar();let r=sM(e.negate().div(i)),s=sM(n.div(i));return r.div(s)},l$=n3(lX,lX.DEPTH_BASE),l0=n4(lX,lX.DEPTH);lX.LINEAR_DEPTH,lq(),l0.assign=e=>l$(e);let l1=n3(class extends ng{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}});class l2 extends ng{static get type(){return"ClippingNode"}constructor(e=l2.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);let{intersectionPlanes:i,unionPlanes:n}=e.clippingContext;return(this.hardwareClipping=e.material.hardwareClipping,this.scope===l2.ALPHA_TO_COVERAGE)?this.setupAlphaToCoverage(i,n):this.scope===l2.HARDWARE?this.setupHardwareClipping(n,e):this.setupDefault(i,n)}setupAlphaToCoverage(e,i){return n5(()=>{let n=re().toVar("distanceToPlane"),r=re().toVar("distanceToGradient"),s=re(1).toVar("clipOpacity"),a=i.length;if(!1===this.hardwareClipping&&a>0){let e=ow(i);lT(a,({i})=>{let a=e.element(i);n.assign(ot.dot(a.xyz).negate().add(a.w)),r.assign(n.fwidth().div(2)),s.mulAssign(ar(r.negate(),r,n))})}let o=e.length;if(o>0){let i=ow(e),a=re(1).toVar("intersectionClipOpacity");lT(o,({i:e})=>{let s=i.element(e);n.assign(ot.dot(s.xyz).negate().add(s.w)),r.assign(n.fwidth().div(2)),a.mulAssign(ar(r.negate(),r,n).oneMinus())}),s.mulAssign(a.oneMinus())}rR.a.mulAssign(s),rR.a.equal(0).discard()})()}setupDefault(e,i){return n5(()=>{let n=i.length;if(!1===this.hardwareClipping&&n>0){let e=ow(i);lT(n,({i})=>{let n=e.element(i);ot.dot(n.xyz).greaterThan(n.w).discard()})}let r=e.length;if(r>0){let i=ow(e),n=rn(!0).toVar("clipped");lT(r,({i:e})=>{let r=i.element(e);n.assign(ot.dot(r.xyz).greaterThan(r.w).and(n))}),n.discard()}})()}setupHardwareClipping(e,i){let n=e.length;return i.enableHardwareClipping(n),n5(()=>{let r=ow(e),s=l1(i.getClipDistance());lT(n,({i:e})=>{let i=r.element(e),n=ot.dot(i.xyz).sub(i.w).negate();s.element(e).assign(n)})})()}}l2.ALPHA_TO_COVERAGE="alphaToCoverage",l2.DEFAULT="default",l2.HARDWARE="hardware";let l3=()=>n0(new l2),l4=()=>n0(new l2(l2.ALPHA_TO_COVERAGE)),l5=()=>n0(new l2(l2.HARDWARE)),l6=n5(([e])=>sB(r6(1e4,sL(r6(17,e.x).add(r6(.1,e.y)))).mul(r4(.1,sk(sL(r6(13,e.y).add(e.x))))))),l8=n5(([e])=>l6(rr(l6(e.xy),e.z))),l7=n5(([e])=>{let i=sZ(sz(sj(e.xyz)),sz(sH(e.xyz))),n=re(1).div(re(.05).mul(i)).toVar("pixScale"),r=rr(sE(sT(sM(n))),sE(sR(sM(n)))),s=rr(l8(sT(r.x.mul(e.xyz))),l8(sT(r.y.mul(e.xyz)))),a=sB(sM(n)),o=r4(r6(a.oneMinus(),s.x),r6(a,s.y)),l=sJ(a,a.oneMinus()),h=rl(o.mul(o).div(r6(2,l).mul(r5(1,l))),o.sub(r6(.5,l)).div(r5(1,l)),r5(1,r5(1,o).mul(r5(1,o)).div(r6(2,l).mul(r5(1,l)))));return ai(o.lessThan(l.oneMinus()).select(o.lessThan(l).select(h.x,h.y),h.z),1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class l9 extends eE.F5T{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+ni(this)}build(e){this.setup(e)}setupObserver(e){return new i8(e)}setup(e){let i;e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);let n=e.renderer,r=n.getRenderTarget();e.addStack();let s=this.vertexNode||this.setupVertex(e);e.stack.outputNode=s,this.setupHardwareClipping(e),null!==this.geometryNode&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let a=this.setupClipping(e);if((!0===this.depthWrite||!0===this.depthTest)&&(null!==r?!0===r.depthBuffer&&this.setupDepth(e):!0===n.depth&&this.setupDepth(e)),null===this.fragmentNode){this.setupDiffuseColor(e),this.setupVariants(e);let s=this.setupLighting(e);null!==a&&e.stack.add(a);let o=rd(s,rR.a).max(0);if(i=this.setupOutput(e,o),rq.assign(i),null!==this.outputNode&&(i=this.outputNode),null!==r){let e=n.getMRT(),r=this.mrtNode;null!==e?(i=e,null!==r&&(i=e.merge(r))):null!==r&&(i=r)}}else{let n=this.fragmentNode;!0!==n.isOutputStructNode&&(n=rd(n)),i=this.setupOutput(e,n)}e.stack.outputNode=i,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(null===e.clippingContext)return null;let{unionPlanes:i,intersectionPlanes:n}=e.clippingContext,r=null;if(i.length>0||n.length>0){let i=e.renderer.samples;this.alphaToCoverage&&i>1?r=l4():e.stack.add(l3())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,null===e.clippingContext)return;let i=e.clippingContext.unionPlanes.length;i>0&&i<=8&&e.isAvailable("clipDistance")&&(e.stack.add(l5()),this.hardwareClipping=!0)}setupDepth(e){let{renderer:i,camera:n}=e,r=this.depthNode;if(null===r){let e=i.getMRT();e&&e.has("depth")?r=e.get("depth"):!0===i.logarithmicDepthBuffer&&(r=n.isPerspectiveCamera?lZ(ot.z,aX,aK):lK(ot.z,aX,aK))}null!==r&&l0.assign(r).append()}setupPositionView(){return a4.mul(a8).xyz}setupModelViewProjection(){return aY.mul(ot)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),lg}setupPosition(e){let{object:i,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&lP(i).append(),!0===i.isSkinnedMesh&&lC(i).append(),this.displacementMap){let e=oI("displacementMap","texture"),i=oI("displacementScale","float"),n=oI("displacementBias","float");a8.addAssign(os.normalize().mul(e.x.mul(i).add(n)))}return i.isBatchedMesh&&lE(i).append(),i.isInstancedMesh&&i.instanceMatrix&&!0===i.instanceMatrix.isInstancedBufferAttribute&&lb(i).append(),null!==this.positionNode&&a8.assign(this.positionNode.context({isPositionNodeInput:!0})),a8}setupDiffuseColor({object:e,geometry:i}){let n=this.colorNode?rd(this.colorNode):oQ;!0===this.vertexColors&&i.hasAttribute("color")&&(n=rd(n.xyz.mul(aG("color","vec3")),n.a)),e.instanceColor&&(n=rT("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=rT("vec3","vBatchColor").mul(n)),rR.assign(n);let r=this.opacityNode?re(this.opacityNode):oX;if(rR.a.assign(rR.a.mul(r)),null!==this.alphaTestNode||this.alphaTest>0){let e=null!==this.alphaTestNode?re(this.alphaTestNode):oH;rR.a.lessThanEqual(e).discard()}!0===this.alphaHash&&rR.a.lessThan(l7(a8)).discard(),!1===this.transparent&&this.blending===eE.bdR&&!1===this.alphaToCoverage&&rR.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?rl(0):rR.rgb}setupNormal(){return this.normalNode?rl(this.normalNode):o2}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?oI("envMap","cubeTexture"):oI("envMap","texture")),e}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new lU(lp)),i}setupLights(e){let i=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&i.push(n);let r=this.setupLightMap(e);if(r&&r.isLightingNode&&i.push(r),null!==this.aoNode||e.material.aoMap){let e=null!==this.aoNode?this.aoNode:lf;i.push(new lN(e))}let s=this.lightsNode||e.lightsNode;return i.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...i])),s}setupLightingModel(){}setupLighting(e){let{material:i}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:s}=this,a=!0===this.lights||null!==this.lightsNode?this.setupLights(e):null,o=this.setupOutgoingLight(e);return a&&a.getScope().hasLights?o=lO(a,this.setupLightingModel(e),n,r):null!==n&&(o=rl(null!==r?at(o,n,r):n)),(s&&!0===s.isNode||i.emissive&&!0===i.emissive.isColor)&&(rI.assign(rl(s||oq)),o=o.add(rI)),o}setupOutput(e,i){if(!0===this.fog){let n=e.fogNode;n&&(rq.assign(i),i=rd(n))}return i}setDefaultValues(e){for(let i in e){let n=e[i];void 0===this[i]&&(this[i]=n,n&&n.clone&&(this[i]=n.clone()))}let i=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(let e in i)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,e)&&void 0!==i[e].get&&Object.defineProperty(this.constructor.prototype,e,i[e])}toJSON(e){let i=void 0===e||"string"==typeof e;i&&(e={textures:{},images:{},nodes:{}});let n=eE.F5T.prototype.toJSON.call(this,e),r=nn(this);for(let{property:i,childNode:s}of(n.inputNodes={},r))n.inputNodes[i]=s.toJSON(e).uuid;function s(e){let i=[];for(let n in e){let r=e[n];delete r.metadata,i.push(r)}return i}if(i){let i=s(e.textures),r=s(e.images),a=s(e.nodes);i.length>0&&(n.textures=i),r.length>0&&(n.images=r),a.length>0&&(n.nodes=a)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}let he=new eE.nls;class ht extends l9{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(he),this.setValues(e)}}let hi=new eE.FT0;class hn extends l9{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(hi),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){let e=this.offsetNode?re(this.offsetNode):lc,i=this.dashScaleNode?re(this.dashScaleNode):ll,n=this.dashSizeNode?re(this.dashSizeNode):lh,r=this.gapSizeNode?re(this.gapSizeNode):lu;rX.assign(n),rK.assign(r);let s=ad(aG("lineDistance").mul(i));(e?s.add(e):s).mod(rX.add(rK)).greaterThan(rX).discard()}}let hr=e=>n0(e).mul(.5).add(.5),hs=new eE.RSm;class ha extends l9{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(hs),this.setValues(e)}setupDiffuseColor(){let e=this.opacityNode?re(this.opacityNode):oX;rR.assign(rd(hr(oh),e))}}let ho=n3(class extends ny{static get type(){return"EquirectUVNode"}constructor(e=oe){super("vec2"),this.dirNode=e}setup(){let e=this.dirNode;return rr(e.z.atan(e.x).mul(1/(2*Math.PI)).add(.5),e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5))}});class hl extends eE.oAp{constructor(e=1,i={}){super(e,i),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,i){let n=i.minFilter,r=i.generateMipmaps;i.generateMipmaps=!0,this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;let s=new eE.DvJ(5,5,5),a=ho(oe),o=new l9;o.colorNode=aW(i,a,0),o.side=eE._Li,o.blending=eE.jFi;let l=new eE.Kj0(s,o),h=new eE.xsS;h.add(l),i.minFilter===eE.D1R&&(i.minFilter=eE.wem);let u=new eE._am(1,10,this),c=e.getMRT();return e.setMRT(null),u.update(e,h),e.setMRT(c),i.minFilter=n,i.currentGenerateMipmaps=r,l.geometry.dispose(),l.material.dispose(),this}}let hh=new WeakMap;function hu(e){let i=e.target;i.removeEventListener("dispose",hu);let n=hh.get(i);void 0!==n&&(hh.delete(i),n.dispose())}function hc(e,i){i===eE.dSO?e.mapping=eE.fY$:i===eE.Bf4&&(e.mapping=eE.vxC)}let hd=n3(class extends ny{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=oy();let i=new eE.BtG;i.isRenderTargetTexture=!0,this._defaultTexture=i,this.updateBeforeType=nu.RENDER}updateBefore(e){let{renderer:i,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){let e=r.isTextureNode?r.value:n[r.property];if(e&&e.isTexture){let n=e.mapping;if(n===eE.dSO||n===eE.Bf4){if(hh.has(e)){let i=hh.get(e);hc(i,e.mapping),this._cubeTexture=i}else{var s;let n=e.image;if(null!=(s=n)&&s.height>0){let r=new hl(n.height);r.fromEquirectangularTexture(i,e),hc(r.texture,e.mapping),this._cubeTexture=r.texture,hh.set(e,r.texture),e.addEventListener("dispose",hu)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}});class hp extends lD{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=hd(this.envNode)}}class hf extends lD{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){let i=re(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(i)}}class hm{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class hg extends hm{constructor(){super()}indirect(e,i,n){let r=e.ambientOcclusion,s=e.reflectedLight,a=n.context.irradianceLightMap;s.indirectDiffuse.assign(rd(0)),a?s.indirectDiffuse.addAssign(a):s.indirectDiffuse.addAssign(rd(1,1,1,0)),s.indirectDiffuse.mulAssign(r),s.indirectDiffuse.mulAssign(rR.rgb)}finish(e,i,n){let r=n.material,s=e.outgoingLight,a=n.context.environment;if(a)switch(r.combine){case eE.Ns1:s.rgb.assign(at(s.rgb,s.rgb.mul(a.rgb),oZ.mul(o$)));break;case eE.qhX:s.rgb.assign(at(s.rgb,a.rgb,oZ.mul(o$)));break;case eE.NDo:s.rgb.addAssign(a.rgb.mul(oZ.mul(o$)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",r.combine)}}}let hA=new eE.vBJ;class hv extends l9{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(hA),this.setValues(e)}setupNormal(){return oo}setupEnvironment(e){let i=super.setupEnvironment(e);return i?new hp(i):null}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new hf(lp)),i}setupOutgoingLight(){return rR.rgb}setupLightingModel(){return new hg}}let hy=n5(({f0:e,f90:i,dotVH:n})=>{let r=n.mul(-5.55473).sub(6.98316).mul(n).exp2();return e.mul(r.oneMinus()).add(i.mul(r))}),hx=n5(e=>e.diffuseColor.mul(1/Math.PI)),h_=()=>re(.25),hb=n5(({dotNH:e})=>rW.mul(re(.5)).add(1).mul(re(1/Math.PI)).mul(e.pow(rW))),hE=n5(({lightDirection:e})=>{let i=e.add(oi).normalize(),n=oh.dot(i).clamp(),r=hy({f0:rH,f90:1,dotVH:oi.dot(i).clamp()}),s=h_(),a=hb({dotNH:n});return r.mul(s).mul(a)});class hw extends hg{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:i,reflectedLight:n}){let r=oh.dot(e).clamp().mul(i);n.directDiffuse.addAssign(r.mul(hx({diffuseColor:rR.rgb}))),!0===this.specular&&n.directSpecular.addAssign(r.mul(hE({lightDirection:e})).mul(oZ))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:n}){n.indirectDiffuse.addAssign(i.mul(hx({diffuseColor:rR}))),n.indirectDiffuse.mulAssign(e)}}let hM=new eE.YBo;class hC extends l9{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(hM),this.setValues(e)}setupEnvironment(e){let i=super.setupEnvironment(e);return i?new hp(i):null}setupLightingModel(){return new hw(!1)}}let hS=new eE.xoR;class hT extends l9{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(hS),this.setValues(e)}setupEnvironment(e){let i=super.setupEnvironment(e);return i?new hp(i):null}setupLightingModel(){return new hw}setupVariants(){let e=(this.shininessNode?re(this.shininessNode):oW).max(1e-4);rW.assign(e);let i=this.specularNode||oK;rH.assign(i)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}let hR=n5(e=>{if(!1===e.geometry.hasAttribute("normal"))return re(0);let i=oo.dFdx().abs().max(oo.dFdy().abs());return i.x.max(i.y).max(i.z)}),hI=n5(e=>{let{roughness:i}=e,n=hR(),r=i.max(.0525);return(r=r.add(n)).min(1)}),hB=n5(({alpha:e,dotNL:i,dotNV:n})=>{let r=e.pow2(),s=i.mul(r.add(r.oneMinus().mul(n.pow2())).sqrt()),a=n.mul(r.add(r.oneMinus().mul(i.pow2())).sqrt());return r8(.5,s.add(a).max(sg))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),hL=n5(({alphaT:e,alphaB:i,dotTV:n,dotBV:r,dotTL:s,dotBL:a,dotNV:o,dotNL:l})=>{let h=l.mul(rl(e.mul(n),i.mul(r),o).length()),u=o.mul(rl(e.mul(s),i.mul(a),l).length());return r8(.5,h.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),hP=n5(({alpha:e,dotNH:i})=>{let n=e.pow2(),r=i.pow2().mul(n.oneMinus()).oneMinus();return n.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),hD=re(1/Math.PI),hN=n5(({alphaT:e,alphaB:i,dotNH:n,dotTH:r,dotBH:s})=>{let a=e.mul(i),o=rl(i.mul(r),e.mul(s),a.mul(n)),l=o.dot(o),h=a.div(l);return hD.mul(a.mul(h.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),hO=n5(e=>{let i,n;let{lightDirection:r,f0:s,f90:a,roughness:o,f:l,USE_IRIDESCENCE:h,USE_ANISOTROPY:u}=e,c=e.normalView||oh,d=o.pow2(),p=r.add(oi).normalize(),f=c.dot(r).clamp(),m=c.dot(oi).clamp(),g=c.dot(p).clamp(),A=hy({f0:s,f90:a,dotVH:oi.dot(p).clamp()});if(nJ(h)&&(A=rU.mix(A,l)),nJ(u)){let e=rV.dot(r),s=rV.dot(oi),a=rV.dot(p),o=rj.dot(r),l=rj.dot(oi),h=rj.dot(p);i=hL({alphaT:rz,alphaB:d,dotTV:s,dotBV:l,dotTL:e,dotBL:o,dotNV:m,dotNL:f}),n=hN({alphaT:rz,alphaB:d,dotNH:g,dotTH:a,dotBH:h})}else i=hB({alpha:d,dotNL:f,dotNV:m}),n=hP({alpha:d,dotNH:g});return A.mul(i).mul(n)}),hU=n5(({roughness:e,dotNV:i})=>{let n=rd(-1,-.0275,-.572,.022),r=rd(1,.0425,1.04,-.04),s=e.mul(n).add(r),a=s.x.mul(s.x).min(i.mul(-9.28).exp2()).mul(s.x).add(s.y);return rr(-1.04,1.04).mul(a).add(s.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),hk=n5(e=>{let{dotNV:i,specularColor:n,specularF90:r,roughness:s}=e,a=hU({dotNV:i,roughness:s});return n.mul(a.x).add(r.mul(a.y))}),hF=n5(({f:e,f90:i,dotVH:n})=>{let r=n.oneMinus().saturate(),s=r.mul(r),a=r.mul(s,s).clamp(0,.9999);return e.sub(rl(i).mul(a)).div(a.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),hz=n5(({roughness:e,dotNH:i})=>{let n=e.pow2(),r=re(1).div(n),s=i.pow2().oneMinus().max(.0078125);return re(2).add(r).mul(s.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),hG=n5(({dotNV:e,dotNL:i})=>re(1).div(re(4).mul(i.add(e).sub(i.mul(e))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),hV=n5(({lightDirection:e})=>{let i=e.add(oi).normalize(),n=oh.dot(e).clamp(),r=oh.dot(oi).clamp(),s=hz({roughness:rO,dotNH:oh.dot(i).clamp()}),a=hG({dotNV:r,dotNL:n});return rN.mul(s).mul(a)}),hj=n5(({N:e,V:i,roughness:n})=>{let r=rr(n,e.dot(i).saturate().oneMinus().sqrt());return r.assign(r.mul(.984375).add(.0078125)),r}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),hH=n5(({f:e})=>{let i=e.length();return sZ(i.mul(i).add(e.z).div(i.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),hQ=n5(({v1:e,v2:i})=>{let n=e.dot(i),r=n.abs().toVar(),s=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),a=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=s.div(a),l=n.greaterThan(0).select(o,sZ(n.mul(n).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return e.cross(i).mul(l)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),hW=n5(({N:e,V:i,P:n,mInv:r,p0:s,p1:a,p2:o,p3:l})=>{let h=a.sub(s).toVar(),u=l.sub(s).toVar(),c=h.cross(u),d=rl().toVar();return n7(c.dot(n.sub(s)).greaterThanEqual(0),()=>{let h=i.sub(e.mul(i.dot(e))).normalize(),u=e.cross(h).negate(),c=r.mul(rA(h,u,e).transpose()).toVar(),p=c.mul(s.sub(n)).normalize().toVar(),f=c.mul(a.sub(n)).normalize().toVar(),m=c.mul(o.sub(n)).normalize().toVar(),g=c.mul(l.sub(n)).normalize().toVar(),A=rl(0).toVar();A.addAssign(hQ({v1:p,v2:f})),A.addAssign(hQ({v1:f,v2:m})),A.addAssign(hQ({v1:m,v2:g})),A.addAssign(hQ({v1:g,v2:p})),d.assign(rl(hH({f:A})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),hq=1/6,hX=e=>r6(hq,r6(e,r6(e,e.negate().add(3)).sub(3)).add(1)),hK=e=>r6(hq,r6(e,r6(e,r6(3,e).sub(6))).add(4)),hY=e=>r6(hq,r6(e,r6(e,r6(-3,e).add(3)).add(3)).add(1)),hJ=e=>r6(hq,s6(e,3)),hZ=e=>hX(e).add(hK(e)),h$=e=>hY(e).add(hJ(e)),h0=e=>r4(-1,hK(e).div(hX(e).add(hK(e)))),h1=e=>r4(1,hJ(e).div(hY(e).add(hJ(e)))),h2=(e,i,n)=>{let r=r6(e.uvNode,i.zw).add(.5),s=sT(r),a=sB(r),o=hZ(a.x),l=h$(a.x),h=h0(a.x),u=h1(a.x),c=h0(a.y),d=h1(a.y),p=rr(s.x.add(h),s.y.add(c)).sub(.5).mul(i.xy),f=rr(s.x.add(u),s.y.add(c)).sub(.5).mul(i.xy),m=rr(s.x.add(h),s.y.add(d)).sub(.5).mul(i.xy),g=rr(s.x.add(u),s.y.add(d)).sub(.5).mul(i.xy),A=hZ(a.y).mul(r4(o.mul(e.sample(p).level(n)),l.mul(e.sample(f).level(n)))),v=h$(a.y).mul(r4(o.mul(e.sample(m).level(n)),l.mul(e.sample(g).level(n))));return A.add(v)},h3=n5(([e,i=re(3)])=>{let n=rr(e.size(rt(i))),r=rr(e.size(rt(i.add(1)))),s=r8(1,n),a=r8(1,r),o=h2(e,rd(s,n),sT(i)),l=h2(e,rd(a,r),sR(i));return sB(i).mix(o,l)}),h4=n5(([e,i,n,r,s])=>{let a=rl(an(i.negate(),sI(e),r8(1,r))),o=rl(sz(s[0].xyz),sz(s[1].xyz),sz(s[2].xyz));return sI(a).mul(n.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),h5=n5(([e,i])=>e.mul(ai(i.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),h6=lQ(),h8=lQ(),h7=n5(([e,i,n],{material:r})=>h3((r.side===eE._Li?h6:h8).sample(e),sM(lz.x).mul(h5(i,n)))),h9=n5(([e,i,n])=>(n7(n.notEqual(0),()=>sb(sw(i).negate().div(n).negate().mul(e))),rl(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),ue=n5(([e,i,n,r,s,a,o,l,h,u,c,d,p,f,m])=>{let g,A;if(m){g=rd().toVar(),A=rl().toVar();let s=c.sub(1).mul(m.mul(.025)),a=rl(c.sub(s),c,c.add(s));lT({start:0,end:3},({i:s})=>{let c=a.element(s),m=h4(e,i,d,c,l),v=o.add(m),y=u.mul(h.mul(rd(v,1))),x=rr(y.xy.div(y.w)).toVar();x.addAssign(1),x.divAssign(2),x.assign(rr(x.x,x.y.oneMinus()));let _=h7(x,n,c);g.element(s).assign(_.element(s)),g.a.addAssign(_.a),A.element(s).assign(r.element(s).mul(h9(sz(m),p,f).element(s)))}),g.a.divAssign(3)}else{let s=h4(e,i,d,c,l),a=o.add(s),m=u.mul(h.mul(rd(a,1))),v=rr(m.xy.div(m.w)).toVar();v.addAssign(1),v.divAssign(2),v.assign(rr(v.x,v.y.oneMinus())),g=h7(v,n,c),A=r.mul(h9(sz(s),p,f))}let v=A.rgb.mul(g.rgb),y=rl(hk({dotNV:e.dot(i).clamp(),specularColor:s,specularF90:a,roughness:n})),x=A.r.add(A.g,A.b).div(3);return rd(y.oneMinus().mul(v),g.a.oneMinus().mul(x).oneMinus())}),ut=rA(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),ui=e=>{let i=e.sqrt();return rl(1).add(i).div(rl(1).sub(i))},un=(e,i)=>e.sub(i).div(e.add(i)).pow2(),ur=(e,i)=>{let n=e.mul(2*Math.PI*1e-9),r=rl(54856e-17,44201e-17,52481e-17),s=rl(1681e3,1795300,2208400),a=rl(43278e5,93046e5,66121e5),o=re(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(i.x).cos()).mul(n.pow2().mul(-45282e5).exp()),l=r.mul(a.mul(2*Math.PI).sqrt()).mul(s.mul(n).add(i).cos()).mul(n.pow2().negate().mul(a).exp());return l=rl(l.x.add(o),l.y,l.z).div(10685e-11),ut.mul(l)},us=n5(({outsideIOR:e,eta2:i,cosTheta1:n,thinFilmThickness:r,baseF0:s})=>{let a=at(e,i,ar(0,.03,r)),o=e.div(a).pow2().mul(n.pow2().oneMinus()).oneMinus();n7(o.lessThan(0),()=>rl(1));let l=o.sqrt(),h=hy({f0:un(a,e),f90:1,dotVH:n}),u=h.oneMinus(),c=a.lessThan(e).select(Math.PI,0),d=re(Math.PI).sub(c),p=ui(s.clamp(0,.9999)),f=hy({f0:un(p,a.toVec3()),f90:1,dotVH:l}),m=rl(p.x.lessThan(a).select(Math.PI,0),p.y.lessThan(a).select(Math.PI,0),p.z.lessThan(a).select(Math.PI,0)),g=a.mul(r,l,2),A=rl(d).add(m),v=h.mul(f).clamp(1e-5,.9999),y=v.sqrt(),x=u.pow2().mul(f).div(rl(1).sub(v)),_=h.add(x).toVar(),b=x.sub(u).toVar();return lT({start:1,end:2,condition:"<=",name:"m"},({m:e})=>{b.mulAssign(y);let i=ur(re(e).mul(g),re(e).mul(A)).mul(2);_.addAssign(b.mul(i))}),_.max(rl(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),ua=n5(({normal:e,viewDir:i,roughness:n})=>{let r=e.dot(i).saturate(),s=n.pow2(),a=ao(n.lessThan(.25),re(-339.2).mul(s).add(re(161.4).mul(n)).sub(25.9),re(-8.48).mul(s).add(re(14.3).mul(n)).sub(9.95)),o=ao(n.lessThan(.25),re(44).mul(s).sub(re(23.7).mul(n)).add(3.26),re(1.97).mul(s).sub(re(3.27).mul(n)).add(.72));return ao(n.lessThan(.25),0,re(.1).mul(n).sub(.025)).add(a.mul(r).add(o).exp()).mul(1/Math.PI).saturate()}),uo=rl(.04),ul=re(1);class uh extends hm{constructor(e=!1,i=!1,n=!1,r=!1,s=!1,a=!1){super(),this.clearcoat=e,this.sheen=i,this.iridescence=n,this.anisotropy=r,this.transmission=s,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(!0===this.clearcoat&&(this.clearcoatRadiance=rl().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=rl().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=rl().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=rl().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=rl().toVar("sheenSpecularIndirect")),!0===this.iridescence){let e=oh.dot(oi).clamp();this.iridescenceFresnel=us({outsideIOR:re(1),eta2:rk,cosTheta1:e,thinFilmThickness:rF,baseF0:rH}),this.iridescenceF0=hF({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(!0===this.transmission){let i=aZ.sub(a9).normalize();e.backdrop=ue(ou,i,rB,rR,rH,rQ,a9,a2,aJ,aY,rY,rZ,r0,r$,this.dispersion?r1:null),e.backdropAlpha=rJ,rR.a.mulAssign(at(1,e.backdrop.a,rJ))}}computeMultiscattering(e,i,n){let r=hU({roughness:rB,dotNV:oh.dot(oi).clamp()}),s=(this.iridescenceF0?rU.mix(rH,this.iridescenceF0):rH).mul(r.x).add(n.mul(r.y)),a=r.x.add(r.y).oneMinus(),o=rH.add(rH.oneMinus().mul(.047619)),l=s.mul(o).div(a.mul(o).oneMinus());e.addAssign(s),i.addAssign(l.mul(a))}direct({lightDirection:e,lightColor:i,reflectedLight:n}){let r=oh.dot(e).clamp().mul(i);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(r.mul(hV({lightDirection:e}))),!0===this.clearcoat){let n=oc.dot(e).clamp().mul(i);this.clearcoatSpecularDirect.addAssign(n.mul(hO({lightDirection:e,f0:uo,f90:ul,roughness:rD,normalView:oc})))}n.directDiffuse.addAssign(r.mul(hx({diffuseColor:rR.rgb}))),n.directSpecular.addAssign(r.mul(hO({lightDirection:e,f0:rH,f90:1,roughness:rB,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:i,halfWidth:n,halfHeight:r,reflectedLight:s,ltc_1:a,ltc_2:o}){let l=i.add(n).sub(r),h=i.sub(n).sub(r),u=i.sub(n).add(r),c=i.add(n).add(r),d=ot.toVar(),p=hj({N:oh,V:oi,roughness:rB}),f=a.sample(p).toVar(),m=o.sample(p).toVar(),g=rA(rl(f.x,0,f.y),rl(0,1,0),rl(f.z,0,f.w)).toVar(),A=rH.mul(m.x).add(rH.oneMinus().mul(m.y)).toVar();s.directSpecular.addAssign(e.mul(A).mul(hW({N:oh,V:oi,P:d,mInv:g,p0:l,p1:h,p2:u,p3:c}))),s.directDiffuse.addAssign(e.mul(rR).mul(hW({N:oh,V:oi,P:d,mInv:rA(1,0,0,0,1,0,0,0,1),p0:l,p1:h,p2:u,p3:c})))}indirect(e,i,n){this.indirectDiffuse(e,i,n),this.indirectSpecular(e,i,n),this.ambientOcclusion(e,i,n)}indirectDiffuse({irradiance:e,reflectedLight:i}){i.indirectDiffuse.addAssign(e.mul(hx({diffuseColor:rR})))}indirectSpecular({radiance:e,iblIrradiance:i,reflectedLight:n}){if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(i.mul(rN,ua({normal:oh,viewDir:oi,roughness:rO}))),!0===this.clearcoat){let e=hk({dotNV:oc.dot(oi).clamp(),specularColor:uo,specularF90:ul,roughness:rD});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(e))}let r=rl().toVar("singleScattering"),s=rl().toVar("multiScattering"),a=i.mul(1/Math.PI);this.computeMultiscattering(r,s,rQ);let o=r.add(s),l=rR.mul(o.r.max(o.g).max(o.b).oneMinus());n.indirectSpecular.addAssign(e.mul(r)),n.indirectSpecular.addAssign(s.mul(a)),n.indirectDiffuse.addAssign(l.mul(a))}ambientOcclusion({ambientOcclusion:e,reflectedLight:i}){let n=oh.dot(oi).clamp().add(e),r=rB.mul(-16).oneMinus().negate().exp2(),s=e.sub(n.pow(r).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(e),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(e),i.indirectDiffuse.mulAssign(e),i.indirectSpecular.mulAssign(s)}finish(e){let{outgoingLight:i}=e;if(!0===this.clearcoat){let e=hy({dotVH:oc.dot(oi).clamp(),f0:uo,f90:ul}),n=i.mul(rP.mul(e).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(rP));i.assign(n)}if(!0===this.sheen){let e=rN.r.max(rN.g).max(rN.b).mul(.157).oneMinus(),n=i.mul(e).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);i.assign(n)}}}let uu=re(1),uc=re(-2),ud=re(.8),up=re(-1),uf=re(.4),um=re(2),ug=re(.305),uA=re(3),uv=re(.21),uy=re(4),ux=re(4),u_=re(16),ub=n5(([e])=>{let i=rl(sk(e)).toVar(),n=re(-1).toVar();return n7(i.x.greaterThan(i.z),()=>{n7(i.x.greaterThan(i.y),()=>{n.assign(ao(e.x.greaterThan(0),0,3))}).Else(()=>{n.assign(ao(e.y.greaterThan(0),1,4))})}).Else(()=>{n7(i.z.greaterThan(i.y),()=>{n.assign(ao(e.z.greaterThan(0),2,5))}).Else(()=>{n.assign(ao(e.y.greaterThan(0),1,4))})}),n}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),uE=n5(([e,i])=>{let n=rr().toVar();return n7(i.equal(0),()=>{n.assign(rr(e.z,e.y).div(sk(e.x)))}).ElseIf(i.equal(1),()=>{n.assign(rr(e.x.negate(),e.z.negate()).div(sk(e.y)))}).ElseIf(i.equal(2),()=>{n.assign(rr(e.x.negate(),e.y).div(sk(e.z)))}).ElseIf(i.equal(3),()=>{n.assign(rr(e.z.negate(),e.y).div(sk(e.x)))}).ElseIf(i.equal(4),()=>{n.assign(rr(e.x.negate(),e.z).div(sk(e.y)))}).Else(()=>{n.assign(rr(e.x,e.y).div(sk(e.z)))}),r6(.5,n.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),uw=n5(([e])=>{let i=re(0).toVar();return n7(e.greaterThanEqual(ud),()=>{i.assign(uu.sub(e).mul(up.sub(uc)).div(uu.sub(ud)).add(uc))}).ElseIf(e.greaterThanEqual(uf),()=>{i.assign(ud.sub(e).mul(um.sub(up)).div(ud.sub(uf)).add(up))}).ElseIf(e.greaterThanEqual(ug),()=>{i.assign(uf.sub(e).mul(uA.sub(um)).div(uf.sub(ug)).add(um))}).ElseIf(e.greaterThanEqual(uv),()=>{i.assign(ug.sub(e).mul(uy.sub(uA)).div(ug.sub(uv)).add(uA))}).Else(()=>{i.assign(re(-2).mul(sM(r6(1.16,e))))}),i}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),uM=n5(([e,i])=>{let n=e.toVar();n.assign(r6(2,n).sub(1));let r=rl(n,1).toVar();return n7(i.equal(0),()=>{r.assign(r.zyx)}).ElseIf(i.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(i.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(i.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(i.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(i.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),uC=n5(([e,i,n,r,s,a])=>{let o=re(n),l=rl(i),h=ai(uw(o),uc,a),u=sB(h),c=sT(h),d=rl(uS(e,l,c,r,s,a)).toVar();return n7(u.notEqual(0),()=>{let i=rl(uS(e,l,c.add(1),r,s,a)).toVar();d.assign(at(d,i,u))}),d}),uS=n5(([e,i,n,r,s,a])=>{let o=re(n).toVar(),l=rl(i),h=re(ub(l)).toVar(),u=re(sZ(ux.sub(o),0)).toVar();o.assign(sZ(o,ux));let c=re(sE(o)).toVar(),d=rr(uE(l,h).mul(c.sub(2)).add(1)).toVar();return n7(h.greaterThan(2),()=>{d.y.addAssign(c),h.subAssign(3)}),d.x.addAssign(h.mul(c)),d.x.addAssign(u.mul(r6(3,u_))),d.y.addAssign(r6(4,sE(a).sub(c))),d.x.mulAssign(r),d.y.mulAssign(s),e.sample(d).grad(rr(),rr())}),uT=n5(({envMap:e,mipInt:i,outputDirection:n,theta:r,axis:s,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:l})=>{let h=sP(r);return uS(e,n.mul(h).add(s.cross(n).mul(sL(r))).add(s.mul(s.dot(n).mul(h.oneMinus()))),i,a,o,l)}),uR=n5(({n:e,latitudinal:i,poleAxis:n,outputDirection:r,weights:s,samples:a,dTheta:o,mipInt:l,envMap:h,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d})=>{let p=rl(ao(i,n,s5(n,r))).toVar();n7(sv(p.equals(rl(0))),()=>{p.assign(rl(r.z,0,r.x.negate()))}),p.assign(sI(p));let f=rl().toVar();return f.addAssign(s.element(rt(0)).mul(uT({theta:0,axis:p,outputDirection:r,mipInt:l,envMap:h,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d}))),lT({start:rt(1),end:e},({i:e})=>{n7(e.greaterThanEqual(a),()=>{lR()});let i=re(o.mul(re(e))).toVar();f.addAssign(s.element(e).mul(uT({theta:i.mul(-1),axis:p,outputDirection:r,mipInt:l,envMap:h,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d}))),f.addAssign(s.element(e).mul(uT({theta:i,axis:p,outputDirection:r,mipInt:l,envMap:h,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d})))}),rd(f,1)}),uI=null,uB=new WeakMap,uL=n3(class extends ny{static get type(){return"PMREMNode"}constructor(e,i=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=i,this.levelNode=n,this._generator=null;let r=new eE.xEZ;r.isRenderTargetTexture=!0,this._texture=aW(r),this._width=rM(0),this._height=rM(0),this._maxMip=rM(0),this.updateBeforeType=nu.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){let i=function(e){let i=Math.log2(e)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:1/e,maxMip:i}}(e.image.height);this._texture.value=e,this._width.value=i.texelWidth,this._height.value=i.texelHeight,this._maxMip.value=i.maxMip}updateBefore(){let e=this._pmrem,i=e?e.pmremVersion:-1,n=this._value;i!==n.pmremVersion&&null!==(e=!0===n.isPMREMTexture?n:function(e){let i=uB.get(e);if((void 0!==i?i.pmremVersion:-1)!==e.pmremVersion){let r=e.image;if(e.isCubeTexture){if(!function(e){if(null==e)return!1;let i=0;for(let n=0;n<6;n++)void 0!==e[n]&&i++;return 6===i}(r))return null;i=uI.fromCubemap(e,i)}else{var n;if(!(null!=(n=r)&&n.height>0))return null;i=uI.fromEquirectangular(e,i)}i.pmremVersion=e.pmremVersion,uB.set(e,i)}return i.texture}(n))&&(this._pmrem=e,this.updateFromTexture(e))}setup(e){null===uI&&(uI=e.createPMREMGenerator()),this.updateBefore(e);let i=this.uvNode;null===i&&e.context.getUV&&(i=e.context.getUV(this));let n=this.value;e.renderer.coordinateSystem===eE._RZ&&!0!==n.isPMREMTexture&&!0===n.isRenderTargetTexture&&(i=rl(i.x.negate(),i.yz)),i=rl(i.x,i.y.negate(),i.z);let r=this.levelNode;return null===r&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),uC(this._texture,i,r,this._width,this._height,this._maxMip)}}),uP=new WeakMap;class uD extends lD{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){let{material:i}=e,n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){let e=n.isTextureNode?n.value:i[n.property],r=uP.get(e);void 0===r&&(r=uL(e),uP.set(e,r)),n=r}let r=i.envMap?oS("envMapIntensity","float",e.material):oS("environmentIntensity","float",e.scene),s=!0===i.useAnisotropy||i.anisotropy>0?oO:oh,a=n.context(uN(rB,s)).mul(r),o=n.context(uO(ou)).mul(Math.PI).mul(r),l=aP(a),h=aP(o);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(h);let u=e.context.lightingModel.clearcoatRadiance;if(u){let e=aP(n.context(uN(rD,oc)).mul(r));u.addAssign(e)}}}let uN=(e,i)=>{let n=null;return{getUV:()=>(null===n&&(n=oi.negate().reflect(i),n=(n=e.mul(e).mix(n,i).normalize()).transformDirection(aJ)),n),getTextureLevel:()=>e}},uO=e=>({getUV:()=>e,getTextureLevel:()=>re(1)}),uU=new eE.Wid;class uk extends l9{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(uU),this.setValues(e)}setupEnvironment(e){let i=super.setupEnvironment(e);return null===i&&e.environmentNode&&(i=e.environmentNode),i?new uD(i):null}setupLightingModel(){return new uh}setupSpecular(){let e=at(rl(.04),rR.rgb,rL);rH.assign(e),rQ.assign(1)}setupVariants(){let e=this.metalnessNode?re(this.metalnessNode):o1;rL.assign(e);let i=this.roughnessNode?re(this.roughnessNode):o0;i=hI({roughness:i}),rB.assign(i),this.setupSpecular(),rR.assign(rd(rR.rgb.mul(e.oneMinus()),rR.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}let uF=new eE.EJi;class uz extends uk{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(uF),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){let e=this.iorNode?re(this.iorNode):ls;rY.assign(e),rH.assign(at(sJ(s8(rY.sub(1).div(rY.add(1))).mul(oJ),rl(1)).mul(oY),rR.rgb,rL)),rQ.assign(at(oY,1,rL))}setupLightingModel(){return new uh(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){let e=this.clearcoatNode?re(this.clearcoatNode):o3,i=this.clearcoatRoughnessNode?re(this.clearcoatRoughnessNode):o4;rP.assign(e),rD.assign(hI({roughness:i}))}if(this.useSheen){let e=this.sheenNode?rl(this.sheenNode):o8,i=this.sheenRoughnessNode?re(this.sheenRoughnessNode):o7;rN.assign(e),rO.assign(i)}if(this.useIridescence){let e=this.iridescenceNode?re(this.iridescenceNode):le,i=this.iridescenceIORNode?re(this.iridescenceIORNode):lt,n=this.iridescenceThicknessNode?re(this.iridescenceThicknessNode):li;rU.assign(e),rk.assign(i),rF.assign(n)}if(this.useAnisotropy){let e=(this.anisotropyNode?rr(this.anisotropyNode):o9).toVar();rG.assign(e.length()),n7(rG.equal(0),()=>{e.assign(rr(1,0))}).Else(()=>{e.divAssign(rr(rG)),rG.assign(rG.saturate())}),rz.assign(rG.pow2().mix(rB.pow2(),1)),rV.assign(oN[0].mul(e.x).add(oN[1].mul(e.y))),rj.assign(oN[1].mul(e.x).sub(oN[0].mul(e.y)))}if(this.useTransmission){let e=this.transmissionNode?re(this.transmissionNode):ln,i=this.thicknessNode?re(this.thicknessNode):lr,n=this.attenuationDistanceNode?re(this.attenuationDistanceNode):la,r=this.attenuationColorNode?rl(this.attenuationColorNode):lo;if(rJ.assign(e),rZ.assign(i),r$.assign(n),r0.assign(r),this.useDispersion){let e=this.dispersionNode?re(this.dispersionNode):ld;r1.assign(e)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?rl(this.clearcoatNormalNode):o5}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}let uG=n5(({normal:e,lightDirection:i,builder:n})=>{let r=rr(e.dot(i).mul(.5).add(.5),0);if(n.material.gradientMap)return rl(oI("gradientMap","texture").context({getUV:()=>r}).r);{let e=r.fwidth().mul(.5);return at(rl(.7),rl(1),ar(re(.7).sub(e.x),re(.7).add(e.x),r.x))}});class uV extends hm{direct({lightDirection:e,lightColor:i,reflectedLight:n},r,s){let a=uG({normal:or,lightDirection:e,builder:s}).mul(i);n.directDiffuse.addAssign(a.mul(hx({diffuseColor:rR.rgb})))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:n}){n.indirectDiffuse.addAssign(i.mul(hx({diffuseColor:rR}))),n.indirectDiffuse.mulAssign(e)}}let uj=new eE.IKL;class uH extends l9{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(uj),this.setValues(e)}setupLightingModel(){return new uV}}let uQ=n4(class extends ny{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){let e=rl(oi.z,0,oi.x.negate()).normalize(),i=oi.cross(e);return rr(e.dot(oh),i.dot(oh)).mul(.495).add(.5)}}),uW=new eE.kaV;class uq extends l9{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(uW),this.setValues(e)}setupVariants(e){let i;i=e.material.matcap?oI("matcap","texture").context({getUV:()=>uQ}):rl(at(.2,.8,uQ.y)),rR.rgb.mulAssign(i.rgb)}}let uX=new eE.UY4;class uK extends l9{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.isPointsNodeMaterial=!0,this.setDefaultValues(uX),this.setValues(e)}}let uY=n3(class extends ny{static get type(){return"RotateNode"}constructor(e,i){super(),this.positionNode=e,this.rotationNode=i}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){let{rotationNode:i,positionNode:n}=this;if("vec2"===this.getNodeType(e)){let e=i.cos(),r=i.sin();return rg(e,r,r.negate(),e).mul(n)}{let e=rv(rd(1,0,0,0),rd(0,sP(i.x),sL(i.x).negate(),0),rd(0,sL(i.x),sP(i.x),0),rd(0,0,0,1)),r=rv(rd(sP(i.y),0,sL(i.y),0),rd(0,1,0,0),rd(sL(i.y).negate(),0,sP(i.y),0),rd(0,0,0,1)),s=rv(rd(sP(i.z),sL(i.z).negate(),0,0),rd(sL(i.z),sP(i.z),0,0),rd(0,0,1,0),rd(0,0,0,1));return e.mul(r).mul(s).mul(rd(n,1)).xyz}}}),uJ=new eE.xeV;class uZ extends l9{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(uJ),this.setValues(e)}setupPositionView(e){let{object:i,camera:n}=e,r=this.sizeAttenuation,{positionNode:s,rotationNode:a,scaleNode:o}=this,l=a4.mul(rl(s||0)),h=rr(a2[0].xyz.length(),a2[1].xyz.length());if(null!==o&&(h=h.mul(o)),!1===r){if(n.isPerspectiveCamera)h=h.mul(l.z.negate());else{let e=re(2).div(aY.element(1).element(1));h=h.mul(e.mul(2))}}let u=a6.xy;if(i.center&&!0===i.center.isVector2){let e=a_("center","vec2",i);u=u.sub(e.sub(.5))}let c=uY(u=u.mul(h),re(a||o6));return rd(l.xy.add(c),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class u$ extends hm{constructor(){super(),this.shadowNode=re(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){rR.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(rR.rgb)}}let u0=new eE.Tn7;class u1 extends l9{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(u0),this.setValues(e)}setupLightingModel(){return new u$}}n5(({texture:e,uv:i})=>{let n=rl().toVar();return n7(i.x.lessThan(1e-4),()=>{n.assign(rl(1,0,0))}).ElseIf(i.y.lessThan(1e-4),()=>{n.assign(rl(0,1,0))}).ElseIf(i.z.lessThan(1e-4),()=>{n.assign(rl(0,0,1))}).ElseIf(i.x.greaterThan(.9999),()=>{n.assign(rl(-1,0,0))}).ElseIf(i.y.greaterThan(.9999),()=>{n.assign(rl(0,-1,0))}).ElseIf(i.z.greaterThan(.9999),()=>{n.assign(rl(0,0,-1))}).Else(()=>{let r=e.sample(i.add(rl(-.01,0,0))).r.sub(e.sample(i.add(rl(.01,0,0))).r),s=e.sample(i.add(rl(0,-.01,0))).r.sub(e.sample(i.add(rl(0,.01,0))).r),a=e.sample(i.add(rl(0,0,-.01))).r.sub(e.sample(i.add(rl(0,0,.01))).r);n.assign(rl(r,s,a))}),n.normalize()});class u2{constructor(e,i){this.nodes=e,this.info=i,this._context=self,this._animationLoop=null,this._requestId=null}start(){let e=(i,n)=>{this._requestId=this._context.requestAnimationFrame(e),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,null!==this._animationLoop&&this._animationLoop(i,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}setAnimationLoop(e){this._animationLoop=e}setContext(e){this._context=e}dispose(){this.stop()}}class u3{constructor(){this.weakMap=new WeakMap}get(e){let i=this.weakMap;for(let n=0;n<e.length;n++)if(void 0===(i=i.get(e[n])))return;return i.get(e[e.length-1])}set(e,i){let n=this.weakMap;for(let i=0;i<e.length;i++){let r=e[i];!1===n.has(r)&&n.set(r,new WeakMap),n=n.get(r)}return n.set(e[e.length-1],i),this}delete(e){let i=this.weakMap;for(let n=0;n<e.length;n++)if(void 0===(i=i.get(e[n])))return!1;return i.delete(e[e.length-1])}}let u4=0;class u5{constructor(e,i,n,r,s,a,o,l,h,u){this.id=u4++,this._nodes=e,this._geometries=i,this.renderer=n,this.object=r,this.material=s,this.scene=a,this.camera=o,this.lightsNode=l,this.context=h,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=null!==u?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return null!==this.clippingContext&&this.clippingContext.cacheKey!==this.clippingContextCacheKey&&(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return!0===this.material.hardwareClipping?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(null!==this.attributes)return this.attributes;let e=this.getNodeBuilderState().nodeAttributes,i=this.geometry,n=[],r=new Set;for(let s of e){let e=s.node&&s.node.attribute?s.node.attribute:i.getAttribute(s.name);if(void 0===e)continue;n.push(e);let a=e.isInterleavedBufferAttribute?e.data:e;r.add(a)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){let{object:e,material:i,geometry:n,group:r,drawRange:s}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),l=null!==o,h=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(0===h)return null;if(a.instanceCount=h,!0===e.isBatchedMesh)return a;let u=1;!0!==i.wireframe||e.isPoints||e.isLineSegments||e.isLine||e.isLineLoop||(u=2);let c=s.start*u,d=(s.start+s.count)*u;null!==r&&(c=Math.max(c,r.start*u),d=Math.min(d,(r.start+r.count)*u));let p=n.attributes.position,f=1/0;l?f=o.count:null!=p&&(f=p.count),c=Math.max(c,0);let m=(d=Math.min(d,f))-c;return m<0||m===1/0?null:(a.vertexCount=m,a.firstVertex=c,a)}getGeometryCacheKey(){let{geometry:e}=this,i="";for(let n of Object.keys(e.attributes).sort()){let r=e.attributes[n];i+=n+",",r.data&&(i+=r.data.stride+","),r.offset&&(i+=r.offset+","),r.itemSize&&(i+=r.itemSize+","),r.normalized&&(i+="n,")}return e.index&&(i+="index,"),i}getMaterialCacheKey(){let{object:e,material:i}=this,n=i.customProgramCacheKey();for(let e of function(e){let i=Object.keys(e),n=Object.getPrototypeOf(e);for(;n;){let e=Object.getOwnPropertyDescriptors(n);for(let n in e)if(void 0!==e[n]){let r=e[n];r&&"function"==typeof r.get&&i.push(n)}n=Object.getPrototypeOf(n)}return i}(i)){let r;if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(e))continue;let s=i[e];if(null!==s){let e=typeof s;"number"===e?r=0!==s?"1":"0":"object"===e?(r="{",s.isTexture&&(r+=s.mapping),r+="}"):r=String(s)}else r=String(s);n+=r+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.morphTargetInfluences&&(n+=e.morphTargetInfluences.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",null!==e._colorsTexture&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),i9(n+=e.receiveShadow+",")}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(e+=1),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}let u6=[];class u8{constructor(e,i,n,r,s,a){this.renderer=e,this.nodes=i,this.geometries=n,this.pipelines=r,this.bindings=s,this.info=a,this.chainMaps={}}get(e,i,n,r,s,a,o,l){let h=this.getChainMap(l);u6[0]=e,u6[1]=i,u6[2]=a,u6[3]=s;let u=h.get(u6);return void 0===u?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,i,n,r,s,a,o,l),h.set(u6,u)):(u.updateClipping(o),u.needsGeometryUpdate&&u.setGeometry(e.geometry),(u.version!==i.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(e,i,n,r,s,a,o,l)):u.version=i.version)),u}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new u3)}dispose(){this.chainMaps={}}createRenderObject(e,i,n,r,s,a,o,l,h,u,c){let d=this.getChainMap(c),p=new u5(e,i,n,r,s,a,o,l,h,u);return p.onDispose=()=>{this.pipelines.delete(p),this.bindings.delete(p),this.nodes.delete(p),d.delete(p.getChainArray())},p}}class u7{constructor(){this.data=new WeakMap}get(e){let i=this.data.get(e);return void 0===i&&(i={},this.data.set(e,i)),i}delete(e){let i=null;return this.data.has(e)&&(i=this.data.get(e),this.data.delete(e)),i}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}let u9={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4};class ce extends u7{constructor(e){super(),this.backend=e}delete(e){let i=super.delete(e);return void 0!==i&&this.backend.destroyAttribute(e),i}update(e,i){let n=this.get(e);if(void 0===n.version)i===u9.VERTEX?this.backend.createAttribute(e):i===u9.INDEX?this.backend.createIndexAttribute(e):i===u9.STORAGE?this.backend.createStorageAttribute(e):i===u9.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{let i=this._getBufferAttribute(e);(n.version<i.version||i.usage===eE.dj0)&&(this.backend.updateAttribute(e),n.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function ct(e){return null!==e.index?e.index.version:e.attributes.position.version}function ci(e){let i=[],n=e.index,r=e.attributes.position;if(null!==n){let e=n.array;for(let n=0,r=e.length;n<r;n+=3){let r=e[n+0],s=e[n+1],a=e[n+2];i.push(r,s,s,a,a,r)}}else{let e=r.array;for(let n=0,r=e.length/3-1;n<r;n+=3){let e=n+0,r=n+1,s=n+2;i.push(e,r,r,s,s,e)}}let s=new(!function(e){for(let i=e.length-1;i>=0;--i)if(e[i]>=65535)return!0;return!1}(i)?eE.qlB:eE.lCJ)(i,1);return s.version=ct(e),s}class cn extends u7{constructor(e,i){super(),this.attributes=e,this.info=i,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){let i=e.geometry;return super.has(i)&&!0===this.get(i).initialized}updateForRender(e){!1===this.has(e)&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){let i=e.geometry;this.get(i).initialized=!0,this.info.memory.geometries++;let n=()=>{this.info.memory.geometries--;let r=i.index,s=e.getAttributes();for(let e of(null!==r&&this.attributes.delete(r),s))this.attributes.delete(e);let a=this.wireframes.get(i);void 0!==a&&this.attributes.delete(a),i.removeEventListener("dispose",n)};i.addEventListener("dispose",n)}updateAttributes(e){for(let i of e.getAttributes())i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,u9.STORAGE):this.updateAttribute(i,u9.VERTEX);let i=this.getIndex(e);null!==i&&this.updateAttribute(i,u9.INDEX);let n=e.geometry.indirect;null!==n&&this.updateAttribute(n,u9.INDIRECT)}updateAttribute(e,i){let n=this.info.render.calls;e.isInterleavedBufferAttribute?void 0===this.attributeCall.get(e)?(this.attributes.update(e,i),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,i),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,i),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){let{geometry:i,material:n}=e,r=i.index;if(!0===n.wireframe){let e=this.wireframes,n=e.get(i);void 0===n?(n=ci(i),e.set(i,n)):n.version!==ct(i)&&(this.attributes.delete(n),n=ci(i),e.set(i,n)),r=n}return r}}class cr{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(e,i,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=i/3*n:e.isPoints?this.render.points+=n*i:e.isLineSegments?this.render.lines+=i/2*n:e.isLine?this.render.lines+=n*(i-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(e,i){0===this[e].timestampCalls&&(this[e].timestamp=0),this[e].timestamp+=i,this[e].timestampCalls++,this[e].timestampCalls>=this[e].previousFrameCalls&&(this[e].timestampCalls=0)}reset(){let e=this.render.frameCalls;this.render.previousFrameCalls=e;let i=this.compute.frameCalls;this.compute.previousFrameCalls=i,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class cs{constructor(e){this.cacheKey=e,this.usedTimes=0}}class ca extends cs{constructor(e,i,n){super(e),this.vertexProgram=i,this.fragmentProgram=n}}class co extends cs{constructor(e,i){super(e),this.computeProgram=i,this.isComputePipeline=!0}}let cl=0;class ch{constructor(e,i,n,r=null,s=null){this.id=cl++,this.code=e,this.stage=i,this.name=n,this.transforms=r,this.attributes=s,this.usedTimes=0}}class cu extends u7{constructor(e,i){super(),this.backend=e,this.nodes=i,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,i){let{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){let s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);let a=this.nodes.getForCompute(e),o=this.programs.compute.get(a.computeShader);void 0===o&&(s&&0===s.computeProgram.usedTimes&&this._releaseProgram(s.computeProgram),o=new ch(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),n.createProgram(o));let l=this._getComputeCacheKey(e,o),h=this.caches.get(l);void 0===h&&(s&&0===s.usedTimes&&this._releasePipeline(s),h=this._getComputePipeline(e,o,l,i)),h.usedTimes++,o.usedTimes++,r.version=e.version,r.pipeline=h}return r.pipeline}getForRender(e,i=null){let{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){let s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);let a=e.getNodeBuilderState(),o=e.material?e.material.name:"",l=this.programs.vertex.get(a.vertexShader);void 0===l&&(s&&0===s.vertexProgram.usedTimes&&this._releaseProgram(s.vertexProgram),l=new ch(a.vertexShader,"vertex",o),this.programs.vertex.set(a.vertexShader,l),n.createProgram(l));let h=this.programs.fragment.get(a.fragmentShader);void 0===h&&(s&&0===s.fragmentProgram.usedTimes&&this._releaseProgram(s.fragmentProgram),h=new ch(a.fragmentShader,"fragment",o),this.programs.fragment.set(a.fragmentShader,h),n.createProgram(h));let u=this._getRenderCacheKey(e,l,h),c=this.caches.get(u);void 0===c?(s&&0===s.usedTimes&&this._releasePipeline(s),c=this._getRenderPipeline(e,l,h,u,i)):e.pipeline=c,c.usedTimes++,l.usedTimes++,h.usedTimes++,r.pipeline=c}return r.pipeline}delete(e){let i=this.get(e).pipeline;return i&&(i.usedTimes--,0===i.usedTimes&&this._releasePipeline(i),i.isComputePipeline?(i.computeProgram.usedTimes--,0===i.computeProgram.usedTimes&&this._releaseProgram(i.computeProgram)):(i.fragmentProgram.usedTimes--,i.vertexProgram.usedTimes--,0===i.vertexProgram.usedTimes&&this._releaseProgram(i.vertexProgram),0===i.fragmentProgram.usedTimes&&this._releaseProgram(i.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,i,n,r){n=n||this._getComputeCacheKey(e,i);let s=this.caches.get(n);return void 0===s&&(s=new co(n,i),this.caches.set(n,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,i,n,r,s){r=r||this._getRenderCacheKey(e,i,n);let a=this.caches.get(r);return void 0===a&&(a=new ca(r,i,n),this.caches.set(r,a),e.pipeline=a,this.backend.createRenderPipeline(e,s)),a}_getComputeCacheKey(e,i){return e.id+","+i.id}_getRenderCacheKey(e,i,n){return i.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){let i=e.code,n=e.stage;this.programs[n].delete(i)}_needsComputeUpdate(e){let i=this.get(e);return void 0===i.pipeline||i.version!==e.version}_needsRenderUpdate(e){return void 0===this.get(e).pipeline||this.backend.needsRenderUpdate(e)}}class cc extends u7{constructor(e,i,n,r,s,a){super(),this.backend=e,this.textures=n,this.pipelines=s,this.attributes=r,this.nodes=i,this.info=a,this.pipelines.bindings=this}getForRender(e){let i=e.getBindings();for(let e of i){let n=this.get(e);void 0===n.bindGroup&&(this._init(e),this.backend.createBindings(e,i,0),n.bindGroup=e)}return i}getForCompute(e){let i=this.nodes.getForCompute(e).bindings;for(let e of i){let n=this.get(e);void 0===n.bindGroup&&(this._init(e),this.backend.createBindings(e,i,0),n.bindGroup=e)}return i}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(let i of e)this._update(i,e)}_init(e){for(let i of e.bindings)if(i.isSampledTexture)this.textures.updateTexture(i.texture);else if(i.isStorageBuffer){let e=i.attribute,n=e.isIndirectStorageBufferAttribute?u9.INDIRECT:u9.STORAGE;this.attributes.update(e,n)}}_update(e,i){let{backend:n}=this,r=!1,s=!0,a=0,o=0;for(let i of e.bindings)if(!i.isNodeUniformsGroup||!1!==this.nodes.updateGroup(i)){if(i.isUniformBuffer)i.update()&&n.updateBinding(i);else if(i.isSampler)i.update();else if(i.isSampledTexture){let e=this.textures.get(i.texture);i.needsBindingsUpdate(e.generation)&&(r=!0);let l=i.update(),h=i.texture;l&&this.textures.updateTexture(h);let u=n.get(h);if(void 0!==u.externalTexture||e.isDefaultTexture?s=!1:(a=10*a+h.id,o+=h.version),!0===n.isWebGPUBackend&&void 0===u.texture&&void 0===u.externalTexture&&(console.error("Bindings._update: binding should be available:",i,l,h,i.textureNode.value,r),this.textures.updateTexture(h),r=!0),!0===h.isStorageTexture){let e=this.get(h);!0===i.store?e.needsMipmap=!0:this.textures.needsMipmaps(h)&&!0===e.needsMipmap&&(this.backend.generateMipmaps(h),e.needsMipmap=!1)}}}!0===r&&this.backend.updateBindings(e,i,s?a:0,o)}}function cd(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.material.id!==i.material.id?e.material.id-i.material.id:e.z!==i.z?e.z-i.z:e.id-i.id}function cp(e,i){return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.z!==i.z?i.z-e.z:e.id-i.id}function cf(e){return(e.transmission>0||e.transmissionNode)&&e.side===eE.ehD&&!1===e.forceSinglePass}class cm{constructor(e,i,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(i,n),this.lightsArray=[],this.scene=i,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,i,n,r,s,a,o){let l=this.renderItems[this.renderItemsIndex];return void 0===l?(l={id:e.id,object:e,geometry:i,material:n,groupOrder:r,renderOrder:e.renderOrder,z:s,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=i,l.material=n,l.groupOrder=r,l.renderOrder=e.renderOrder,l.z=s,l.group=a,l.clippingContext=o),this.renderItemsIndex++,l}push(e,i,n,r,s,a,o){let l=this.getNextRenderItem(e,i,n,r,s,a,o);!0===e.occlusionTest&&this.occlusionQueryCount++,!0===n.transparent||n.transmission>0?(cf(n)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,i,n,r,s,a,o){let l=this.getNextRenderItem(e,i,n,r,s,a,o);!0===n.transparent||n.transmission>0?(cf(n)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,i){this.opaque.length>1&&this.opaque.sort(e||cd),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(i||cp),this.transparent.length>1&&this.transparent.sort(i||cp)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,i=this.renderItems.length;e<i;e++){let i=this.renderItems[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.groupOrder=null,i.renderOrder=null,i.z=null,i.group=null,i.clippingContext=null}}}class cg{constructor(e){this.lighting=e,this.lists=new u3}get(e,i){let n=this.lists,r=[e,i],s=n.get(r);return void 0===s&&(s=new cm(this.lighting,e,i),n.set(r,s)),s}dispose(){this.lists=new u3}}let cA=0;class cv{constructor(){this.id=cA++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new eE.Ltg,this.scissor=!1,this.scissorValue=new eE.Ltg,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return cy(this)}}function cy(e){let{textures:i,activeCubeFace:n}=e,r=[n];for(let e of i)r.push(e.id);return ne(r)}class cx{constructor(){this.chainMaps={}}get(e=null,i=null,n=null){let r;let s=[];if(null!==e&&s.push(e),null!==i&&s.push(i),0===s.length&&s.push({id:"default"}),null===n)r="default";else{let e=n.texture.format,i=n.textures.length;r=`${i}:${e}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}let a=this.getChainMap(r),o=a.get(s);return void 0===o&&(o=new cv,a.set(s,o)),null!==n&&(o.sampleCount=0===n.samples?1:n.samples),o}getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new u3)}dispose(){this.chainMaps={}}}let c_=new eE.Pa4;class cb extends u7{constructor(e,i,n){super(),this.renderer=e,this.backend=i,this.info=n}updateRenderTarget(e,i=0){let n=this.get(e),r=0===e.samples?1:e.samples,s=n.depthTextureMips||(n.depthTextureMips={}),a=e.textures,o=this.getSize(a[0]),l=o.width>>i,h=o.height>>i,u=e.depthTexture||s[i],c=!0===e.depthBuffer||!0===e.stencilBuffer,d=!1;void 0===u&&c&&((u=new eE.$YQ).format=e.stencilBuffer?eE.brP:eE.qkB,u.type=e.stencilBuffer?eE.wJv:eE.JQ4,u.image.width=l,u.image.height=h,s[i]=u),(n.width!==o.width||o.height!==n.height)&&(d=!0,u&&(u.needsUpdate=!0,u.image.width=l,u.image.height=h)),n.width=o.width,n.height=o.height,n.textures=a,n.depthTexture=u||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(d=!0,u&&(u.needsUpdate=!0),n.sampleCount=r);let p={sampleCount:r};for(let e=0;e<a.length;e++){let i=a[e];d&&(i.needsUpdate=!0),this.updateTexture(i,p)}if(u&&this.updateTexture(u,p),!0!==n.initialized){n.initialized=!0;let i=()=>{e.removeEventListener("dispose",i);for(let e=0;e<a.length;e++)this._destroyTexture(a[e]);u&&this._destroyTexture(u),this.delete(e)};e.addEventListener("dispose",i)}}updateTexture(e,i={}){let n=this.get(e);if(!0===n.initialized&&n.version===e.version)return;let r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&!0===n.initialized&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){let i=this.renderer.getRenderTarget();i?e.type=i.texture.type:e.type=eE.ywz}let{width:a,height:o,depth:l}=this.getSize(e);if(i.width=a,i.height=o,i.depth=l,i.needsMipmaps=this.needsMipmaps(e),i.levels=i.needsMipmaps?this.getMipLevels(e,a,o):1,r||!0===e.isStorageTexture)s.createSampler(e),s.createTexture(e,i),n.generation=e.version;else if(!0!==n.initialized&&s.createSampler(e),e.version>0){let r=e.image;if(void 0===r)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(!1===r.complete)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){let n=[];for(let i of e.images)n.push(i);i.images=n}else i.image=r;(void 0===n.isDefaultTexture||!0===n.isDefaultTexture)&&(s.createTexture(e,i),n.isDefaultTexture=!1,n.generation=e.version),!0===e.source.dataReady&&s.updateTexture(e,i),i.needsMipmaps&&0===e.mipmaps.length&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(!0!==n.initialized){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;let i=()=>{e.removeEventListener("dispose",i),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",i)}n.version=e.version}getSize(e,i=c_){let n=e.images?e.images[0]:e.image;return n?(void 0!==n.image&&(n=n.image),i.width=n.width||1,i.height=n.height||1,i.depth=e.isCubeTexture?6:n.depth||1):i.width=i.height=i.depth=1,i}getMipLevels(e,i,n){let r;return e.isCompressedTexture?e.mipmaps?e.mipmaps.length:1:Math.floor(Math.log2(Math.max(i,n)))+1}needsMipmaps(e){return this.isEnvironmentTexture(e)||!0===e.isCompressedTexture||e.generateMipmaps}isEnvironmentTexture(e){let i=e.mapping;return i===eE.dSO||i===eE.Bf4||i===eE.fY$||i===eE.vxC}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class cE extends eE.Ilk{constructor(e,i,n,r=1){super(e,i,n),this.a=r}set(e,i,n,r=1){return this.a=r,super.set(e,i,n)}copy(e){return void 0!==e.a&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class cw extends rC{static get type(){return"ParameterNode"}constructor(e,i=null){super(e,i),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}let cM=n3(class extends ng{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,i){let n=new n$(i);return this._currentCond=ao(e,n),this.add(this._currentCond)}ElseIf(e,i){let n=ao(e,new n$(i));return this._currentCond.elseNode=n,this._currentCond=n,this}Else(e){return this._currentCond.elseNode=new n$(e),this}build(e,...i){let n=n8();for(let i of(n6(this),this.nodes))i.build(e,"void");return n6(n),this.outputNode?this.outputNode.build(e,...i):super.build(e,...i)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}});class cC extends ng{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}setup(e){super.setup(e);let i=this.members,n=[];for(let r=0;r<i.length;r++)n.push(i[r].getNodeType(e));this.nodeType=e.getStructTypeFromNode(this,n).name}generate(e,i){let n=e.getOutputStructName(),r=this.members,s=""!==n?n+".":"";for(let n=0;n<r.length;n++){let a=r[n].build(e,i);e.addLineFlowCode(`${s}m${n} = ${a}`,this)}return n}}let cS=n3(class extends cC{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return void 0!==this.outputNodes[e]}get(e){return this.outputNodes[e]}merge(e){return cS({...this.outputNodes,...e.outputNodes})}setup(e){let i=this.outputNodes,n=e.renderer.getRenderTarget(),r=[],s=n.textures;for(let e in i)r[function(e,i){for(let n=0;n<e.length;n++)if(e[n].name===i)return n;return -1}(s,e)]=rd(i[e]);return this.members=r,super.setup(e)}});new eE.JOQ,new eE.Pa4,new eE.Pa4,new eE.Pa4,new eE.yGw,new eE.Pa4(0,0,-1),new eE.Ltg,new eE.Pa4,new eE.Pa4,new eE.Ltg,new eE.FM8;let cT=new eE.ACn;lF.flipX(),cT.depthTexture=new eE.$YQ(1,1);let cR=new eE.iKG(-1,1,1,-1,0,1);class cI extends eE.u9r{constructor(e=!1){super(),this.setAttribute("position",new eE.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new eE.a$l(!1===e?[0,-1,0,1,2,1]:[0,2,0,0,2,0],2))}}let cB=new cI;class cL extends eE.Kj0{constructor(e=null){super(cB,e),this.camera=cR,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,cR)}render(e){e.render(this,cR)}}eE.lb7,eE.TlE;let cP=new eE.USm,cD=new eE.yGw;class cN extends ng{static get type(){return"SceneNode"}constructor(e=cN.BACKGROUND_BLURRINESS,i=null){super(),this.scope=e,this.scene=i}setup(e){let i;let n=this.scope,r=null!==this.scene?this.scene:e.scene;return n===cN.BACKGROUND_BLURRINESS?i=oS("backgroundBlurriness","float",r):n===cN.BACKGROUND_INTENSITY?i=oS("backgroundIntensity","float",r):n===cN.BACKGROUND_ROTATION?i=rM("mat4").label("backgroundRotation").setGroup(rb).onRenderUpdate(()=>{let e=r.background;return null!==e&&e.isTexture&&e.mapping!==eE.xfE?(cP.copy(r.backgroundRotation),cP.x*=-1,cP.y*=-1,cP.z*=-1,cD.makeRotationFromEuler(cP)):cD.identity(),cD}):console.error("THREE.SceneNode: Unknown scope:",n),i}}cN.BACKGROUND_BLURRINESS="backgroundBlurriness",cN.BACKGROUND_INTENSITY="backgroundIntensity",cN.BACKGROUND_ROTATION="backgroundRotation";let cO=n4(cN,cN.BACKGROUND_BLURRINESS),cU=n4(cN,cN.BACKGROUND_INTENSITY),ck=n4(cN,cN.BACKGROUND_ROTATION);new WeakMap;let cF=new eE.FM8;class cz extends aQ{static get type(){return"PassTextureNode"}constructor(e,i){super(i),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class cG extends cz{static get type(){return"PassMultipleTextureNode"}constructor(e,i,n=!1){super(e,null),this.textureName=i,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class cV extends ny{static get type(){return"PassNode"}constructor(e,i,n,r={}){super("vec4"),this.scope=e,this.scene=i,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;let s=new eE.$YQ;s.isRenderTargetTexture=!0,s.name="depth";let a=new eE.ACn(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:eE.cLu,...r});a.texture.name="output",a.depthTexture=s,this.renderTarget=a,this._textures={output:a.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=rM(0),this._cameraFar=rM(0),this._mrt=null,this.isPassNode=!0,this.updateBeforeType=nu.FRAME}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let i=this._textures[e];return void 0===i&&((i=this.renderTarget.texture.clone()).name=e,this._textures[e]=i,this.renderTarget.textures.push(i)),i}getPreviousTexture(e){let i=this._previousTextures[e];return void 0===i&&(i=this.getTexture(e).clone(),this._previousTextures[e]=i),i}toggleTexture(e){let i=this._previousTextures[e];if(void 0!==i){let n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=i,this._textures[e]=i,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let i=this._textureNodes[e];return void 0===i&&((i=n0(new cG(this,e))).updateTexture(),this._textureNodes[e]=i),i}getPreviousTextureNode(e="output"){let i=this._previousTextureNodes[e];return void 0===i&&(void 0===this._textureNodes[e]&&this.getTextureNode(e),(i=n0(new cG(this,e,!0))).updateTexture(),this._previousTextureNodes[e]=i),i}getViewZNode(e="depth"){let i=this._viewZNodes[e];if(void 0===i){let n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=i=lJ(this.getTextureNode(e),n,r)}return i}getLinearDepthNode(e="depth"){let i=this._linearDepthNodes[e];if(void 0===i){let n=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=i=lK(s,n,r)}return i}setup({renderer:e}){return this.renderTarget.samples=void 0===this.options.samples?e.samples:this.options.samples,!0===e.backend.isWebGLBackend&&(this.renderTarget.samples=0),this.scope===cV.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){let{renderer:i}=e,{scene:n,camera:r}=this;this._pixelRatio=i.getPixelRatio();let s=i.getSize(cF);this.setSize(s.width,s.height);let a=i.getRenderTarget(),o=i.getMRT();for(let e in this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._previousTextures)this.toggleTexture(e);i.setRenderTarget(this.renderTarget),i.setMRT(this._mrt),i.render(n,r),i.setRenderTarget(a),i.setMRT(o)}setSize(e,i){this._width=e,this._height=i;let n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}cV.COLOR="color",cV.DEPTH="depth";let cj=n5(([e,i])=>e.mul(i).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),cH=n5(([e,i])=>(e=e.mul(i)).div(e.add(1)).clamp()).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),cQ=n5(([e,i])=>{let n=(e=(e=e.mul(i)).sub(.004).max(0)).mul(e.mul(6.2).add(.5)),r=e.mul(e.mul(6.2).add(1.7)).add(.06);return n.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),cW=n5(([e])=>{let i=e.mul(e.add(.0245786)).sub(90537e-9),n=e.mul(e.add(.432951).mul(.983729)).add(.238081);return i.div(n)}),cq=n5(([e,i])=>{let n=rA(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=rA(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(i).div(.6),e=cW(e=n.mul(e)),(e=r.mul(e)).clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),cX=rA(rl(1.6605,-.1246,-.0182),rl(-.5876,1.1329,-.1006),rl(-.0728,-.0083,1.1187)),cK=rA(rl(.6274,.0691,.0164),rl(.3293,.9195,.088),rl(.0433,.0113,.8956)),cY=n5(([e])=>{let i=rl(e).toVar(),n=rl(i.mul(i)).toVar(),r=rl(n.mul(n)).toVar();return re(15.5).mul(r.mul(n)).sub(r6(40.14,r.mul(i))).add(r6(31.96,r).sub(r6(6.868,n.mul(i))).add(r6(.4298,n).add(r6(.1191,i).sub(.00232))))}),cJ=n5(([e,i])=>{let n=rl(e).toVar(),r=rA(rl(.856627153315983,.137318972929847,.11189821299995),rl(.0951212405381588,.761241990602591,.0767994186031903),rl(.0482516061458583,.101439036467562,.811302368396859)),s=rA(rl(1.1271005818144368,-.1413297634984383,-.14132976349843826),rl(-.11060664309660323,1.157823702216272,-.11060664309660294),rl(-.016493938717834573,-.016493938717834257,1.2519364065950405)),a=re(-12.47393),o=re(4.026069);return n.mulAssign(i),n.assign(cK.mul(n)),n.assign(r.mul(n)),n.assign(sZ(n,1e-10)),n.assign(sM(n)),n.assign(n.sub(a).div(o.sub(a))),n.assign(ai(n,0,1)),n.assign(cY(n)),n.assign(s.mul(n)),n.assign(s6(sZ(rl(0),n),rl(2.2))),n.assign(cX.mul(n)),n.assign(ai(n,0,1)),n}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),cZ=n5(([e,i])=>{let n=re(.76),r=re(.15),s=sJ((e=e.mul(i)).r,sJ(e.g,e.b)),a=ao(s.lessThan(.08),s.sub(r6(6.25,s.mul(s))),.04);e.subAssign(a);let o=sZ(e.r,sZ(e.g,e.b));n7(o.lessThan(n),()=>e);let l=r5(1,n),h=r5(1,l.mul(l).div(o.add(l.sub(n))));e.mulAssign(h.div(o));let u=r5(1,r8(1,r.mul(o.sub(h)).add(1)));return at(e,rl(h),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class c$ extends ng{static get type(){return"CodeNode"}constructor(e="",i=[],n=""){super("code"),this.isCodeNode=!0,this.code=e,this.includes=i,this.language=n}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){for(let i of this.getIncludes(e))i.build(e);let i=e.getCodeFromNode(this,this.getNodeType(e));return i.code=this.code,i.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class c0 extends c${static get type(){return"FunctionNode"}constructor(e="",i=[],n=""){super(e,i,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){let i=e.getDataFromNode(this),n=i.nodeFunction;return void 0===n&&(n=e.parser.parseFunction(this.code),i.nodeFunction=n),n}generate(e,i){super.generate(e);let n=this.getNodeFunction(e),r=n.name,s=n.type,a=e.getCodeFromNode(this,s);""!==r&&(a.name=r);let o=e.getPropertyName(a),l=this.getNodeFunction(e).getCode(o);return(a.code=l+"\n","property"===i)?o:e.format(`${o}()`,s,i)}}class c1 extends Map{get(e,i=null,...n){if(this.has(e))return super.get(e);if(null!==i){let r=i(...n);return this.set(e,r),r}}}function c2(e){let i;let n=e.context.getViewZ;return void 0!==n&&(i=n(this)),(i||ot.z).negate()}new c1;let c3=n5(([e,i],n)=>ar(e,i,c2(n))),c4=n5(([e],i)=>{let n=c2(i);return e.mul(e,n,n).negate().exp().oneMinus()}),c5=n5(([e,i])=>rd(i.toFloat().mix(rq.rgb,e.toVec3()),rq.a));n3(class extends ng{constructor(e){super(),this.scope=e}generate(e){let{scope:i}=this,{renderer:n}=e;!0===n.backend.isWebGLBackend?e.addFlowCode(`	// ${i}Barrier 
`):e.addLineFlowCode(`${i}Barrier()`,this)}});class c6 extends ny{static get type(){return"AtomicFunctionNode"}constructor(e,i,n,r=null){super("uint"),this.method=e,this.pointerNode=i,this.valueNode=n,this.storeNode=r}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){let i=this.method,n=this.getNodeType(e),r=this.getInputType(e),s=this.pointerNode,a=this.valueNode,o=[];o.push(`&${s.build(e,r)}`),o.push(a.build(e,r));let l=`${e.getMethod(i,n)}( ${o.join(", ")} )`;if(null!==this.storeNode){let i=this.storeNode.build(e,r);e.addLineFlowCode(`${i} = ${l}`,this)}else e.addLineFlowCode(l,this)}}function c8(e){let i=(a=a||new WeakMap).get(e);return void 0===i&&a.set(e,i={}),i}function c7(e){let i=c8(e);return i.shadowMatrix||(i.shadowMatrix=rM("mat4").setGroup(rb).onRenderUpdate(()=>(!0!==e.castShadow&&e.shadow.updateMatrices(e),e.shadow.matrix)))}function c9(e){let i=c8(e);return i.position||(i.position=rM(new eE.Pa4).setGroup(rb).onRenderUpdate((i,n)=>n.value.setFromMatrixPosition(e.matrixWorld)))}function de(e){let i=c8(e);return i.viewPosition||(i.viewPosition=rM(new eE.Pa4).setGroup(rb).onRenderUpdate(({camera:i},n)=>{n.value=n.value||new eE.Pa4,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}))}c6.ATOMIC_LOAD="atomicLoad",c6.ATOMIC_STORE="atomicStore",c6.ATOMIC_ADD="atomicAdd",c6.ATOMIC_SUB="atomicSub",c6.ATOMIC_MAX="atomicMax",c6.ATOMIC_MIN="atomicMin",c6.ATOMIC_AND="atomicAnd",c6.ATOMIC_OR="atomicOr",c6.ATOMIC_XOR="atomicXor",n3(c6);let dt=e=>aJ.transformDirection(c9(e).sub(function(e){let i=c8(e);return i.targetPosition||(i.targetPosition=rM(new eE.Pa4).setGroup(rb).onRenderUpdate((i,n)=>n.value.setFromMatrixPosition(e.target.matrixWorld)))}(e))),di=e=>e.sort((e,i)=>e.id-i.id),dn=(e,i)=>{for(let n of i)if(n.isAnalyticLightNode&&n.light.id===e)return n;return null},dr=new WeakMap;class ds extends ng{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=rl().toVar("totalDiffuse"),this.totalSpecularNode=rl().toVar("totalSpecular"),this.outgoingLightNode=rl().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){let e=[],i=this._lights;for(let n=0;n<i.length;n++)e.push(i[n].id);return ne(e)}getHash(e){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(e);let i=[];for(let e of this._lightNodes)i.push(e.getSelf().getHash());this._lightNodesHash="lights-"+i.join(",")}return this._lightNodesHash}analyze(e){for(let i of e.getDataFromNode(this).nodes)i.build(e)}setupLightsNode(e){let i=[],n=this._lightNodes,r=di(this._lights),s=e.renderer.library;for(let e of r)if(e.isNode)i.push(n0(e));else{let r=null;if(null!==n&&(r=dn(e.id,n)),null===r){let n=s.getLightNodeClass(e.constructor);if(null===n){console.warn(`LightsNode.setupNodeLights: Light node not found for ${e.constructor.name}`);continue}let r=null;dr.has(e)?r=dr.get(e):(r=n0(new n(e)),dr.set(e,r)),i.push(r)}}this._lightNodes=i}setupLights(e,i){for(let n of i)n.build(e)}setup(e){null===this._lightNodes&&this.setupLightsNode(e);let i=e.context,n=i.lightingModel,r=this.outgoingLightNode;if(n){let{_lightNodes:s,totalDiffuseNode:a,totalSpecularNode:o}=this;i.outgoingLight=r;let l=e.addStack();e.getDataFromNode(this).nodes=l.nodes,n.start(i,l,e),this.setupLights(e,s),n.indirect(i,l,e);let{backdrop:h,backdropAlpha:u}=i,{directDiffuse:c,directSpecular:d,indirectDiffuse:p,indirectSpecular:f}=i.reflectedLight,m=c.add(p);null!==h&&(m=null!==u?rl(u.mix(m,h)):rl(h),i.material.transparent=!0),a.assign(m),o.assign(d.add(f)),r.assign(a.add(o)),n.finish(i,l,e),r=r.bypass(e.removeStack())}return r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class da extends ng{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=nu.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({material:e}){dl.assign(e.shadowPositionNode||a9)}dispose(){this.updateBeforeType=nu.NONE}}let dl=rl().toVar("shadowPositionWorld"),dh=new WeakMap,du=n5(([e,i,n])=>{let r=a9.sub(e).length();return(r=r.sub(i).div(n.sub(i))).saturate()}),dc=e=>{let i=e.shadow.camera,n=oS("near","float",i).setGroup(rb),r=oS("far","float",i).setGroup(rb);return du(a0(e),n,r)},dd=e=>{let i=dh.get(e);if(void 0===i){let n=e.isPointLight?dc(e):null;(i=new l9).colorNode=rd(0,0,0,1),i.depthNode=n,i.isShadowNodeMaterial=!0,i.name="ShadowMaterial",i.fog=!1,dh.set(e,i)}return i},dp=n5(({depthTexture:e,shadowCoord:i})=>aW(e,i.xy).compare(i.z)),df=n5(({depthTexture:e,shadowCoord:i,shadow:n})=>{let r=(i,n)=>aW(e,i).compare(n),s=oS("mapSize","vec2",n).setGroup(rb),a=oS("radius","float",n).setGroup(rb),o=rr(1).div(s),l=o.x.negate().mul(a),h=o.y.negate().mul(a),u=o.x.mul(a),c=o.y.mul(a),d=l.div(2),p=h.div(2),f=u.div(2),m=c.div(2);return r4(r(i.xy.add(rr(l,h)),i.z),r(i.xy.add(rr(0,h)),i.z),r(i.xy.add(rr(u,h)),i.z),r(i.xy.add(rr(d,p)),i.z),r(i.xy.add(rr(0,p)),i.z),r(i.xy.add(rr(f,p)),i.z),r(i.xy.add(rr(l,0)),i.z),r(i.xy.add(rr(d,0)),i.z),r(i.xy,i.z),r(i.xy.add(rr(f,0)),i.z),r(i.xy.add(rr(u,0)),i.z),r(i.xy.add(rr(d,m)),i.z),r(i.xy.add(rr(0,m)),i.z),r(i.xy.add(rr(f,m)),i.z),r(i.xy.add(rr(l,c)),i.z),r(i.xy.add(rr(0,c)),i.z),r(i.xy.add(rr(u,c)),i.z)).mul(1/17)}),dm=n5(({depthTexture:e,shadowCoord:i,shadow:n})=>{let r=(i,n)=>aW(e,i).compare(n),s=oS("mapSize","vec2",n).setGroup(rb),a=rr(1).div(s),o=a.x,l=a.y,h=i.xy,u=sB(h.mul(s).add(.5));return h.subAssign(u.mul(a)),r4(r(h,i.z),r(h.add(rr(o,0)),i.z),r(h.add(rr(0,l)),i.z),r(h.add(a),i.z),at(r(h.add(rr(o.negate(),0)),i.z),r(h.add(rr(o.mul(2),0)),i.z),u.x),at(r(h.add(rr(o.negate(),l)),i.z),r(h.add(rr(o.mul(2),l)),i.z),u.x),at(r(h.add(rr(0,l.negate())),i.z),r(h.add(rr(0,l.mul(2))),i.z),u.y),at(r(h.add(rr(o,l.negate())),i.z),r(h.add(rr(o,l.mul(2))),i.z),u.y),at(at(r(h.add(rr(o.negate(),l.negate())),i.z),r(h.add(rr(o.mul(2),l.negate())),i.z),u.x),at(r(h.add(rr(o.negate(),l.mul(2))),i.z),r(h.add(rr(o.mul(2),l.mul(2))),i.z),u.x),u.y)).mul(1/9)}),dg=n5(({depthTexture:e,shadowCoord:i})=>{let n=re(1).toVar(),r=aW(e).sample(i.xy).rg,s=s0(i.z,r.x);return n7(s.notEqual(re(1)),()=>{let e=i.z.sub(r.x),a=sZ(0,r.y.mul(r.y)),o=a.div(a.add(e.mul(e)));o=ai(r5(o,.3).div(.95-.3)),n.assign(ai(sZ(s,o)))}),n}),dA=n5(({samples:e,radius:i,size:n,shadowPass:r})=>{let s=re(0).toVar(),a=re(0).toVar(),o=e.lessThanEqual(re(1)).select(re(0),re(2).div(e.sub(1))),l=e.lessThanEqual(re(1)).select(re(0),re(-1));lT({start:rt(0),end:rt(e),type:"int",condition:"<"},({i:e})=>{let h=l.add(re(e).mul(o)),u=r.sample(r4(lG.xy,rr(0,h).mul(i)).div(n)).x;s.addAssign(u),a.addAssign(u.mul(u))}),s.divAssign(e),a.divAssign(e);let h=sC(a.sub(s.mul(s)));return rr(s,h)}),dv=n5(({samples:e,radius:i,size:n,shadowPass:r})=>{let s=re(0).toVar(),a=re(0).toVar(),o=e.lessThanEqual(re(1)).select(re(0),re(2).div(e.sub(1))),l=e.lessThanEqual(re(1)).select(re(0),re(-1));lT({start:rt(0),end:rt(e),type:"int",condition:"<"},({i:e})=>{let h=l.add(re(e).mul(o)),u=r.sample(r4(lG.xy,rr(h,0).mul(i)).div(n));s.addAssign(u.x),a.addAssign(r4(u.y.mul(u.y),u.x.mul(u.x)))}),s.divAssign(e),a.divAssign(e);let h=sC(a.sub(s.mul(s)));return rr(s,h)}),dy=[dp,df,dm,dg],dx=new cL;class d_ extends da{static get type(){return"ShadowNode"}constructor(e,i=null){super(e),this.shadow=i||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this.isShadowNode=!0}setupShadowFilter(e,{filterFn:i,depthTexture:n,shadowCoord:r,shadow:s}){let a=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),o=i({depthTexture:n,shadowCoord:r,shadow:s});return a.select(o,re(1))}setupShadowCoord(e,i){let n;let{shadow:r}=this,{renderer:s}=e,a=oS("bias","float",r).setGroup(rb),o=i;if(r.camera.isOrthographicCamera||!0!==s.logarithmicDepthBuffer)n=(o=o.xyz.div(o.w)).z,s.coordinateSystem===eE.JCZ&&(n=n.mul(2).sub(1));else{let e=o.w;o=o.xy.div(e);let i=oS("near","float",r.camera).setGroup(rb),s=oS("far","float",r.camera).setGroup(rb);n=lZ(e.negate(),i,s)}return rl(o.x,o.y.oneMinus(),n.add(a))}getShadowFilterFn(e){return dy[e]}setupShadow(e){let{renderer:i}=e,{light:n,shadow:r}=this,s=i.shadowMap.type,a=new eE.$YQ(r.mapSize.width,r.mapSize.height);a.compareFunction=eE.D67;let o=e.createRenderTarget(r.mapSize.width,r.mapSize.height);if(o.depthTexture=a,r.camera.updateProjectionMatrix(),s===eE.dwk){a.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:eE.av9,type:eE.cLu}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:eE.av9,type:eE.cLu});let i=aW(a),n=aW(this.vsmShadowMapVertical.texture),s=oS("blurSamples","float",r).setGroup(rb),o=oS("radius","float",r).setGroup(rb),l=oS("mapSize","vec2",r).setGroup(rb),h=this.vsmMaterialVertical||(this.vsmMaterialVertical=new l9);h.fragmentNode=dA({samples:s,radius:o,size:l,shadowPass:i}).context(e.getSharedContext()),h.name="VSMVertical",(h=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new l9)).fragmentNode=dv({samples:s,radius:o,size:l,shadowPass:n}).context(e.getSharedContext()),h.name="VSMHorizontal"}let l=oS("intensity","float",r).setGroup(rb),h=oS("normalBias","float",r).setGroup(rb),u=c7(n).mul(dl.add(ou.mul(h))),c=this.setupShadowCoord(e,u),d=r.filterNode||this.getShadowFilterFn(i.shadowMap.type)||null;if(null===d)throw Error("THREE.WebGPURenderer: Shadow map type not supported yet.");let p=s===eE.dwk?this.vsmShadowMapHorizontal.texture:a,f=this.setupShadowFilter(e,{filterFn:d,shadowTexture:o.texture,depthTexture:p,shadowCoord:c,shadow:r}),m=aW(o.texture,c),g=at(1,f.rgb.mix(m,1),l.mul(m.a)).toVar();return this.shadowMap=o,this.shadow.map=o,g}setup(e){if(!1!==e.renderer.shadowMap.enabled)return n5(()=>{let i=this._node;return this.setupShadowPosition(e),null===i&&(this._node=i=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(i=e.material.receivedShadowNode(i)),i})()}renderShadow(e){let{shadow:i,shadowMap:n,light:r}=this,{renderer:s,scene:a}=e;i.updateMatrices(r),n.setSize(i.mapSize.width,i.mapSize.height),s.render(a,i.camera)}updateShadow(e){var i,n,r,s;let{shadowMap:a,light:l,shadow:h}=this,{renderer:u,scene:c,camera:d}=e,p=u.shadowMap.type,f=a.depthTexture.version;this._depthVersionCached=f,h.camera.layers.mask=d.layers.mask;let m=u.getRenderObjectFunction(),g=u.getMRT(),A=!!g&&g.has("velocity");n=function(e,i={}){return i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.renderTarget=e.getRenderTarget(),i.activeCubeFace=e.getActiveCubeFace(),i.activeMipmapLevel=e.getActiveMipmapLevel(),i.renderObjectFunction=e.getRenderObjectFunction(),i.pixelRatio=e.getPixelRatio(),i.mrt=e.getMRT(),i.clearColor=e.getClearColor(i.clearColor||new eE.Ilk),i.clearAlpha=e.getClearAlpha(),i.autoClear=e.autoClear,i.scissorTest=e.getScissorTest(),i}(u,n=i=o),u.setMRT(null),u.setRenderObjectFunction(null),u.setClearColor(0,1),u.autoClear=!0,r=function(e,i={}){return i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial,i}(c,r=i=n),c.background=null,c.backgroundNode=null,c.overrideMaterial=null,o=i=r,c.overrideMaterial=dd(l),u.setRenderObjectFunction((e,i,n,r,s,a,...o)=>{(!0===e.castShadow||e.receiveShadow&&p===eE.dwk)&&(A&&(nl(e).useVelocity=!0),e.onBeforeShadow(u,e,d,h.camera,r,i.overrideMaterial,a),u.renderObject(e,i,n,r,s,a,...o),e.onAfterShadow(u,e,d,h.camera,r,i.overrideMaterial,a))}),u.setRenderTarget(a),this.renderShadow(e),u.setRenderObjectFunction(m),!0!==l.isPointLight&&p===eE.dwk&&this.vsmPass(u),s=o,u.toneMapping=s.toneMapping,u.toneMappingExposure=s.toneMappingExposure,u.outputColorSpace=s.outputColorSpace,u.setRenderTarget(s.renderTarget,s.activeCubeFace,s.activeMipmapLevel),u.setRenderObjectFunction(s.renderObjectFunction),u.setPixelRatio(s.pixelRatio),u.setMRT(s.mrt),u.setClearColor(s.clearColor,s.clearAlpha),u.autoClear=s.autoClear,u.setScissorTest(s.scissorTest),c.background=s.background,c.backgroundNode=s.backgroundNode,c.overrideMaterial=s.overrideMaterial}vsmPass(e){let{shadow:i}=this;this.vsmShadowMapVertical.setSize(i.mapSize.width,i.mapSize.height),this.vsmShadowMapHorizontal.setSize(i.mapSize.width,i.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),dx.material=this.vsmMaterialVertical,dx.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),dx.material=this.vsmMaterialHorizontal,dx.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){let{shadow:i}=this;(i.needsUpdate||i.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(i.needsUpdate=!1))}}let db=(e,i)=>n0(new d_(e,i));class dE extends lD{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new eE.Ilk,this.colorNode=e&&e.colorNode||rM(this.color).setGroup(rb),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=nu.FRAME}customCacheKey(){return nt(this.light.id,+!!this.light.castShadow)}getHash(){return this.light.uuid}setupShadowNode(){return db(this.light)}setupShadow(e){let{renderer:i}=e;if(!1===i.shadowMap.enabled)return;let n=this.shadowColorNode;if(null===n){let i;let r=this.light.shadow.shadowNode;i=void 0!==r?n0(r):this.setupShadowNode(e),this.shadowNode=i,this.shadowColorNode=n=this.colorNode.mul(i),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null)}update(){let{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}let dw=n5(e=>{let{lightDistance:i,cutoffDistance:n,decayExponent:r}=e,s=i.pow(r).max(.01).reciprocal();return n.greaterThan(0).select(s.mul(i.div(n).pow4().oneMinus().clamp().pow2()),s)}),dM=new eE.Ilk,dC=n5(([e,i])=>{let n=e.toVar(),r=sk(n),s=r8(1,sZ(r.x,sZ(r.y,r.z)));r.mulAssign(s),n.mulAssign(s.mul(i.mul(2).oneMinus()));let a=rr(n.xy).toVar(),o=i.mul(1.5).oneMinus();return n7(r.z.greaterThanEqual(o),()=>{n7(n.z.greaterThan(0),()=>{a.x.assign(r5(4,n.x))})}).ElseIf(r.x.greaterThanEqual(o),()=>{let e=sF(n.x);a.x.assign(n.z.mul(e).add(e.mul(2)))}).ElseIf(r.y.greaterThanEqual(o),()=>{let e=sF(n.y);a.x.assign(n.x.add(e.mul(2)).add(2)),a.y.assign(n.z.mul(e).sub(2))}),rr(.125,.25).mul(a).add(rr(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),dS=n5(({depthTexture:e,bd3D:i,dp:n,texelSize:r})=>aW(e,dC(i,r.y)).compare(n)),dT=n5(({depthTexture:e,bd3D:i,dp:n,texelSize:r,shadow:s})=>{let a=oS("radius","float",s).setGroup(rb),o=rr(-1,1).mul(a).mul(r.y);return aW(e,dC(i.add(o.xyy),r.y)).compare(n).add(aW(e,dC(i.add(o.yyy),r.y)).compare(n)).add(aW(e,dC(i.add(o.xyx),r.y)).compare(n)).add(aW(e,dC(i.add(o.yyx),r.y)).compare(n)).add(aW(e,dC(i,r.y)).compare(n)).add(aW(e,dC(i.add(o.xxy),r.y)).compare(n)).add(aW(e,dC(i.add(o.yxy),r.y)).compare(n)).add(aW(e,dC(i.add(o.xxx),r.y)).compare(n)).add(aW(e,dC(i.add(o.yxx),r.y)).compare(n)).mul(1/9)}),dR=n5(({filterFn:e,depthTexture:i,shadowCoord:n,shadow:r})=>{let s=n.xyz.toVar(),a=s.length(),o=rM("float").setGroup(rb).onRenderUpdate(()=>r.camera.near),l=rM("float").setGroup(rb).onRenderUpdate(()=>r.camera.far),h=oS("bias","float",r).setGroup(rb),u=rM(r.mapSize).setGroup(rb),c=re(1).toVar();return n7(a.sub(l).lessThanEqual(0).and(a.sub(o).greaterThanEqual(0)),()=>{let n=a.sub(o).div(l.sub(o)).toVar();n.addAssign(h);let d=s.normalize(),p=rr(1).div(u.mul(rr(4,2)));c.assign(e({depthTexture:i,bd3D:d,dp:n,texelSize:p,shadow:r}))}),c}),dI=new eE.Ltg,dB=new eE.FM8,dL=new eE.FM8;class dP extends d_{static get type(){return"PointShadowNode"}constructor(e,i=null){super(e,i)}getShadowFilterFn(e){return e===eE._MY?dS:dT}setupShadowCoord(e,i){return i}setupShadowFilter(e,{filterFn:i,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:a}){return dR({filterFn:i,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:a})}renderShadow(e){let{shadow:i,shadowMap:n,light:r}=this,{renderer:s,scene:a}=e,o=i.getFrameExtents();dL.copy(i.mapSize),dL.multiply(o),n.setSize(dL.width,dL.height),dB.copy(i.mapSize);let l=s.autoClear,h=s.getClearColor(dM),u=s.getClearAlpha();s.autoClear=!1,s.setClearColor(i.clearColor,i.clearAlpha),s.clear();let c=i.getViewportCount();for(let e=0;e<c;e++){let o=i.getViewport(e),l=dB.x*o.x,h=dL.y-dB.y-dB.y*o.y;dI.set(l,h,dB.x*o.z,dB.y*o.w),n.viewport.copy(dI),i.updateMatrices(r,e),s.render(a,i.camera)}s.autoClear=l,s.setClearColor(h,u)}}let dD=(e,i)=>n0(new dP(e,i)),dN=n5(({color:e,lightViewPosition:i,cutoffDistance:n,decayExponent:r},s)=>{let a=s.context.lightingModel,o=i.sub(ot),l=o.normalize(),h=dw({lightDistance:o.length(),cutoffDistance:n,decayExponent:r}),u=e.mul(h),c=s.context.reflectedLight;a.direct({lightDirection:l,lightColor:u,reflectedLight:c},s.stack,s)});class dO extends dE{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=rM(0).setGroup(rb),this.decayExponentNode=rM(2).setGroup(rb)}update(e){let{light:i}=this;super.update(e),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}setupShadowNode(){return dD(this.light)}setup(e){super.setup(e),dN({color:this.colorNode,lightViewPosition:de(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}let dU=n5(([e,i])=>{let n=e.x,r=e.y,s=e.z,a=i.element(0).mul(.886227);return(a=(a=(a=(a=(a=(a=(a=a.add(i.element(1).mul(1.023328).mul(r))).add(i.element(2).mul(1.023328).mul(s))).add(i.element(3).mul(1.023328).mul(n))).add(i.element(4).mul(.858086).mul(n).mul(r))).add(i.element(5).mul(.858086).mul(r).mul(s))).add(i.element(6).mul(s.mul(s).mul(.743125).sub(.247708)))).add(i.element(7).mul(.858086).mul(n).mul(s))).add(i.element(8).mul(.429043).mul(r6(n,n).sub(r6(r,r))))}),dk=new cE;class dF extends u7{constructor(e,i){super(),this.renderer=e,this.nodes=i}update(e,i,n){let r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background,a=!1;if(null===s)r._clearColor.getRGB(dk,eE.GUF),dk.a=r._clearColor.a;else if(!0===s.isColor)s.getRGB(dk,eE.GUF),dk.a=1,a=!0;else if(!0===s.isNode){let n=this.get(e);dk.copy(r._clearColor);let a=n.backgroundMesh;if(void 0===a){let e=ah(rd(s).mul(cU),{getUV:()=>ck.mul(ol),getTextureLevel:()=>cO}),i=lg;i=i.setZ(i.w);let r=new l9;r.name="Background.material",r.side=eE._Li,r.depthTest=!1,r.depthWrite=!1,r.fog=!1,r.lights=!1,r.vertexNode=i,r.colorNode=e,n.backgroundMeshNode=e,n.backgroundMesh=a=new eE.Kj0(new eE.xo$(1,32,32),r),a.frustumCulled=!1,a.name="Background.mesh",a.onBeforeRender=function(e,i,n){this.matrixWorld.copyPosition(n.matrixWorld)}}let o=s.getCacheKey();n.backgroundCacheKey!==o&&(n.backgroundMeshNode.node=rd(s).mul(cU),n.backgroundMeshNode.needsUpdate=!0,a.material.needsUpdate=!0,n.backgroundCacheKey=o),i.unshift(a,a.geometry,a.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);if(!0===r.autoClear||!0===a){let e=n.clearColorValue;e.r=dk.r,e.g=dk.g,e.b=dk.b,e.a=dk.a,(!0===r.backend.isWebGLBackend||!0===r.alpha)&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=!0===r.autoClearColor,n.clearDepth=!0===r.autoClearDepth,n.clearStencil=!0===r.autoClearStencil}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let dz=0;class dG{constructor(e="",i=[],n=0,r=[]){this.name=e,this.bindings=i,this.index=n,this.bindingsReference=r,this.id=dz++}}class dV{constructor(e,i,n,r,s,a,o,l,h,u=[]){this.vertexShader=e,this.fragmentShader=i,this.computeShader=n,this.transforms=u,this.nodeAttributes=r,this.bindings=s,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=l,this.monitor=h,this.usedTimes=0}createBindings(){let e=[];for(let i of this.bindings)if(!0!==i.bindings[0].groupNode.shared){let n=new dG(i.name,[],i.index,i);for(let r of(e.push(n),i.bindings))n.bindings.push(r.clone())}else e.push(i);return e}}class dj{constructor(e,i,n=null){this.isNodeAttribute=!0,this.name=e,this.type=i,this.node=n}}class dH{constructor(e,i,n){this.isNodeUniform=!0,this.name=e,this.type=i,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class dQ{constructor(e,i){this.isNodeVar=!0,this.name=e,this.type=i}}class dW extends dQ{constructor(e,i){super(e,i),this.needsInterpolation=!1,this.isNodeVarying=!0}}class dq{constructor(e,i,n=""){this.name=e,this.type=i,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let dX=0;class dK{constructor(e=null){this.id=dX++,this.nodesData=new WeakMap,this.parent=e}getData(e){let i=this.nodesData.get(e);return void 0===i&&null!==this.parent&&(i=this.parent.getData(e)),i}setData(e,i){this.nodesData.set(e,i)}}class dY extends ng{static get type(){return"StructTypeNode"}constructor(e,i){super(),this.name=e,this.types=i,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}class dJ{constructor(e,i){this.name=e,this.value=i,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class dZ extends dJ{constructor(e,i=0){super(e,i),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class d$ extends dJ{constructor(e,i=new eE.FM8){super(e,i),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class d0 extends dJ{constructor(e,i=new eE.Pa4){super(e,i),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class d1 extends dJ{constructor(e,i=new eE.Ltg){super(e,i),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class d2 extends dJ{constructor(e,i=new eE.Ilk){super(e,i),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class d3 extends dJ{constructor(e,i=new eE.Vkp){super(e,i),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class d4 extends dJ{constructor(e,i=new eE.yGw){super(e,i),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class d5 extends dZ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class d6 extends d${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class d8 extends d0{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class d7 extends d1{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class d9 extends d2{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class pe extends d3{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class pt extends d4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let pi=[.125,.215,.35,.446,.526,.582],pn=new eE.iKG(-1,1,1,-1,0,1),pr=new eE.cPb(90,1),ps=new eE.Ilk,pa=null,po=0,pl=0,ph=(1+Math.sqrt(5))/2,pu=1/ph,pc=[new eE.Pa4(-ph,pu,0),new eE.Pa4(ph,pu,0),new eE.Pa4(-pu,0,ph),new eE.Pa4(pu,0,ph),new eE.Pa4(0,ph,-pu),new eE.Pa4(0,ph,pu),new eE.Pa4(-1,1,-1),new eE.Pa4(1,1,-1),new eE.Pa4(-1,1,1),new eE.Pa4(1,1,1)],pd=[3,1,5,0,4,2],pp=uM(aV(),aG("faceIndex")).normalize(),pf=rl(pp.x,pp.y,pp.z);class pm{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,i=0,n=.1,r=100,s=null){if(this._setSize(256),!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");let a=s||this._allocateTargets();return this.fromSceneAsync(e,i,n,r,a),a}pa=this._renderer.getRenderTarget(),po=this._renderer.getActiveCubeFace(),pl=this._renderer.getActiveMipmapLevel();let a=s||this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,n,r,a),i>0&&this._blur(a,0,0,i),this._applyPMREM(a),this._cleanup(a),a}async fromSceneAsync(e,i=0,n=.1,r=100,s=null){return!1===this._hasInitialized&&await this._renderer.init(),this.fromScene(e,i,n,r,s)}fromEquirectangular(e,i=null){if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);let n=i||this._allocateTargets();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,i)}async fromEquirectangularAsync(e,i=null){return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,i)}fromCubemap(e,i=null){if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);let n=i||this._allocateTargets();return this.fromCubemapAsync(e,i),n}return this._fromTexture(e,i)}async fromCubemapAsync(e,i=null){return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,i)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=py(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=px(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===eE.fY$||e.mapping===eE.vxC?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(pa,po,pl),e.scissorTest=!1,pA(e,0,0,e.width,e.height)}_fromTexture(e,i){this._setSizeFromTexture(e),pa=this._renderer.getRenderTarget(),po=this._renderer.getActiveCubeFace(),pl=this._renderer.getActiveMipmapLevel();let n=i||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:eE.wem,minFilter:eE.wem,generateMipmaps:!1,type:eE.cLu,format:eE.wk1,colorSpace:eE.GUF},r=pg(e,i,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=pg(e,i,n);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=function(e){let i=[],n=[],r=[],s=[],a=e,o=e-4+1+pi.length;for(let l=0;l<o;l++){let o=Math.pow(2,a);n.push(o);let h=1/o;l>e-4?h=pi[l-e+4-1]:0===l&&(h=0),r.push(h);let u=1/(o-2),c=-u,d=1+u,p=[c,c,d,c,d,d,c,c,d,d,c,d],f=new Float32Array(108),m=new Float32Array(72),g=new Float32Array(36);for(let e=0;e<6;e++){let i=e%3*2/3-1,n=e>2?0:-1,r=[i,n,0,i+2/3,n,0,i+2/3,n+1,0,i,n,0,i+2/3,n+1,0,i,n+1,0],s=pd[e];f.set(r,18*s),m.set(p,12*s);let a=[s,s,s,s,s,s];g.set(a,6*s)}let A=new eE.u9r;A.setAttribute("position",new eE.TlE(f,3)),A.setAttribute("uv",new eE.TlE(m,2)),A.setAttribute("faceIndex",new eE.TlE(g,1)),i.push(A),s.push(new eE.Kj0(A,null)),a>4&&a--}return{lodPlanes:i,sizeLods:n,sigmas:r,lodMeshes:s}}(r)),this._blurMaterial=function(e,i,n){let r=ow(Array(20).fill(0)),s=rM(new eE.Pa4(0,1,0)),a=rM(0),o=re(20),l=rM(0),h=rM(1),u=aW(null),c=rM(0),d=re(1/i),p={n:o,latitudinal:l,weights:r,poleAxis:s,outputDirection:pf,dTheta:a,samples:h,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:re(1/n),CUBEUV_MAX_MIP:re(e)},f=pv("blur");return f.uniforms=p,f.fragmentNode=uR({...p,latitudinal:l.equal(1)}),f}(r,e,i)}return r}async _compileMaterial(e){let i=new eE.Kj0(this._lodPlanes[0],e);await this._renderer.compile(i,pn)}_sceneToCubeUV(e,i,n,r){pr.near=i,pr.far=n;let s=[1,1,1,1,-1,1],a=[1,-1,1,-1,1,-1],o=this._renderer,l=o.autoClear;o.getClearColor(ps),o.autoClear=!1;let h=this._backgroundBox;if(null===h){let e=new eE.vBJ({name:"PMREM.Background",side:eE._Li,depthWrite:!1,depthTest:!1});h=new eE.Kj0(new eE.DvJ,e)}let u=!1,c=e.background;c?c.isColor&&(h.material.color.copy(c),e.background=null,u=!0):(h.material.color.copy(ps),u=!0),o.setRenderTarget(r),o.clear(),u&&o.render(h,pr);for(let i=0;i<6;i++){let n=i%3;0===n?(pr.up.set(0,s[i],0),pr.lookAt(a[i],0,0)):1===n?(pr.up.set(0,0,s[i]),pr.lookAt(0,a[i],0)):(pr.up.set(0,s[i],0),pr.lookAt(0,0,a[i]));let l=this._cubeSize;pA(r,n*l,i>2?l:0,l,l),o.render(e,pr)}o.autoClear=l,e.background=c}_textureToCubeUV(e,i){let n=this._renderer,r=e.mapping===eE.fY$||e.mapping===eE.vxC;r?null===this._cubemapMaterial&&(this._cubemapMaterial=py(e)):null===this._equirectMaterial&&(this._equirectMaterial=px(e));let s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;let a=this._lodMeshes[0];a.material=s;let o=this._cubeSize;pA(i,0,0,3*o,2*o),n.setRenderTarget(i),n.render(a,pn)}_applyPMREM(e){let i=this._renderer,n=i.autoClear;i.autoClear=!1;let r=this._lodPlanes.length;for(let i=1;i<r;i++){let n=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),s=pc[(r-i-1)%pc.length];this._blur(e,i-1,i,n,s)}i.autoClear=n}_blur(e,i,n,r,s){let a=this._pingPongRenderTarget;this._halfBlur(e,a,i,n,r,"latitudinal",s),this._halfBlur(a,e,n,n,r,"longitudinal",s)}_halfBlur(e,i,n,r,s,a,o){let l=this._renderer,h=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let u=this._lodMeshes[r];u.material=h;let c=h.uniforms,d=this._sizeLods[n]-1,p=isFinite(s)?Math.PI/(2*d):2*Math.PI/39,f=s/p,m=isFinite(s)?1+Math.floor(3*f):20;m>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);let g=[],A=0;for(let e=0;e<20;++e){let i=e/f,n=Math.exp(-i*i/2);g.push(n),0===e?A+=n:e<m&&(A+=2*n)}for(let e=0;e<g.length;e++)g[e]=g[e]/A;e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.samples.value=m,c.weights.array=g,c.latitudinal.value=+("latitudinal"===a),o&&(c.poleAxis.value=o);let{_lodMax:v}=this;c.dTheta.value=p,c.mipInt.value=v-n;let y=this._sizeLods[r],x=4*(this._cubeSize-y);pA(i,3*y*(r>v-4?r-v+4:0),x,3*y,2*y),l.setRenderTarget(i),l.render(u,pn)}}function pg(e,i,n){let r=new eE.ACn(e,i,n);return r.texture.mapping=eE.g8_,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function pA(e,i,n,r,s){e.viewport.set(i,n,r,s),e.scissor.set(i,n,r,s)}function pv(e){let i=new l9;return i.depthTest=!1,i.depthWrite=!1,i.blending=eE.jFi,i.name=`PMREM_${e}`,i}function py(e){let i=pv("cubemap");return i.fragmentNode=oy(e,pf),i}function px(e){let i=pv("equirect");return i.fragmentNode=aW(e,ho(pf),0),i}let p_=new WeakMap,pb=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),pE=e=>/e/g.test(e)?String(e).replace(/\+/g,""):(e=Number(e))+(e%1?"":".0");class pw{constructor(e,i,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=i,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=cM(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new dK,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=p_.get(this.renderer);return void 0===e&&(e=new u3,p_.set(this.renderer,e)),e}createRenderTarget(e,i,n){return new eE.ACn(e,i,n)}createCubeRenderTarget(e,i){return new hl(e,i)}createPMREMGenerator(){return new pm(this.renderer)}includes(e){return this.nodes.includes(e)}_getBindGroup(e,i){let n;let r=this.getBindGroupsCache(),s=[],a=!0;for(let e of i)s.push(e),a=a&&!0!==e.groupNode.shared;return a?void 0===(n=r.get(s))&&(n=new dG(e,s,this.bindingsIndexes[e].group,s),r.set(s,n)):n=new dG(e,s,this.bindingsIndexes[e].group,s),n}getBindGroupArray(e,i){let n=this.bindings[i],r=n[e];return void 0===r&&(void 0===this.bindingsIndexes[e]&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(null===e){let i={},n=this.bindings;for(let e of np)for(let r in n[e]){let s=n[e][r];(i[r]||(i[r]=[])).push(...s)}for(let n in e=[],i){let r=i[n],s=this._getBindGroup(n,r);e.push(s)}this.bindGroups=e}return e}sortBindingGroups(){let e=this.getBindings();e.sort((e,i)=>e.bindings[0].groupNode.order-i.bindings[0].groupNode.order);for(let i=0;i<e.length;i++){let n=e[i];this.bindingsIndexes[n.name].group=i,n.index=i}}setHashNode(e,i){this.hashNodes[i]=e}addNode(e){!1===this.nodes.includes(e)&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){!1===this.sequentialNodes.includes(e)&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(let e of this.nodes)e.getUpdateType()!==nu.NONE&&this.updateNodes.push(e.getSelf());for(let e of this.sequentialNodes){let i=e.getUpdateBeforeType(),n=e.getUpdateAfterType();i!==nu.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==nu.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===eE.wem||e.magFilter===eE.qyh||e.magFilter===eE.aH4||e.magFilter===eE.D1R||e.minFilter===eE.wem||e.minFilter===eE.qyh||e.minFilter===eE.aH4||e.minFilter===eE.D1R}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,i){return this.flowNodes[e].push(i),i}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return this.context,this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,i=!0){let n=this.getDataFromNode(e);return void 0===n.cache&&(n.cache=new dK(i?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){let i=this.getDataFromNode(e);return i.usageCount=void 0===i.usageCount?1:i.usageCount+1,i.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,i=null){if(null===i&&("float"===e||"int"===e||"uint"===e?i=0:"bool"===e?i=!1:"color"===e?i=new eE.Ilk:"vec2"===e?i=new eE.FM8:"vec3"===e?i=new eE.Pa4:"vec4"===e&&(i=new eE.Ltg)),"float"===e)return pE(i);if("int"===e)return`${Math.round(i)}`;if("uint"===e)return i>=0?`${Math.round(i)}u`:"0u";if("bool"===e)return i?"true":"false";if("color"===e)return`${this.getType("vec3")}( ${pE(i.r)}, ${pE(i.g)}, ${pE(i.b)} )`;let n=this.getTypeLength(e),r=this.getComponentType(e),s=e=>this.generateConst(r,e);if(2===n)return`${this.getType(e)}( ${s(i.x)}, ${s(i.y)} )`;if(3===n)return`${this.getType(e)}( ${s(i.x)}, ${s(i.y)}, ${s(i.z)} )`;if(4===n)return`${this.getType(e)}( ${s(i.x)}, ${s(i.y)}, ${s(i.z)}, ${s(i.w)} )`;if(n>4&&i&&(i.isMatrix3||i.isMatrix4))return`${this.getType(e)}( ${i.elements.map(s).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return"color"===e?"vec3":e}hasGeometryAttribute(e){return this.geometry&&void 0!==this.geometry.getAttribute(e)}getAttribute(e,i){let n=this.attributes;for(let i of n)if(i.name===e)return i;let r=new dj(e,i);return n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return"void"===e||"property"===e||"sampler"===e||"texture"===e||"cubeTexture"===e||"storageTexture"===e||"depthTexture"===e||"texture3D"===e}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){let i=e.type;if(e.isDataTexture){if(i===eE.Kz5)return"int";if(i===eE.JQ4)return"uint"}return"float"}getElementType(e){return"mat2"===e?"vec2":"mat3"===e?"vec3":"mat4"===e?"vec4":this.getComponentType(e)}getComponentType(e){if("float"===(e=this.getVectorType(e))||"bool"===e||"int"===e||"uint"===e)return e;let i=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return null===i?null:"b"===i[1]?"bool":"i"===i[1]?"int":"u"===i[1]?"uint":"float"}getVectorType(e){return"color"===e?"vec3":"texture"===e||"cubeTexture"===e||"storageTexture"===e||"texture3D"===e?"vec4":e}getTypeFromLength(e,i="float"){if(1===e)return i;let n=nr.get(e);return("float"===i?"":i[0])+n}getTypeFromArray(e){return pb.get(e.constructor)}getTypeFromAttribute(e){let i,n=e;e.isInterleavedBufferAttribute&&(n=e.data);let r=n.array,s=e.itemSize,a=e.normalized;return e instanceof eE.e62||!0===a||(i=this.getTypeFromArray(r)),this.getTypeFromLength(s,i)}getTypeLength(e){let i=this.getVectorType(e),n=/vec([2-4])/.exec(i);return null!==n?Number(n[1]):"float"===i||"bool"===i||"int"===i||"uint"===i?1:!0===/mat2/.test(e)?4:!0===/mat3/.test(e)?9:16*(!0===/mat4/.test(e))}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,i){return this.getTypeFromLength(this.getTypeLength(e),i)}getIntegerType(e){let i=this.getComponentType(e);return"int"===i||"uint"===i?e:this.changeComponentType(e,"int")}addStack(){return this.stack=cM(this.stack),this.stacks.push(n8()||this.stack),n6(this.stack),this.stack}removeStack(){let e=this.stack;return this.stack=e.parent,n6(this.stacks.pop()),e}getDataFromNode(e,i=this.shaderStage,n=null){let r=(n=null===n?e.isGlobal(this)?this.globalCache:this.cache:n).getData(e);return void 0===r&&(r={},n.setData(e,r)),void 0===r[i]&&(r[i]={}),r[i]}getNodeProperties(e,i="any"){let n=this.getDataFromNode(e,i);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,i){let n=this.getDataFromNode(e),r=n.bufferAttribute;return void 0===r&&(r=new dj("nodeAttribute"+this.uniforms.index++,i,e),this.bufferAttributes.push(r),n.bufferAttribute=r),r}getStructTypeFromNode(e,i,n=this.shaderStage){let r=this.getDataFromNode(e,n),s=r.structType;return void 0===s&&(s=new dY("StructType"+this.structs.index++,i),this.structs[n].push(s),r.structType=s),s}getUniformFromNode(e,i,n=this.shaderStage,r=null){let s=this.getDataFromNode(e,n,this.globalCache),a=s.uniform;if(void 0===a){let o=this.uniforms.index++;a=new dH(r||"nodeUniform"+o,i,e),this.uniforms[n].push(a),s.uniform=a}return a}getVarFromNode(e,i=null,n=e.getNodeType(this),r=this.shaderStage){let s=this.getDataFromNode(e,r),a=s.variable;if(void 0===a){let e=this.vars[r]||(this.vars[r]=[]);null===i&&(i="nodeVar"+e.length),a=new dQ(i,n),e.push(a),s.variable=a}return a}getVaryingFromNode(e,i=null,n=e.getNodeType(this)){let r=this.getDataFromNode(e,"any"),s=r.varying;if(void 0===s){let e=this.varyings,a=e.length;null===i&&(i="nodeVarying"+a),s=new dW(i,n),e.push(s),r.varying=s}return s}getCodeFromNode(e,i,n=this.shaderStage){let r=this.getDataFromNode(e),s=r.code;if(void 0===s){let e=this.codes[n]||(this.codes[n]=[]);s=new dq("nodeCode"+e.length,i),e.push(s),r.code=s}return s}addFlowCodeHierarchy(e,i){let{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e),s=!0,a=i;for(;a;){if(!0===r.get(a)){s=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(s)for(let e of n)this.addLineFlowCode(e)}addLineFlowCodeBlock(e,i,n){let r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),a=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(i),a.set(n,!0)}addLineFlowCode(e,i=null){return""===e||(null!==i&&this.context.nodeBlock&&this.addLineFlowCodeBlock(i,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e+=";\n"),this.flow.code+=e),this}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){let i=e.getNodeType(this),n=this.flowChildNode(e,i);return this.flowsData.set(e,n),n}buildFunctionNode(e){let i=new c0,n=this.currentFunctionNode;return this.currentFunctionNode=i,i.code=this.buildFunctionCode(e),this.currentFunctionNode=n,i}flowShaderNode(e){let i=e.layout,n={[Symbol.iterator](){let e=0,i=Object.values(this);return{next:()=>({value:i[e],done:e++>=i.length})}}};for(let e of i.inputs)n[e.name]=new cw(e.type,e.name);e.layout=null;let r=e.call(n),s=this.flowStagesNode(r,i.type);return e.layout=i,s}flowStagesNode(e,i=null){let n=this.flow,r=this.vars,s=this.cache,a=this.buildStage,o=this.stack,l={code:""};for(let n of(this.flow=l,this.vars={},this.cache=new dK,this.stack=cM(),nd))this.setBuildStage(n),l.result=e.build(this,i);return l.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.cache=s,this.stack=o,this.setBuildStage(a),l}getFunctionOperator(){return null}flowChildNode(e,i=null){let n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,i),this.flow=n,r}flowNodeFromShaderStage(e,i,n=null,r=null){let s=this.shaderStage;this.setShaderStage(e);let a=this.flowChildNode(i,n);return null!==r&&(a.code+=`${this.tab+r} = ${a.result};
`),this.flowCode[e]=this.flowCode[e]+a.code,this.setShaderStage(s),a}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,i){return`${this.getType(e)} ${i}`}getVars(e){let i="",n=this.vars[e];if(void 0!==n)for(let e of n)i+=`${this.getVar(e.type,e.name)}; `;return i}getUniforms(){console.warn("Abstract function.")}getCodes(e){let i=this.codes[e],n="";if(void 0!==i)for(let e of i)n+=e.code+"\n";return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){let{object:e,material:i,renderer:n}=this;if(null!==i){let e=n.library.fromMaterial(i);null===e&&(console.error(`NodeMaterial: Material "${i.type}" is not compatible.`),e=new l9),e.build(this)}else this.addFlow("compute",e);for(let e of nd)for(let i of(this.setBuildStage(e),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex),np))for(let n of(this.setShaderStage(i),this.flowNodes[i]))"generate"===e?this.flowNode(n):n.build(this);return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,i){if("float"===i||"int"===i||"uint"===i)return new d5(e);if("vec2"===i||"ivec2"===i||"uvec2"===i)return new d6(e);if("vec3"===i||"ivec3"===i||"uvec3"===i)return new d8(e);if("vec4"===i||"ivec4"===i||"uvec4"===i)return new d7(e);if("color"===i)return new d9(e);if("mat3"===i)return new pe(e);if("mat4"===i)return new pt(e);throw Error(`Uniform "${i}" not declared.`)}format(e,i,n){if(i=this.getVectorType(i),n=this.getVectorType(n),i===n||null===n||this.isReference(n))return e;let r=this.getTypeLength(i),s=this.getTypeLength(n);return 16===r&&9===s?`${this.getType(n)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:9===r&&4===s?`${this.getType(n)}(${e}[0].xy, ${e}[1].xy)`:r>4||s>4||0===s?e:r===s?`${this.getType(n)}( ${e} )`:r>s?this.format(`${e}.${"xyz".slice(0,s)}`,this.getTypeFromLength(s,this.getComponentType(i)),n):4===s&&r>1?`${this.getType(n)}( ${this.format(e,i,"vec3")}, 1.0 )`:2===r?`${this.getType(n)}( ${this.format(e,i,"vec2")}, 0.0 )`:(1===r&&s>1&&i!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${eE.UZH} - Node System
`}createNodeMaterial(e="NodeMaterial"){throw Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class pM{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,i){let n=e.get(i);return void 0===n&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(i,n)),n}updateBeforeNode(e){let i=e.getUpdateBeforeType(),n=e.updateReference(this);if(i===nu.FRAME){let{frameMap:i}=this._getMaps(this.updateBeforeMap,n);i.get(n)!==this.frameId&&!1!==e.updateBefore(this)&&i.set(n,this.frameId)}else if(i===nu.RENDER){let{renderMap:i}=this._getMaps(this.updateBeforeMap,n);i.get(n)!==this.renderId&&!1!==e.updateBefore(this)&&i.set(n,this.renderId)}else i===nu.OBJECT&&e.updateBefore(this)}updateAfterNode(e){let i=e.getUpdateAfterType(),n=e.updateReference(this);if(i===nu.FRAME){let{frameMap:i}=this._getMaps(this.updateAfterMap,n);i.get(n)!==this.frameId&&!1!==e.updateAfter(this)&&i.set(n,this.frameId)}else if(i===nu.RENDER){let{renderMap:i}=this._getMaps(this.updateAfterMap,n);i.get(n)!==this.renderId&&!1!==e.updateAfter(this)&&i.set(n,this.renderId)}else i===nu.OBJECT&&e.updateAfter(this)}updateNode(e){let i=e.getUpdateType(),n=e.updateReference(this);if(i===nu.FRAME){let{frameMap:i}=this._getMaps(this.updateMap,n);i.get(n)!==this.frameId&&!1!==e.update(this)&&i.set(n,this.frameId)}else if(i===nu.RENDER){let{renderMap:i}=this._getMaps(this.updateMap,n);i.get(n)!==this.renderId&&!1!==e.update(this)&&i.set(n,this.renderId)}else i===nu.OBJECT&&e.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class pC{constructor(e,i,n=null,r="",s=!1){this.type=e,this.name=i,this.count=n,this.qualifier=r,this.isConst=s}}pC.isNodeFunctionInput=!0;class pS extends dE{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setup(e){super.setup(e);let i=e.context.lightingModel,n=this.colorNode,r=dt(this.light),s=e.context.reflectedLight;i.direct({lightDirection:r,lightColor:n,reflectedLight:s},e.stack,e)}}let pT=new eE.yGw,pR=new eE.yGw,pI=null;class pB extends dE{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=rM(new eE.Pa4).setGroup(rb),this.halfWidth=rM(new eE.Pa4).setGroup(rb),this.updateType=nu.RENDER}update(e){super.update(e);let{light:i}=this,n=e.camera.matrixWorldInverse;pR.identity(),pT.copy(i.matrixWorld),pT.premultiply(n),pR.extractRotation(pT),this.halfWidth.value.set(.5*i.width,0,0),this.halfHeight.value.set(0,.5*i.height,0),this.halfWidth.value.applyMatrix4(pR),this.halfHeight.value.applyMatrix4(pR)}setup(e){let i,n;super.setup(e),e.isAvailable("float32Filterable")?(i=aW(pI.LTC_FLOAT_1),n=aW(pI.LTC_FLOAT_2)):(i=aW(pI.LTC_HALF_1),n=aW(pI.LTC_HALF_2));let{colorNode:r,light:s}=this,a=e.context.lightingModel,o=de(s),l=e.context.reflectedLight;a.directRectArea({lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:l,ltc_1:i,ltc_2:n},e.stack,e)}static setLTC(e){pI=e}}class pL extends dE{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=rM(0).setGroup(rb),this.penumbraCosNode=rM(0).setGroup(rb),this.cutoffDistanceNode=rM(0).setGroup(rb),this.decayExponentNode=rM(0).setGroup(rb)}update(e){super.update(e);let{light:i}=this;this.coneCosNode.value=Math.cos(i.angle),this.penumbraCosNode.value=Math.cos(i.angle*(1-i.penumbra)),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}getSpotAttenuation(e){let{coneCosNode:i,penumbraCosNode:n}=this;return ar(i,n,e)}setup(e){super.setup(e);let i=e.context.lightingModel,{colorNode:n,cutoffDistanceNode:r,decayExponentNode:s,light:a}=this,o=de(a).sub(ot),l=o.normalize(),h=l.dot(dt(a)),u=this.getSpotAttenuation(h),c=dw({lightDistance:o.length(),cutoffDistance:r,decayExponent:s}),d=n.mul(u).mul(c);if(a.map){let e=function(e){let i=c8(e);if(void 0===i.projectionUV){let n=c7(e).mul(a9);i.projectionUV=n.xyz.div(n.w)}return i.projectionUV}(a),i=aW(a.map,e.xy).onRenderUpdate(()=>a.map);d=e.mul(2).sub(1).abs().lessThan(1).all().select(d.mul(i),d)}let p=e.context.reflectedLight;i.direct({lightDirection:l,lightColor:d,reflectedLight:p},e.stack,e)}}class pP extends pL{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){let i=this.light.iesMap,n=null;return i&&!0===i.isTexture?aW(i,rr(e.acos().mul(1/Math.PI),0),0).r:super.getSpotAttenuation(e)}}class pD extends dE{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class pN extends dE{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=c9(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=rM(new eE.Ilk).setGroup(rb)}update(e){let{light:i}=this;super.update(e),this.lightPositionNode.object3d=i,this.groundColorNode.value.copy(i.groundColor).multiplyScalar(i.intensity)}setup(e){let{colorNode:i,groundColorNode:n,lightDirectionNode:r}=this,s=at(n,i,oo.dot(r).mul(.5).add(.5));e.context.irradiance.addAssign(s)}}class pO extends dE{static get type(){return"LightProbeNode"}constructor(e=null){super(e);let i=[];for(let e=0;e<9;e++)i.push(new eE.Pa4);this.lightProbe=ow(i)}update(e){let{light:i}=this;super.update(e);for(let e=0;e<9;e++)this.lightProbe.array[e].copy(i.sh.coefficients[e]).multiplyScalar(i.intensity)}setup(e){let i=dU(ol,this.lightProbe);e.context.irradiance.addAssign(i)}}class pU{parseFunction(){console.warn("Abstract function.")}}class pk{constructor(e,i,n="",r=""){this.type=e,this.inputs=i,this.name=n,this.precision=r}getCode(){console.warn("Abstract function.")}}pk.isNodeFunction=!0;let pF=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,pz=/[a-z_0-9]+/ig,pG="#pragma main",pV=e=>{let i=(e=e.trim()).indexOf(pG),n=-1!==i?e.slice(i+pG.length):e,r=n.match(pF);if(null!==r&&5===r.length){let s=r[4],a=[],o=null;for(;null!==(o=pz.exec(s));)a.push(o);let l=[],h=0;for(;h<a.length;){let e="const"===a[h][0];!0===e&&h++;let i=a[h][0];"in"===i||"out"===i||"inout"===i?h++:i="";let n=a[h++][0],r=Number.parseInt(a[h][0]);!1===Number.isNaN(r)?h++:r=null;let s=a[h++][0];l.push(new pC(n,s,r,i,e))}let u=n.substring(r[0].length),c=void 0!==r[3]?r[3]:"",d=r[2];return{type:d,inputs:l,name:c,precision:void 0!==r[1]?r[1]:"",inputsCode:s,blockCode:u,headerCode:-1!==i?e.slice(0,i):""}}throw Error("FunctionNode: Function is not a GLSL code.")};class pj extends pk{constructor(e){let{type:i,inputs:n,name:r,precision:s,inputsCode:a,blockCode:o,headerCode:l}=pV(e);super(i,n,r,s),this.inputsCode=a,this.blockCode=o,this.headerCode=l}getCode(e=this.name){let i;let n=this.blockCode;if(""!==n){let{type:r,inputsCode:s,headerCode:a,precision:o}=this,l=`${r} ${e} ( ${s.trim()} )`;""!==o&&(l=`${o} ${l}`),i=a+l+n}else i="";return i}}class pH extends pU{parseFunction(e){return new pj(e)}}let pQ=new WeakMap;class pW extends u7{constructor(e,i){super(),this.renderer=e,this.backend=i,this.nodeFrame=new pM,this.nodeBuilderCache=new Map,this.callHashCache=new u3,this.groupsData=new u3,this.cacheLib={}}updateGroup(e){let i=e.groupNode,n=i.name;if(n===rE.name)return!0;if(n===rb.name){let i=this.get(e),n=this.nodeFrame.renderId;return i.renderId!==n&&(i.renderId=n,!0)}if(n===r_.name){let i=this.get(e),n=this.nodeFrame.frameId;return i.frameId!==n&&(i.frameId=n,!0)}let r=[i,e],s=this.groupsData.get(r);return void 0===s&&this.groupsData.set(r,s={}),s.version!==i.version&&(s.version=i.version,!0)}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){let i=this.get(e),n=i.nodeBuilderState;if(void 0===n){let{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(void 0===(n=r.get(s))){let i=this.backend.createNodeBuilder(e.object,this.renderer);i.scene=e.scene,i.material=e.material,i.camera=e.camera,i.context.material=e.material,i.lightsNode=e.lightsNode,i.environmentNode=this.getEnvironmentNode(e.scene),i.fogNode=this.getFogNode(e.scene),i.clippingContext=e.clippingContext,i.build(),n=this._createNodeBuilderState(i),r.set(s,n)}n.usedTimes++,i.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){let i=this.get(e).nodeBuilderState;i.usedTimes--,0===i.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){let i=this.get(e),n=i.nodeBuilderState;if(void 0===n){let r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),i.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new dV(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.monitor,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let i=null;if(e.environmentNode&&e.environmentNode.isNode)i=e.environmentNode;else{let n=this.get(e);n.environmentNode&&(i=n.environmentNode)}return i}getBackgroundNode(e){this.updateBackground(e);let i=null;if(e.backgroundNode&&e.backgroundNode.isNode)i=e.backgroundNode;else{let n=this.get(e);n.backgroundNode&&(i=n.backgroundNode)}return i}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,i){let n=[e,i],r=this.renderer.info.calls,s=this.callHashCache.get(n);if(void 0===s||s.callId!==r){let a=this.getEnvironmentNode(e),o=this.getFogNode(e),l=[];i&&l.push(i.getCacheKey(!0)),a&&l.push(a.getCacheKey()),o&&l.push(o.getCacheKey()),l.push(+!!this.renderer.shadowMap.enabled),s={callId:r,cacheKey:ne(l)},this.callHashCache.set(n,s)}return s.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){let i=this.get(e),n=e.background;if(n){let r=0===e.backgroundBlurriness&&i.backgroundBlurriness>0||e.backgroundBlurriness>0&&0===i.backgroundBlurriness;if(i.background!==n||r){let s=this.getCacheNode("background",n,()=>{if(!0===n.isCubeTexture||n.mapping===eE.dSO||n.mapping===eE.Bf4||n.mapping===eE.g8_){if(e.backgroundBlurriness>0||n.mapping===eE.g8_)return uL(n);{let e;return hd(!0===n.isCubeTexture?oy(n):aW(n))}}if(!0===n.isTexture)return aW(n,lF.flipY()).setUpdateMatrix(!0);!0!==n.isColor&&console.error("WebGPUNodes: Unsupported background configuration.",n)},r);i.backgroundNode=s,i.background=n,i.backgroundBlurriness=e.backgroundBlurriness}}else i.backgroundNode&&(delete i.backgroundNode,delete i.background)}getCacheNode(e,i,n,r=!1){let s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap),a=s.get(i);return(void 0===a||r)&&(a=n(),s.set(i,a)),a}updateFog(e){let i=this.get(e),n=e.fog;if(n){if(i.fog!==n){let e=this.getCacheNode("fog",n,()=>{if(n.isFogExp2)return c5(oS("color","color",n).setGroup(rb),c4(oS("density","float",n).setGroup(rb)));if(n.isFog){let e=oS("color","color",n).setGroup(rb);return c5(e,c3(oS("near","float",n).setGroup(rb),oS("far","float",n).setGroup(rb)))}console.error("THREE.Renderer: Unsupported fog configuration.",n)});i.fogNode=e,i.fog=n}}else delete i.fogNode,delete i.fog}updateEnvironment(e){let i=this.get(e),n=e.environment;if(n){if(i.environment!==n){let e=this.getCacheNode("environment",n,()=>!0===n.isCubeTexture?oy(n):!0===n.isTexture?aW(n):void console.error("Nodes: Unsupported environment configuration.",n));i.environmentNode=e,i.environment=n}}else i.environmentNode&&(delete i.environmentNode,delete i.environment)}getNodeFrame(e=this.renderer,i=null,n=null,r=null,s=null){let a=this.nodeFrame;return a.renderer=e,a.scene=i,a.object=n,a.camera=r,a.material=s,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){let e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return pQ.get(e)!==this.getOutputCacheKey()}getOutputNode(e){let i=this.renderer,n=this.getOutputCacheKey(),r=aW(e,lF).renderOutput(i.toneMapping,i.currentColorSpace);return pQ.set(e,n),r}updateBefore(e){for(let i of e.getNodeBuilderState().updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(i)}updateAfter(e){for(let i of e.getNodeBuilderState().updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(i)}updateForCompute(e){let i=this.getNodeFrame();for(let n of this.getForCompute(e).updateNodes)i.updateNode(n)}updateForRender(e){let i=this.getNodeFrameForRender(e);for(let n of e.getNodeBuilderState().updateNodes)i.updateNode(n)}needsRefresh(e){let i=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,i)}dispose(){super.dispose(),this.nodeFrame=new pM,this.nodeBuilderCache=new Map,this.cacheLib={}}}let pq=new eE.JOQ;class pX{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new eE.Vkp,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,null!==e&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,i,n){let r=e.length;for(let s=0;s<r;s++){pq.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);let r=i[n+s],a=pq.normal;r.x=-a.x,r.y=-a.y,r.z=-a.z,r.w=pq.constant}}updateGlobal(e,i){this.shadowPass=null!==e.overrideMaterial&&e.overrideMaterial.isShadowNodeMaterial,this.viewMatrix=i.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,i){let n,r,s=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==i.clipIntersection&&(this.clipIntersection=i.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);let a=i.clippingPlanes,o=a.length;if(this.clipIntersection?(n=this.intersectionPlanes,r=e.intersectionPlanes.length):(n=this.unionPlanes,r=e.unionPlanes.length),n.length!==r+o){n.length=r+o;for(let e=0;e<o;e++)n[r+e]=new eE.Ltg;s=!0}this.projectPlanes(a,n,r),s&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let i=this.clippingGroupContexts.get(e);return void 0===i&&(i=new pX(this),this.clippingGroupContexts.set(e,i)),i.update(this,e),i}get unionClippingCount(){return this.unionPlanes.length}}class pK{constructor(e,i){this.bundleGroup=e,this.camera=i}}class pY{constructor(){this.bundles=new u3}get(e,i){let n=this.bundles,r=[e,i],s=n.get(r);return void 0===s&&(s=new pK(e,i),n.set(r,s)),s}dispose(){this.bundles=new u3}}class pJ{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let i=null,n=this.getMaterialNodeClass(e.type);if(null!==n)for(let r in i=new n,e)i[r]=e[r];return i}addToneMapping(e,i){this.addType(e,i,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,i){this.addType(e,i,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,i){this.addClass(e,i,this.lightNodes)}addType(e,i,n){if(n.has(i)){console.warn(`Redefinition of node ${i}`);return}if("function"!=typeof e)throw Error(`Node class ${e.name} is not a class.`);if("function"==typeof i||"object"==typeof i)throw Error(`Base class ${i} is not a class.`);n.set(i,e)}addClass(e,i,n){if(n.has(i)){console.warn(`Redefinition of node ${i.name}`);return}if("function"!=typeof e)throw Error(`Node class ${e.name} is not a class.`);if("function"!=typeof i)throw Error(`Base class ${i.name} is not a class.`);n.set(i,e)}}let pZ=new ds;class p$ extends u3{constructor(){super()}createNode(e=[]){return new ds().setLights(e)}getNode(e,i){if(e.isQuadMesh)return pZ;let n=[e,i],r=this.get(n);return void 0===r&&(r=this.createNode(),this.set(n,r)),r}}let p0=new eE.xsS,p1=new eE.FM8,p2=new eE.Ltg,p3=new eE.iWj,p4=new eE.yGw,p5=new eE.Ltg;class p6{constructor(e,i={}){this.isRenderer=!0;let{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:s=!0,stencil:a=!1,antialias:o=!1,samples:l=0,getFallback:h=null}=i;this.domElement=e.getDomElement(),this.backend=e,this.samples=l||!0===o?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=eE.KI_,this.toneMapping=eE.uL9,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=a,this.info=new cr,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new pJ,this.lighting=new p$,this._getFallback=h,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new eE.Ltg(0,0,this._width,this._height),this._scissor=new eE.Ltg(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new cL(new l9),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;let u=+(!0!==this.alpha);this._clearColor=new cE(0,0,0,u),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:eE._iA},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(e,i,n)=>{await this.compileAsync(e,i);let r=this._renderLists.get(e,i),s=this._renderContexts.get(e,i,this._renderTarget),a=e.overrideMaterial||n.material,{fragmentShader:o,vertexShader:l}=this._objects.get(n,a,e,i,r.lightsNode,s,s.clippingContext).getNodeBuilderState();return{fragmentShader:o,vertexShader:l}}}}async init(){if(this._initialized)throw Error("Renderer: Backend has already been initialized.");return null!==this._initPromise||(this._initPromise=new Promise(async(e,i)=>{let n=this.backend;try{await n.init(this)}catch(e){if(null!==this._getFallback)try{this.backend=n=this._getFallback(e),await n.init(this)}catch(e){i(e);return}else{i(e);return}}this._nodes=new pW(this,n),this._animation=new u2(this._nodes,this.info),this._attributes=new ce(n),this._background=new dF(this,this._nodes),this._geometries=new cn(this._attributes,this.info),this._textures=new cb(this,n,this.info),this._pipelines=new cu(n,this._nodes),this._bindings=new cc(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new u8(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new cg(this.lighting),this._bundles=new pY,this._renderContexts=new cx,this._animation.start(),this._initialized=!0,e()})),this._initPromise}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,i,n=null){if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();let r=this._nodes.nodeFrame,s=r.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,l=this._compilationPromises,h=!0===e.isScene?e:p0;null===n&&(n=e);let u=this._renderTarget,c=this._renderContexts.get(n,i,u),d=this._activeMipmapLevel,p=[];this._currentRenderContext=c,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=p,r.renderId++,r.update(),c.depth=this.depth,c.stencil=this.stencil,c.clippingContext||(c.clippingContext=new pX),c.clippingContext.updateGlobal(h,i),h.onBeforeRender(this,e,i,u);let f=this._renderLists.get(e,i);if(f.begin(),this._projectObject(e,i,0,f,c.clippingContext),n!==e&&n.traverseVisible(function(e){e.isLight&&e.layers.test(i.layers)&&f.pushLight(e)}),f.finish(),null!==u){this._textures.updateRenderTarget(u,d);let e=this._textures.get(u);c.textures=e.textures,c.depthTexture=e.depthTexture}else c.textures=null,c.depthTexture=null;this._background.update(h,f,c);let m=f.opaque,g=f.transparent,A=f.transparentDoublePass,v=f.lightsNode;!0===this.opaque&&m.length>0&&this._renderObjects(m,i,h,v),!0===this.transparent&&g.length>0&&this._renderTransparents(g,A,i,h,v),r.renderId=s,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(p)}async renderAsync(e,i){!1===this._initialized&&await this.init();let n=this._renderScene(e,i);await this.backend.resolveTimestampAsync(n,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}_onDeviceLost(e){let i=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(i+=`
Reason: ${e.reason}`),console.error(i),this._isDeviceLost=!0}_renderBundle(e,i,n){let{bundleGroup:r,camera:s,renderList:a}=e,o=this._currentRenderContext,l=this._bundles.get(r,s),h=this.backend.get(l);void 0===h.renderContexts&&(h.renderContexts=new Set);let u=r.version!==h.version,c=!1===h.renderContexts.has(o)||u;if(h.renderContexts.add(o),c){this.backend.beginBundle(o),(void 0===h.renderObjects||u)&&(h.renderObjects=[]),this._currentRenderBundle=l;let e=a.opaque;!0===this.opaque&&e.length>0&&this._renderObjects(e,s,i,n),this._currentRenderBundle=null,this.backend.finishBundle(o,l),h.version=r.version}else{let{renderObjects:e}=h;for(let i=0,n=e.length;i<n;i++){let n=e[i];this._nodes.needsRefresh(n)&&(this._nodes.updateBefore(n),this._nodes.updateForRender(n),this._bindings.updateForRender(n),this._nodes.updateAfter(n))}}this.backend.addBundle(o,l)}render(e,i){if(!1===this._initialized)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,i);this._renderScene(e,i)}_getFrameBufferTarget(){let{currentToneMapping:e,currentColorSpace:i}=this,n=e!==eE.uL9,r=i!==eE.GUF;if(!1===n&&!1===r)return null;let{width:s,height:a}=this.getDrawingBufferSize(p1),{depth:o,stencil:l}=this,h=this._frameBufferTarget;return null===h&&((h=new eE.ACn(s,a,{depthBuffer:o,stencilBuffer:l,type:eE.cLu,format:eE.wk1,colorSpace:eE.GUF,generateMipmaps:!1,minFilter:eE.wem,magFilter:eE.wem,samples:this.samples})).isPostProcessingRenderTarget=!0,this._frameBufferTarget=h),h.depthBuffer=o,h.stencilBuffer=l,h.setSize(s,a),h.viewport.copy(this._viewport),h.scissor.copy(this._scissor),h.viewport.multiplyScalar(this._pixelRatio),h.scissor.multiplyScalar(this._pixelRatio),h.scissorTest=this._scissorTest,h}_renderScene(e,i,n=!0){let r;if(!0===this._isDeviceLost)return;let s=n?this._getFrameBufferTarget():null,a=this._nodes.nodeFrame,o=a.renderId,l=this._currentRenderContext,h=this._currentRenderObjectFunction,u=!0===e.isScene?e:p0,c=this._renderTarget,d=this._activeCubeFace,p=this._activeMipmapLevel;null!==s?(r=s,this.setRenderTarget(r)):r=c;let f=this._renderContexts.get(e,i,r);this._currentRenderContext=f,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,a.renderId=this.info.calls;let m=this.coordinateSystem;i.coordinateSystem!==m&&(i.coordinateSystem=m,i.updateProjectionMatrix()),!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===i.parent&&!0===i.matrixWorldAutoUpdate&&i.updateMatrixWorld();let g=this._viewport,A=this._scissor,v=this._pixelRatio;null!==r&&(g=r.viewport,A=r.scissor,v=1),this.getDrawingBufferSize(p1),p2.set(0,0,p1.width,p1.height);let y=void 0===g.minDepth?0:g.minDepth,x=void 0===g.maxDepth?1:g.maxDepth;f.viewportValue.copy(g).multiplyScalar(v).floor(),f.viewportValue.width>>=p,f.viewportValue.height>>=p,f.viewportValue.minDepth=y,f.viewportValue.maxDepth=x,f.viewport=!1===f.viewportValue.equals(p2),f.scissorValue.copy(A).multiplyScalar(v).floor(),f.scissor=this._scissorTest&&!1===f.scissorValue.equals(p2),f.scissorValue.width>>=p,f.scissorValue.height>>=p,f.clippingContext||(f.clippingContext=new pX),f.clippingContext.updateGlobal(u,i),u.onBeforeRender(this,e,i,r),p4.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),p3.setFromProjectionMatrix(p4,m);let _=this._renderLists.get(e,i);if(_.begin(),this._projectObject(e,i,0,_,f.clippingContext),_.finish(),!0===this.sortObjects&&_.sort(this._opaqueSort,this._transparentSort),null!==r){this._textures.updateRenderTarget(r,p);let e=this._textures.get(r);f.textures=e.textures,f.depthTexture=e.depthTexture,f.width=e.width,f.height=e.height,f.renderTarget=r,f.depth=r.depthBuffer,f.stencil=r.stencilBuffer}else f.textures=null,f.depthTexture=null,f.width=this.domElement.width,f.height=this.domElement.height,f.depth=this.depth,f.stencil=this.stencil;f.width>>=p,f.height>>=p,f.activeCubeFace=d,f.activeMipmapLevel=p,f.occlusionQueryCount=_.occlusionQueryCount,this._background.update(u,_,f),this.backend.beginRender(f);let{bundles:b,lightsNode:E,transparentDoublePass:w,transparent:M,opaque:C}=_;if(b.length>0&&this._renderBundles(b,u,E),!0===this.opaque&&C.length>0&&this._renderObjects(C,i,u,E),!0===this.transparent&&M.length>0&&this._renderTransparents(M,w,i,u,E),this.backend.finishRender(f),a.renderId=o,this._currentRenderContext=l,this._currentRenderObjectFunction=h,null!==s){this.setRenderTarget(c,d,p);let e=this._quad;this._nodes.hasOutputChange(r.texture)&&(e.material.fragmentNode=this._nodes.getOutputNode(r.texture),e.material.needsUpdate=!0),this._renderScene(e,e.camera,!1)}return u.onAfterRender(this,e,i,r),f}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,i,n){this._width=e,this._height=i,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(i*n),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setSize(e,i,n=!0){this._width=e,this._height=i,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(i*this._pixelRatio),!0===n&&(this.domElement.style.width=e+"px",this.domElement.style.height=i+"px"),this.setViewport(0,0,e,i),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){let i=this._scissor;return e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height,e}setScissor(e,i,n,r){let s=this._scissor;e.isVector4?s.copy(e):s.set(e,i,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,i,n,r,s=0,a=1){let o=this._viewport;e.isVector4?o.copy(e):o.set(e,i,n,r),o.minDepth=s,o.maxDepth=a}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,i=1){this._clearColor.set(e),this._clearColor.a=i}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){let i=this._currentRenderContext;return i&&this.backend.isOccluded(i,e)}clear(e=!0,i=!0,n=!0){if(!1===this._initialized)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,i,n);let r=this._renderTarget||this._getFrameBufferTarget(),s=null;if(null!==r){this._textures.updateRenderTarget(r);let e=this._textures.get(r);(s=this._renderContexts.get(null,null,r)).textures=e.textures,s.depthTexture=e.depthTexture,s.width=e.width,s.height=e.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer}if(this.backend.clear(e,i,n,s),null!==r&&null===this._renderTarget){let e=this._quad;this._nodes.hasOutputChange(r.texture)&&(e.material.fragmentNode=this._nodes.getOutputNode(r.texture),e.material.needsUpdate=!0),this._renderScene(e,e.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,i=!0,n=!0){!1===this._initialized&&await this.init(),this.clear(e,i,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return null!==this._renderTarget?eE.uL9:this.toneMapping}get currentColorSpace(){return null!==this._renderTarget?eE.GUF:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,i=0,n=0){this._renderTarget=e,this._activeCubeFace=i,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(!0===this.isDeviceLost)return;if(!1===this._initialized)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);let i=this._nodes.nodeFrame,n=i.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,i.renderId=this.info.calls;let r=this.backend,s=this._pipelines,a=this._bindings,o=this._nodes,l=Array.isArray(e)?e:[e];if(void 0===l[0]||!0!==l[0].isComputeNode)throw Error("THREE.Renderer: .compute() expects a ComputeNode.");for(let i of(r.beginCompute(e),l)){if(!1===s.has(i)){let e=()=>{i.removeEventListener("dispose",e),s.delete(i),a.delete(i),o.delete(i)};i.addEventListener("dispose",e);let n=i.onInitFunction;null!==n&&n.call(i,{renderer:this})}o.updateForCompute(i),a.updateForCompute(i);let n=a.getForCompute(i),l=s.getForCompute(i,n);r.compute(e,i,n,l)}r.finishCompute(e),i.renderId=n}async computeAsync(e){!1===this._initialized&&await this.init(),this.compute(e),await this.backend.resolveTimestampAsync(e,"compute")}async hasFeatureAsync(e){return!1===this._initialized&&await this.init(),this.backend.hasFeature(e)}hasFeature(e){return!1===this._initialized?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){!1===this._initialized&&await this.init(),this._textures.updateTexture(e)}initTexture(e){!1===this._initialized&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,i=null){let n;if(null!==i){if(i.isVector2)i=p5.set(i.x,i.y,e.image.width,e.image.height).floor();else if(i.isVector4)i=p5.copy(i).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}}else i=p5.set(0,0,e.image.width,e.image.height);let r=this._currentRenderContext;null!==r?n=r.renderTarget:null!==(n=this._renderTarget||this._getFrameBufferTarget())&&(this._textures.updateRenderTarget(n),r=this._textures.get(n)),this._textures.updateTexture(e,{renderTarget:n}),this.backend.copyFramebufferToTexture(e,r,i)}copyTextureToTexture(e,i,n=null,r=null,s=0){this._textures.updateTexture(e),this._textures.updateTexture(i),this.backend.copyTextureToTexture(e,i,n,r,s)}async readRenderTargetPixelsAsync(e,i,n,r,s,a=0,o=0){return this.backend.copyTextureToBuffer(e.textures[a],i,n,r,s,o)}_projectObject(e,i,n,r,s){if(!1===e.visible)return;if(e.layers.test(i.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)!0===e.autoUpdate&&e.update(i);else if(e.isLight)r.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||p3.intersectsSprite(e)){!0===this.sortObjects&&p5.setFromMatrixPosition(e.matrixWorld).applyMatrix4(p4);let{geometry:i,material:a}=e;a.visible&&r.push(e,i,a,n,p5.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||p3.intersectsObject(e))){let{geometry:i,material:a}=e;if(!0===this.sortObjects&&(null===i.boundingSphere&&i.computeBoundingSphere(),p5.copy(i.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(p4)),Array.isArray(a)){let o=i.groups;for(let l=0,h=o.length;l<h;l++){let h=o[l],u=a[h.materialIndex];u&&u.visible&&r.push(e,i,u,n,p5.z,h,s)}}else a.visible&&r.push(e,i,a,n,p5.z,null,s)}}if(!0===e.isBundleGroup&&void 0!==this.backend.beginBundle){let n=r;(r=this._renderLists.get(e,i)).begin(),n.pushBundle({bundleGroup:e,camera:i,renderList:r}),r.finish()}let a=e.children;for(let e=0,o=a.length;e<o;e++)this._projectObject(a[e],i,n,r,s)}_renderBundles(e,i,n){for(let r of e)this._renderBundle(r,i,n)}_renderTransparents(e,i,n,r,s){if(i.length>0){for(let{material:e}of i)e.side=eE._Li;for(let{material:e}of(this._renderObjects(i,n,r,s,"backSide"),i))e.side=eE.Wl3;for(let{material:a}of(this._renderObjects(e,n,r,s),i))a.side=eE.ehD}else this._renderObjects(e,n,r,s)}_renderObjects(e,i,n,r,s=null){for(let a=0,o=e.length;a<o;a++){let{object:o,geometry:l,material:h,group:u,clippingContext:c}=e[a];if(i.isArrayCamera){let e=i.cameras;for(let i=0,a=e.length;i<a;i++){let a=e[i];if(o.layers.test(a.layers)){let e=a.viewport,i=void 0===e.minDepth?0:e.minDepth,d=void 0===e.maxDepth?1:e.maxDepth,p=this._currentRenderContext.viewportValue;p.copy(e).multiplyScalar(this._pixelRatio).floor(),p.minDepth=i,p.maxDepth=d,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(o,n,a,l,h,u,r,c,s)}}}else this._currentRenderObjectFunction(o,n,i,l,h,u,r,c,s)}}renderObject(e,i,n,r,s,a,o,l=null,h=null){let u,c,d;if(e.onBeforeRender(this,i,n,r,s,a),null!==i.overrideMaterial){let e=i.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(u=e.positionNode,e.positionNode=s.positionNode),e.alphaTest=s.alphaTest,e.alphaMap=s.alphaMap,e.transparent=s.transparent||s.transmission>0,e.isShadowNodeMaterial&&(e.side=null===s.shadowSide?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(d=e.depthNode,e.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(c=e.colorNode,e.colorNode=s.castShadowNode)),s=e}!0===s.transparent&&s.side===eE.ehD&&!1===s.forceSinglePass?(s.side=eE._Li,this._handleObjectFunction(e,s,i,n,o,a,l,"backSide"),s.side=eE.Wl3,this._handleObjectFunction(e,s,i,n,o,a,l,h),s.side=eE.ehD):this._handleObjectFunction(e,s,i,n,o,a,l,h),void 0!==u&&(i.overrideMaterial.positionNode=u),void 0!==d&&(i.overrideMaterial.depthNode=d),void 0!==c&&(i.overrideMaterial.colorNode=c),e.onAfterRender(this,i,n,r,s,a)}_renderObjectDirect(e,i,n,r,s,a,o,l){let h=this._objects.get(e,i,n,r,s,this._currentRenderContext,o,l);h.drawRange=e.geometry.drawRange,h.group=a;let u=this._nodes.needsRefresh(h);u&&(this._nodes.updateBefore(h),this._geometries.updateForRender(h),this._nodes.updateForRender(h),this._bindings.updateForRender(h)),this._pipelines.updateForRender(h),null!==this._currentRenderBundle&&(this.backend.get(this._currentRenderBundle).renderObjects.push(h),h.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(h,this.info),u&&this._nodes.updateAfter(h)}_createObjectPipeline(e,i,n,r,s,a,o,l){let h=this._objects.get(e,i,n,r,s,this._currentRenderContext,o,l);h.drawRange=e.geometry.drawRange,h.group=a,this._nodes.updateBefore(h),this._geometries.updateForRender(h),this._nodes.updateForRender(h),this._bindings.updateForRender(h),this._pipelines.getForRender(h,this._compilationPromises),this._nodes.updateAfter(h)}get compile(){return this.compileAsync}}class p8{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}class p7 extends p8{constructor(e,i=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=i}get byteLength(){var e;return(e=this._buffer.byteLength)+(16-e%16)%16}get buffer(){return this._buffer}update(){return!0}}class p9 extends p7{constructor(e,i=null){super(e,i),this.isUniformBuffer=!0}}let fe=0;class ft extends p9{constructor(e,i){super("UniformBuffer_"+fe++,e?e.value:null),this.nodeUniform=e,this.groupNode=i}get buffer(){return this.nodeUniform.value}}class fi extends p9{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){let i=this.uniforms.indexOf(e);return -1!==i&&this.uniforms.splice(i,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;return null===e&&(e=new Float32Array(new ArrayBuffer(this.byteLength)),this._buffer=e),e}get byteLength(){let e=0;for(let i=0,n=this.uniforms.length;i<n;i++){let n=this.uniforms[i],{boundary:r,itemSize:s}=n,a=e%16,o=16-a;0!==a&&o-r<0?e+=16-a:a%r!=0&&(e+=a%r),n.offset=e/this.bytesPerElement,e+=s*this.bytesPerElement}return 16*Math.ceil(e/16)}update(){let e=!1;for(let i of this.uniforms)!0===this.updateByType(i)&&(e=!0);return e}updateByType(e){return e.isNumberUniform?this.updateNumber(e):e.isVector2Uniform?this.updateVector2(e):e.isVector3Uniform?this.updateVector3(e):e.isVector4Uniform?this.updateVector4(e):e.isColorUniform?this.updateColor(e):e.isMatrix3Uniform?this.updateMatrix3(e):e.isMatrix4Uniform?this.updateMatrix4(e):void console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let i=!1,n=this.values,r=e.getValue(),s=e.offset,a=e.getType();return n[s]!==r&&(this._getBufferForType(a)[s]=n[s]=r,i=!0),i}updateVector2(e){let i=!1,n=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y){let e=this._getBufferForType(a);e[s+0]=n[s+0]=r.x,e[s+1]=n[s+1]=r.y,i=!0}return i}updateVector3(e){let i=!1,n=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z){let e=this._getBufferForType(a);e[s+0]=n[s+0]=r.x,e[s+1]=n[s+1]=r.y,e[s+2]=n[s+2]=r.z,i=!0}return i}updateVector4(e){let i=!1,n=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z||n[s+4]!==r.w){let e=this._getBufferForType(a);e[s+0]=n[s+0]=r.x,e[s+1]=n[s+1]=r.y,e[s+2]=n[s+2]=r.z,e[s+3]=n[s+3]=r.w,i=!0}return i}updateColor(e){let i=!1,n=this.values,r=e.getValue(),s=e.offset;if(n[s+0]!==r.r||n[s+1]!==r.g||n[s+2]!==r.b){let e=this.buffer;e[s+0]=n[s+0]=r.r,e[s+1]=n[s+1]=r.g,e[s+2]=n[s+2]=r.b,i=!0}return i}updateMatrix3(e){let i=!1,n=this.values,r=e.getValue().elements,s=e.offset;if(n[s+0]!==r[0]||n[s+1]!==r[1]||n[s+2]!==r[2]||n[s+4]!==r[3]||n[s+5]!==r[4]||n[s+6]!==r[5]||n[s+8]!==r[6]||n[s+9]!==r[7]||n[s+10]!==r[8]){let e=this.buffer;e[s+0]=n[s+0]=r[0],e[s+1]=n[s+1]=r[1],e[s+2]=n[s+2]=r[2],e[s+4]=n[s+4]=r[3],e[s+5]=n[s+5]=r[4],e[s+6]=n[s+6]=r[5],e[s+8]=n[s+8]=r[6],e[s+9]=n[s+9]=r[7],e[s+10]=n[s+10]=r[8],i=!0}return i}updateMatrix4(e){let i=!1,n=this.values,r=e.getValue().elements,s=e.offset;return!1===function(e,i,n){for(let r=0,s=i.length;r<s;r++)if(e[n+r]!==i[r])return!1;return!0}(n,r,s)&&(this.buffer.set(r,s),function(e,i,n){for(let r=0,s=i.length;r<s;r++)e[n+r]=i[r]}(n,r,s),i=!0),i}_getBufferForType(e){return"int"===e||"ivec2"===e||"ivec3"===e||"ivec4"===e?new Int32Array(this.buffer.buffer):"uint"===e||"uvec2"===e||"uvec3"===e||"uvec4"===e?new Uint32Array(this.buffer.buffer):this.buffer}}let fn=0;class fr extends fi{constructor(e,i){super(e),this.id=fn++,this.groupNode=i,this.isNodeUniformsGroup=!0}}let fs=0;class fa extends p8{constructor(e,i){super(e),this.id=fs++,this.texture=i,this.version=i?i.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){let{texture:i}=this;return e!==this.generation?(this.generation=e,!0):i.isVideoTexture}update(){let{texture:e,version:i}=this;return i!==e.version&&(this.version=e.version,!0)}}class fo extends fa{constructor(e,i,n,r=null){super(e,i?i.value:null),this.textureNode=i,this.groupNode=n,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){let{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class fl extends fo{constructor(e,i,n,r=null){super(e,i,n,r),this.isSampledCubeTexture=!0}}class fh extends fo{constructor(e,i,n,r=null){super(e,i,n,r),this.isSampledTexture3D=!0}}let fu={textureDimensions:"textureSize",equals:"equal"},fc={low:"lowp",medium:"mediump",high:"highp"},fd={swizzleAssign:!0,storageBuffer:!1},fp=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class ff extends pw{constructor(e,i){super(e,i,new pH),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]},this.useComparisonMethod=!0}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==eE.aCh}getMethod(e){return fu[e]||e}getOutputStructName(){return""}buildFunctionCode(e){let i=e.layout,n=this.flowShaderNode(e),r=[];for(let e of i.inputs)r.push(this.getType(e.type)+" "+e.name);return`${this.getType(i.type)} ${i.name}( ${r.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){let i=e.value;if(void 0===i.pbo){let e=i.array,n=i.count*i.itemSize,{itemSize:r}=i,s=i.array.constructor.name.toLowerCase().includes("int"),a=s?eE.D9w:eE.hEm;2===r?a=s?eE.CtA:eE.av9:3===r?a=s?eE.F5G:eE.UCm:4===r&&(a=s?eE.E2K:eE.wk1);let o={Float32Array:eE.VzW,Uint8Array:eE.ywz,Uint16Array:eE.LsT,Uint32Array:eE.JQ4,Int8Array:eE.T95,Int16Array:eE.iAb,Int32Array:eE.Kz5,Uint8ClampedArray:eE.ywz},l=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(n/r)))),h=Math.ceil(n/r/l);l*h*r<n&&h++;let u=l*h*r,c=new e.constructor(u);c.set(e,0),i.array=c;let d=new eE.IEO(i.array,l,h,a,o[i.array.constructor.name]||eE.VzW);d.needsUpdate=!0,d.isPBOTexture=!0;let p=new aQ(d,null,null);p.setPrecision("high"),i.pboNode=p,i.pbo=p.value,this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,i=this.shaderStage){return e.isNodeUniform&&!0!==e.node.isTextureNode&&!0!==e.node.isBufferNode?i.charAt(0)+"_"+e.name:super.getPropertyName(e,i)}generatePBO(e){let{node:i,indexNode:n}=e,r=i.value;this.renderer.backend.has(r)&&(this.renderer.backend.get(r).pbo=r.pbo);let s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),a=this.getPropertyName(s);this.increaseUsage(n);let o=n.build(this,"uint"),l=this.getDataFromNode(e),h=l.propertyName;if(void 0===h){let n=this.getVarFromNode(e);h=this.getPropertyName(n);let s=this.getDataFromNode(i),u=s.propertySizeName;void 0===u&&(u=h+"Size",this.getVarFromNode(i,u,"uint"),this.addLineFlowCode(`${u} = uint( textureSize( ${a}, 0 ).x )`,e),s.propertySizeName=u);let{itemSize:c}=r,d="."+nf.join("").slice(0,c),p=`ivec2(${o} % ${u}, ${o} / ${u})`,f=this.generateTextureLoad(null,a,p,null,"0"),m="vec4";r.pbo.type===eE.JQ4?m="uvec4":r.pbo.type===eE.Kz5&&(m="ivec4"),this.addLineFlowCode(`${h} = ${m}(${f})${d}`,e),l.propertyName=h}return h}generateTextureLoad(e,i,n,r,s="0"){return r?`texelFetch( ${i}, ivec3( ${n}, ${r} ), ${s} )`:`texelFetch( ${i}, ${n}, ${s} )`}generateTexture(e,i,n,r){return e.isDepthTexture?`texture( ${i}, ${n} ).x`:(r&&(n=`vec3( ${n}, ${r} )`),`texture( ${i}, ${n} )`)}generateTextureLevel(e,i,n,r){return`textureLod( ${i}, ${n}, ${r} )`}generateTextureBias(e,i,n,r){return`texture( ${i}, ${n}, ${r} )`}generateTextureGrad(e,i,n,r){return`textureGrad( ${i}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,i,n,r,s,a=this.shaderStage){if("fragment"===a)return`texture( ${i}, vec3( ${n}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){let i=[],n=this.vars[e];if(void 0!==n)for(let e of n)i.push(`${this.getVar(e.type,e.name)};`);return i.join("\n	")}getUniforms(e){let i=this.uniforms[e],n=[],r={};for(let s of i){let i=null,a=!1;if("texture"===s.type){let e=s.node.value,n="";!0===e.isDataTexture&&(e.type===eE.JQ4?n="u":e.type===eE.Kz5&&(n="i")),i=e.compareFunction?`sampler2DShadow ${s.name};`:!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?`${n}sampler2DArray ${s.name};`:`${n}sampler2D ${s.name};`}else if("cubeTexture"===s.type)i=`samplerCube ${s.name};`;else if("texture3D"===s.type)i=`sampler3D ${s.name};`;else if("buffer"===s.type){let e=s.node,n=this.getType(e.bufferType),r=e.bufferCount,a=r>0?r:"";i=`${e.name} {
	${n} ${s.name}[${a}];
};
`}else{let n=this.getVectorType(s.type);i=`${n} ${this.getPropertyName(s,e)};`,a=!0}let o=s.node.precision;if(null!==o&&(i=fc[o]+" "+i),a){i="	"+i;let e=s.groupNode.name;(r[e]||(r[e]=[])).push(i)}else i="uniform "+i,n.push(i)}let s="";for(let i in r){let n=r[i];s+=this._getGLSLUniformStruct(e+"_"+i,n.join("\n"))+"\n"}return s+n.join("\n")}getTypeFromAttribute(e){let i=super.getTypeFromAttribute(e);if(/^[iu]/.test(i)&&e.gpuType!==eE.Kz5){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);let r=n.array;!1==(r instanceof Uint32Array||r instanceof Int32Array)&&(i=i.slice(1))}return i}getAttributes(e){let i="";if("vertex"===e||"compute"===e){let e=this.getAttributesArray(),n=0;for(let r of e)i+=`layout( location = ${n++} ) in ${r.type} ${r.name};
`}return i}getStructMembers(e){let i=[],n=e.getMemberTypes();for(let e=0;e<n.length;e++){let r=n[e];i.push(`layout( location = ${e} ) out ${r} m${e};`)}return i.join("\n")}getStructs(e){let i=[],n=this.structs[e];if(0===n.length)return"layout( location = 0 ) out vec4 fragColor;\n";for(let e=0,r=n.length;e<r;e++){let r=n[e],s="\n";s+=this.getStructMembers(r),s+="\n",i.push(s)}return i.join("\n\n")}getVaryings(e){let i="",n=this.varyings;if("vertex"===e||"compute"===e)for(let r of n){"compute"===e&&(r.needsInterpolation=!0);let n=this.getType(r.type),s=n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":"";i+=`${s}${r.needsInterpolation?"out":"/*out*/"} ${n} ${r.name};
`}else if("fragment"===e){for(let e of n)if(e.needsInterpolation){let n=this.getType(e.type),r=n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":"";i+=`${r}in ${n} ${e.name};
`}}for(let n of this.builtins[e])i+=`${n};
`;return i}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){let e=this.object.workgroupSize.reduce((e,i)=>e*i,1);return`uint( gl_InstanceID ) % ${e}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,i,n=this.shaderStage){let r=this.extensions[n]||(this.extensions[n]=new Map);!1===r.has(e)&&r.set(e,{name:e,behavior:i})}getExtensions(e){let i=[];if("vertex"===e){let i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}let n=this.extensions[e];if(void 0!==n)for(let{name:e,behavior:r}of n.values())i.push(`#extension ${e} : ${r}`);return i.join("\n")}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let i=fd[e];if(void 0===i){let n;switch(i=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance"}if(void 0!==n){let e=this.renderer.backend.extensions;e.has(n)&&(e.get(n),i=!0)}fd[e]=i}return i}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}registerTransform(e,i){this.transforms.push({varyingName:e,attributeNode:i})}getTransforms(){let e=this.transforms,i="";for(let n=0;n<e.length;n++){let r=e[n],s=this.getPropertyName(r.attributeNode);i+=`${r.varyingName} = ${s};
	`}return i}_getGLSLUniformStruct(e,i){return`
layout( std140 ) uniform ${e} {
${i}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions 
${e.extensions}

// precision
${fp}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${fp}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){let e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};for(let i in this.sortBindingGroups(),e){let n="// code\n\n";n+=this.flowCode[i];let r=this.flowNodes[i],s=r[r.length-1];for(let e of r){let r=this.getFlowData(e),a=e.name;a&&(n.length>0&&(n+="\n"),n+=`	// flow -> ${a}
	`),n+=`${r.code}
	`,e!==s||"compute"===i||(n+="// result\n	","vertex"===i?(n+="gl_Position = ",n+=`${r.result};`):"fragment"!==i||e.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${r.result};`))}let a=e[i];a.extensions=this.getExtensions(i),a.uniforms=this.getUniforms(i),a.attributes=this.getAttributes(i),a.varyings=this.getVaryings(i),a.vars=this.getVars(i),a.structs=this.getStructs(i),a.codes=this.getCodes(i),a.transforms=this.getTransforms(i),a.flow=n}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,i,n,r=null){let s=super.getUniformFromNode(e,i,n,r),a=this.getDataFromNode(e,n,this.globalCache),o=a.uniformGPU;if(void 0===o){let r=e.groupNode,l=r.name,h=this.getBindGroupArray(l,n);if("texture"===i)o=new fo(s.name,s.node,r),h.push(o);else if("cubeTexture"===i)o=new fl(s.name,s.node,r),h.push(o);else if("texture3D"===i)o=new fh(s.name,s.node,r),h.push(o);else if("buffer"===i){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;let i=new ft(e,r);i.name=e.name,h.push(i),o=i}else{let e=this.uniformGroups[n]||(this.uniformGroups[n]={}),a=e[l];void 0===a&&(a=new fr(n+"_"+l,r),e[l]=a,h.push(a)),o=this.getNodeUniform(s,i),a.addUniform(o)}a.uniformGPU=o}return s}}let fm=null,fg=null;class fA{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampAsync(){}async waitForGPU(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return fm=fm||new eE.FM8,this.renderer.getDrawingBufferSize(fm)}setScissorTest(){}getClearColor(){let e=this.renderer;return fg=fg||new cE,e.getClearColor(fg),fg.getRGB(fg,this.renderer.currentColorSpace),fg}getDomElement(){let e=this.domElement;return null===e&&("setAttribute"in(e=void 0!==this.parameters.canvas?this.parameters.canvas:(0,eE.O5A)())&&e.setAttribute("data-engine",`three.js r${eE.UZH} webgpu`),this.domElement=e),e}set(e,i){this.data.set(e,i)}get(e){let i=this.data.get(e);return void 0===i&&(i={},this.data.set(e,i)),i}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let fv=0;class fy{constructor(e,i){this.buffers=[e.bufferGPU,i],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}}class fx{constructor(e){this.backend=e}createAttribute(e,i){let n;let r=this.backend,{gl:s}=r,a=e.array,o=e.usage||s.STATIC_DRAW,l=e.isInterleavedBufferAttribute?e.data:e,h=r.get(l),u=h.bufferGPU;if(void 0===u&&(u=this._createBuffer(s,i,a,o),h.bufferGPU=u,h.bufferType=i,h.version=l.version),a instanceof Float32Array)n=s.FLOAT;else if(a instanceof Uint16Array)n=e.isFloat16BufferAttribute?s.HALF_FLOAT:s.UNSIGNED_SHORT;else if(a instanceof Int16Array)n=s.SHORT;else if(a instanceof Uint32Array)n=s.UNSIGNED_INT;else if(a instanceof Int32Array)n=s.INT;else if(a instanceof Int8Array)n=s.BYTE;else if(a instanceof Uint8Array)n=s.UNSIGNED_BYTE;else if(a instanceof Uint8ClampedArray)n=s.UNSIGNED_BYTE;else throw Error("THREE.WebGLBackend: Unsupported buffer data format: "+a);let c={bufferGPU:u,bufferType:i,type:n,byteLength:a.byteLength,bytesPerElement:a.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:n===s.INT||n===s.UNSIGNED_INT||e.gpuType===eE.Kz5,id:fv++};(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(c=new fy(c,this._createBuffer(s,i,a,o))),r.set(e,c)}updateAttribute(e){let i=this.backend,{gl:n}=i,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,a=i.get(s),o=a.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(o,a.bufferGPU),0===l.length)n.bufferSubData(o,0,r);else{for(let e=0,i=l.length;e<i;e++){let i=l[e];n.bufferSubData(o,i.start*r.BYTES_PER_ELEMENT,r,i.start,i.count)}s.clearUpdateRanges()}n.bindBuffer(o,null),a.version=s.version}destroyAttribute(e){let i=this.backend,{gl:n}=i;e.isInterleavedBufferAttribute&&i.delete(e.data);let r=i.get(e);n.deleteBuffer(r.bufferGPU),i.delete(e)}async getArrayBufferAsync(e){let i=this.backend,{gl:n}=i,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=i.get(r),a=e.array,o=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,s);let l=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,l),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await i.utils._clientWaitAsync();let h=new e.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,l),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,h),n.deleteBuffer(l),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),h.buffer}_createBuffer(e,i,n,r){let s=e.createBuffer();return e.bindBuffer(i,s),e.bufferData(i,n,r),e.bindBuffer(i,null),s}}let f_=!1,fb,fE;class fw{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},!1===f_&&(this._init(this.gl),f_=!0)}_init(e){fb={[eE.bGH]:e.FUNC_ADD,[eE.Wbm]:e.FUNC_SUBTRACT,[eE.rOj]:e.FUNC_REVERSE_SUBTRACT},fE={[eE.c8b]:e.ZERO,[eE.ghN]:e.ONE,[eE.KhW]:e.SRC_COLOR,[eE.k74]:e.SRC_ALPHA,[eE.RlZ]:e.SRC_ALPHA_SATURATE,[eE.Vdb]:e.DST_COLOR,[eE.fSK]:e.DST_ALPHA,[eE.iWC]:e.ONE_MINUS_SRC_COLOR,[eE.LgZ]:e.ONE_MINUS_SRC_ALPHA,[eE.Wpd]:e.ONE_MINUS_DST_COLOR,[eE.Hy8]:e.ONE_MINUS_DST_ALPHA}}enable(e){let{enabled:i}=this;!0!==i[e]&&(this.gl.enable(e),i[e]=!0)}disable(e){let{enabled:i}=this;!1!==i[e]&&(this.gl.disable(e),i[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){let{gl:i}=this;e?i.frontFace(i.CW):i.frontFace(i.CCW),this.currentFlipSided=e}}setCullFace(e){let{gl:i}=this;e!==eE.PeU?(this.enable(i.CULL_FACE),e!==this.currentCullFace&&(e===eE.tm_?i.cullFace(i.BACK):e===eE.S2y?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):this.disable(i.CULL_FACE),this.currentCullFace=e}setLineWidth(e){let{currentLineWidth:i,gl:n}=this;e!==i&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,i,n,r,s,a,o,l){let{gl:h}=this;if(e===eE.jFi){!0===this.currentBlendingEnabled&&(this.disable(h.BLEND),this.currentBlendingEnabled=!1);return}if(!1===this.currentBlendingEnabled&&(this.enable(h.BLEND),this.currentBlendingEnabled=!0),e!==eE.Xaj){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==eE.bGH||this.currentBlendEquationAlpha!==eE.bGH)&&(h.blendEquation(h.FUNC_ADD),this.currentBlendEquation=eE.bGH,this.currentBlendEquationAlpha=eE.bGH),l)switch(e){case eE.bdR:h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case eE.WMw:h.blendFunc(h.ONE,h.ONE);break;case eE.N4l:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case eE.M5h:h.blendFuncSeparate(h.ZERO,h.SRC_COLOR,h.ZERO,h.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case eE.bdR:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case eE.WMw:h.blendFunc(h.SRC_ALPHA,h.ONE);break;case eE.N4l:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case eE.M5h:h.blendFunc(h.ZERO,h.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}s=s||i,a=a||n,o=o||r,(i!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(h.blendEquationSeparate(fb[i],fb[s]),this.currentBlendEquation=i,this.currentBlendEquationAlpha=s),(n!==this.currentBlendSrc||r!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||o!==this.currentBlendDstAlpha)&&(h.blendFuncSeparate(fE[n],fE[r],fE[a],fE[o]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){let{gl:i}=this;e?this.enable(i.DEPTH_TEST):this.disable(i.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){let{gl:i}=this;switch(e){case eE.BVF:i.depthFunc(i.NEVER);break;case eE.Se2:i.depthFunc(i.ALWAYS);break;case eE.Zr5:i.depthFunc(i.LESS);break;case eE.vCF:i.depthFunc(i.LEQUAL);break;case eE.eD:i.depthFunc(i.EQUAL);break;case eE.ksN:i.depthFunc(i.GEQUAL);break;case eE.w$m:i.depthFunc(i.GREATER);break;case eE.M6v:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}this.currentDepthFunc=e}}setStencilTest(e){let{gl:i}=this;e?this.enable(i.STENCIL_TEST):this.disable(i.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,i,n){(this.currentStencilFunc!==e||this.currentStencilRef!==i||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,i,n),this.currentStencilFunc=e,this.currentStencilRef=i,this.currentStencilFuncMask=n)}setStencilOp(e,i,n){(this.currentStencilFail!==e||this.currentStencilZFail!==i||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,i,n),this.currentStencilFail=e,this.currentStencilZFail=i,this.currentStencilZPass=n)}setMaterial(e,i,n){let{gl:r}=this;e.side===eE.ehD?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===eE._Li;i&&(s=!s),this.setFlipSided(s),e.blending===eE.bdR&&!1===e.transparent?this.setBlending(eE.jFi):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);let a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let e=0;e<8;e++)e<n?this.enable(12288+e):this.disable(12288+e)}setPolygonOffset(e,i,n){let{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==i||this.currentPolygonOffsetUnits!==n)&&(r.polygonOffset(i,n),this.currentPolygonOffsetFactor=i,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e&&(this.gl.useProgram(e),this.currentProgram=e,!0)}bindFramebuffer(e,i){let{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==i&&(n.bindFramebuffer(e,i),r[e]=i,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=i),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=i),!0)}drawBuffers(e,i){let{gl:n}=this,r=[],s=!1;if(null!==e.textures){void 0===(r=this.currentDrawbuffers.get(i))&&(r=[],this.currentDrawbuffers.set(i,r));let a=e.textures;if(r.length!==a.length||r[0]!==n.COLOR_ATTACHMENT0){for(let e=0,i=a.length;e<i;e++)r[e]=n.COLOR_ATTACHMENT0+e;r.length=a.length,s=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,s=!0);s&&n.drawBuffers(r)}activeTexture(e){let{gl:i,currentTextureSlot:n,maxTextures:r}=this;void 0===e&&(e=i.TEXTURE0+r-1),n!==e&&(i.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,i,n){let{gl:r,currentTextureSlot:s,currentBoundTextures:a,maxTextures:o}=this;void 0===n&&(n=null===s?r.TEXTURE0+o-1:s);let l=a[n];void 0===l&&(l={type:void 0,texture:void 0},a[n]=l),(l.type!==e||l.texture!==i)&&(s!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,i),l.type=e,l.texture=i)}bindBufferBase(e,i,n){let{gl:r}=this,s=`${e}-${i}`;return this.currentBoundBufferBases[s]!==n&&(r.bindBufferBase(e,i,n),this.currentBoundBufferBases[s]=n,!0)}unbindTexture(){let{gl:e,currentTextureSlot:i,currentBoundTextures:n}=this,r=n[i];void 0!==r&&void 0!==r.type&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class fM{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,i=eE.aCh){let n;let{gl:r,extensions:s}=this;if(e===eE.ywz)return r.UNSIGNED_BYTE;if(e===eE.k0A)return r.UNSIGNED_SHORT_4_4_4_4;if(e===eE.irR)return r.UNSIGNED_SHORT_5_5_5_1;if(e===eE.tQZ)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===eE.T95)return r.BYTE;if(e===eE.iAb)return r.SHORT;if(e===eE.LsT)return r.UNSIGNED_SHORT;if(e===eE.Kz5)return r.INT;if(e===eE.JQ4)return r.UNSIGNED_INT;if(e===eE.VzW)return r.FLOAT;if(e===eE.cLu)return r.HALF_FLOAT;if(e===eE.OTo)return r.ALPHA;if(e===eE.UCm)return r.RGB;if(e===eE.wk1)return r.RGBA;if(e===eE.Y8D)return r.LUMINANCE;if(e===eE.cRx)return r.LUMINANCE_ALPHA;if(e===eE.qkB)return r.DEPTH_COMPONENT;if(e===eE.brP)return r.DEPTH_STENCIL;if(e===eE.hEm)return r.RED;if(e===eE.D9w)return r.RED_INTEGER;if(e===eE.av9)return r.RG;if(e===eE.CtA)return r.RG_INTEGER;if(e===eE.E2K)return r.RGBA_INTEGER;if(e===eE.wuA||e===eE.BFQ||e===eE.v3W||e===eE.ILR){if(i===eE.KI_){if(null===(n=s.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(e===eE.wuA)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===eE.BFQ)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===eE.v3W)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===eE.ILR)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(n=s.get("WEBGL_compressed_texture_s3tc")))return null;if(e===eE.wuA)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===eE.BFQ)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===eE.v3W)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===eE.ILR)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(e===eE._AM||e===eE.vCx||e===eE.eaV||e===eE.CaW){if(null===(n=s.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===eE._AM)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===eE.vCx)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===eE.eaV)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===eE.CaW)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===eE.fto||e===eE.l0P||e===eE.ekQ){if(null===(n=s.get("WEBGL_compressed_texture_etc")))return null;if(e===eE.fto||e===eE.l0P)return i===eE.KI_?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(e===eE.ekQ)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}if(e===eE.ptH||e===eE.jZA||e===eE.y2t||e===eE.gi4||e===eE.Djp||e===eE.BG$||e===eE.NYV||e===eE.xJs||e===eE.pKu||e===eE.GG6||e===eE.Gih||e===eE.FUD||e===eE.iiP||e===eE.SvJ){if(null===(n=s.get("WEBGL_compressed_texture_astc")))return null;if(e===eE.ptH)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===eE.jZA)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===eE.y2t)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===eE.gi4)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===eE.Djp)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===eE.BG$)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===eE.NYV)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===eE.xJs)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===eE.pKu)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===eE.GG6)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===eE.Gih)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===eE.FUD)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===eE.iiP)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===eE.SvJ)return i===eE.KI_?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===eE.bsb){if(null===(n=s.get("EXT_texture_compression_bptc")))return null;if(e===eE.bsb)return i===eE.KI_?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(e===eE.HdW||e===eE.vuL||e===eE.ZTh||e===eE.lGU){if(null===(n=s.get("EXT_texture_compression_rgtc")))return null;if(e===eE.bsb)return n.COMPRESSED_RED_RGTC1_EXT;if(e===eE.vuL)return n.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===eE.ZTh)return n.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===eE.lGU)return n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return e===eE.wJv?r.UNSIGNED_INT_24_8:void 0!==r[e]?r[e]:null}_clientWaitAsync(){let{gl:e}=this,i=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{!function s(){let a=e.clientWaitSync(i,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(i),r();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(i),n()}()})}}let fC=!1,fS,fT,fR;class fI{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},!1===fC&&(this._init(this.gl),fC=!0)}_init(e){fS={[eE.rpg]:e.REPEAT,[eE.uWy]:e.CLAMP_TO_EDGE,[eE.OoA]:e.MIRRORED_REPEAT},fT={[eE.TyD]:e.NEAREST,[eE.YLQ]:e.NEAREST_MIPMAP_NEAREST,[eE.aH4]:e.NEAREST_MIPMAP_LINEAR,[eE.wem]:e.LINEAR,[eE.qyh]:e.LINEAR_MIPMAP_NEAREST,[eE.D1R]:e.LINEAR_MIPMAP_LINEAR},fR={[eE.xoQ]:e.NEVER,[eE.T6w]:e.ALWAYS,[eE.D67]:e.LESS,[eE.M$G]:e.LEQUAL,[eE.F1y]:e.EQUAL,[eE.Jjb]:e.GEQUAL,[eE.Zen]:e.GREATER,[eE.O78]:e.NOTEQUAL}}filterFallback(e){let{gl:i}=this;return e===eE.TyD||e===eE.YLQ||e===eE.aH4?i.NEAREST:i.LINEAR}getGLTextureType(e){let i;let{gl:n}=this;return!0===e.isCubeTexture?n.TEXTURE_CUBE_MAP:!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:!0===e.isData3DTexture?n.TEXTURE_3D:n.TEXTURE_2D}getInternalFormat(e,i,n,r,s=!1){let{gl:a,extensions:o}=this;if(null!==e){if(void 0!==a[e])return a[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=i;return i===a.RED&&(n===a.FLOAT&&(l=a.R32F),n===a.HALF_FLOAT&&(l=a.R16F),n===a.UNSIGNED_BYTE&&(l=a.R8),n===a.UNSIGNED_SHORT&&(l=a.R16),n===a.UNSIGNED_INT&&(l=a.R32UI),n===a.BYTE&&(l=a.R8I),n===a.SHORT&&(l=a.R16I),n===a.INT&&(l=a.R32I)),i===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.R8UI),n===a.UNSIGNED_SHORT&&(l=a.R16UI),n===a.UNSIGNED_INT&&(l=a.R32UI),n===a.BYTE&&(l=a.R8I),n===a.SHORT&&(l=a.R16I),n===a.INT&&(l=a.R32I)),i===a.RG&&(n===a.FLOAT&&(l=a.RG32F),n===a.HALF_FLOAT&&(l=a.RG16F),n===a.UNSIGNED_BYTE&&(l=a.RG8),n===a.UNSIGNED_SHORT&&(l=a.RG16),n===a.UNSIGNED_INT&&(l=a.RG32UI),n===a.BYTE&&(l=a.RG8I),n===a.SHORT&&(l=a.RG16I),n===a.INT&&(l=a.RG32I)),i===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RG8UI),n===a.UNSIGNED_SHORT&&(l=a.RG16UI),n===a.UNSIGNED_INT&&(l=a.RG32UI),n===a.BYTE&&(l=a.RG8I),n===a.SHORT&&(l=a.RG16I),n===a.INT&&(l=a.RG32I)),i===a.RGB&&(n===a.FLOAT&&(l=a.RGB32F),n===a.HALF_FLOAT&&(l=a.RGB16F),n===a.UNSIGNED_BYTE&&(l=a.RGB8),n===a.UNSIGNED_SHORT&&(l=a.RGB16),n===a.UNSIGNED_INT&&(l=a.RGB32UI),n===a.BYTE&&(l=a.RGB8I),n===a.SHORT&&(l=a.RGB16I),n===a.INT&&(l=a.RGB32I),n===a.UNSIGNED_BYTE&&(l=r===eE.KI_&&!1===s?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(l=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(l=a.RGB9_E5)),i===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RGB8UI),n===a.UNSIGNED_SHORT&&(l=a.RGB16UI),n===a.UNSIGNED_INT&&(l=a.RGB32UI),n===a.BYTE&&(l=a.RGB8I),n===a.SHORT&&(l=a.RGB16I),n===a.INT&&(l=a.RGB32I)),i===a.RGBA&&(n===a.FLOAT&&(l=a.RGBA32F),n===a.HALF_FLOAT&&(l=a.RGBA16F),n===a.UNSIGNED_BYTE&&(l=a.RGBA8),n===a.UNSIGNED_SHORT&&(l=a.RGBA16),n===a.UNSIGNED_INT&&(l=a.RGBA32UI),n===a.BYTE&&(l=a.RGBA8I),n===a.SHORT&&(l=a.RGBA16I),n===a.INT&&(l=a.RGBA32I),n===a.UNSIGNED_BYTE&&(l=r===eE.KI_&&!1===s?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1)),i===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(l=a.RGBA16UI),n===a.UNSIGNED_INT&&(l=a.RGBA32UI),n===a.BYTE&&(l=a.RGBA8I),n===a.SHORT&&(l=a.RGBA16I),n===a.INT&&(l=a.RGBA32I)),i===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_INT&&(l=a.DEPTH24_STENCIL8),n===a.FLOAT&&(l=a.DEPTH_COMPONENT32F)),i===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(l=a.DEPTH24_STENCIL8),(l===a.R16F||l===a.R32F||l===a.RG16F||l===a.RG32F||l===a.RGBA16F||l===a.RGBA32F)&&o.get("EXT_color_buffer_float"),l}setTextureParameters(e,i){let{gl:n,extensions:r,backend:s}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,i.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,i.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,fS[i.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,fS[i.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&n.texParameteri(e,n.TEXTURE_WRAP_R,fS[i.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,fT[i.magFilter]);let a=void 0!==i.mipmaps&&i.mipmaps.length>0,o=i.minFilter===eE.wem&&a?eE.D1R:i.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,fT[o]),i.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,fR[i.compareFunction])),!0===r.has("EXT_texture_filter_anisotropic")){if(i.magFilter===eE.TyD||i.minFilter!==eE.aH4&&i.minFilter!==eE.D1R||i.type===eE.VzW&&!1===r.has("OES_texture_float_linear"))return;if(i.anisotropy>1){let a=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){let{gl:i,backend:n,defaultTextures:r}=this,s=this.getGLTextureType(e),a=r[s];void 0===a&&(a=i.createTexture(),n.state.bindTexture(s,a),i.texParameteri(s,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(s,i.TEXTURE_MAG_FILTER,i.NEAREST),r[s]=a),n.set(e,{textureGPU:a,glTextureType:s,isDefault:!0})}createTexture(e,i){let{gl:n,backend:r}=this,{levels:s,width:a,height:o,depth:l}=i,h=r.utils.convert(e.format,e.colorSpace),u=r.utils.convert(e.type),c=this.getInternalFormat(e.internalFormat,h,u,e.colorSpace,e.isVideoTexture),d=n.createTexture(),p=this.getGLTextureType(e);r.state.bindTexture(p,d),this.setTextureParameters(p,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,s,c,a,o,l):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,s,c,a,o,l):e.isVideoTexture||n.texStorage2D(p,s,c,a,o),r.set(e,{textureGPU:d,glTextureType:p,glFormat:h,glType:u,glInternalFormat:c})}copyBufferToTexture(e,i){let{gl:n,backend:r}=this,{textureGPU:s,glTextureType:a,glFormat:o,glType:l}=r.get(i),{width:h,height:u}=i.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(a,s),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,h,u,o,l,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,i){let{gl:n}=this,{width:r,height:s}=i,{textureGPU:a,glTextureType:o,glFormat:l,glType:h,glInternalFormat:u}=this.backend.get(e);if(e.isRenderTargetTexture||void 0===a)return;let c=e=>e.isDataTexture?e.image.data:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||e instanceof OffscreenCanvas?e:e.data;if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){let r=e.mipmaps,s=i.image;for(let i=0;i<r.length;i++){let a=r[i];e.isCompressedArrayTexture?e.format!==n.RGBA?null!==l?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,i,0,0,0,a.width,a.height,s.depth,l,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,i,0,0,0,a.width,a.height,s.depth,l,h,a.data):null!==l?n.compressedTexSubImage2D(n.TEXTURE_2D,i,0,0,a.width,a.height,l,a.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){let e=i.images;for(let i=0;i<6;i++){let a=c(e[i]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,0,0,r,s,l,h,a)}}else if(e.isDataArrayTexture){let e=i.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,e.width,e.height,e.depth,l,h,e.data)}else if(e.isData3DTexture){let e=i.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,e.width,e.height,e.depth,l,h,e.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(o,0,u,l,h,i.image);else{let e=c(i.image);n.texSubImage2D(o,0,0,0,r,s,l,h,e)}}generateMipmaps(e){let{gl:i,backend:n}=this,{textureGPU:r,glTextureType:s}=n.get(e);n.state.bindTexture(s,r),i.generateMipmap(s)}deallocateRenderBuffers(e){let{gl:i,backend:n}=this;if(e){let r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(let e in r.framebuffers)i.deleteFramebuffer(r.framebuffers[e]);delete r.framebuffers}if(r.depthRenderbuffer&&(i.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(i.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(i.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let e=0;e<r.msaaRenderbuffers.length;e++)i.deleteRenderbuffer(r.msaaRenderbuffers[e]);delete r.msaaRenderbuffers}}}destroyTexture(e){let{gl:i,backend:n}=this,{textureGPU:r,renderTarget:s}=n.get(e);this.deallocateRenderBuffers(s),i.deleteTexture(r),n.delete(e)}copyTextureToTexture(e,i,n=null,r=null,s=0){let a,o,l,h,u,c;let{gl:d,backend:p}=this,{state:f}=this.backend,{textureGPU:m,glTextureType:g,glType:A,glFormat:v}=p.get(i);null!==n?(a=n.max.x-n.min.x,o=n.max.y-n.min.y,l=n.min.x,h=n.min.y):(a=e.image.width,o=e.image.height,l=0,h=0),null!==r?(u=r.x,c=r.y):(u=0,c=0),f.bindTexture(g,m),d.pixelStorei(d.UNPACK_ALIGNMENT,i.unpackAlignment),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,i.flipY),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),d.pixelStorei(d.UNPACK_ALIGNMENT,i.unpackAlignment);let y=d.getParameter(d.UNPACK_ROW_LENGTH),x=d.getParameter(d.UNPACK_IMAGE_HEIGHT),_=d.getParameter(d.UNPACK_SKIP_PIXELS),b=d.getParameter(d.UNPACK_SKIP_ROWS),E=d.getParameter(d.UNPACK_SKIP_IMAGES),w=e.isCompressedTexture?e.mipmaps[s]:e.image;if(d.pixelStorei(d.UNPACK_ROW_LENGTH,w.width),d.pixelStorei(d.UNPACK_IMAGE_HEIGHT,w.height),d.pixelStorei(d.UNPACK_SKIP_PIXELS,l),d.pixelStorei(d.UNPACK_SKIP_ROWS,h),e.isRenderTargetTexture||e.isDepthTexture){let n=p.get(e),r=p.get(i),s=p.get(n.renderTarget),m=p.get(r.renderTarget),g=s.framebuffers[n.cacheKey],A=m.framebuffers[r.cacheKey];f.bindFramebuffer(d.READ_FRAMEBUFFER,g),f.bindFramebuffer(d.DRAW_FRAMEBUFFER,A);let v=d.COLOR_BUFFER_BIT;e.isDepthTexture&&(v=d.DEPTH_BUFFER_BIT),d.blitFramebuffer(l,h,a,o,u,c,a,o,v,d.NEAREST),f.bindFramebuffer(d.READ_FRAMEBUFFER,null),f.bindFramebuffer(d.DRAW_FRAMEBUFFER,null)}else e.isDataTexture?d.texSubImage2D(d.TEXTURE_2D,s,u,c,a,o,v,A,w.data):e.isCompressedTexture?d.compressedTexSubImage2D(d.TEXTURE_2D,s,u,c,w.width,w.height,v,w.data):d.texSubImage2D(d.TEXTURE_2D,s,u,c,a,o,v,A,w);d.pixelStorei(d.UNPACK_ROW_LENGTH,y),d.pixelStorei(d.UNPACK_IMAGE_HEIGHT,x),d.pixelStorei(d.UNPACK_SKIP_PIXELS,_),d.pixelStorei(d.UNPACK_SKIP_ROWS,b),d.pixelStorei(d.UNPACK_SKIP_IMAGES,E),0===s&&i.generateMipmaps&&d.generateMipmap(d.TEXTURE_2D),f.unbindTexture()}copyFramebufferToTexture(e,i,n){let{gl:r}=this,{state:s}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:l,z:h,w:u}=n,c=!0===e.isDepthTexture||i.renderTarget&&i.renderTarget.samples>0,d=i.renderTarget?i.renderTarget.height:this.backend.getDrawingBufferSize().y;if(c){let n,c;let p=0!==o||0!==l;if(!0===e.isDepthTexture?(n=r.DEPTH_BUFFER_BIT,c=r.DEPTH_ATTACHMENT,i.stencil&&(n|=r.STENCIL_BUFFER_BIT)):(n=r.COLOR_BUFFER_BIT,c=r.COLOR_ATTACHMENT0),p){let e=this.backend.get(i.renderTarget),c=e.framebuffers[i.getCacheKey()],p=e.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,c),s.bindFramebuffer(r.READ_FRAMEBUFFER,p);let f=d-l-u;r.blitFramebuffer(o,f,o+h,f+u,o,f,o+h,f+u,n,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,c),s.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,f,h,u),s.unbindTexture()}else{let e=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,e),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,c,r.TEXTURE_2D,a,0),r.blitFramebuffer(0,0,h,u,0,0,h,u,n,r.NEAREST),r.deleteFramebuffer(e)}}else s.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,d-u-l,h,u),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(i)}setupRenderBufferStorage(e,i){let{gl:n}=this,{samples:r,depthTexture:s,depthBuffer:a,stencilBuffer:o,width:l,height:h}=i.renderTarget;if(n.bindRenderbuffer(n.RENDERBUFFER,e),a&&!o){let i=n.DEPTH_COMPONENT24;r>0?(s&&s.isDepthTexture&&s.type===n.FLOAT&&(i=n.DEPTH_COMPONENT32F),n.renderbufferStorageMultisample(n.RENDERBUFFER,r,i,l,h)):n.renderbufferStorage(n.RENDERBUFFER,i,l,h),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e)}else a&&o&&(r>0?n.renderbufferStorageMultisample(n.RENDERBUFFER,r,n.DEPTH24_STENCIL8,l,h):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,l,h),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e))}async copyTextureToBuffer(e,i,n,r,s,a){let{backend:o,gl:l}=this,{textureGPU:h,glFormat:u,glType:c}=this.backend.get(e),d=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,d);let p=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+a:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,p,h,0);let f=this._getTypedArrayType(c),m=r*s*this._getBytesPerTexel(c,u),g=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,g),l.bufferData(l.PIXEL_PACK_BUFFER,m,l.STREAM_READ),l.readPixels(i,n,r,s,u,c,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();let A=new f(m/f.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,g),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,A),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(d),A}_getTypedArrayType(e){let{gl:i}=this;if(e===i.UNSIGNED_BYTE)return Uint8Array;if(e===i.UNSIGNED_SHORT_4_4_4_4||e===i.UNSIGNED_SHORT_5_5_5_1||e===i.UNSIGNED_SHORT_5_6_5||e===i.UNSIGNED_SHORT)return Uint16Array;if(e===i.UNSIGNED_INT)return Uint32Array;if(e===i.HALF_FLOAT)return Uint16Array;if(e===i.FLOAT)return Float32Array;throw Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,i){let{gl:n}=this,r=0;return(e===n.UNSIGNED_BYTE&&(r=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(r=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(r=4),i===n.RGBA)?4*r:i===n.RGB?3*r:i===n.ALPHA?r:void 0}}class fB{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let i=this.extensions[e];return void 0===i&&(i=this.gl.getExtension(e),this.extensions[e]=i),i}has(e){return this.availableExtensions.includes(e)}}class fL{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;let e=this.backend.gl,i=this.backend.extensions;if(!0===i.has("EXT_texture_filter_anisotropic")){let n=i.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}let fP={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class fD{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,i){let{gl:n,mode:r,object:s,type:a,info:o,index:l}=this;0!==l?n.drawElements(r,i,a,e):n.drawArrays(r,e,i),o.update(s,i,r,1)}renderInstances(e,i,n){let{gl:r,mode:s,type:a,index:o,object:l,info:h}=this;0!==n&&(0!==o?r.drawElementsInstanced(s,i,a,e,n):r.drawArraysInstanced(s,e,i,n),h.update(l,i,s,n))}renderMultiDraw(e,i,n){let{extensions:r,mode:s,object:a,info:o}=this;if(0===n)return;let l=r.get("WEBGL_multi_draw");if(null===l)for(let r=0;r<n;r++)this.render(e[r],i[r]);else{0!==this.index?l.multiDrawElementsWEBGL(s,i,0,this.type,e,0,n):l.multiDrawArraysWEBGL(s,e,0,i,0,n);let r=0;for(let e=0;e<n;e++)r+=i[e];o.update(a,r,s,1)}}renderMultiDrawInstances(e,i,n,r){let{extensions:s,mode:a,object:o,info:l}=this;if(0===n)return;let h=s.get("WEBGL_multi_draw");if(null===h)for(let s=0;s<n;s++)this.renderInstances(e[s],i[s],r[s]);else{0!==this.index?h.multiDrawElementsInstancedWEBGL(a,i,0,this.type,e,0,r,0,n):h.multiDrawArraysInstancedWEBGL(a,e,0,i,0,r,0,n);let s=0;for(let e=0;e<n;e++)s+=i[e]*r[e];l.update(o,s,a,1)}}}class fN extends fA{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this.trackTimestamp=!0===e.trackTimestamp,this._currentContext=null,this._knownBindings=new WeakSet}init(e){super.init(e);let i=this.parameters,n=void 0!==i.context?i.context:e.domElement.getContext("webgl2");function r(i){i.preventDefault();let n={api:"WebGL",message:i.statusMessage||"Unknown reason",reason:null,originalEvent:i};e.onDeviceLost(n)}this._onContextLost=r,e.domElement.addEventListener("webglcontextlost",r,!1),this.gl=n,this.extensions=new fB(this),this.capabilities=new fL(this),this.attributeUtils=new fx(this),this.textureUtils=new fI(this),this.bufferRenderer=new fD(this),this.state=new fw(this),this.utils=new fM(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return eE._RZ}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;let i=this.get(e);if(this.queryRunning){i.queryQueue||(i.queryQueue=[]),i.queryQueue.push(e);return}i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.activeQuery=null),i.activeQuery=this.gl.createQuery(),null!==i.activeQuery&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,i.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;let i=this.get(e);if(i.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),i.gpuQueries||(i.gpuQueries=[]),i.gpuQueries.push({query:i.activeQuery}),i.activeQuery=null,this.queryRunning=!1,i.queryQueue&&i.queryQueue.length>0)){let e=i.queryQueue.shift();this.initTimestampQuery(e)}}async resolveTimestampAsync(e,i="render"){if(!this.disjoint||!this.trackTimestamp)return;let n=this.get(e);n.gpuQueries||(n.gpuQueries=[]);for(let e=0;e<n.gpuQueries.length;e++){let r=n.gpuQueries[e],s=this.gl.getQueryParameter(r.query,this.gl.QUERY_RESULT_AVAILABLE),a=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(s&&!a){let s=Number(this.gl.getQueryParameter(r.query,this.gl.QUERY_RESULT))/1e6;this.gl.deleteQuery(r.query),n.gpuQueries.splice(e,1),e--,this.renderer.info.updateTimestamp(i,s)}}}getContext(){return this.gl}beginRender(e){let{gl:i}=this,n=this.get(e);if(this.initTimestampQuery(e),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1),e.viewport?this.updateViewport(e):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),e.scissor){let{x:n,y:r,width:s,height:a}=e.scissorValue;i.scissor(n,e.height-a-r,s,a)}let r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=Array(r),n.occlusionQueryObjects=Array(r),n.occlusionQueryIndex=0)}finishRender(e){let{gl:i,state:n}=this,r=this.get(e),s=r.previousContext,a=e.occlusionQueryCount;a>0&&(a>r.occlusionQueryIndex&&i.endQuery(i.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));let o=e.textures;if(null!==o)for(let e=0;e<o.length;e++){let i=o[e];i.generateMipmaps&&this.generateMipmaps(i)}if(this._currentContext=s,null!==e.textures&&e.renderTarget){let r=this.get(e.renderTarget),{samples:s}=e.renderTarget;if(s>0){let s=r.framebuffers[e.getCacheKey()],a=i.COLOR_BUFFER_BIT,o=r.msaaFrameBuffer,l=e.textures;n.bindFramebuffer(i.READ_FRAMEBUFFER,o),n.bindFramebuffer(i.DRAW_FRAMEBUFFER,s);for(let n=0;n<l.length;n++)if(e.scissor){let{x:n,y:s,width:o,height:l}=e.scissorValue,h=e.height-l-s;i.blitFramebuffer(n,h,n+o,h+l,n,h,n+o,h+l,a,i.NEAREST),i.invalidateSubFramebuffer(i.READ_FRAMEBUFFER,r.invalidationArray,n,h,o,l)}else i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a,i.NEAREST),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,r.invalidationArray)}}null!==s&&(this._setFramebuffer(s),s.viewport?this.updateViewport(s):i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){let i=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=i;if(n&&r){let e=new WeakSet,{gl:s}=this;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueries=null;let a=()=>{let o=0;for(let i=0;i<n.length;i++){let a=n[i];null!==a&&s.getQueryParameter(a,s.QUERY_RESULT_AVAILABLE)&&(s.getQueryParameter(a,s.QUERY_RESULT)>0&&e.add(r[i]),n[i]=null,s.deleteQuery(a),o++)}o<n.length?requestAnimationFrame(a):i.occluded=e};a()}}isOccluded(e,i){let n=this.get(e);return n.occluded&&n.occluded.has(i)}updateViewport(e){let i=this.gl,{x:n,y:r,width:s,height:a}=e.viewportValue;i.viewport(n,e.height-a-r,s,a)}setScissorTest(e){let i=this.gl;e?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST)}clear(e,i,n,r=null,s=!0){let{gl:a}=this;if(null===r){let e=this.getClearColor();e.r*=e.a,e.g*=e.a,e.b*=e.a,r={textures:null,clearColorValue:e}}let o=0;if(e&&(o|=a.COLOR_BUFFER_BIT),i&&(o|=a.DEPTH_BUFFER_BIT),n&&(o|=a.STENCIL_BUFFER_BIT),0!==o){let l;if(r.clearColorValue?l=r.clearColorValue:(l=this.getClearColor(),l.r*=l.a,l.g*=l.a,l.b*=l.a),i&&this.state.setDepthMask(!0),null===r.textures)a.clearColor(l.r,l.g,l.b,l.a),a.clear(o);else{if(s&&this._setFramebuffer(r),e)for(let e=0;e<r.textures.length;e++)a.clearBufferfv(a.COLOR,e,[l.r,l.g,l.b,l.a]);i&&n?a.clearBufferfi(a.DEPTH_STENCIL,0,1,0):i?a.clearBufferfv(a.DEPTH,0,[1]):n&&a.clearBufferiv(a.STENCIL,0,[0])}}}beginCompute(e){let{state:i,gl:n}=this;i.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,i,n,r){let{state:s,gl:a}=this;!1===this.discard&&(a.enable(a.RASTERIZER_DISCARD),this.discard=!0);let{programGPU:o,transformBuffers:l,attributes:h}=this.get(r),u=this._getVaoKey(null,h),c=this.vaoCache[u];void 0===c?this._createVao(null,h):a.bindVertexArray(c),s.useProgram(o),this._bindUniforms(n);let d=this._getTransformFeedback(l);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,d),a.beginTransformFeedback(a.POINTS),h[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,i.count):a.drawArrays(a.POINTS,0,i.count),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let e=0;e<l.length;e++){let i=l[e];i.pbo&&this.textureUtils.copyBufferToTexture(i.transformBuffer,i.pbo),i.switchBuffers()}}finishCompute(e){let i=this.gl;this.discard=!1,i.disable(i.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){let{object:i,pipeline:n,material:r,context:s,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(n),{gl:l,state:h}=this,u=this.get(s),c=e.getDrawParameters();if(null===c)return;this._bindUniforms(e.getBindings());let d=i.isMesh&&0>i.matrixWorld.determinant();h.setMaterial(r,d,a),h.useProgram(o);let p=this.get(e),f=p.staticVao;if(void 0===f||p.geometryId!==e.geometry.id){let i=this._getVaoKey(e.getIndex(),e.getAttributes());if(void 0===(f=this.vaoCache[i])){let i;({vaoGPU:f,staticVao:i}=this._createVao(e.getIndex(),e.getAttributes())),i&&(p.staticVao=f,p.geometryId=e.geometry.id)}}l.bindVertexArray(f);let m=e.getIndex(),g=u.lastOcclusionObject;if(g!==i&&void 0!==g){if(null!==g&&!0===g.occlusionTest&&(l.endQuery(l.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),!0===i.occlusionTest){let e=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,e),u.occlusionQueries[u.occlusionQueryIndex]=e,u.occlusionQueryObjects[u.occlusionQueryIndex]=i}u.lastOcclusionObject=i}let A=this.bufferRenderer;i.isPoints?A.mode=l.POINTS:i.isLineSegments?A.mode=l.LINES:i.isLine?A.mode=l.LINE_STRIP:i.isLineLoop?A.mode=l.LINE_LOOP:!0===r.wireframe?(h.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),A.mode=l.LINES):A.mode=l.TRIANGLES;let{vertexCount:v,instanceCount:y}=c,{firstVertex:x}=c;if(A.object=i,null!==m){x*=m.array.BYTES_PER_ELEMENT;let e=this.get(m);A.index=m.count,A.type=e.type}else A.index=0;i.isBatchedMesh?null!==i._multiDrawInstances?A.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?A.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount):(0,eE.O4K)("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):y>1?A.renderInstances(x,v,y):A.render(x,v),l.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,n,r,s,a){return this.textureUtils.copyTextureToBuffer(e,i,n,r,s,a)}createSampler(){}destroySampler(){}createNodeBuilder(e,i){return new ff(e,i)}createProgram(e){let i=this.gl,{stage:n,code:r}=e,s="fragment"===n?i.createShader(i.FRAGMENT_SHADER):i.createShader(i.VERTEX_SHADER);i.shaderSource(s,r),i.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,i){let n=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:a}=r,o=n.createProgram(),l=this.get(s).shaderGPU,h=this.get(a).shaderGPU;if(n.attachShader(o,l),n.attachShader(o,h),n.linkProgram(o),this.set(r,{programGPU:o,fragmentShader:l,vertexShader:h}),null!==i&&this.parallel){let s=new Promise(i=>{let s=this.parallel,a=()=>{n.getProgramParameter(o,s.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),i()):requestAnimationFrame(a)};a()});i.push(s);return}this._completeCompile(e,r)}_handleSource(e,i){let n=e.split("\n"),r=[],s=Math.max(i-6,0),a=Math.min(i+6,n.length);for(let e=s;e<a;e++){let s=e+1;r.push(`${s===i?">":" "} ${s}: ${n[e]}`)}return r.join("\n")}_getShaderErrors(e,i,n){let r=e.getShaderParameter(i,e.COMPILE_STATUS),s=e.getShaderInfoLog(i).trim();if(r&&""===s)return"";let a=/ERROR: 0:(\d+)/.exec(s);if(!a)return s;{let r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+s+"\n\n"+this._handleSource(e.getShaderSource(i),r)}}_logProgramError(e,i,n){if(this.renderer.debug.checkShaderErrors){let r=this.gl,s=r.getProgramInfoLog(e).trim();if(!1===r.getProgramParameter(e,r.LINK_STATUS)){if("function"==typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(r,e,n,i);else{let a=this._getShaderErrors(r,n,"vertex"),o=this._getShaderErrors(r,i,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+s+"\n"+a+"\n"+o)}}else""!==s&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,i){let{state:n,gl:r}=this,{programGPU:s,fragmentShader:a,vertexShader:o}=this.get(i);!1===r.getProgramParameter(s,r.LINK_STATUS)&&this._logProgramError(s,a,o),n.useProgram(s);let l=e.getBindings();this._setupBindings(l,s),this.set(i,{programGPU:s})}createComputePipeline(e,i){let{state:n,gl:r}=this,s={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(s);let{computeProgram:a}=e,o=r.createProgram(),l=this.get(s).shaderGPU,h=this.get(a).shaderGPU,u=a.transforms,c=[],d=[];for(let e=0;e<u.length;e++){let i=u[e];c.push(i.varyingName),d.push(i.attributeNode)}r.attachShader(o,l),r.attachShader(o,h),r.transformFeedbackVaryings(o,c,r.SEPARATE_ATTRIBS),r.linkProgram(o),!1===r.getProgramParameter(o,r.LINK_STATUS)&&this._logProgramError(o,l,h),n.useProgram(o),this._setupBindings(i,o);let p=a.attributes,f=[],m=[];for(let e=0;e<p.length;e++){let i=p[e].node.attribute;f.push(i),this.has(i)||this.attributeUtils.createAttribute(i,r.ARRAY_BUFFER)}for(let e=0;e<d.length;e++){let i=d[e].attribute;this.has(i)||this.attributeUtils.createAttribute(i,r.ARRAY_BUFFER);let n=this.get(i);m.push(n)}this.set(e,{programGPU:o,transformBuffers:m,attributes:f})}createBindings(e,i){if(!1===this._knownBindings.has(i)){this._knownBindings.add(i);let e=0,n=0;for(let r of i)for(let i of(this.set(r,{textures:n,uniformBuffers:e}),r.bindings))i.isUniformBuffer&&e++,i.isSampledTexture&&n++}this.updateBindings(e,i)}updateBindings(e){let{gl:i}=this,n=this.get(e),r=n.uniformBuffers,s=n.textures;for(let n of e.bindings)if(n.isUniformsGroup||n.isUniformBuffer){let e=n.buffer,s=i.createBuffer();i.bindBuffer(i.UNIFORM_BUFFER,s),i.bufferData(i.UNIFORM_BUFFER,e,i.DYNAMIC_DRAW),this.set(n,{index:r++,bufferGPU:s})}else if(n.isSampledTexture){let{textureGPU:e,glTextureType:i}=this.get(n.texture);this.set(n,{index:s++,textureGPU:e,glTextureType:i})}}updateBinding(e){let i=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){let n=this.get(e).bufferGPU,r=e.buffer;i.bindBuffer(i.UNIFORM_BUFFER,n),i.bufferData(i.UNIFORM_BUFFER,r,i.DYNAMIC_DRAW)}}createIndexAttribute(e){let i=this.gl;this.attributeUtils.createAttribute(e,i.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;let i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;let i=this.gl;this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){let i=Object.keys(fP).filter(i=>fP[i]===e),n=this.extensions;for(let e=0;e<i.length;e++)if(n.has(i[e]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,i,n=null,r=null,s=0){this.textureUtils.copyTextureToTexture(e,i,n,r,s)}copyFramebufferToTexture(e,i,n){this.textureUtils.copyFramebufferToTexture(e,i,n)}_setFramebuffer(e){let{gl:i,state:n}=this,r=null;if(null!==e.textures){let s;let a=e.renderTarget,o=this.get(a),{samples:l,depthBuffer:h,stencilBuffer:u}=a,c=!0===a.isWebGLCubeRenderTarget,d=!0===a.isRenderTarget3D,p=!0===a.isRenderTargetArray,f=o.msaaFrameBuffer,m=o.depthRenderbuffer,g=cy(e);if(c?(o.cubeFramebuffers||(o.cubeFramebuffers={}),s=o.cubeFramebuffers[g]):(o.framebuffers||(o.framebuffers={}),s=o.framebuffers[g]),void 0===s){s=i.createFramebuffer(),n.bindFramebuffer(i.FRAMEBUFFER,s);let r=e.textures;if(c){o.cubeFramebuffers[g]=s;let{textureGPU:e}=this.get(r[0]),n=this.renderer._activeCubeFace;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+n,e,0)}else{o.framebuffers[g]=s;for(let n=0;n<r.length;n++){let s=r[n],a=this.get(s);a.renderTarget=e.renderTarget,a.cacheKey=g;let o=i.COLOR_ATTACHMENT0+n;if(d||p){let e=this.renderer._activeCubeFace;i.framebufferTextureLayer(i.FRAMEBUFFER,o,a.textureGPU,0,e)}else i.framebufferTexture2D(i.FRAMEBUFFER,o,i.TEXTURE_2D,a.textureGPU,0)}n.drawBuffers(e,s)}if(null!==e.depthTexture){let n=this.get(e.depthTexture),r=u?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;n.renderTarget=e.renderTarget,n.cacheKey=g,i.framebufferTexture2D(i.FRAMEBUFFER,r,i.TEXTURE_2D,n.textureGPU,0)}}if(l>0){if(void 0===f){let r=[];f=i.createFramebuffer(),n.bindFramebuffer(i.FRAMEBUFFER,f);let s=[],a=e.textures;for(let n=0;n<a.length;n++){if(s[n]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,s[n]),r.push(i.COLOR_ATTACHMENT0+n),h){let e=u?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;r.push(e)}let a=e.textures[n],o=this.get(a);i.renderbufferStorageMultisample(i.RENDERBUFFER,l,o.glInternalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+n,i.RENDERBUFFER,s[n])}if(o.msaaFrameBuffer=f,o.msaaRenderbuffers=s,void 0===m){m=i.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,e),o.depthRenderbuffer=m;let n=u?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;r.push(n)}o.invalidationArray=r}r=o.msaaFrameBuffer}else r=s}n.bindFramebuffer(i.FRAMEBUFFER,r)}_getVaoKey(e,i){let n="";null!==e&&(n+=":"+this.get(e).id);for(let e=0;e<i.length;e++)n+=":"+this.get(i[e]).id;return n}_createVao(e,i){let{gl:n}=this,r=n.createVertexArray(),s="",a=!0;if(n.bindVertexArray(r),null!==e){let i=this.get(e);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.bufferGPU),s+=":"+i.id}for(let e=0;e<i.length;e++){let r,o;let l=i[e],h=this.get(l);s+=":"+h.id,n.bindBuffer(n.ARRAY_BUFFER,h.bufferGPU),n.enableVertexAttribArray(e),(l.isStorageBufferAttribute||l.isStorageInstancedBufferAttribute)&&(a=!1),!0===l.isInterleavedBufferAttribute?(r=l.data.stride*h.bytesPerElement,o=l.offset*h.bytesPerElement):(r=0,o=0),h.isInteger?n.vertexAttribIPointer(e,l.itemSize,h.type,r,o):n.vertexAttribPointer(e,l.itemSize,h.type,l.normalized,r,o),l.isInstancedBufferAttribute&&!l.isInterleavedBufferAttribute?n.vertexAttribDivisor(e,l.meshPerAttribute):l.isInterleavedBufferAttribute&&l.data.isInstancedInterleavedBuffer&&n.vertexAttribDivisor(e,l.data.meshPerAttribute)}return n.bindBuffer(n.ARRAY_BUFFER,null),this.vaoCache[s]=r,{vaoGPU:r,staticVao:a}}_getTransformFeedback(e){let i="";for(let n=0;n<e.length;n++)i+=":"+e[n].id;let n=this.transformFeedbackCache[i];if(void 0!==n)return n;let{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let i=0;i<e.length;i++){let n=e[i];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,i,n.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[i]=n,n}_setupBindings(e,i){let n=this.gl;for(let r of e)for(let e of r.bindings){let r=this.get(e).index;if(e.isUniformsGroup||e.isUniformBuffer){let s=n.getUniformBlockIndex(i,e.name);n.uniformBlockBinding(i,s,r)}else if(e.isSampledTexture){let s=n.getUniformLocation(i,e.name);n.uniform1i(s,r)}}}_bindUniforms(e){let{gl:i,state:n}=this;for(let r of e)for(let e of r.bindings){let r=this.get(e),s=r.index;e.isUniformsGroup||e.isUniformBuffer?n.bindBufferBase(i.UNIFORM_BUFFER,s,r.bufferGPU):e.isSampledTexture&&n.bindTexture(r.glTextureType,r.textureGPU,i.TEXTURE0+s)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}let fO={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},fU={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},fk={Store:"store"},fF={Load:"load",Clear:"clear"},fz={CCW:"ccw"},fG={None:"none",Front:"front",Back:"back"},fV={Uint16:"uint16",Uint32:"uint32"},fj={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},fH={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},fQ={Linear:"linear",Nearest:"nearest"},fW={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},fq={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},fX={None:0,All:15},fK={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},fY={Storage:"storage",ReadOnlyStorage:"read-only-storage"},fJ={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},fZ={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},f$={TwoD:"2d",ThreeD:"3d"},f0={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},f1={All:"all"},f2={Vertex:"vertex",Instance:"instance"},f3={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class f4 extends p8{constructor(e,i){super(e),this.texture=i,this.version=i?i.version:0,this.isSampler=!0}}class f5 extends f4{constructor(e,i,n){super(e,i?i.value:null),this.textureNode=i,this.groupNode=n}update(){this.texture=this.textureNode.value}}class f6 extends p7{constructor(e,i){super(e,i?i.array:null),this.attribute=i,this.isStorageBuffer=!0}}let f8=0;class f7 extends f6{constructor(e,i){super("StorageBuffer_"+f8++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:nc.READ_WRITE,this.groupNode=i}get buffer(){return this.nodeUniform.value}}class f9 extends u7{constructor(e){super(),this.device=e;let i=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:fQ.Linear}),this.flipYSampler=e.createSampler({minFilter:fQ.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:i}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let i=this.transferPipelines[e];return void 0===i&&(i=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:fO.TriangleStrip,stripIndexFormat:fV.Uint32},layout:"auto"}),this.transferPipelines[e]=i),i}getFlipYPipeline(e){let i=this.flipYPipelines[e];return void 0===i&&(i=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:fO.TriangleStrip,stripIndexFormat:fV.Uint32},layout:"auto"}),this.flipYPipelines[e]=i),i}flipY(e,i,n=0){let r=i.format,{width:s,height:a}=i.size,o=this.getTransferPipeline(r),l=this.getFlipYPipeline(r),h=this.device.createTexture({size:{width:s,height:a,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:f0.TwoD,baseArrayLayer:n}),c=h.createView({baseMipLevel:0,mipLevelCount:1,dimension:f0.TwoD,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),p=(e,i,n)=>{let r=e.getBindGroupLayout(0),s=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:i}]}),a=d.beginRenderPass({colorAttachments:[{view:n,loadOp:fF.Clear,storeOp:fk.Store,clearValue:[0,0,0,0]}]});a.setPipeline(e),a.setBindGroup(0,s),a.draw(4,1,0,0),a.end()};p(o,u,c),p(l,c,u),this.device.queue.submit([d.finish()]),h.destroy()}generateMipmaps(e,i,n=0){let r=this.get(e);void 0===r.useCount&&(r.useCount=0,r.layers=[]);let s=r.layers[n]||this._mipmapCreateBundles(e,i,n),a=this.device.createCommandEncoder({});this._mipmapRunBundles(a,s),this.device.queue.submit([a.finish()]),0!==r.useCount&&(r.layers[n]=s),r.useCount++}_mipmapCreateBundles(e,i,n){let r=this.getTransferPipeline(i.format),s=r.getBindGroupLayout(0),a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:f0.TwoD,baseArrayLayer:n}),o=[];for(let l=1;l<i.mipLevelCount;l++){let h=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),u=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:f0.TwoD,baseArrayLayer:n}),c={colorAttachments:[{view:u,loadOp:fF.Clear,storeOp:fk.Store,clearValue:[0,0,0,0]}]},d=this.device.createRenderBundleEncoder({colorFormats:[i.format]});d.setPipeline(r),d.setBindGroup(0,h),d.draw(4,1,0,0),o.push({renderBundles:[d.finish()],passDescriptor:c}),a=u}return o}_mipmapRunBundles(e,i){let n=i.length;for(let r=0;r<n;r++){let n=i[r],s=e.beginRenderPass(n.passDescriptor);s.executeBundles(n.renderBundles),s.end()}}}let me={[eE.xoQ]:"never",[eE.D67]:"less",[eE.F1y]:"equal",[eE.M$G]:"less-equal",[eE.Zen]:"greater",[eE.Jjb]:"greater-equal",[eE.T6w]:"always",[eE.O78]:"not-equal"},mt=[0,1,3,2,4,5];class mi{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new eE.$YQ,this.depthTexture.name="depthBuffer"}createSampler(e){let i=this.backend,n=i.device,r=i.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===fQ.Linear&&s.minFilter===fQ.Linear&&s.mipmapFilter===fQ.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&null!==e.compareFunction&&(s.compare=me[e.compareFunction]),r.sampler=n.createSampler(s)}createDefaultTexture(e){let i;let n=mn(e);e.isCubeTexture?i=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():i=this._getDefaultTextureGPU(n),this.backend.get(e).texture=i}createTexture(e,i={}){let n=this.backend,r=n.get(e);if(r.initialized)throw Error("WebGPUTextureUtils: Texture already initialized.");void 0===i.needsMipmaps&&(i.needsMipmaps=!1),void 0===i.levels&&(i.levels=1),void 0===i.depth&&(i.depth=1);let{width:s,height:a,depth:o,levels:l}=i;e.isFramebufferTexture&&(i.renderTarget?i.format=this.backend.utils.getCurrentColorFormat(i.renderTarget):i.format=this.backend.utils.getPreferredCanvasFormat());let h=this._getDimension(e),u=e.internalFormat||i.format||mn(e,n.device);r.format=u;let{samples:c,primarySamples:d,isMSAA:p}=n.utils.getTextureSampleData(e),f=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===e.isStorageTexture&&(f|=GPUTextureUsage.STORAGE_BINDING),!0!==e.isCompressedTexture&&!0!==e.isCompressedArrayTexture&&(f|=GPUTextureUsage.RENDER_ATTACHMENT);let m={label:e.name,size:{width:s,height:a,depthOrArrayLayers:o},mipLevelCount:l,sampleCount:d,dimension:h,format:u,usage:f};if(e.isVideoTexture){let i=e.source.data,n=new VideoFrame(i);m.size.width=n.displayWidth,m.size.height=n.displayHeight,n.close(),r.externalTexture=i}else{if(void 0===u)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);r.texture=n.device.createTexture(m)}if(p){let e=Object.assign({},m);e.label=e.label+"-msaa",e.sampleCount=c,r.msaaTexture=n.device.createTexture(e)}r.initialized=!0,r.textureDescriptorGPU=m}destroyTexture(e){let i=this.backend,n=i.get(e);void 0!==n.texture&&n.texture.destroy(),void 0!==n.msaaTexture&&n.msaaTexture.destroy(),i.delete(e)}destroySampler(e){let i=this.backend.get(e);delete i.sampler}generateMipmaps(e){let i=this.backend.get(e);if(e.isCubeTexture)for(let e=0;e<6;e++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,e);else{let n=e.image.depth||1;for(let e=0;e<n;e++)this._generateMipmaps(i.texture,i.textureDescriptorGPU,e)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();let e=this.backend,{width:i,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:i,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,i=!1){let n,r;let s=this.backend,{width:a,height:o}=s.getDrawingBufferSize(),l=this.depthTexture,h=s.get(l).texture;if(i?(n=eE.brP,r=eE.wJv):e&&(n=eE.qkB,r=eE.JQ4),void 0!==h){if(l.image.width===a&&l.image.height===o&&l.format===n&&l.type===r)return h;this.destroyTexture(l)}return l.name="depthBuffer",l.format=n,l.type=r,l.image.width=a,l.image.height=o,this.createTexture(l,{width:a,height:o}),s.get(l).texture}updateTexture(e,i){let n=this.backend.get(e),{textureDescriptorGPU:r}=n;if(!e.isRenderTargetTexture&&void 0!==r){if(e.isDataTexture)this._copyBufferToTexture(i.image,n.texture,r,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<i.image.depth;s++)this._copyBufferToTexture(i.image,n.texture,r,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(i.images,n.texture,r,e.flipY);else if(e.isVideoTexture){let i=e.source.data;n.externalTexture=i}else this._copyImageToTexture(i.image,n.texture,r,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,i,n,r,s,a){let o=this.backend.device,l=this.backend.get(e),h=l.texture,u=l.textureDescriptorGPU.format,c=this._getBytesPerTexel(u),d=r*c;d=256*Math.ceil(d/256);let p=o.createBuffer({size:r*s*c,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),f=o.createCommandEncoder();f.copyTextureToBuffer({texture:h,origin:{x:i,y:n,z:a}},{buffer:p,bytesPerRow:d},{width:r,height:s});let m=this._getTypedArrayType(u);return o.queue.submit([f.finish()]),await p.mapAsync(GPUMapMode.READ),new m(p.getMappedRange())}_isEnvironmentTexture(e){let i=e.mapping;return i===eE.dSO||i===eE.Bf4||i===eE.fY$||i===eE.vxC}_getDefaultTextureGPU(e){let i=this.defaultTexture[e];if(void 0===i){let n=new eE.xEZ;n.minFilter=eE.TyD,n.magFilter=eE.TyD,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=i=n}return this.backend.get(i).texture}_getDefaultCubeTextureGPU(e){let i=this.defaultTexture[e];if(void 0===i){let n=new eE.BtG;n.minFilter=eE.TyD,n.magFilter=eE.TyD,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=i=n}return this.backend.get(i).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;return null===e&&(this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),{timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"})),e}_copyCubeMapToTexture(e,i,n,r){for(let s=0;s<6;s++){let a=e[s],o=!0===r?mt[s]:s;a.isDataTexture?this._copyBufferToTexture(a.image,i,n,o,r):this._copyImageToTexture(a,i,n,o,r)}}_copyImageToTexture(e,i,n,r,s){this.backend.device.queue.copyExternalImageToTexture({source:e},{texture:i,mipLevel:0,origin:{x:0,y:0,z:r}},{width:e.width,height:e.height,depthOrArrayLayers:1}),!0===s&&this._flipY(i,n,r)}_getPassUtils(){let e=this._passUtils;return null===e&&(this._passUtils=e=new f9(this.backend.device)),e}_generateMipmaps(e,i,n=0){this._getPassUtils().generateMipmaps(e,i,n)}_flipY(e,i,n=0){this._getPassUtils().flipY(e,i,n)}_copyBufferToTexture(e,i,n,r,s,a=0){let o=this.backend.device,l=e.data,h=this._getBytesPerTexel(n.format),u=e.width*h;o.queue.writeTexture({texture:i,mipLevel:0,origin:{x:0,y:0,z:r}},l,{offset:e.width*e.height*h*a,bytesPerRow:u},{width:e.width,height:e.height,depthOrArrayLayers:1}),!0===s&&this._flipY(i,n,r)}_copyCompressedBufferToTexture(e,i,n){let r=this.backend.device,s=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){let l=e[o],h=l.width,u=l.height,c=a?n.size.depthOrArrayLayers:1,d=Math.ceil(h/s.width)*s.byteLength,p=d*Math.ceil(u/s.height);for(let e=0;e<c;e++)r.queue.writeTexture({texture:i,mipLevel:o,origin:{x:0,y:0,z:e}},l.data,{offset:e*p,bytesPerRow:d,rowsPerImage:Math.ceil(u/s.height)},{width:Math.ceil(h/s.width)*s.width,height:Math.ceil(u/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){return e===fj.BC1RGBAUnorm||e===fj.BC1RGBAUnormSRGB?{byteLength:8,width:4,height:4}:e===fj.BC2RGBAUnorm||e===fj.BC2RGBAUnormSRGB||e===fj.BC3RGBAUnorm||e===fj.BC3RGBAUnormSRGB?{byteLength:16,width:4,height:4}:e===fj.BC4RUnorm||e===fj.BC4RSNorm?{byteLength:8,width:4,height:4}:e===fj.BC5RGUnorm||e===fj.BC5RGSnorm||e===fj.BC6HRGBUFloat||e===fj.BC6HRGBFloat||e===fj.BC7RGBAUnorm||e===fj.BC7RGBAUnormSRGB?{byteLength:16,width:4,height:4}:e===fj.ETC2RGB8Unorm||e===fj.ETC2RGB8UnormSRGB||e===fj.ETC2RGB8A1Unorm||e===fj.ETC2RGB8A1UnormSRGB?{byteLength:8,width:4,height:4}:e===fj.ETC2RGBA8Unorm||e===fj.ETC2RGBA8UnormSRGB?{byteLength:16,width:4,height:4}:e===fj.EACR11Unorm||e===fj.EACR11Snorm?{byteLength:8,width:4,height:4}:e===fj.EACRG11Unorm||e===fj.EACRG11Snorm||e===fj.ASTC4x4Unorm||e===fj.ASTC4x4UnormSRGB?{byteLength:16,width:4,height:4}:e===fj.ASTC5x4Unorm||e===fj.ASTC5x4UnormSRGB?{byteLength:16,width:5,height:4}:e===fj.ASTC5x5Unorm||e===fj.ASTC5x5UnormSRGB?{byteLength:16,width:5,height:5}:e===fj.ASTC6x5Unorm||e===fj.ASTC6x5UnormSRGB?{byteLength:16,width:6,height:5}:e===fj.ASTC6x6Unorm||e===fj.ASTC6x6UnormSRGB?{byteLength:16,width:6,height:6}:e===fj.ASTC8x5Unorm||e===fj.ASTC8x5UnormSRGB?{byteLength:16,width:8,height:5}:e===fj.ASTC8x6Unorm||e===fj.ASTC8x6UnormSRGB?{byteLength:16,width:8,height:6}:e===fj.ASTC8x8Unorm||e===fj.ASTC8x8UnormSRGB?{byteLength:16,width:8,height:8}:e===fj.ASTC10x5Unorm||e===fj.ASTC10x5UnormSRGB?{byteLength:16,width:10,height:5}:e===fj.ASTC10x6Unorm||e===fj.ASTC10x6UnormSRGB?{byteLength:16,width:10,height:6}:e===fj.ASTC10x8Unorm||e===fj.ASTC10x8UnormSRGB?{byteLength:16,width:10,height:8}:e===fj.ASTC10x10Unorm||e===fj.ASTC10x10UnormSRGB?{byteLength:16,width:10,height:10}:e===fj.ASTC12x10Unorm||e===fj.ASTC12x10UnormSRGB?{byteLength:16,width:12,height:10}:e===fj.ASTC12x12Unorm||e===fj.ASTC12x12UnormSRGB?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(e){let i=fH.ClampToEdge;return e===eE.rpg?i=fH.Repeat:e===eE.OoA&&(i=fH.MirrorRepeat),i}_convertFilterMode(e){let i=fQ.Linear;return(e===eE.TyD||e===eE.YLQ||e===eE.aH4)&&(i=fQ.Nearest),i}_getBytesPerTexel(e){return e===fj.R8Unorm||e===fj.R8Snorm||e===fj.R8Uint||e===fj.R8Sint?1:e===fj.R16Uint||e===fj.R16Sint||e===fj.R16Float||e===fj.RG8Unorm||e===fj.RG8Snorm||e===fj.RG8Uint||e===fj.RG8Sint?2:e===fj.R32Uint||e===fj.R32Sint||e===fj.R32Float||e===fj.RG16Uint||e===fj.RG16Sint||e===fj.RG16Float||e===fj.RGBA8Unorm||e===fj.RGBA8UnormSRGB||e===fj.RGBA8Snorm||e===fj.RGBA8Uint||e===fj.RGBA8Sint||e===fj.BGRA8Unorm||e===fj.BGRA8UnormSRGB||e===fj.RGB9E5UFloat||e===fj.RGB10A2Unorm||e===fj.RG11B10UFloat||e===fj.Depth32Float||e===fj.Depth24Plus||e===fj.Depth24PlusStencil8||e===fj.Depth32FloatStencil8?4:e===fj.RG32Uint||e===fj.RG32Sint||e===fj.RG32Float||e===fj.RGBA16Uint||e===fj.RGBA16Sint||e===fj.RGBA16Float?8:e===fj.RGBA32Uint||e===fj.RGBA32Sint||e===fj.RGBA32Float?16:void 0}_getTypedArrayType(e){return e===fj.R8Uint?Uint8Array:e===fj.R8Sint?Int8Array:e===fj.R8Unorm?Uint8Array:e===fj.R8Snorm?Int8Array:e===fj.RG8Uint?Uint8Array:e===fj.RG8Sint?Int8Array:e===fj.RG8Unorm?Uint8Array:e===fj.RG8Snorm?Int8Array:e===fj.RGBA8Uint?Uint8Array:e===fj.RGBA8Sint?Int8Array:e===fj.RGBA8Unorm?Uint8Array:e===fj.RGBA8Snorm?Int8Array:e===fj.R16Uint?Uint16Array:e===fj.R16Sint?Int16Array:e===fj.RG16Uint?Uint16Array:e===fj.RG16Sint?Int16Array:e===fj.RGBA16Uint?Uint16Array:e===fj.RGBA16Sint?Int16Array:e===fj.R16Float||e===fj.RG16Float||e===fj.RGBA16Float?Uint16Array:e===fj.R32Uint?Uint32Array:e===fj.R32Sint?Int32Array:e===fj.R32Float?Float32Array:e===fj.RG32Uint?Uint32Array:e===fj.RG32Sint?Int32Array:e===fj.RG32Float?Float32Array:e===fj.RGBA32Uint?Uint32Array:e===fj.RGBA32Sint?Int32Array:e===fj.RGBA32Float?Float32Array:e===fj.BGRA8Unorm||e===fj.BGRA8UnormSRGB?Uint8Array:e===fj.RGB10A2Unorm||e===fj.RGB9E5UFloat||e===fj.RG11B10UFloat?Uint32Array:e===fj.Depth32Float?Float32Array:e===fj.Depth24Plus||e===fj.Depth24PlusStencil8?Uint32Array:e===fj.Depth32FloatStencil8?Float32Array:void 0}_getDimension(e){let i;return e.isData3DTexture?f$.ThreeD:f$.TwoD}}function mn(e,i=null){let n;let r=e.format,s=e.type,a=e.colorSpace;if(!0===e.isCompressedTexture||!0===e.isCompressedArrayTexture)switch(r){case eE.BFQ:n=a===eE.KI_?fj.BC1RGBAUnormSRGB:fj.BC1RGBAUnorm;break;case eE.v3W:n=a===eE.KI_?fj.BC2RGBAUnormSRGB:fj.BC2RGBAUnorm;break;case eE.ILR:n=a===eE.KI_?fj.BC3RGBAUnormSRGB:fj.BC3RGBAUnorm;break;case eE.l0P:n=a===eE.KI_?fj.ETC2RGB8UnormSRGB:fj.ETC2RGB8Unorm;break;case eE.ekQ:n=a===eE.KI_?fj.ETC2RGBA8UnormSRGB:fj.ETC2RGBA8Unorm;break;case eE.ptH:n=a===eE.KI_?fj.ASTC4x4UnormSRGB:fj.ASTC4x4Unorm;break;case eE.jZA:n=a===eE.KI_?fj.ASTC5x4UnormSRGB:fj.ASTC5x4Unorm;break;case eE.y2t:n=a===eE.KI_?fj.ASTC5x5UnormSRGB:fj.ASTC5x5Unorm;break;case eE.gi4:n=a===eE.KI_?fj.ASTC6x5UnormSRGB:fj.ASTC6x5Unorm;break;case eE.Djp:n=a===eE.KI_?fj.ASTC6x6UnormSRGB:fj.ASTC6x6Unorm;break;case eE.BG$:n=a===eE.KI_?fj.ASTC8x5UnormSRGB:fj.ASTC8x5Unorm;break;case eE.NYV:n=a===eE.KI_?fj.ASTC8x6UnormSRGB:fj.ASTC8x6Unorm;break;case eE.xJs:n=a===eE.KI_?fj.ASTC8x8UnormSRGB:fj.ASTC8x8Unorm;break;case eE.pKu:n=a===eE.KI_?fj.ASTC10x5UnormSRGB:fj.ASTC10x5Unorm;break;case eE.GG6:n=a===eE.KI_?fj.ASTC10x6UnormSRGB:fj.ASTC10x6Unorm;break;case eE.Gih:n=a===eE.KI_?fj.ASTC10x8UnormSRGB:fj.ASTC10x8Unorm;break;case eE.FUD:n=a===eE.KI_?fj.ASTC10x10UnormSRGB:fj.ASTC10x10Unorm;break;case eE.iiP:n=a===eE.KI_?fj.ASTC12x10UnormSRGB:fj.ASTC12x10Unorm;break;case eE.SvJ:n=a===eE.KI_?fj.ASTC12x12UnormSRGB:fj.ASTC12x12Unorm;break;case eE.wk1:n=a===eE.KI_?fj.RGBA8UnormSRGB:fj.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",r)}else switch(r){case eE.wk1:switch(s){case eE.T95:n=fj.RGBA8Snorm;break;case eE.iAb:n=fj.RGBA16Sint;break;case eE.LsT:n=fj.RGBA16Uint;break;case eE.JQ4:n=fj.RGBA32Uint;break;case eE.Kz5:n=fj.RGBA32Sint;break;case eE.ywz:n=a===eE.KI_?fj.RGBA8UnormSRGB:fj.RGBA8Unorm;break;case eE.cLu:n=fj.RGBA16Float;break;case eE.VzW:n=fj.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",s)}break;case eE.UCm:s===eE.tQZ?n=fj.RGB9E5UFloat:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",s);break;case eE.hEm:switch(s){case eE.T95:n=fj.R8Snorm;break;case eE.iAb:n=fj.R16Sint;break;case eE.LsT:n=fj.R16Uint;break;case eE.JQ4:n=fj.R32Uint;break;case eE.Kz5:n=fj.R32Sint;break;case eE.ywz:n=fj.R8Unorm;break;case eE.cLu:n=fj.R16Float;break;case eE.VzW:n=fj.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",s)}break;case eE.av9:switch(s){case eE.T95:n=fj.RG8Snorm;break;case eE.iAb:n=fj.RG16Sint;break;case eE.LsT:n=fj.RG16Uint;break;case eE.JQ4:n=fj.RG32Uint;break;case eE.Kz5:n=fj.RG32Sint;break;case eE.ywz:n=fj.RG8Unorm;break;case eE.cLu:n=fj.RG16Float;break;case eE.VzW:n=fj.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",s)}break;case eE.qkB:switch(s){case eE.LsT:n=fj.Depth16Unorm;break;case eE.JQ4:n=fj.Depth24Plus;break;case eE.VzW:n=fj.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",s)}break;case eE.brP:switch(s){case eE.wJv:n=fj.Depth24PlusStencil8;break;case eE.VzW:i&&!1===i.features.has(f3.Depth32FloatStencil8)&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),n=fj.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",s)}break;case eE.D9w:switch(s){case eE.Kz5:n=fj.R32Sint;break;case eE.JQ4:n=fj.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",s)}break;case eE.CtA:switch(s){case eE.Kz5:n=fj.RG32Sint;break;case eE.JQ4:n=fj.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",s)}break;case eE.E2K:switch(s){case eE.Kz5:n=fj.RGBA32Sint;break;case eE.JQ4:n=fj.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",s)}break;default:console.error("WebGPURenderer: Unsupported texture format.",r)}return n}let mr=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,ms=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,ma={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},mo=e=>{let i=(e=e.trim()).match(mr);if(null!==i&&4===i.length){let n=i[2],r=[],s=null;for(;null!==(s=ms.exec(n));)r.push({name:s[1],type:s[2]});let a=[];for(let e=0;e<r.length;e++){let{name:i,type:n}=r[e],s=n;s.startsWith("ptr")?s="pointer":(s.startsWith("texture")&&(s=n.split("<")[0]),s=ma[s]),a.push(new pC(s,i))}let o=e.substring(i[0].length),l=i[3]||"void",h=void 0!==i[1]?i[1]:"";return{type:ma[l]||l,inputs:a,name:h,inputsCode:n,blockCode:o,outputType:l}}throw Error("FunctionNode: Function is not a WGSL code.")};class ml extends pk{constructor(e){let{type:i,inputs:n,name:r,inputsCode:s,blockCode:a,outputType:o}=mo(e);super(i,n,r),this.inputsCode=s,this.blockCode=a,this.outputType=o}getCode(e=this.name){let i="void"!==this.outputType?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${i}`+this.blockCode}}class mh extends pU{parseFunction(e){return new ml(e)}}let mu="undefined"!=typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},mc={[nc.READ_ONLY]:"read",[nc.WRITE_ONLY]:"write",[nc.READ_WRITE]:"read_write"},md={[eE.rpg]:"repeat",[eE.uWy]:"clamp",[eE.OoA]:"mirror"},mp={vertex:mu?mu.VERTEX:1,fragment:mu?mu.FRAGMENT:2,compute:mu?mu.COMPUTE:4},mf={instance:!0,swizzleAssign:!1,storageBuffer:!0},mm={"^^":"tsl_xor"},mg={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},mA={},mv={tsl_xor:new c$("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new c$("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new c$("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new c$("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new c$("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new c$("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new c$("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new c$("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new c$("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new c$("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new c$("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new c$("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new c$(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},my={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};"undefined"!=typeof navigator&&/Windows/g.test(navigator.userAgent)&&(mv.pow_float=new c$("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),mv.pow_vec2=new c$("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[mv.pow_float]),mv.pow_vec3=new c$("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[mv.pow_float]),mv.pow_vec4=new c$("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[mv.pow_float]),my.pow_float="tsl_pow_float",my.pow_vec2="tsl_pow_vec2",my.pow_vec3="tsl_pow_vec3",my.pow_vec4="tsl_pow_vec4");let mx="";!0!==("undefined"!=typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent))&&(mx+="diagnostic( off, derivative_uniformity );\n");class m_ extends pw{constructor(e,i){super(e,i,new mh),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==eE.aCh}_generateTextureSample(e,i,n,r,s=this.shaderStage){return"fragment"===s?r?`textureSample( ${i}, ${i}_sampler, ${n}, ${r} )`:`textureSample( ${i}, ${i}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,i,n):this.generateTextureLod(e,i,n,r,"0")}_generateVideoSample(e,i,n=this.shaderStage){if("fragment"===n)return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${i}.x, 1.0 - ${i}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,i,n,r,s,a=this.shaderStage){return("fragment"===a||"compute"===a)&&!1===this.isUnfilterable(e)?`textureSampleLevel( ${i}, ${i}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,i,n,r):this.generateTextureLod(e,i,n,s,r)}generateWrapFunction(e){let i=`tsl_coord_${md[e.wrapS]}S_${md[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`,n=mA[i];if(void 0===n){let r=[],s=e.isData3DTexture?"vec3f":"vec2f",a=`fn ${i}( coord : ${s} ) -> ${s} {

	return ${s}(
`,o=(e,i)=>{e===eE.rpg?(r.push(mv.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${i} )`):e===eE.uWy?(r.push(mv.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${i} )`):e===eE.OoA?(r.push(mv.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${i} )`):(a+=`		coord.${i}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${e}" for vertex shader.`))};o(e.wrapS,"x"),a+=",\n",o(e.wrapT,"y"),e.isData3DTexture&&(a+=",\n",o(e.wrapR,"z")),a+="\n	);\n\n}\n",mA[i]=n=new c$(a,r)}return n.build(this),i}generateTextureDimension(e,i,n){let r=this.getDataFromNode(e,this.shaderStage,this.globalCache);void 0===r.dimensionsSnippet&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[n];if(void 0===r.dimensionsSnippet[n]){let a,o;let{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e);o=e.isData3DTexture?"vec3<u32>":"vec2<u32>",a=l>1||e.isVideoTexture||e.isStorageTexture?i:`${i}${n?`, u32( ${n} )`:""}`,s=new au(new aU(`textureDimensions( ${a} )`,o)),r.dimensionsSnippet[n]=s,(e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new au(new aU(`textureNumLayers(${i})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new au(new aU("6u","u32")))}return s.build(this)}generateFilteredTexture(e,i,n,r="0u"){this._include("biquadraticTexture");let s=this.generateWrapFunction(e),a=this.generateTextureDimension(e,i,r);return`tsl_biquadraticTexture( ${i}, ${s}( ${n} ), ${a}, u32( ${r} ) )`}generateTextureLod(e,i,n,r,s="0u"){let a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,i,s),l=e.isData3DTexture?"vec3":"vec2",h=`${l}<u32>(${a}(${n}) * ${l}<f32>(${o}))`;return this.generateTextureLoad(e,i,h,r,s)}generateTextureLoad(e,i,n,r,s="0u"){return!0===e.isVideoTexture||!0===e.isStorageTexture?`textureLoad( ${i}, ${n} )`:r?`textureLoad( ${i}, ${n}, ${r}, u32( ${s} ) )`:`textureLoad( ${i}, ${n}, u32( ${s} ) )`}generateTextureStore(e,i,n,r){return`textureStore( ${i}, ${n}, ${r} )`}isSampleCompare(e){return!0===e.isDepthTexture&&null!==e.compareFunction}isUnfilterable(e){return"float"!==this.getComponentTypeFromTexture(e)||!this.isAvailable("float32Filterable")&&!0===e.isDataTexture&&e.type===eE.VzW||!1===this.isSampleCompare(e)&&e.minFilter===eE.TyD&&e.magFilter===eE.TyD||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,i,n,r,s=this.shaderStage){let a=null;return!0===e.isVideoTexture?this._generateVideoSample(i,n,s):this.isUnfilterable(e)?this.generateTextureLod(e,i,n,r,"0",s):this._generateTextureSample(e,i,n,r,s)}generateTextureGrad(e,i,n,r,s,a=this.shaderStage){if("fragment"===a)return`textureSampleGrad( ${i}, ${i}_sampler, ${n},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,i,n,r,s,a=this.shaderStage){if("fragment"===a)return`textureSampleCompare( ${i}, ${i}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,i,n,r,s,a=this.shaderStage){let o=null;return!0===e.isVideoTexture?this._generateVideoSample(i,n,a):this._generateTextureSampleLevel(e,i,n,r,s,a)}generateTextureBias(e,i,n,r,s,a=this.shaderStage){if("fragment"===a)return`textureSampleBias( ${i}, ${i}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,i=this.shaderStage){if(!0===e.isNodeVarying&&!0===e.needsInterpolation){if("vertex"===i)return`varyings.${e.name}`}else if(!0===e.isNodeUniform){let i=e.name,n=e.type;return"texture"===n||"cubeTexture"===n||"storageTexture"===n||"texture3D"===n?i:"buffer"===n||"storageBuffer"===n||"indirectStorageBuffer"===n?`NodeBuffer_${e.id}.${i}`:e.groupNode.name+"."+i}return super.getPropertyName(e)}getOutputStructName(){return"output"}_getUniformGroupCount(e){return Object.keys(this.uniforms[e]).length}getFunctionOperator(e){let i=mm[e];return void 0!==i?(this._include(i),i):null}getNodeAccess(e,i){return"compute"!==i?nc.READ_ONLY:e.access}getStorageAccess(e,i){return mc[this.getNodeAccess(e,i)]}getUniformFromNode(e,i,n,r=null){let s=super.getUniformFromNode(e,i,n,r),a=this.getDataFromNode(e,n,this.globalCache);if(void 0===a.uniformGPU){let r;let o=e.groupNode,l=o.name,h=this.getBindGroupArray(l,n);if("texture"===i||"cubeTexture"===i||"storageTexture"===i||"texture3D"===i){let a=null,l=this.getNodeAccess(e,n);if("texture"===i||"storageTexture"===i?a=new fo(s.name,s.node,o,l):"cubeTexture"===i?a=new fl(s.name,s.node,o,l):"texture3D"===i&&(a=new fh(s.name,s.node,o,l)),a.store=!0===e.isStorageTextureNode,a.setVisibility(mp[n]),("fragment"===n||"compute"===n)&&!1===this.isUnfilterable(e.value)&&!1===a.store){let e=new f5(`${s.name}_sampler`,s.node,o);e.setVisibility(mp[n]),h.push(e,a),r=[e,a]}else h.push(a),r=[a]}else if("buffer"===i||"storageBuffer"===i||"indirectStorageBuffer"===i){let s=new("buffer"===i?ft:f7)(e,o);s.setVisibility(mp[n]),h.push(s),r=s}else{let e=this.uniformGroups[n]||(this.uniformGroups[n]={}),a=e[l];void 0===a&&((a=new fr(l,o)).setVisibility(mp[n]),e[l]=a,h.push(a)),r=this.getNodeUniform(s,i),a.addUniform(r)}a.uniformGPU=r}return s}getBuiltin(e,i,n,r=this.shaderStage){let s=this.builtins[r]||(this.builtins[r]=new Map);return!1===s.has(e)&&s.set(e,{name:e,property:i,type:n}),i}hasBuiltin(e,i=this.shaderStage){return void 0!==this.builtins[i]&&this.builtins[i].has(e)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){let i=e.layout,n=this.flowShaderNode(e),r=[];for(let e of i.inputs)r.push(e.name+" : "+this.getType(e.type));let s=`fn ${i.name}( ${r.join(", ")} ) -> ${this.getType(i.type)} {
${n.vars}
${n.code}
`;return n.result&&(s+=`	return ${n.result};
`),s+="\n}\n"}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,i=this.shaderStage){(this.directives[i]||(this.directives[i]=new Set)).add(e)}getDirectives(e){let i=[],n=this.directives[e];if(void 0!==n)for(let e of n)i.push(`enable ${e};`);return i.join("\n")}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){let i=[],n=this.builtins[e];if(void 0!==n)for(let{name:e,property:r,type:s}of n.values())i.push(`@builtin( ${e} ) ${r} : ${s}`);return i.join(",\n	")}getScopedArray(e,i,n,r){return!1===this.scopedArrays.has(e)&&this.scopedArrays.set(e,{name:e,scope:i,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if("compute"!==e)return;let i=[];for(let{name:e,scope:n,bufferType:r,bufferCount:s}of this.scopedArrays.values()){let a=this.getType(r);i.push(`var<${n}> ${e}: array< ${a}, ${s} >;`)}return i.join("\n")}getAttributes(e){let i=[];if("compute"===e&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===e||"compute"===e){let e=this.getBuiltins("attribute");e&&i.push(e);let n=this.getAttributesArray();for(let e=0,r=n.length;e<r;e++){let r=n[e],s=r.name,a=this.getType(r.type);i.push(`@location( ${e} ) ${s} : ${a}`)}}return i.join(",\n	")}getStructMembers(e){let i=[],n=e.getMemberTypes();for(let e=0;e<n.length;e++){let r=n[e];i.push(`	@location( ${e} ) m${e} : ${r}<f32>`)}let r=this.getBuiltins("output");return r&&i.push("	"+r),i.join(",\n")}getStructs(e){let i=[],n=this.structs[e];for(let e=0,r=n.length;e<r;e++){let r=n[e],s=r.name,a=`struct ${s} {
`;a+=this.getStructMembers(r),a+="\n}",i.push(a),i.push(`
var<private> output : ${s};

`)}return i.join("\n\n")}getVar(e,i){return`var ${i} : ${this.getType(e)}`}getVars(e){let i=[],n=this.vars[e];if(void 0!==n)for(let e of n)i.push(`	${this.getVar(e.type,e.name)};`);return`
${i.join("\n")}
`}getVaryings(e){let i=[];if("vertex"===e&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===e||"fragment"===e){let n=this.varyings,r=this.vars[e];for(let s=0;s<n.length;s++){let a=n[s];if(a.needsInterpolation){let e=`@location( ${s} )`;/^(int|uint|ivec|uvec)/.test(a.type)&&(e+=" @interpolate( flat )"),i.push(`${e} ${a.name} : ${this.getType(a.type)}`)}else"vertex"===e&&!1===r.includes(a)&&r.push(a)}}let n=this.getBuiltins(e);n&&i.push(n);let r=i.join(",\n	");return"vertex"===e?this._getWGSLStruct("VaryingsStruct","	"+r):r}getUniforms(e){let i=this.uniforms[e],n=[],r=[],s=[],a={};for(let s of i){let i=s.groupNode.name,o=this.bindingsIndexes[i];if("texture"===s.type||"cubeTexture"===s.type||"storageTexture"===s.type||"texture3D"===s.type){let i;let r=s.node.value;("fragment"===e||"compute"===e)&&!1===this.isUnfilterable(r)&&!0!==s.node.isStorageTextureNode&&(this.isSampleCompare(r)?n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${s.name}_sampler : sampler_comparison;`):n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${s.name}_sampler : sampler;`));let a="",{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(r);if(l>1&&(a="_multisampled"),!0===r.isCubeTexture)i="texture_cube<f32>";else if(!0===r.isDataArrayTexture||!0===r.isCompressedArrayTexture)i="texture_2d_array<f32>";else if(!0===r.isDepthTexture)i=`texture_depth${a}_2d`;else if(!0===r.isVideoTexture)i="texture_external";else if(!0===r.isData3DTexture)i="texture_3d<f32>";else if(!0===s.node.isStorageTextureNode){let n=mn(r),a=this.getStorageAccess(s.node,e);i=`texture_storage_2d<${n}, ${a}>`}else{let e=this.getComponentTypeFromTexture(r).charAt(0);i=`texture${a}_2d<${e}32>`}n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${s.name} : ${i};`)}else if("buffer"===s.type||"storageBuffer"===s.type||"indirectStorageBuffer"===s.type){let i=s.node,n=this.getType(i.bufferType),a=i.bufferCount,l=a>0&&"buffer"===s.type?", "+a:"",h=i.isAtomic?`atomic<${n}>`:`${n}`,u=`	${s.name} : array< ${h}${l} >
`,c=i.isStorageBufferNode?`storage, ${this.getStorageAccess(i,e)}`:"uniform";r.push(this._getWGSLStructBinding("NodeBuffer_"+i.id,u,c,o.binding++,o.group))}else{let e=this.getType(this.getVectorType(s.type)),i=s.groupNode.name;(a[i]||(a[i]={index:o.binding++,id:o.group,snippets:[]})).snippets.push(`	${s.name} : ${e}`)}}for(let e in a){let i=a[e];s.push(this._getWGSLStructBinding(e,i.snippets.join(",\n"),"uniform",i.index,i.id))}let o=n.join("\n");return o+=r.join("\n"),o+=s.join("\n")}buildCode(){let e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};for(let i in this.sortBindingGroups(),e){let n=e[i];n.uniforms=this.getUniforms(i),n.attributes=this.getAttributes(i),n.varyings=this.getVaryings(i),n.structs=this.getStructs(i),n.vars=this.getVars(i),n.codes=this.getCodes(i),n.directives=this.getDirectives(i),n.scopedArrays=this.getScopedArrays(i);let r="// code\n\n";r+=this.flowCode[i];let s=this.flowNodes[i],a=s[s.length-1],o=a.outputNode,l=void 0!==o&&!0===o.isOutputStructNode;for(let e of s){let s=this.getFlowData(e),h=e.name;if(h&&(r.length>0&&(r+="\n"),r+=`	// flow -> ${h}
	`),r+=`${s.code}
	`,e===a&&"compute"!==i){if(r+="// result\n\n	","vertex"===i)r+=`varyings.Vertex = ${s.result};`;else if("fragment"===i){if(l)n.returnType=o.nodeType,r+=`return ${s.result};`;else{let e="	@location(0) color: vec4<f32>",i=this.getBuiltins("output");i&&(e+=",\n	"+i),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",e),n.structs+="\nvar<private> output : OutputStruct;\n\n",r+=`output.color = ${s.result};

	return output;`}}}}n.flow=r}null!==this.material?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,i=null){let n;return null!==i&&(n=this._getWGSLMethod(e+"_"+i)),void 0===n&&(n=this._getWGSLMethod(e)),n||e}getType(e){return mg[e]||e}isAvailable(e){let i=mf[e];return void 0===i&&("float32Filterable"===e?i=this.renderer.hasFeature("float32-filterable"):"clipDistance"===e&&(i=this.renderer.hasFeature("clip-distances")),mf[e]=i),i}_getWGSLMethod(e){return void 0!==mv[e]&&this._include(e),my[e]}_include(e){let i=mv[e];return i.build(this),null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(i),i}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${mx}

// uniforms
${e.uniforms}

// structs
${e.structs}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,i){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = id.x + id.y * numWorkgroups.x * u32(${i}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${i});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,i){return`
struct ${e} {
${i}
};`}_getWGSLStructBinding(e,i,n,r=0,s=0){let a=e+"Struct",o=this._getWGSLStruct(a,i);return`${o}
@binding( ${r} ) @group( ${s} )
var<${n}> ${e} : ${a};`}}class mb{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let i;return null!==e.depthTexture?i=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?i=fj.Depth24PlusStencil8:e.depth&&(i=fj.Depth24Plus),i}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let i;if(e.isFramebufferTexture)i=1;else if(e.isDepthTexture&&!e.renderTarget){let e=this.backend.renderer,n=e.getRenderTarget();i=n?n.samples:e.samples}else e.renderTarget&&(i=e.renderTarget.samples);let n=(i=i||1)>1&&null!==e.renderTarget&&!0!==e.isDepthTexture&&!0!==e.isFramebufferTexture,r=n?1:i;return{samples:i,primarySamples:r,isMSAA:n}}getCurrentColorFormat(e){let i;return null!==e.textures?this.getTextureFormatGPU(e.textures[0]):this.getPreferredCanvasFormat()}getCurrentColorSpace(e){return null!==e.textures?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,i){return e.isPoints?fO.PointList:e.isLineSegments||e.isMesh&&!0===i.wireframe?fO.LineList:e.isLine?fO.LineStrip:e.isMesh?fO.TriangleList:void 0}getSampleCount(e){let i=1;return e>1&&2===(i=Math.pow(2,Math.floor(Math.log2(e))))&&(i=4),i}getSampleCountRenderContext(e){return null!==e.textures?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?fj.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}let mE=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),mw=new Map([[eE.e62,["float16"]]]),mM=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class mC{constructor(e){this.backend=e}createAttribute(e,i){let n=this._getBufferAttribute(e),r=this.backend,s=r.get(n),a=s.buffer;if(void 0===a){let o=r.device,l=n.array;if(!1===e.normalized&&(l.constructor===Int16Array||l.constructor===Uint16Array)){let e=new Uint32Array(l.length);for(let i=0;i<l.length;i++)e[i]=l[i];l=e}if(n.array=l,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&3===n.itemSize){l=new l.constructor(4*n.count);for(let e=0;e<n.count;e++)l.set(n.array.subarray(3*e,3*e+3),4*e);n.itemSize=4,n.array=l}let h=l.byteLength+(4-l.byteLength%4)%4;a=o.createBuffer({label:n.name,size:h,usage:i,mappedAtCreation:!0}),new l.constructor(a.getMappedRange()).set(l),a.unmap(),s.buffer=a}}updateAttribute(e){let i=this._getBufferAttribute(e),n=this.backend,r=n.device,s=n.get(i).buffer,a=i.array,o=this._isTypedArray(a),l=i.updateRanges;if(0===l.length)r.queue.writeBuffer(s,0,a,0);else{let e=o?1:a.BYTES_PER_ELEMENT;for(let i=0,n=l.length;i<n;i++){let n=l[i],o=n.start*e,h=n.count*e;r.queue.writeBuffer(s,0,a,o,h)}i.clearUpdateRanges()}}createShaderVertexBuffers(e){let i=e.getAttributes(),n=new Map;for(let e=0;e<i.length;e++){let r=i[e],s=r.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(r),o=n.get(a);if(void 0===o){let e,i;!0===r.isInterleavedBufferAttribute?(e=r.data.stride*s,i=r.data.isInstancedInterleavedBuffer?f2.Instance:f2.Vertex):(e=r.itemSize*s,i=r.isInstancedBufferAttribute?f2.Instance:f2.Vertex),!1===r.normalized&&(r.array.constructor===Int16Array||r.array.constructor===Uint16Array)&&(e=4),o={arrayStride:e,attributes:[],stepMode:i},n.set(a,o)}let l=this._getVertexFormat(r),h=!0===r.isInterleavedBufferAttribute?r.offset*s:0;o.attributes.push({shaderLocation:e,offset:h,format:l})}return Array.from(n.values())}destroyAttribute(e){let i=this.backend;i.get(this._getBufferAttribute(e)).buffer.destroy(),i.delete(e)}async getArrayBufferAsync(e){let i=this.backend,n=i.device,r=i.get(this._getBufferAttribute(e)).buffer,s=r.size,a=n.createBuffer({label:`${e.name}_readback`,size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o=n.createCommandEncoder({label:`readback_encoder_${e.name}`});o.copyBufferToBuffer(r,0,a,0,s);let l=o.finish();n.queue.submit([l]),await a.mapAsync(GPUMapMode.READ);let h=a.getMappedRange(),u=new e.array.constructor(h.slice(0));return a.unmap(),u.buffer}_getVertexFormat(e){let i;let{itemSize:n,normalized:r}=e,s=e.array.constructor,a=e.constructor;if(1===n)i=mM.get(s);else{let e=(mw.get(a)||mE.get(s))[+!!r];if(e){let r=4*Math.floor((s.BYTES_PER_ELEMENT*n+3)/4)/s.BYTES_PER_ELEMENT;if(r%1)throw Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");i=`${e}x${r}`}}return i||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),i}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class mS{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){let i=this.backend,n=i.device,r=[],s=0;for(let n of e.bindings){let e={binding:s++,visibility:n.visibility};if(n.isUniformBuffer||n.isStorageBuffer){let i={};n.isStorageBuffer&&(4&n.visibility&&(n.access===nc.READ_WRITE||n.access===nc.WRITE_ONLY)?i.type=fY.Storage:i.type=fY.ReadOnlyStorage),e.buffer=i}else if(n.isSampler){let i={};n.texture.isDepthTexture&&null!==n.texture.compareFunction&&(i.type="comparison"),e.sampler=i}else if(n.isSampledTexture&&n.texture.isVideoTexture)e.externalTexture={};else if(n.isSampledTexture&&n.store){let i={};i.format=this.backend.get(n.texture).texture.format;let r=n.access;r===nc.READ_WRITE?i.access=fJ.ReadWrite:r===nc.WRITE_ONLY?i.access=fJ.WriteOnly:i.access=fJ.ReadOnly,e.storageTexture=i}else if(n.isSampledTexture){let r={},{primarySamples:s}=i.utils.getTextureSampleData(n.texture);if(s>1&&(r.multisampled=!0,n.texture.isDepthTexture||(r.sampleType=fZ.UnfilterableFloat)),n.texture.isDepthTexture)r.sampleType=fZ.Depth;else if(n.texture.isDataTexture||n.texture.isDataArrayTexture||n.texture.isData3DTexture){let e=n.texture.type;e===eE.Kz5?r.sampleType=fZ.SInt:e===eE.JQ4?r.sampleType=fZ.UInt:e===eE.VzW&&(this.backend.hasFeature("float32-filterable")?r.sampleType=fZ.Float:r.sampleType=fZ.UnfilterableFloat)}n.isSampledCubeTexture?r.viewDimension=f0.Cube:n.texture.isDataArrayTexture||n.texture.isCompressedArrayTexture?r.viewDimension=f0.TwoDArray:n.isSampledTexture3D&&(r.viewDimension=f0.ThreeD),e.texture=r}else console.error(`WebGPUBindingUtils: Unsupported binding "${n}".`);r.push(e)}return n.createBindGroupLayout({entries:r})}createBindings(e,i,n,r=0){let s;let{backend:a,bindGroupLayoutCache:o}=this,l=a.get(e),h=o.get(e.bindingsReference);void 0===h&&(h=this.createBindingsLayout(e),o.set(e.bindingsReference,h)),n>0&&(void 0===l.groups&&(l.groups=[],l.versions=[]),l.versions[n]===r&&(s=l.groups[n])),void 0===s&&(s=this.createBindGroup(e,h),n>0&&(l.groups[n]=s,l.versions[n]=r)),l.group=s,l.layout=h}updateBinding(e){let i=this.backend,n=i.device,r=e.buffer,s=i.get(e).buffer;n.queue.writeBuffer(s,0,r,0)}createBindGroup(e,i){let n=this.backend,r=n.device,s=0,a=[];for(let i of e.bindings){if(i.isUniformBuffer){let e=n.get(i);if(void 0===e.buffer){let n=i.byteLength,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=r.createBuffer({label:"bindingBuffer_"+i.name,size:n,usage:s});e.buffer=a}a.push({binding:s,resource:{buffer:e.buffer}})}else if(i.isStorageBuffer){let e=n.get(i);if(void 0===e.buffer){let r=i.attribute;e.buffer=n.get(r).buffer}a.push({binding:s,resource:{buffer:e.buffer}})}else if(i.isSampler){let e=n.get(i.texture);a.push({binding:s,resource:e.sampler})}else if(i.isSampledTexture){let e;let o=n.get(i.texture);if(void 0!==o.externalTexture)e=r.importExternalTexture({source:o.externalTexture});else{let n=i.store?1:o.texture.mipLevelCount,r=`view-${o.texture.width}-${o.texture.height}-${n}`;if(void 0===(e=o[r])){let s;let a=f1.All;s=i.isSampledCubeTexture?f0.Cube:i.isSampledTexture3D?f0.ThreeD:i.texture.isDataArrayTexture||i.texture.isCompressedArrayTexture?f0.TwoDArray:f0.TwoD,e=o[r]=o.texture.createView({aspect:a,dimension:s,mipLevelCount:n})}}a.push({binding:s,resource:e})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:i,entries:a})}}class mT{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,i){let n;let{object:r,material:s,geometry:a,pipeline:o}=e,{vertexProgram:l,fragmentProgram:h}=o,u=this.backend,c=u.device,d=u.utils,p=u.get(o),f=[];for(let i of e.getBindings()){let e=u.get(i);f.push(e.layout)}let m=u.attributeUtils.createShaderVertexBuffers(e);!0===s.transparent&&s.blending!==eE.jFi&&(n=this._getBlending(s));let g={};!0===s.stencilWrite&&(g={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});let A=this._getColorWriteMask(s),v=[];if(null!==e.context.textures){let i=e.context.textures;for(let e=0;e<i.length;e++){let r=d.getTextureFormatGPU(i[e]);v.push({format:r,blend:n,writeMask:A})}}else{let i=d.getCurrentColorFormat(e.context);v.push({format:i,blend:n,writeMask:A})}let y=u.get(l).module,x=u.get(h).module,_=this._getPrimitiveState(r,a,s),b=this._getDepthCompare(s),E=d.getCurrentDepthStencilFormat(e.context),w=this._getSampleCount(e.context),M={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},y,{buffers:m}),fragment:Object.assign({},x,{targets:v}),primitive:_,multisample:{count:w,alphaToCoverageEnabled:s.alphaToCoverage&&w>1},layout:c.createPipelineLayout({bindGroupLayouts:f})},C={},S=e.context.depth,T=e.context.stencil;if((!0===S||!0===T)&&(!0===S&&(C.format=E,C.depthWriteEnabled=s.depthWrite,C.depthCompare=b),!0===T&&(C.stencilFront=g,C.stencilBack={},C.stencilReadMask=s.stencilFuncMask,C.stencilWriteMask=s.stencilWriteMask),M.depthStencil=C),null===i)p.pipeline=c.createRenderPipeline(M);else{let e=new Promise(e=>{c.createRenderPipelineAsync(M).then(i=>{p.pipeline=i,e()})});i.push(e)}}createBundleEncoder(e){let{utils:i,device:n}=this.backend,r=i.getCurrentDepthStencilFormat(e),s=i.getCurrentColorFormat(e),a=this._getSampleCount(e);return n.createRenderBundleEncoder({label:"renderBundleEncoder",colorFormats:[s],depthStencilFormat:r,sampleCount:a})}createComputePipeline(e,i){let n=this.backend,r=n.device,s=n.get(e.computeProgram).module,a=n.get(e),o=[];for(let e of i){let i=n.get(e);o.push(i.layout)}a.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let i,n;let r=e.blending,s=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(r===eE.Xaj){let r=null!==e.blendSrcAlpha?e.blendSrcAlpha:s,l=null!==e.blendDstAlpha?e.blendDstAlpha:a,h=null!==e.blendEquationAlpha?e.blendEquationAlpha:o;i={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(l),operation:this._getBlendOperation(h)}}else{let s=e.premultipliedAlpha,a=(e,r,s,a)=>{i={srcFactor:e,dstFactor:r,operation:fq.Add},n={srcFactor:s,dstFactor:a,operation:fq.Add}};if(s)switch(r){case eE.bdR:a(fW.One,fW.OneMinusSrcAlpha,fW.One,fW.OneMinusSrcAlpha);break;case eE.WMw:a(fW.One,fW.One,fW.One,fW.One);break;case eE.N4l:a(fW.Zero,fW.OneMinusSrc,fW.Zero,fW.One);break;case eE.M5h:a(fW.Zero,fW.Src,fW.Zero,fW.SrcAlpha)}else switch(r){case eE.bdR:a(fW.SrcAlpha,fW.OneMinusSrcAlpha,fW.One,fW.OneMinusSrcAlpha);break;case eE.WMw:a(fW.SrcAlpha,fW.One,fW.SrcAlpha,fW.One);break;case eE.N4l:a(fW.Zero,fW.OneMinusSrc,fW.Zero,fW.One);break;case eE.M5h:a(fW.Zero,fW.Src,fW.Zero,fW.Src)}}if(void 0!==i&&void 0!==n)return{color:i,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let i;switch(e){case eE.c8b:i=fW.Zero;break;case eE.ghN:i=fW.One;break;case eE.KhW:i=fW.Src;break;case eE.iWC:i=fW.OneMinusSrc;break;case eE.k74:i=fW.SrcAlpha;break;case eE.LgZ:i=fW.OneMinusSrcAlpha;break;case eE.Vdb:i=fW.Dst;break;case eE.Wpd:i=fW.OneMinusDstColor;break;case eE.fSK:i=fW.DstAlpha;break;case eE.Hy8:i=fW.OneMinusDstAlpha;break;case eE.RlZ:i=fW.SrcAlphaSaturated;break;case 211:i=fW.Constant;break;case 212:i=fW.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return i}_getStencilCompare(e){let i;let n=e.stencilFunc;switch(n){case eE.MyG:i=fU.Never;break;case eE.cum:i=fU.Always;break;case eE.uXU:i=fU.Less;break;case eE.yt0:i=fU.LessEqual;break;case eE.jwo:i=fU.Equal;break;case eE.j4z:i=fU.GreaterEqual;break;case eE.OAl:i=fU.Greater;break;case eE.RvT:i=fU.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return i}_getStencilOperation(e){let i;switch(e){case eE.x5V:i=fK.Keep;break;case eE.ad5:i=fK.Zero;break;case eE.ce8:i=fK.Replace;break;case eE.eMJ:i=fK.Invert;break;case eE.ZRs:i=fK.IncrementClamp;break;case eE.jfJ:i=fK.DecrementClamp;break;case eE.oqc:i=fK.IncrementWrap;break;case eE.T_J:i=fK.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",i)}return i}_getBlendOperation(e){let i;switch(e){case eE.bGH:i=fq.Add;break;case eE.Wbm:i=fq.Subtract;break;case eE.rOj:i=fq.ReverseSubtract;break;case eE.r_:i=fq.Min;break;case eE.Sm8:i=fq.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return i}_getPrimitiveState(e,i,n){let r={},s=this.backend.utils;switch(r.topology=s.getPrimitiveTopology(e,n),null!==i.index&&!0===e.isLine&&!0!==e.isLineSegments&&(r.stripIndexFormat=i.index.array instanceof Uint16Array?fV.Uint16:fV.Uint32),n.side){case eE.Wl3:r.frontFace=fz.CCW,r.cullMode=fG.Back;break;case eE._Li:r.frontFace=fz.CCW,r.cullMode=fG.Front;break;case eE.ehD:r.frontFace=fz.CCW,r.cullMode=fG.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side)}return r}_getColorWriteMask(e){return!0===e.colorWrite?fX.All:fX.None}_getDepthCompare(e){let i;if(!1===e.depthTest)i=fU.Always;else{let n=e.depthFunc;switch(n){case eE.BVF:i=fU.Never;break;case eE.Se2:i=fU.Always;break;case eE.Zr5:i=fU.Less;break;case eE.vCF:i=fU.LessEqual;break;case eE.eD:i=fU.Equal;break;case eE.ksN:i=fU.GreaterEqual;break;case eE.w$m:i=fU.Greater;break;case eE.M6v:i=fU.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return i}}class mR extends fA{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===e.alpha||e.alpha,this.parameters.requiredLimits=void 0===e.requiredLimits?{}:e.requiredLimits,this.trackTimestamp=!0===e.trackTimestamp,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new mb(this),this.attributeUtils=new mC(this),this.bindingUtils=new mS(this),this.pipelineUtils=new mT(this),this.textureUtils=new mi(this),this.occludedResolveCache=new Map}async init(e){let i;await super.init(e);let n=this.parameters;if(void 0===n.device){let e={powerPreference:n.powerPreference},r="undefined"!=typeof navigator?await navigator.gpu.requestAdapter(e):null;if(null===r)throw Error("WebGPUBackend: Unable to create WebGPU adapter.");let s=Object.values(f3),a=[];for(let e of s)r.features.has(e)&&a.push(e);let o={requiredFeatures:a,requiredLimits:n.requiredLimits};i=await r.requestDevice(o)}else i=n.device;i.lost.then(i=>{let n={api:"WebGPU",message:i.message||"Unknown reason",reason:i.reason||null,originalEvent:i};e.onDeviceLost(n)});let r=void 0!==n.context?n.context:e.domElement.getContext("webgpu");this.device=i,this.context=r;let s=n.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(f3.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return eE.JCZ}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(null===e){let i=this.renderer;e={colorAttachments:[{view:null}]},(!0===this.renderer.depth||!0===this.renderer.stencil)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(i.depth,i.stencil).createView()});let n=e.colorAttachments[0];this.renderer.samples>0?n.view=this.colorBuffer.createView():n.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}let i=e.colorAttachments[0];return this.renderer.samples>0?i.resolveTarget=this.context.getCurrentTexture().createView():i.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e,i={}){let n=e.renderTarget,r=this.get(n),s=r.descriptors;if(void 0===s||r.width!==n.width||r.height!==n.height||r.dimensions!==n.dimensions||r.activeMipmapLevel!==n.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==n.samples||r.loadOp!==i.loadOp){s={},r.descriptors=s;let e=()=>{n.removeEventListener("dispose",e),this.delete(n)};n.addEventListener("dispose",e)}let a=e.getCacheKey(),o=s[a];if(void 0===o){let l;let h=e.textures,u=[];for(let r=0;r<h.length;r++){let s,a;let o=this.get(h[r]),c={label:`colorAttachment_${r}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:f0.TwoD};n.isRenderTarget3D?(l=e.activeCubeFace,c.baseArrayLayer=0,c.dimension=f0.ThreeD,c.depthOrArrayLayers=h[r].image.depth):n.isRenderTargetArray&&(c.dimension=f0.TwoDArray,c.depthOrArrayLayers=h[r].image.depth);let d=o.texture.createView(c);void 0!==o.msaaTexture?(s=o.msaaTexture.createView(),a=d):(s=d,a=void 0),u.push({view:s,depthSlice:l,resolveTarget:a,loadOp:fF.Load,storeOp:fk.Store,...i})}if(o={colorAttachments:u},e.depth){let i={view:this.get(e.depthTexture).texture.createView()};o.depthStencilAttachment=i}s[a]=o,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=n.dimensions,r.depthSlice=l,r.loadOp=u[0].loadOp}return o}beginRender(e){let i,n;let r=this.get(e),s=this.device,a=e.occlusionQueryCount;a>0&&(r.currentOcclusionQuerySet&&r.currentOcclusionQuerySet.destroy(),r.currentOcclusionQueryBuffer&&r.currentOcclusionQueryBuffer.destroy(),r.currentOcclusionQuerySet=r.occlusionQuerySet,r.currentOcclusionQueryBuffer=r.occlusionQueryBuffer,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,i=s.createQuerySet({type:"occlusion",count:a,label:`occlusionQuerySet_${e.id}`}),r.occlusionQuerySet=i,r.occlusionQueryIndex=0,r.occlusionQueryObjects=Array(a),r.lastOcclusionObject=null),n=null===e.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(e,{loadOp:fF.Load}),this.initTimestampQuery(e,n),n.occlusionQuerySet=i;let o=n.depthStencilAttachment;if(null!==e.textures){let i=n.colorAttachments;for(let n=0;n<i.length;n++){let r=i[n];e.clearColor?(r.clearValue=0===n?e.clearColorValue:{r:0,g:0,b:0,a:1},r.loadOp=fF.Clear):r.loadOp=fF.Load,r.storeOp=fk.Store}}else{let i=n.colorAttachments[0];e.clearColor?(i.clearValue=e.clearColorValue,i.loadOp=fF.Clear):i.loadOp=fF.Load,i.storeOp=fk.Store}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=fF.Clear):o.depthLoadOp=fF.Load,o.depthStoreOp=fk.Store),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=fF.Clear):o.stencilLoadOp=fF.Load,o.stencilStoreOp=fk.Store);let l=s.createCommandEncoder({label:"renderContext_"+e.id}),h=l.beginRenderPass(n);if(r.descriptor=n,r.encoder=l,r.currentPass=h,r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},r.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){let{x:i,y:n,width:r,height:s}=e.scissorValue;h.setScissorRect(i,n,r,s)}}finishRender(e){let i=this.get(e),n=e.occlusionQueryCount;if(i.renderBundles.length>0&&i.currentPass.executeBundles(i.renderBundles),n>i.occlusionQueryIndex&&i.currentPass.endOcclusionQuery(),i.currentPass.end(),n>0){let r=8*n,s=this.occludedResolveCache.get(r);void 0===s&&(s=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,s));let a=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});i.encoder.resolveQuerySet(i.occlusionQuerySet,0,n,s,0),i.encoder.copyBufferToBuffer(s,0,a,0,r),i.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.prepareTimestampBuffer(e,i.encoder),this.device.queue.submit([i.encoder.finish()]),null!==e.textures){let i=e.textures;for(let e=0;e<i.length;e++){let n=i[e];!0===n.generateMipmaps&&this.textureUtils.generateMipmaps(n)}}}isOccluded(e,i){let n=this.get(e);return n.occluded&&n.occluded.has(i)}async resolveOccludedAsync(e){let i=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=i;if(n&&r){let e=new WeakSet;i.currentOcclusionQueryObjects=null,i.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);let s=new BigUint64Array(n.getMappedRange());for(let i=0;i<r.length;i++)s[i]!==BigInt(0)&&e.add(r[i]);n.destroy(),i.occluded=e}}updateViewport(e){let{currentPass:i}=this.get(e),{x:n,y:r,width:s,height:a,minDepth:o,maxDepth:l}=e.viewportValue;i.setViewport(n,r,s,a,o,l)}clear(e,i,n,r=null){let s,a,o,l;let h=this.device,u=this.renderer,c=[];if(e){let e=this.getClearColor();if(!0===this.renderer.alpha){let i=e.a;a={r:e.r*i,g:e.g*i,b:e.b*i,a:i}}else a={r:e.r,g:e.g,b:e.b,a:e.a}}if(null===r){o=u.depth,l=u.stencil;let i=this._getDefaultRenderPassDescriptor();if(e){let e=(c=i.colorAttachments)[0];e.clearValue=a,e.loadOp=fF.Clear,e.storeOp=fk.Store}(o||l)&&(s=i.depthStencilAttachment)}else o=r.depth,l=r.stencil,e&&(c=this._getRenderPassDescriptor(r,{loadOp:fF.Clear}).colorAttachments),(o||l)&&(s={view:this.get(r.depthTexture).texture.createView()});o&&(i?(s.depthLoadOp=fF.Clear,s.depthClearValue=u.getClearDepth()):s.depthLoadOp=fF.Load,s.depthStoreOp=fk.Store),l&&(n?(s.stencilLoadOp=fF.Clear,s.stencilClearValue=u.getClearStencil()):s.stencilLoadOp=fF.Load,s.stencilStoreOp=fk.Store);let d=h.createCommandEncoder({});d.beginRenderPass({colorAttachments:c,depthStencilAttachment:s}).end(),h.queue.submit([d.finish()])}beginCompute(e){let i=this.get(e),n={};this.initTimestampQuery(e,n),i.cmdEncoderGPU=this.device.createCommandEncoder(),i.passEncoderGPU=i.cmdEncoderGPU.beginComputePass(n)}compute(e,i,n,r){let{passEncoderGPU:s}=this.get(e),a=this.get(r).pipeline;s.setPipeline(a);for(let e=0,i=n.length;e<i;e++){let i=n[e],r=this.get(i);s.setBindGroup(e,r.group)}let o=this.device.limits.maxComputeWorkgroupsPerDimension,l=this.get(i);void 0===l.dispatchSize&&(l.dispatchSize={x:0,y:1,z:1});let{dispatchSize:h}=l;i.dispatchCount>o?(h.x=Math.min(i.dispatchCount,o),h.y=Math.ceil(i.dispatchCount/o)):h.x=i.dispatchCount,s.dispatchWorkgroups(h.x,h.y,h.z)}finishCompute(e){let i=this.get(e);i.passEncoderGPU.end(),this.prepareTimestampBuffer(e,i.cmdEncoderGPU),this.device.queue.submit([i.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,i){let{object:n,context:r,pipeline:s}=e,a=e.getBindings(),o=this.get(r),l=this.get(s).pipeline,h=o.currentSets,u=o.currentPass,c=e.getDrawParameters();if(null===c)return;h.pipeline!==l&&(u.setPipeline(l),h.pipeline=l);let d=h.bindingGroups;for(let e=0,i=a.length;e<i;e++){let i=a[e],n=this.get(i);d[i.index]!==i.id&&(u.setBindGroup(i.index,n.group),d[i.index]=i.id)}let p=e.getIndex(),f=null!==p;if(!0===f&&h.index!==p){let e=this.get(p).buffer,i=p.array instanceof Uint16Array?fV.Uint16:fV.Uint32;u.setIndexBuffer(e,i),h.index=p}let m=e.getVertexBuffers();for(let e=0,i=m.length;e<i;e++){let i=m[e];if(h.attributes[e]!==i){let n=this.get(i).buffer;u.setVertexBuffer(e,n),h.attributes[e]=i}}if(void 0!==o.occlusionQuerySet){let e=o.lastOcclusionObject;e!==n&&(null!==e&&!0===e.occlusionTest&&(u.endOcclusionQuery(),o.occlusionQueryIndex++),!0===n.occlusionTest&&(u.beginOcclusionQuery(o.occlusionQueryIndex),o.occlusionQueryObjects[o.occlusionQueryIndex]=n),o.lastOcclusionObject=n)}if(!0===n.isBatchedMesh){let e=n._multiDrawStarts,i=n._multiDrawCounts,r=n._multiDrawCount,s=n._multiDrawInstances;for(let n=0;n<r;n++){let r=s?s[n]:1,a=r>1?0:n;!0===f?u.drawIndexed(i[n],r,e[n]/p.array.BYTES_PER_ELEMENT,0,a):u.draw(i[n],r,e[n],a)}}else if(!0===f){let{vertexCount:r,instanceCount:s,firstVertex:a}=c,o=e.getIndirect();if(null!==o){let e=this.get(o).buffer;u.drawIndexedIndirect(e,0)}else u.drawIndexed(r,s,a,0,0);i.update(n,r,s)}else{let{vertexCount:r,instanceCount:s,firstVertex:a}=c,o=e.getIndirect();if(null!==o){let e=this.get(o).buffer;u.drawIndirect(e,0)}else u.draw(r,s,a,0);i.update(n,r,s)}}needsRenderUpdate(e){let i=this.get(e),{object:n,material:r}=e,s=this.utils,a=s.getSampleCountRenderContext(e.context),o=s.getCurrentColorSpace(e.context),l=s.getCurrentColorFormat(e.context),h=s.getCurrentDepthStencilFormat(e.context),u=s.getPrimitiveTopology(n,r),c=!1;return(i.material!==r||i.materialVersion!==r.version||i.transparent!==r.transparent||i.blending!==r.blending||i.premultipliedAlpha!==r.premultipliedAlpha||i.blendSrc!==r.blendSrc||i.blendDst!==r.blendDst||i.blendEquation!==r.blendEquation||i.blendSrcAlpha!==r.blendSrcAlpha||i.blendDstAlpha!==r.blendDstAlpha||i.blendEquationAlpha!==r.blendEquationAlpha||i.colorWrite!==r.colorWrite||i.depthWrite!==r.depthWrite||i.depthTest!==r.depthTest||i.depthFunc!==r.depthFunc||i.stencilWrite!==r.stencilWrite||i.stencilFunc!==r.stencilFunc||i.stencilFail!==r.stencilFail||i.stencilZFail!==r.stencilZFail||i.stencilZPass!==r.stencilZPass||i.stencilFuncMask!==r.stencilFuncMask||i.stencilWriteMask!==r.stencilWriteMask||i.side!==r.side||i.alphaToCoverage!==r.alphaToCoverage||i.sampleCount!==a||i.colorSpace!==o||i.colorFormat!==l||i.depthStencilFormat!==h||i.primitiveTopology!==u||i.clippingContextCacheKey!==e.clippingContextCacheKey)&&(i.material=r,i.materialVersion=r.version,i.transparent=r.transparent,i.blending=r.blending,i.premultipliedAlpha=r.premultipliedAlpha,i.blendSrc=r.blendSrc,i.blendDst=r.blendDst,i.blendEquation=r.blendEquation,i.blendSrcAlpha=r.blendSrcAlpha,i.blendDstAlpha=r.blendDstAlpha,i.blendEquationAlpha=r.blendEquationAlpha,i.colorWrite=r.colorWrite,i.depthWrite=r.depthWrite,i.depthTest=r.depthTest,i.depthFunc=r.depthFunc,i.stencilWrite=r.stencilWrite,i.stencilFunc=r.stencilFunc,i.stencilFail=r.stencilFail,i.stencilZFail=r.stencilZFail,i.stencilZPass=r.stencilZPass,i.stencilFuncMask=r.stencilFuncMask,i.stencilWriteMask=r.stencilWriteMask,i.side=r.side,i.alphaToCoverage=r.alphaToCoverage,i.sampleCount=a,i.colorSpace=o,i.colorFormat=l,i.depthStencilFormat=h,i.primitiveTopology=u,i.clippingContextCacheKey=e.clippingContextCacheKey,c=!0),c}getRenderCacheKey(e){let{object:i,material:n}=e,r=this.utils,s=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(i,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,i){this.textureUtils.createTexture(e,i)}updateTexture(e,i){this.textureUtils.updateTexture(e,i)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}copyTextureToBuffer(e,i,n,r,s,a){return this.textureUtils.copyTextureToBuffer(e,i,n,r,s,a)}initTimestampQuery(e,i){if(!this.trackTimestamp)return;let n=this.get(e);if(!n.timeStampQuerySet){let r=e.isComputeNode?"compute":"render",s=this.device.createQuerySet({type:"timestamp",count:2,label:`timestamp_${r}_${e.id}`});Object.assign(i,{timestampWrites:{querySet:s,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),n.timeStampQuerySet=s}}prepareTimestampBuffer(e,i){if(!this.trackTimestamp)return;let n=this.get(e),r=2*BigInt64Array.BYTES_PER_ELEMENT;void 0===n.currentTimestampQueryBuffers&&(n.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})});let{resolveBuffer:s,resultBuffer:a}=n.currentTimestampQueryBuffers;i.resolveQuerySet(n.timeStampQuerySet,0,2,s,0),"unmapped"===a.mapState&&i.copyBufferToBuffer(s,0,a,0,r)}async resolveTimestampAsync(e,i="render"){if(!this.trackTimestamp)return;let n=this.get(e);if(void 0===n.currentTimestampQueryBuffers)return;let{resultBuffer:r}=n.currentTimestampQueryBuffers;"unmapped"===r.mapState&&r.mapAsync(GPUMapMode.READ).then(()=>{let e=new BigUint64Array(r.getMappedRange()),n=Number(e[1]-e[0])/1e6;this.renderer.info.updateTimestamp(i,n),r.unmap()})}createNodeBuilder(e,i){return new m_(e,i)}createProgram(e){this.get(e).module={module:this.device.createShaderModule({code:e.code,label:e.stage+(""!==e.name?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,i){this.pipelineUtils.createRenderPipeline(e,i)}createComputePipeline(e,i){this.pipelineUtils.createComputePipeline(e,i)}beginBundle(e){let i=this.get(e);i._currentPass=i.currentPass,i._currentSets=i.currentSets,i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},i.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,i){let n=this.get(e),r=n.currentPass.finish();this.get(i).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,i){this.get(e).renderBundles.push(this.get(i).bundleGPU)}createBindings(e,i,n,r){this.bindingUtils.createBindings(e,i,n,r)}updateBindings(e,i,n,r){this.bindingUtils.createBindings(e,i,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,i,n=null,r=null,s=0){let a=0,o=0,l=0,h=0,u=0,c=0,d=e.image.width,p=e.image.height;null!==n&&(h=n.x,u=n.y,c=n.z||0,d=n.width,p=n.height),null!==r&&(a=r.x,o=r.y,l=r.z||0);let f=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+i.id}),m=this.get(e).texture,g=this.get(i).texture;f.copyTextureToTexture({texture:m,mipLevel:s,origin:{x:h,y:u,z:c}},{texture:g,mipLevel:s,origin:{x:a,y:o,z:l}},[d,p,1]),this.device.queue.submit([f.finish()])}copyFramebufferToTexture(e,i,n){let r;let s=this.get(i),a=null;a=i.renderTarget?e.isDepthTexture?this.get(i.depthTexture).texture:this.get(i.textures[0]).texture:e.isDepthTexture?this.textureUtils.getDepthBuffer(i.depth,i.stencil):this.context.getCurrentTexture();let o=this.get(e).texture;if(a.format!==o.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",a.format,o.format);return}if(s.currentPass?(s.currentPass.end(),r=s.encoder):r=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),r.copyTextureToTexture({texture:a,origin:[n.x,n.y,0]},{texture:o},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),s.currentPass){let{descriptor:e}=s;for(let i=0;i<e.colorAttachments.length;i++)e.colorAttachments[i].loadOp=fF.Load;if(i.depth&&(e.depthStencilAttachment.depthLoadOp=fF.Load),i.stencil&&(e.depthStencilAttachment.stencilLoadOp=fF.Load),s.currentPass=r.beginRenderPass(e),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},i.viewport&&this.updateViewport(i),i.scissor){let{x:e,y:n,width:r,height:a}=i.scissorValue;s.currentPass.setScissorRect(e,n,r,a)}}else this.device.queue.submit([r.finish()])}}class mI extends eE.PMe{constructor(e,i,n,r,s,a){super(e,i,n,r,s,a),this.iesMap=null}copy(e,i){return super.copy(e,i),this.iesMap=e.iesMap,this}}class mB extends pJ{constructor(){super(),this.addMaterial(hT,"MeshPhongMaterial"),this.addMaterial(uk,"MeshStandardMaterial"),this.addMaterial(uz,"MeshPhysicalMaterial"),this.addMaterial(uH,"MeshToonMaterial"),this.addMaterial(hv,"MeshBasicMaterial"),this.addMaterial(hC,"MeshLambertMaterial"),this.addMaterial(ha,"MeshNormalMaterial"),this.addMaterial(uq,"MeshMatcapMaterial"),this.addMaterial(ht,"LineBasicMaterial"),this.addMaterial(hn,"LineDashedMaterial"),this.addMaterial(uK,"PointsMaterial"),this.addMaterial(uZ,"SpriteMaterial"),this.addMaterial(u1,"ShadowMaterial"),this.addLight(dO,eE.cek),this.addLight(pS,eE.Ox3),this.addLight(pB,eE.T_f),this.addLight(pL,eE.PMe),this.addLight(pD,eE.Mig),this.addLight(pN,eE.vmT),this.addLight(pO,eE.lk7),this.addLight(pP,mI),this.addToneMapping(cj,eE.EoG),this.addToneMapping(cH,eE.CdI),this.addToneMapping(cQ,eE.YGz),this.addToneMapping(cq,eE.LY2),this.addToneMapping(cJ,eE.Bgp),this.addToneMapping(cZ,eE.ORg)}}class mL extends p6{constructor(e={}){let i;e.forceWebGL?i=fN:(i=mR,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new fN(e))),super(new i(e),e),this.library=new mB,this.isWebGPURenderer=!0}}eE.ZAu,eE.xEZ,eE.aNw,eE.u7G,eE.Gql,eE.ZAu;let mP={type:"change"},mD={type:"start"},mN={type:"end"},mO={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},mU=new eE.FM8,mk=new eE.FM8,mF=new eE.Pa4,mz=new eE.Pa4,mG=new eE.Pa4,mV=new eE._fP,mj=new eE.Pa4,mH=new eE.Pa4,mQ=new eE.Pa4,mW=new eE.Pa4;class mq extends eE.ZXd{constructor(e,i=null){super(e,i),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:eE.RsA.ROTATE,MIDDLE:eE.RsA.DOLLY,RIGHT:eE.RsA.PAN},this.state=mO.NONE,this.keyState=mO.NONE,this.target=new eE.Pa4,this._lastPosition=new eE.Pa4,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new eE.Pa4,this._movePrev=new eE.FM8,this._moveCurr=new eE.FM8,this._lastAxis=new eE.Pa4,this._zoomStart=new eE.FM8,this._zoomEnd=new eE.FM8,this._panStart=new eE.FM8,this._panEnd=new eE.FM8,this._pointers=[],this._pointerPositions={},this._onPointerMove=mK.bind(this),this._onPointerDown=mX.bind(this),this._onPointerUp=mY.bind(this),this._onPointerCancel=mJ.bind(this),this._onContextMenu=m4.bind(this),this._onMouseWheel=m3.bind(this),this._onKeyDown=m$.bind(this),this._onKeyUp=mZ.bind(this),this._onTouchStart=m5.bind(this),this._onTouchMove=m6.bind(this),this._onTouchEnd=m8.bind(this),this._onMouseDown=m0.bind(this),this._onMouseMove=m1.bind(this),this._onMouseUp=m2.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,null!==i&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){let e=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-i.clientLeft,this.screen.top=e.top+window.pageYOffset-i.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>1e-6&&(this.dispatchEvent(mP),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>1e-6||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(mP),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=mO.NONE,this.keyState=mO.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(mP),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(mk.copy(this._panEnd).sub(this._panStart),mk.lengthSq()){if(this.object.isOrthographicCamera){let e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,i=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;mk.x*=e,mk.y*=i}mk.multiplyScalar(this._eye.length()*this.panSpeed),mz.copy(this._eye).cross(this.object.up).setLength(mk.x),mz.add(mF.copy(this.object.up).setLength(mk.y)),this.object.position.add(mz),this.target.add(mz),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(mk.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){mW.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=mW.length();e?(this._eye.copy(this.object.position).sub(this.target),mj.copy(this._eye).normalize(),mH.copy(this.object.up).normalize(),mQ.crossVectors(mH,mj).normalize(),mH.setLength(this._moveCurr.y-this._movePrev.y),mQ.setLength(this._moveCurr.x-this._movePrev.x),mW.copy(mH.add(mQ)),mG.crossVectors(mW,this._eye).normalize(),e*=this.rotateSpeed,mV.setFromAxisAngle(mG,e),this._eye.applyQuaternion(mV),this.object.up.applyQuaternion(mV),this._lastAxis.copy(mG),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),mV.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(mV),this.object.up.applyQuaternion(mV)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===mO.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=eE.M8C.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!=(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed)&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=eE.M8C.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,i){return mU.set((e-this.screen.left)/this.screen.width,(i-this.screen.top)/this.screen.height),mU}_getMouseOnCircle(e,i){return mU.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-i))/this.screen.width),mU}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId==e.pointerId){this._pointers.splice(i,1);return}}_trackPointer(e){let i=this._pointerPositions[e.pointerId];void 0===i&&(i=new eE.FM8,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){let i=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[i.pointerId]}_checkDistances(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function mX(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e))}function mK(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function mY(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchEnd(e):this._onMouseUp(),this._removePointer(e),0===this._pointers.length&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function mJ(e){this._removePointer(e)}function mZ(){!1!==this.enabled&&(this.keyState=mO.NONE,window.addEventListener("keydown",this._onKeyDown))}function m$(e){!1!==this.enabled&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===mO.NONE&&(e.code!==this.keys[mO.ROTATE]||this.noRotate?e.code!==this.keys[mO.ZOOM]||this.noZoom?e.code!==this.keys[mO.PAN]||this.noPan||(this.keyState=mO.PAN):this.keyState=mO.ZOOM:this.keyState=mO.ROTATE))}function m0(e){let i;switch(e.button){case 0:i=this.mouseButtons.LEFT;break;case 1:i=this.mouseButtons.MIDDLE;break;case 2:i=this.mouseButtons.RIGHT;break;default:i=-1}switch(i){case eE.RsA.DOLLY:this.state=mO.ZOOM;break;case eE.RsA.ROTATE:this.state=mO.ROTATE;break;case eE.RsA.PAN:this.state=mO.PAN;break;default:this.state=mO.NONE}let n=this.keyState!==mO.NONE?this.keyState:this.state;n!==mO.ROTATE||this.noRotate?n!==mO.ZOOM||this.noZoom?n!==mO.PAN||this.noPan||(this._panStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.dispatchEvent(mD)}function m1(e){let i=this.keyState!==mO.NONE?this.keyState:this.state;i!==mO.ROTATE||this.noRotate?i!==mO.ZOOM||this.noZoom?i!==mO.PAN||this.noPan||this._panEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)))}function m2(){this.state=mO.NONE,this.dispatchEvent(mN)}function m3(e){if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.dispatchEvent(mD),this.dispatchEvent(mN)}}function m4(e){!1!==this.enabled&&e.preventDefault()}function m5(e){if(this._trackPointer(e),1===this._pointers.length)this.state=mO.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);else{this.state=mO.TOUCH_ZOOM_PAN;let e=this._pointers[0].pageX-this._pointers[1].pageX,i=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+i*i);let n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,r)),this._panEnd.copy(this._panStart)}this.dispatchEvent(mD)}function m6(e){if(this._trackPointer(e),1===this._pointers.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY));else{let i=this._getSecondPointerPosition(e),n=e.pageX-i.x,r=e.pageY-i.y;this._touchZoomDistanceEnd=Math.sqrt(n*n+r*r);let s=(e.pageX+i.x)/2,a=(e.pageY+i.y)/2;this._panEnd.copy(this._getMouseOnScreen(s,a))}}function m8(e){switch(this._pointers.length){case 0:this.state=mO.NONE;break;case 1:this.state=mO.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=mO.TOUCH_ZOOM_PAN;for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId!==e.pointerId){let e=this._pointerPositions[this._pointers[i].pointerId];this._moveCurr.copy(this._getMouseOnCircle(e.x,e.y)),this._movePrev.copy(this._moveCurr);break}}this.dispatchEvent(mN)}let m7={type:"change"},m9={type:"start"},ge={type:"end"},gt=new eE.zHn,gi=new eE.JOQ,gn=Math.cos(70*eE.M8C.DEG2RAD),gr=new eE.Pa4,gs=2*Math.PI,ga={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};class go extends eE.ZXd{constructor(e,i=null){super(e,i),this.state=ga.NONE,this.enabled=!0,this.target=new eE.Pa4,this.cursor=new eE.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:eE.RsA.ROTATE,MIDDLE:eE.RsA.DOLLY,RIGHT:eE.RsA.PAN},this.touches={ONE:eE.QmN.ROTATE,TWO:eE.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new eE.Pa4,this._lastQuaternion=new eE._fP,this._lastTargetPosition=new eE.Pa4,this._quat=new eE._fP().setFromUnitVectors(e.up,new eE.Pa4(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new eE.$V,this._sphericalDelta=new eE.$V,this._scale=1,this._panOffset=new eE.Pa4,this._rotateStart=new eE.FM8,this._rotateEnd=new eE.FM8,this._rotateDelta=new eE.FM8,this._panStart=new eE.FM8,this._panEnd=new eE.FM8,this._panDelta=new eE.FM8,this._dollyStart=new eE.FM8,this._dollyEnd=new eE.FM8,this._dollyDelta=new eE.FM8,this._dollyDirection=new eE.Pa4,this._mouse=new eE.FM8,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=gh.bind(this),this._onPointerDown=gl.bind(this),this._onPointerUp=gu.bind(this),this._onContextMenu=gA.bind(this),this._onMouseWheel=gp.bind(this),this._onKeyDown=gf.bind(this),this._onTouchStart=gm.bind(this),this._onTouchMove=gg.bind(this),this._onMouseDown=gc.bind(this),this._onMouseMove=gd.bind(this),this._interceptControlDown=gv.bind(this),this._interceptControlUp=gy.bind(this),null!==this.domElement&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(m7),this.update(),this.state=ga.NONE}update(e=null){let i=this.object.position;gr.copy(i).sub(this.target),gr.applyQuaternion(this._quat),this._spherical.setFromVector3(gr),this.autoRotate&&this.state===ga.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=gs:n>Math.PI&&(n-=gs),r<-Math.PI?r+=gs:r>Math.PI&&(r-=gs),n<=r?this._spherical.theta=Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{let e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=e!=this._spherical.radius}if(gr.setFromSpherical(this._spherical),gr.applyQuaternion(this._quatInverse),i.copy(this.target).add(gr),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){let i=gr.length();e=this._clampDistance(i*this._scale);let n=i-e;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),s=!!n}else if(this.object.isOrthographicCamera){let i=new eE.Pa4(this._mouse.x,this._mouse.y,0);i.unproject(this.object);let n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=n!==this.object.zoom;let r=new eE.Pa4(this._mouse.x,this._mouse.y,0);r.unproject(this.object),this.object.position.sub(r).add(i),this.object.updateMatrixWorld(),e=gr.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(gt.origin.copy(this.object.position),gt.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(gt.direction))<gn?this.object.lookAt(this.target):(gi.setFromNormalAndCoplanarPoint(this.object.up,this.target),gt.intersectPlane(gi,this.target))))}else if(this.object.isOrthographicCamera){let e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,!!(s||this._lastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this._lastQuaternion.dot(this.object.quaternion))>1e-6||this._lastTargetPosition.distanceToSquared(this.target)>1e-6)&&(this.dispatchEvent(m7),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?gs/60*this.autoRotateSpeed*e:gs/60/60*this.autoRotateSpeed}_getZoomScale(e){let i=Math.abs(.01*e);return Math.pow(.95,this.zoomSpeed*i)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,i){gr.setFromMatrixColumn(i,0),gr.multiplyScalar(-e),this._panOffset.add(gr)}_panUp(e,i){!0===this.screenSpacePanning?gr.setFromMatrixColumn(i,1):(gr.setFromMatrixColumn(i,0),gr.crossVectors(this.object.up,gr)),gr.multiplyScalar(e),this._panOffset.add(gr)}_pan(e,i){let n=this.domElement;if(this.object.isPerspectiveCamera){let r=this.object.position;gr.copy(r).sub(this.target);let s=gr.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/n.clientHeight,this.object.matrix),this._panUp(2*i*s/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(i*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,i){if(!this.zoomToCursor)return;this._performCursorZoom=!0;let n=this.domElement.getBoundingClientRect(),r=e-n.left,s=i-n.top,a=n.width,o=n.height;this._mouse.x=r/a*2-1,this._mouse.y=-(s/o*2)+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);let i=this.domElement;this._rotateLeft(gs*this._rotateDelta.x/i.clientHeight),this._rotateUp(gs*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let i=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(gs*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),i=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-gs*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),i=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(gs*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),i=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-gs*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),i=!0}i&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{let i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),r=.5*(e.pageY+i.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{let i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),r=.5*(e.pageY+i.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){let i=this._getSecondPointerPosition(e),n=e.pageX-i.x,r=e.pageY-i.y,s=Math.sqrt(n*n+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{let i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),r=.5*(e.pageY+i.y);this._rotateEnd.set(n,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);let i=this.domElement;this._rotateLeft(gs*this._rotateDelta.x/i.clientHeight),this._rotateUp(gs*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{let i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),r=.5*(e.pageY+i.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){let i=this._getSecondPointerPosition(e),n=e.pageX-i.x,r=e.pageY-i.y,s=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);let a=(e.pageX+i.x)*.5,o=(e.pageY+i.y)*.5;this._updateZoomParameters(a,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId){this._pointers.splice(i,1);return}}_isTrackingPointer(e){for(let i=0;i<this._pointers.length;i++)if(this._pointers[i]==e.pointerId)return!0;return!1}_trackPointer(e){let i=this._pointerPositions[e.pointerId];void 0===i&&(i=new eE.FM8,this._pointerPositions[e.pointerId]=i),i.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){let i=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[i]}_customWheelEvent(e){let i=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(i){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function gl(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(e)||(this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e)))}function gh(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function gu(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(ge),this.state=ga.NONE;break;case 1:let i=this._pointers[0],n=this._pointerPositions[i];this._onTouchStart({pointerId:i,pageX:n.x,pageY:n.y})}}function gc(e){let i;switch(e.button){case 0:i=this.mouseButtons.LEFT;break;case 1:i=this.mouseButtons.MIDDLE;break;case 2:i=this.mouseButtons.RIGHT;break;default:i=-1}switch(i){case eE.RsA.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(e),this.state=ga.DOLLY;break;case eE.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=ga.PAN}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=ga.ROTATE}break;case eE.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=ga.ROTATE}else{if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=ga.PAN}break;default:this.state=ga.NONE}this.state!==ga.NONE&&this.dispatchEvent(m9)}function gd(e){switch(this.state){case ga.ROTATE:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(e);break;case ga.DOLLY:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(e);break;case ga.PAN:if(!1===this.enablePan)return;this._handleMouseMovePan(e)}}function gp(e){!1!==this.enabled&&!1!==this.enableZoom&&this.state===ga.NONE&&(e.preventDefault(),this.dispatchEvent(m9),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(ge))}function gf(e){!1!==this.enabled&&this._handleKeyDown(e)}function gm(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case eE.QmN.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(e),this.state=ga.TOUCH_ROTATE;break;case eE.QmN.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(e),this.state=ga.TOUCH_PAN;break;default:this.state=ga.NONE}break;case 2:switch(this.touches.TWO){case eE.QmN.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(e),this.state=ga.TOUCH_DOLLY_PAN;break;case eE.QmN.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(e),this.state=ga.TOUCH_DOLLY_ROTATE;break;default:this.state=ga.NONE}break;default:this.state=ga.NONE}this.state!==ga.NONE&&this.dispatchEvent(m9)}function gg(e){switch(this._trackPointer(e),this.state){case ga.TOUCH_ROTATE:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(e),this.update();break;case ga.TOUCH_PAN:if(!1===this.enablePan)return;this._handleTouchMovePan(e),this.update();break;case ga.TOUCH_DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(e),this.update();break;case ga.TOUCH_DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=ga.NONE}}function gA(e){!1!==this.enabled&&e.preventDefault()}function gv(e){"Control"===e.key&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function gy(e){"Control"===e.key&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}let gx={type:"change"},g_=new eE._fP;class gb extends eE.ZXd{constructor(e,i=null){super(e,i),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new eE.Pa4(0,0,0),this._rotationVector=new eE.Pa4(0,0,0),this._lastQuaternion=new eE._fP,this._lastPosition=new eE.Pa4,this._status=0,this._onKeyDown=gE.bind(this),this._onKeyUp=gw.bind(this),this._onPointerMove=gC.bind(this),this._onPointerDown=gM.bind(this),this._onPointerUp=gS.bind(this),this._onPointerCancel=gT.bind(this),this._onContextMenu=gR.bind(this),null!==i&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(!1===this.enabled)return;let i=this.object,n=e*this.movementSpeed,r=e*this.rollSpeed;i.translateX(this._moveVector.x*n),i.translateY(this._moveVector.y*n),i.translateZ(this._moveVector.z*n),g_.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),i.quaternion.multiply(g_),(this._lastPosition.distanceToSquared(i.position)>1e-6||8*(1-this._lastQuaternion.dot(i.quaternion))>1e-6)&&(this.dispatchEvent(gx),this._lastQuaternion.copy(i.quaternion),this._lastPosition.copy(i.position))}_updateMovementVector(){let e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function gE(e){if(!e.altKey&&!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1}this._updateMovementVector(),this._updateRotationVector()}}function gw(e){if(!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0}this._updateMovementVector(),this._updateRotationVector()}}function gM(e){if(!1!==this.enabled){if(this.dragToLook)this._status++;else{switch(e.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1}this._updateMovementVector()}}}function gC(e){if(!1!==this.enabled&&(!this.dragToLook||this._status>0)){let i=this._getContainerDimensions(),n=i.size[0]/2,r=i.size[1]/2;this._moveState.yawLeft=-(e.pageX-i.offset[0]-n)/n,this._moveState.pitchDown=(e.pageY-i.offset[1]-r)/r,this._updateRotationVector()}}function gS(e){if(!1!==this.enabled){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(e.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0}this._updateMovementVector()}this._updateRotationVector()}}function gT(){!1!==this.enabled&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function gR(e){!1!==this.enabled&&e.preventDefault()}let gI={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class gB{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}let gL=new eE.iKG(-1,1,1,-1,0,1);class gP extends eE.u9r{constructor(){super(),this.setAttribute("position",new eE.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new eE.a$l([0,2,0,0,2,0],2))}}let gD=new gP;class gN{constructor(e){this._mesh=new eE.Kj0(gD,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,gL)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class gO extends gB{constructor(e,i){super(),this.textureID=void 0!==i?i:"tDiffuse",e instanceof eE.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=eE.rDY.clone(e.uniforms),this.material=new eE.jyz({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new gN(this.material)}render(e,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class gU extends gB{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,n){let r,s;let a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(r=0,s=1):(r=1,s=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,r,0xffffffff),o.buffers.stencil.setClear(s),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,0xffffffff),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}}class gk extends gB{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class gF{constructor(e,i){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===i){let n=e.getSize(new eE.FM8);this._width=n.width,this._height=n.height,(i=new eE.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:eE.cLu})).texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new gO(gI),this.copyPass.material.blending=eE.jFi,this.clock=new eE.SUY}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let i=this.passes.indexOf(e);-1!==i&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());let i=this.renderer.getRenderTarget(),n=!1;for(let i=0,r=this.passes.length;i<r;i++){let r=this.passes[i];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),r.needsSwap){if(n){let i=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(i.NOTEQUAL,1,0xffffffff),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(i.EQUAL,1,0xffffffff)}this.swapBuffers()}void 0!==gU&&(r instanceof gU?n=!0:r instanceof gk&&(n=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(void 0===e){let i=this.renderer.getSize(new eE.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;let n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class gz extends gB{constructor(e,i,n=null,r=null,s=null){super(),this.scene=e,this.camera=i,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new eE.Ilk}render(e,i,n){let r,s;let a=e.autoClear;e.autoClear=!1,null!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(r=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),!0==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(r),null!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=a}}var gG=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1}}),Back:Object.freeze({In:function(e){return 1===e?1:e*e*(2.70158*e-1.70158)},Out:function(e){return 0===e?0:--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return(e*=2)<1?e*e*(3.5949095*e-2.5949095)*.5:.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}}),Bounce:Object.freeze({In:function(e){return 1-gG.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*gG.Bounce.In(2*e):.5*gG.Bounce.Out(2*e-1)+.5}}),generatePow:function(e){return void 0===e&&(e=4),e=(e=e<Number.EPSILON?Number.EPSILON:e)>1e4?1e4:e,{In:function(i){return Math.pow(i,e)},Out:function(i){return 1-Math.pow(1-i,e)},InOut:function(i){return i<.5?Math.pow(2*i,e)/2:(1-Math.pow(2-2*i,e))/2+.5}}}}),gV=function(){return performance.now()},gj=function(){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(i){return e._tweens[i]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];for(var r=0;r<i.length;r++){var s=i[r];null===(e=s._group)||void 0===e||e.remove(s),s._group=this,this._tweens[s.getId()]=s,this._tweensAddedDuringUpdate[s.getId()]=s}},e.prototype.remove=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(var n=0;n<e.length;n++){var r=e[n];r._group=void 0,delete this._tweens[r.getId()],delete this._tweensAddedDuringUpdate[r.getId()]}},e.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},e.prototype.update=function(e,i){void 0===e&&(e=gV()),void 0===i&&(i=!0);var n=Object.keys(this._tweens);if(0!==n.length)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var s=this._tweens[n[r]],a=!i;s&&!1===s.update(e,a)&&!i&&this.remove(s)}n=Object.keys(this._tweensAddedDuringUpdate)}},e}(),gH={Linear:function(e,i){var n=e.length-1,r=n*i,s=Math.floor(r),a=gH.Utils.Linear;return i<0?a(e[0],e[1],r):i>1?a(e[n],e[n-1],n-r):a(e[s],e[s+1>n?n:s+1],r-s)},Bezier:function(e,i){for(var n=0,r=e.length-1,s=Math.pow,a=gH.Utils.Bernstein,o=0;o<=r;o++)n+=s(1-i,r-o)*s(i,o)*e[o]*a(r,o);return n},CatmullRom:function(e,i){var n=e.length-1,r=n*i,s=Math.floor(r),a=gH.Utils.CatmullRom;return e[0]===e[n]?(i<0&&(s=Math.floor(r=n*(1+i))),a(e[(s-1+n)%n],e[s],e[(s+1)%n],e[(s+2)%n],r-s)):i<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):i>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[s?s-1:0],e[s],e[n<s+1?n:s+1],e[n<s+2?n:s+2],r-s)},Utils:{Linear:function(e,i,n){return(i-e)*n+e},Bernstein:function(e,i){var n=gH.Utils.Factorial;return n(e)/n(i)/n(e-i)},Factorial:(gX=[1],function(e){var i=1;if(gX[e])return gX[e];for(var n=e;n>1;n--)i*=n;return gX[e]=i,i}),CatmullRom:function(e,i,n,r,s){var a=(n-e)*.5,o=(r-i)*.5,l=s*s;return s*l*(2*i-2*n+a+o)+(-3*i+3*n-2*a-o)*l+a*s+i}}},gQ=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),gW=new gj,gq=function(){function e(e,i){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=gG.Linear.None,this._interpolationFunction=gH.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=gQ.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,"object"==typeof i?(this._group=i,i.add(this)):!0===i&&(this._group=gW,gW.add(this))}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(e,i){if(void 0===i&&(i=1e3),this._isPlaying)throw Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=i<0?0:i,this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e<0?0:e,this},e.prototype.dynamic=function(e){return void 0===e&&(e=!1),this._isDynamic=e,this},e.prototype.start=function(e,i){if(void 0===e&&(e=gV()),void 0===i&&(i=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed)for(var n in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},e.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},e.prototype._setupProperties=function(e,i,n,r,s){for(var a in n){var o=e[a],l=Array.isArray(o),h=l?"array":typeof o,u=!l&&Array.isArray(n[a]);if("undefined"!==h&&"function"!==h){if(u){var c=n[a];if(0===c.length)continue;for(var d=[o],p=0,f=c.length;p<f;p+=1){var m=this._handleRelativeValue(o,c[p]);if(isNaN(m)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}d.push(m)}u&&(n[a]=d)}if(("object"===h||l)&&o&&!u){for(var g in i[a]=l?[]:{},o)i[a][g]=o[g];r[a]=l?[]:{};var c=n[a];if(!this._isDynamic){var A={};for(var g in c)A[g]=c[g];n[a]=c=A}this._setupProperties(o,i[a],c,r[a],s)}else(void 0===i[a]||s)&&(i[a]=o),l||(i[a]*=1),u?r[a]=n[a].slice().reverse():r[a]=i[a]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object)),this},e.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},e.prototype.pause=function(e){return void 0===e&&(e=gV()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e),this},e.prototype.resume=function(e){return void 0===e&&(e=gV()),this._isPaused&&this._isPlaying&&(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0),this},e.prototype.stopChainedTweens=function(){for(var e=0,i=this._chainedTweens.length;e<i;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return e?e.add(this):console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this},e.prototype.remove=function(){var e;return null===(e=this._group)||void 0===e||e.remove(this),this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=gG.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=gH.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(i,n){var r,s,a=this;if(void 0===i&&(i=gV()),void 0===n&&(n=e.autoStartOnUpdate),this._isPaused)return!0;if(!this._goToEnd&&!this._isPlaying){if(!n)return!1;this.start(i,!0)}if(this._goToEnd=!1,i<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=i-this._startTime,l=this._duration+(null!==(r=this._repeatDelayTime)&&void 0!==r?r:this._delayTime),h=this._duration+this._repeat*l,u=function(){if(0===a._duration||o>h)return 1;var e=Math.trunc(o/l),i=Math.min((o-e*l)/a._duration,1);return 0===i&&o===a._duration?1:i}(),c=this._easingFunction(u);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,c),this._onUpdateCallback&&this._onUpdateCallback(this._object,u),0===this._duration||o>=this._duration){if(this._repeat>0){var d=Math.min(Math.trunc((o-this._duration)/l)+1,this._repeat);for(s in isFinite(this._repeat)&&(this._repeat-=d),this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[s]||(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*d,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var p=0,f=this._chainedTweens.length;p<f;p++)this._chainedTweens[p].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}}return!0},e.prototype._updateProperties=function(e,i,n,r){for(var s in n)if(void 0!==i[s]){var a=i[s]||0,o=n[s],l=Array.isArray(e[s]),h=Array.isArray(o);!l&&h?e[s]=this._interpolationFunction(o,r):"object"==typeof o&&o?this._updateProperties(e[s],a,o,r):"number"==typeof(o=this._handleRelativeValue(a,o))&&(e[s]=a+(o-a)*r)}},e.prototype._handleRelativeValue=function(e,i){return"string"!=typeof i?i:"+"===i.charAt(0)||"-"===i.charAt(0)?e+parseFloat(i):parseFloat(i)},e.prototype._swapEndStartRepeatValues=function(e){var i=this._valuesStartRepeat[e],n=this._valuesEnd[e];"string"==typeof n?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=i},e.autoStartOnUpdate=!1,e}();gQ.nextId,gW.getAll.bind(gW),gW.removeAll.bind(gW),gW.add.bind(gW),gW.remove.bind(gW),gW.update.bind(gW);var gX,gK,gY,gJ,gZ,g$,g0,g1,g2,g3,g4,g5,g6,g8=n(97958),g7=n(41354),g9={},Ae=[],At=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ai=Array.isArray;function An(e,i){for(var n in i)e[n]=i[n];return e}function Ar(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function As(e,i,n,r,s){var a={type:e,props:i,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==s?++gJ:s,__i:-1,__u:0};return null==s&&null!=gY.vnode&&gY.vnode(a),a}function Aa(e){return e.children}function Ao(e,i){this.props=e,this.context=i}function Al(e,i){if(null==i)return e.__?Al(e.__,e.__i+1):null;for(var n;i<e.__k.length;i++)if(null!=(n=e.__k[i])&&null!=n.__e)return n.__e;return"function"==typeof e.type?Al(e):null}function Ah(e){(!e.__d&&(e.__d=!0)&&g$.push(e)&&!Au.__r++||g0!==gY.debounceRendering)&&((g0=gY.debounceRendering)||g1)(Au)}function Au(){var e,i,n,r,s,a,o,l;for(g$.sort(g2);e=g$.shift();)e.__d&&(i=g$.length,r=void 0,a=(s=(n=e).__v).__e,o=[],l=[],n.__P&&((r=An({},s)).__v=s.__v+1,gY.vnode&&gY.vnode(r),Am(n.__P,r,s,n.__n,n.__P.namespaceURI,32&s.__u?[a]:null,o,null==a?Al(s):a,!!(32&s.__u),l),r.__v=s.__v,r.__.__k[r.__i]=r,Ag(o,r,l),r.__e!=a&&function e(i){var n,r;if(null!=(i=i.__)&&null!=i.__c){for(i.__e=i.__c.base=null,n=0;n<i.__k.length;n++)if(null!=(r=i.__k[n])&&null!=r.__e){i.__e=i.__c.base=r.__e;break}return e(i)}}(r)),g$.length>i&&g$.sort(g2));Au.__r=0}function Ac(e,i,n,r,s,a,o,l,h,u,c){var d,p,f,m,g,A,v=r&&r.__k||Ae,y=i.length;for(h=function(e,i,n,r,s){var a,o,l,h,u,c=n.length,d=c,p=0;for(e.__k=Array(s),a=0;a<s;a++)null!=(o=i[a])&&"boolean"!=typeof o&&"function"!=typeof o?(h=a+p,(o=e.__k[a]="string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?As(null,o,null,null,null):Ai(o)?As(Aa,{children:o},null,null,null):void 0===o.constructor&&o.__b>0?As(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=e,o.__b=e.__b+1,l=null,-1!==(u=o.__i=function(e,i,n,r){var s,a,o=e.key,l=e.type,h=i[n];if(null===h||h&&o==h.key&&l===h.type&&0==(2&h.__u))return n;if(r>+(null!=h&&0==(2&h.__u)))for(s=n-1,a=n+1;s>=0||a<i.length;){if(s>=0){if((h=i[s])&&0==(2&h.__u)&&o==h.key&&l===h.type)return s;s--}if(a<i.length){if((h=i[a])&&0==(2&h.__u)&&o==h.key&&l===h.type)return a;a++}}return -1}(o,n,h,d))&&(d--,(l=n[u])&&(l.__u|=2)),null==l||null===l.__v?(-1==u&&p--,"function"!=typeof o.type&&(o.__u|=4)):u!=h&&(u==h-1?p--:u==h+1?p++:(u>h?p--:p++,o.__u|=4))):e.__k[a]=null;if(d)for(a=0;a<c;a++)null!=(l=n[a])&&0==(2&l.__u)&&(l.__e==r&&(r=Al(l)),function e(i,n,r){var s,a;if(gY.unmount&&gY.unmount(i),(s=i.ref)&&(s.current&&s.current!==i.__e||AA(s,null,n)),null!=(s=i.__c)){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(e){gY.__e(e,n)}s.base=s.__P=null}if(s=i.__k)for(a=0;a<s.length;a++)s[a]&&e(s[a],n,r||"function"!=typeof i.type);r||Ar(i.__e),i.__c=i.__=i.__e=void 0}(l,l));return r}(n,i,v,h,y),d=0;d<y;d++)null!=(f=n.__k[d])&&(p=-1===f.__i?g9:v[f.__i]||g9,f.__i=d,A=Am(e,f,p,s,a,o,l,h,u,c),m=f.__e,f.ref&&p.ref!=f.ref&&(p.ref&&AA(p.ref,null,f),c.push(f.ref,f.__c||m,f)),null==g&&null!=m&&(g=m),4&f.__u||p.__k===f.__k?h=function e(i,n,r){var s,a;if("function"==typeof i.type){for(s=i.__k,a=0;s&&a<s.length;a++)s[a]&&(s[a].__=i,n=e(s[a],n,r));return n}i.__e!=n&&(n&&i.type&&!r.contains(n)&&(n=Al(i)),r.insertBefore(i.__e,n||null),n=i.__e);do n=n&&n.nextSibling;while(null!=n&&8==n.nodeType);return n}(f,h,e):"function"==typeof f.type&&void 0!==A?h=A:m&&(h=m.nextSibling),f.__u&=-7);return n.__e=g,h}function Ad(e,i,n){"-"==i[0]?e.setProperty(i,null==n?"":n):e[i]=null==n?"":"number"!=typeof n||At.test(i)?n:n+"px"}function Ap(e,i,n,r,s){var a;s:if("style"==i){if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(i in r)n&&i in n||Ad(e.style,i,"");if(n)for(i in n)r&&n[i]===r[i]||Ad(e.style,i,n[i])}}else if("o"==i[0]&&"n"==i[1])a=i!=(i=i.replace(g3,"$1")),i=i.toLowerCase()in e||"onFocusOut"==i||"onFocusIn"==i?i.toLowerCase().slice(2):i.slice(2),e.l||(e.l={}),e.l[i+a]=n,n?r?n.u=r.u:(n.u=g4,e.addEventListener(i,a?g6:g5,a)):e.removeEventListener(i,a?g6:g5,a);else{if("http://www.w3.org/2000/svg"==s)i=i.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=i&&"height"!=i&&"href"!=i&&"list"!=i&&"form"!=i&&"tabIndex"!=i&&"download"!=i&&"rowSpan"!=i&&"colSpan"!=i&&"role"!=i&&"popover"!=i&&i in e)try{e[i]=null==n?"":n;break s}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!=i[4]?e.removeAttribute(i):e.setAttribute(i,"popover"==i&&1==n?"":n))}}function Af(e){return function(i){if(this.l){var n=this.l[i.type+e];if(null==i.t)i.t=g4++;else if(i.t<n.u)return;return n(gY.event?gY.event(i):i)}}}function Am(e,i,n,r,s,a,o,l,h,u){var c,d,p,f,m,g,A,v,y,x,_,b,E,w,M,C,S,T=i.type;if(void 0!==i.constructor)return null;128&n.__u&&(h=!!(32&n.__u),a=[l=i.__e=n.__e]),(c=gY.__b)&&c(i);s:if("function"==typeof T)try{if(v=i.props,y="prototype"in T&&T.prototype.render,x=(c=T.contextType)&&r[c.__c],_=c?x?x.props.value:c.__:r,n.__c?A=(d=i.__c=n.__c).__=d.__E:(y?i.__c=d=new T(v,_):(i.__c=d=new Ao(v,_),d.constructor=T,d.render=Av),x&&x.sub(d),d.props=v,d.state||(d.state={}),d.context=_,d.__n=r,p=d.__d=!0,d.__h=[],d._sb=[]),y&&null==d.__s&&(d.__s=d.state),y&&null!=T.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=An({},d.__s)),An(d.__s,T.getDerivedStateFromProps(v,d.__s))),f=d.props,m=d.state,d.__v=i,p)y&&null==T.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),y&&null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(y&&null==T.getDerivedStateFromProps&&v!==f&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(v,_),!d.__e&&(null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(v,d.__s,_)||i.__v==n.__v)){for(i.__v!=n.__v&&(d.props=v,d.state=d.__s,d.__d=!1),i.__e=n.__e,i.__k=n.__k,i.__k.some(function(e){e&&(e.__=i)}),b=0;b<d._sb.length;b++)d.__h.push(d._sb[b]);d._sb=[],d.__h.length&&o.push(d);break s}null!=d.componentWillUpdate&&d.componentWillUpdate(v,d.__s,_),y&&null!=d.componentDidUpdate&&d.__h.push(function(){d.componentDidUpdate(f,m,g)})}if(d.context=_,d.props=v,d.__P=e,d.__e=!1,E=gY.__r,w=0,y){for(d.state=d.__s,d.__d=!1,E&&E(i),c=d.render(d.props,d.state,d.context),M=0;M<d._sb.length;M++)d.__h.push(d._sb[M]);d._sb=[]}else do d.__d=!1,E&&E(i),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++w<25);d.state=d.__s,null!=d.getChildContext&&(r=An(An({},r),d.getChildContext())),y&&!p&&null!=d.getSnapshotBeforeUpdate&&(g=d.getSnapshotBeforeUpdate(f,m)),l=Ac(e,Ai(C=null!=c&&c.type===Aa&&null==c.key?c.props.children:c)?C:[C],i,n,r,s,a,o,l,h,u),d.base=i.__e,i.__u&=-161,d.__h.length&&o.push(d),A&&(d.__E=d.__=null)}catch(e){if(i.__v=null,h||null!=a){if(e.then){for(i.__u|=h?160:128;l&&8==l.nodeType&&l.nextSibling;)l=l.nextSibling;a[a.indexOf(l)]=null,i.__e=l}else for(S=a.length;S--;)Ar(a[S])}else i.__e=n.__e,i.__k=n.__k;gY.__e(e,i,n)}else null==a&&i.__v==n.__v?(i.__k=n.__k,i.__e=n.__e):l=i.__e=function(e,i,n,r,s,a,o,l,h){var u,c,d,p,f,m,g,A=n.props,v=i.props,y=i.type;if("svg"==y?s="http://www.w3.org/2000/svg":"math"==y?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),null!=a){for(u=0;u<a.length;u++)if((f=a[u])&&"setAttribute"in f==!!y&&(y?f.localName==y:3==f.nodeType)){e=f,a[u]=null;break}}if(null==e){if(null==y)return document.createTextNode(v);e=document.createElementNS(s,y,v.is&&v),l&&(gY.__m&&gY.__m(i,a),l=!1),a=null}if(null===y)A===v||l&&e.data===v||(e.data=v);else{if(a=a&&gK.call(e.childNodes),A=n.props||g9,!l&&null!=a)for(A={},u=0;u<e.attributes.length;u++)A[(f=e.attributes[u]).name]=f.value;for(u in A)if(f=A[u],"children"==u);else if("dangerouslySetInnerHTML"==u)d=f;else if(!(u in v)){if("value"==u&&"defaultValue"in v||"checked"==u&&"defaultChecked"in v)continue;Ap(e,u,null,f,s)}for(u in v)f=v[u],"children"==u?p=f:"dangerouslySetInnerHTML"==u?c=f:"value"==u?m=f:"checked"==u?g=f:l&&"function"!=typeof f||A[u]===f||Ap(e,u,f,A[u],s);if(c)l||d&&(c.__html===d.__html||c.__html===e.innerHTML)||(e.innerHTML=c.__html),i.__k=[];else if(d&&(e.innerHTML=""),Ac(e,Ai(p)?p:[p],i,n,r,"foreignObject"==y?"http://www.w3.org/1999/xhtml":s,a,o,a?a[0]:n.__k&&Al(n,0),l,h),null!=a)for(u=a.length;u--;)Ar(a[u]);l||(u="value","progress"==y&&null==m?e.removeAttribute("value"):void 0===m||m===e[u]&&("progress"!=y||m)&&("option"!=y||m===A[u])||Ap(e,u,m,A[u],s),u="checked",void 0!==g&&g!==e[u]&&Ap(e,u,g,A[u],s))}return e}(n.__e,i,n,r,s,a,o,h,u);return(c=gY.diffed)&&c(i),128&i.__u?void 0:l}function Ag(e,i,n){for(var r=0;r<n.length;r++)AA(n[r],n[++r],n[++r]);gY.__c&&gY.__c(i,e),e.some(function(i){try{e=i.__h,i.__h=[],e.some(function(e){e.call(i)})}catch(e){gY.__e(e,i.__v)}})}function AA(e,i,n){try{if("function"==typeof e){var r="function"==typeof e.__u;r&&e.__u(),r&&null==i||(e.__u=e(i))}else e.current=i}catch(e){gY.__e(e,n)}}function Av(e,i,n){return this.constructor(e,n)}function Ay(e,i,n){var r,s,a,o,l=An({},e.props);for(a in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),i)"key"==a?r=i[a]:"ref"==a?s=i[a]:l[a]=void 0===i[a]&&void 0!==o?o[a]:i[a];return arguments.length>2&&(l.children=arguments.length>3?gK.call(arguments,2):n),As(e.type,l,r||e.key,s||e.ref,null)}function Ax(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function A_(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ab(e){return(Ab="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}gK=Ae.slice,gY={__e:function(e,i,n,r){for(var s,a,o;i=i.__;)if((s=i.__c)&&!s.__)try{if((a=s.constructor)&&null!=a.getDerivedStateFromError&&(s.setState(a.getDerivedStateFromError(e)),o=s.__d),null!=s.componentDidCatch&&(s.componentDidCatch(e,r||{}),o=s.__d),o)return s.__E=s}catch(i){e=i}throw e}},gJ=0,gZ=function(e){return null!=e&&null==e.constructor},Ao.prototype.setState=function(e,i){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=An({},this.state),"function"==typeof e&&(e=e(An({},n),this.props)),e&&An(n,e),null!=e&&this.__v&&(i&&this._sb.push(i),Ah(this))},Ao.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ah(this))},Ao.prototype.render=Aa,g$=[],g1="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,g2=function(e,i){return e.__v.__b-i.__v.__b},Au.__r=0,g3=/(PointerCapture)$|Capture$/i,g4=0,g5=Af(!1),g6=Af(!0);var AE=function(e){if("object"!==Ab(e))return e;var i,n=Ay(e);return n.props&&(n.props=function(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?A_(Object(n),!0).forEach(function(i){var r,s;r=i,s=n[i],(r=function(e){var i=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A_(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}({},n.props),null!=n&&null!==(i=n.props)&&void 0!==i&&i.children&&(n.props.children=Array.isArray(n.props.children)?n.props.children.map(AE):AE(n.props.children))),n},Aw=function(e,i){var n,r,s,a,o,l;delete i.__k,n=AE(e),(r=i)==document&&(r=document.documentElement),gY.__&&gY.__(n,r),a=s&&s.__k||r.__k,o=[],l=[],Am(r,n=(s||r).__k=function(e,i,n){var r,s,a,o={};for(a in i)"key"==a?r=i[a]:"ref"==a?s=i[a]:o[a]=i[a];if(arguments.length>2&&(o.children=arguments.length>3?gK.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(a in e.defaultProps)void 0===o[a]&&(o[a]=e.defaultProps[a]);return As(e,o,r,s,null)}(Aa,null,[n]),a||g9,g9,r.namespaceURI,s?[s]:a?null:r.firstChild?gK.call(r.childNodes):null,o,s?s:a?a.__e:r.firstChild,!1,l),Ag(o,n,l)};!function(e,i){void 0===i&&(i={});var n=i.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===n&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(".float-tooltip-kap {\n  position: absolute;\n  width: max-content; /* prevent shrinking near right edge */\n  max-width: max(50%, 150px);\n  padding: 3px 5px;\n  border-radius: 3px;\n  font: 12px sans-serif;\n  color: #eee;\n  background: rgba(0,0,0,0.6);\n  pointer-events: none;\n}\n");var AM=(0,_.Z)({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.style,s=!!e&&"object"===Ab(e)&&!!e.node&&"function"==typeof e.node,a=(0,g8.Z)(s?e.node():e);"static"===a.style("position")&&a.style("position","relative"),i.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(void 0===r?{}:r).forEach(function(e){var n=function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{a=(n=n.call(e)).next;for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,2)||function(e,i){if(e){if("string"==typeof e)return Ax(e,2);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ax(e,i):void 0}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=n[0],s=n[1];return i.tooltipEl.style(r,s)}),i.tooltipEl.style("left","-10000px").style("display","none");var o="tooltip-".concat(Math.round(1e12*Math.random()));i.mouseInside=!1,a.on("mousemove.".concat(o),function(e){i.mouseInside=!0;var n=(0,g7.Z)(e),r=a.node(),s=r.offsetWidth,o=r.offsetHeight,l=[null===i.offsetX||void 0===i.offsetX?"-".concat(n[0]/s*100,"%"):"number"==typeof i.offsetX?"calc(-50% + ".concat(i.offsetX,"px)"):i.offsetX,null===i.offsetY||void 0===i.offsetY?o>130&&o-n[1]<100?"calc(-100% - 6px)":"21px":"number"==typeof i.offsetY?i.offsetY<0?"calc(-100% - ".concat(Math.abs(i.offsetY),"px)"):"".concat(i.offsetY,"px"):i.offsetY];i.tooltipEl.style("left",n[0]+"px").style("top",n[1]+"px").style("transform","translate(".concat(l.join(","),")")),i.content&&i.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(o),function(){i.mouseInside=!0,i.content&&i.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(o),function(){i.mouseInside=!1,i.tooltipEl.style("display","none")})},update:function(e){(e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content)?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):"string"==typeof e.content?e.tooltipEl.html(e.content):gZ(Ay(e.content))?(e.tooltipEl.text(""),Aw(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function AC(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function AS(e){return function(e){if(Array.isArray(e))return AC(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||AT(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AT(e,i){if(e){if("string"==typeof e)return AC(e,i);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?AC(e,i):void 0}}!function(e,i){void 0===i&&(i={});var n=i.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===n&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(".scene-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: sans-serif;\n  pointer-events: none;\n  user-select: none;\n}\n\n.scene-container canvas:focus {\n  outline: none;\n}");var AR=window.THREE?window.THREE:{WebGLRenderer:class{constructor(e={}){let i,n,r,s,a,o,l,h,u,c,d,p,f,m,g,A,v,y,x,_,b,E,w,M,C;let{canvas:S=(0,eE.O5A)(),context:T=null,depth:R=!0,stencil:I=!1,alpha:B=!1,antialias:L=!1,premultipliedAlpha:P=!0,preserveDrawingBuffer:D=!1,powerPreference:N="default",failIfMajorPerformanceCaveat:O=!1,reverseDepthBuffer:U=!1}=e;if(this.isWebGLRenderer=!0,null!==T){if("undefined"!=typeof WebGLRenderingContext&&T instanceof WebGLRenderingContext)throw Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");i=T.getContextAttributes().alpha}else i=B;let k=new Uint32Array(4),F=new Int32Array(4),z=null,G=null,V=[],j=[];this.domElement=S,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=eE.KI_,this.toneMapping=eE.uL9,this.toneMappingExposure=1;let H=this,Q=!1,W=0,q=0,X=null,K=-1,Y=null,J=new eE.Ltg,Z=new eE.Ltg,$=null,ee=new eE.Ilk(0),et=0,ei=S.width,en=S.height,er=1,es=null,ea=null,eo=new eE.Ltg(0,0,ei,en),el=new eE.Ltg(0,0,ei,en),eh=!1,eu=new eE.iWj,ec=!1,ed=!1;this.transmissionResolutionScale=1;let ep=new eE.yGw,ef=new eE.yGw,em=new eE.Pa4,eg=new eE.Ltg,eA={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},ev=!1;function ey(){return null===X?er:1}let ex=T;function e_(e,i){return S.getContext(e,i)}try{if("setAttribute"in S&&S.setAttribute("data-engine",`three.js r${eE.UZH}`),S.addEventListener("webglcontextlost",eM,!1),S.addEventListener("webglcontextrestored",eC,!1),S.addEventListener("webglcontextcreationerror",eS,!1),null===ex){let e="webgl2";if(ex=e_(e,{alpha:!0,depth:R,stencil:I,antialias:L,premultipliedAlpha:P,preserveDrawingBuffer:D,powerPreference:N,failIfMajorPerformanceCaveat:O}),null===ex){if(e_(e))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}}}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function eb(){(n=new tc(ex)).init(),w=new iK(ex,n),r=new e1(ex,n,e,w),s=new iq(ex,n),r.reverseDepthBuffer&&U&&s.buffers.depth.setReversed(!0),a=new tf(ex),o=new iD,l=new iX(ex,n,s,o,r,w,a),h=new e3(H),u=new tu(H),c=new eQ(ex),M=new e$(ex,c),d=new td(ex,c,a,M),p=new tg(ex,d,c,a),_=new tm(ex,r,l),v=new e2(o),f=new iP(H,h,u,n,r,M,v),m=new i4(H,o),g=new ik,A=new iH(n),x=new eZ(H,h,u,s,p,i,P),y=new iQ(H,p,r),C=new i5(ex,a,r,s),b=new e0(ex,n,a),E=new tp(ex,n,a),a.programs=f.programs,H.capabilities=r,H.extensions=n,H.properties=o,H.renderLists=g,H.shadowMap=y,H.state=s,H.info=a}eb();let ew=new i1(H,ex);function eM(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Q=!0}function eC(){console.log("THREE.WebGLRenderer: Context Restored."),Q=!1;let e=a.autoReset,i=y.enabled,n=y.autoUpdate,r=y.needsUpdate,s=y.type;eb(),a.autoReset=e,y.enabled=i,y.autoUpdate=n,y.needsUpdate=r,y.type=s}function eS(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function eT(e){var i;let n=e.target;n.removeEventListener("dispose",eT),function(e){let i=o.get(e).programs;void 0!==i&&(i.forEach(function(e){f.releaseProgram(e)}),e.isShaderMaterial&&f.releaseShaderCache(e))}(i=n),o.remove(i)}function eR(e,i,n){!0===e.transparent&&e.side===eE.ehD&&!1===e.forceSinglePass?(e.side=eE._Li,e.needsUpdate=!0,eF(e,i,n),e.side=eE.Wl3,e.needsUpdate=!0,eF(e,i,n),e.side=eE.ehD):eF(e,i,n)}this.xr=ew,this.getContext=function(){return ex},this.getContextAttributes=function(){return ex.getContextAttributes()},this.forceContextLoss=function(){let e=n.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=n.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return er},this.setPixelRatio=function(e){void 0!==e&&(er=e,this.setSize(ei,en,!1))},this.getSize=function(e){return e.set(ei,en)},this.setSize=function(e,i,n=!0){if(ew.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ei=e,en=i,S.width=Math.floor(e*er),S.height=Math.floor(i*er),!0===n&&(S.style.width=e+"px",S.style.height=i+"px"),this.setViewport(0,0,e,i)},this.getDrawingBufferSize=function(e){return e.set(ei*er,en*er).floor()},this.setDrawingBufferSize=function(e,i,n){ei=e,en=i,er=n,S.width=Math.floor(e*n),S.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(J)},this.getViewport=function(e){return e.copy(eo)},this.setViewport=function(e,i,n,r){e.isVector4?eo.set(e.x,e.y,e.z,e.w):eo.set(e,i,n,r),s.viewport(J.copy(eo).multiplyScalar(er).round())},this.getScissor=function(e){return e.copy(el)},this.setScissor=function(e,i,n,r){e.isVector4?el.set(e.x,e.y,e.z,e.w):el.set(e,i,n,r),s.scissor(Z.copy(el).multiplyScalar(er).round())},this.getScissorTest=function(){return eh},this.setScissorTest=function(e){s.setScissorTest(eh=e)},this.setOpaqueSort=function(e){es=e},this.setTransparentSort=function(e){ea=e},this.getClearColor=function(e){return e.copy(x.getClearColor())},this.setClearColor=function(){x.setClearColor.apply(x,arguments)},this.getClearAlpha=function(){return x.getClearAlpha()},this.setClearAlpha=function(){x.setClearAlpha.apply(x,arguments)},this.clear=function(e=!0,i=!0,n=!0){let r=0;if(e){let e=!1;if(null!==X){let i=X.texture.format;e=i===eE.E2K||i===eE.CtA||i===eE.D9w}if(e){let e=X.texture.type,i=e===eE.ywz||e===eE.JQ4||e===eE.LsT||e===eE.wJv||e===eE.k0A||e===eE.irR,n=x.getClearColor(),r=x.getClearAlpha(),s=n.r,a=n.g,o=n.b;i?(k[0]=s,k[1]=a,k[2]=o,k[3]=r,ex.clearBufferuiv(ex.COLOR,0,k)):(F[0]=s,F[1]=a,F[2]=o,F[3]=r,ex.clearBufferiv(ex.COLOR,0,F))}else r|=ex.COLOR_BUFFER_BIT}i&&(r|=ex.DEPTH_BUFFER_BIT),n&&(r|=ex.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(0xffffffff)),ex.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){S.removeEventListener("webglcontextlost",eM,!1),S.removeEventListener("webglcontextrestored",eC,!1),S.removeEventListener("webglcontextcreationerror",eS,!1),x.dispose(),g.dispose(),A.dispose(),o.dispose(),h.dispose(),u.dispose(),p.dispose(),M.dispose(),C.dispose(),f.dispose(),ew.dispose(),ew.removeEventListener("sessionstart",eB),ew.removeEventListener("sessionend",eL),eP.stop()},this.renderBufferDirect=function(e,i,a,p,f,g){let A;null===i&&(i=eA);let y=f.isMesh&&0>f.matrixWorld.determinant(),x=function(e,i,n,a,c){var d,p;!0!==i.isScene&&(i=eA),l.resetTextureUnits();let f=i.fog,g=a.isMeshStandardMaterial?i.environment:null,A=null===X?H.outputColorSpace:!0===X.isXRRenderTarget?X.texture.colorSpace:eE.GUF,y=(a.isMeshStandardMaterial?u:h).get(a.envMap||g),x=!0===a.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,b=!!n.attributes.tangent&&(!!a.normalMap||a.anisotropy>0),E=!!n.morphAttributes.position,w=!!n.morphAttributes.normal,M=!!n.morphAttributes.color,S=eE.uL9;a.toneMapped&&(null===X||!0===X.isXRRenderTarget)&&(S=H.toneMapping);let T=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,R=void 0!==T?T.length:0,I=o.get(a),B=G.state.lights;if(!0===ec&&(!0===ed||e!==Y)){let i=e===Y&&a.id===K;v.setState(a,e,i)}let L=!1;a.version===I.__version?I.needsLights&&I.lightsStateVersion!==B.state.version?L=!0:I.outputColorSpace!==A?L=!0:c.isBatchedMesh&&!1===I.batching?L=!0:c.isBatchedMesh||!0!==I.batching?c.isBatchedMesh&&!0===I.batchingColor&&null===c.colorTexture?L=!0:c.isBatchedMesh&&!1===I.batchingColor&&null!==c.colorTexture?L=!0:c.isInstancedMesh&&!1===I.instancing?L=!0:c.isInstancedMesh||!0!==I.instancing?c.isSkinnedMesh&&!1===I.skinning?L=!0:c.isSkinnedMesh||!0!==I.skinning?c.isInstancedMesh&&!0===I.instancingColor&&null===c.instanceColor?L=!0:c.isInstancedMesh&&!1===I.instancingColor&&null!==c.instanceColor?L=!0:c.isInstancedMesh&&!0===I.instancingMorph&&null===c.morphTexture?L=!0:c.isInstancedMesh&&!1===I.instancingMorph&&null!==c.morphTexture?L=!0:I.envMap!==y?L=!0:!0===a.fog&&I.fog!==f?L=!0:void 0!==I.numClippingPlanes&&(I.numClippingPlanes!==v.numPlanes||I.numIntersection!==v.numIntersection)?L=!0:I.vertexAlphas!==x?L=!0:I.vertexTangents!==b?L=!0:I.morphTargets!==E?L=!0:I.morphNormals!==w?L=!0:I.morphColors!==M?L=!0:I.toneMapping!==S?L=!0:I.morphTargetsCount!==R&&(L=!0):L=!0:L=!0:L=!0:(L=!0,I.__version=a.version);let P=I.currentProgram;!0===L&&(P=eF(a,i,c));let D=!1,N=!1,O=!1,U=P.getUniforms(),k=I.uniforms;if(s.useProgram(P.program)&&(D=!0,N=!0,O=!0),a.id!==K&&(K=a.id,N=!0),D||Y!==e){s.buffers.depth.getReversed()?(ep.copy(e.projectionMatrix),(0,eE.tNt)(ep),(0,eE.yHo)(ep),U.setValue(ex,"projectionMatrix",ep)):U.setValue(ex,"projectionMatrix",e.projectionMatrix),U.setValue(ex,"viewMatrix",e.matrixWorldInverse);let i=U.map.cameraPosition;void 0!==i&&i.setValue(ex,em.setFromMatrixPosition(e.matrixWorld)),r.logarithmicDepthBuffer&&U.setValue(ex,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(a.isMeshPhongMaterial||a.isMeshToonMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||a.isMeshStandardMaterial||a.isShaderMaterial)&&U.setValue(ex,"isOrthographic",!0===e.isOrthographicCamera),Y!==e&&(Y=e,N=!0,O=!0)}if(c.isSkinnedMesh){U.setOptional(ex,c,"bindMatrix"),U.setOptional(ex,c,"bindMatrixInverse");let e=c.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),U.setValue(ex,"boneTexture",e.boneTexture,l))}c.isBatchedMesh&&(U.setOptional(ex,c,"batchingTexture"),U.setValue(ex,"batchingTexture",c._matricesTexture,l),U.setOptional(ex,c,"batchingIdTexture"),U.setValue(ex,"batchingIdTexture",c._indirectTexture,l),U.setOptional(ex,c,"batchingColorTexture"),null!==c._colorsTexture&&U.setValue(ex,"batchingColorTexture",c._colorsTexture,l));let F=n.morphAttributes;if((void 0!==F.position||void 0!==F.normal||void 0!==F.color)&&_.update(c,n,P),(N||I.receiveShadow!==c.receiveShadow)&&(I.receiveShadow=c.receiveShadow,U.setValue(ex,"receiveShadow",c.receiveShadow)),a.isMeshGouraudMaterial&&null!==a.envMap&&(k.envMap.value=y,k.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1),a.isMeshStandardMaterial&&null===a.envMap&&null!==i.environment&&(k.envMapIntensity.value=i.environmentIntensity),N&&(U.setValue(ex,"toneMappingExposure",H.toneMappingExposure),I.needsLights&&(d=k,p=O,d.ambientLightColor.needsUpdate=p,d.lightProbe.needsUpdate=p,d.directionalLights.needsUpdate=p,d.directionalLightShadows.needsUpdate=p,d.pointLights.needsUpdate=p,d.pointLightShadows.needsUpdate=p,d.spotLights.needsUpdate=p,d.spotLightShadows.needsUpdate=p,d.rectAreaLights.needsUpdate=p,d.hemisphereLights.needsUpdate=p),f&&!0===a.fog&&m.refreshFogUniforms(k,f),m.refreshMaterialUniforms(k,a,er,en,G.state.transmissionRenderTarget[e.id]),ic.upload(ex,ez(I),k,l)),a.isShaderMaterial&&!0===a.uniformsNeedUpdate&&(ic.upload(ex,ez(I),k,l),a.uniformsNeedUpdate=!1),a.isSpriteMaterial&&U.setValue(ex,"center",c.center),U.setValue(ex,"modelViewMatrix",c.modelViewMatrix),U.setValue(ex,"normalMatrix",c.normalMatrix),U.setValue(ex,"modelMatrix",c.matrixWorld),a.isShaderMaterial||a.isRawShaderMaterial){let e=a.uniformsGroups;for(let i=0,n=e.length;i<n;i++){let n=e[i];C.update(n,P),C.bind(n,P)}}return P}(e,i,a,p,f);s.setMaterial(p,y);let w=a.index,S=1;if(!0===p.wireframe){if(void 0===(w=d.getWireframeAttribute(a)))return;S=2}let T=a.drawRange,R=a.attributes.position,I=T.start*S,B=(T.start+T.count)*S;null!==g&&(I=Math.max(I,g.start*S),B=Math.min(B,(g.start+g.count)*S)),null!==w?(I=Math.max(I,0),B=Math.min(B,w.count)):null!=R&&(I=Math.max(I,0),B=Math.min(B,R.count));let L=B-I;if(L<0||L===1/0)return;M.setup(f,p,x,a,w);let P=b;if(null!==w&&(A=c.get(w),(P=E).setIndex(A)),f.isMesh)!0===p.wireframe?(s.setLineWidth(p.wireframeLinewidth*ey()),P.setMode(ex.LINES)):P.setMode(ex.TRIANGLES);else if(f.isLine){let e=p.linewidth;void 0===e&&(e=1),s.setLineWidth(e*ey()),f.isLineSegments?P.setMode(ex.LINES):f.isLineLoop?P.setMode(ex.LINE_LOOP):P.setMode(ex.LINE_STRIP)}else f.isPoints?P.setMode(ex.POINTS):f.isSprite&&P.setMode(ex.TRIANGLES);if(f.isBatchedMesh){if(null!==f._multiDrawInstances)P.renderMultiDrawInstances(f._multiDrawStarts,f._multiDrawCounts,f._multiDrawCount,f._multiDrawInstances);else if(n.get("WEBGL_multi_draw"))P.renderMultiDraw(f._multiDrawStarts,f._multiDrawCounts,f._multiDrawCount);else{let e=f._multiDrawStarts,i=f._multiDrawCounts,n=f._multiDrawCount,r=w?c.get(w).bytesPerElement:1,s=o.get(p).currentProgram.getUniforms();for(let a=0;a<n;a++)s.setValue(ex,"_gl_DrawID",a),P.render(e[a]/r,i[a])}}else if(f.isInstancedMesh)P.renderInstances(I,L,f.count);else if(a.isInstancedBufferGeometry){let e=void 0!==a._maxInstanceCount?a._maxInstanceCount:1/0,i=Math.min(a.instanceCount,e);P.renderInstances(I,L,i)}else P.render(I,L)},this.compile=function(e,i,n=null){null===n&&(n=e),(G=A.get(n)).init(i),j.push(G),n.traverseVisible(function(e){e.isLight&&e.layers.test(i.layers)&&(G.pushLight(e),e.castShadow&&G.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(i.layers)&&(G.pushLight(e),e.castShadow&&G.pushShadow(e))}),G.setupLights();let r=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;let i=e.material;if(i){if(Array.isArray(i))for(let s=0;s<i.length;s++){let a=i[s];eR(a,n,e),r.add(a)}else eR(i,n,e),r.add(i)}}),j.pop(),G=null,r},this.compileAsync=function(e,i,r=null){let s=this.compile(e,i,r);return new Promise(i=>{function r(){if(s.forEach(function(e){o.get(e).currentProgram.isReady()&&s.delete(e)}),0===s.size){i(e);return}setTimeout(r,10)}null!==n.get("KHR_parallel_shader_compile")?r():setTimeout(r,10)})};let eI=null;function eB(){eP.stop()}function eL(){eP.start()}let eP=new eH;function eD(e,i,n,r){if(!1===e.visible)return;if(e.layers.test(i.layers)){if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(i);else if(e.isLight)G.pushLight(e),e.castShadow&&G.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||eu.intersectsSprite(e)){r&&eg.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ef);let i=p.update(e),s=e.material;s.visible&&z.push(e,i,s,n,eg.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||eu.intersectsObject(e))){let i=p.update(e),s=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),eg.copy(e.boundingSphere.center)):(null===i.boundingSphere&&i.computeBoundingSphere(),eg.copy(i.boundingSphere.center)),eg.applyMatrix4(e.matrixWorld).applyMatrix4(ef)),Array.isArray(s)){let r=i.groups;for(let a=0,o=r.length;a<o;a++){let o=r[a],l=s[o.materialIndex];l&&l.visible&&z.push(e,i,l,n,eg.z,o)}}else s.visible&&z.push(e,i,s,n,eg.z,null)}}let s=e.children;for(let e=0,a=s.length;e<a;e++)eD(s[e],i,n,r)}function eN(e,i,n,r){let a=e.opaque,o=e.transmissive,l=e.transparent;G.setupLightsView(n),!0===ec&&v.setGlobalState(H.clippingPlanes,n),r&&s.viewport(J.copy(r)),a.length>0&&eU(a,i,n),o.length>0&&eU(o,i,n),l.length>0&&eU(l,i,n),s.buffers.depth.setTest(!0),s.buffers.depth.setMask(!0),s.buffers.color.setMask(!0),s.setPolygonOffset(!1)}function eO(e,i,r,s){if(null!==(!0===r.isScene?r.overrideMaterial:null))return;void 0===G.state.transmissionRenderTarget[s.id]&&(G.state.transmissionRenderTarget[s.id]=new eE.dd2(1,1,{generateMipmaps:!0,type:n.has("EXT_color_buffer_half_float")||n.has("EXT_color_buffer_float")?eE.cLu:eE.ywz,minFilter:eE.D1R,samples:4,stencilBuffer:I,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:eE.epp.workingColorSpace}));let a=G.state.transmissionRenderTarget[s.id],o=s.viewport||J;a.setSize(o.z*H.transmissionResolutionScale,o.w*H.transmissionResolutionScale);let h=H.getRenderTarget();H.setRenderTarget(a),H.getClearColor(ee),(et=H.getClearAlpha())<1&&H.setClearColor(0xffffff,.5),H.clear(),ev&&x.render(r);let u=H.toneMapping;H.toneMapping=eE.uL9;let c=s.viewport;if(void 0!==s.viewport&&(s.viewport=void 0),G.setupLightsView(s),!0===ec&&v.setGlobalState(H.clippingPlanes,s),eU(e,r,s),l.updateMultisampleRenderTarget(a),l.updateRenderTargetMipmap(a),!1===n.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let n=0,a=i.length;n<a;n++){let a=i[n],o=a.object,l=a.geometry,h=a.material,u=a.group;if(h.side===eE.ehD&&o.layers.test(s.layers)){let i=h.side;h.side=eE._Li,h.needsUpdate=!0,ek(o,r,s,l,h,u),h.side=i,h.needsUpdate=!0,e=!0}}!0===e&&(l.updateMultisampleRenderTarget(a),l.updateRenderTargetMipmap(a))}H.setRenderTarget(h),H.setClearColor(ee,et),void 0!==c&&(s.viewport=c),H.toneMapping=u}function eU(e,i,n){let r=!0===i.isScene?i.overrideMaterial:null;for(let s=0,a=e.length;s<a;s++){let a=e[s],o=a.object,l=a.geometry,h=null===r?a.material:r,u=a.group;o.layers.test(n.layers)&&ek(o,i,n,l,h,u)}}function ek(e,i,n,r,s,a){e.onBeforeRender(H,i,n,r,s,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),s.onBeforeRender(H,i,n,r,e,a),!0===s.transparent&&s.side===eE.ehD&&!1===s.forceSinglePass?(s.side=eE._Li,s.needsUpdate=!0,H.renderBufferDirect(n,i,r,s,e,a),s.side=eE.Wl3,s.needsUpdate=!0,H.renderBufferDirect(n,i,r,s,e,a),s.side=eE.ehD):H.renderBufferDirect(n,i,r,s,e,a),e.onAfterRender(H,i,n,r,s,a)}function eF(e,i,n){var r;!0!==i.isScene&&(i=eA);let s=o.get(e),a=G.state.lights,l=G.state.shadowsArray,c=a.state.version,d=f.getParameters(e,a.state,l,i,n),p=f.getProgramCacheKey(d),m=s.programs;s.environment=e.isMeshStandardMaterial?i.environment:null,s.fog=i.fog,s.envMap=(e.isMeshStandardMaterial?u:h).get(e.envMap||s.environment),s.envMapRotation=null!==s.environment&&null===e.envMap?i.environmentRotation:e.envMapRotation,void 0===m&&(e.addEventListener("dispose",eT),m=new Map,s.programs=m);let g=m.get(p);if(void 0!==g){if(s.currentProgram===g&&s.lightsStateVersion===c)return eG(e,d),g}else d.uniforms=f.getUniforms(e),e.onBeforeCompile(d,H),g=f.acquireProgram(d,p),m.set(p,g),s.uniforms=d.uniforms;let A=s.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(A.clippingPlanes=v.uniform),eG(e,d),s.needsLights=(r=e).isMeshLambertMaterial||r.isMeshToonMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.isShadowMaterial||r.isShaderMaterial&&!0===r.lights,s.lightsStateVersion=c,s.needsLights&&(A.ambientLightColor.value=a.state.ambient,A.lightProbe.value=a.state.probe,A.directionalLights.value=a.state.directional,A.directionalLightShadows.value=a.state.directionalShadow,A.spotLights.value=a.state.spot,A.spotLightShadows.value=a.state.spotShadow,A.rectAreaLights.value=a.state.rectArea,A.ltc_1.value=a.state.rectAreaLTC1,A.ltc_2.value=a.state.rectAreaLTC2,A.pointLights.value=a.state.point,A.pointLightShadows.value=a.state.pointShadow,A.hemisphereLights.value=a.state.hemi,A.directionalShadowMap.value=a.state.directionalShadowMap,A.directionalShadowMatrix.value=a.state.directionalShadowMatrix,A.spotShadowMap.value=a.state.spotShadowMap,A.spotLightMatrix.value=a.state.spotLightMatrix,A.spotLightMap.value=a.state.spotLightMap,A.pointShadowMap.value=a.state.pointShadowMap,A.pointShadowMatrix.value=a.state.pointShadowMatrix),s.currentProgram=g,s.uniformsList=null,g}function ez(e){if(null===e.uniformsList){let i=e.currentProgram.getUniforms();e.uniformsList=ic.seqWithValue(i.seq,e.uniforms)}return e.uniformsList}function eG(e,i){let n=o.get(e);n.outputColorSpace=i.outputColorSpace,n.batching=i.batching,n.batchingColor=i.batchingColor,n.instancing=i.instancing,n.instancingColor=i.instancingColor,n.instancingMorph=i.instancingMorph,n.skinning=i.skinning,n.morphTargets=i.morphTargets,n.morphNormals=i.morphNormals,n.morphColors=i.morphColors,n.morphTargetsCount=i.morphTargetsCount,n.numClippingPlanes=i.numClippingPlanes,n.numIntersection=i.numClipIntersection,n.vertexAlphas=i.vertexAlphas,n.vertexTangents=i.vertexTangents,n.toneMapping=i.toneMapping}eP.setAnimationLoop(function(e){eI&&eI(e)}),"undefined"!=typeof self&&eP.setContext(self),this.setAnimationLoop=function(e){eI=e,ew.setAnimationLoop(e),null===e?eP.stop():eP.start()},ew.addEventListener("sessionstart",eB),ew.addEventListener("sessionend",eL),this.render=function(e,i){if(void 0!==i&&!0!==i.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===Q)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===i.parent&&!0===i.matrixWorldAutoUpdate&&i.updateMatrixWorld(),!0===ew.enabled&&!0===ew.isPresenting&&(!0===ew.cameraAutoUpdate&&ew.updateCamera(i),i=ew.getCamera()),!0===e.isScene&&e.onBeforeRender(H,e,i,X),(G=A.get(e,j.length)).init(i),j.push(G),ef.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),eu.setFromProjectionMatrix(ef),ed=this.localClippingEnabled,ec=v.init(this.clippingPlanes,ed),(z=g.get(e,V.length)).init(),V.push(z),!0===ew.enabled&&!0===ew.isPresenting){let e=H.xr.getDepthSensingMesh();null!==e&&eD(e,i,-1/0,H.sortObjects)}eD(e,i,0,H.sortObjects),z.finish(),!0===H.sortObjects&&z.sort(es,ea),(ev=!1===ew.enabled||!1===ew.isPresenting||!1===ew.hasDepthSensing())&&x.addToRenderList(z,e),this.info.render.frame++,!0===ec&&v.beginShadows();let n=G.state.shadowsArray;y.render(n,e,i),!0===ec&&v.endShadows(),!0===this.info.autoReset&&this.info.reset();let r=z.opaque,s=z.transmissive;if(G.setupLights(),i.isArrayCamera){let n=i.cameras;if(s.length>0)for(let i=0,a=n.length;i<a;i++)eO(r,s,e,n[i]);ev&&x.render(e);for(let i=0,r=n.length;i<r;i++){let r=n[i];eN(z,e,r,r.viewport)}}else s.length>0&&eO(r,s,e,i),ev&&x.render(e),eN(z,e,i);null!==X&&0===q&&(l.updateMultisampleRenderTarget(X),l.updateRenderTargetMipmap(X)),!0===e.isScene&&e.onAfterRender(H,e,i),M.resetDefaultState(),K=-1,Y=null,j.pop(),j.length>0?(G=j[j.length-1],!0===ec&&v.setGlobalState(H.clippingPlanes,G.state.camera)):G=null,V.pop(),z=V.length>0?V[V.length-1]:null},this.getActiveCubeFace=function(){return W},this.getActiveMipmapLevel=function(){return q},this.getRenderTarget=function(){return X},this.setRenderTargetTextures=function(e,i,r){o.get(e.texture).__webglTexture=i,o.get(e.depthTexture).__webglTexture=r;let s=o.get(e);s.__hasExternalTextures=!0,s.__autoAllocateDepthBuffer=void 0===r,s.__autoAllocateDepthBuffer||!0!==n.has("WEBGL_multisampled_render_to_texture")||(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),s.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,i){let n=o.get(e);n.__webglFramebuffer=i,n.__useDefaultFramebuffer=void 0===i};let eV=ex.createFramebuffer();this.setRenderTarget=function(e,i=0,n=0){X=e,W=i,q=n;let r=!0,a=null,h=!1,u=!1;if(e){let c=o.get(e);if(void 0!==c.__useDefaultFramebuffer)s.bindFramebuffer(ex.FRAMEBUFFER,null),r=!1;else if(void 0===c.__webglFramebuffer)l.setupRenderTarget(e);else if(c.__hasExternalTextures)l.rebindTextures(e,o.get(e.texture).__webglTexture,o.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){let i=e.depthTexture;if(c.__boundDepthTexture!==i){if(null!==i&&o.has(i)&&(e.width!==i.image.width||e.height!==i.image.height))throw Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");l.setupDepthRenderbuffer(e)}}let d=e.texture;(d.isData3DTexture||d.isDataArrayTexture||d.isCompressedArrayTexture)&&(u=!0);let p=o.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=Array.isArray(p[i])?p[i][n]:p[i],h=!0):a=e.samples>0&&!1===l.useMultisampledRTT(e)?o.get(e).__webglMultisampledFramebuffer:Array.isArray(p)?p[n]:p,J.copy(e.viewport),Z.copy(e.scissor),$=e.scissorTest}else J.copy(eo).multiplyScalar(er).floor(),Z.copy(el).multiplyScalar(er).floor(),$=eh;if(0!==n&&(a=eV),s.bindFramebuffer(ex.FRAMEBUFFER,a)&&r&&s.drawBuffers(e,a),s.viewport(J),s.scissor(Z),s.setScissorTest($),h){let r=o.get(e.texture);ex.framebufferTexture2D(ex.FRAMEBUFFER,ex.COLOR_ATTACHMENT0,ex.TEXTURE_CUBE_MAP_POSITIVE_X+i,r.__webglTexture,n)}else if(u){let r=o.get(e.texture);ex.framebufferTextureLayer(ex.FRAMEBUFFER,ex.COLOR_ATTACHMENT0,r.__webglTexture,n,i)}else if(null!==e&&0!==n){let i=o.get(e.texture);ex.framebufferTexture2D(ex.FRAMEBUFFER,ex.COLOR_ATTACHMENT0,ex.TEXTURE_2D,i.__webglTexture,n)}K=-1},this.readRenderTargetPixels=function(e,i,n,a,l,h,u){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let c=o.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==u&&(c=c[u]),c){s.bindFramebuffer(ex.FRAMEBUFFER,c);try{let s=e.texture,o=s.format,u=s.type;if(!r.textureFormatReadable(o)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!r.textureTypeReadable(u)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}i>=0&&i<=e.width-a&&n>=0&&n<=e.height-l&&ex.readPixels(i,n,a,l,w.convert(o),w.convert(u),h)}finally{let e=null!==X?o.get(X).__webglFramebuffer:null;s.bindFramebuffer(ex.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,i,n,a,l,h,u){if(!(e&&e.isWebGLRenderTarget))throw Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let c=o.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==u&&(c=c[u]),c){let u=e.texture,d=u.format,p=u.type;if(!r.textureFormatReadable(d))throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!r.textureTypeReadable(p))throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(i>=0&&i<=e.width-a&&n>=0&&n<=e.height-l){s.bindFramebuffer(ex.FRAMEBUFFER,c);let e=ex.createBuffer();ex.bindBuffer(ex.PIXEL_PACK_BUFFER,e),ex.bufferData(ex.PIXEL_PACK_BUFFER,h.byteLength,ex.STREAM_READ),ex.readPixels(i,n,a,l,w.convert(d),w.convert(p),0);let r=null!==X?o.get(X).__webglFramebuffer:null;s.bindFramebuffer(ex.FRAMEBUFFER,r);let u=ex.fenceSync(ex.SYNC_GPU_COMMANDS_COMPLETE,0);return ex.flush(),await (0,eE.Qey)(ex,u,4),ex.bindBuffer(ex.PIXEL_PACK_BUFFER,e),ex.getBufferSubData(ex.PIXEL_PACK_BUFFER,0,h),ex.deleteBuffer(e),ex.deleteSync(u),h}throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,i=null,n=0){!0!==e.isTexture&&((0,eE.O4K)("WebGLRenderer: copyFramebufferToTexture function signature has changed."),i=arguments[0]||null,e=arguments[1]);let r=Math.pow(2,-n),a=Math.floor(e.image.width*r),o=Math.floor(e.image.height*r),h=null!==i?i.x:0,u=null!==i?i.y:0;l.setTexture2D(e,0),ex.copyTexSubImage2D(ex.TEXTURE_2D,n,0,0,h,u,a,o),s.unbindTexture()};let ej=ex.createFramebuffer(),eW=ex.createFramebuffer();this.copyTextureToTexture=function(e,i,n=null,r=null,a=0,h=null){let u,c,d,p,f,m,g,A,v,y;!0!==e.isTexture&&((0,eE.O4K)("WebGLRenderer: copyTextureToTexture function signature has changed."),r=arguments[0]||null,e=arguments[1],i=arguments[2],h=arguments[3]||0,n=null),null===h&&(0!==a?((0,eE.O4K)("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),h=a,a=0):h=0);let x=e.isCompressedTexture?e.mipmaps[h]:e.image;if(null!==n)u=n.max.x-n.min.x,c=n.max.y-n.min.y,d=n.isBox3?n.max.z-n.min.z:1,p=n.min.x,f=n.min.y,m=n.isBox3?n.min.z:0;else{let i=Math.pow(2,-a);u=Math.floor(x.width*i),c=Math.floor(x.height*i),d=e.isDataArrayTexture?x.depth:e.isData3DTexture?Math.floor(x.depth*i):1,p=0,f=0,m=0}null!==r?(g=r.x,A=r.y,v=r.z):(g=0,A=0,v=0);let _=w.convert(i.format),b=w.convert(i.type);i.isData3DTexture?(l.setTexture3D(i,0),y=ex.TEXTURE_3D):i.isDataArrayTexture||i.isCompressedArrayTexture?(l.setTexture2DArray(i,0),y=ex.TEXTURE_2D_ARRAY):(l.setTexture2D(i,0),y=ex.TEXTURE_2D),ex.pixelStorei(ex.UNPACK_FLIP_Y_WEBGL,i.flipY),ex.pixelStorei(ex.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),ex.pixelStorei(ex.UNPACK_ALIGNMENT,i.unpackAlignment);let E=ex.getParameter(ex.UNPACK_ROW_LENGTH),M=ex.getParameter(ex.UNPACK_IMAGE_HEIGHT),C=ex.getParameter(ex.UNPACK_SKIP_PIXELS),S=ex.getParameter(ex.UNPACK_SKIP_ROWS),T=ex.getParameter(ex.UNPACK_SKIP_IMAGES);ex.pixelStorei(ex.UNPACK_ROW_LENGTH,x.width),ex.pixelStorei(ex.UNPACK_IMAGE_HEIGHT,x.height),ex.pixelStorei(ex.UNPACK_SKIP_PIXELS,p),ex.pixelStorei(ex.UNPACK_SKIP_ROWS,f),ex.pixelStorei(ex.UNPACK_SKIP_IMAGES,m);let R=e.isDataArrayTexture||e.isData3DTexture,I=i.isDataArrayTexture||i.isData3DTexture;if(e.isDepthTexture){let n=o.get(e),r=o.get(i),l=o.get(n.__renderTarget),y=o.get(r.__renderTarget);s.bindFramebuffer(ex.READ_FRAMEBUFFER,l.__webglFramebuffer),s.bindFramebuffer(ex.DRAW_FRAMEBUFFER,y.__webglFramebuffer);for(let n=0;n<d;n++)R&&(ex.framebufferTextureLayer(ex.READ_FRAMEBUFFER,ex.COLOR_ATTACHMENT0,o.get(e).__webglTexture,a,m+n),ex.framebufferTextureLayer(ex.DRAW_FRAMEBUFFER,ex.COLOR_ATTACHMENT0,o.get(i).__webglTexture,h,v+n)),ex.blitFramebuffer(p,f,u,c,g,A,u,c,ex.DEPTH_BUFFER_BIT,ex.NEAREST);s.bindFramebuffer(ex.READ_FRAMEBUFFER,null),s.bindFramebuffer(ex.DRAW_FRAMEBUFFER,null)}else if(0!==a||e.isRenderTargetTexture||o.has(e)){let n=o.get(e),r=o.get(i);s.bindFramebuffer(ex.READ_FRAMEBUFFER,ej),s.bindFramebuffer(ex.DRAW_FRAMEBUFFER,eW);for(let e=0;e<d;e++)R?ex.framebufferTextureLayer(ex.READ_FRAMEBUFFER,ex.COLOR_ATTACHMENT0,n.__webglTexture,a,m+e):ex.framebufferTexture2D(ex.READ_FRAMEBUFFER,ex.COLOR_ATTACHMENT0,ex.TEXTURE_2D,n.__webglTexture,a),I?ex.framebufferTextureLayer(ex.DRAW_FRAMEBUFFER,ex.COLOR_ATTACHMENT0,r.__webglTexture,h,v+e):ex.framebufferTexture2D(ex.DRAW_FRAMEBUFFER,ex.COLOR_ATTACHMENT0,ex.TEXTURE_2D,r.__webglTexture,h),0!==a?ex.blitFramebuffer(p,f,u,c,g,A,u,c,ex.COLOR_BUFFER_BIT,ex.NEAREST):I?ex.copyTexSubImage3D(y,h,g,A,v+e,p,f,u,c):ex.copyTexSubImage2D(y,h,g,A,p,f,u,c);s.bindFramebuffer(ex.READ_FRAMEBUFFER,null),s.bindFramebuffer(ex.DRAW_FRAMEBUFFER,null)}else I?e.isDataTexture||e.isData3DTexture?ex.texSubImage3D(y,h,g,A,v,u,c,d,_,b,x.data):i.isCompressedArrayTexture?ex.compressedTexSubImage3D(y,h,g,A,v,u,c,d,_,x.data):ex.texSubImage3D(y,h,g,A,v,u,c,d,_,b,x):e.isDataTexture?ex.texSubImage2D(ex.TEXTURE_2D,h,g,A,u,c,_,b,x.data):e.isCompressedTexture?ex.compressedTexSubImage2D(ex.TEXTURE_2D,h,g,A,x.width,x.height,_,x.data):ex.texSubImage2D(ex.TEXTURE_2D,h,g,A,u,c,_,b,x);ex.pixelStorei(ex.UNPACK_ROW_LENGTH,E),ex.pixelStorei(ex.UNPACK_IMAGE_HEIGHT,M),ex.pixelStorei(ex.UNPACK_SKIP_PIXELS,C),ex.pixelStorei(ex.UNPACK_SKIP_ROWS,S),ex.pixelStorei(ex.UNPACK_SKIP_IMAGES,T),0===h&&i.generateMipmaps&&ex.generateMipmap(y),s.unbindTexture()},this.copyTextureToTexture3D=function(e,i,n=null,r=null,s=0){return!0!==e.isTexture&&((0,eE.O4K)("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,r=arguments[1]||null,e=arguments[2],i=arguments[3],s=arguments[4]||0),(0,eE.O4K)('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,i,n,r,s)},this.initRenderTarget=function(e){void 0===o.get(e).__webglFramebuffer&&l.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?l.setTextureCube(e,0):e.isData3DTexture?l.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?l.setTexture2DArray(e,0):l.setTexture2D(e,0),s.unbindTexture()},this.resetState=function(){W=0,q=0,X=null,s.reset(),M.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return eE._RZ}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let i=this.getContext();i.drawingBufferColorspace=eE.epp._getDrawingBufferColorSpace(e),i.unpackColorSpace=eE.epp._getUnpackColorSpace()}},Scene:eE.xsS,PerspectiveCamera:eE.cPb,Raycaster:eE.iMs,SRGBColorSpace:eE.KI_,TextureLoader:eE.dpR,Vector2:eE.FM8,Vector3:eE.Pa4,Box3:eE.ZzF,Color:eE.Ilk,Mesh:eE.Kj0,SphereGeometry:eE.xo$,MeshBasicMaterial:eE.vBJ,BackSide:eE._Li,EventDispatcher:eE.pBf,MOUSE:eE.RsA,Quaternion:eE._fP,Spherical:eE.$V,Clock:eE.SUY},AI=(0,_.Z)({props:{width:{default:window.innerWidth,onChange:function(e,i,n){isNaN(e)&&(i.width=n)}},height:{default:window.innerHeight,onChange:function(e,i,n){isNaN(e)&&(i.height=n)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,i){i.hoverObj=null,i.tooltip&&i.tooltip.content(null)},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){if(e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(i){return i.render(e.scene,e.camera)}),e.enablePointerInteraction){var i=null;if(e.hoverDuringDrag||!e.isPointerDragging){var n=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&n.sort(function(i,n){return e.hoverOrderComparator(i.object,n.object)});var r=n.find(function(i){return e.hoverFilter(i.object)})||null;i=r?r.object:null,e.intersection=r||null}i!==e.hoverObj&&(e.onHover(i,e.hoverObj,e.intersection),e.tooltip.content(i&&(0,b.default)(e.tooltipContent)(i,e.intersection)||null),e.hoverObj=i)}e.tweenGroup.update()}return this},getPointerPos:function(e){var i=e.pointerPos;return{x:i.x,y:i.y}},cameraPosition:function(e,i,n,r){var s=e.camera;if(i&&e.initialised){var a=n||{x:0,y:0,z:0};if(r){var o=Object.assign({},s.position),l=c();e.tweenGroup.add(new gq(o).to(i,r).easing(gG.Quadratic.Out).onUpdate(h).start()),e.tweenGroup.add(new gq(l).to(a,r/3).easing(gG.Quadratic.Out).onUpdate(u).start())}else h(i),u(a);return this}return Object.assign({},s.position,{lookAt:c()});function h(e){var i=e.x,n=e.y,r=e.z;void 0!==i&&(s.position.x=i),void 0!==n&&(s.position.y=n),void 0!==r&&(s.position.z=r)}function u(i){var n=new AR.Vector3(i.x,i.y,i.z);e.controls.target?e.controls.target=n:s.lookAt(n)}function c(){return Object.assign(new AR.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,s=Array(r>3?r-3:0),a=3;a<r;a++)s[a-3]=arguments[a];return this.fitToBbox(this.getBbox.apply(this,s),i,n)},fitToBbox:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,s=e.camera;if(i){var a=new AR.Vector3(0,0,0),o=2*Math.max.apply(Math,AS(Object.entries(i).map(function(e){var i=function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{a=(n=n.call(e)).next;for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,2)||AT(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=i[0],r=i[1];return Math.max.apply(Math,AS(r.map(function(e){return Math.abs(a[n]-e)})))})))/Math.atan((1-2*r/e.height)*s.fov*Math.PI/180),l=o/s.aspect,h=Math.max(o,l);if(h>0){var u=a.clone().sub(s.position).normalize().multiplyScalar(-h);this.cameraPosition(u,a,n)}}return this},getBbox:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=new AR.Box3(new AR.Vector3(0,0,0),new AR.Vector3(0,0,0)),r=e.objects.filter(i);return r.length?(r.forEach(function(e){return n.expandByObject(e)}),Object.assign.apply(Object,AS(["x","y","z"].map(function(e){var i,r,s,a;return i={},r=e,s=[n.min[e],n.max[e]],(r="symbol"==typeof(a=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(r,"string"))?a:a+"")in i?Object.defineProperty(i,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[r]=s,i})))):null},getScreenCoords:function(e,i,n,r){var s=new AR.Vector3(i,n,r);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=new AR.Vector2(i/e.width*2-1,-(2*(n/e.height))+1),a=new AR.Raycaster;return a.setFromCamera(s,e.camera),Object.assign({},a.ray.at(r,new AR.Vector3))},intersectingObjects:function(e,i,n){var r=new AR.Vector2(i/e.width*2-1,-(2*(n/e.height))+1),s=new AR.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(r,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new AR.Scene,camera:new AR.PerspectiveCamera,clock:new AR.Clock,tweenGroup:new gj}},init:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.controlType,s=void 0===r?"trackball":r,a=n.useWebGPU,o=n.rendererConfig,l=n.extraRenderers,h=n.waitForLoadComplete;e.innerHTML="",e.appendChild(i.container=document.createElement("div")),i.container.className="scene-container",i.container.style.position="relative",i.container.appendChild(i.navInfo=document.createElement("div")),i.navInfo.className="scene-nav-info",i.navInfo.textContent=({orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"})[s]||"",i.navInfo.style.display=i.showNavInfo?null:"none",i.tooltip=new AM(i.container),i.pointerPos=new AR.Vector2,i.pointerPos.x=-2,i.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(e){return i.container.addEventListener(e,function(n){if("pointerdown"===e&&(i.isPointerPressed=!0),!i.isPointerDragging&&"pointermove"===n.type&&(n.pressure>0||i.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some(function(e){return Math.abs(e)>1}))&&(i.isPointerDragging=!0),i.enablePointerInteraction){var r,s,a,o=(r=i.container.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,{top:r.top+a,left:r.left+s});i.pointerPos.x=n.pageX-o.left,i.pointerPos.y=n.pageY-o.top}},{passive:!0})}),i.container.addEventListener("pointerup",function(e){i.isPointerPressed=!1,(!i.isPointerDragging||(i.isPointerDragging=!1,i.clickAfterDrag))&&requestAnimationFrame(function(){0===e.button&&i.onClick(i.hoverObj||null,e,i.intersection),2===e.button&&i.onRightClick&&i.onRightClick(i.hoverObj||null,e,i.intersection)})},{passive:!0,capture:!0}),i.container.addEventListener("contextmenu",function(e){i.onRightClick&&e.preventDefault()}),i.renderer=new(void 0!==a&&a?mL:AR.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},void 0===o?{}:o)),i.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),i.container.appendChild(i.renderer.domElement),i.extraRenderers=void 0===l?[]:l,i.extraRenderers.forEach(function(e){e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.pointerEvents="none",i.container.appendChild(e.domElement)}),i.postProcessingComposer=new gF(i.renderer),i.postProcessingComposer.addPass(new gz(i.scene,i.camera)),i.controls=new({trackball:mq,orbit:go,fly:gb})[s](i.camera,i.renderer.domElement),"fly"===s&&(i.controls.movementSpeed=300,i.controls.rollSpeed=Math.PI/6,i.controls.dragToLook=!0),("trackball"===s||"orbit"===s)&&(i.controls.minDistance=.1,i.controls.maxDistance=i.skyRadius,i.controls.addEventListener("start",function(){i.controlsEngaged=!0}),i.controls.addEventListener("change",function(){i.controlsEngaged&&(i.controlsDragging=!0)}),i.controls.addEventListener("end",function(){i.controlsEngaged=!1,i.controlsDragging=!1})),[i.renderer,i.postProcessingComposer].concat(AS(i.extraRenderers)).forEach(function(e){return e.setSize(i.width,i.height)}),i.camera.aspect=i.width/i.height,i.camera.updateProjectionMatrix(),i.camera.position.z=1e3,i.scene.add(i.skysphere=new AR.Mesh),i.skysphere.visible=!1,i.loadComplete=i.scene.visible=!(void 0===h||h),window.scene=i.scene},update:function(e,i){if(e.width&&e.height&&(i.hasOwnProperty("width")||i.hasOwnProperty("height"))&&(e.container.style.width="".concat(e.width,"px"),e.container.style.height="".concat(e.height,"px"),[e.renderer,e.postProcessingComposer].concat(AS(e.extraRenderers)).forEach(function(i){return i.setSize(e.width,e.height)}),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix()),i.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&i.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=2.5*e.skyRadius,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new AR.SphereGeometry(e.skyRadius)),i.hasOwnProperty("backgroundColor")){var n=q(e.backgroundColor).alpha;void 0===n&&(n=1),e.renderer.setClearColor(new AR.Color(es(1,e.backgroundColor)),n)}function r(){e.loadComplete=e.scene.visible=!0}i.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new AR.TextureLoader().load(e.backgroundImageUrl,function(i){i.colorSpace=AR.SRGBColorSpace,e.skysphere.material=new AR.MeshBasicMaterial({map:i,side:AR.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),e.loadComplete||r()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,e.loadComplete||r())),i.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),i.hasOwnProperty("lights")&&((i.lights||[]).forEach(function(i){return e.scene.remove(i)}),e.lights.forEach(function(i){return e.scene.add(i)})),i.hasOwnProperty("objects")&&((i.objects||[]).forEach(function(i){return e.scene.remove(i)}),e.objects.forEach(function(i){return e.scene.add(i)}))}});function AB(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function AL(e,i,n){var r;return(i="symbol"==typeof(r=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(i,"string"))?r:r+"")in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function AP(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function AD(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?AP(Object(n),!0).forEach(function(i){AL(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AP(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function AN(e){return function(e){if(Array.isArray(e))return AB(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,i){if(e){if("string"==typeof e)return AB(e,void 0);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?AB(e,i):void 0}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AO(e,i){var n=new i;return n._destructor&&n._destructor(),{linkProp:function(i){return{default:n[i](),onChange:function(n,r){r[e][i](n)},triggerUpdate:!1}},linkMethod:function(i){return function(n){for(var r=n[e],s=arguments.length,a=Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];var l=r[i].apply(r,a);return l===r?this:l}}}}!function(e,i){void 0===i&&(i={});var n=i.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===n&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(".graph-info-msg {\n  top: 50%;\n  width: 100%;\n  text-align: center;\n  color: lavender;\n  opacity: 0.7;\n  font-size: 22px;\n  position: absolute;\n  font-family: Sans-serif;\n}\n\n.scene-container .clickable {\n  cursor: pointer;\n}\n\n.scene-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.scene-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}");var AU=window.THREE?window.THREE:{AmbientLight:eE.Mig,DirectionalLight:eE.Ox3,Vector3:eE.Pa4,REVISION:eE.UZH},Ak=AO("forceGraph",ej.default),AF=Object.assign.apply(Object,AN(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(e){return AL({},e,Ak.linkProp(e))}))),Az=Object.assign.apply(Object,AN(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(e){return AL({},e,Ak.linkMethod(e))}))),AG=AO("renderObjs",AI),AV=Object.assign.apply(Object,AN(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(e){return AL({},e,AG.linkProp(e))}))),Aj=Object.assign.apply(Object,AN(["lights","cameraPosition","postProcessingComposer"].map(function(e){return AL({},e,AG.linkMethod(e))})).concat([{graph2ScreenCoords:AG.linkMethod("getScreenCoords"),screen2GraphCoords:AG.linkMethod("getSceneCoords")}])),AH=(0,_.Z)({props:AD(AD({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,i){return i.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,i){var n=i.renderObjs.controls();n&&(n.enabled=e,e&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},AF),AV),methods:AD(AD({zoomToFit:function(e,i,n){for(var r,s=arguments.length,a=Array(s>3?s-3:0),o=3;o<s;o++)a[o-3]=arguments[o];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,a),i,n),this},pauseAnimation:function(e){return null!==e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return null===e.animationFrameRequestId&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Az),Aj),stateInit:function(e){var i=e.controlType,n=e.rendererConfig,r=e.extraRenderers,s=new ej.default;return{forceGraph:s,renderObjs:AI({controlType:i,rendererConfig:n,extraRenderers:r}).objects([s]).lights([new AU.AmbientLight(0xcccccc,Math.PI),new AU.DirectionalLight(0xffffff,.6*Math.PI)])}},init:function(e,i){e.innerHTML="",e.appendChild(i.container=document.createElement("div")),i.container.style.position="relative";var n,r=document.createElement("div");i.container.appendChild(r),i.renderObjs(r);var s=i.renderObjs.camera(),a=i.renderObjs.renderer(),o=i.renderObjs.controls();o.enabled=!!i.enableNavigationControls,i.lastSetCameraZ=s.position.z,i.container.appendChild(n=document.createElement("div")),n.className="graph-info-msg",n.textContent="",i.forceGraph.onLoading(function(){n.textContent="Loading..."}).onFinishLoading(function(){n.textContent=""}).onUpdate(function(){i.graphData=i.forceGraph.graphData(),0===s.position.x&&0===s.position.y&&s.position.z===i.lastSetCameraZ&&i.graphData.nodes.length&&(s.lookAt(i.forceGraph.position),i.lastSetCameraZ=s.position.z=170*Math.cbrt(i.graphData.nodes.length))}).onFinishUpdate(function(){if(i._dragControls){var e=i.graphData.nodes.find(function(e){return e.__initialFixedPos&&!e.__disposeControlsAfterDrag});e?e.__disposeControlsAfterDrag=!0:i._dragControls.dispose(),i._dragControls=void 0}if(i.enableNodeDrag&&i.enablePointerInteraction&&"d3"===i.forceEngine){var n=i._dragControls=new ek(i.graphData.nodes.map(function(e){return e.__threeObj}).filter(function(e){return e}),s,a.domElement);n.addEventListener("dragstart",function(e){o.enabled=!1,e.object.__initialPos=e.object.position.clone(),e.object.__prevPos=e.object.position.clone();var i=AQ(e.object).__data;i.__initialFixedPos||(i.__initialFixedPos={fx:i.fx,fy:i.fy,fz:i.fz}),i.__initialPos||(i.__initialPos={x:i.x,y:i.y,z:i.z}),["x","y","z"].forEach(function(e){return i["f".concat(e)]=i[e]}),a.domElement.classList.add("grabbable")}),n.addEventListener("drag",function(e){var n=AQ(e.object);if(!e.object.hasOwnProperty("__graphObjType")){var r=e.object.__initialPos,s=e.object.__prevPos,a=e.object.position;n.position.add(a.clone().sub(s)),s.copy(a),a.copy(r)}var o=n.__data,l=n.position,h={x:l.x-o.x,y:l.y-o.y,z:l.z-o.z};["x","y","z"].forEach(function(e){return o["f".concat(e)]=o[e]=l[e]}),i.forceGraph.d3AlphaTarget(.3).resetCountdown(),o.__dragged=!0,i.onNodeDrag(o,h)}),n.addEventListener("dragend",function(e){delete e.object.__initialPos,delete e.object.__prevPos;var r=AQ(e.object).__data;r.__disposeControlsAfterDrag&&(n.dispose(),delete r.__disposeControlsAfterDrag);var s=r.__initialFixedPos,l=r.__initialPos,h={x:l.x-r.x,y:l.y-r.y,z:l.z-r.z};s&&(["x","y","z"].forEach(function(e){var i="f".concat(e);void 0===s[i]&&delete r[i]}),delete r.__initialFixedPos,delete r.__initialPos,r.__dragged&&(delete r.__dragged,i.onNodeDragEnd(r,h))),i.forceGraph.d3AlphaTarget(0).resetCountdown(),i.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),a.domElement.classList.remove("grabbable")})}}),AU.REVISION<155&&(i.renderObjs.renderer().useLegacyLights=!1),i.renderObjs.hoverOrderComparator(function(e,i){var n=AQ(e);if(!n)return 1;var r=AQ(i);if(!r)return -1;var s=function(e){return"node"===e.__graphObjType};return s(r)-s(n)}).tooltipContent(function(e){var n=AQ(e);return n&&(0,b.default)(i["".concat(n.__graphObjType,"Label")])(n.__data)||""}).hoverDuringDrag(!1).onHover(function(e){var n=AQ(e);if(n!==i.hoverObj){var r=i.hoverObj?i.hoverObj.__graphObjType:null,s=i.hoverObj?i.hoverObj.__data:null,o=n?n.__graphObjType:null,l=n?n.__data:null;if(r&&r!==o){var h=i["on".concat("node"===r?"Node":"Link","Hover")];h&&h(null,s)}if(o){var u=i["on".concat("node"===o?"Node":"Link","Hover")];u&&u(l,r===o?s:null)}a.domElement.classList[n&&i["on".concat("node"===o?"Node":"Link","Click")]||!n&&i.onBackgroundClick?"add":"remove"]("clickable"),i.hoverObj=n}}).clickAfterDrag(!1).onClick(function(e,n){var r=AQ(e);if(r){var s=i["on".concat("node"===r.__graphObjType?"Node":"Link","Click")];s&&s(r.__data,n)}else i.onBackgroundClick&&i.onBackgroundClick(n)}).onRightClick(function(e,n){var r=AQ(e);if(r){var s=i["on".concat("node"===r.__graphObjType?"Node":"Link","RightClick")];s&&s(r.__data,n)}else i.onBackgroundRightClick&&i.onBackgroundRightClick(n)}),this._animationCycle()}});function AQ(e){for(var i=e;i&&!i.hasOwnProperty("__graphObjType");)i=i.parent;return i}var AW=n(78623),Aq=n(77788),AX=n(99696),AK=n(23842),AY=n(80287),AJ=n(58641);let AZ=function(e,i,n){var r=!0,s=!0;if("function"!=typeof e)throw TypeError("Expected a function");return(0,AJ.Z)(n)&&(r="leading"in n?!!n.leading:r,s="trailing"in n?!!n.trailing:s),(0,AY.Z)(e,i,{leading:r,maxWait:i,trailing:s})};var A$=n(44497);function A0(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function A1(e,i,n){if("function"==typeof e?e===i:e.has(i))return arguments.length<3?i:n;throw TypeError("Private element is not present on this object")}function A2(e,i){return e.get(A1(e,i))}function A3(e,i,n){(function(e,i){if(i.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")})(e,i),i.set(e,n)}function A4(e,i,n){return e.set(A1(e,i),n),n}var A5=function(e,i,n){return(e<<16)+(i<<8)+n},A6=function(e){var i=(0,A$.Z)(e).toRgb();return A5(i.r,i.g,i.b)},A8=function(e,i){return 123*e%Math.pow(2,i)},A7=new WeakMap,A9=new WeakMap,ve=(h=function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;(function(e,i){if(!(e instanceof i))throw TypeError("Cannot call a class as a function")})(this,e),A3(this,A7,void 0),A3(this,A9,void 0),A4(A9,this,i),this.reset()},u=[{key:"reset",value:function(){A4(A7,this,["__reserved for background__"])}},{key:"register",value:function(e){if(A2(A7,this).length>=Math.pow(2,24-A2(A9,this)))return null;var i,n=A2(A7,this).length,r=A8(n,A2(A9,this)),s=(i=n+(r<<24-A2(A9,this)),"#".concat(Math.min(i,0x1000000).toString(16).padStart(6,"0")));return A2(A7,this).push(e),s}},{key:"lookup",value:function(e){if(!e)return null;var i="string"==typeof e?A6(e):A5.apply(void 0,function(e){if(Array.isArray(e))return A0(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,i){if(e){if("string"==typeof e)return A0(e,void 0);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A0(e,i):void 0}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());if(!i)return null;var n=i&Math.pow(2,24-A2(A9,this))-1,r=i>>24-A2(A9,this)&Math.pow(2,A2(A9,this))-1;return A8(n,A2(A9,this))!==r||n>=A2(A7,this).length?null:A2(A7,this)[n]}}],function(e,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){var i=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i);if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof i?i:i+""}(r.key),r)}}(h.prototype,u),Object.defineProperty(h,"prototype",{writable:!1}),h),vt=n(46510),vi=n(83585),vn=n(876),vr=n(64171),vs=n(80633);let{abs:va,cos:vo,sin:vl,acos:vh,atan2:vu,sqrt:vc,pow:vd}=Math;function vp(e){return e<0?-vd(-e,1/3):vd(e,1/3)}let vf=Math.PI,vm=2*vf,vg=vf/2,vA=Number.MAX_SAFE_INTEGER||0x1fffffffffffff,vv=Number.MIN_SAFE_INTEGER||-0x1fffffffffffff,vy={x:0,y:0,z:0},vx={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,i){let n=i(e),r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),vc(r)},compute:function(e,i,n){if(0===e)return i[0].t=0,i[0];let r=i.length-1;if(1===e)return i[r].t=1,i[r];let s=1-e,a=i;if(0===r)return i[0].t=e,i[0];if(1===r){let i={x:s*a[0].x+e*a[1].x,y:s*a[0].y+e*a[1].y,t:e};return n&&(i.z=s*a[0].z+e*a[1].z),i}if(r<4){let i=s*s,o=e*e,l,h,u,c=0;2===r?(a=[a[0],a[1],a[2],vy],l=i,h=s*e*2,u=o):3===r&&(l=i*s,h=i*e*3,u=s*o*3,c=e*o);let d={x:l*a[0].x+h*a[1].x+u*a[2].x+c*a[3].x,y:l*a[0].y+h*a[1].y+u*a[2].y+c*a[3].y,t:e};return n&&(d.z=l*a[0].z+h*a[1].z+u*a[2].z+c*a[3].z),d}let o=JSON.parse(JSON.stringify(i));for(;o.length>1;){for(let i=0;i<o.length-1;i++)o[i]={x:o[i].x+(o[i+1].x-o[i].x)*e,y:o[i].y+(o[i+1].y-o[i].y)*e},void 0!==o[i].z&&(o[i].z=o[i].z+(o[i+1].z-o[i].z)*e);o.splice(o.length-1,1)}return o[0].t=e,o[0]},computeWithRatios:function(e,i,n,r){let s=1-e,a=n[0],o=n[1],l=n[2],h=n[3],u;return(a*=s,o*=e,2===i.length)?(u=a+o,{x:(a*i[0].x+o*i[1].x)/u,y:(a*i[0].y+o*i[1].y)/u,z:!!r&&(a*i[0].z+o*i[1].z)/u,t:e}):(a*=s,o*=2*s,l*=e*e,3===i.length)?(u=a+o+l,{x:(a*i[0].x+o*i[1].x+l*i[2].x)/u,y:(a*i[0].y+o*i[1].y+l*i[2].y)/u,z:!!r&&(a*i[0].z+o*i[1].z+l*i[2].z)/u,t:e}):(a*=s,o*=1.5*s,l*=3*s,h*=e*e*e,4===i.length)?(u=a+o+l+h,{x:(a*i[0].x+o*i[1].x+l*i[2].x+h*i[3].x)/u,y:(a*i[0].y+o*i[1].y+l*i[2].y+h*i[3].y)/u,z:!!r&&(a*i[0].z+o*i[1].z+l*i[2].z+h*i[3].z)/u,t:e}):void 0},derive:function(e,i){let n=[];for(let r=e,s=r.length,a=s-1;s>1;s--,a--){let e=[];for(let n=0,s;n<a;n++)s={x:a*(r[n+1].x-r[n].x),y:a*(r[n+1].y-r[n].y)},i&&(s.z=a*(r[n+1].z-r[n].z)),e.push(s);n.push(e),r=e}return n},between:function(e,i,n){return i<=e&&e<=n||vx.approximately(e,i)||vx.approximately(e,n)},approximately:function(e,i,n){return va(e-i)<=(n||1e-6)},length:function(e){let i=vx.Tvalues.length,n=0;for(let r=0,s;r<i;r++)s=.5*vx.Tvalues[r]+.5,n+=vx.Cvalues[r]*vx.arcfn(s,e);return .5*n},map:function(e,i,n,r,s){return r+(e-i)/(n-i)*(s-r)},lerp:function(e,i,n){let r={x:i.x+e*(n.x-i.x),y:i.y+e*(n.y-i.y)};return void 0!==i.z&&void 0!==n.z&&(r.z=i.z+e*(n.z-i.z)),r},pointToString:function(e){let i=e.x+"/"+e.y;return void 0!==e.z&&(i+="/"+e.z),i},pointsToString:function(e){return"["+e.map(vx.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,i,n){let r=i.x-e.x,s=i.y-e.y,a=n.x-e.x,o=n.y-e.y;return vu(r*o-s*a,r*a+s*o)},round:function(e,i){let n=""+e,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+i))},dist:function(e,i){let n=e.x-i.x,r=e.y-i.y;return vc(n*n+r*r)},closest:function(e,i){let n=vd(2,63),r,s;return e.forEach(function(e,a){(s=vx.dist(i,e))<n&&(n=s,r=a)}),{mdist:n,mpos:r}},abcratio:function(e,i){if(2!==i&&3!==i)return!1;if(void 0===e)e=.5;else if(0===e||1===e)return e;let n=vd(e,i)+vd(1-e,i);return va((n-1)/n)},projectionratio:function(e,i){if(2!==i&&3!==i)return!1;if(void 0===e)e=.5;else if(0===e||1===e)return e;let n=vd(1-e,i),r=vd(e,i)+n;return n/r},lli8:function(e,i,n,r,s,a,o,l){let h=(e-n)*(a-l)-(i-r)*(s-o);return 0!=h&&{x:((e*r-i*n)*(s-o)-(e-n)*(s*l-a*o))/h,y:((e*r-i*n)*(a-l)-(i-r)*(s*l-a*o))/h}},lli4:function(e,i,n,r){let s=e.x,a=e.y,o=i.x,l=i.y,h=n.x,u=n.y,c=r.x,d=r.y;return vx.lli8(s,a,o,l,h,u,c,d)},lli:function(e,i){return vx.lli4(e,e.c,i,i.c)},makeline:function(e,i){return new vI(e.x,e.y,(e.x+i.x)/2,(e.y+i.y)/2,i.x,i.y)},findbbox:function(e){let i=vA,n=vA,r=vv,s=vv;return e.forEach(function(e){let a=e.bbox();i>a.x.min&&(i=a.x.min),n>a.y.min&&(n=a.y.min),r<a.x.max&&(r=a.x.max),s<a.y.max&&(s=a.y.max)}),{x:{min:i,mid:(i+r)/2,max:r,size:r-i},y:{min:n,mid:(n+s)/2,max:s,size:s-n}}},shapeintersections:function(e,i,n,r,s){if(!vx.bboxoverlap(i,r))return[];let a=[],o=[e.startcap,e.forward,e.back,e.endcap],l=[n.startcap,n.forward,n.back,n.endcap];return o.forEach(function(i){i.virtual||l.forEach(function(r){if(r.virtual)return;let o=i.intersects(r,s);o.length>0&&(o.c1=i,o.c2=r,o.s1=e,o.s2=n,a.push(o))})}),a},makeshape:function(e,i,n){let r=i.points.length,s=e.points.length,a=vx.makeline(i.points[r-1],e.points[0]),o=vx.makeline(e.points[s-1],i.points[0]),l={startcap:a,forward:e,back:i,endcap:o,bbox:vx.findbbox([a,e,i,o])};return l.intersections=function(e){return vx.shapeintersections(l,l.bbox,e,e.bbox,n)},l},getminmax:function(e,i,n){if(!n)return{min:0,max:0};let r=vA,s=vv,a,o;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(let l=0,h=n.length;l<h;l++)a=n[l],(o=e.get(a))[i]<r&&(r=o[i]),o[i]>s&&(s=o[i]);return{min:r,mid:(r+s)/2,max:s,size:s-r}},align:function(e,i){let n=i.p1.x,r=i.p1.y,s=-vu(i.p2.y-r,i.p2.x-n);return e.map(function(e){return{x:(e.x-n)*vo(s)-(e.y-r)*vl(s),y:(e.x-n)*vl(s)+(e.y-r)*vo(s)}})},roots:function(e,i){let n,r,s;i=i||{p1:{x:0,y:0},p2:{x:1,y:0}};let a=e.length-1,o=vx.align(e,i),l=function(e){return 0<=e&&e<=1};if(2===a){let e=o[0].y,i=o[1].y,n=o[2].y,r=e-2*i+n;if(0!==r){let s=-vc(i*i-e*n),a=-e+i;return[-(s+a)/r,-(-s+a)/r].filter(l)}return i!==n&&0===r?[(2*i-n)/(2*i-2*n)].filter(l):[]}let h=o[0].y,u=o[1].y,c=o[2].y,d=-h+3*u-3*c+o[3].y,p=3*h-6*u+3*c,f=-3*h+3*u,m=h;if(vx.approximately(d,0)){if(vx.approximately(p,0))return vx.approximately(f,0)?[]:[-m/f].filter(l);let e=vc(f*f-4*p*m),i=2*p;return[(e-f)/i,(-f-e)/i].filter(l)}p/=d;let g=(3*(f/=d)-p*p)/3,A=g/3,v=(2*p*p*p-9*p*f+27*(m/=d))/27,y=v/2,x=y*y+A*A*A;if(x<0){let e=-g/3,i=vc(e*e*e),n=-v/(2*i),a=vh(n<-1?-1:n>1?1:n),o=2*vp(i);return r=o*vo(a/3)-p/3,[r,s=o*vo((a+vm)/3)-p/3,o*vo((a+2*vm)/3)-p/3].filter(l)}if(0===x)return[r=2*(n=y<0?vp(-y):-vp(y))-p/3,s=-n-p/3].filter(l);{let e=vc(x);return[(n=vp(-y+e))-vp(y+e)-p/3].filter(l)}},droots:function(e){if(3===e.length){let i=e[0],n=e[1],r=e[2],s=i-2*n+r;if(0!==s){let e=-vc(n*n-i*r),a=-i+n;return[-(e+a)/s,-(-e+a)/s]}return n!==r&&0===s?[(2*n-r)/(2*(n-r))]:[]}if(2===e.length){let i=e[0],n=e[1];if(i!==n)return[i/(i-n)]}return[]},curvature:function(e,i,n,r,s){let a,o,l,h,u=0,c=0,d=vx.compute(e,i),p=vx.compute(e,n),f=d.x*d.x+d.y*d.y;if(r?(a=vc(vd(d.y*p.z-p.y*d.z,2)+vd(d.z*p.x-p.z*d.x,2)+vd(d.x*p.y-p.x*d.y,2)),o=vd(f+d.z*d.z,1.5)):(a=d.x*p.y-d.y*p.x,o=vd(f,1.5)),0===a||0===o)return{k:0,r:0};if(u=a/o,c=o/a,!s){let s=vx.curvature(e-.001,i,n,r,!0).k,a=vx.curvature(e+.001,i,n,r,!0).k;h=(a-u+(u-s))/2,l=(va(a-u)+va(u-s))/2}return{k:u,r:c,dk:h,adk:l}},inflections:function(e){if(e.length<4)return[];let i=vx.align(e,{p1:e[0],p2:e.slice(-1)[0]}),n=i[2].x*i[1].y,r=i[3].x*i[1].y,s=i[1].x*i[2].y,a=18*(-3*n+2*r+3*s-i[3].x*i[2].y),o=18*(3*n-r-3*s),l=18*(s-n);if(vx.approximately(a,0)){if(!vx.approximately(o,0)){let e=-l/o;if(0<=e&&e<=1)return[e]}return[]}let h=2*a;if(vx.approximately(h,0))return[];let u=o*o-4*a*l;if(u<0)return[];let c=Math.sqrt(u);return[(c-o)/h,-(o+c)/h].filter(function(e){return 0<=e&&e<=1})},bboxoverlap:function(e,i){let n=["x","y"],r=n.length;for(let s=0,a,o,l,h;s<r;s++)if(o=e[a=n[s]].mid,l=i[a].mid,h=(e[a].size+i[a].size)/2,va(o-l)>=h)return!1;return!0},expandbox:function(e,i){i.x.min<e.x.min&&(e.x.min=i.x.min),i.y.min<e.y.min&&(e.y.min=i.y.min),i.z&&i.z.min<e.z.min&&(e.z.min=i.z.min),i.x.max>e.x.max&&(e.x.max=i.x.max),i.y.max>e.y.max&&(e.y.max=i.y.max),i.z&&i.z.max>e.z.max&&(e.z.max=i.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,i,n){let r=e.bbox(),s=i.bbox(),a=n||.5;if(r.x.size+r.y.size<a&&s.x.size+s.y.size<a)return[(1e5*(e._t1+e._t2)/2|0)/1e5+"/"+(1e5*(i._t1+i._t2)/2|0)/1e5];let o=e.split(.5),l=i.split(.5),h=[{left:o.left,right:l.left},{left:o.left,right:l.right},{left:o.right,right:l.right},{left:o.right,right:l.left}];h=h.filter(function(e){return vx.bboxoverlap(e.left.bbox(),e.right.bbox())});let u=[];return 0===h.length?u:(h.forEach(function(e){u=u.concat(vx.pairiteration(e.left,e.right,a))}),u=u.filter(function(e,i){return u.indexOf(e)===i}))},getccenter:function(e,i,n){let r=i.x-e.x,s=i.y-e.y,a=n.x-i.x,o=n.y-i.y,l=r*vo(vg)-s*vl(vg),h=r*vl(vg)+s*vo(vg),u=a*vo(vg)-o*vl(vg),c=a*vl(vg)+o*vo(vg),d=(e.x+i.x)/2,p=(e.y+i.y)/2,f=(i.x+n.x)/2,m=(i.y+n.y)/2,g=vx.lli8(d,p,d+l,p+h,f,m,f+u,m+c),A=vx.dist(g,e),v=vu(e.y-g.y,e.x-g.x),y=vu(i.y-g.y,i.x-g.x),x=vu(n.y-g.y,n.x-g.x),_;return v<x?((v>y||y>x)&&(v+=vm),v>x&&(_=x,x=v,v=_)):x<y&&y<v?(_=x,x=v,v=_):x+=vm,g.s=v,g.e=x,g.r=A,g},numberSort:function(e,i){return e-i}};class v_{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(e){return vx.pointsToString(e.points)}).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map(function(e){return e.length()}).reduce(function(e,i){return e+i})}curve(e){return this.curves[e]}bbox(){let e=this.curves;for(var i=e[0].bbox(),n=1;n<e.length;n++)vx.expandbox(i,e[n].bbox());return i}offset(e){let i=[];return this.curves.forEach(function(n){i.push(...n.offset(e))}),new v_(i)}}let{abs:vb,min:vE,max:vw,cos:vM,sin:vC,acos:vS,sqrt:vT}=Math,vR=Math.PI;class vI{constructor(e){let i=e&&e.forEach?e:Array.from(arguments).slice(),n=!1;if("object"==typeof i[0]){n=i.length;let e=[];i.forEach(function(i){["x","y","z"].forEach(function(n){void 0!==i[n]&&e.push(i[n])})}),i=e}let r=!1,s=i.length;if(n){if(n>4){if(1!=arguments.length)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");r=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!=arguments.length)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");let a=this._3d=!r&&(9===s||12===s)||e&&e[0]&&void 0!==e[0].z,o=this.points=[];for(let e=0,n=a?3:2;e<s;e+=n){var l={x:i[e],y:i[e+1]};a&&(l.z=i[e+2]),o.push(l)}let h=this.order=o.length-1,u=this.dims=["x","y"];a&&u.push("z"),this.dimlen=u.length;let c=vx.align(o,{p1:o[0],p2:o[h]}),d=vx.dist(o[0],o[h]);this._linear=c.reduce((e,i)=>e+vb(i.y),0)<d/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,i,n,r){if(void 0===r&&(r=.5),0===r)return new vI(i,i,n);if(1===r)return new vI(e,i,i);let s=vI.getABC(2,e,i,n,r);return new vI(e,s.A,n)}static cubicFromPoints(e,i,n,r,s){void 0===r&&(r=.5);let a=vI.getABC(3,e,i,n,r);void 0===s&&(s=vx.dist(i,a.C));let o=s*(1-r)/r,l=vx.dist(e,n),h=(n.x-e.x)/l,u=(n.y-e.y)/l,c=s*h,d=s*u,p={x:i.x-c,y:i.y-d},f={x:i.x+o*h,y:i.y+o*u},m=a.A,g={x:m.x+(p.x-m.x)/(1-r),y:m.y+(p.y-m.y)/(1-r)},A={x:m.x+(f.x-m.x)/r,y:m.y+(f.y-m.y)/r},v={x:e.x+(g.x-e.x)/r,y:e.y+(g.y-e.y)/r};return new vI(e,v,{x:n.x+(A.x-n.x)/(1-r),y:n.y+(A.y-n.y)/(1-r)},n)}static getUtils(){return vx}getUtils(){return vI.getUtils()}static get PolyBezier(){return v_}valueOf(){return this.toString()}toString(){return vx.pointsToString(this.points)}toSVG(){if(this._3d)return!1;let e=this.points,i=["M",e[0].x,e[0].y,2===this.order?"Q":"C"];for(let n=1,r=e.length;n<r;n++)i.push(e[n].x),i.push(e[n].y);return i.join(" ")}setRatios(e){if(e.length!==this.points.length)throw Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){let e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map(function(e,i){return""+i+e.x+e.y+(e.z?e.z:0)}).join("")}update(){this._lut=[],this.dpoints=vx.derive(this.points,this._3d),this.computedirection()}computedirection(){let e=this.points,i=vx.angle(e[0],e[this.order],e[1]);this.clockwise=i>0}length(){return vx.length(this.derivative.bind(this))}static getABC(e=2,i,n,r,s=.5){let a=vx.projectionratio(s,e),o=1-a,l={x:a*i.x+o*r.x,y:a*i.y+o*r.y},h=vx.abcratio(s,e);return{A:{x:n.x+(n.x-l.x)/h,y:n.y+(n.y-l.y)/h},B:n,C:l,S:i,E:r}}getABC(e,i){i=i||this.get(e);let n=this.points[0],r=this.points[this.order];return vI.getABC(this.order,n,i,r,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let i=0,n,r;i<e;i++)r=i/(e-1),(n=this.compute(r)).t=r,this._lut.push(n);return this._lut}on(e,i){i=i||5;let n=this.getLUT(),r=[];for(let s=0,a;s<n.length;s++)a=n[s],vx.dist(a,e)<i&&(r.push(a),n.length);return!!r.length&&(t/=r.length)}project(e){let i=this.getLUT(),n=i.length-1,r=vx.closest(i,e),s=r.mpos,a=(s-1)/n,o=(s+1)/n,l=.1/n,h=r.mdist,u=a,c=u,d;h+=1;for(let i;u<o+l;u+=l)d=this.compute(u),(i=vx.dist(e,d))<h&&(h=i,c=u);return c=c<0?0:c>1?1:c,(d=this.compute(c)).t=c,d.d=h,d}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?vx.computeWithRatios(e,this.points,this.ratios,this._3d):vx.compute(e,this.points,this._3d,this.ratios)}raise(){let e=this.points,i=[e[0]],n=e.length;for(let r=1,s,a;r<n;r++)s=e[r],a=e[r-1],i[r]={x:(n-r)/n*s.x+r/n*a.x,y:(n-r)/n*s.y+r/n*a.y};return i[n]=e[n-1],new vI(i)}derivative(e){return vx.compute(e,this.dpoints[0],this._3d)}dderivative(e){return vx.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new vI(vx.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return vx.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return vx.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){let i=this.derivative(e),n=vT(i.x*i.x+i.y*i.y);return{t:e,x:-i.y/n,y:i.x/n}}__normal3(e){let i=this.derivative(e),n=this.derivative(e+.01),r=vT(i.x*i.x+i.y*i.y+i.z*i.z),s=vT(n.x*n.x+n.y*n.y+n.z*n.z);i.x/=r,i.y/=r,i.z/=r,n.x/=s,n.y/=s,n.z/=s;let a={x:n.y*i.z-n.z*i.y,y:n.z*i.x-n.x*i.z,z:n.x*i.y-n.y*i.x},o=vT(a.x*a.x+a.y*a.y+a.z*a.z);a.x/=o,a.y/=o,a.z/=o;let l=[a.x*a.x,a.x*a.y-a.z,a.x*a.z+a.y,a.x*a.y+a.z,a.y*a.y,a.y*a.z-a.x,a.x*a.z-a.y,a.y*a.z+a.x,a.z*a.z];return{t:e,x:l[0]*i.x+l[1]*i.y+l[2]*i.z,y:l[3]*i.x+l[4]*i.y+l[5]*i.z,z:l[6]*i.x+l[7]*i.y+l[8]*i.z}}hull(e){let i=this.points,n=[],r=[],s=0;for(r[s++]=i[0],r[s++]=i[1],r[s++]=i[2],3===this.order&&(r[s++]=i[3]);i.length>1;){n=[];for(let a=0,o,l=i.length-1;a<l;a++)o=vx.lerp(e,i[a],i[a+1]),r[s++]=o,n.push(o);i=n}return r}split(e,i){if(0===e&&i)return this.split(i).left;if(1===i)return this.split(e).right;let n=this.hull(e),r={left:new vI(2===this.order?[n[0],n[3],n[5]]:[n[0],n[4],n[7],n[9]]),right:new vI(2===this.order?[n[5],n[4],n[2]]:[n[9],n[8],n[6],n[3]]),span:n};return(r.left._t1=vx.map(0,0,1,this._t1,this._t2),r.left._t2=vx.map(e,0,1,this._t1,this._t2),r.right._t1=vx.map(e,0,1,this._t1,this._t2),r.right._t2=vx.map(1,0,1,this._t1,this._t2),i)?(i=vx.map(i,e,1,0,1),r.right.split(i).left):r}extrema(){let e={},i=[];return this.dims.forEach((function(n){let r=function(e){return e[n]},s=this.dpoints[0].map(r);e[n]=vx.droots(s),3===this.order&&(s=this.dpoints[1].map(r),e[n]=e[n].concat(vx.droots(s))),e[n]=e[n].filter(function(e){return e>=0&&e<=1}),i=i.concat(e[n].sort(vx.numberSort))}).bind(this)),e.values=i.sort(vx.numberSort).filter(function(e,n){return i.indexOf(e)===n}),e}bbox(){let e=this.extrema(),i={};return this.dims.forEach((function(n){i[n]=vx.getminmax(this,n,e[n])}).bind(this)),i}overlaps(e){let i=this.bbox(),n=e.bbox();return vx.bboxoverlap(i,n)}offset(e,i){if(void 0!==i){let n=this.get(e),r=this.normal(e),s={c:n,n:r,x:n.x+r.x*i,y:n.y+r.y*i};return this._3d&&(s.z=n.z+r.z*i),s}if(this._linear){let i=this.normal(0);return[new vI(this.points.map(function(n){let r={x:n.x+e*i.x,y:n.y+e*i.y};return n.z&&i.z&&(r.z=n.z+e*i.z),r}))]}return this.reduce().map(function(i){return i._linear?i.offset(e)[0]:i.scale(e)})}simple(){if(3===this.order){let e=vx.angle(this.points[0],this.points[3],this.points[1]),i=vx.angle(this.points[0],this.points[3],this.points[2]);if(e>0&&i<0||e<0&&i>0)return!1}let e=this.normal(0),i=this.normal(1),n=e.x*i.x+e.y*i.y;return this._3d&&(n+=e.z*i.z),vb(vS(n))<vR/3}reduce(){let e,i=0,n=0,r,s=[],a=[],o=this.extrema().values;for(-1===o.indexOf(0)&&(o=[0].concat(o)),-1===o.indexOf(1)&&o.push(1),i=o[0],e=1;e<o.length;e++)n=o[e],(r=this.split(i,n))._t1=i,r._t2=n,s.push(r),i=n;return s.forEach(function(e){for(i=0,n=0;n<=1;)for(n=i+.01;n<=1.01;n+=.01)if(!(r=e.split(i,n)).simple()){if(n-=.01,.01>vb(i-n))return[];(r=e.split(i,n))._t1=vx.map(i,0,1,e._t1,e._t2),r._t2=vx.map(n,0,1,e._t1,e._t2),a.push(r),i=n;break}i<1&&((r=e.split(i,1))._t1=vx.map(i,0,1,e._t1,e._t2),r._t2=e._t2,a.push(r))}),a}translate(e,i,n){n="number"==typeof n?n:i;let r=this.order,s=this.points.map((e,s)=>(1-s/r)*i+s/r*n);return new vI(this.points.map((i,n)=>({x:i.x+e.x*s[n],y:i.y+e.y*s[n]})))}scale(e){let i=this.order,n=!1;if("function"==typeof e&&(n=e),n&&2===i)return this.raise().scale(n);let r=this.clockwise,s=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):e,n?n(1):e);let a=n?n(0):e,o=n?n(1):e,l=[this.offset(0,10),this.offset(1,10)],h=[],u=vx.lli4(l[0],l[0].c,l[1],l[1].c);if(!u)throw Error("cannot scale this curve. Try reducing it first.");return([0,1].forEach(function(e){let n=h[e*i]=vx.copy(s[e*i]);n.x+=(e?o:a)*l[e].n.x,n.y+=(e?o:a)*l[e].n.y}),n)?[0,1].forEach(function(a){if(2!==i||!a){var o=s[a+1],l={x:o.x-u.x,y:o.y-u.y},c=n?n((a+1)/i):e;n&&!r&&(c=-c);var d=vT(l.x*l.x+l.y*l.y);l.x/=d,l.y/=d,h[a+1]={x:o.x+c*l.x,y:o.y+c*l.y}}}):[0,1].forEach(e=>{if(2===i&&e)return;let n=h[e*i],r=this.derivative(e),a={x:n.x+r.x,y:n.y+r.y};h[e+1]=vx.lli4(n,a,u,s[e+1])}),new vI(h)}outline(e,i,n,r){if(i=void 0===i?e:i,this._linear){let s,a,o;let l=this.normal(0),h=this.points[0],u=this.points[this.points.length-1];void 0===n&&(n=e,r=i),s={x:h.x+l.x*e,y:h.y+l.y*e},o={x:u.x+l.x*n,y:u.y+l.y*n},a={x:(s.x+o.x)/2,y:(s.y+o.y)/2};let c=[s,a,o];s={x:h.x-l.x*i,y:h.y-l.y*i},o={x:u.x-l.x*r,y:u.y-l.y*r},a={x:(s.x+o.x)/2,y:(s.y+o.y)/2};let d=[o,a,s],p=vx.makeline(d[2],c[0]),f=vx.makeline(c[2],d[0]);return new v_([p,new vI(c),f,new vI(d)])}let s=this.reduce(),a=s.length,o=[],l=[],h,u=0,c=this.length(),d=void 0!==n&&void 0!==r;function p(e,i,n,r,s){return function(a){let o=i-e;return vx.map(a,0,1,e+r/n*o,e+(r+s)/n*o)}}s.forEach(function(s){let a=s.length();d?(o.push(s.scale(p(e,n,c,u,a))),l.push(s.scale(p(-i,-r,c,u,a)))):(o.push(s.scale(e)),l.push(s.scale(-i))),u+=a}),l=l.map(function(e){return(h=e.points)[3]?e.points=[h[3],h[2],h[1],h[0]]:e.points=[h[2],h[1],h[0]],e}).reverse();let f=o[0].points[0],m=o[a-1].points[o[a-1].points.length-1],g=l[a-1].points[l[a-1].points.length-1],A=l[0].points[0],v=vx.makeline(g,f),y=vx.makeline(m,A);return new v_([v].concat(o).concat([y]).concat(l))}outlineshapes(e,i,n){i=i||e;let r=this.outline(e,i).curves,s=[];for(let e=1,i=r.length;e<i/2;e++){let a=vx.makeshape(r[e],r[i-e],n);a.startcap.virtual=e>1,a.endcap.virtual=e<i/2-1,s.push(a)}return s}intersects(e,i){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof vI&&(e=e.reduce()),this.curveintersects(this.reduce(),e,i)):this.selfintersects(i)}lineIntersects(e){let i=vE(e.p1.x,e.p2.x),n=vE(e.p1.y,e.p2.y),r=vw(e.p1.x,e.p2.x),s=vw(e.p1.y,e.p2.y);return vx.roots(this.points,e).filter(e=>{var a=this.get(e);return vx.between(a.x,i,r)&&vx.between(a.y,n,s)})}selfintersects(e){let i=this.reduce(),n=i.length-2,r=[];for(let s=0,a,o;s<n;s++)a=i.slice(s,s+1),o=i.slice(s+2),r.push(...this.curveintersects(a,o,e));return r}curveintersects(e,i,n){let r=[];e.forEach(function(e){i.forEach(function(i){e.overlaps(i)&&r.push({left:e,right:i})})});let s=[];return r.forEach(function(e){let i=vx.pairiteration(e.left,e.right,n);i.length>0&&(s=s.concat(i))}),s}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,i,n,r){let s=(r-n)/4,a=this.get(n+s),o=this.get(r-s),l=vx.dist(e,i),h=vx.dist(e,a),u=vx.dist(e,o);return vb(h-l)+vb(u-l)}_iterate(e,i){let n=0,r=1,s;do{s=0,r=1;let a=this.get(n),o,l,h,u,c=!1,d=!1,p,f=r,m=1;do if(d=c,u=h,f=(n+r)/2,o=this.get(f),l=this.get(r),(h=vx.getccenter(a,o,l)).interval={start:n,end:r},c=this._error(h,a,n,r)<=e,(p=d&&!c)||(m=r),c){if(r>=1){if(h.interval.end=m=1,u=h,r>1){let e={x:h.x+h.r*vM(h.e),y:h.y+h.r*vC(h.e)};h.e+=vx.angle({x:h.x,y:h.y},e,this.get(1))}break}r+=(r-n)/2}else r=f;while(!p&&s++<100);if(s>=100)break;u=u||h,i.push(u),n=m}while(r<1);return i}}function vB(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function vL(e){var i=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i);if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof i?i:i+""}function vP(e,i){if(e){if("string"==typeof e)return vB(e,i);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vB(e,i):void 0}}var vD=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(i instanceof Array?i.length?i:[void 0]:[i]).map(function(e){return{keyAccessor:e,isProp:!(e instanceof Function)}}),a=e.reduce(function(e,i){var r=e,a=i;return s.forEach(function(e,i){var o,l=e.keyAccessor;if(e.isProp){var h=a,u=h[l],c=function(e,i){if(null==e)return{};var n,r,s=function(e,i){if(null==e)return{};var n={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(i.includes(r))continue;n[r]=e[r]}return n}(e,i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],i.includes(n)||({}).propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}(h,[l].map(vL));o=u,a=c}else o=l(a,i);i+1<s.length?(r.hasOwnProperty(o)||(r[o]={}),r=r[o]):n?(r.hasOwnProperty(o)||(r[o]=[]),r[o].push(a)):r[o]=a}),e},{});n instanceof Function&&function e(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r===s.length?Object.keys(i).forEach(function(e){return i[e]=n(i[e])}):Object.values(i).forEach(function(i){return e(i,r+1)})}(a);var o=a;return r&&(o=[],function e(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n.length===s.length?o.push({keys:n,vals:i}):Object.entries(i).forEach(function(i){var r=function(e){if(Array.isArray(e))return e}(i)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{a=(n=n.call(e)).next;for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(i,2)||vP(i,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),s=r[0];return e(r[1],[].concat(function(e){if(Array.isArray(e))return vB(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||vP(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[s]))})}(a),i instanceof Array&&0===i.length&&1===o.length&&(o[0].keys=[])),o},vN=n(83413),vO=n(79865);function vU(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function vk(e,i,n){if(vz())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,i),new(e.bind.apply(e,r))}function vF(e,i,n){var r;return(i="symbol"==typeof(r=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(i,"string"))?r:r+"")in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function vz(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(vz=function(){return!!e})()}function vG(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function vV(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?vG(Object(n),!0).forEach(function(i){vF(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vG(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function vj(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{if(a=(n=n.call(e)).next,0===i);else for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,i)||vW(e,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vH(e){return function(e){if(Array.isArray(e))return vU(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||vW(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vQ(e){return(vQ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vW(e,i){if(e){if("string"==typeof e)return vU(e,i);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vU(e,i):void 0}}!function(e,i){void 0===i&&(i={});var n=i.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===n&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(".force-graph-container canvas {\n  display: block;\n  user-select: none;\n  outline: none;\n  -webkit-tap-highlight-color: transparent;\n}\n\n.force-graph-container .clickable {\n  cursor: pointer;\n}\n\n.force-graph-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.force-graph-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}\n");var vq=(0,vN.Z)(vO.Z);function vX(e,i,n){i&&"string"==typeof n&&e.filter(function(e){return!e[n]}).forEach(function(e){e[n]=vq(i(e))})}var vK=function(e,i){return i.onNeedsRedraw&&i.onNeedsRedraw()},vY=function(e,i){if(!i.isShadow){var n=(0,b.default)(i.linkDirectionalParticles);i.graphData.links.forEach(function(e){var i=Math.round(Math.abs(n(e)));i?e.__photons=vH(Array(i)).map(function(){return{}}):delete e.__photons})}},vJ=(0,_.Z)({props:{graphData:{default:{nodes:[],links:[]},onChange:function(e,i){i.engineRunning=!1,vY(e,i)}},dagMode:{onChange:function(e,i){e||(i.graphData.nodes||[]).forEach(function(e){return e.fx=e.fy=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:vK},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:vK},nodeColor:{default:"color",triggerUpdate:!1,onChange:vK},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:vK},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:vK},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:vK},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:vK},linkColor:{default:"color",triggerUpdate:!1,onChange:vK},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:vK},linkWidth:{default:1,triggerUpdate:!1,onChange:vK},linkCurvature:{default:0,triggerUpdate:!1,onChange:vK},linkCanvasObject:{triggerUpdate:!1,onChange:vK},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:vK},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:vK},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:vK},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:vK},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:vY},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,i){i.forceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,i){i.forceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,i){i.forceLayout.velocityDecay(e)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(e,i,n){return void 0===n?e.forceLayout.force(i):(e.forceLayout.force(i,n),this)},d3ReheatSimulation:function(e){return e.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},isEngineRunning:function(e){return!!e.engineRunning},tickFrame:function(e){var i,n,r,s,a,o,l,h,u,c,d,p,f,m,g,A,v,y,x;return e.isShadow||e.engineRunning&&(++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||e.d3AlphaMin>0&&e.forceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.forceLayout.tick(),e.onEngineTick())),function(){var i=(0,b.default)(e.linkVisibility),n=(0,b.default)(e.linkColor),r=(0,b.default)(e.linkWidth),s=(0,b.default)(e.linkLineDash),a=(0,b.default)(e.linkCurvature),o=(0,b.default)(e.linkCanvasObjectMode),l=e.ctx,h=2*e.isShadow,u=e.graphData.links.filter(i);u.forEach(function(e){var i=a(e);if(!i){e.__controlPoints=null;return}var n=e.source,r=e.target;if(n&&r&&n.hasOwnProperty("x")&&r.hasOwnProperty("x")){var s=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2));if(s>0){var o=Math.atan2(r.y-n.y,r.x-n.x),l=s*i,h={x:(n.x+r.x)/2+l*Math.cos(o-Math.PI/2),y:(n.y+r.y)/2+l*Math.sin(o-Math.PI/2)};e.__controlPoints=[h.x,h.y]}else{var u=70*i;e.__controlPoints=[r.x,r.y-u,r.x+u,r.y]}}});var c=[],d=[],p=u;if(e.linkCanvasObject){var f=[],m=[];u.forEach(function(e){return(({before:c,after:d,replace:f})[o(e)]||m).push(e)}),p=[].concat(vH(c),d,m),c=c.concat(f)}l.save(),c.forEach(function(i){return e.linkCanvasObject(i,l,e.globalScale)}),l.restore();var g=vD(p,[n,r,s]);l.save(),Object.entries(g).forEach(function(i){var n=vj(i,2),r=n[0],a=n[1],o=r&&"undefined"!==r?r:"rgba(0,0,0,0.15)";Object.entries(a).forEach(function(i){var n=vj(i,2),r=n[0],a=n[1],u=(r||1)/e.globalScale+h;Object.entries(a).forEach(function(e){var i=vj(e,2);i[0];var n=i[1],r=s(n[0]);l.beginPath(),n.forEach(function(e){var i=e.source,n=e.target;if(i&&n&&i.hasOwnProperty("x")&&n.hasOwnProperty("x")){l.moveTo(i.x,i.y);var r=e.__controlPoints;r?l[2===r.length?"quadraticCurveTo":"bezierCurveTo"].apply(l,vH(r).concat([n.x,n.y])):l.lineTo(n.x,n.y)}}),l.strokeStyle=o,l.lineWidth=u,l.setLineDash(r||[]),l.stroke()})})}),l.restore(),l.save(),d.forEach(function(i){return e.linkCanvasObject(i,l,e.globalScale)}),l.restore()}(),e.isShadow||(i=(0,b.default)(e.linkDirectionalArrowLength),n=(0,b.default)(e.linkDirectionalArrowRelPos),r=(0,b.default)(e.linkVisibility),s=(0,b.default)(e.linkDirectionalArrowColor||e.linkColor),a=(0,b.default)(e.nodeVal),(o=e.ctx).save(),e.graphData.links.filter(r).forEach(function(r){var l=i(r);if(l&&!(l<0)){var h=r.source,u=r.target;if(h&&u&&h.hasOwnProperty("x")&&u.hasOwnProperty("x")){var c=Math.sqrt(Math.max(0,a(h)||1))*e.nodeRelSize,d=Math.sqrt(Math.max(0,a(u)||1))*e.nodeRelSize,p=Math.min(1,Math.max(0,n(r))),f=s(r)||"rgba(0,0,0,0.28)",m=l/1.6/2,g=r.__controlPoints&&vk(vI,[h.x,h.y].concat(vH(r.__controlPoints),[u.x,u.y])),A=g?function(e){return g.get(e)}:function(e){return{x:h.x+(u.x-h.x)*e||0,y:h.y+(u.y-h.y)*e||0}},v=g?g.length():Math.sqrt(Math.pow(u.x-h.x,2)+Math.pow(u.y-h.y,2)),y=c+l+(v-c-d-l)*p,x=A(y/v),_=A((y-l)/v),b=A((y-.8*l)/v),E=Math.atan2(x.y-_.y,x.x-_.x)-Math.PI/2;o.beginPath(),o.moveTo(x.x,x.y),o.lineTo(_.x+m*Math.cos(E),_.y+m*Math.sin(E)),o.lineTo(b.x,b.y),o.lineTo(_.x-m*Math.cos(E),_.y-m*Math.sin(E)),o.fillStyle=f,o.fill()}}}),o.restore()),e.isShadow||(l=(0,b.default)(e.linkDirectionalParticles),h=(0,b.default)(e.linkDirectionalParticleSpeed),u=(0,b.default)(e.linkDirectionalParticleWidth),c=(0,b.default)(e.linkVisibility),d=(0,b.default)(e.linkDirectionalParticleColor||e.linkColor),(p=e.ctx).save(),e.graphData.links.filter(c).forEach(function(i){var n=l(i);if(i.hasOwnProperty("__photons")&&i.__photons.length){var r=i.source,s=i.target;if(r&&s&&r.hasOwnProperty("x")&&s.hasOwnProperty("x")){var a=h(i),o=i.__photons||[],c=Math.max(0,u(i)/2)/Math.sqrt(e.globalScale),f=d(i)||"rgba(0,0,0,0.28)";p.fillStyle=f;var m=i.__controlPoints?vk(vI,[r.x,r.y].concat(vH(i.__controlPoints),[s.x,s.y])):null,g=0,A=!1;o.forEach(function(e){var i=!!e.__singleHop;if(e.hasOwnProperty("__progressRatio")||(e.__progressRatio=i?0:g/n),!i&&g++,e.__progressRatio+=a,e.__progressRatio>=1){if(i){A=!0;return}e.__progressRatio=e.__progressRatio%1}var o=e.__progressRatio,l=m?m.get(o):{x:r.x+(s.x-r.x)*o||0,y:r.y+(s.y-r.y)*o||0};p.beginPath(),p.arc(l.x,l.y,c,0,2*Math.PI,!1),p.fill()}),A&&(i.__photons=i.__photons.filter(function(e){return!e.__singleHop||e.__progressRatio<=1}))}}}),p.restore()),f=(0,b.default)(e.nodeVisibility),m=(0,b.default)(e.nodeVal),g=(0,b.default)(e.nodeColor),A=(0,b.default)(e.nodeCanvasObjectMode),v=e.ctx,y=e.isShadow/e.globalScale,x=e.graphData.nodes.filter(f),v.save(),x.forEach(function(i){var n=A(i);if(e.nodeCanvasObject&&("before"===n||"replace"===n)&&(e.nodeCanvasObject(i,v,e.globalScale),"replace"===n)){v.restore();return}var r=Math.sqrt(Math.max(0,m(i)||1))*e.nodeRelSize+y;v.beginPath(),v.arc(i.x,i.y,r,0,2*Math.PI,!1),v.fillStyle=g(i)||"rgba(31, 120, 180, 0.92)",v.fill(),e.nodeCanvasObject&&"after"===n&&e.nodeCanvasObject(i,e.ctx,e.globalScale)}),v.restore(),this},emitParticle:function(e,i){return i&&(i.__photons||(i.__photons=[]),i.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:(0,vt.Z)().force("link",(0,vi.Z)()).force("charge",(0,vn.Z)()).force("center",(0,vr.Z)()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,i){i.ctx=e},update:function(e,i){e.engineRunning=!1,e.onUpdate(),null!==e.nodeAutoColorBy&&vX(e.graphData.nodes,(0,b.default)(e.nodeAutoColorBy),e.nodeColor),null!==e.linkAutoColorBy&&vX(e.graphData.links,(0,b.default)(e.linkAutoColorBy),e.linkColor),e.graphData.links.forEach(function(i){i.source=i[e.linkSource],i.target=i[e.linkTarget]}),e.forceLayout.stop().alpha(1).nodes(e.graphData.nodes);var n=e.forceLayout.force("link");n&&n.id(function(i){return i[e.nodeId]}).links(e.graphData.links);var r=e.dagMode&&function(e,i){var n=e.nodes,r=e.links,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s.nodeFilter,o=void 0===a?function(){return!0}:a,l=s.onLoopError,h=void 0===l?function(e){throw"Invalid DAG structure! Found cycle in node path: ".concat(e.join(" -> "),".")}:l,u={};n.forEach(function(e){return u[i(e)]={data:e,out:[],depth:-1,skip:!o(e)}}),r.forEach(function(e){var n=e.source,r=e.target,s=h(n),a=h(r);if(!u.hasOwnProperty(s))throw"Missing source node with id: ".concat(s);if(!u.hasOwnProperty(a))throw"Missing target node with id: ".concat(a);var o=u[s],l=u[a];function h(e){return"object"===vQ(e)?i(e):e}o.out.push(l)});var c=[];return function e(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=0,o=n.length;a<o;a++)if(function(){var o=n[a];if(-1!==r.indexOf(o)){var l=[].concat(vH(r.slice(r.indexOf(o))),[o]).map(function(e){return i(e.data)});return c.some(function(e){return e.length===l.length&&e.every(function(e,i){return e===l[i]})})||(c.push(l),h(l)),1}s>o.depth&&(o.depth=s,e(o.out,[].concat(vH(r),[o]),s+ +!o.skip))}())continue}(Object.values(u)),Object.assign.apply(Object,[{}].concat(vH(Object.entries(u).filter(function(e){return!vj(e,2)[1].skip}).map(function(e){var i=vj(e,2);return vF({},i[0],i[1].depth)}))))}(e.graphData,function(i){return i[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),s=Math.max.apply(Math,vH(Object.values(r||[]))),a=e.dagLevelDistance||e.graphData.nodes.length/(s||1)*2*(-1!==["radialin","radialout"].indexOf(e.dagMode)?.7:1);if(["lr","rl","td","bu"].includes(i.dagMode)){var o=["lr","rl"].includes(i.dagMode)?"fx":"fy";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(e){return delete e[o]})}if(["lr","rl","td","bu"].includes(e.dagMode)){var l=["rl","bu"].includes(e.dagMode),h=["lr","rl"].includes(e.dagMode)?"fx":"fy";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(i){return i[h]=(r[i[e.nodeId]]-s/2)*a*(l?-1:1)})}e.forceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(e.dagMode)?(0,vs.Z)(function(i){var n=r[i[e.nodeId]]||-1;return("radialin"===e.dagMode?s-n:n)*a}).strength(function(i){return+!!e.dagNodeFilter(i)}):null);for(var u=0;u<e.warmupTicks&&!(e.d3AlphaMin>0&&e.forceLayout.alpha()<e.d3AlphaMin);u++)e.forceLayout.tick();this.resetCountdown(),e.onFinishUpdate()}});function vZ(e,i){var n=e instanceof Array?e:[e],r=new i;return r._destructor&&r._destructor(),{linkProp:function(e){return{default:r[e](),onChange:function(i,r){n.forEach(function(n){return r[n][e](i)})},triggerUpdate:!1}},linkMethod:function(e){return function(i){for(var r=arguments.length,s=Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];var o=[];return n.forEach(function(n){var r=i[n],a=r[e].apply(r,s);a!==r&&o.push(a)}),o.length?o[0]:this}}}}var v$=vZ("forceGraph",vJ),v0=vZ(["forceGraph","shadowGraph"],vJ),v1=Object.assign.apply(Object,vH(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(e){return vF({},e,v$.linkProp(e))})).concat(vH(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map(function(e){return vF({},e,v0.linkProp(e))})))),v2=Object.assign.apply(Object,vH(["d3Force","d3ReheatSimulation","emitParticle"].map(function(e){return vF({},e,v$.linkMethod(e))})));function v3(e){if(e.canvas){var i=e.canvas.width,n=e.canvas.height;300===i&&150===n&&(i=n=0);var r=window.devicePixelRatio;i/=r,n/=r,[e.canvas,e.shadowCanvas].forEach(function(s){s.style.width="".concat(e.width,"px"),s.style.height="".concat(e.height,"px"),s.width=e.width*r,s.height=e.height*r,i||n||s.getContext("2d").scale(r,r)});var s=(0,AW.P2)(e.canvas).k;e.zoom.translateBy(e.zoom.__baseElem,(e.width-i)/2/s,(e.height-n)/2/s),e.needsRedraw=!0}}function v4(e){var i=window.devicePixelRatio;e.setTransform(i,0,0,i,0,0)}function v5(e,i,n){e.save(),v4(e),e.clearRect(0,0,i,n),e.restore()}var v6=(0,_.Z)({props:vV({width:{default:window.innerWidth,onChange:function(e,i){return v3(i)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(e,i){return v3(i)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,i){[e.nodes,e.links].every(function(e){return(e||[]).every(function(e){return!e.hasOwnProperty("__indexColor")})})&&i.colorTracker.reset(),[{type:"Node",objs:e.nodes},{type:"Link",objs:e.links}].forEach(function(e){var n=e.type;e.objs.filter(function(e){if(!e.hasOwnProperty("__indexColor"))return!0;var n=i.colorTracker.lookup(e.__indexColor);return!n||!n.hasOwnProperty("d")||n.d!==e}).forEach(function(e){e.__indexColor=i.colorTracker.register({type:n,d:e})})}),i.forceGraph.graphData(e),i.shadowGraph.graphData(e)},triggerUpdate:!1},backgroundColor:{onChange:function(e,i){i.canvas&&e&&(i.canvas.style.background=e)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(e,i){i.shadowGraph.nodeCanvasObject(e?function(i,n,r){return e(i,i.__indexColor,n,r)}:null),i.flushShadowCanvas&&i.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(e,i){i.shadowGraph.linkCanvasObject(e?function(i,n,r){return e(i,i.__indexColor,n,r)}:null),i.flushShadowCanvas&&i.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(e,i){i.zoom.scaleExtent([e,i.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(e,i){i.zoom.scaleExtent([i.zoom.scaleExtent()[0],e])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(e,i){i.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},v1),aliases:{stopAnimation:"pauseAnimation"},methods:vV({graph2ScreenCoords:function(e,i,n){var r=(0,AW.P2)(e.canvas);return{x:i*r.k+r.x,y:n*r.k+r.y}},screen2GraphCoords:function(e,i,n){var r=(0,AW.P2)(e.canvas);return{x:(i-r.x)/r.k,y:(n-r.y)/r.k}},centerAt:function(e,i,n,r){if(!e.canvas)return null;if(void 0!==i||void 0!==n){var s=Object.assign({},void 0!==i?{x:i}:{},void 0!==n?{y:n}:{});return r?e.tweenGroup.add(new gq(a()).to(s,r).easing(gG.Quadratic.Out).onUpdate(o).start()):o(s),this}return a();function a(){var i=(0,AW.P2)(e.canvas);return{x:(e.width/2-i.x)/i.k,y:(e.height/2-i.y)/i.k}}function o(i){var n=i.x,r=i.y;e.zoom.translateTo(e.zoom.__baseElem,void 0===n?a().x:n,void 0===r?a().y:r),e.needsRedraw=!0}},zoom:function(e,i,n){if(!e.canvas)return null;if(void 0!==i)return n?e.tweenGroup.add(new gq({k:r()}).to({k:i},n).easing(gG.Quadratic.Out).onUpdate(function(e){return s(e.k)}).start()):s(i),this;return r();function r(){return(0,AW.P2)(e.canvas).k}function s(i){e.zoom.scaleTo(e.zoom.__baseElem,i),e.needsRedraw=!0}},zoomToFit:function(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,s=Array(r>3?r-3:0),a=3;a<r;a++)s[a-3]=arguments[a];var o=this.getGraphBbox.apply(this,s);if(o){var l={x:(o.x[0]+o.x[1])/2,y:(o.y[0]+o.y[1])/2},h=Math.max(1e-12,Math.min(1e12,(e.width-2*n)/(o.x[1]-o.x[0]),(e.height-2*n)/(o.y[1]-o.y[0])));this.centerAt(l.x,l.y,i),this.zoom(h,i)}return this},getGraphBbox:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=(0,b.default)(e.nodeVal),r=e.graphData.nodes.filter(i).map(function(i){return{x:i.x,y:i.y,r:Math.sqrt(Math.max(0,n(i)||1))*e.nodeRelSize}});return r.length?{x:[(0,AX.Z)(r,function(e){return e.x-e.r}),(0,AK.Z)(r,function(e){return e.x+e.r})],y:[(0,AX.Z)(r,function(e){return e.y-e.r}),(0,AK.Z)(r,function(e){return e.y+e.r})]}:null},pauseAnimation:function(e){return e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},v2),stateInit:function(){return{lastSetZoom:1,zoom:(0,AW.sP)(),forceGraph:new vJ,shadowGraph:new vJ().cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new ve,tweenGroup:new gj}},init:function(e,i){var n=this;e.innerHTML="";var r=document.createElement("div");r.classList.add("force-graph-container"),r.style.position="relative",e.appendChild(r),i.canvas=document.createElement("canvas"),i.backgroundColor&&(i.canvas.style.background=i.backgroundColor),r.appendChild(i.canvas),i.shadowCanvas=document.createElement("canvas");var s=i.canvas.getContext("2d"),a=i.shadowCanvas.getContext("2d",{willReadFrequently:!0}),o={x:-1e12,y:-1e12},l=function(){var e=null,n=window.devicePixelRatio,r=o.x>0&&o.y>0?a.getImageData(o.x*n,o.y*n,1,1):null;return r&&(e=i.colorTracker.lookup(r.data)),e};(0,g8.Z)(i.canvas).call((0,Aq.Z)().subject(function(){if(!i.enableNodeDrag)return null;var e=l();return e&&"Node"===e.type?e.d:null}).on("start",function(e){var n=e.subject;n.__initialDragPos={x:n.x,y:n.y,fx:n.fx,fy:n.fy},e.active||(n.fx=n.x,n.fy=n.y),i.canvas.classList.add("grabbable")}).on("drag",function(e){var n=e.subject,r=n.__initialDragPos,s=(0,AW.P2)(i.canvas).k,a={x:r.x+(e.x-r.x)/s-n.x,y:r.y+(e.y-r.y)/s-n.y};["x","y"].forEach(function(i){return n["f".concat(i)]=n[i]=r[i]+(e[i]-r[i])/s}),i.forceGraph.d3AlphaTarget(.3).resetCountdown(),i.isPointerDragging=!0,n.__dragged=!0,i.onNodeDrag(n,a)}).on("end",function(e){var n=e.subject,r=n.__initialDragPos,s={x:n.x-r.x,y:n.y-r.y};void 0===r.fx&&(n.fx=void 0),void 0===r.fy&&(n.fy=void 0),delete n.__initialDragPos,i.forceGraph.d3AlphaTarget()&&i.forceGraph.d3AlphaTarget(0).resetCountdown(),i.canvas.classList.remove("grabbable"),i.isPointerDragging=!1,n.__dragged&&(delete n.__dragged,i.onNodeDragEnd(n,s))})),i.zoom(i.zoom.__baseElem=(0,g8.Z)(i.canvas)),i.zoom.__baseElem.on("dblclick.zoom",null),i.zoom.filter(function(e){return!e.button&&i.enableZoomPanInteraction&&("wheel"!==e.type||(0,b.default)(i.enableZoomInteraction)(e))&&("wheel"===e.type||(0,b.default)(i.enablePanInteraction)(e))}).on("zoom",function(e){var r=e.transform;[s,a].forEach(function(e){v4(e),e.translate(r.x,r.y),e.scale(r.k,r.k)}),i.onZoom&&i.onZoom(vV(vV({},r),n.centerAt())),i.needsRedraw=!0}).on("end",function(e){return i.onZoomEnd&&i.onZoomEnd(vV(vV({},e.transform),n.centerAt()))}),v3(i),i.forceGraph.onNeedsRedraw(function(){return i.needsRedraw=!0}).onFinishUpdate(function(){(0,AW.P2)(i.canvas).k===i.lastSetZoom&&i.graphData.nodes.length&&(i.zoom.scaleTo(i.zoom.__baseElem,i.lastSetZoom=4/Math.cbrt(i.graphData.nodes.length)),i.needsRedraw=!0)}),i.tooltip=new AM(r),["pointermove","pointerdown"].forEach(function(e){return r.addEventListener(e,function(n){"pointerdown"===e&&(i.isPointerPressed=!0,i.pointerDownEvent=n),!i.isPointerDragging&&"pointermove"===n.type&&i.onBackgroundClick&&(n.pressure>0||i.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some(function(e){return Math.abs(e)>1}))&&(i.isPointerDragging=!0);var s,a,l,h=(s=r.getBoundingClientRect(),a=window.pageXOffset||document.documentElement.scrollLeft,l=window.pageYOffset||document.documentElement.scrollTop,{top:s.top+l,left:s.left+a});o.x=n.pageX-h.left,o.y=n.pageY-h.top},{passive:!0})}),r.addEventListener("pointerup",function(e){if(i.isPointerPressed=!1,i.isPointerDragging){i.isPointerDragging=!1;return}var n=[e,i.pointerDownEvent];requestAnimationFrame(function(){if(0===e.button){if(i.hoverObj){var r=i["on".concat(i.hoverObj.type,"Click")];r&&r.apply(void 0,[i.hoverObj.d].concat(n))}else i.onBackgroundClick&&i.onBackgroundClick.apply(i,n)}if(2===e.button){if(i.hoverObj){var s=i["on".concat(i.hoverObj.type,"RightClick")];s&&s.apply(void 0,[i.hoverObj.d].concat(n))}else i.onBackgroundRightClick&&i.onBackgroundRightClick.apply(i,n)}})},{passive:!0}),r.addEventListener("contextmenu",function(e){return!i.onBackgroundRightClick&&!i.onNodeRightClick&&!i.onLinkRightClick||(e.preventDefault(),!1)}),i.forceGraph(s),i.shadowGraph(a);var h=AZ(function(){v5(a,i.width,i.height),i.shadowGraph.linkWidth(function(e){return(0,b.default)(i.linkWidth)(e)+i.linkHoverPrecision});var e=(0,AW.P2)(i.canvas);i.shadowGraph.globalScale(e.k).tickFrame()},800);i.flushShadowCanvas=h.flush,(this._animationCycle=function e(){var n=!i.autoPauseRedraw||!!i.needsRedraw||i.forceGraph.isEngineRunning()||i.graphData.links.some(function(e){return e.__photons&&e.__photons.length});if(i.needsRedraw=!1,i.enablePointerInteraction){var r=i.isPointerDragging?null:l();if(r!==i.hoverObj){var a=i.hoverObj,o=a?a.type:null,u=r?r.type:null;if(o&&o!==u){var c=i["on".concat(o,"Hover")];c&&c(null,a.d)}if(u){var d=i["on".concat(u,"Hover")];d&&d(r.d,o===u?a.d:null)}i.tooltip.content(r&&(0,b.default)(i["".concat(r.type.toLowerCase(),"Label")])(r.d)||null),i.canvas.classList[r&&i["on".concat(u,"Click")]||!r&&i.onBackgroundClick?"add":"remove"]("clickable"),i.hoverObj=r}n&&h()}if(n){v5(s,i.width,i.height);var p=(0,AW.P2)(i.canvas).k;i.onRenderFramePre&&i.onRenderFramePre(s,p),i.forceGraph.globalScale(p).tickFrame(),i.onRenderFramePost&&i.onRenderFramePost(s,p)}i.tweenGroup.update(),i.animationFrameRequestId=requestAnimationFrame(e)})()},update:function(e){}}),v8={width:ef.number,height:ef.number,graphData:ef.shape({nodes:ef.arrayOf(ef.object).isRequired,links:ef.arrayOf(ef.object).isRequired}),backgroundColor:ef.string,nodeRelSize:ef.number,nodeId:ef.string,nodeLabel:ef.oneOfType([ef.string,ef.func]),nodeVal:ef.oneOfType([ef.number,ef.string,ef.func]),nodeVisibility:ef.oneOfType([ef.bool,ef.string,ef.func]),nodeColor:ef.oneOfType([ef.string,ef.func]),nodeAutoColorBy:ef.oneOfType([ef.string,ef.func]),onNodeHover:ef.func,onNodeClick:ef.func,linkSource:ef.string,linkTarget:ef.string,linkLabel:ef.oneOfType([ef.string,ef.func]),linkVisibility:ef.oneOfType([ef.bool,ef.string,ef.func]),linkColor:ef.oneOfType([ef.string,ef.func]),linkAutoColorBy:ef.oneOfType([ef.string,ef.func]),linkWidth:ef.oneOfType([ef.number,ef.string,ef.func]),linkCurvature:ef.oneOfType([ef.number,ef.string,ef.func]),linkDirectionalArrowLength:ef.oneOfType([ef.number,ef.string,ef.func]),linkDirectionalArrowColor:ef.oneOfType([ef.string,ef.func]),linkDirectionalArrowRelPos:ef.oneOfType([ef.number,ef.string,ef.func]),linkDirectionalParticles:ef.oneOfType([ef.number,ef.string,ef.func]),linkDirectionalParticleSpeed:ef.oneOfType([ef.number,ef.string,ef.func]),linkDirectionalParticleWidth:ef.oneOfType([ef.number,ef.string,ef.func]),linkDirectionalParticleColor:ef.oneOfType([ef.string,ef.func]),onLinkHover:ef.func,onLinkClick:ef.func,dagMode:ef.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:ef.number,dagNodeFilter:ef.func,onDagError:ef.func,d3AlphaMin:ef.number,d3AlphaDecay:ef.number,d3VelocityDecay:ef.number,warmupTicks:ef.number,cooldownTicks:ef.number,cooldownTime:ef.number,onEngineTick:ef.func,onEngineStop:ef.func,getGraphBbox:ef.func},v7={zoomToFit:ef.func,onNodeRightClick:ef.func,onNodeDrag:ef.func,onNodeDragEnd:ef.func,onLinkRightClick:ef.func,linkHoverPrecision:ef.number,onBackgroundClick:ef.func,onBackgroundRightClick:ef.func,enablePointerInteraction:ef.bool,enableNodeDrag:ef.bool},v9={showNavInfo:ef.bool,nodeOpacity:ef.number,nodeResolution:ef.number,nodeThreeObject:ef.oneOfType([ef.object,ef.string,ef.func]),nodeThreeObjectExtend:ef.oneOfType([ef.bool,ef.string,ef.func]),linkOpacity:ef.number,linkResolution:ef.number,linkCurveRotation:ef.oneOfType([ef.number,ef.string,ef.func]),linkMaterial:ef.oneOfType([ef.object,ef.string,ef.func]),linkThreeObject:ef.oneOfType([ef.object,ef.string,ef.func]),linkThreeObjectExtend:ef.oneOfType([ef.bool,ef.string,ef.func]),linkPositionUpdate:ef.func,linkDirectionalArrowResolution:ef.number,linkDirectionalParticleResolution:ef.number,forceEngine:ef.oneOf(["d3","ngraph"]),ngraphPhysics:ef.object,numDimensions:ef.oneOf([1,2,3])},ye=Object.assign({},v8,v7,{linkLineDash:ef.oneOfType([ef.arrayOf(ef.number),ef.string,ef.func]),nodeCanvasObjectMode:ef.oneOfType([ef.string,ef.func]),nodeCanvasObject:ef.func,nodePointerAreaPaint:ef.func,linkCanvasObjectMode:ef.oneOfType([ef.string,ef.func]),linkCanvasObject:ef.func,linkPointerAreaPaint:ef.func,autoPauseRedraw:ef.bool,minZoom:ef.number,maxZoom:ef.number,enableZoomInteraction:ef.oneOfType([ef.bool,ef.func]),enablePanInteraction:ef.oneOfType([ef.bool,ef.func]),onZoom:ef.func,onZoomEnd:ef.func,onRenderFramePre:ef.func,onRenderFramePost:ef.func}),yt=Object.assign({},v8,v7,v9,{enableNavigationControls:ef.bool,controlType:ef.oneOf(["trackball","orbit","fly"]),rendererConfig:ef.object,extraRenderers:ef.arrayOf(ef.shape({render:ef.func.isRequired}))}),yi=Object.assign({},v8,v9,{nodeDesc:ef.oneOfType([ef.string,ef.func]),linkDesc:ef.oneOfType([ef.string,ef.func])}),yn=Object.assign({},v8,v9,{markerAttrs:ef.object,yOffset:ef.number,glScale:ef.number});let yr=y(ep,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"]});yr.displayName="ForceGraphVR",yr.propTypes=yi;let ys=y(eb,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"],initPropNames:["markerAttrs"]});ys.displayName="ForceGraphAR",ys.propTypes=yn;let ya=y(AH,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});ya.displayName="ForceGraph3D",ya.propTypes=yt;let yo=y(v6,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","centerAt","zoom","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords"]});yo.displayName="ForceGraph2D",yo.propTypes=ye},74435:function(e,i,n){"use strict";n.r(i),n.d(i,{default:()=>eg});var r,s,a=n(67591),o=n(46510),l=n(83585),h=n(876),u=n(64171),c=n(80633),d=n(54736),p=n(16505),f=n(57105),m=n(37964),g=n(99696),A=n(23842);function v(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function y(e,i,n){if("function"==typeof e?e===i:e.has(i))return arguments.length<3?i:n;throw TypeError("Private element is not present on this object")}function x(e,i){return e.get(y(e,i))}function _(e,i,n){(function(e,i){if(i.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")})(e,i),i.set(e,n)}function b(e,i,n){return e.set(y(e,i),n),n}function E(e,i){if(e){if("string"==typeof e)return v(e,i);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,i):void 0}}var w=new WeakMap,M=new WeakMap,C=new WeakMap,S=new WeakMap,T=new WeakMap,R=new WeakMap,I=(r=function e(){(function(e,i){if(!(e instanceof i))throw TypeError("Cannot call a class as a function")})(this,e),_(this,w,new Map),_(this,M,new Map),_(this,C,function(e){return e}),_(this,S,function(){return{}}),_(this,T,function(){}),_(this,R,function(){})},s=[{key:"getObj",value:function(e){return x(w,this).get(x(C,this).call(this,e))}},{key:"getData",value:function(e){return x(M,this).get(e)}},{key:"entries",value:function(){var e;return((function(e){if(Array.isArray(e))return v(e)})(e=x(M,this).entries())||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||E(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map(function(e){var i=function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{a=(n=n.call(e)).next;for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,2)||E(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=i[0];return[i[1],n]})}},{key:"id",value:function(e){return b(C,this,(0,m.default)(e)),this}},{key:"onCreateObj",value:function(e){return b(S,this,e),this}},{key:"onUpdateObj",value:function(e){return b(T,this,e),this}},{key:"onRemoveObj",value:function(e){return b(R,this,e),this}},{key:"digest",value:function(e){var i=this;e.filter(function(e){return!x(w,i).has(x(C,i).call(i,e))}).forEach(function(e){var n=x(S,i).call(i,e);x(w,i).set(x(C,i).call(i,e),n),x(M,i).set(n,e)});var n=new Map(e.map(function(e){return[x(C,i).call(i,e),e]}));return x(w,this).forEach(function(e,r){n.has(r)?x(T,i).call(i,e,n.get(r)):(x(R,i).call(i,e,r),x(w,i).delete(r),x(M,i).delete(e))}),this}},{key:"clear",value:function(){return this.digest([]),this}}],function(e,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){var i=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i);if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof i?i:i+""}(r.key),r)}}(r.prototype,s),Object.defineProperty(r,"prototype",{writable:!1}),r),B=n(83413),L=n(79865),P=n(44497);function D(e,i){(null==i||i>e.length)&&(i=e.length);for(var n=0,r=Array(i);n<i;n++)r[n]=e[n];return r}function N(e,i,n){if("function"==typeof e?e===i:e.has(i))return arguments.length<3?i:n;throw TypeError("Private element is not present on this object")}function O(e,i,n){return i=Q(i),function(e,i){if(i&&("object"==typeof i||"function"==typeof i))return i;if(void 0!==i)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,q()?Reflect.construct(i,n||[],Q(e).constructor):i.apply(e,n))}function U(e,i){if(!(e instanceof i))throw TypeError("Cannot call a class as a function")}function k(e,i){return e.get(N(e,i))}function F(e,i,n){(function(e,i){if(i.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")})(e,i),i.set(e,n)}function z(e,i,n){return e.set(N(e,i),n),n}function G(e,i,n){if(q())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,i),new(e.bind.apply(e,r))}function V(e,i,n){return i&&function(e,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$(r.key),r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function j(e,i,n){return(i=$(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}function H(){return(H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,i,n){var r=function(e,i){for(;!({}).hasOwnProperty.call(e,i)&&null!==(e=Q(e)););return e}(e,i);if(r){var s=Object.getOwnPropertyDescriptor(r,i);return s.get?s.get.call(arguments.length<3?e:n):s.value}}).apply(null,arguments)}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,i){if("function"!=typeof i&&null!==i)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&K(e,i)}function q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(q=function(){return!!e})()}function X(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function K(e,i){return(K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,i){return e.__proto__=i,e})(e,i)}function Y(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,i){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,a,o,l=[],h=!0,u=!1;try{if(a=(n=n.call(e)).next,0===i);else for(;!(h=(r=a.call(n)).done)&&(l.push(r.value),l.length!==i);h=!0);}catch(e){u=!0,s=e}finally{try{if(!h&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw s}}return l}}(e,i)||et(e,i)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,i,n,r){var s=H(Q(e.prototype),i,n);return"function"==typeof s?function(e){return s.apply(n,e)}:s}function Z(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||et(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e){var i=function(e,i){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==typeof i?i:i+""}function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,i){if(e){if("string"==typeof e)return D(e,i);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,i):void 0}}var ei=function(e){e instanceof Array?e.forEach(ei):(e.map&&e.map.dispose(),e.dispose())},en=function(e){e.geometry&&e.geometry.dispose(),e.material&&ei(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(en)},er=function(e){for(;e.children.length;){var i=e.children[0];e.remove(i),en(i)}},es=new WeakMap,ea=new WeakMap,eo=function(e){function i(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r.dataBindAttr,a=r.objBindAttr;return U(this,i),j(n=O(this,i),"scene",void 0),F(n,es,void 0),F(n,ea,void 0),n.scene=e,z(es,n,void 0===s?"__data":s),z(ea,n,void 0===a?"__threeObj":a),n.onRemoveObj(function(){}),n}return W(i,e),V(i,[{key:"onCreateObj",value:function(e){var n=this;return J(i,"onCreateObj",this)([function(i){var r=e(i);return i[k(ea,n)]=r,r[k(es,n)]=i,n.scene.add(r),r}]),this}},{key:"onRemoveObj",value:function(e){var n=this;return J(i,"onRemoveObj",this)([function(r,s){var a=J(i,"getData",n)([r]);e(r,s),n.scene.remove(r),er(r),delete a[k(ea,n)]}]),this}}])}(I),el=function(e){return isNaN(e)?parseInt((0,P.Z)(e).toHex(),16):e},eh=function(e){return isNaN(e)?(0,P.Z)(e).getAlpha():1},eu=(0,B.Z)(L.Z);function ec(e,i,n){i&&"string"==typeof n&&e.filter(function(e){return!e[n]}).forEach(function(e){e[n]=eu(i(e))})}var ed=window.THREE?window.THREE:{Group:a.ZAu,Mesh:a.Kj0,MeshLambertMaterial:a.YBo,Color:a.Ilk,BufferGeometry:a.u9r,BufferAttribute:a.TlE,Matrix4:a.yGw,Vector3:a.Pa4,SphereGeometry:a.xo$,CylinderGeometry:a.fHI,TubeGeometry:a.WXh,ConeGeometry:a.b_z,Line:a.x12,LineBasicMaterial:a.nls,QuadraticBezierCurve3:a.mXe,CubicBezierCurve3:a.yj7,Box3:a.ZzF},ep={graph:d,forcelayout:p},ef=new ed.BufferGeometry().setAttribute?"setAttribute":"addAttribute",em=new ed.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",eg=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=function(i){function r(){var i;U(this,r);for(var s=arguments.length,a=Array(s),o=0;o<s;o++)a[o]=arguments[o];return(i=O(this,r,[].concat(a))).__kapsuleInstance=G(e,[].concat(Z(n?[i]:[]),a)),i}return W(r,i),V(r)}(i);return Object.keys(e()).forEach(function(e){return r.prototype[e]=function(){var i,n=(i=this.__kapsuleInstance)[e].apply(i,arguments);return n===this.__kapsuleInstance?this:n}}),r}((0,f.Z)({props:{jsonUrl:{onChange:function(e,i){var n=this;e&&!i.fetchingJson&&(i.fetchingJson=!0,i.onLoading(),fetch(e).then(function(e){return e.json()}).then(function(e){i.fetchingJson=!1,i.onFinishLoading(e),n.graphData(e)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,i){i.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,i){var n=i.d3ForceLayout.force("charge");function r(e,i){e.forEach(function(e){delete e[i],delete e["v".concat(i)]})}n&&n.strength(e>2?-60:-30),e<3&&r(i.graphData.nodes,"z"),e<2&&r(i.graphData.nodes,"y")}},dagMode:{onChange:function(e,i){e||"d3"!==i.forceEngine||(i.graphData.nodes||[]).forEach(function(e){return e.fx=e.fy=e.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,i){i.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,i){i.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,i){i.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,i,n){return void 0===n?e.d3ForceLayout.force(i):(e.d3ForceLayout.force(i,n),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var i,n,r,s,a,o,l,h,u,c="ngraph"!==e.forceEngine;return e.engineRunning&&(++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||c&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[c?"tick":"step"](),e.onEngineTick()),i=(0,m.default)(e.nodeThreeObjectExtend),e.nodeDataMapper.entries().forEach(function(n){var r=Y(n,2),s=r[0],a=r[1];if(a){var o=c?s:e.layout.getNodePosition(s[e.nodeId]),l=i(s);e.nodePositionUpdate&&e.nodePositionUpdate(l?a.children[0]:a,{x:o.x,y:o.y,z:o.z},s)&&!l||(a.position.x=o.x,a.position.y=o.y||0,a.position.z=o.z||0)}}),n=(0,m.default)(e.linkWidth),r=(0,m.default)(e.linkCurvature),s=(0,m.default)(e.linkCurveRotation),a=(0,m.default)(e.linkThreeObjectExtend),e.linkDataMapper.entries().forEach(function(i){var o=Y(i,2),l=o[0],h=o[1];if(h){var u=c?l:e.layout.getLinkPosition(e.layout.graph.getLink(l.source,l.target).id),d=u[c?"source":"from"],p=u[c?"target":"to"];if(d&&p&&d.hasOwnProperty("x")&&p.hasOwnProperty("x")){(function(i){var n=c?i:e.layout.getLinkPosition(e.layout.graph.getLink(i.source,i.target).id),a=n[c?"source":"from"],o=n[c?"target":"to"];if(a&&o&&a.hasOwnProperty("x")&&o.hasOwnProperty("x")){var l=r(i);if(l){var h,u=new ed.Vector3(a.x,a.y||0,a.z||0),d=new ed.Vector3(o.x,o.y||0,o.z||0),p=u.distanceTo(d),f=s(i);if(p>0){var m=o.x-a.x,g=o.y-a.y||0,A=new ed.Vector3().subVectors(d,u),v=A.clone().multiplyScalar(l).cross(0!==m||0!==g?new ed.Vector3(0,0,1):new ed.Vector3(0,1,0)).applyAxisAngle(A.normalize(),f).add(new ed.Vector3().addVectors(u,d).divideScalar(2));h=new ed.QuadraticBezierCurve3(u,v,d)}else{var y=70*l,x=-f,_=x+Math.PI/2;h=new ed.CubicBezierCurve3(u,new ed.Vector3(y*Math.cos(_),y*Math.sin(_),0).add(u),new ed.Vector3(y*Math.cos(x),y*Math.sin(x),0).add(u),d)}i.__curve=h}else i.__curve=null}})(l);var f=a(l);if(e.linkPositionUpdate&&e.linkPositionUpdate(f?h.children[1]:h,{start:{x:d.x,y:d.y,z:d.z},end:{x:p.x,y:p.y,z:p.z}},l)&&!f)return;var m=l.__curve,g=h.children.length?h.children[0]:h;if("Line"===g.type){if(m){var A=m.getPoints(30);g.geometry.getAttribute("position").array.length!==3*A.length&&g.geometry[ef]("position",new ed.BufferAttribute(new Float32Array(3*A.length),3)),g.geometry.setFromPoints(A)}else{var v=g.geometry.getAttribute("position");v&&v.array&&6===v.array.length||g.geometry[ef]("position",v=new ed.BufferAttribute(new Float32Array(6),3)),v.array[0]=d.x,v.array[1]=d.y||0,v.array[2]=d.z||0,v.array[3]=p.x,v.array[4]=p.y||0,v.array[5]=p.z||0,v.needsUpdate=!0}g.geometry.computeBoundingSphere()}else if("Mesh"===g.type){if(m){g.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(g.position.set(0,0,0),g.rotation.set(0,0,0),g.scale.set(1,1,1));var y=Math.ceil(10*n(l))/10,x=new ed.TubeGeometry(m,30,y/2,e.linkResolution,!1);g.geometry.dispose(),g.geometry=x}else{if(!g.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var _=Math.ceil(10*n(l))/10/2,b=new ed.CylinderGeometry(_,_,1,e.linkResolution,1,!1);b[em](new ed.Matrix4().makeTranslation(0,.5,0)),b[em](new ed.Matrix4().makeRotationX(Math.PI/2)),g.geometry.dispose(),g.geometry=b}var E=new ed.Vector3(d.x,d.y||0,d.z||0),w=new ed.Vector3(p.x,p.y||0,p.z||0),M=E.distanceTo(w);g.position.x=E.x,g.position.y=E.y,g.position.z=E.z,g.scale.z=M,g.parent.localToWorld(w),g.lookAt(w)}}}}})),o=(0,m.default)(e.linkDirectionalArrowRelPos),l=(0,m.default)(e.linkDirectionalArrowLength),h=(0,m.default)(e.nodeVal),e.arrowDataMapper.entries().forEach(function(i){var n=Y(i,2),r=n[0],s=n[1];if(s){var a=c?r:e.layout.getLinkPosition(e.layout.graph.getLink(r.source,r.target).id),u=a[c?"source":"from"],d=a[c?"target":"to"];if(u&&d&&u.hasOwnProperty("x")&&d.hasOwnProperty("x")){var p=Math.cbrt(Math.max(0,h(u)||1))*e.nodeRelSize,f=Math.cbrt(Math.max(0,h(d)||1))*e.nodeRelSize,m=l(r),g=o(r),A=r.__curve?function(e){return r.__curve.getPoint(e)}:function(e){var i=function(e,i,n,r){return i[e]+(n[e]-i[e])*r||0};return{x:i("x",u,d,e),y:i("y",u,d,e),z:i("z",u,d,e)}},v=r.__curve?r.__curve.getLength():Math.sqrt(["x","y","z"].map(function(e){return Math.pow((d[e]||0)-(u[e]||0),2)}).reduce(function(e,i){return e+i},0)),y=p+m+(v-p-f-m)*g,x=A(y/v),_=A((y-m)/v);["x","y","z"].forEach(function(e){return s.position[e]=_[e]});var b=G(ed.Vector3,Z(["x","y","z"].map(function(e){return x[e]})));s.parent.localToWorld(b),s.lookAt(b)}}}),u=(0,m.default)(e.linkDirectionalParticleSpeed),e.graphData.links.forEach(function(i){var n=e.particlesDataMapper.getObj(i),r=n&&n.children,s=i.__singleHopPhotonsObj&&i.__singleHopPhotonsObj.children;if(s&&s.length||r&&r.length){var a=c?i:e.layout.getLinkPosition(e.layout.graph.getLink(i.source,i.target).id),o=a[c?"source":"from"],l=a[c?"target":"to"];if(o&&l&&o.hasOwnProperty("x")&&l.hasOwnProperty("x")){var h=u(i),d=i.__curve?function(e){return i.__curve.getPoint(e)}:function(e){var i=function(e,i,n,r){return i[e]+(n[e]-i[e])*r||0};return{x:i("x",o,l,e),y:i("y",o,l,e),z:i("z",o,l,e)}};[].concat(Z(r||[]),Z(s||[])).forEach(function(e,i){var n="singleHopPhotons"===e.parent.__linkThreeObjType;if(e.hasOwnProperty("__progressRatio")||(e.__progressRatio=n?0:i/r.length),e.__progressRatio+=h,e.__progressRatio>=1){if(n){e.parent.remove(e),er(e);return}e.__progressRatio=e.__progressRatio%1}var s=d(e.__progressRatio);["x","y","z"].forEach(function(i){return e.position[i]=s[i]})})}}}),this},emitParticle:function(e,i){if(i&&e.graphData.links.includes(i)){if(!i.__singleHopPhotonsObj){var n=new ed.Group;n.__linkThreeObjType="singleHopPhotons",i.__singleHopPhotonsObj=n,e.graphScene.add(n)}var r=Math.ceil(10*(0,m.default)(e.linkDirectionalParticleWidth)(i))/10/2,s=e.linkDirectionalParticleResolution,a=new ed.SphereGeometry(r,s,s),o=(0,m.default)(e.linkColor),l=(0,m.default)(e.linkDirectionalParticleColor)(i)||o(i)||"#f0f0f0",h=new ed.Color(el(l)),u=3*e.linkOpacity,c=new ed.MeshLambertMaterial({color:h,transparent:!0,opacity:u});i.__singleHopPhotonsObj.add(new ed.Mesh(a,c))}return this},getGraphBbox:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(!e.initialised)return null;var n=function e(n){var r=[];if(n.geometry){n.geometry.computeBoundingBox();var s=new ed.Box3;s.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),r.push(s)}return r.concat.apply(r,Z((n.children||[]).filter(function(e){return!e.hasOwnProperty("__graphObjType")||"node"===e.__graphObjType&&i(e.__data)}).map(e)))}(e.graphScene);return n.length?Object.assign.apply(Object,Z(["x","y","z"].map(function(e){return j({},e,[(0,g.Z)(n,function(i){return i.min[e]}),(0,A.Z)(n,function(i){return i.max[e]})])}))):null}},stateInit:function(){return{d3ForceLayout:(0,o.Z)().force("link",(0,l.Z)()).force("charge",(0,h.Z)()).force("center",(0,u.Z)()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,i){i.graphScene=e,i.nodeDataMapper=new eo(e,{objBindAttr:"__threeObj"}),i.linkDataMapper=new eo(e,{objBindAttr:"__lineObj"}),i.arrowDataMapper=new eo(e,{objBindAttr:"__arrowObj"}),i.particlesDataMapper=new eo(e,{objBindAttr:"__photonsObj"})},update:function(e,i){var n=function(e){return e.some(function(e){return i.hasOwnProperty(e)})};if(e.engineRunning=!1,"function"==typeof e.onUpdate&&e.onUpdate(),null!==e.nodeAutoColorBy&&n(["nodeAutoColorBy","graphData","nodeColor"])&&ec(e.graphData.nodes,(0,m.default)(e.nodeAutoColorBy),e.nodeColor),null!==e.linkAutoColorBy&&n(["linkAutoColorBy","graphData","linkColor"])&&ec(e.graphData.links,(0,m.default)(e.linkAutoColorBy),e.linkColor),e._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=(0,m.default)(e.nodeThreeObject),s=(0,m.default)(e.nodeThreeObjectExtend),a=(0,m.default)(e.nodeVal),o=(0,m.default)(e.nodeColor),l=(0,m.default)(e.nodeVisibility),h={},u={};(e._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(i){var n,a=r(i),o=s(i);return a&&e.nodeThreeObject===a&&(a=a.clone()),a&&!o?n=a:((n=new ed.Mesh).__graphDefaultObj=!0,a&&o&&n.add(a)),n.__graphObjType="node",n}).onUpdateObj(function(i,n){if(i.__graphDefaultObj){var r=a(n)||1,s=Math.cbrt(r)*e.nodeRelSize,l=e.nodeResolution;i.geometry.type.match(/^Sphere(Buffer)?Geometry$/)&&i.geometry.parameters.radius===s&&i.geometry.parameters.widthSegments===l||(h.hasOwnProperty(r)||(h[r]=new ed.SphereGeometry(s,l,l)),i.geometry.dispose(),i.geometry=h[r]);var c=o(n),d=new ed.Color(el(c||"#ffffaa")),p=e.nodeOpacity*eh(c);"MeshLambertMaterial"===i.material.type&&i.material.color.equals(d)&&i.material.opacity===p||(u.hasOwnProperty(c)||(u[c]=new ed.MeshLambertMaterial({color:d,transparent:!0,opacity:p})),i.material.dispose(),i.material=u[c])}}).digest(e.graphData.nodes.filter(l))}if(e._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var d=(0,m.default)(e.linkThreeObject),p=(0,m.default)(e.linkThreeObjectExtend),f=(0,m.default)(e.linkMaterial),g=(0,m.default)(e.linkVisibility),A=(0,m.default)(e.linkColor),v=(0,m.default)(e.linkWidth),y={},x={},_={},b=e.graphData.links.filter(g);if((e._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(e){var i=e.__data&&e.__data.__singleHopPhotonsObj;i&&(i.parent.remove(i),er(i),delete e.__data.__singleHopPhotonsObj)}).onCreateObj(function(i){var n,r,s=d(i),a=p(i);if(s&&e.linkThreeObject===s&&(s=s.clone()),!s||a){if(v(i))n=new ed.Mesh;else{var o=new ed.BufferGeometry;o[ef]("position",new ed.BufferAttribute(new Float32Array(6),3)),n=new ed.Line(o)}}return s?a?((r=new ed.Group).__graphDefaultObj=!0,r.add(n),r.add(s)):r=s:(r=n).__graphDefaultObj=!0,r.renderOrder=10,r.__graphObjType="link",r}).onUpdateObj(function(i,n){if(i.__graphDefaultObj){var r=i.children.length?i.children[0]:i,s=Math.ceil(10*v(n))/10,a=!!s;if(a){var o=s/2,l=e.linkResolution;if(!r.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||r.geometry.parameters.radiusTop!==o||r.geometry.parameters.radialSegments!==l){if(!y.hasOwnProperty(s)){var h=new ed.CylinderGeometry(o,o,1,l,1,!1);h[em](new ed.Matrix4().makeTranslation(0,.5,0)),h[em](new ed.Matrix4().makeRotationX(Math.PI/2)),y[s]=h}r.geometry.dispose(),r.geometry=y[s]}}var u=f(n);if(u)r.material=u;else{var c=A(n),d=new ed.Color(el(c||"#f0f0f0")),p=e.linkOpacity*eh(c),m=a?"MeshLambertMaterial":"LineBasicMaterial";if(r.material.type!==m||!r.material.color.equals(d)||r.material.opacity!==p){var g=a?x:_;g.hasOwnProperty(c)||(g[c]=new ed[m]({color:d,transparent:p<1,opacity:p,depthWrite:p>=1})),r.material.dispose(),r.material=g[c]}}}}).digest(b),e.linkDirectionalArrowLength||i.hasOwnProperty("linkDirectionalArrowLength")){var E=(0,m.default)(e.linkDirectionalArrowLength),w=(0,m.default)(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var e=new ed.Mesh(void 0,new ed.MeshLambertMaterial({transparent:!0}));return e.__linkThreeObjType="arrow",e}).onUpdateObj(function(i,n){var r=E(n),s=e.linkDirectionalArrowResolution;if(!i.geometry.type.match(/^Cone(Buffer)?Geometry$/)||i.geometry.parameters.height!==r||i.geometry.parameters.radialSegments!==s){var a=new ed.ConeGeometry(.25*r,r,s);a.translate(0,r/2,0),a.rotateX(Math.PI/2),i.geometry.dispose(),i.geometry=a}var o=w(n)||A(n)||"#f0f0f0";i.material.color=new ed.Color(el(o)),i.material.opacity=3*e.linkOpacity*eh(o)}).digest(b.filter(E))}if(e.linkDirectionalParticles||i.hasOwnProperty("linkDirectionalParticles")){var M=(0,m.default)(e.linkDirectionalParticles),C=(0,m.default)(e.linkDirectionalParticleWidth),S=(0,m.default)(e.linkDirectionalParticleColor),T={},R={};e.particlesDataMapper.onCreateObj(function(){var e=new ed.Group;return e.__linkThreeObjType="photons",e.__photonDataMapper=new eo(e),e}).onUpdateObj(function(i,n){var r,s,a=Math.round(Math.abs(M(n))),o=!!i.children.length&&i.children[0],l=Math.ceil(10*C(n))/10/2,h=e.linkDirectionalParticleResolution;o&&o.geometry.parameters.radius===l&&o.geometry.parameters.widthSegments===h?r=o.geometry:(R.hasOwnProperty(l)||(R[l]=new ed.SphereGeometry(l,h,h)),r=R[l],o&&o.geometry.dispose());var u=S(n)||A(n)||"#f0f0f0",c=new ed.Color(el(u)),d=3*e.linkOpacity;o&&o.material.color.equals(c)&&o.material.opacity===d?s=o.material:(T.hasOwnProperty(u)||(T[u]=new ed.MeshLambertMaterial({color:c,transparent:!0,opacity:d})),s=T[u],o&&o.material.dispose()),i.__photonDataMapper.id(function(e){return e.idx}).onCreateObj(function(){return new ed.Mesh(r,s)}).onUpdateObj(function(e){e.geometry=r,e.material=s}).digest(Z(Array(a)).map(function(e,i){return{idx:i}}))}).digest(b.filter(M))}}if(e._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(i){i.source=i[e.linkSource],i.target=i[e.linkTarget]});var I,B="ngraph"!==e.forceEngine;if(B){(I=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var L=e.d3ForceLayout.force("link");L&&L.id(function(i){return i[e.nodeId]}).links(e.graphData.links);var P=e.dagMode&&function(e,i){var n=e.nodes,r=e.links,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s.nodeFilter,o=void 0===a?function(){return!0}:a,l=s.onLoopError,h=void 0===l?function(e){throw"Invalid DAG structure! Found cycle in node path: ".concat(e.join(" -> "),".")}:l,u={};n.forEach(function(e){return u[i(e)]={data:e,out:[],depth:-1,skip:!o(e)}}),r.forEach(function(e){var n=e.source,r=e.target,s=h(n),a=h(r);if(!u.hasOwnProperty(s))throw"Missing source node with id: ".concat(s);if(!u.hasOwnProperty(a))throw"Missing target node with id: ".concat(a);var o=u[s],l=u[a];function h(e){return"object"===ee(e)?i(e):e}o.out.push(l)});var c=[];return function e(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=0,o=n.length;a<o;a++)if(function(){var o=n[a];if(-1!==r.indexOf(o)){var l=[].concat(Z(r.slice(r.indexOf(o))),[o]).map(function(e){return i(e.data)});return c.some(function(e){return e.length===l.length&&e.every(function(e,i){return e===l[i]})})||(c.push(l),h(l)),1}s>o.depth&&(o.depth=s,e(o.out,[].concat(Z(r),[o]),s+ +!o.skip))}())continue}(Object.values(u)),Object.assign.apply(Object,[{}].concat(Z(Object.entries(u).filter(function(e){return!Y(e,2)[1].skip}).map(function(e){var i=Y(e,2);return j({},i[0],i[1].depth)}))))}(e.graphData,function(i){return i[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),D=Math.max.apply(Math,Z(Object.values(P||[]))),N=e.dagLevelDistance||e.graphData.nodes.length/(D||1)*2*(-1!==["radialin","radialout"].indexOf(e.dagMode)?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(i.dagMode)){var O=["lr","rl"].includes(i.dagMode)?"fx":["td","bu"].includes(i.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(e){return delete e[O]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var U=["rl","td","zout"].includes(e.dagMode),k=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(i){return i[k]=(P[i[e.nodeId]]-D/2)*N*(U?-1:1)})}e.d3ForceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(e.dagMode)?(0,c.Z)(function(i){var n=P[i[e.nodeId]]||-1;return("radialin"===e.dagMode?D-n:n)*N}).strength(function(i){return+!!e.dagNodeFilter(i)}):null)}else{var F=ep.graph();e.graphData.nodes.forEach(function(i){F.addNode(i[e.nodeId])}),e.graphData.links.forEach(function(e){F.addLink(e.source,e.target)}),(I=ep.forcelayout(F,function(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?X(Object(n),!0).forEach(function(i){j(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}({dimensions:e.numDimensions},e.ngraphPhysics))).graph=F}for(var z=0;z<e.warmupTicks&&!(B&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);z++)I[B?"tick":"step"]();e.layout=I,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}}),(window.THREE?window.THREE:{Group:a.ZAu}).Group,!0)},67591:function(e,i,n){"use strict";let r,s;n.d(i,{$TI:()=>lm,$V:()=>lx,$YQ:()=>at,ACn:()=>iL,BFQ:()=>e$,BG$:()=>tr,BVF:()=>Q,Bf4:()=>em,Bgp:()=>el,BtG:()=>rP,CaW:()=>e5,CdI:()=>er,CtA:()=>eK,Cy:()=>V,D1R:()=>eM,D67:()=>tQ,D9w:()=>eq,Djp:()=>tn,DvJ:()=>r_,E2K:()=>eJ,EJi:()=>os,EcG:()=>lb,EoG:()=>en,F1y:()=>tW,F5G:()=>eY,F5T:()=>nZ,FDw:()=>eC,FM8:()=>ia,FT0:()=>op,FUD:()=>tu,GG6:()=>tl,GUF:()=>tM,Gih:()=>th,Gql:()=>o9,H7L:()=>ih,HdW:()=>tg,HkE:()=>ln,Hy8:()=>U,I3e:()=>t8,IEO:()=>sa,IKL:()=>oo,ILR:()=>e1,IOt:()=>t_,Ilk:()=>nK,JCZ:()=>t2,JOQ:()=>sb,JQ4:()=>eL,JUT:()=>iN,Jjb:()=>tY,KI_:()=>tw,KhW:()=>L,Kj0:()=>ry,Kz5:()=>eB,LSk:()=>t0,LY2:()=>ea,LgZ:()=>N,LsT:()=>eI,Ltg:()=>iB,Lun:()=>oc,M$G:()=>tq,M5h:()=>E,M6v:()=>Z,M8C:()=>is,Mig:()=>o1,MyG:()=>tO,N4l:()=>b,NDo:()=>et,NKc:()=>H,NYV:()=>ts,Ns1:()=>$,O4K:()=>ig,O5A:()=>ip,O78:()=>tK,OAl:()=>tz,ORg:()=>eh,OTo:()=>eF,OoA:()=>ey,Ox3:()=>o0,PA7:()=>tb,PMe:()=>oW,Pa4:()=>iU,PeU:()=>h,QO2:()=>tm,Qey:()=>iA,QmN:()=>l,RSm:()=>ol,Rhp:()=>rE,RlZ:()=>z,RsA:()=>o,RvT:()=>tG,S2y:()=>c,S9g:()=>nf,SUY:()=>lr,Se2:()=>W,Sm8:()=>R,SvJ:()=>td,T6w:()=>tJ,T95:()=>eT,T_J:()=>tD,T_f:()=>o2,TlE:()=>n5,Tme:()=>nI,Tn7:()=>oi,TyD:()=>ex,UCm:()=>ez,USm:()=>np,UY4:()=>s2,UZH:()=>a,Vdb:()=>k,Vkp:()=>io,VzW:()=>eP,W2J:()=>tZ,WMw:()=>_,WXh:()=>a9,Wbm:()=>C,Wid:()=>or,Wl3:()=>g,Wpd:()=>F,Wzm:()=>ae,Xaj:()=>w,Y8D:()=>eV,YBo:()=>oh,YGz:()=>es,YLQ:()=>e_,ZAu:()=>s9,ZRs:()=>tB,ZTh:()=>tv,ZXd:()=>l_,Zen:()=>tX,Zr5:()=>q,ZzF:()=>iz,_12:()=>a2,_AM:()=>e2,_Li:()=>A,_MY:()=>d,_RZ:()=>t1,_am:()=>rL,_fP:()=>iO,_iA:()=>p,_wr:()=>G,a$l:()=>n9,aCh:()=>tE,aH4:()=>eb,aNw:()=>oP,ad5:()=>tT,av9:()=>eX,bGH:()=>M,b_z:()=>aM,bdR:()=>x,brP:()=>eQ,bsb:()=>tp,c8b:()=>I,cLu:()=>eD,cPb:()=>rB,cRx:()=>ej,cac:()=>id,ce8:()=>tI,cek:()=>oJ,cum:()=>tj,dSO:()=>ef,dZ3:()=>eo,dd2:()=>iP,dj0:()=>t$,dpR:()=>ok,dwf:()=>rb,dwk:()=>m,e62:()=>n7,eD:()=>K,eMJ:()=>tN,eaV:()=>e4,ehD:()=>v,ekQ:()=>e7,epp:()=>ib,f2y:()=>tf,fHI:()=>aw,fSK:()=>O,fY$:()=>ed,fto:()=>e6,g8_:()=>eg,ghN:()=>B,gi4:()=>ti,hEm:()=>eW,hH6:()=>oO,iAb:()=>eR,iKG:()=>oZ,iMs:()=>lA,iWC:()=>P,iWj:()=>sM,iiP:()=>tc,irR:()=>eO,j17:()=>tS,j4z:()=>tV,jFi:()=>y,jZA:()=>te,jes:()=>j,jfJ:()=>tL,jwo:()=>tk,jyz:()=>rC,k0A:()=>eN,k74:()=>D,kB5:()=>rz,kaV:()=>od,ksN:()=>Y,l0P:()=>e8,l6D:()=>tC,lCJ:()=>n8,lGU:()=>ty,lRF:()=>ou,lb7:()=>su,lk7:()=>o4,mSO:()=>tx,mXe:()=>ag,nls:()=>sV,ntZ:()=>f,oAp:()=>rD,oDz:()=>rw,oqc:()=>tP,p3g:()=>iD,pBf:()=>t3,pKu:()=>to,ptH:()=>e9,qhX:()=>ee,qkB:()=>eH,qlB:()=>n6,qyh:()=>ew,rDY:()=>rM,rOj:()=>S,r_:()=>T,rpg:()=>eA,tNt:()=>iv,tQZ:()=>ek,tm_:()=>u,u7G:()=>o5,u9r:()=>ro,uL9:()=>ei,uWy:()=>ev,uXU:()=>tU,v3W:()=>e0,vBJ:()=>n$,vCF:()=>X,vCx:()=>e3,vmT:()=>oz,vpT:()=>rk,vuL:()=>tA,vxC:()=>ep,w$m:()=>J,wJv:()=>eU,wem:()=>eE,wk1:()=>eG,wuA:()=>eZ,x12:()=>sY,x5V:()=>tR,xEZ:()=>iI,xJs:()=>ta,xeV:()=>rG,xfE:()=>ec,xo$:()=>a5,xoQ:()=>tH,xoR:()=>oa,xsS:()=>rU,y2t:()=>tt,yGw:()=>nn,yHo:()=>iy,yj7:()=>ap,yt0:()=>tF,ywz:()=>eS,zHn:()=>ni});let a="172",o={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},l={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},h=0,u=1,c=2,d=0,p=1,f=2,m=3,g=0,A=1,v=2,y=0,x=1,_=2,b=3,E=4,w=5,M=100,C=101,S=102,T=103,R=104,I=200,B=201,L=202,P=203,D=204,N=205,O=206,U=207,k=208,F=209,z=210,G=211,V=212,j=213,H=214,Q=0,W=1,q=2,X=3,K=4,Y=5,J=6,Z=7,$=0,ee=1,et=2,ei=0,en=1,er=2,es=3,ea=4,eo=5,el=6,eh=7,eu="attached",ec=300,ed=301,ep=302,ef=303,em=304,eg=306,eA=1e3,ev=1001,ey=1002,ex=1003,e_=1004,eb=1005,eE=1006,ew=1007,eM=1008,eC=1008,eS=1009,eT=1010,eR=1011,eI=1012,eB=1013,eL=1014,eP=1015,eD=1016,eN=1017,eO=1018,eU=1020,ek=35902,eF=1021,ez=1022,eG=1023,eV=1024,ej=1025,eH=1026,eQ=1027,eW=1028,eq=1029,eX=1030,eK=1031,eY=1032,eJ=1033,eZ=33776,e$=33777,e0=33778,e1=33779,e2=35840,e3=35841,e4=35842,e5=35843,e6=36196,e8=37492,e7=37496,e9=37808,te=37809,tt=37810,ti=37811,tn=37812,tr=37813,ts=37814,ta=37815,to=37816,tl=37817,th=37818,tu=37819,tc=37820,td=37821,tp=36492,tf=36494,tm=36495,tg=36283,tA=36284,tv=36285,ty=36286,tx=3201,t_=0,tb=1,tE="",tw="srgb",tM="srgb-linear",tC="linear",tS="srgb",tT=0,tR=7680,tI=7681,tB=7682,tL=7683,tP=34055,tD=34056,tN=5386,tO=512,tU=513,tk=514,tF=515,tz=516,tG=517,tV=518,tj=519,tH=512,tQ=513,tW=514,tq=515,tX=516,tK=517,tY=518,tJ=519,tZ=35044,t$=35048,t0="300 es",t1=2e3,t2=2001;class t3{addEventListener(e,i){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(i)&&n[e].push(i)}hasEventListener(e,i){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(i)}removeEventListener(e,i){if(void 0===this._listeners)return;let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(i);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let i=this._listeners[e.type];if(void 0!==i){e.target=this;let n=i.slice(0);for(let i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}let t4=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],t5=1234567,t6=Math.PI/180,t8=180/Math.PI;function t7(){let e=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0;return(t4[255&e]+t4[e>>8&255]+t4[e>>16&255]+t4[e>>24&255]+"-"+t4[255&i]+t4[i>>8&255]+"-"+t4[i>>16&15|64]+t4[i>>24&255]+"-"+t4[63&n|128]+t4[n>>8&255]+"-"+t4[n>>16&255]+t4[n>>24&255]+t4[255&r]+t4[r>>8&255]+t4[r>>16&255]+t4[r>>24&255]).toLowerCase()}function t9(e,i,n){return Math.max(i,Math.min(n,e))}function ie(e,i){return(e%i+i)%i}function it(e,i,n){return(1-n)*e+n*i}function ii(e,i){switch(i.constructor){case Float32Array:return e;case Uint32Array:return e/0xffffffff;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/0x7fffffff,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function ir(e,i){switch(i.constructor){case Float32Array:return e;case Uint32Array:return Math.round(0xffffffff*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(0x7fffffff*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}let is={DEG2RAD:t6,RAD2DEG:t8,generateUUID:t7,clamp:t9,euclideanModulo:ie,mapLinear:function(e,i,n,r,s){return r+(e-i)*(s-r)/(n-i)},inverseLerp:function(e,i,n){return e!==i?(n-e)/(i-e):0},lerp:it,damp:function(e,i,n,r){return it(e,i,1-Math.exp(-n*r))},pingpong:function(e,i=1){return i-Math.abs(ie(e,2*i)-i)},smoothstep:function(e,i,n){return e<=i?0:e>=n?1:(e=(e-i)/(n-i))*e*(3-2*e)},smootherstep:function(e,i,n){return e<=i?0:e>=n?1:(e=(e-i)/(n-i))*e*e*(e*(6*e-15)+10)},randInt:function(e,i){return e+Math.floor(Math.random()*(i-e+1))},randFloat:function(e,i){return e+Math.random()*(i-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(t5=e);let i=t5+=0x6d2b79f5;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/0x100000000},degToRad:function(e){return e*t6},radToDeg:function(e){return e*t8},isPowerOfTwo:function(e){return(e&e-1)==0&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,i,n,r,s){let a=Math.cos,o=Math.sin,l=a(n/2),h=o(n/2),u=a((i+r)/2),c=o((i+r)/2),d=a((i-r)/2),p=o((i-r)/2),f=a((r-i)/2),m=o((r-i)/2);switch(s){case"XYX":e.set(l*c,h*d,h*p,l*u);break;case"YZY":e.set(h*p,l*c,h*d,l*u);break;case"ZXZ":e.set(h*d,h*p,l*c,l*u);break;case"XZX":e.set(l*c,h*m,h*f,l*u);break;case"YXY":e.set(h*f,l*c,h*m,l*u);break;case"ZYZ":e.set(h*m,h*f,l*c,l*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}},normalize:ir,denormalize:ii};class ia{constructor(e=0,i=0){ia.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let i=this.x,n=this.y,r=e.elements;return this.x=r[0]*i+r[3]*n+r[6],this.y=r[1]*i+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=t9(this.x,e.x,i.x),this.y=t9(this.y,e.y,i.y),this}clampScalar(e,i){return this.x=t9(this.x,e,i),this.y=t9(this.y,e,i),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(t9(n,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===i?Math.PI/2:Math.acos(t9(this.dot(e)/i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){let n=Math.cos(i),r=Math.sin(i),s=this.x-e.x,a=this.y-e.y;return this.x=s*n-a*r+e.x,this.y=s*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class io{constructor(e,i,n,r,s,a,o,l,h){io.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,i,n,r,s,a,o,l,h)}set(e,i,n,r,s,a,o,l,h){let u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=n,u[7]=a,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let n=e.elements,r=i.elements,s=this.elements,a=n[0],o=n[3],l=n[6],h=n[1],u=n[4],c=n[7],d=n[2],p=n[5],f=n[8],m=r[0],g=r[3],A=r[6],v=r[1],y=r[4],x=r[7],_=r[2],b=r[5],E=r[8];return s[0]=a*m+o*v+l*_,s[3]=a*g+o*y+l*b,s[6]=a*A+o*x+l*E,s[1]=h*m+u*v+c*_,s[4]=h*g+u*y+c*b,s[7]=h*A+u*x+c*E,s[2]=d*m+p*v+f*_,s[5]=d*g+p*y+f*b,s[8]=d*A+p*x+f*E,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8];return i*a*u-i*o*h-n*s*u+n*o*l+r*s*h-r*a*l}invert(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=u*a-o*h,d=o*l-u*s,p=h*s-a*l,f=i*c+n*d+r*p;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);let m=1/f;return e[0]=c*m,e[1]=(r*h-u*n)*m,e[2]=(o*n-r*a)*m,e[3]=d*m,e[4]=(u*i-r*l)*m,e[5]=(r*s-o*i)*m,e[6]=p*m,e[7]=(n*l-h*i)*m,e[8]=(a*i-n*s)*m,this}transpose(){let e;let i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,r,s,a,o){let l=Math.cos(s),h=Math.sin(s);return this.set(n*l,n*h,-n*(l*a+h*o)+a+e,-r*h,r*l,-r*(-h*a+l*o)+o+i,0,0,1),this}scale(e,i){return this.premultiply(il.makeScale(e,i)),this}rotate(e){return this.premultiply(il.makeRotation(-e)),this}translate(e,i){return this.premultiply(il.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){let i=this.elements,n=e.elements;for(let e=0;e<9;e++)if(i[e]!==n[e])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){let n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let il=new io;function ih(e){for(let i=e.length-1;i>=0;--i)if(e[i]>=65535)return!0;return!1}let iu={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ic(e,i){return new iu[e](i)}function id(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ip(){let e=id("canvas");return e.style.display="block",e}let im={};function ig(e){e in im||(im[e]=!0,console.warn(e))}function iA(e,i,n){return new Promise(function(r,s){setTimeout(function a(){switch(e.clientWaitSync(i,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:s();break;case e.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:r()}},n)})}function iv(e){let i=e.elements;i[2]=.5*i[2]+.5*i[3],i[6]=.5*i[6]+.5*i[7],i[10]=.5*i[10]+.5*i[11],i[14]=.5*i[14]+.5*i[15]}function iy(e){let i=e.elements;-1===i[11]?(i[10]=-i[10]-1,i[14]=-i[14]):(i[10]=-i[10],i[14]=-i[14]+1)}let ix=new io().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),i_=new io().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715),ib=function(){let e={enabled:!0,workingColorSpace:tM,spaces:{},convert:function(e,i,n){return!1!==this.enabled&&i!==n&&i&&n&&(this.spaces[i].transfer===tS&&(e.r=iE(e.r),e.g=iE(e.g),e.b=iE(e.b)),this.spaces[i].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[i].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===tS&&(e.r=iw(e.r),e.g=iw(e.g),e.b=iw(e.b))),e},fromWorkingColorSpace:function(e,i){return this.convert(e,this.workingColorSpace,i)},toWorkingColorSpace:function(e,i){return this.convert(e,i,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===tE?tC:this.spaces[e].transfer},getLuminanceCoefficients:function(e,i=this.workingColorSpace){return e.fromArray(this.spaces[i].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,i,n){return e.copy(this.spaces[i].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}},i=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[tM]:{primaries:i,whitePoint:r,transfer:tC,toXYZ:ix,fromXYZ:i_,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:tw},outputColorSpaceConfig:{drawingBufferColorSpace:tw}},[tw]:{primaries:i,whitePoint:r,transfer:tS,toXYZ:ix,fromXYZ:i_,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:tw}}}),e}();function iE(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function iw(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class iM{static getDataURL(e){let i;if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)i=e;else{void 0===r&&(r=id("canvas")),r.width=e.width,r.height=e.height;let n=r.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),i=r}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let i=id("canvas");i.width=e.width,i.height=e.height;let n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height);let r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let e=0;e<s.length;e++)s[e]=255*iE(s[e]/255);return n.putImageData(r,0,0),i}if(!e.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e;{let i=e.data.slice(0);for(let e=0;e<i.length;e++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[e]=Math.floor(255*iE(i[e]/255)):i[e]=iE(i[e]);return{data:i,width:e.width,height:e.height}}}}let iC=0;class iS{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:iC++}),this.uuid=t7(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let i=void 0===e||"string"==typeof e;if(!i&&void 0!==e.images[this.uuid])return e.images[this.uuid];let n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let i=0,n=r.length;i<n;i++)r[i].isDataTexture?e.push(iT(r[i].image)):e.push(iT(r[i]))}else e=iT(r);n.url=e}return i||(e.images[this.uuid]=n),n}}function iT(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?iM.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let iR=0;class iI extends t3{constructor(e=iI.DEFAULT_IMAGE,i=iI.DEFAULT_MAPPING,n=ev,r=ev,s=eE,a=eM,o=eG,l=eS,h=iI.DEFAULT_ANISOTROPY,u=tE){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:iR++}),this.uuid=t7(),this.name="",this.source=new iS(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ia(0,0),this.repeat=new ia(1,1),this.center=new ia(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new io,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let i=void 0===e||"string"==typeof e;if(!i&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ec)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case eA:e.x=e.x-Math.floor(e.x);break;case ev:e.x=e.x<0?0:1;break;case ey:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case eA:e.y=e.y-Math.floor(e.y);break;case ev:e.y=e.y<0?0:1;break;case ey:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}iI.DEFAULT_IMAGE=null,iI.DEFAULT_MAPPING=ec,iI.DEFAULT_ANISOTROPY=1;class iB{constructor(e=0,i=0,n=0,r=1){iB.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,r){return this.x=e,this.y=i,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let i=this.x,n=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*i+a[4]*n+a[8]*r+a[12]*s,this.y=a[1]*i+a[5]*n+a[9]*r+a[13]*s,this.z=a[2]*i+a[6]*n+a[10]*r+a[14]*s,this.w=a[3]*i+a[7]*n+a[11]*r+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,r,s;let a=e.elements,o=a[0],l=a[4],h=a[8],u=a[1],c=a[5],d=a[9],p=a[2],f=a[6],m=a[10];if(.01>Math.abs(l-u)&&.01>Math.abs(h-p)&&.01>Math.abs(d-f)){if(.1>Math.abs(l+u)&&.1>Math.abs(h+p)&&.1>Math.abs(d+f)&&.1>Math.abs(o+c+m-3))return this.set(1,0,0,0),this;i=Math.PI;let e=(o+1)/2,a=(c+1)/2,g=(m+1)/2,A=(l+u)/4,v=(h+p)/4,y=(d+f)/4;return e>a&&e>g?e<.01?(n=0,r=.707106781,s=.707106781):(r=A/(n=Math.sqrt(e)),s=v/n):a>g?a<.01?(n=.707106781,r=0,s=.707106781):(n=A/(r=Math.sqrt(a)),s=y/r):g<.01?(n=.707106781,r=.707106781,s=0):(n=v/(s=Math.sqrt(g)),r=y/s),this.set(n,r,s,i),this}let g=Math.sqrt((f-d)*(f-d)+(h-p)*(h-p)+(u-l)*(u-l));return .001>Math.abs(g)&&(g=1),this.x=(f-d)/g,this.y=(h-p)/g,this.z=(u-l)/g,this.w=Math.acos((o+c+m-1)/2),this}setFromMatrixPosition(e){let i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=t9(this.x,e.x,i.x),this.y=t9(this.y,e.y,i.y),this.z=t9(this.z,e.z,i.z),this.w=t9(this.w,e.w,i.w),this}clampScalar(e,i){return this.x=t9(this.x,e,i),this.y=t9(this.y,e,i),this.z=t9(this.z,e,i),this.w=t9(this.w,e,i),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(t9(n,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class iL extends t3{constructor(e=1,i=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new iB(0,0,e,i),this.scissorTest=!1,this.viewport=new iB(0,0,e,i);let r=new iI({width:e,height:i,depth:1},(n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:eE,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n)).mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];let s=n.count;for(let e=0;e<s;e++)this.textures[e]=r.clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,i,n=1){if(this.width!==e||this.height!==i||this.depth!==n){this.width=e,this.height=i,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=i,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,n=e.textures.length;i<n;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;let i=Object.assign({},e.texture.image);return this.texture.source=new iS(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class iP extends iL{constructor(e=1,i=1,n={}){super(e,i,n),this.isWebGLRenderTarget=!0}}class iD extends iI{constructor(e=null,i=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:n,depth:r},this.magFilter=ex,this.minFilter=ex,this.wrapR=ev,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class iN extends iI{constructor(e=null,i=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:n,depth:r},this.magFilter=ex,this.minFilter=ex,this.wrapR=ev,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class iO{constructor(e=0,i=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=n,this._w=r}static slerpFlat(e,i,n,r,s,a,o){let l=n[r+0],h=n[r+1],u=n[r+2],c=n[r+3],d=s[a+0],p=s[a+1],f=s[a+2],m=s[a+3];if(0===o){e[i+0]=l,e[i+1]=h,e[i+2]=u,e[i+3]=c;return}if(1===o){e[i+0]=d,e[i+1]=p,e[i+2]=f,e[i+3]=m;return}if(c!==m||l!==d||h!==p||u!==f){let e=1-o,i=l*d+h*p+u*f+c*m,n=i>=0?1:-1,r=1-i*i;if(r>Number.EPSILON){let s=Math.sqrt(r),a=Math.atan2(s,i*n);e=Math.sin(e*a)/s,o=Math.sin(o*a)/s}let s=o*n;if(l=l*e+d*s,h=h*e+p*s,u=u*e+f*s,c=c*e+m*s,e===1-o){let e=1/Math.sqrt(l*l+h*h+u*u+c*c);l*=e,h*=e,u*=e,c*=e}}e[i]=l,e[i+1]=h,e[i+2]=u,e[i+3]=c}static multiplyQuaternionsFlat(e,i,n,r,s,a){let o=n[r],l=n[r+1],h=n[r+2],u=n[r+3],c=s[a],d=s[a+1],p=s[a+2],f=s[a+3];return e[i]=o*f+u*c+l*p-h*d,e[i+1]=l*f+u*d+h*c-o*p,e[i+2]=h*f+u*p+o*d-l*c,e[i+3]=u*f-o*c-l*d-h*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,n,r){return this._x=e,this._y=i,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){let n=e._x,r=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,h=o(n/2),u=o(r/2),c=o(s/2),d=l(n/2),p=l(r/2),f=l(s/2);switch(a){case"XYZ":this._x=d*u*c+h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c-d*p*f;break;case"YXZ":this._x=d*u*c+h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c+d*p*f;break;case"ZXY":this._x=d*u*c-h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c-d*p*f;break;case"ZYX":this._x=d*u*c-h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c+d*p*f;break;case"YZX":this._x=d*u*c+h*p*f,this._y=h*p*c+d*u*f,this._z=h*u*f-d*p*c,this._w=h*u*c-d*p*f;break;case"XZY":this._x=d*u*c-h*p*f,this._y=h*p*c-d*u*f,this._z=h*u*f+d*p*c,this._w=h*u*c+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===i&&this._onChangeCallback(),this}setFromAxisAngle(e,i){let n=i/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let i=e.elements,n=i[0],r=i[4],s=i[8],a=i[1],o=i[5],l=i[9],h=i[2],u=i[6],c=i[10],d=n+o+c;if(d>0){let e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(u-l)*e,this._y=(s-h)*e,this._z=(a-r)*e}else if(n>o&&n>c){let e=2*Math.sqrt(1+n-o-c);this._w=(u-l)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(s+h)/e}else if(o>c){let e=2*Math.sqrt(1+o-n-c);this._w=(s-h)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(l+u)/e}else{let e=2*Math.sqrt(1+c-n-o);this._w=(a-r)/e,this._x=(s+h)/e,this._y=(l+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let n=e.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x),this._w=n,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(t9(this.dot(e),-1,1)))}rotateTowards(e,i){let n=this.angleTo(e);if(0===n)return this;let r=Math.min(1,i/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){let n=e._x,r=e._y,s=e._z,a=e._w,o=i._x,l=i._y,h=i._z,u=i._w;return this._x=n*u+a*o+r*h-s*l,this._y=r*u+a*l+s*o-n*h,this._z=s*u+a*h+n*l-r*o,this._w=a*u-n*o-r*l-s*h,this._onChangeCallback(),this}slerp(e,i){if(0===i)return this;if(1===i)return this.copy(e);let n=this._x,r=this._y,s=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=s,this;let l=1-o*o;if(l<=Number.EPSILON){let e=1-i;return this._w=e*a+i*this._w,this._x=e*n+i*this._x,this._y=e*r+i*this._y,this._z=e*s+i*this._z,this.normalize(),this}let h=Math.sqrt(l),u=Math.atan2(h,o),c=Math.sin((1-i)*u)/h,d=Math.sin(i*u)/h;return this._w=a*c+this._w*d,this._x=n*c+this._x*d,this._y=r*c+this._y*d,this._z=s*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,i,n){return this.copy(e).slerp(i,n)}random(){let e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(i),s*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class iU{constructor(e=0,i=0,n=0){iU.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return void 0===n&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(iF.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(iF.setFromAxisAngle(e,i))}applyMatrix3(e){let i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6]*r,this.y=s[1]*i+s[4]*n+s[7]*r,this.z=s[2]*i+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let i=this.x,n=this.y,r=this.z,s=e.elements,a=1/(s[3]*i+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*i+s[4]*n+s[8]*r+s[12])*a,this.y=(s[1]*i+s[5]*n+s[9]*r+s[13])*a,this.z=(s[2]*i+s[6]*n+s[10]*r+s[14])*a,this}applyQuaternion(e){let i=this.x,n=this.y,r=this.z,s=e.x,a=e.y,o=e.z,l=e.w,h=2*(a*r-o*n),u=2*(o*i-s*r),c=2*(s*n-a*i);return this.x=i+l*h+a*c-o*u,this.y=n+l*u+o*h-s*c,this.z=r+l*c+s*u-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[4]*n+s[8]*r,this.y=s[1]*i+s[5]*n+s[9]*r,this.z=s[2]*i+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=t9(this.x,e.x,i.x),this.y=t9(this.y,e.y,i.y),this.z=t9(this.z,e.z,i.z),this}clampScalar(e,i){return this.x=t9(this.x,e,i),this.y=t9(this.y,e,i),this.z=t9(this.z,e,i),this}clampLength(e,i){let n=this.length();return this.divideScalar(n||1).multiplyScalar(t9(n,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){let n=e.x,r=e.y,s=e.z,a=i.x,o=i.y,l=i.z;return this.x=r*l-s*o,this.y=s*a-n*l,this.z=n*o-r*a,this}projectOnVector(e){let i=e.lengthSq();if(0===i)return this.set(0,0,0);let n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return ik.copy(this).projectOnVector(e),this.sub(ik)}reflect(e){return this.sub(ik.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===i?Math.PI/2:Math.acos(t9(this.dot(e)/i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return i*i+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){let r=Math.sin(i)*e;return this.x=r*Math.sin(n),this.y=Math.cos(i)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){let i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){let i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,4*i)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,3*i)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=Math.random()*Math.PI*2,i=2*Math.random()-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let ik=new iU,iF=new iO;class iz{constructor(e=new iU(Infinity,Infinity,Infinity),i=new iU(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i+=3)this.expandByPoint(iV.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,n=e.count;i<n;i++)this.expandByPoint(iV.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){let n=iV.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);let n=e.geometry;if(void 0!==n){let r=n.getAttribute("position");if(!0===i&&void 0!==r&&!0!==e.isInstancedMesh)for(let i=0,n=r.count;i<n;i++)!0===e.isMesh?e.getVertexPosition(i,iV):iV.fromBufferAttribute(r,i),iV.applyMatrix4(e.matrixWorld),this.expandByPoint(iV);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),ij.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),ij.copy(n.boundingBox)),ij.applyMatrix4(e.matrixWorld),this.union(ij)}let r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,iV),iV.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,n;return e.normal.x>0?(i=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),i<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(iY),iJ.subVectors(this.max,iY),iH.subVectors(e.a,iY),iQ.subVectors(e.b,iY),iW.subVectors(e.c,iY),iq.subVectors(iQ,iH),iX.subVectors(iW,iQ),iK.subVectors(iH,iW);let i=[0,-iq.z,iq.y,0,-iX.z,iX.y,0,-iK.z,iK.y,iq.z,0,-iq.x,iX.z,0,-iX.x,iK.z,0,-iK.x,-iq.y,iq.x,0,-iX.y,iX.x,0,-iK.y,iK.x,0];return!!(i0(i,iH,iQ,iW,iJ)&&i0(i=[1,0,0,0,1,0,0,0,1],iH,iQ,iW,iJ))&&(iZ.crossVectors(iq,iX),i0(i=[iZ.x,iZ.y,iZ.z],iH,iQ,iW,iJ))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,iV).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(iV).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(iG[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),iG[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),iG[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),iG[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),iG[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),iG[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),iG[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),iG[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(iG)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let iG=[new iU,new iU,new iU,new iU,new iU,new iU,new iU,new iU],iV=new iU,ij=new iz,iH=new iU,iQ=new iU,iW=new iU,iq=new iU,iX=new iU,iK=new iU,iY=new iU,iJ=new iU,iZ=new iU,i$=new iU;function i0(e,i,n,r,s){for(let a=0,o=e.length-3;a<=o;a+=3){i$.fromArray(e,a);let o=s.x*Math.abs(i$.x)+s.y*Math.abs(i$.y)+s.z*Math.abs(i$.z),l=i.dot(i$),h=n.dot(i$),u=r.dot(i$);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>o)return!1}return!0}let i1=new iz,i2=new iU,i3=new iU;class i4{constructor(e=new iU,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){let n=this.center;void 0!==i?n.copy(i):i1.setFromPoints(e).getCenter(n);let r=0;for(let i=0,s=e.length;i<s;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){let n=this.center.distanceToSquared(e);return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;i2.subVectors(e,this.center);let i=i2.lengthSq();if(i>this.radius*this.radius){let e=Math.sqrt(i),n=(e-this.radius)*.5;this.center.addScaledVector(i2,n/e),this.radius+=n}return this}union(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(i3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(i2.copy(e.center).add(i3)),this.expandByPoint(i2.copy(e.center).sub(i3)))),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}let i5=new iU,i6=new iU,i8=new iU,i7=new iU,i9=new iU,ne=new iU,nt=new iU;class ni{constructor(e=new iU,i=new iU(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,i5)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);let n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let i=i5.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(i5.copy(this.origin).addScaledVector(this.direction,i),i5.distanceToSquared(e))}distanceSqToSegment(e,i,n,r){let s,a,o,l;i6.copy(e).add(i).multiplyScalar(.5),i8.copy(i).sub(e).normalize(),i7.copy(this.origin).sub(i6);let h=.5*e.distanceTo(i),u=-this.direction.dot(i8),c=i7.dot(this.direction),d=-i7.dot(i8),p=i7.lengthSq(),f=Math.abs(1-u*u);if(f>0){if(s=u*d-c,a=u*c-d,l=h*f,s>=0){if(a>=-l){if(a<=l){let e=1/f;s*=e,a*=e,o=s*(s+u*a+2*c)+a*(u*s+a+2*d)+p}else o=-(s=Math.max(0,-(u*(a=h)+c)))*s+a*(a+2*d)+p}else o=-(s=Math.max(0,-(u*(a=-h)+c)))*s+a*(a+2*d)+p}else a<=-l?(a=(s=Math.max(0,-(-u*h+c)))>0?-h:Math.min(Math.max(-h,-d),h),o=-s*s+a*(a+2*d)+p):a<=l?(s=0,o=(a=Math.min(Math.max(-h,-d),h))*(a+2*d)+p):(a=(s=Math.max(0,-(u*h+c)))>0?h:Math.min(Math.max(-h,-d),h),o=-s*s+a*(a+2*d)+p)}else a=u>0?-h:h,o=-(s=Math.max(0,-(u*a+c)))*s+a*(a+2*d)+p;return n&&n.copy(this.origin).addScaledVector(this.direction,s),r&&r.copy(i6).addScaledVector(i8,a),o}intersectSphere(e,i){i5.subVectors(e.center,this.origin);let n=i5.dot(this.direction),r=i5.dot(i5)-n*n,s=e.radius*e.radius;if(r>s)return null;let a=Math.sqrt(s-r),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let i=e.normal.dot(this.direction);if(0===i)return 0===e.distanceToPoint(this.origin)?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/i;return n>=0?n:null}intersectPlane(e,i){let n=this.distanceToPlane(e);return null===n?null:this.at(n,i)}intersectsPlane(e){let i=e.distanceToPoint(this.origin);return!!(0===i||e.normal.dot(this.direction)*i<0)}intersectBox(e,i){let n,r,s,a,o,l;let h=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return(h>=0?(n=(e.min.x-d.x)*h,r=(e.max.x-d.x)*h):(n=(e.max.x-d.x)*h,r=(e.min.x-d.x)*h),u>=0?(s=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),n>a||s>r)?null:((s>n||isNaN(n))&&(n=s),(a<r||isNaN(r))&&(r=a),c>=0?(o=(e.min.z-d.z)*c,l=(e.max.z-d.z)*c):(o=(e.max.z-d.z)*c,l=(e.min.z-d.z)*c),n>l||o>r)?null:((o>n||n!=n)&&(n=o),(l<r||r!=r)&&(r=l),r<0)?null:this.at(n>=0?n:r,i)}intersectsBox(e){return null!==this.intersectBox(e,i5)}intersectTriangle(e,i,n,r,s){let a;i9.subVectors(i,e),ne.subVectors(n,e),nt.crossVectors(i9,ne);let o=this.direction.dot(nt);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}i7.subVectors(this.origin,e);let l=a*this.direction.dot(ne.crossVectors(i7,ne));if(l<0)return null;let h=a*this.direction.dot(i9.cross(i7));if(h<0||l+h>o)return null;let u=-a*i7.dot(nt);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class nn{constructor(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g){nn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g)}set(e,i,n,r,s,a,o,l,h,u,c,d,p,f,m,g){let A=this.elements;return A[0]=e,A[4]=i,A[8]=n,A[12]=r,A[1]=s,A[5]=a,A[9]=o,A[13]=l,A[2]=h,A[6]=u,A[10]=c,A[14]=d,A[3]=p,A[7]=f,A[11]=m,A[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new nn().fromArray(this.elements)}copy(e){let i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){let i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){let i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){let i=this.elements,n=e.elements,r=1/nr.setFromMatrixColumn(e,0).length(),s=1/nr.setFromMatrixColumn(e,1).length(),a=1/nr.setFromMatrixColumn(e,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=0,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=0,i[8]=n[8]*a,i[9]=n[9]*a,i[10]=n[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){let i=this.elements,n=e.x,r=e.y,s=e.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(r),h=Math.sin(r),u=Math.cos(s),c=Math.sin(s);if("XYZ"===e.order){let e=a*u,n=a*c,r=o*u,s=o*c;i[0]=l*u,i[4]=-l*c,i[8]=h,i[1]=n+r*h,i[5]=e-s*h,i[9]=-o*l,i[2]=s-e*h,i[6]=r+n*h,i[10]=a*l}else if("YXZ"===e.order){let e=l*u,n=l*c,r=h*u,s=h*c;i[0]=e+s*o,i[4]=r*o-n,i[8]=a*h,i[1]=a*c,i[5]=a*u,i[9]=-o,i[2]=n*o-r,i[6]=s+e*o,i[10]=a*l}else if("ZXY"===e.order){let e=l*u,n=l*c,r=h*u,s=h*c;i[0]=e-s*o,i[4]=-a*c,i[8]=r+n*o,i[1]=n+r*o,i[5]=a*u,i[9]=s-e*o,i[2]=-a*h,i[6]=o,i[10]=a*l}else if("ZYX"===e.order){let e=a*u,n=a*c,r=o*u,s=o*c;i[0]=l*u,i[4]=r*h-n,i[8]=e*h+s,i[1]=l*c,i[5]=s*h+e,i[9]=n*h-r,i[2]=-h,i[6]=o*l,i[10]=a*l}else if("YZX"===e.order){let e=a*l,n=a*h,r=o*l,s=o*h;i[0]=l*u,i[4]=s-e*c,i[8]=r*c+n,i[1]=c,i[5]=a*u,i[9]=-o*u,i[2]=-h*u,i[6]=n*c+r,i[10]=e-s*c}else if("XZY"===e.order){let e=a*l,n=a*h,r=o*l,s=o*h;i[0]=l*u,i[4]=-c,i[8]=h*u,i[1]=e*c+s,i[5]=a*u,i[9]=n*c-r,i[2]=r*c-n,i[6]=o*u,i[10]=s*c+e}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(na,e,no)}lookAt(e,i,n){let r=this.elements;return nu.subVectors(e,i),0===nu.lengthSq()&&(nu.z=1),nu.normalize(),nl.crossVectors(n,nu),0===nl.lengthSq()&&(1===Math.abs(n.z)?nu.x+=1e-4:nu.z+=1e-4,nu.normalize(),nl.crossVectors(n,nu)),nl.normalize(),nh.crossVectors(nu,nl),r[0]=nl.x,r[4]=nh.x,r[8]=nu.x,r[1]=nl.y,r[5]=nh.y,r[9]=nu.y,r[2]=nl.z,r[6]=nh.z,r[10]=nu.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let n=e.elements,r=i.elements,s=this.elements,a=n[0],o=n[4],l=n[8],h=n[12],u=n[1],c=n[5],d=n[9],p=n[13],f=n[2],m=n[6],g=n[10],A=n[14],v=n[3],y=n[7],x=n[11],_=n[15],b=r[0],E=r[4],w=r[8],M=r[12],C=r[1],S=r[5],T=r[9],R=r[13],I=r[2],B=r[6],L=r[10],P=r[14],D=r[3],N=r[7],O=r[11],U=r[15];return s[0]=a*b+o*C+l*I+h*D,s[4]=a*E+o*S+l*B+h*N,s[8]=a*w+o*T+l*L+h*O,s[12]=a*M+o*R+l*P+h*U,s[1]=u*b+c*C+d*I+p*D,s[5]=u*E+c*S+d*B+p*N,s[9]=u*w+c*T+d*L+p*O,s[13]=u*M+c*R+d*P+p*U,s[2]=f*b+m*C+g*I+A*D,s[6]=f*E+m*S+g*B+A*N,s[10]=f*w+m*T+g*L+A*O,s[14]=f*M+m*R+g*P+A*U,s[3]=v*b+y*C+x*I+_*D,s[7]=v*E+y*S+x*B+_*N,s[11]=v*w+y*T+x*L+_*O,s[15]=v*M+y*R+x*P+_*U,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){let e=this.elements,i=e[0],n=e[4],r=e[8],s=e[12],a=e[1],o=e[5],l=e[9],h=e[13],u=e[2],c=e[6],d=e[10],p=e[14],f=e[3],m=e[7];return f*(+s*l*c-r*h*c-s*o*d+n*h*d+r*o*p-n*l*p)+m*(+i*l*p-i*h*d+s*a*d-r*a*p+r*h*u-s*l*u)+e[11]*(+i*h*c-i*o*p-s*a*c+n*a*p+s*o*u-n*h*u)+e[15]*(-r*o*u-i*l*c+i*o*d+r*a*c-n*a*d+n*l*u)}transpose(){let e;let i=this.elements;return e=i[1],i[1]=i[4],i[4]=e,e=i[2],i[2]=i[8],i[8]=e,e=i[6],i[6]=i[9],i[9]=e,e=i[3],i[3]=i[12],i[12]=e,e=i[7],i[7]=i[13],i[13]=e,e=i[11],i[11]=i[14],i[14]=e,this}setPosition(e,i,n){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=n),this}invert(){let e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],u=e[8],c=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],A=e[15],v=c*g*h-m*d*h+m*l*p-o*g*p-c*l*A+o*d*A,y=f*d*h-u*g*h-f*l*p+a*g*p+u*l*A-a*d*A,x=u*m*h-f*c*h+f*o*p-a*m*p-u*o*A+a*c*A,_=f*c*l-u*m*l-f*o*d+a*m*d+u*o*g-a*c*g,b=i*v+n*y+r*x+s*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let E=1/b;return e[0]=v*E,e[1]=(m*d*s-c*g*s-m*r*p+n*g*p+c*r*A-n*d*A)*E,e[2]=(o*g*s-m*l*s+m*r*h-n*g*h-o*r*A+n*l*A)*E,e[3]=(c*l*s-o*d*s-c*r*h+n*d*h+o*r*p-n*l*p)*E,e[4]=y*E,e[5]=(u*g*s-f*d*s+f*r*p-i*g*p-u*r*A+i*d*A)*E,e[6]=(f*l*s-a*g*s-f*r*h+i*g*h+a*r*A-i*l*A)*E,e[7]=(a*d*s-u*l*s+u*r*h-i*d*h-a*r*p+i*l*p)*E,e[8]=x*E,e[9]=(f*c*s-u*m*s-f*n*p+i*m*p+u*n*A-i*c*A)*E,e[10]=(a*m*s-f*o*s+f*n*h-i*m*h-a*n*A+i*o*A)*E,e[11]=(u*o*s-a*c*s-u*n*h+i*c*h+a*n*p-i*o*p)*E,e[12]=_*E,e[13]=(u*m*r-f*c*r+f*n*d-i*m*d-u*n*g+i*c*g)*E,e[14]=(f*o*r-a*m*r-f*n*l+i*m*l+a*n*g-i*o*g)*E,e[15]=(a*c*r-u*o*r+u*n*l-i*c*l-a*n*d+i*o*d)*E,this}scale(e){let i=this.elements,n=e.x,r=e.y,s=e.z;return i[0]*=n,i[4]*=r,i[8]*=s,i[1]*=n,i[5]*=r,i[9]*=s,i[2]*=n,i[6]*=r,i[10]*=s,i[3]*=n,i[7]*=r,i[11]*=s,this}getMaxScaleOnAxis(){let e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.sqrt(Math.max(i,e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){let i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){let i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){let n=Math.cos(i),r=Math.sin(i),s=1-n,a=e.x,o=e.y,l=e.z,h=s*a,u=s*o;return this.set(h*a+n,h*o-r*l,h*l+r*o,0,h*o+r*l,u*o+n,u*l-r*a,0,h*l-r*o,u*l+r*a,s*l*l+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,r,s,a){return this.set(1,n,s,0,e,1,a,0,i,r,1,0,0,0,0,1),this}compose(e,i,n){let r=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,h=s+s,u=a+a,c=o+o,d=s*h,p=s*u,f=s*c,m=a*u,g=a*c,A=o*c,v=l*h,y=l*u,x=l*c,_=n.x,b=n.y,E=n.z;return r[0]=(1-(m+A))*_,r[1]=(p+x)*_,r[2]=(f-y)*_,r[3]=0,r[4]=(p-x)*b,r[5]=(1-(d+A))*b,r[6]=(g+v)*b,r[7]=0,r[8]=(f+y)*E,r[9]=(g-v)*E,r[10]=(1-(d+m))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,n){let r=this.elements,s=nr.set(r[0],r[1],r[2]).length(),a=nr.set(r[4],r[5],r[6]).length(),o=nr.set(r[8],r[9],r[10]).length();0>this.determinant()&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],ns.copy(this);let l=1/s,h=1/a,u=1/o;return ns.elements[0]*=l,ns.elements[1]*=l,ns.elements[2]*=l,ns.elements[4]*=h,ns.elements[5]*=h,ns.elements[6]*=h,ns.elements[8]*=u,ns.elements[9]*=u,ns.elements[10]*=u,i.setFromRotationMatrix(ns),n.x=s,n.y=a,n.z=o,this}makePerspective(e,i,n,r,s,a,o=t1){let l,h;let u=this.elements;if(o===t1)l=-(a+s)/(a-s),h=-2*a*s/(a-s);else if(o===t2)l=-a/(a-s),h=-a*s/(a-s);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return u[0]=2*s/(i-e),u[4]=0,u[8]=(i+e)/(i-e),u[12]=0,u[1]=0,u[5]=2*s/(n-r),u[9]=(n+r)/(n-r),u[13]=0,u[2]=0,u[6]=0,u[10]=l,u[14]=h,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,i,n,r,s,a,o=t1){let l,h;let u=this.elements,c=1/(i-e),d=1/(n-r),p=1/(a-s);if(o===t1)l=(a+s)*p,h=-2*p;else if(o===t2)l=s*p,h=-1*p;else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return u[0]=2*c,u[4]=0,u[8]=0,u[12]=-((i+e)*c),u[1]=0,u[5]=2*d,u[9]=0,u[13]=-((n+r)*d),u[2]=0,u[6]=0,u[10]=h,u[14]=-l,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){let i=this.elements,n=e.elements;for(let e=0;e<16;e++)if(i[e]!==n[e])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){let n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}}let nr=new iU,ns=new nn,na=new iU(0,0,0),no=new iU(1,1,1),nl=new iU,nh=new iU,nu=new iU,nc=new nn,nd=new iO;class np{constructor(e=0,i=0,n=0,r=np.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,r=this._order){return this._x=e,this._y=i,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){let r=e.elements,s=r[0],a=r[4],o=r[8],l=r[1],h=r[5],u=r[9],c=r[2],d=r[6],p=r[10];switch(i){case"XYZ":this._y=Math.asin(t9(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,h),this._z=0);break;case"YXZ":this._x=Math.asin(-t9(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(t9(d,-1,1)),.9999999>Math.abs(d)?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-t9(c,-1,1)),.9999999>Math.abs(c)?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(t9(l,-1,1)),.9999999>Math.abs(l)?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-t9(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return nc.makeRotationFromQuaternion(e),this.setFromRotationMatrix(nc,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return nd.setFromEuler(this),this.setFromQuaternion(nd,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}np.DEFAULT_ORDER="XYZ";class nf{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let nm=0,ng=new iU,nA=new iO,nv=new nn,ny=new iU,nx=new iU,n_=new iU,nb=new iO,nE=new iU(1,0,0),nw=new iU(0,1,0),nM=new iU(0,0,1),nC={type:"added"},nS={type:"removed"},nT={type:"childadded",child:null},nR={type:"childremoved",child:null};class nI extends t3{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:nm++}),this.uuid=t7(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=nI.DEFAULT_UP.clone();let e=new iU,i=new np,n=new iO,r=new iU(1,1,1);i._onChange(function(){n.setFromEuler(i,!1)}),n._onChange(function(){i.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new nn},normalMatrix:{value:new io}}),this.matrix=new nn,this.matrixWorld=new nn,this.matrixAutoUpdate=nI.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=nI.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new nf,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return nA.setFromAxisAngle(e,i),this.quaternion.multiply(nA),this}rotateOnWorldAxis(e,i){return nA.setFromAxisAngle(e,i),this.quaternion.premultiply(nA),this}rotateX(e){return this.rotateOnAxis(nE,e)}rotateY(e){return this.rotateOnAxis(nw,e)}rotateZ(e){return this.rotateOnAxis(nM,e)}translateOnAxis(e,i){return ng.copy(e).applyQuaternion(this.quaternion),this.position.add(ng.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(nE,e)}translateY(e){return this.translateOnAxis(nw,e)}translateZ(e){return this.translateOnAxis(nM,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(nv.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?ny.copy(e):ny.set(e,i,n);let r=this.parent;this.updateWorldMatrix(!0,!1),nx.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nv.lookAt(nx,ny,this.up):nv.lookAt(ny,nx,this.up),this.quaternion.setFromRotationMatrix(nv),r&&(nv.extractRotation(r.matrixWorld),nA.setFromRotationMatrix(nv),this.quaternion.premultiply(nA.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(nC),nT.child=e,this.dispatchEvent(nT),nT.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let i=this.children.indexOf(e);return -1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(nS),nR.child=e,this.dispatchEvent(nR),nR.child=null),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),nv.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),nv.multiply(e.parent.matrixWorld)),e.applyMatrix4(nv),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(nC),nT.child=e,this.dispatchEvent(nT),nT.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectByProperty(e,i);if(void 0!==r)return r}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);let r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(nx,e,n_),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(nx,nb,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);let i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverseVisible(e)}traverseAncestors(e){let i=this.parent;null!==i&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);let i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].updateMatrixWorld(e)}updateWorldMatrix(e,i){let n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===i){let e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateWorldMatrix(!1,!0)}}toJSON(e){let i=void 0===e||"string"==typeof e,n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let r={};function s(i,n){return void 0===i[n.uuid]&&(i[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);let i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){let n=i.shapes;if(Array.isArray(n))for(let i=0,r=n.length;i<r;i++){let r=n[i];s(e.shapes,r)}else s(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){let i=[];for(let n=0,r=this.material.length;n<r;n++)i.push(s(e.materials,this.material[n]));r.material=i}else r.material=s(e.materials,this.material)}if(this.children.length>0){r.children=[];for(let i=0;i<this.children.length;i++)r.children.push(this.children[i].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let i=0;i<this.animations.length;i++){let n=this.animations[i];r.animations.push(s(e.animations,n))}}if(i){let i=a(e.geometries),r=a(e.materials),s=a(e.textures),o=a(e.images),l=a(e.shapes),h=a(e.skeletons),u=a(e.animations),c=a(e.nodes);i.length>0&&(n.geometries=i),r.length>0&&(n.materials=r),s.length>0&&(n.textures=s),o.length>0&&(n.images=o),l.length>0&&(n.shapes=l),h.length>0&&(n.skeletons=h),u.length>0&&(n.animations=u),c.length>0&&(n.nodes=c)}return n.object=r,n;function a(e){let i=[];for(let n in e){let r=e[n];delete r.metadata,i.push(r)}return i}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===i)for(let i=0;i<e.children.length;i++){let n=e.children[i];this.add(n.clone())}return this}}nI.DEFAULT_UP=new iU(0,1,0),nI.DEFAULT_MATRIX_AUTO_UPDATE=!0,nI.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let nB=new iU,nL=new iU,nP=new iU,nD=new iU,nN=new iU,nO=new iU,nU=new iU,nk=new iU,nF=new iU,nz=new iU,nG=new iB,nV=new iB,nj=new iB;class nH{constructor(e=new iU,i=new iU,n=new iU){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,r){r.subVectors(n,i),nB.subVectors(e,i),r.cross(nB);let s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,i,n,r,s){nB.subVectors(r,i),nL.subVectors(n,i),nP.subVectors(e,i);let a=nB.dot(nB),o=nB.dot(nL),l=nB.dot(nP),h=nL.dot(nL),u=nL.dot(nP),c=a*h-o*o;if(0===c)return s.set(0,0,0),null;let d=1/c,p=(h*l-o*u)*d,f=(a*u-o*l)*d;return s.set(1-p-f,f,p)}static containsPoint(e,i,n,r){return null!==this.getBarycoord(e,i,n,r,nD)&&nD.x>=0&&nD.y>=0&&nD.x+nD.y<=1}static getInterpolation(e,i,n,r,s,a,o,l){return null===this.getBarycoord(e,i,n,r,nD)?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,nD.x),l.addScaledVector(a,nD.y),l.addScaledVector(o,nD.z),l)}static getInterpolatedAttribute(e,i,n,r,s,a){return nG.setScalar(0),nV.setScalar(0),nj.setScalar(0),nG.fromBufferAttribute(e,i),nV.fromBufferAttribute(e,n),nj.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(nG,s.x),a.addScaledVector(nV,s.y),a.addScaledVector(nj,s.z),a}static isFrontFacing(e,i,n,r){return nB.subVectors(n,i),nL.subVectors(e,i),0>nB.cross(nL).dot(r)}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,r){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,n,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return nB.subVectors(this.c,this.b),nL.subVectors(this.a,this.b),.5*nB.cross(nL).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return nH.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return nH.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,r,s){return nH.getInterpolation(e,this.a,this.b,this.c,i,n,r,s)}containsPoint(e){return nH.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return nH.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){let n,r;let s=this.a,a=this.b,o=this.c;nN.subVectors(a,s),nO.subVectors(o,s),nk.subVectors(e,s);let l=nN.dot(nk),h=nO.dot(nk);if(l<=0&&h<=0)return i.copy(s);nF.subVectors(e,a);let u=nN.dot(nF),c=nO.dot(nF);if(u>=0&&c<=u)return i.copy(a);let d=l*c-u*h;if(d<=0&&l>=0&&u<=0)return n=l/(l-u),i.copy(s).addScaledVector(nN,n);nz.subVectors(e,o);let p=nN.dot(nz),f=nO.dot(nz);if(f>=0&&p<=f)return i.copy(o);let m=p*h-l*f;if(m<=0&&h>=0&&f<=0)return r=h/(h-f),i.copy(s).addScaledVector(nO,r);let g=u*f-p*c;if(g<=0&&c-u>=0&&p-f>=0)return nU.subVectors(o,a),r=(c-u)/(c-u+(p-f)),i.copy(a).addScaledVector(nU,r);let A=1/(g+m+d);return n=m*A,r=d*A,i.copy(s).addScaledVector(nN,n).addScaledVector(nO,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let nQ={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},nW={h:0,s:0,l:0},nq={h:0,s:0,l:0};function nX(e,i,n){return(n<0&&(n+=1),n>1&&(n-=1),n<1/6)?e+(i-e)*6*n:n<.5?i:n<2/3?e+(i-e)*6*(2/3-n):e}class nK{constructor(e,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,n)}set(e,i,n){return void 0===i&&void 0===n?e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e):this.setRGB(e,i,n),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=tw){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ib.toWorkingColorSpace(this,i),this}setRGB(e,i,n,r=ib.workingColorSpace){return this.r=e,this.g=i,this.b=n,ib.toWorkingColorSpace(this,r),this}setHSL(e,i,n,r=ib.workingColorSpace){if(e=ie(e,1),i=t9(i,0,1),n=t9(n,0,1),0===i)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+i):n+i-n*i,s=2*n-r;this.r=nX(s,r,e+1/3),this.g=nX(s,r,e),this.b=nX(s,r,e-1/3)}return ib.toWorkingColorSpace(this,r),this}setStyle(e,i=tw){let n;function r(i){void 0!==i&&1>parseFloat(i)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;let a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=n[1],s=r.length;if(3===s)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,i);if(6===s)return this.setHex(parseInt(r,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=tw){let n=nQ[e.toLowerCase()];return void 0!==n?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=iE(e.r),this.g=iE(e.g),this.b=iE(e.b),this}copyLinearToSRGB(e){return this.r=iw(e.r),this.g=iw(e.g),this.b=iw(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=tw){return ib.fromWorkingColorSpace(nY.copy(this),e),65536*Math.round(t9(255*nY.r,0,255))+256*Math.round(t9(255*nY.g,0,255))+Math.round(t9(255*nY.b,0,255))}getHexString(e=tw){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=ib.workingColorSpace){let n,r;ib.fromWorkingColorSpace(nY.copy(this),i);let s=nY.r,a=nY.g,o=nY.b,l=Math.max(s,a,o),h=Math.min(s,a,o),u=(h+l)/2;if(h===l)n=0,r=0;else{let e=l-h;switch(r=u<=.5?e/(l+h):e/(2-l-h),l){case s:n=(a-o)/e+6*(a<o);break;case a:n=(o-s)/e+2;break;case o:n=(s-a)/e+4}n/=6}return e.h=n,e.s=r,e.l=u,e}getRGB(e,i=ib.workingColorSpace){return ib.fromWorkingColorSpace(nY.copy(this),i),e.r=nY.r,e.g=nY.g,e.b=nY.b,e}getStyle(e=tw){ib.fromWorkingColorSpace(nY.copy(this),e);let i=nY.r,n=nY.g,r=nY.b;return e!==tw?`color(${e} ${i.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*i)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,i,n){return this.getHSL(nW),this.setHSL(nW.h+e,nW.s+i,nW.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,n){return this.r=e.r+(i.r-e.r)*n,this.g=e.g+(i.g-e.g)*n,this.b=e.b+(i.b-e.b)*n,this}lerpHSL(e,i){this.getHSL(nW),e.getHSL(nq);let n=it(nW.h,nq.h,i),r=it(nW.s,nq.s,i),s=it(nW.l,nq.l,i);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let i=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*i+s[3]*n+s[6]*r,this.g=s[1]*i+s[4]*n+s[7]*r,this.b=s[2]*i+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let nY=new nK;nK.NAMES=nQ;let nJ=0;class nZ extends t3{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:nJ++}),this.uuid=t7(),this.name="",this.type="Material",this.blending=x,this.side=g,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=D,this.blendDst=N,this.blendEquation=M,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new nK(0,0,0),this.blendAlpha=0,this.depthFunc=X,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=tj,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tR,this.stencilZFail=tR,this.stencilZPass=tR,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let i in e){let n=e[i];if(void 0===n){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}let r=this[i];if(void 0===r){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[i]=n}}toJSON(e){let i=void 0===e||"string"==typeof e;i&&(e={textures:{},images:{}});let n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){let i=[];for(let n in e){let r=e[n];delete r.metadata,i.push(r)}return i}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(n.blending=this.blending),this.side!==g&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==D&&(n.blendSrc=this.blendSrc),this.blendDst!==N&&(n.blendDst=this.blendDst),this.blendEquation!==M&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==X&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==tj&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==tR&&(n.stencilFail=this.stencilFail),this.stencilZFail!==tR&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==tR&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),i){let i=r(e.textures),s=r(e.images);i.length>0&&(n.textures=i),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let i=e.clippingPlanes,n=null;if(null!==i){let e=i.length;n=Array(e);for(let r=0;r!==e;++r)n[r]=i[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class n$ extends nZ{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new nK(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new np,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let n0=function(){let e=new ArrayBuffer(4),i=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){let i=e-127;i<-27?(r[e]=0,r[256|e]=32768,s[e]=24,s[256|e]=24):i<-14?(r[e]=1024>>-i-14,r[256|e]=1024>>-i-14|32768,s[e]=-i-1,s[256|e]=-i-1):i<=15?(r[e]=i+15<<10,r[256|e]=i+15<<10|32768,s[e]=13,s[256|e]=13):i<128?(r[e]=31744,r[256|e]=64512,s[e]=24,s[256|e]=24):(r[e]=31744,r[256|e]=64512,s[e]=13,s[256|e]=13)}let a=new Uint32Array(2048),o=new Uint32Array(64),l=new Uint32Array(64);for(let e=1;e<1024;++e){let i=e<<13,n=0;for(;(8388608&i)==0;)i<<=1,n-=8388608;i&=-8388609,n+=0x38800000,a[e]=i|n}for(let e=1024;e<2048;++e)a[e]=0x38000000+(e-1024<<13);for(let e=1;e<31;++e)o[e]=e<<23;o[31]=0x47800000,o[32]=0x80000000;for(let e=33;e<63;++e)o[e]=0x80000000+(e-32<<23);o[63]=0xc7800000;for(let e=1;e<64;++e)32!==e&&(l[e]=1024);return{floatView:i,uint32View:n,baseTable:r,shiftTable:s,mantissaTable:a,exponentTable:o,offsetTable:l}}();function n1(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=t9(e,-65504,65504),n0.floatView[0]=e;let i=n0.uint32View[0],n=i>>23&511;return n0.baseTable[n]+((8388607&i)>>n0.shiftTable[n])}function n2(e){let i=e>>10;return n0.uint32View[0]=n0.mantissaTable[n0.offsetTable[i]+(1023&e)]+n0.exponentTable[i],n0.floatView[0]}let n3=new iU,n4=new ia;class n5{constructor(e,i,n=!1){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=void 0!==e?e.length/i:0,this.normalized=n,this.usage=tZ,this.updateRanges=[],this.gpuType=eP,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,n){e*=this.itemSize,n*=i.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=i.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let i=0,n=this.count;i<n;i++)n4.fromBufferAttribute(this,i),n4.applyMatrix3(e),this.setXY(i,n4.x,n4.y);else if(3===this.itemSize)for(let i=0,n=this.count;i<n;i++)n3.fromBufferAttribute(this,i),n3.applyMatrix3(e),this.setXYZ(i,n3.x,n3.y,n3.z);return this}applyMatrix4(e){for(let i=0,n=this.count;i<n;i++)n3.fromBufferAttribute(this,i),n3.applyMatrix4(e),this.setXYZ(i,n3.x,n3.y,n3.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)n3.fromBufferAttribute(this,i),n3.applyNormalMatrix(e),this.setXYZ(i,n3.x,n3.y,n3.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)n3.fromBufferAttribute(this,i),n3.transformDirection(e),this.setXYZ(i,n3.x,n3.y,n3.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let n=this.array[e*this.itemSize+i];return this.normalized&&(n=ii(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=ir(n,this.array)),this.array[e*this.itemSize+i]=n,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=ii(i,this.array)),i}setX(e,i){return this.normalized&&(i=ir(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=ii(i,this.array)),i}setY(e,i){return this.normalized&&(i=ir(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=ii(i,this.array)),i}setZ(e,i){return this.normalized&&(i=ir(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=ii(i,this.array)),i}setW(e,i){return this.normalized&&(i=ir(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array)),this.array[e+0]=i,this.array[e+1]=n,this}setXYZ(e,i,n,r){return e*=this.itemSize,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array),r=ir(r,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,i,n,r,s){return e*=this.itemSize,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array),r=ir(r,this.array),s=ir(s,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==tZ&&(e.usage=this.usage),e}}class n6 extends n5{constructor(e,i,n){super(new Uint16Array(e),i,n)}}class n8 extends n5{constructor(e,i,n){super(new Uint32Array(e),i,n)}}class n7 extends n5{constructor(e,i,n){super(new Uint16Array(e),i,n),this.isFloat16BufferAttribute=!0}getX(e){let i=n2(this.array[e*this.itemSize]);return this.normalized&&(i=ii(i,this.array)),i}setX(e,i){return this.normalized&&(i=ir(i,this.array)),this.array[e*this.itemSize]=n1(i),this}getY(e){let i=n2(this.array[e*this.itemSize+1]);return this.normalized&&(i=ii(i,this.array)),i}setY(e,i){return this.normalized&&(i=ir(i,this.array)),this.array[e*this.itemSize+1]=n1(i),this}getZ(e){let i=n2(this.array[e*this.itemSize+2]);return this.normalized&&(i=ii(i,this.array)),i}setZ(e,i){return this.normalized&&(i=ir(i,this.array)),this.array[e*this.itemSize+2]=n1(i),this}getW(e){let i=n2(this.array[e*this.itemSize+3]);return this.normalized&&(i=ii(i,this.array)),i}setW(e,i){return this.normalized&&(i=ir(i,this.array)),this.array[e*this.itemSize+3]=n1(i),this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array)),this.array[e+0]=n1(i),this.array[e+1]=n1(n),this}setXYZ(e,i,n,r){return e*=this.itemSize,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array),r=ir(r,this.array)),this.array[e+0]=n1(i),this.array[e+1]=n1(n),this.array[e+2]=n1(r),this}setXYZW(e,i,n,r,s){return e*=this.itemSize,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array),r=ir(r,this.array),s=ir(s,this.array)),this.array[e+0]=n1(i),this.array[e+1]=n1(n),this.array[e+2]=n1(r),this.array[e+3]=n1(s),this}}class n9 extends n5{constructor(e,i,n){super(new Float32Array(e),i,n)}}let re=0,rt=new nn,ri=new nI,rn=new iU,rr=new iz,rs=new iz,ra=new iU;class ro extends t3{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:re++}),this.uuid=t7(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ih(e)?n8:n6)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){let i=this.attributes.position;void 0!==i&&(i.applyMatrix4(e),i.needsUpdate=!0);let n=this.attributes.normal;if(void 0!==n){let i=new io().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}let r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return rt.makeRotationFromQuaternion(e),this.applyMatrix4(rt),this}rotateX(e){return rt.makeRotationX(e),this.applyMatrix4(rt),this}rotateY(e){return rt.makeRotationY(e),this.applyMatrix4(rt),this}rotateZ(e){return rt.makeRotationZ(e),this.applyMatrix4(rt),this}translate(e,i,n){return rt.makeTranslation(e,i,n),this.applyMatrix4(rt),this}scale(e,i,n){return rt.makeScale(e,i,n),this.applyMatrix4(rt),this}lookAt(e){return ri.lookAt(e),ri.updateMatrix(),this.applyMatrix4(ri.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(rn).negate(),this.translate(rn.x,rn.y,rn.z),this}setFromPoints(e){let i=this.getAttribute("position");if(void 0===i){let i=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];i.push(r.x,r.y,r.z||0)}this.setAttribute("position",new n9(i,3))}else{let n=Math.min(e.length,i.count);for(let r=0;r<n;r++){let n=e[r];i.setXYZ(r,n.x,n.y,n.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new iz);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new iU(-1/0,-1/0,-1/0),new iU(Infinity,Infinity,Infinity));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),i)for(let e=0,n=i.length;e<n;e++){let n=i[e];rr.setFromBufferAttribute(n),this.morphTargetsRelative?(ra.addVectors(this.boundingBox.min,rr.min),this.boundingBox.expandByPoint(ra),ra.addVectors(this.boundingBox.max,rr.max),this.boundingBox.expandByPoint(ra)):(this.boundingBox.expandByPoint(rr.min),this.boundingBox.expandByPoint(rr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new i4);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new iU,1/0);return}if(e){let n=this.boundingSphere.center;if(rr.setFromBufferAttribute(e),i)for(let e=0,n=i.length;e<n;e++){let n=i[e];rs.setFromBufferAttribute(n),this.morphTargetsRelative?(ra.addVectors(rr.min,rs.min),rr.expandByPoint(ra),ra.addVectors(rr.max,rs.max),rr.expandByPoint(ra)):(rr.expandByPoint(rs.min),rr.expandByPoint(rs.max))}rr.getCenter(n);let r=0;for(let i=0,s=e.count;i<s;i++)ra.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(ra));if(i)for(let s=0,a=i.length;s<a;s++){let a=i[s],o=this.morphTargetsRelative;for(let i=0,s=a.count;i<s;i++)ra.fromBufferAttribute(a,i),o&&(rn.fromBufferAttribute(e,i),ra.add(rn)),r=Math.max(r,n.distanceToSquared(ra))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,i=this.attributes;if(null===e||void 0===i.position||void 0===i.normal||void 0===i.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=i.position,r=i.normal,s=i.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new n5(new Float32Array(4*n.count),4));let a=this.getAttribute("tangent"),o=[],l=[];for(let e=0;e<n.count;e++)o[e]=new iU,l[e]=new iU;let h=new iU,u=new iU,c=new iU,d=new ia,p=new ia,f=new ia,m=new iU,g=new iU,A=this.groups;0===A.length&&(A=[{start:0,count:e.count}]);for(let i=0,r=A.length;i<r;++i){let r=A[i],a=r.start,v=r.count;for(let i=a,r=a+v;i<r;i+=3)!function(e,i,r){h.fromBufferAttribute(n,e),u.fromBufferAttribute(n,i),c.fromBufferAttribute(n,r),d.fromBufferAttribute(s,e),p.fromBufferAttribute(s,i),f.fromBufferAttribute(s,r),u.sub(h),c.sub(h),p.sub(d),f.sub(d);let a=1/(p.x*f.y-f.x*p.y);isFinite(a)&&(m.copy(u).multiplyScalar(f.y).addScaledVector(c,-p.y).multiplyScalar(a),g.copy(c).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(a),o[e].add(m),o[i].add(m),o[r].add(m),l[e].add(g),l[i].add(g),l[r].add(g))}(e.getX(i+0),e.getX(i+1),e.getX(i+2))}let v=new iU,y=new iU,x=new iU,_=new iU;function b(e){x.fromBufferAttribute(r,e),_.copy(x);let i=o[e];v.copy(i),v.sub(x.multiplyScalar(x.dot(i))).normalize(),y.crossVectors(_,i);let n=y.dot(l[e]);a.setXYZW(e,v.x,v.y,v.z,n<0?-1:1)}for(let i=0,n=A.length;i<n;++i){let n=A[i],r=n.start,s=n.count;for(let i=r,n=r+s;i<n;i+=3)b(e.getX(i+0)),b(e.getX(i+1)),b(e.getX(i+2))}}computeVertexNormals(){let e=this.index,i=this.getAttribute("position");if(void 0!==i){let n=this.getAttribute("normal");if(void 0===n)n=new n5(new Float32Array(3*i.count),3),this.setAttribute("normal",n);else for(let e=0,i=n.count;e<i;e++)n.setXYZ(e,0,0,0);let r=new iU,s=new iU,a=new iU,o=new iU,l=new iU,h=new iU,u=new iU,c=new iU;if(e)for(let d=0,p=e.count;d<p;d+=3){let p=e.getX(d+0),f=e.getX(d+1),m=e.getX(d+2);r.fromBufferAttribute(i,p),s.fromBufferAttribute(i,f),a.fromBufferAttribute(i,m),u.subVectors(a,s),c.subVectors(r,s),u.cross(c),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),h.fromBufferAttribute(n,m),o.add(u),l.add(u),h.add(u),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z),n.setXYZ(m,h.x,h.y,h.z)}else for(let e=0,o=i.count;e<o;e+=3)r.fromBufferAttribute(i,e+0),s.fromBufferAttribute(i,e+1),a.fromBufferAttribute(i,e+2),u.subVectors(a,s),c.subVectors(r,s),u.cross(c),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)ra.fromBufferAttribute(e,i),ra.normalize(),e.setXYZ(i,ra.x,ra.y,ra.z)}toNonIndexed(){function e(e,i){let n=e.array,r=e.itemSize,s=e.normalized,a=new n.constructor(i.length*r),o=0,l=0;for(let s=0,h=i.length;s<h;s++){o=e.isInterleavedBufferAttribute?i[s]*e.data.stride+e.offset:i[s]*r;for(let e=0;e<r;e++)a[l++]=n[o++]}return new n5(a,r,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let i=new ro,n=this.index.array,r=this.attributes;for(let s in r){let a=e(r[s],n);i.setAttribute(s,a)}let s=this.morphAttributes;for(let r in s){let a=[],o=s[r];for(let i=0,r=o.length;i<r;i++){let r=e(o[i],n);a.push(r)}i.morphAttributes[r]=a}i.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let e=0,n=a.length;e<n;e++){let n=a[e];i.addGroup(n.start,n.count,n.materialIndex)}return i}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let i=this.parameters;for(let n in i)void 0!==i[n]&&(e[n]=i[n]);return e}e.data={attributes:{}};let i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});let n=this.attributes;for(let i in n){let r=n[i];e.data.attributes[i]=r.toJSON(e.data)}let r={},s=!1;for(let i in this.morphAttributes){let n=this.morphAttributes[i],a=[];for(let i=0,r=n.length;i<r;i++){let r=n[i];a.push(r.toJSON(e.data))}a.length>0&&(r[i]=a,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let i={};this.name=e.name;let n=e.index;null!==n&&this.setIndex(n.clone(i));let r=e.attributes;for(let e in r){let n=r[e];this.setAttribute(e,n.clone(i))}let s=e.morphAttributes;for(let e in s){let n=[],r=s[e];for(let e=0,s=r.length;e<s;e++)n.push(r[e].clone(i));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let e=0,i=a.length;e<i;e++){let i=a[e];this.addGroup(i.start,i.count,i.materialIndex)}let o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());let l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let rl=new nn,rh=new ni,ru=new i4,rc=new iU,rd=new iU,rp=new iU,rf=new iU,rm=new iU,rg=new iU,rA=new iU,rv=new iU;class ry extends nI{constructor(e=new ro,i=new n$){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++){let i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}getVertexPosition(e,i){let n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;i.fromBufferAttribute(r,e);let o=this.morphTargetInfluences;if(s&&o){rg.set(0,0,0);for(let n=0,r=s.length;n<r;n++){let r=o[n],l=s[n];0!==r&&(rm.fromBufferAttribute(l,e),a?rg.addScaledVector(rm,r):rg.addScaledVector(rm.sub(i),r))}i.add(rg)}return i}raycast(e,i){let n=this.geometry,r=this.material,s=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),ru.copy(n.boundingSphere),ru.applyMatrix4(s),rh.copy(e.ray).recast(e.near),!1===ru.containsPoint(rh.origin)&&(null===rh.intersectSphere(ru,rc)||rh.origin.distanceToSquared(rc)>(e.far-e.near)**2)||(rl.copy(s).invert(),rh.copy(e.ray).applyMatrix4(rl),null!==n.boundingBox&&!1===rh.intersectsBox(n.boundingBox)))return;this._computeIntersections(e,i,rh)}}_computeIntersections(e,i,n){let r;let s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,h=s.attributes.uv,u=s.attributes.uv1,c=s.attributes.normal,d=s.groups,p=s.drawRange;if(null!==o){if(Array.isArray(a))for(let s=0,l=d.length;s<l;s++){let l=d[s],f=a[l.materialIndex],m=Math.max(l.start,p.start),g=Math.min(o.count,Math.min(l.start+l.count,p.start+p.count));for(let s=m;s<g;s+=3){let a=o.getX(s);(r=rx(this,f,e,n,h,u,c,a,o.getX(s+1),o.getX(s+2)))&&(r.faceIndex=Math.floor(s/3),r.face.materialIndex=l.materialIndex,i.push(r))}}else{let s=Math.max(0,p.start),l=Math.min(o.count,p.start+p.count);for(let d=s;d<l;d+=3){let s=o.getX(d);(r=rx(this,a,e,n,h,u,c,s,o.getX(d+1),o.getX(d+2)))&&(r.faceIndex=Math.floor(d/3),i.push(r))}}}else if(void 0!==l){if(Array.isArray(a))for(let s=0,o=d.length;s<o;s++){let o=d[s],f=a[o.materialIndex],m=Math.max(o.start,p.start),g=Math.min(l.count,Math.min(o.start+o.count,p.start+p.count));for(let s=m;s<g;s+=3)(r=rx(this,f,e,n,h,u,c,s,s+1,s+2))&&(r.faceIndex=Math.floor(s/3),r.face.materialIndex=o.materialIndex,i.push(r))}else{let s=Math.max(0,p.start),o=Math.min(l.count,p.start+p.count);for(let l=s;l<o;l+=3)(r=rx(this,a,e,n,h,u,c,l,l+1,l+2))&&(r.faceIndex=Math.floor(l/3),i.push(r))}}}}function rx(e,i,n,r,s,a,o,l,h,u){e.getVertexPosition(l,rd),e.getVertexPosition(h,rp),e.getVertexPosition(u,rf);let c=function(e,i,n,r,s,a,o,l){let h;if(null===(i.side===A?r.intersectTriangle(o,a,s,!0,l):r.intersectTriangle(s,a,o,i.side===g,l)))return null;rv.copy(l),rv.applyMatrix4(e.matrixWorld);let u=n.ray.origin.distanceTo(rv);return u<n.near||u>n.far?null:{distance:u,point:rv.clone(),object:e}}(e,i,n,r,rd,rp,rf,rA);if(c){let e=new iU;nH.getBarycoord(rA,rd,rp,rf,e),s&&(c.uv=nH.getInterpolatedAttribute(s,l,h,u,e,new ia)),a&&(c.uv1=nH.getInterpolatedAttribute(a,l,h,u,e,new ia)),o&&(c.normal=nH.getInterpolatedAttribute(o,l,h,u,e,new iU),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));let i={a:l,b:h,c:u,normal:new iU,materialIndex:0};nH.getNormal(rd,rp,rf,i.normal),c.face=i,c.barycoord=e}return c}class r_ extends ro{constructor(e=1,i=1,n=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:a};let o=this;r=Math.floor(r),s=Math.floor(s);let l=[],h=[],u=[],c=[],d=0,p=0;function f(e,i,n,r,s,a,f,m,g,A,v){let y=a/g,x=f/A,_=a/2,b=f/2,E=m/2,w=g+1,M=A+1,C=0,S=0,T=new iU;for(let a=0;a<M;a++){let o=a*x-b;for(let l=0;l<w;l++){let d=l*y-_;T[e]=d*r,T[i]=o*s,T[n]=E,h.push(T.x,T.y,T.z),T[e]=0,T[i]=0,T[n]=m>0?1:-1,u.push(T.x,T.y,T.z),c.push(l/g),c.push(1-a/A),C+=1}}for(let e=0;e<A;e++)for(let i=0;i<g;i++){let n=d+i+w*e,r=d+i+w*(e+1),s=d+(i+1)+w*(e+1),a=d+(i+1)+w*e;l.push(n,r,a),l.push(r,s,a),S+=6}o.addGroup(p,S,v),p+=S,d+=C}f("z","y","x",-1,-1,n,i,e,a=Math.floor(a),s,0),f("z","y","x",1,-1,n,i,-e,a,s,1),f("x","z","y",1,1,e,n,i,r,a,2),f("x","z","y",1,-1,e,n,-i,r,a,3),f("x","y","z",1,-1,e,i,n,r,s,4),f("x","y","z",-1,-1,e,i,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new n9(h,3)),this.setAttribute("normal",new n9(u,3)),this.setAttribute("uv",new n9(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new r_(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function rb(e){let i={};for(let n in e)for(let r in i[n]={},e[n]){let s=e[n][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),i[n][r]=null):i[n][r]=s.clone():Array.isArray(s)?i[n][r]=s.slice():i[n][r]=s}return i}function rE(e){let i={};for(let n=0;n<e.length;n++){let r=rb(e[n]);for(let e in r)i[e]=r[e]}return i}function rw(e){let i=e.getRenderTarget();return null===i?e.outputColorSpace:!0===i.isXRRenderTarget?i.texture.colorSpace:ib.workingColorSpace}let rM={clone:rb,merge:rE};class rC extends nZ{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=rb(e.uniforms),this.uniformsGroups=function(e){let i=[];for(let n=0;n<e.length;n++)i.push(e[n].clone());return i}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let i=super.toJSON(e);for(let n in i.glslVersion=this.glslVersion,i.uniforms={},this.uniforms){let r=this.uniforms[n].value;r&&r.isTexture?i.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?i.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?i.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?i.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?i.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?i.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?i.uniforms[n]={type:"m4",value:r.toArray()}:i.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;let n={};for(let e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class rS extends nI{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new nn,this.projectionMatrix=new nn,this.projectionMatrixInverse=new nn,this.coordinateSystem=t1}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let rT=new iU,rR=new ia,rI=new ia;class rB extends rS{constructor(e=50,i=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let i=.5*this.getFilmHeight()/e;this.fov=2*t8*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*t6*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*t8*Math.atan(Math.tan(.5*t6*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,n){rT.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(rT.x,rT.y).multiplyScalar(-e/rT.z),rT.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(rT.x,rT.y).multiplyScalar(-e/rT.z)}getViewSize(e,i){return this.getViewBounds(e,rR,rI),i.subVectors(rI,rR)}setViewOffset(e,i,n,r,s,a){this.aspect=e/i,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,i=e*Math.tan(.5*t6*this.fov)/this.zoom,n=2*i,r=this.aspect*n,s=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,o=a.fullHeight;s+=a.offsetX*r/e,i-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}let o=this.filmOffset;0!==o&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,i,i-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,null!==this.view&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}class rL extends nI{constructor(e,i,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;let r=new rB(-90,1,e,i);r.layers=this.layers,this.add(r);let s=new rB(-90,1,e,i);s.layers=this.layers,this.add(s);let a=new rB(-90,1,e,i);a.layers=this.layers,this.add(a);let o=new rB(-90,1,e,i);o.layers=this.layers,this.add(o);let l=new rB(-90,1,e,i);l.layers=this.layers,this.add(l);let h=new rB(-90,1,e,i);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){let e=this.coordinateSystem,i=this.children.concat(),[n,r,s,a,o,l]=i;for(let e of i)this.remove(e);if(e===t1)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===t2)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(let e of i)this.add(e),e.updateMatrixWorld()}update(e,i){null===this.parent&&this.updateMatrixWorld();let{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[s,a,o,l,h,u]=this.children,c=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;let m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(i,s),e.setRenderTarget(n,1,r),e.render(i,a),e.setRenderTarget(n,2,r),e.render(i,o),e.setRenderTarget(n,3,r),e.render(i,l),e.setRenderTarget(n,4,r),e.render(i,h),n.texture.generateMipmaps=m,e.setRenderTarget(n,5,r),e.render(i,u),e.setRenderTarget(c,d,p),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class rP extends iI{constructor(e,i,n,r,s,a,o,l,h,u){super(e=void 0!==e?e:[],i=void 0!==i?i:ed,n,r,s,a,o,l,h,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class rD extends iP{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;let n={width:e,height:e,depth:1};this.texture=new rP([n,n,n,n,n,n],i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:eE}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new r_(5,5,5),s=new rC({name:"CubemapFromEquirect",uniforms:rb(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:A,blending:y});s.uniforms.tEquirect.value=i;let a=new ry(r,s),o=i.minFilter;return i.minFilter===eM&&(i.minFilter=eE),new rL(1,10,this).update(e,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,n,r){let s=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(i,n,r);e.setRenderTarget(s)}}class rN{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new nK(e),this.density=i}clone(){return new rN(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class rO{constructor(e,i=1,n=1e3){this.isFog=!0,this.name="",this.color=new nK(e),this.near=i,this.far=n}clone(){return new rO(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class rU extends nI{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new np,this.environmentIntensity=1,this.environmentRotation=new np,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let i=super.toJSON(e);return null!==this.fog&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class rk{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=void 0!==e?e.length/i:0,this.usage=tZ,this.updateRanges=[],this.version=0,this.uuid=t7()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,n){e*=this.stride,n*=i.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=i.array[n+r];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=t7()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(i,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=t7()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}let rF=new iU;class rz{constructor(e,i,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)rF.fromBufferAttribute(this,i),rF.applyMatrix4(e),this.setXYZ(i,rF.x,rF.y,rF.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)rF.fromBufferAttribute(this,i),rF.applyNormalMatrix(e),this.setXYZ(i,rF.x,rF.y,rF.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)rF.fromBufferAttribute(this,i),rF.transformDirection(e),this.setXYZ(i,rF.x,rF.y,rF.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=ii(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=ir(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=ir(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=ir(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=ir(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=ir(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=ii(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=ii(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=ii(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=ii(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array),r=ir(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,i,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=ir(i,this.array),n=ir(n,this.array),r=ir(r,this.array),s=ir(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new rz(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[n+i])}return new n5(new this.array.constructor(e),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[n+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}}}class rG extends nZ{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new nK(0xffffff),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let rV=new iU,rj=new iU,rH=new iU,rQ=new ia,rW=new ia,rq=new nn,rX=new iU,rK=new iU,rY=new iU,rJ=new ia,rZ=new ia,r$=new ia;class r0 extends nI{constructor(e=new rG){if(super(),this.isSprite=!0,this.type="Sprite",void 0===s){s=new ro;let e=new rk(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);s.setIndex([0,1,2,0,2,3]),s.setAttribute("position",new rz(e,3,0,!1)),s.setAttribute("uv",new rz(e,2,3,!1))}this.geometry=s,this.material=e,this.center=new ia(.5,.5)}raycast(e,i){let n,r;null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),rj.setFromMatrixScale(this.matrixWorld),rq.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),rH.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&rj.multiplyScalar(-rH.z);let s=this.material.rotation;0!==s&&(r=Math.cos(s),n=Math.sin(s));let a=this.center;r1(rX.set(-.5,-.5,0),rH,a,rj,n,r),r1(rK.set(.5,-.5,0),rH,a,rj,n,r),r1(rY.set(.5,.5,0),rH,a,rj,n,r),rJ.set(0,0),rZ.set(1,0),r$.set(1,1);let o=e.ray.intersectTriangle(rX,rK,rY,!1,rV);if(null===o&&(r1(rK.set(-.5,.5,0),rH,a,rj,n,r),rZ.set(0,1),null===(o=e.ray.intersectTriangle(rX,rY,rK,!1,rV))))return;let l=e.ray.origin.distanceTo(rV);l<e.near||l>e.far||i.push({distance:l,point:rV.clone(),uv:nH.getInterpolation(rV,rX,rK,rY,rJ,rZ,r$,new ia),face:null,object:this})}copy(e,i){return super.copy(e,i),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function r1(e,i,n,r,s,a){rQ.subVectors(e,n).addScalar(.5).multiply(r),void 0!==s?(rW.x=a*rQ.x-s*rQ.y,rW.y=s*rQ.x+a*rQ.y):rW.copy(rQ),e.copy(i),e.x+=rW.x,e.y+=rW.y,e.applyMatrix4(rq)}let r2=new iU,r3=new iU;class r4 extends nI{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let i=e.levels;for(let e=0,n=i.length;e<n;e++){let n=i[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,i=0,n=0){let r;i=Math.abs(i);let s=this.levels;for(r=0;r<s.length&&!(i<s[r].distance);r++);return s.splice(r,0,{distance:i,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){let i=this.levels;for(let n=0;n<i.length;n++)if(i[n].distance===e){let e=i.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let i=this.levels;if(i.length>0){let n,r;for(n=1,r=i.length;n<r;n++){let r=i[n].distance;if(i[n].object.visible&&(r-=r*i[n].hysteresis),e<r)break}return i[n-1].object}return null}raycast(e,i){if(this.levels.length>0){r2.setFromMatrixPosition(this.matrixWorld);let n=e.ray.origin.distanceTo(r2);this.getObjectForDistance(n).raycast(e,i)}}update(e){let i=this.levels;if(i.length>1){let n,r;r2.setFromMatrixPosition(e.matrixWorld),r3.setFromMatrixPosition(this.matrixWorld);let s=r2.distanceTo(r3)/e.zoom;for(n=1,i[0].object.visible=!0,r=i.length;n<r;n++){let e=i[n].distance;if(i[n].object.visible&&(e-=e*i[n].hysteresis),s>=e)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<r;n++)i[n].object.visible=!1}}toJSON(e){let i=super.toJSON(e);!1===this.autoUpdate&&(i.object.autoUpdate=!1),i.object.levels=[];let n=this.levels;for(let e=0,r=n.length;e<r;e++){let r=n[e];i.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return i}}let r5=new iU,r6=new iB,r8=new iB,r7=new iU,r9=new nn,se=new iU,st=new i4,si=new nn,sn=new ni;class sr extends ry{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=eu,this.bindMatrix=new nn,this.bindMatrixInverse=new nn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let e=this.geometry;null===this.boundingBox&&(this.boundingBox=new iz),this.boundingBox.makeEmpty();let i=e.getAttribute("position");for(let e=0;e<i.count;e++)this.getVertexPosition(e,se),this.boundingBox.expandByPoint(se)}computeBoundingSphere(){let e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new i4),this.boundingSphere.makeEmpty();let i=e.getAttribute("position");for(let e=0;e<i.count;e++)this.getVertexPosition(e,se),this.boundingSphere.expandByPoint(se)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){let n=this.material,r=this.matrixWorld;if(void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),st.copy(this.boundingSphere),st.applyMatrix4(r),!1!==e.ray.intersectsSphere(st))){if(si.copy(r).invert(),sn.copy(e.ray).applyMatrix4(si),null!==this.boundingBox&&!1===sn.intersectsBox(this.boundingBox))return;this._computeIntersections(e,i,sn)}}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,void 0===i&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new iB,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){e.fromBufferAttribute(i,n);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),i.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===eu?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){let n=this.skeleton,r=this.geometry;r6.fromBufferAttribute(r.attributes.skinIndex,e),r8.fromBufferAttribute(r.attributes.skinWeight,e),r5.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let e=0;e<4;e++){let r=r8.getComponent(e);if(0!==r){let s=r6.getComponent(e);r9.multiplyMatrices(n.bones[s].matrixWorld,n.boneInverses[s]),i.addScaledVector(r7.copy(r5).applyMatrix4(r9),r)}}return i.applyMatrix4(this.bindMatrixInverse)}}class ss extends nI{constructor(){super(),this.isBone=!0,this.type="Bone"}}class sa extends iI{constructor(e=null,i=1,n=1,r,s,a,o,l,h=ex,u=ex,c,d){super(null,a,o,l,h,u,r,s,c,d),this.isDataTexture=!0,this.image={data:e,width:i,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let so=new nn,sl=new nn;class sh{constructor(e=[],i=[]){this.uuid=t7(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===i.length)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,i=this.bones.length;e<i;e++)this.boneInverses.push(new nn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){let i=new nn;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,i=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let s=e[r]?e[r].matrixWorld:sl;so.multiplyMatrices(s,i[r]),so.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new sh(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length),i=new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4);i.set(this.boneMatrices);let n=new sa(i,e,e,eG,eP);return n.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=n,this}getBoneByName(e){for(let i=0,n=this.bones.length;i<n;i++){let n=this.bones[i];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){let r=e.bones[n],s=i[r];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new ss),this.bones.push(s),this.boneInverses.push(new nn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){let e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let i=this.bones,n=this.boneInverses;for(let r=0,s=i.length;r<s;r++){let s=i[r];e.bones.push(s.uuid);let a=n[r];e.boneInverses.push(a.toArray())}return e}}class su extends n5{constructor(e,i,n,r=1){super(e,i,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}let sc=new nn,sd=new nn,sp=[],sf=new iz,sm=new nn,sg=new ry,sA=new i4;class sv extends ry{constructor(e,i,n){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new su(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,sm)}computeBoundingBox(){let e=this.geometry,i=this.count;null===this.boundingBox&&(this.boundingBox=new iz),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<i;n++)this.getMatrixAt(n,sc),sf.copy(e.boundingBox).applyMatrix4(sc),this.boundingBox.union(sf)}computeBoundingSphere(){let e=this.geometry,i=this.count;null===this.boundingSphere&&(this.boundingSphere=new i4),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<i;n++)this.getMatrixAt(n,sc),sA.copy(e.boundingSphere).applyMatrix4(sc),this.boundingSphere.union(sA)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,i){let n=i.morphTargetInfluences,r=this.morphTexture.source.data.data,s=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=r[s+e]}raycast(e,i){let n=this.matrixWorld,r=this.count;if(sg.geometry=this.geometry,sg.material=this.material,void 0!==sg.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),sA.copy(this.boundingSphere),sA.applyMatrix4(n),!1!==e.ray.intersectsSphere(sA)))for(let s=0;s<r;s++){this.getMatrixAt(s,sc),sd.multiplyMatrices(n,sc),sg.matrixWorld=sd,sg.raycast(e,sp);for(let e=0,n=sp.length;e<n;e++){let n=sp[e];n.instanceId=s,n.object=this,i.push(n)}sp.length=0}}setColorAt(e,i){null===this.instanceColor&&(this.instanceColor=new su(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),i.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,i){let n=i.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new sa(new Float32Array(r*this.count),r,this.count,eW,eP));let s=this.morphTexture.source.data.data,a=0;for(let e=0;e<n.length;e++)a+=n[e];let o=this.geometry.morphTargetsRelative?1:1-a,l=r*e;s[l]=o,s.set(n,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}let sy=new iU,sx=new iU,s_=new io;class sb{constructor(e=new iU(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,n,r){return this.normal.set(e,i,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,n){let r=sy.subVectors(n,i).cross(sx.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){let n=e.delta(sy),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?i.copy(e.start):null;let s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:i.copy(e.start).addScaledVector(n,s)}intersectsLine(e){let i=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return i<0&&n>0||n<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){let n=i||s_.getNormalMatrix(e),r=this.coplanarPoint(sy).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}let sE=new i4,sw=new iU;class sM{constructor(e=new sb,i=new sb,n=new sb,r=new sb,s=new sb,a=new sb){this.planes=[e,i,n,r,s,a]}set(e,i,n,r,s,a){let o=this.planes;return o[0].copy(e),o[1].copy(i),o[2].copy(n),o[3].copy(r),o[4].copy(s),o[5].copy(a),this}copy(e){let i=this.planes;for(let n=0;n<6;n++)i[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,i=t1){let n=this.planes,r=e.elements,s=r[0],a=r[1],o=r[2],l=r[3],h=r[4],u=r[5],c=r[6],d=r[7],p=r[8],f=r[9],m=r[10],g=r[11],A=r[12],v=r[13],y=r[14],x=r[15];if(n[0].setComponents(l-s,d-h,g-p,x-A).normalize(),n[1].setComponents(l+s,d+h,g+p,x+A).normalize(),n[2].setComponents(l+a,d+u,g+f,x+v).normalize(),n[3].setComponents(l-a,d-u,g-f,x-v).normalize(),n[4].setComponents(l-o,d-c,g-m,x-y).normalize(),i===t1)n[5].setComponents(l+o,d+c,g+m,x+y).normalize();else if(i===t2)n[5].setComponents(o,c,m,y).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),sE.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let i=e.geometry;null===i.boundingSphere&&i.computeBoundingSphere(),sE.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(sE)}intersectsSprite(e){return sE.center.set(0,0,0),sE.radius=.7071067811865476,sE.applyMatrix4(e.matrixWorld),this.intersectsSphere(sE)}intersectsSphere(e){let i=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(i[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){let i=this.planes;for(let n=0;n<6;n++){let r=i[n];if(sw.x=r.normal.x>0?e.max.x:e.min.x,sw.y=r.normal.y>0?e.max.y:e.min.y,sw.z=r.normal.z>0?e.max.z:e.min.z,0>r.distanceToPoint(sw))return!1}return!0}containsPoint(e){let i=this.planes;for(let n=0;n<6;n++)if(0>i[n].distanceToPoint(e))return!1;return!0}clone(){return new this.constructor().copy(this)}}function sC(e,i){return e-i}function sS(e,i){return e.z-i.z}function sT(e,i){return i.z-e.z}let sR=new nn,sI=new nK(1,1,1),sB=new sM,sL=new iz,sP=new i4,sD=new iU,sN=new iU,sO=new iU,sU=new class{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i,n,r){let s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});let o=s[this.index];a.push(o),this.index++,o.start=e,o.count=i,o.z=n,o.index=r}reset(){this.list.length=0,this.index=0}},sk=new ry,sF=[];function sz(e,i){if(e.constructor!==i.constructor){let n=Math.min(e.length,i.length);for(let r=0;r<n;r++)i[r]=e[r]}else{let n=Math.min(e.length,i.length);i.set(new e.constructor(e.buffer,0,n))}}class sG extends ry{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(e,i,n=2*i,r){super(new ro,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=i,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount),i=new sa(new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4),e,e,eG,eP);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount),i=new sa(new Uint32Array((e=Math.ceil(e))*e),e,e,eq,eL);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount),i=new sa(new Float32Array((e=Math.ceil(e))*e*4).fill(1),e,e,eG,eP);i.colorSpace=ib.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){let i=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(let r in e.attributes){let{array:s,itemSize:a,normalized:o}=e.getAttribute(r),l=new n5(new s.constructor(n*a),a,o);i.setAttribute(r,l)}if(null!==e.getIndex()){let e=n>65535?new Uint32Array(r):new Uint16Array(r);i.setIndex(new n5(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){let i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(let n in i.attributes){if(!e.hasAttribute(n))throw Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);let r=e.getAttribute(n),s=i.getAttribute(n);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){let i=this._instanceInfo;if(e<0||e>=i.length||!1===i[e].active)throw Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){let i=this._geometryInfo;if(e<0||e>=i.length||!1===i[e].active)throw Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new iz);let e=this.boundingBox,i=this._instanceInfo;e.makeEmpty();for(let n=0,r=i.length;n<r;n++){if(!1===i[n].active)continue;let r=i[n].geometryIndex;this.getMatrixAt(n,sR),this.getBoundingBoxAt(r,sL).applyMatrix4(sR),e.union(sL)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new i4);let e=this.boundingSphere,i=this._instanceInfo;e.makeEmpty();for(let n=0,r=i.length;n<r;n++){if(!1===i[n].active)continue;let r=i[n].geometryIndex;this.getMatrixAt(n,sR),this.getBoundingSphereAt(r,sP).applyMatrix4(sR),e.union(sP)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw Error("THREE.BatchedMesh: Maximum item count reached.");let i={visible:!0,active:!0,geometryIndex:e},n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(sC),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=i):(n=this._instanceInfo.length,this._instanceInfo.push(i));let r=this._matricesTexture;sR.identity().toArray(r.image.data,16*n),r.needsUpdate=!0;let s=this._colorsTexture;return s&&(sI.toArray(s.image.data,4*n),s.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e,i=-1,n=-1){let r;this._initializeGeometry(e),this._validateGeometry(e);let s={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},a=this._geometryInfo;s.vertexStart=this._nextVertexStart,s.reservedVertexCount=-1===i?e.getAttribute("position").count:i;let o=e.getIndex();if(null!==o&&(s.indexStart=this._nextIndexStart,s.reservedIndexCount=-1===n?o.count:n),-1!==s.indexStart&&s.indexStart+s.reservedIndexCount>this._maxIndexCount||s.vertexStart+s.reservedVertexCount>this._maxVertexCount)throw Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(sC),a[r=this._availableGeometryIds.shift()]=s):(r=this._geometryCount,this._geometryCount++,a.push(s)),this.setGeometryAt(r,e),this._nextIndexStart=s.indexStart+s.reservedIndexCount,this._nextVertexStart=s.vertexStart+s.reservedVertexCount,r}setGeometryAt(e,i){if(e>=this._geometryCount)throw Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);let n=this.geometry,r=null!==n.getIndex(),s=n.getIndex(),a=i.getIndex(),o=this._geometryInfo[e];if(r&&a.count>o.reservedIndexCount||i.attributes.position.count>o.reservedVertexCount)throw Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");let l=o.vertexStart,h=o.reservedVertexCount;for(let e in o.vertexCount=i.getAttribute("position").count,n.attributes){let r=i.getAttribute(e),s=n.getAttribute(e);!function(e,i,n=0){let r=i.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==i.array.constructor){let s=e.count;for(let a=0;a<s;a++)for(let s=0;s<r;s++)i.setComponent(a+n,s,e.getComponent(a,s))}else i.array.set(e.array,n*r);i.needsUpdate=!0}(r,s,l);let a=r.itemSize;for(let e=r.count;e<h;e++){let i=l+e;for(let e=0;e<a;e++)s.setComponent(i,e,0)}s.needsUpdate=!0,s.addUpdateRange(l*a,h*a)}if(r){let e=o.indexStart,n=o.reservedIndexCount;o.indexCount=i.getIndex().count;for(let i=0;i<a.count;i++)s.setX(e+i,l+a.getX(i));for(let i=a.count;i<n;i++)s.setX(e+i,l);s.needsUpdate=!0,s.addUpdateRange(e,o.reservedIndexCount)}return o.start=r?o.indexStart:o.vertexStart,o.count=r?o.indexCount:o.vertexCount,o.boundingBox=null,null!==i.boundingBox&&(o.boundingBox=i.boundingBox.clone()),o.boundingSphere=null,null!==i.boundingSphere&&(o.boundingSphere=i.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){let i=this._geometryInfo;if(e>=i.length||!1===i[e].active)return this;let n=this._instanceInfo;for(let i=0,r=n.length;i<r;i++)n[i].geometryIndex===e&&this.deleteInstance(i);return i[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,i=0,n=this._geometryInfo,r=n.map((e,i)=>i).sort((e,i)=>n[e].vertexStart-n[i].vertexStart),s=this.geometry;for(let a=0,o=n.length;a<o;a++){let o=n[r[a]];if(!1!==o.active){if(null!==s.index){if(o.indexStart!==i){let{indexStart:n,vertexStart:r,reservedIndexCount:a}=o,l=s.index,h=l.array,u=e-r;for(let e=n;e<n+a;e++)h[e]=h[e]+u;l.array.copyWithin(i,n,n+a),l.addUpdateRange(i,a),o.indexStart=i}i+=o.reservedIndexCount}if(o.vertexStart!==e){let{vertexStart:i,reservedVertexCount:n}=o,r=s.attributes;for(let s in r){let a=r[s],{array:o,itemSize:l}=a;o.copyWithin(e*l,i*l,(i+n)*l),a.addUpdateRange(e*l,n*l)}o.vertexStart=e}e+=o.reservedVertexCount,o.start=s.index?o.indexStart:o.vertexStart,this._nextIndexStart=s.index?o.indexStart+o.reservedIndexCount:0,this._nextVertexStart=o.vertexStart+o.reservedVertexCount}}return this}getBoundingBoxAt(e,i){if(e>=this._geometryCount)return null;let n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingBox){let e=new iz,i=n.index,s=n.attributes.position;for(let n=r.start,a=r.start+r.count;n<a;n++){let r=n;i&&(r=i.getX(r)),e.expandByPoint(sD.fromBufferAttribute(s,r))}r.boundingBox=e}return i.copy(r.boundingBox),i}getBoundingSphereAt(e,i){if(e>=this._geometryCount)return null;let n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingSphere){let i=new i4;this.getBoundingBoxAt(e,sL),sL.getCenter(i.center);let s=n.index,a=n.attributes.position,o=0;for(let e=r.start,n=r.start+r.count;e<n;e++){let n=e;s&&(n=s.getX(n)),sD.fromBufferAttribute(a,n),o=Math.max(o,i.center.distanceToSquared(sD))}i.radius=Math.sqrt(o),r.boundingSphere=i}return i.copy(r.boundingSphere),i}setMatrixAt(e,i){this.validateInstanceId(e);let n=this._matricesTexture,r=this._matricesTexture.image.data;return i.toArray(r,16*e),n.needsUpdate=!0,this}getMatrixAt(e,i){return this.validateInstanceId(e),i.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,i){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),i.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,i){return this.validateInstanceId(e),i.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,i){return this.validateInstanceId(e),this._instanceInfo[e].visible===i||(this._instanceInfo[e].visible=i,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,i){return this.validateInstanceId(e),this.validateGeometryId(i),this._instanceInfo[e].geometryIndex=i,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,i={}){this.validateGeometryId(e);let n=this._geometryInfo[e];return i.vertexStart=n.vertexStart,i.vertexCount=n.vertexCount,i.reservedVertexCount=n.reservedVertexCount,i.indexStart=n.indexStart,i.indexCount=n.indexCount,i.reservedIndexCount=n.reservedIndexCount,i.start=n.start,i.count=n.count,i}setInstanceCount(e){let i=this._availableInstanceIds,n=this._instanceInfo;for(i.sort(sC);i[i.length-1]===n.length;)n.pop(),i.pop();if(e<n.length)throw Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);let r=new Int32Array(e),s=new Int32Array(e);sz(this._multiDrawCounts,r),sz(this._multiDrawStarts,s),this._multiDrawCounts=r,this._multiDrawStarts=s,this._maxInstanceCount=e;let a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),sz(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),sz(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),sz(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,i){let n=[...this._geometryInfo].filter(e=>e.active);if(Math.max(...n.map(e=>e.vertexStart+e.reservedVertexCount))>e)throw Error(`BatchedMesh: Geometry vertex values are being used outside the range ${i}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(e=>e.indexStart+e.reservedIndexCount))>i)throw Error(`BatchedMesh: Geometry index values are being used outside the range ${i}. Cannot shrink further.`);let r=this.geometry;r.dispose(),this._maxVertexCount=e,this._maxIndexCount=i,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new ro,this._initializeGeometry(r));let s=this.geometry;for(let e in r.index&&sz(r.index.array,s.index.array),r.attributes)sz(r.attributes[e].array,s.attributes[e].array)}raycast(e,i){let n=this._instanceInfo,r=this._geometryInfo,s=this.matrixWorld,a=this.geometry;sk.material=this.material,sk.geometry.index=a.index,sk.geometry.attributes=a.attributes,null===sk.geometry.boundingBox&&(sk.geometry.boundingBox=new iz),null===sk.geometry.boundingSphere&&(sk.geometry.boundingSphere=new i4);for(let a=0,o=n.length;a<o;a++){if(!n[a].visible||!n[a].active)continue;let o=n[a].geometryIndex,l=r[o];sk.geometry.setDrawRange(l.start,l.count),this.getMatrixAt(a,sk.matrixWorld).premultiply(s),this.getBoundingBoxAt(o,sk.geometry.boundingBox),this.getBoundingSphereAt(o,sk.geometry.boundingSphere),sk.raycast(e,sF);for(let e=0,n=sF.length;e<n;e++){let n=sF[e];n.object=this,n.batchId=a,i.push(n)}sF.length=0}sk.material=null,sk.geometry.index=null,sk.geometry.attributes={},sk.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(e=>({...e,boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(e=>({...e})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,i,n,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;let a=r.getIndex(),o=null===a?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,h=this._multiDrawStarts,u=this._multiDrawCounts,c=this._geometryInfo,d=this.perObjectFrustumCulled,p=this._indirectTexture,f=p.image.data;d&&(sR.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),sB.setFromProjectionMatrix(sR,e.coordinateSystem));let m=0;if(this.sortObjects){sR.copy(this.matrixWorld).invert(),sD.setFromMatrixPosition(n.matrixWorld).applyMatrix4(sR),sN.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(sR);for(let e=0,i=l.length;e<i;e++)if(l[e].visible&&l[e].active){let i=l[e].geometryIndex;this.getMatrixAt(e,sR),this.getBoundingSphereAt(i,sP).applyMatrix4(sR);let n=!1;if(d&&(n=!sB.intersectsSphere(sP)),!n){let n=c[i],r=sO.subVectors(sP.center,sD).dot(sN);sU.push(n.start,n.count,r,e)}}let e=sU.list,i=this.customSort;null===i?e.sort(s.transparent?sT:sS):i.call(this,e,n);for(let i=0,n=e.length;i<n;i++){let n=e[i];h[m]=n.start*o,u[m]=n.count,f[m]=n.index,m++}sU.reset()}else for(let e=0,i=l.length;e<i;e++)if(l[e].visible&&l[e].active){let i=l[e].geometryIndex,n=!1;if(d&&(this.getMatrixAt(e,sR),this.getBoundingSphereAt(i,sP).applyMatrix4(sR),n=!sB.intersectsSphere(sP)),!n){let n=c[i];h[m]=n.start*o,u[m]=n.count,f[m]=e,m++}}p.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(e,i,n,r,s,a){this.onBeforeRender(e,null,r,s,a)}}class sV extends nZ{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new nK(0xffffff),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}let sj=new iU,sH=new iU,sQ=new nn,sW=new ni,sq=new i4,sX=new iU,sK=new iU;class sY extends nI{constructor(e=new ro,i=new sV){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let i=e.attributes.position,n=[0];for(let e=1,r=i.count;e<r;e++)sj.fromBufferAttribute(i,e-1),sH.fromBufferAttribute(i,e),n[e]=n[e-1],n[e]+=sj.distanceTo(sH);e.setAttribute("lineDistance",new n9(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){let n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),sq.copy(n.boundingSphere),sq.applyMatrix4(r),sq.radius+=s,!1===e.ray.intersectsSphere(sq))return;sQ.copy(r).invert(),sW.copy(e.ray).applyMatrix4(sQ);let o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,h=this.isLineSegments?2:1,u=n.index,c=n.attributes.position;if(null!==u){let n=Math.max(0,a.start),r=Math.min(u.count,a.start+a.count);for(let s=n,a=r-1;s<a;s+=h){let n=sJ(this,e,sW,l,u.getX(s),u.getX(s+1));n&&i.push(n)}if(this.isLineLoop){let s=sJ(this,e,sW,l,u.getX(r-1),u.getX(n));s&&i.push(s)}}else{let n=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);for(let s=n,a=r-1;s<a;s+=h){let n=sJ(this,e,sW,l,s,s+1);n&&i.push(n)}if(this.isLineLoop){let s=sJ(this,e,sW,l,r-1,n);s&&i.push(s)}}}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++){let i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}function sJ(e,i,n,r,s,a){let o=e.geometry.attributes.position;if(sj.fromBufferAttribute(o,s),sH.fromBufferAttribute(o,a),n.distanceSqToSegment(sj,sH,sX,sK)>r)return;sX.applyMatrix4(e.matrixWorld);let l=i.ray.origin.distanceTo(sX);if(!(l<i.near)&&!(l>i.far))return{distance:l,point:sK.clone().applyMatrix4(e.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:e}}let sZ=new iU,s$=new iU;class s0 extends sY{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let i=e.attributes.position,n=[];for(let e=0,r=i.count;e<r;e+=2)sZ.fromBufferAttribute(i,e),s$.fromBufferAttribute(i,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+sZ.distanceTo(s$);e.setAttribute("lineDistance",new n9(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class s1 extends sY{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class s2 extends nZ{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new nK(0xffffff),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let s3=new nn,s4=new ni,s5=new i4,s6=new iU;class s8 extends nI{constructor(e=new ro,i=new s2){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){let n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),s5.copy(n.boundingSphere),s5.applyMatrix4(r),s5.radius+=s,!1===e.ray.intersectsSphere(s5))return;s3.copy(r).invert(),s4.copy(e.ray).applyMatrix4(s3);let o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,h=n.index,u=n.attributes.position;if(null!==h){let n=Math.max(0,a.start),s=Math.min(h.count,a.start+a.count);for(let a=n;a<s;a++){let n=h.getX(a);s6.fromBufferAttribute(u,n),s7(s6,n,l,r,e,i,this)}}else{let n=Math.max(0,a.start),s=Math.min(u.count,a.start+a.count);for(let a=n;a<s;a++)s6.fromBufferAttribute(u,a),s7(s6,a,l,r,e,i,this)}}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let n=e[i[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++){let i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}function s7(e,i,n,r,s,a,o){let l=s4.distanceSqToPoint(e);if(l<n){let n=new iU;s4.closestPointToPoint(e,n),n.applyMatrix4(r);let h=s.ray.origin.distanceTo(n);if(h<s.near||h>s.far)return;a.push({distance:h,distanceToRay:Math.sqrt(l),point:n,index:i,face:null,faceIndex:null,barycoord:null,object:o})}}class s9 extends nI{constructor(){super(),this.isGroup=!0,this.type="Group"}}class ae extends iI{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=ex,this.minFilter=ex,this.generateMipmaps=!1,this.needsUpdate=!0}}class at extends iI{constructor(e,i,n,r,s,a,o,l,h,u=eH){if(u!==eH&&u!==eQ)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===eH&&(n=eL),void 0===n&&u===eQ&&(n=eU),super(null,r,s,a,o,l,u,n,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=void 0!==o?o:ex,this.minFilter=void 0!==l?l:ex,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let i=super.toJSON(e);return null!==this.compareFunction&&(i.compareFunction=this.compareFunction),i}}class ai{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){let n=this.getUtoTmapping(e);return this.getPoint(n,i)}getPoints(e=5){let i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return i}getSpacedPoints(e=5){let i=[];for(let n=0;n<=e;n++)i.push(this.getPointAt(n/e));return i}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let i=[],n,r=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=e;a++)i.push(s+=(n=this.getPoint(a/e)).distanceTo(r)),r=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){let n;let r=this.getLengths(),s=0,a=r.length;n=i||e*r[a-1];let o=0,l=a-1,h;for(;o<=l;)if((h=r[s=Math.floor(o+(l-o)/2)]-n)<0)o=s+1;else if(h>0)l=s-1;else{l=s;break}if(r[s=l]===n)return s/(a-1);let u=r[s],c=r[s+1];return(s+(n-u)/(c-u))/(a-1)}getTangent(e,i){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);let s=this.getPoint(n),a=this.getPoint(r),o=i||(s.isVector2?new ia:new iU);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,i){let n=this.getUtoTmapping(e);return this.getTangent(n,i)}computeFrenetFrames(e,i){let n=new iU,r=[],s=[],a=[],o=new iU,l=new nn;for(let i=0;i<=e;i++){let n=i/e;r[i]=this.getTangentAt(n,new iU)}s[0]=new iU,a[0]=new iU;let h=Number.MAX_VALUE,u=Math.abs(r[0].x),c=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=h&&(h=u,n.set(1,0,0)),c<=h&&(h=c,n.set(0,1,0)),d<=h&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],o),a[0].crossVectors(r[0],s[0]);for(let i=1;i<=e;i++){if(s[i]=s[i-1].clone(),a[i]=a[i-1].clone(),o.crossVectors(r[i-1],r[i]),o.length()>Number.EPSILON){o.normalize();let e=Math.acos(t9(r[i-1].dot(r[i]),-1,1));s[i].applyMatrix4(l.makeRotationAxis(o,e))}a[i].crossVectors(r[i],s[i])}if(!0===i){let i=Math.acos(t9(s[0].dot(s[e]),-1,1));i/=e,r[0].dot(o.crossVectors(s[0],s[e]))>0&&(i=-i);for(let n=1;n<=e;n++)s[n].applyMatrix4(l.makeRotationAxis(r[n],i*n)),a[n].crossVectors(r[n],s[n])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class an extends ai{constructor(e=0,i=0,n=1,r=1,s=0,a=2*Math.PI,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,i=new ia){let n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);let a=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let e=Math.cos(this.aRotation),i=Math.sin(this.aRotation),n=o-this.aX,r=l-this.aY;o=n*e-r*i+this.aX,l=n*i+r*e+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function ar(){let e=0,i=0,n=0,r=0;function s(s,a,o,l){e=s,i=o,n=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(e,i,n,r,a){s(i,n,a*(n-e),a*(r-i))},initNonuniformCatmullRom:function(e,i,n,r,a,o,l){let h=(i-e)/a-(n-e)/(a+o)+(n-i)/o,u=(n-i)/o-(r-i)/(o+l)+(r-n)/l;s(i,n,h*=o,u*=o)},calc:function(s){let a=s*s;return e+i*s+n*a+a*s*r}}}let as=new iU,aa=new ar,ao=new ar,al=new ar;function ah(e,i,n,r,s){let a=(r-i)*.5,o=(s-n)*.5,l=e*e;return e*l*(2*n-2*r+a+o)+(-3*n+3*r-2*a-o)*l+a*e+n}function au(e,i,n,r){return function(e,i){let n=1-e;return n*n*i}(e,i)+2*(1-e)*e*n+e*e*r}function ac(e,i,n,r,s){return function(e,i){let n=1-e;return n*n*n*i}(e,i)+function(e,i){let n=1-e;return 3*n*n*e*i}(e,n)+3*(1-e)*e*e*r+e*e*e*s}class ad extends ai{constructor(e=new ia,i=new ia,n=new ia,r=new ia){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=n,this.v3=r}getPoint(e,i=new ia){let n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(ac(e,n.x,r.x,s.x,a.x),ac(e,n.y,r.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ap extends ai{constructor(e=new iU,i=new iU,n=new iU,r=new iU){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=n,this.v3=r}getPoint(e,i=new iU){let n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(ac(e,n.x,r.x,s.x,a.x),ac(e,n.y,r.y,s.y,a.y),ac(e,n.z,r.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class af extends ai{constructor(e=new ia,i=new ia){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new ia){return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new ia){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class am extends ai{constructor(e=new ia,i=new ia,n=new ia){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new ia){let n=this.v0,r=this.v1,s=this.v2;return i.set(au(e,n.x,r.x,s.x),au(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ag extends ai{constructor(e=new iU,i=new iU,n=new iU){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new iU){let n=this.v0,r=this.v1,s=this.v2;return i.set(au(e,n.x,r.x,s.x),au(e,n.y,r.y,s.y),au(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class aA extends ai{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new ia){let n=this.points,r=(n.length-1)*e,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],h=n[s>n.length-2?n.length-1:s+1],u=n[s>n.length-3?n.length-1:s+2];return i.set(ah(a,o.x,l.x,h.x,u.x),ah(a,o.y,l.y,h.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){let n=this.points[i];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(new ia().fromArray(n))}return this}}var av=Object.freeze({__proto__:null,ArcCurve:class extends an{constructor(e,i,n,r,s,a){super(e,i,n,n,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends ai{constructor(e=[],i=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=n,this.tension=r}getPoint(e,i=new iU){let n,r;let s=this.points,a=s.length,o=(a-+!this.closed)*e,l=Math.floor(o),h=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a)+1)*a:0===h&&l===a-1&&(l=a-2,h=1),this.closed||l>0?n=s[(l-1)%a]:(as.subVectors(s[0],s[1]).add(s[0]),n=as);let u=s[l%a],c=s[(l+1)%a];if(this.closed||l+2<a?r=s[(l+2)%a]:(as.subVectors(s[a-1],s[a-2]).add(s[a-1]),r=as),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,i=Math.pow(n.distanceToSquared(u),e),s=Math.pow(u.distanceToSquared(c),e),a=Math.pow(c.distanceToSquared(r),e);s<1e-4&&(s=1),i<1e-4&&(i=s),a<1e-4&&(a=s),aa.initNonuniformCatmullRom(n.x,u.x,c.x,r.x,i,s,a),ao.initNonuniformCatmullRom(n.y,u.y,c.y,r.y,i,s,a),al.initNonuniformCatmullRom(n.z,u.z,c.z,r.z,i,s,a)}else"catmullrom"===this.curveType&&(aa.initCatmullRom(n.x,u.x,c.x,r.x,this.tension),ao.initCatmullRom(n.y,u.y,c.y,r.y,this.tension),al.initCatmullRom(n.z,u.z,c.z,r.z,this.tension));return i.set(aa.calc(h),ao.calc(h),al.calc(h)),i}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){let n=this.points[i];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){let n=e.points[i];this.points.push(new iU().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:ad,CubicBezierCurve3:ap,EllipseCurve:an,LineCurve:af,LineCurve3:class extends ai{constructor(e=new iU,i=new iU){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new iU){return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new iU){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:am,QuadraticBezierCurve3:ag,SplineCurve:aA});class ay extends ai{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){let n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new av[n](i,e))}return this}getPoint(e,i){let n=e*this.getLength(),r=this.getCurveLengths(),s=0;for(;s<r.length;){if(r[s]>=n){let e=r[s]-n,a=this.curves[s],o=a.getLength(),l=0===o?0:1-e/o;return a.getPointAt(l,i)}s++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],i=0;for(let n=0,r=this.curves.length;n<r;n++)e.push(i+=this.curves[n].getLength());return this.cacheLengths=e,e}getSpacedPoints(e=40){let i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){let i;let n=[];for(let r=0,s=this.curves;r<s.length;r++){let a=s[r],o=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let e=0;e<l.length;e++){let r=l[e];i&&i.equals(r)||(n.push(r),i=r)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let i=0,n=e.curves.length;i<n;i++){let n=e.curves[i];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,n=this.curves.length;i<n;i++){let n=this.curves[i];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,n=e.curves.length;i<n;i++){let n=e.curves[i];this.curves.push(new av[n.type]().fromJSON(n))}return this}}class ax extends ay{constructor(e){super(),this.type="Path",this.currentPoint=new ia,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,n=e.length;i<n;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){let n=new af(this.currentPoint.clone(),new ia(e,i));return this.curves.push(n),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,n,r){let s=new am(this.currentPoint.clone(),new ia(e,i),new ia(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,i,n,r,s,a){let o=new ad(this.currentPoint.clone(),new ia(e,i),new ia(n,r),new ia(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){let i=new aA([this.currentPoint.clone()].concat(e));return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,n,r,s,a){let o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,i+l,n,r,s,a),this}absarc(e,i,n,r,s,a){return this.absellipse(e,i,n,n,r,s,a),this}ellipse(e,i,n,r,s,a,o,l){let h=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+h,i+u,n,r,s,a,o,l),this}absellipse(e,i,n,r,s,a,o,l){let h=new an(e,i,n,r,s,a,o,l);if(this.curves.length>0){let e=h.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(h);let u=h.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class a_ extends ro{constructor(e=[new ia(0,-.5),new ia(.5,0),new ia(0,.5)],i=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:n,phiLength:r},i=Math.floor(i),r=t9(r,0,2*Math.PI);let s=[],a=[],o=[],l=[],h=[],u=1/i,c=new iU,d=new ia,p=new iU,f=new iU,m=new iU,g=0,A=0;for(let i=0;i<=e.length-1;i++)switch(i){case 0:g=e[i+1].x-e[i].x,A=e[i+1].y-e[i].y,p.x=+A,p.y=-g,p.z=0*A,m.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(m.x,m.y,m.z);break;default:g=e[i+1].x-e[i].x,A=e[i+1].y-e[i].y,p.x=+A,p.y=-g,p.z=0*A,f.copy(p),p.x+=m.x,p.y+=m.y,p.z+=m.z,p.normalize(),l.push(p.x,p.y,p.z),m.copy(f)}for(let s=0;s<=i;s++){let p=n+s*u*r,f=Math.sin(p),m=Math.cos(p);for(let n=0;n<=e.length-1;n++){c.x=e[n].x*f,c.y=e[n].y,c.z=e[n].x*m,a.push(c.x,c.y,c.z),d.x=s/i,d.y=n/(e.length-1),o.push(d.x,d.y);let r=l[3*n+0]*f,u=l[3*n+1],p=l[3*n+0]*m;h.push(r,u,p)}}for(let n=0;n<i;n++)for(let i=0;i<e.length-1;i++){let r=i+n*e.length,a=r+e.length,o=r+e.length+1,l=r+1;s.push(r,a,l),s.push(o,l,a)}this.setIndex(s),this.setAttribute("position",new n9(a,3)),this.setAttribute("uv",new n9(o,2)),this.setAttribute("normal",new n9(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a_(e.points,e.segments,e.phiStart,e.phiLength)}}class ab extends a_{constructor(e=1,i=1,n=4,r=8){let s=new ax;s.absarc(0,-i/2,e,1.5*Math.PI,0),s.absarc(0,i/2,e,0,.5*Math.PI),super(s.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:n,radialSegments:r}}static fromJSON(e){return new ab(e.radius,e.length,e.capSegments,e.radialSegments)}}class aE extends ro{constructor(e=1,i=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:n,thetaLength:r},i=Math.max(3,i);let s=[],a=[],o=[],l=[],h=new iU,u=new ia;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let s=0,c=3;s<=i;s++,c+=3){let d=n+s/i*r;h.x=e*Math.cos(d),h.y=e*Math.sin(d),a.push(h.x,h.y,h.z),o.push(0,0,1),u.x=(a[c]/e+1)/2,u.y=(a[c+1]/e+1)/2,l.push(u.x,u.y)}for(let e=1;e<=i;e++)s.push(e,e+1,0);this.setIndex(s),this.setAttribute("position",new n9(a,3)),this.setAttribute("normal",new n9(o,3)),this.setAttribute("uv",new n9(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aE(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class aw extends ro{constructor(e=1,i=1,n=1,r=32,s=1,a=!1,o=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};let h=this;r=Math.floor(r),s=Math.floor(s);let u=[],c=[],d=[],p=[],f=0,m=[],g=n/2,A=0;function v(n){let s=f,a=new ia,m=new iU,v=0,y=!0===n?e:i,x=!0===n?1:-1;for(let e=1;e<=r;e++)c.push(0,g*x,0),d.push(0,x,0),p.push(.5,.5),f++;let _=f;for(let e=0;e<=r;e++){let i=e/r*l+o,n=Math.cos(i),s=Math.sin(i);m.x=y*s,m.y=g*x,m.z=y*n,c.push(m.x,m.y,m.z),d.push(0,x,0),a.x=.5*n+.5,a.y=.5*s*x+.5,p.push(a.x,a.y),f++}for(let e=0;e<r;e++){let i=s+e,r=_+e;!0===n?u.push(r,r+1,i):u.push(r+1,r,i),v+=3}h.addGroup(A,v,!0===n?1:2),A+=v}(function(){let a=new iU,v=new iU,y=0,x=(i-e)/n;for(let h=0;h<=s;h++){let u=[],A=h/s,y=A*(i-e)+e;for(let e=0;e<=r;e++){let i=e/r,s=i*l+o,h=Math.sin(s),m=Math.cos(s);v.x=y*h,v.y=-A*n+g,v.z=y*m,c.push(v.x,v.y,v.z),a.set(h,x,m).normalize(),d.push(a.x,a.y,a.z),p.push(i,1-A),u.push(f++)}m.push(u)}for(let n=0;n<r;n++)for(let r=0;r<s;r++){let a=m[r][n],o=m[r+1][n],l=m[r+1][n+1],h=m[r][n+1];(e>0||0!==r)&&(u.push(a,o,h),y+=3),(i>0||r!==s-1)&&(u.push(o,l,h),y+=3)}h.addGroup(A,y,0),A+=y})(),!1===a&&(e>0&&v(!0),i>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new n9(c,3)),this.setAttribute("normal",new n9(d,3)),this.setAttribute("uv",new n9(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aw(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class aM extends aw{constructor(e=1,i=1,n=32,r=1,s=!1,a=0,o=2*Math.PI){super(0,e,i,n,r,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new aM(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class aC extends ro{constructor(e=[],i=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:n,detail:r};let s=[],a=[];function o(e){s.push(e.x,e.y,e.z)}function l(i,n){let r=3*i;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function h(e,i,n,r){r<0&&1===e.x&&(a[i]=e.x-1),0===n.x&&0===n.z&&(a[i]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}(function(e){let n=new iU,r=new iU,s=new iU;for(let a=0;a<i.length;a+=3)l(i[a+0],n),l(i[a+1],r),l(i[a+2],s),function(e,i,n,r){let s=r+1,a=[];for(let r=0;r<=s;r++){a[r]=[];let o=e.clone().lerp(n,r/s),l=i.clone().lerp(n,r/s),h=s-r;for(let e=0;e<=h;e++)0===e&&r===s?a[r][e]=o:a[r][e]=o.clone().lerp(l,e/h)}for(let e=0;e<s;e++)for(let i=0;i<2*(s-e)-1;i++){let n=Math.floor(i/2);i%2==0?(o(a[e][n+1]),o(a[e+1][n]),o(a[e][n])):(o(a[e][n+1]),o(a[e+1][n+1]),o(a[e+1][n]))}}(n,r,s,e)})(r),function(e){let i=new iU;for(let n=0;n<s.length;n+=3)i.x=s[n+0],i.y=s[n+1],i.z=s[n+2],i.normalize().multiplyScalar(e),s[n+0]=i.x,s[n+1]=i.y,s[n+2]=i.z}(n),function(){let e=new iU;for(let n=0;n<s.length;n+=3){var i;e.x=s[n+0],e.y=s[n+1],e.z=s[n+2];let r=u(e)/2/Math.PI+.5,o=Math.atan2(-(i=e).y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5;a.push(r,1-o)}(function(){let e=new iU,i=new iU,n=new iU,r=new iU,o=new ia,l=new ia,c=new ia;for(let d=0,p=0;d<s.length;d+=9,p+=6){e.set(s[d+0],s[d+1],s[d+2]),i.set(s[d+3],s[d+4],s[d+5]),n.set(s[d+6],s[d+7],s[d+8]),o.set(a[p+0],a[p+1]),l.set(a[p+2],a[p+3]),c.set(a[p+4],a[p+5]),r.copy(e).add(i).add(n).divideScalar(3);let f=u(r);h(o,p+0,e,f),h(l,p+2,i,f),h(c,p+4,n,f)}})(),function(){for(let e=0;e<a.length;e+=6){let i=a[e+0],n=a[e+2],r=a[e+4],s=Math.max(i,n,r),o=Math.min(i,n,r);s>.9&&o<.1&&(i<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new n9(s,3)),this.setAttribute("normal",new n9(s.slice(),3)),this.setAttribute("uv",new n9(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aC(e.vertices,e.indices,e.radius,e.details)}}class aS extends aC{constructor(e=1,i=0){let n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new aS(e.radius,e.detail)}}let aT=new iU,aR=new iU,aI=new iU,aB=new nH;class aL extends ax{constructor(e){super(e),this.uuid=t7(),this.type="Shape",this.holes=[]}getPointsHoles(e){let i=[];for(let n=0,r=this.holes.length;n<r;n++)i[n]=this.holes[n].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,n=e.holes.length;i<n;i++){let n=e.holes[i];this.holes.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,n=this.holes.length;i<n;i++){let n=this.holes[i];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,n=e.holes.length;i<n;i++){let n=e.holes[i];this.holes.push(new ax().fromJSON(n))}return this}}let aP=function(e,i,n=2){let r,s,a,o,l,h,u;let c=i&&i.length,d=c?i[0]*n:e.length,p=aD(e,0,d,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(e,i,n,r){let s,a,o,l,h;let u=[];for(s=0,a=i.length;s<a;s++)o=i[s]*r,l=s<a-1?i[s+1]*r:e.length,(h=aD(e,o,l,r,!1))===h.next&&(h.steiner=!0),u.push(function(e){let i=e,n=e;do(i.x<n.x||i.x===n.x&&i.y<n.y)&&(n=i),i=i.next;while(i!==e);return n}(h));for(u.sort(aO),s=0;s<u.length;s++)n=function(e,i){let n=function(e,i){let n=i,r=-1/0,s,a=e.x,o=e.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){let e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=a&&e>r&&(r=e,s=n.x<n.next.x?n:n.next,e===a))return s}n=n.next}while(n!==i);if(!s)return null;let l=s,h=s.x,u=s.y,c=1/0,d;n=s;do{var p,f;a>=n.x&&n.x>=h&&a!==n.x&&ak(o<u?a:r,o,h,u,o<u?r:a,o,n.x,n.y)&&(d=Math.abs(o-n.y)/(a-n.x),aH(n,e)&&(d<c||d===c&&(n.x>s.x||n.x===s.x&&(p=s,f=n,0>aF(p.prev,p,f.prev)&&0>aF(f.next,p,p.next))))&&(s=n,c=d)),n=n.next}while(n!==l);return s}(e,i);if(!n)return i;let r=aQ(n,e);return aN(r,r.next),aN(n,n.next)}(u[s],n);return n}(e,i,p,n)),e.length>80*n){r=a=e[0],s=o=e[1];for(let i=n;i<d;i+=n)l=e[i],h=e[i+1],l<r&&(r=l),h<s&&(s=h),l>a&&(a=l),h>o&&(o=h);u=0!==(u=Math.max(a-r,o-s))?32767/u:0}return function e(i,n,r,s,a,o,l){if(!i)return;!l&&o&&function(e,i,n,r){let s=e;do 0===s.z&&(s.z=aU(s.x,s.y,i,n,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let i,n,r,s,a,o,l,h,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,l=0,i=0;i<u&&(l++,r=r.nextZ);i++);for(h=u;l>0||h>0&&r;)0!==l&&(0===h||!r||n.z<=r.z)?(s=n,n=n.nextZ,l--):(s=r,r=r.nextZ,h--),a?a.nextZ=s:e=s,s.prevZ=a,a=s;n=r}a.nextZ=null,u*=2}while(o>1)}(s)}(i,s,a,o);let h=i,u,c;for(;i.prev!==i.next;){if(u=i.prev,c=i.next,o?function(e,i,n,r){let s=e.prev,a=e.next;if(aF(s,e,a)>=0)return!1;let o=s.x,l=e.x,h=a.x,u=s.y,c=e.y,d=a.y,p=o<l?o<h?o:h:l<h?l:h,f=u<c?u<d?u:d:c<d?c:d,m=o>l?o>h?o:h:l>h?l:h,g=u>c?u>d?u:d:c>d?c:d,A=aU(p,f,i,n,r),v=aU(m,g,i,n,r),y=e.prevZ,x=e.nextZ;for(;y&&y.z>=A&&x&&x.z<=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==s&&y!==a&&ak(o,u,l,c,h,d,y.x,y.y)&&aF(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==a&&ak(o,u,l,c,h,d,x.x,x.y)&&aF(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=A;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==s&&y!==a&&ak(o,u,l,c,h,d,y.x,y.y)&&aF(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==a&&ak(o,u,l,c,h,d,x.x,x.y)&&aF(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}(i,s,a,o):function(e){let i=e.prev,n=e.next;if(aF(i,e,n)>=0)return!1;let r=i.x,s=e.x,a=n.x,o=i.y,l=e.y,h=n.y,u=r<s?r<a?r:a:s<a?s:a,c=o<l?o<h?o:h:l<h?l:h,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>h?o:h:l>h?l:h,f=n.next;for(;f!==i;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&ak(r,o,s,l,a,h,f.x,f.y)&&aF(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}(i)){n.push(u.i/r|0),n.push(i.i/r|0),n.push(c.i/r|0),aq(i),i=c.next,h=c.next;continue}if((i=c)===h){l?1===l?e(i=function(e,i,n){let r=e;do{let s=r.prev,a=r.next.next;!az(s,a)&&aG(s,r,r.next,a)&&aH(s,a)&&aH(a,s)&&(i.push(s.i/n|0),i.push(r.i/n|0),i.push(a.i/n|0),aq(r),aq(r.next),r=e=a),r=r.next}while(r!==e);return aN(r)}(aN(i),n,r),n,r,s,a,o,2):2===l&&function(i,n,r,s,a,o){let l=i;do{let i=l.next.next;for(;i!==l.prev;){var h,u;if(l.i!==i.i&&(h=l,u=i,h.next.i!==u.i&&h.prev.i!==u.i&&!function(e,i){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==i.i&&n.next.i!==i.i&&aG(n,n.next,e,i))return!0;n=n.next}while(n!==e);return!1}(h,u)&&(aH(h,u)&&aH(u,h)&&function(e,i){let n=e,r=!1,s=(e.x+i.x)/2,a=(e.y+i.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&s<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}(h,u)&&(aF(h.prev,h,u.prev)||aF(h,u.prev,u))||az(h,u)&&aF(h.prev,h,h.next)>0&&aF(u.prev,u,u.next)>0))){let h=aQ(l,i);l=aN(l,l.next),h=aN(h,h.next),e(l,n,r,s,a,o,0),e(h,n,r,s,a,o,0);return}i=i.next}l=l.next}while(l!==i)}(i,n,r,s,a,o):e(aN(i),n,r,s,a,o,1);break}}}(p,f,n,r,s,u,0),f};function aD(e,i,n,r,s){let a,o;if(s===function(e,i,n,r){let s=0;for(let a=i,o=n-r;a<n;a+=r)s+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return s}(e,i,n,r)>0)for(a=i;a<n;a+=r)o=aW(a,e[a],e[a+1],o);else for(a=n-r;a>=i;a-=r)o=aW(a,e[a],e[a+1],o);return o&&az(o,o.next)&&(aq(o),o=o.next),o}function aN(e,i){if(!e)return e;i||(i=e);let n=e,r;do if(r=!1,!n.steiner&&(az(n,n.next)||0===aF(n.prev,n,n.next))){if(aq(n),(n=i=n.prev)===n.next)break;r=!0}else n=n.next;while(r||n!==i);return i}function aO(e,i){return e.x-i.x}function aU(e,i,n,r,s){return(e=((e=((e=((e=((e=(e-n)*s|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(i=((i=((i=((i=((i=(i-r)*s|0)|i<<8)&0xff00ff)|i<<4)&0xf0f0f0f)|i<<2)&0x33333333)|i<<1)&0x55555555)<<1}function ak(e,i,n,r,s,a,o,l){return(s-o)*(i-l)>=(e-o)*(a-l)&&(e-o)*(r-l)>=(n-o)*(i-l)&&(n-o)*(a-l)>=(s-o)*(r-l)}function aF(e,i,n){return(i.y-e.y)*(n.x-i.x)-(i.x-e.x)*(n.y-i.y)}function az(e,i){return e.x===i.x&&e.y===i.y}function aG(e,i,n,r){let s=aj(aF(e,i,n)),a=aj(aF(e,i,r)),o=aj(aF(n,r,e)),l=aj(aF(n,r,i));return!!(s!==a&&o!==l||0===s&&aV(e,n,i)||0===a&&aV(e,r,i)||0===o&&aV(n,e,r)||0===l&&aV(n,i,r))}function aV(e,i,n){return i.x<=Math.max(e.x,n.x)&&i.x>=Math.min(e.x,n.x)&&i.y<=Math.max(e.y,n.y)&&i.y>=Math.min(e.y,n.y)}function aj(e){return e>0?1:e<0?-1:0}function aH(e,i){return 0>aF(e.prev,e,e.next)?aF(e,i,e.next)>=0&&aF(e,e.prev,i)>=0:0>aF(e,i,e.prev)||0>aF(e,e.next,i)}function aQ(e,i){let n=new aX(e.i,e.x,e.y),r=new aX(i.i,i.x,i.y),s=e.next,a=i.prev;return e.next=i,i.prev=e,n.next=s,s.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function aW(e,i,n,r){let s=new aX(e,i,n);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function aq(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function aX(e,i,n){this.i=e,this.x=i,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class aK{static area(e){let i=e.length,n=0;for(let r=i-1,s=0;s<i;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return .5*n}static isClockWise(e){return 0>aK.area(e)}static triangulateShape(e,i){let n=[],r=[],s=[];aY(e),aJ(n,e);let a=e.length;i.forEach(aY);for(let e=0;e<i.length;e++)r.push(a),a+=i[e].length,aJ(n,i[e]);let o=aP(n,r);for(let e=0;e<o.length;e+=3)s.push(o.slice(e,e+3));return s}}function aY(e){let i=e.length;i>2&&e[i-1].equals(e[0])&&e.pop()}function aJ(e,i){for(let n=0;n<i.length;n++)e.push(i[n].x),e.push(i[n].y)}class aZ extends ro{constructor(e=new aL([new ia(.5,.5),new ia(-.5,.5),new ia(-.5,-.5),new ia(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];let n=this,r=[],s=[];for(let a=0,o=e.length;a<o;a++)!function(e){let a,o,l,h;let u=[],c=void 0!==i.curveSegments?i.curveSegments:12,d=void 0!==i.steps?i.steps:1,p=void 0!==i.depth?i.depth:1,f=void 0===i.bevelEnabled||i.bevelEnabled,m=void 0!==i.bevelThickness?i.bevelThickness:.2,g=void 0!==i.bevelSize?i.bevelSize:m-.1,A=void 0!==i.bevelOffset?i.bevelOffset:0,v=void 0!==i.bevelSegments?i.bevelSegments:3,y=i.extrudePath,x=void 0!==i.UVGenerator?i.UVGenerator:a$,_,b=!1;y&&(_=y.getSpacedPoints(d),b=!0,f=!1,a=y.computeFrenetFrames(d,!1),o=new iU,l=new iU,h=new iU),f||(v=0,m=0,g=0,A=0);let E=e.extractPoints(c),w=E.shape,M=E.holes;if(!aK.isClockWise(w)){w=w.reverse();for(let e=0,i=M.length;e<i;e++){let i=M[e];aK.isClockWise(i)&&(M[e]=i.reverse())}}let C=aK.triangulateShape(w,M),S=w;for(let e=0,i=M.length;e<i;e++){let i=M[e];w=w.concat(i)}function T(e,i,n){return i||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(i,n)}let R=w.length,I=C.length;function B(e,i,n){let r,s,a;let o=e.x-i.x,l=e.y-i.y,h=n.x-e.x,u=n.y-e.y,c=o*o+l*l;if(Math.abs(o*u-l*h)>Number.EPSILON){let d=Math.sqrt(c),p=Math.sqrt(h*h+u*u),f=i.x-l/d,m=i.y+o/d,g=((n.x-u/p-f)*u-(n.y+h/p-m)*h)/(o*u-l*h),A=(r=f+o*g-e.x)*r+(s=m+l*g-e.y)*s;if(A<=2)return new ia(r,s);a=Math.sqrt(A/2)}else{let e=!1;o>Number.EPSILON?h>Number.EPSILON&&(e=!0):o<-Number.EPSILON?h<-Number.EPSILON&&(e=!0):Math.sign(l)===Math.sign(u)&&(e=!0),e?(r=-l,s=o,a=Math.sqrt(c)):(r=o,s=l,a=Math.sqrt(c/2))}return new ia(r/a,s/a)}let L=[];for(let e=0,i=S.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),L[e]=B(S[e],S[n],S[r]);let P=[],D,N=L.concat();for(let e=0,i=M.length;e<i;e++){let i=M[e];D=[];for(let e=0,n=i.length,r=n-1,s=e+1;e<n;e++,r++,s++)r===n&&(r=0),s===n&&(s=0),D[e]=B(i[e],i[r],i[s]);P.push(D),N=N.concat(D)}for(let e=0;e<v;e++){let i=e/v,n=m*Math.cos(i*Math.PI/2),r=g*Math.sin(i*Math.PI/2)+A;for(let e=0,i=S.length;e<i;e++){let i=T(S[e],L[e],r);k(i.x,i.y,-n)}for(let e=0,i=M.length;e<i;e++){let i=M[e];D=P[e];for(let e=0,s=i.length;e<s;e++){let s=T(i[e],D[e],r);k(s.x,s.y,-n)}}}let O=g+A;for(let e=0;e<R;e++){let i=f?T(w[e],N[e],O):w[e];b?(l.copy(a.normals[0]).multiplyScalar(i.x),o.copy(a.binormals[0]).multiplyScalar(i.y),h.copy(_[0]).add(l).add(o),k(h.x,h.y,h.z)):k(i.x,i.y,0)}for(let e=1;e<=d;e++)for(let i=0;i<R;i++){let n=f?T(w[i],N[i],O):w[i];b?(l.copy(a.normals[e]).multiplyScalar(n.x),o.copy(a.binormals[e]).multiplyScalar(n.y),h.copy(_[e]).add(l).add(o),k(h.x,h.y,h.z)):k(n.x,n.y,p/d*e)}for(let e=v-1;e>=0;e--){let i=e/v,n=m*Math.cos(i*Math.PI/2),r=g*Math.sin(i*Math.PI/2)+A;for(let e=0,i=S.length;e<i;e++){let i=T(S[e],L[e],r);k(i.x,i.y,p+n)}for(let e=0,i=M.length;e<i;e++){let i=M[e];D=P[e];for(let e=0,s=i.length;e<s;e++){let s=T(i[e],D[e],r);b?k(s.x,s.y+_[d-1].y,_[d-1].x+n):k(s.x,s.y,p+n)}}}function U(e,i){let s=e.length;for(;--s>=0;){let a=s,o=s-1;o<0&&(o=e.length-1);for(let e=0,s=d+2*v;e<s;e++){let s=R*e,l=R*(e+1);!function(e,i,s,a){z(e),z(i),z(a),z(i),z(s),z(a);let o=r.length/3,l=x.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);G(l[0]),G(l[1]),G(l[3]),G(l[1]),G(l[2]),G(l[3])}(i+a+s,i+o+s,i+o+l,i+a+l)}}}function k(e,i,n){u.push(e),u.push(i),u.push(n)}function F(e,i,s){z(e),z(i),z(s);let a=r.length/3,o=x.generateTopUV(n,r,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[2])}function z(e){r.push(u[3*e+0]),r.push(u[3*e+1]),r.push(u[3*e+2])}function G(e){s.push(e.x),s.push(e.y)}(function(){let e=r.length/3;if(f){let e=0,i=0*R;for(let e=0;e<I;e++){let n=C[e];F(n[2]+i,n[1]+i,n[0]+i)}i=R*(d+2*v);for(let e=0;e<I;e++){let n=C[e];F(n[0]+i,n[1]+i,n[2]+i)}}else{for(let e=0;e<I;e++){let i=C[e];F(i[2],i[1],i[0])}for(let e=0;e<I;e++){let i=C[e];F(i[0]+R*d,i[1]+R*d,i[2]+R*d)}}n.addGroup(e,r.length/3-e,0)})(),function(){let e=r.length/3,i=0;U(S,0),i+=S.length;for(let e=0,n=M.length;e<n;e++){let n=M[e];U(n,i),i+=n.length}n.addGroup(e,r.length/3-e,1)}()}(e[a]);this.setAttribute("position",new n9(r,3)),this.setAttribute("uv",new n9(s,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,i,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){let r=e[i];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},i),void 0!==i.extrudePath&&(n.options.extrudePath=i.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,i){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let s=i[e.shapes[r]];n.push(s)}let r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=new av[r.type]().fromJSON(r)),new aZ(n,e.options)}}let a$={generateTopUV:function(e,i,n,r,s){let a=i[3*n],o=i[3*n+1],l=i[3*r],h=i[3*r+1],u=i[3*s],c=i[3*s+1];return[new ia(a,o),new ia(l,h),new ia(u,c)]},generateSideWallUV:function(e,i,n,r,s,a){let o=i[3*n],l=i[3*n+1],h=i[3*n+2],u=i[3*r],c=i[3*r+1],d=i[3*r+2],p=i[3*s],f=i[3*s+1],m=i[3*s+2],g=i[3*a],A=i[3*a+1],v=i[3*a+2];return Math.abs(l-c)<Math.abs(o-u)?[new ia(o,1-h),new ia(u,1-d),new ia(p,1-m),new ia(g,1-v)]:[new ia(l,1-h),new ia(c,1-d),new ia(f,1-m),new ia(A,1-v)]}};class a0 extends aC{constructor(e=1,i=0){let n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new a0(e.radius,e.detail)}}class a1 extends aC{constructor(e=1,i=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new a1(e.radius,e.detail)}}class a2 extends ro{constructor(e=1,i=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:n,heightSegments:r};let s=e/2,a=i/2,o=Math.floor(n),l=Math.floor(r),h=o+1,u=l+1,c=e/o,d=i/l,p=[],f=[],m=[],g=[];for(let e=0;e<u;e++){let i=e*d-a;for(let n=0;n<h;n++){let r=n*c-s;f.push(r,-i,0),m.push(0,0,1),g.push(n/o),g.push(1-e/l)}}for(let e=0;e<l;e++)for(let i=0;i<o;i++){let n=i+h*e,r=i+h*(e+1),s=i+1+h*(e+1),a=i+1+h*e;p.push(n,r,a),p.push(r,s,a)}this.setIndex(p),this.setAttribute("position",new n9(f,3)),this.setAttribute("normal",new n9(m,3)),this.setAttribute("uv",new n9(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a2(e.width,e.height,e.widthSegments,e.heightSegments)}}class a3 extends ro{constructor(e=.5,i=1,n=32,r=1,s=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:a},n=Math.max(3,n);let o=[],l=[],h=[],u=[],c=e,d=(i-e)/(r=Math.max(1,r)),p=new iU,f=new ia;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){let r=s+e/n*a;p.x=c*Math.cos(r),p.y=c*Math.sin(r),l.push(p.x,p.y,p.z),h.push(0,0,1),f.x=(p.x/i+1)/2,f.y=(p.y/i+1)/2,u.push(f.x,f.y)}c+=d}for(let e=0;e<r;e++){let i=e*(n+1);for(let e=0;e<n;e++){let r=e+i,s=r+n+1,a=r+n+2,l=r+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new n9(l,3)),this.setAttribute("normal",new n9(h,3)),this.setAttribute("uv",new n9(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a3(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class a4 extends ro{constructor(e=new aL([new ia(0,.5),new ia(-.5,-.5),new ia(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};let n=[],r=[],s=[],a=[],o=0,l=0;if(!1===Array.isArray(e))h(e);else for(let i=0;i<e.length;i++)h(e[i]),this.addGroup(o,l,i),o+=l,l=0;function h(e){let o=r.length/3,h=e.extractPoints(i),u=h.shape,c=h.holes;!1===aK.isClockWise(u)&&(u=u.reverse());for(let e=0,i=c.length;e<i;e++){let i=c[e];!0===aK.isClockWise(i)&&(c[e]=i.reverse())}let d=aK.triangulateShape(u,c);for(let e=0,i=c.length;e<i;e++){let i=c[e];u=u.concat(i)}for(let e=0,i=u.length;e<i;e++){let i=u[e];r.push(i.x,i.y,0),s.push(0,0,1),a.push(i.x,i.y)}for(let e=0,i=d.length;e<i;e++){let i=d[e],r=i[0]+o,s=i[1]+o,a=i[2]+o;n.push(r,s,a),l+=3}}this.setIndex(n),this.setAttribute("position",new n9(r,3)),this.setAttribute("normal",new n9(s,3)),this.setAttribute("uv",new n9(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,i){if(i.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){let r=e[n];i.shapes.push(r.uuid)}else i.shapes.push(e.uuid);return i}(this.parameters.shapes,e)}static fromJSON(e,i){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let s=i[e.shapes[r]];n.push(s)}return new a4(n,e.curveSegments)}}class a5 extends ro{constructor(e=1,i=32,n=16,r=0,s=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:r,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));let l=Math.min(a+o,Math.PI),h=0,u=[],c=new iU,d=new iU,p=[],f=[],m=[],g=[];for(let p=0;p<=n;p++){let A=[],v=p/n,y=0;0===p&&0===a?y=.5/i:p===n&&l===Math.PI&&(y=-.5/i);for(let n=0;n<=i;n++){let l=n/i;c.x=-e*Math.cos(r+l*s)*Math.sin(a+v*o),c.y=e*Math.cos(a+v*o),c.z=e*Math.sin(r+l*s)*Math.sin(a+v*o),f.push(c.x,c.y,c.z),d.copy(c).normalize(),m.push(d.x,d.y,d.z),g.push(l+y,1-v),A.push(h++)}u.push(A)}for(let e=0;e<n;e++)for(let r=0;r<i;r++){let i=u[e][r+1],s=u[e][r],o=u[e+1][r],h=u[e+1][r+1];(0!==e||a>0)&&p.push(i,s,h),(e!==n-1||l<Math.PI)&&p.push(s,o,h)}this.setIndex(p),this.setAttribute("position",new n9(f,3)),this.setAttribute("normal",new n9(m,3)),this.setAttribute("uv",new n9(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a5(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class a6 extends aC{constructor(e=1,i=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new a6(e.radius,e.detail)}}class a8 extends ro{constructor(e=1,i=.4,n=12,r=48,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);let a=[],o=[],l=[],h=[],u=new iU,c=new iU,d=new iU;for(let a=0;a<=n;a++)for(let p=0;p<=r;p++){let f=p/r*s,m=a/n*Math.PI*2;c.x=(e+i*Math.cos(m))*Math.cos(f),c.y=(e+i*Math.cos(m))*Math.sin(f),c.z=i*Math.sin(m),o.push(c.x,c.y,c.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),d.subVectors(c,u).normalize(),l.push(d.x,d.y,d.z),h.push(p/r),h.push(a/n)}for(let e=1;e<=n;e++)for(let i=1;i<=r;i++){let n=(r+1)*e+i-1,s=(r+1)*(e-1)+i-1,o=(r+1)*(e-1)+i,l=(r+1)*e+i;a.push(n,s,l),a.push(s,o,l)}this.setIndex(a),this.setAttribute("position",new n9(o,3)),this.setAttribute("normal",new n9(l,3)),this.setAttribute("uv",new n9(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a8(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class a7 extends ro{constructor(e=1,i=.4,n=64,r=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:n,radialSegments:r,p:s,q:a},n=Math.floor(n),r=Math.floor(r);let o=[],l=[],h=[],u=[],c=new iU,d=new iU,p=new iU,f=new iU,m=new iU,g=new iU,A=new iU;for(let o=0;o<=n;++o){let y=o/n*s*Math.PI*2;v(y,s,a,e,p),v(y+.01,s,a,e,f),g.subVectors(f,p),A.addVectors(f,p),m.crossVectors(g,A),A.crossVectors(m,g),m.normalize(),A.normalize();for(let e=0;e<=r;++e){let s=e/r*Math.PI*2,a=-i*Math.cos(s),f=i*Math.sin(s);c.x=p.x+(a*A.x+f*m.x),c.y=p.y+(a*A.y+f*m.y),c.z=p.z+(a*A.z+f*m.z),l.push(c.x,c.y,c.z),d.subVectors(c,p).normalize(),h.push(d.x,d.y,d.z),u.push(o/n),u.push(e/r)}}for(let e=1;e<=n;e++)for(let i=1;i<=r;i++){let n=(r+1)*(e-1)+(i-1),s=(r+1)*e+(i-1),a=(r+1)*e+i,l=(r+1)*(e-1)+i;o.push(n,s,l),o.push(s,a,l)}function v(e,i,n,r,s){let a=Math.cos(e),o=Math.sin(e),l=n/i*e,h=Math.cos(l);s.x=r*(2+h)*.5*a,s.y=r*(2+h)*o*.5,s.z=r*Math.sin(l)*.5}this.setIndex(o),this.setAttribute("position",new n9(l,3)),this.setAttribute("normal",new n9(h,3)),this.setAttribute("uv",new n9(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a7(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class a9 extends ro{constructor(e=new ag(new iU(-1,-1,0),new iU(-1,1,0),new iU(1,1,0)),i=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:n,radialSegments:r,closed:s};let a=e.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let o=new iU,l=new iU,h=new ia,u=new iU,c=[],d=[],p=[],f=[];function m(s){u=e.getPointAt(s/i,u);let h=a.normals[s],p=a.binormals[s];for(let e=0;e<=r;e++){let i=e/r*Math.PI*2,s=Math.sin(i),a=-Math.cos(i);l.x=a*h.x+s*p.x,l.y=a*h.y+s*p.y,l.z=a*h.z+s*p.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+n*l.x,o.y=u.y+n*l.y,o.z=u.z+n*l.z,c.push(o.x,o.y,o.z)}}(function(){for(let e=0;e<i;e++)m(e);m(!1===s?i:0),function(){for(let e=0;e<=i;e++)for(let n=0;n<=r;n++)h.x=e/i,h.y=n/r,p.push(h.x,h.y)}(),function(){for(let e=1;e<=i;e++)for(let i=1;i<=r;i++){let n=(r+1)*(e-1)+(i-1),s=(r+1)*e+(i-1),a=(r+1)*e+i,o=(r+1)*(e-1)+i;f.push(n,s,o),f.push(s,a,o)}}()})(),this.setIndex(f),this.setAttribute("position",new n9(c,3)),this.setAttribute("normal",new n9(d,3)),this.setAttribute("uv",new n9(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new a9(new av[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}function oe(e,i,n){let r=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`,s=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(s)&&(n.add(r),n.add(s),!0)}var ot=Object.freeze({__proto__:null,BoxGeometry:r_,CapsuleGeometry:ab,CircleGeometry:aE,ConeGeometry:aM,CylinderGeometry:aw,DodecahedronGeometry:aS,EdgesGeometry:class extends ro{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},null!==e){let n=Math.cos(t6*i),r=e.getIndex(),s=e.getAttribute("position"),a=r?r.count:s.count,o=[0,0,0],l=["a","b","c"],h=[,,,],u={},c=[];for(let e=0;e<a;e+=3){r?(o[0]=r.getX(e),o[1]=r.getX(e+1),o[2]=r.getX(e+2)):(o[0]=e,o[1]=e+1,o[2]=e+2);let{a:i,b:a,c:d}=aB;if(i.fromBufferAttribute(s,o[0]),a.fromBufferAttribute(s,o[1]),d.fromBufferAttribute(s,o[2]),aB.getNormal(aI),h[0]=`${Math.round(1e4*i.x)},${Math.round(1e4*i.y)},${Math.round(1e4*i.z)}`,h[1]=`${Math.round(1e4*a.x)},${Math.round(1e4*a.y)},${Math.round(1e4*a.z)}`,h[2]=`${Math.round(1e4*d.x)},${Math.round(1e4*d.y)},${Math.round(1e4*d.z)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){let i=(e+1)%3,r=h[e],s=h[i],a=aB[l[e]],d=aB[l[i]],p=`${r}_${s}`,f=`${s}_${r}`;f in u&&u[f]?(aI.dot(u[f].normal)<=n&&(c.push(a.x,a.y,a.z),c.push(d.x,d.y,d.z)),u[f]=null):p in u||(u[p]={index0:o[e],index1:o[i],normal:aI.clone()})}}for(let e in u)if(u[e]){let{index0:i,index1:n}=u[e];aT.fromBufferAttribute(s,i),aR.fromBufferAttribute(s,n),c.push(aT.x,aT.y,aT.z),c.push(aR.x,aR.y,aR.z)}this.setAttribute("position",new n9(c,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}},ExtrudeGeometry:aZ,IcosahedronGeometry:a0,LatheGeometry:a_,OctahedronGeometry:a1,PlaneGeometry:a2,PolyhedronGeometry:aC,RingGeometry:a3,ShapeGeometry:a4,SphereGeometry:a5,TetrahedronGeometry:a6,TorusGeometry:a8,TorusKnotGeometry:a7,TubeGeometry:a9,WireframeGeometry:class extends ro{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){let i=[],n=new Set,r=new iU,s=new iU;if(null!==e.index){let a=e.attributes.position,o=e.index,l=e.groups;0===l.length&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,h=l.length;e<h;++e){let h=l[e],u=h.start,c=h.count;for(let e=u,l=u+c;e<l;e+=3)for(let l=0;l<3;l++){let h=o.getX(e+l),u=o.getX(e+(l+1)%3);r.fromBufferAttribute(a,h),s.fromBufferAttribute(a,u),!0===oe(r,s,n)&&(i.push(r.x,r.y,r.z),i.push(s.x,s.y,s.z))}}}else{let a=e.attributes.position;for(let e=0,o=a.count/3;e<o;e++)for(let o=0;o<3;o++){let l=3*e+o,h=3*e+(o+1)%3;r.fromBufferAttribute(a,l),s.fromBufferAttribute(a,h),!0===oe(r,s,n)&&(i.push(r.x,r.y,r.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new n9(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}});class oi extends nZ{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new nK(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class on extends rC{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class or extends nZ{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new nK(0xffffff),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nK(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=t_,this.normalScale=new ia(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new np,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class os extends or{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ia(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return t9(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new nK(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new nK(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new nK(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class oa extends nZ{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new nK(0xffffff),this.specular=new nK(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nK(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=t_,this.normalScale=new ia(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new np,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class oo extends nZ{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new nK(0xffffff),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nK(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=t_,this.normalScale=new ia(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class ol extends nZ{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=t_,this.normalScale=new ia(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class oh extends nZ{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new nK(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nK(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=t_,this.normalScale=new ia(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new np,this.combine=$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ou extends nZ{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class oc extends nZ{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class od extends nZ{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new nK(0xffffff),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=t_,this.normalScale=new ia(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class op extends sV{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function of(e,i,n){return e&&(n||e.constructor!==i)?"number"==typeof i.BYTES_PER_ELEMENT?new i(e):Array.prototype.slice.call(e):e}function om(e,i,n){let r=e.length,s=new e.constructor(r);for(let a=0,o=0;o!==r;++a){let r=n[a]*i;for(let n=0;n!==i;++n)s[o++]=e[r+n]}return s}function og(e,i,n,r){let s=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[s++];if(void 0===a)return;let o=a[r];if(void 0!==o){if(Array.isArray(o))do void 0!==(o=a[r])&&(i.push(a.time),n.push.apply(n,o)),a=e[s++];while(void 0!==a);else if(void 0!==o.toArray)do void 0!==(o=a[r])&&(i.push(a.time),o.toArray(n,n.length)),a=e[s++];while(void 0!==a);else do void 0!==(o=a[r])&&(i.push(a.time),n.push(o)),a=e[s++];while(void 0!==a)}}class oA{constructor(e,i,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new i.constructor(n),this.sampleValues=i,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let i=this.parameterPositions,n=this._cachedIndex,r=i[n],s=i[n-1];e:{t:{let a;i:{n:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<s)break n;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,e<(r=i[++n]))break t}a=i.length;break i}if(!(e>=s)){let o=i[1];e<o&&(n=2,s=o);for(let a=n-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=s,e>=(s=i[--n-1]))break t}a=n,n=0;break i}break e}for(;n<a;){let r=n+a>>>1;e<i[r]?a=r:n=r+1}if(r=i[n],void 0===(s=i[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let e=0;e!==r;++e)i[e]=n[s+e];return i}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}class ov extends oA{constructor(e,i,n,r){super(e,i,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,i,n){let r=this.parameterPositions,s=e-2,a=e+1,o=r[s],l=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:s=e,o=2*i-n;break;case 2402:s=r.length-2,o=i+r[s]-r[s+1];break;default:s=e,o=n}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:a=e,l=2*n-i;break;case 2402:a=1,l=n+r[1]-r[0];break;default:a=e-1,l=i}let h=(n-i)*.5,u=this.valueSize;this._weightPrev=h/(i-o),this._weightNext=h/(l-n),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,u=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(n-i)/(r-i),m=f*f,g=m*f,A=-d*g+2*d*m-d*f,v=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*f+1,y=(-1-p)*g+(1.5+p)*m+.5*f,x=p*g-p*m;for(let e=0;e!==o;++e)s[e]=A*a[u+e]+v*a[h+e]+y*a[l+e]+x*a[c+e];return s}}class oy extends oA{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,u=(n-i)/(r-i),c=1-u;for(let e=0;e!==o;++e)s[e]=a[h+e]*c+a[l+e]*u;return s}}class ox extends oA{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class o_{constructor(e,i,n,r){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===i||0===i.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=of(i,this.TimeBufferType),this.values=of(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let i;let n=e.constructor;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:of(e.times,Array),values:of(e.values,Array)};let n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new ox(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new oy(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new ov(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case 2300:i=this.InterpolantFactoryMethodDiscrete;break;case 2301:i=this.InterpolantFactoryMethodLinear;break;case 2302:i=this.InterpolantFactoryMethodSmooth}if(void 0===i){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(i)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]+=e}return this}scale(e){if(1!==e){let i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]*=e}return this}trim(e,i){let n=this.times,r=n.length,s=0,a=r-1;for(;s!==r&&n[s]<e;)++s;for(;-1!==a&&n[a]>i;)--a;if(++a,0!==s||a!==r){s>=a&&(s=(a=Math.max(a,1))-1);let e=this.getValueSize();this.times=n.slice(s,a),this.values=this.values.slice(s*e,a*e)}return this}validate(){let e=!0,i=this.getValueSize();i-Math.floor(i)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,r=this.values,s=n.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let i=0;i!==s;i++){let r=n[i];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,i,r),e=!1;break}if(null!==a&&a>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,i,r,a),e=!1;break}a=r}if(void 0!==r){if(ArrayBuffer.isView(r)&&!(r instanceof DataView))for(let i=0,n=r.length;i!==n;++i){let n=r[i];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,i,n),e=!1;break}}}return e}optimize(){let e=this.times.slice(),i=this.values.slice(),n=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1,a=1;for(let o=1;o<s;++o){let s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0])){if(r)s=!0;else{let e=o*n,r=e-n,a=e+n;for(let o=0;o!==n;++o){let n=i[e+o];if(n!==i[r+o]||n!==i[a+o]){s=!0;break}}}}if(s){if(o!==a){e[a]=e[o];let r=o*n,s=a*n;for(let e=0;e!==n;++e)i[s+e]=i[r+e]}++a}}if(s>0){e[a]=e[s];for(let e=s*n,r=a*n,o=0;o!==n;++o)i[r+o]=i[e+o];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*n)):(this.times=e,this.values=i),this}clone(){let e=this.times.slice(),i=this.values.slice(),n=new this.constructor(this.name,e,i);return n.createInterpolant=this.createInterpolant,n}}o_.prototype.TimeBufferType=Float32Array,o_.prototype.ValueBufferType=Float32Array,o_.prototype.DefaultInterpolation=2301;class ob extends o_{constructor(e,i,n){super(e,i,n)}}ob.prototype.ValueTypeName="bool",ob.prototype.ValueBufferType=Array,ob.prototype.DefaultInterpolation=2300,ob.prototype.InterpolantFactoryMethodLinear=void 0,ob.prototype.InterpolantFactoryMethodSmooth=void 0;class oE extends o_{}oE.prototype.ValueTypeName="color";class ow extends o_{}ow.prototype.ValueTypeName="number";class oM extends oA{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e,i,n,r){let s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(n-i)/(r-i),h=e*o;for(let e=h+o;h!==e;h+=4)iO.slerpFlat(s,0,a,h-o,a,h,l);return s}}class oC extends o_{InterpolantFactoryMethodLinear(e){return new oM(this.times,this.values,this.getValueSize(),e)}}oC.prototype.ValueTypeName="quaternion",oC.prototype.InterpolantFactoryMethodSmooth=void 0;class oS extends o_{constructor(e,i,n){super(e,i,n)}}oS.prototype.ValueTypeName="string",oS.prototype.ValueBufferType=Array,oS.prototype.DefaultInterpolation=2300,oS.prototype.InterpolantFactoryMethodLinear=void 0,oS.prototype.InterpolantFactoryMethodSmooth=void 0;class oT extends o_{}oT.prototype.ValueTypeName="vector";class oR{constructor(e="",i=-1,n=[],r=2500){this.name=e,this.tracks=n,this.duration=i,this.blendMode=r,this.uuid=t7(),this.duration<0&&this.resetDuration()}static parse(e){let i=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,s=n.length;e!==s;++e)i.push((function(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let i=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ow;case"vector":case"vector2":case"vector3":case"vector4":return oT;case"color":return oE;case"quaternion":return oC;case"bool":case"boolean":return ob;case"string":return oS}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let i=[],n=[];og(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==i.parse?i.parse(e):new i(e.name,e.times,e.values,e.interpolation)})(n[e]).scale(r));let s=new this(e.name,e.duration,i,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){let i=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)i.push(o_.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,i,n,r){let s=i.length,a=[];for(let e=0;e<s;e++){let o=[],l=[];o.push((e+s-1)%s,e,(e+1)%s),l.push(0,1,0);let h=function(e){let i=e.length,n=Array(i);for(let e=0;e!==i;++e)n[e]=e;return n.sort(function(i,n){return e[i]-e[n]}),n}(o);o=om(o,1,h),l=om(l,1,h),r||0!==o[0]||(o.push(s),l.push(l[0])),a.push(new ow(".morphTargetInfluences["+i[e].name+"]",o,l).scale(1/n))}return new this(e,-1,a)}static findByName(e,i){let n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<n.length;e++)if(n[e].name===i)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,i,n){let r={},s=/^([\w-]*?)([\d]+)$/;for(let i=0,n=e.length;i<n;i++){let n=e[i],a=n.name.match(s);if(a&&a.length>1){let e=a[1],i=r[e];i||(r[e]=i=[]),i.push(n)}}let a=[];for(let e in r)a.push(this.CreateFromMorphTargetSequence(e,r[e],i,n));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(e,i,n,r,s){if(0!==n.length){let a=[],o=[];og(n,a,o,r),0!==a.length&&s.push(new e(i,a,o))}},r=[],s=e.name||"default",a=e.fps||30,o=e.blendMode,l=e.length||-1,h=e.hierarchy||[];for(let e=0;e<h.length;e++){let s=h[e].keys;if(s&&0!==s.length){if(s[0].morphTargets){let e;let i={};for(e=0;e<s.length;e++)if(s[e].morphTargets)for(let n=0;n<s[e].morphTargets.length;n++)i[s[e].morphTargets[n]]=-1;for(let n in i){let i=[],a=[];for(let r=0;r!==s[e].morphTargets.length;++r){let r=s[e];i.push(r.time),a.push(+(r.morphTarget===n))}r.push(new ow(".morphTargetInfluence["+n+"]",i,a))}l=i.length*a}else{let a=".bones["+i[e].name+"]";n(oT,a+".position",s,"pos",r),n(oC,a+".quaternion",s,"rot",r),n(oT,a+".scale",s,"scl",r)}}}return 0===r.length?null:new this(s,l,r,o)}resetDuration(){let e=this.tracks,i=0;for(let n=0,r=e.length;n!==r;++n){let e=this.tracks[n];i=Math.max(i,e.times[e.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}let oI={enabled:!1,files:{},add:function(e,i){!1!==this.enabled&&(this.files[e]=i)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class oB{constructor(e,i,n){let r;let s=this,a=!1,o=0,l=0,h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=n,this.itemStart=function(e){l++,!1===a&&void 0!==s.onStart&&s.onStart(e,o,l),a=!0},this.itemEnd=function(e){o++,void 0!==s.onProgress&&s.onProgress(e,o,l),o===l&&(a=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(e){void 0!==s.onError&&s.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,i){return h.push(e,i),this},this.removeHandler=function(e){let i=h.indexOf(e);return -1!==i&&h.splice(i,2),this},this.getHandler=function(e){for(let i=0,n=h.length;i<n;i+=2){let n=h[i],r=h[i+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}let oL=new oB;class oP{constructor(e){this.manager=void 0!==e?e:oL,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){let n=this;return new Promise(function(r,s){n.load(e,r,i,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}oP.DEFAULT_MATERIAL_NAME="__DEFAULT";let oD={};class oN extends Error{constructor(e,i){super(e),this.response=i}}class oO extends oP{constructor(e){super(e)}load(e,i,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let s=oI.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{i&&i(s),this.manager.itemEnd(e)},0),s;if(void 0!==oD[e]){oD[e].push({onLoad:i,onProgress:n,onError:r});return}oD[e]=[],oD[e].push({onLoad:i,onProgress:n,onError:r});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(i=>{if(200===i.status||0===i.status){if(0===i.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===i.body||void 0===i.body.getReader)return i;let n=oD[e],r=i.body.getReader(),s=i.headers.get("X-File-Size")||i.headers.get("Content-Length"),a=s?parseInt(s):0,o=0!==a,l=0;return new Response(new ReadableStream({start(e){(function i(){r.read().then(({done:r,value:s})=>{if(r)e.close();else{let r=new ProgressEvent("progress",{lengthComputable:o,loaded:l+=s.byteLength,total:a});for(let e=0,i=n.length;e<i;e++){let i=n[e];i.onProgress&&i.onProgress(r)}e.enqueue(s),i()}},i=>{e.error(i)})})()}}))}throw new oN(`fetch for "${i.url}" responded with ${i.status}: ${i.statusText}`,i)}).then(e=>{switch(l){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>new DOMParser().parseFromString(e,o));case"json":return e.json();default:if(void 0===o)return e.text();{let i=/charset="?([^;"\s]*)"?/i.exec(o),n=new TextDecoder(i&&i[1]?i[1].toLowerCase():void 0);return e.arrayBuffer().then(e=>n.decode(e))}}}).then(i=>{oI.add(e,i);let n=oD[e];delete oD[e];for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onLoad&&r.onLoad(i)}}).catch(i=>{let n=oD[e];if(void 0===n)throw this.manager.itemError(e),i;delete oD[e];for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onError&&r.onError(i)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class oU extends oP{constructor(e){super(e)}load(e,i,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,a=oI.get(e);if(void 0!==a)return s.manager.itemStart(e),setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a;let o=id("img");function l(){u(),oI.add(e,this),i&&i(this),s.manager.itemEnd(e)}function h(i){u(),r&&r(i),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",h,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class ok extends oP{constructor(e){super(e)}load(e,i,n,r){let s=new iI,a=new oU(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){s.image=e,s.needsUpdate=!0,void 0!==i&&i(s)},n,r),s}}class oF extends nI{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new nK(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,void 0!==this.groundColor&&(i.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(i.object.distance=this.distance),void 0!==this.angle&&(i.object.angle=this.angle),void 0!==this.decay&&(i.object.decay=this.decay),void 0!==this.penumbra&&(i.object.penumbra=this.penumbra),void 0!==this.shadow&&(i.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(i.object.target=this.target.uuid),i}}class oz extends oF{constructor(e,i,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(nI.DEFAULT_UP),this.updateMatrix(),this.groundColor=new nK(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}let oG=new nn,oV=new iU,oj=new iU;class oH{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ia(512,512),this.map=null,this.mapPass=null,this.matrix=new nn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new sM,this._frameExtents=new ia(1,1),this._viewportCount=1,this._viewports=[new iB(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let i=this.camera,n=this.matrix;oV.setFromMatrixPosition(e.matrixWorld),i.position.copy(oV),oj.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(oj),i.updateMatrixWorld(),oG.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(oG),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(oG)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class oQ extends oH{constructor(){super(new rB(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let i=this.camera,n=2*t8*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||i.far;(n!==i.fov||r!==i.aspect||s!==i.far)&&(i.fov=n,i.aspect=r,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class oW extends oF{constructor(e,i,n=0,r=Math.PI/3,s=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(nI.DEFAULT_UP),this.updateMatrix(),this.target=new nI,this.distance=n,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new oQ}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let oq=new nn,oX=new iU,oK=new iU;class oY extends oH{constructor(){super(new rB(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ia(4,2),this._viewportCount=6,this._viewports=[new iB(2,1,1,1),new iB(0,1,1,1),new iB(3,1,1,1),new iB(1,1,1,1),new iB(3,0,1,1),new iB(1,0,1,1)],this._cubeDirections=[new iU(1,0,0),new iU(-1,0,0),new iU(0,0,1),new iU(0,0,-1),new iU(0,1,0),new iU(0,-1,0)],this._cubeUps=[new iU(0,1,0),new iU(0,1,0),new iU(0,1,0),new iU(0,1,0),new iU(0,0,1),new iU(0,0,-1)]}updateMatrices(e,i=0){let n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),oX.setFromMatrixPosition(e.matrixWorld),n.position.copy(oX),oK.copy(n.position),oK.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(oK),n.updateMatrixWorld(),r.makeTranslation(-oX.x,-oX.y,-oX.z),oq.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(oq)}}class oJ extends oF{constructor(e,i,n=0,r=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new oY}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class oZ extends rS{constructor(e=-1,i=1,n=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=n,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,i,n,r,s,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=n-e,a=n+e,o=r+i,l=r-i;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,i=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=e*this.view.offsetX,a=s+e*this.view.width,o-=i*this.view.offsetY,l=o-i*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,null!==this.view&&(i.object.view=Object.assign({},this.view)),i}}class o$ extends oH{constructor(){super(new oZ(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class o0 extends oF{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(nI.DEFAULT_UP),this.updateMatrix(),this.target=new nI,this.shadow=new o$}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class o1 extends oF{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class o2 extends oF{constructor(e,i,n=10,r=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class o3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new iU)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){let n=e.x,r=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*r),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*n),i.addScaledVector(a[4],n*r*1.092548),i.addScaledVector(a[5],r*s*1.092548),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],n*s*1.092548),i.addScaledVector(a[8],.546274*(n*n-r*r)),i}getIrradianceAt(e,i){let n=e.x,r=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],1.023328*r),i.addScaledVector(a[2],1.023328*s),i.addScaledVector(a[3],1.023328*n),i.addScaledVector(a[4],.858086*n*r),i.addScaledVector(a[5],.858086*r*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],.858086*n*s),i.addScaledVector(a[8],.429043*(n*n-r*r)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){let n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,i+3*r);return this}toArray(e=[],i=0){let n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,i+3*r);return e}static getBasisAt(e,i){let n=e.x,r=e.y,s=e.z;i[0]=.282095,i[1]=.488603*r,i[2]=.488603*s,i[3]=.488603*n,i[4]=1.092548*n*r,i[5]=1.092548*r*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*n*s,i[8]=.546274*(n*n-r*r)}}class o4 extends oF{constructor(e=new o3,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class o5 extends oP{constructor(e){super(e),this.textures={}}load(e,i,n,r){let s=this,a=new oO(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(n){try{i(s.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),s.manager.itemError(e)}},n,r)}parse(e){let i=this.textures;function n(e){return void 0===i[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),i[e]}let r=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=new nK().setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(r.dispersion=e.dispersion),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(let i in e.uniforms){let s=e.uniforms[i];switch(r.uniforms[i]={},s.type){case"t":r.uniforms[i].value=n(s.value);break;case"c":r.uniforms[i].value=new nK().setHex(s.value);break;case"v2":r.uniforms[i].value=new ia().fromArray(s.value);break;case"v3":r.uniforms[i].value=new iU().fromArray(s.value);break;case"v4":r.uniforms[i].value=new iB().fromArray(s.value);break;case"m3":r.uniforms[i].value=new io().fromArray(s.value);break;case"m4":r.uniforms[i].value=new nn().fromArray(s.value);break;default:r.uniforms[i].value=s.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(let i in e.extensions)r.extensions[i]=e.extensions[i];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let i=e.normalScale;!1===Array.isArray(i)&&(i=[i,i]),r.normalScale=new ia().fromArray(i)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapRotation&&r.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=new ia().fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return o5.createMaterialFromType(e)}static createMaterialFromType(e){return new({ShadowMaterial:oi,SpriteMaterial:rG,RawShaderMaterial:on,ShaderMaterial:rC,PointsMaterial:s2,MeshPhysicalMaterial:os,MeshStandardMaterial:or,MeshPhongMaterial:oa,MeshToonMaterial:oo,MeshNormalMaterial:ol,MeshLambertMaterial:oh,MeshDepthMaterial:ou,MeshDistanceMaterial:oc,MeshBasicMaterial:n$,MeshMatcapMaterial:od,LineDashedMaterial:op,LineBasicMaterial:sV,Material:nZ})[e]}}class o6{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let i="";for(let n=0,r=e.length;n<r;n++)i+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(i))}catch(e){return i}}static extractUrlBase(e){let i=e.lastIndexOf("/");return -1===i?"./":e.slice(0,i+1)}static resolveURL(e,i){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:i+e}}class o8 extends ro{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class o7 extends oP{constructor(e){super(e)}load(e,i,n,r){let s=this,a=new oO(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(n){try{i(s.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),s.manager.itemError(e)}},n,r)}parse(e){let i={},n={};function r(e,r){if(void 0!==i[r])return i[r];let s=e.interleavedBuffers[r],a=function(e,i){if(void 0!==n[i])return n[i];let r=new Uint32Array(e.arrayBuffers[i]).buffer;return n[i]=r,r}(e,s.buffer),o=new rk(ic(s.type,a),s.stride);return o.uuid=s.uuid,i[r]=o,o}let s=e.isInstancedBufferGeometry?new o8:new ro,a=e.data.index;if(void 0!==a){let e=ic(a.type,a.array);s.setIndex(new n5(e,1))}let o=e.data.attributes;for(let i in o){let n;let a=o[i];if(a.isInterleavedBufferAttribute)n=new rz(r(e.data,a.data),a.itemSize,a.offset,a.normalized);else{let e=ic(a.type,a.array);n=new(a.isInstancedBufferAttribute?su:n5)(e,a.itemSize,a.normalized)}void 0!==a.name&&(n.name=a.name),void 0!==a.usage&&n.setUsage(a.usage),s.setAttribute(i,n)}let l=e.data.morphAttributes;if(l)for(let i in l){let n=l[i],a=[];for(let i=0,s=n.length;i<s;i++){let s;let o=n[i];s=o.isInterleavedBufferAttribute?new rz(r(e.data,o.data),o.itemSize,o.offset,o.normalized):new n5(ic(o.type,o.array),o.itemSize,o.normalized),void 0!==o.name&&(s.name=o.name),a.push(s)}s.morphAttributes[i]=a}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let h=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==h)for(let e=0,i=h.length;e!==i;++e){let i=h[e];s.addGroup(i.start,i.count,i.materialIndex)}let u=e.data.boundingSphere;if(void 0!==u){let e=new iU;void 0!==u.center&&e.fromArray(u.center),s.boundingSphere=new i4(e,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}class o9 extends oP{constructor(e){super(e)}load(e,i,n,r){let s=this,a=""===this.path?o6.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;let o=new oO(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){let a=null;try{a=JSON.parse(n)}catch(i){void 0!==r&&r(i),console.error("THREE:ObjectLoader: Can't parse "+e+".",i.message);return}let o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase()){void 0!==r&&r(Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(a,i)},n,r)}async loadAsync(e,i){let n=""===this.path?o6.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;let r=new oO(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);let s=JSON.parse(await r.loadAsync(e,i)),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,i){let n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){void 0!==i&&i(h)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),h=this.parseObject(e.object,s,l,o,n),u=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,u),this.bindLightTargets(h),void 0!==i){let e=!1;for(let i in a)if(a[i].data instanceof HTMLImageElement){e=!0;break}!1===e&&i(h)}return h}async parseAsync(e){let i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,o,a,i),h=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,h),this.bindLightTargets(l),l}parseShapes(e){let i={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){let r=new aL().fromJSON(e[n]);i[r.uuid]=r}return i}parseSkeletons(e,i){let n={},r={};if(i.traverse(function(e){e.isBone&&(r[e.uuid]=e)}),void 0!==e)for(let i=0,s=e.length;i<s;i++){let s=new sh().fromJSON(e[i],r);n[s.uuid]=s}return n}parseGeometries(e,i){let n={};if(void 0!==e){let r=new o7;for(let s=0,a=e.length;s<a;s++){let a;let o=e[s];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(o);break;default:o.type in ot?a=ot[o.type].fromJSON(o,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.userData&&(a.userData=o.userData),n[o.uuid]=a}}return n}parseMaterials(e,i){let n={},r={};if(void 0!==e){let s=new o5;s.setTextures(i);for(let i=0,a=e.length;i<a;i++){let a=e[i];void 0===n[a.uuid]&&(n[a.uuid]=s.parse(a)),r[a.uuid]=n[a.uuid]}}return r}parseAnimations(e){let i={};if(void 0!==e)for(let n=0;n<e.length;n++){let r=e[n],s=oR.parse(r);i[s.uuid]=s}return i}parseImages(e,i){let n;let r=this,s={};function a(e){if("string"==typeof e){var i;return i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e,r.manager.itemStart(i),n.load(i,function(){r.manager.itemEnd(i)},void 0,function(){r.manager.itemError(i),r.manager.itemEnd(i)})}return e.data?{data:ic(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(n=new oU(new oB(i))).setCrossOrigin(this.crossOrigin);for(let i=0,n=e.length;i<n;i++){let n=e[i],r=n.url;if(Array.isArray(r)){let e=[];for(let i=0,n=r.length;i<n;i++){let n=a(r[i]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new sa(n.data,n.width,n.height)))}s[n.uuid]=new iS(e)}else{let e=a(n.url);s[n.uuid]=new iS(e)}}}return s}async parseImagesAsync(e){let i;let n=this,r={};async function s(e){if("string"==typeof e){let r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;return await i.loadAsync(r)}return e.data?{data:ic(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(i=new oU(this.manager)).setCrossOrigin(this.crossOrigin);for(let i=0,n=e.length;i<n;i++){let n=e[i],a=n.url;if(Array.isArray(a)){let e=[];for(let i=0,n=a.length;i<n;i++){let n=a[i],r=await s(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new sa(r.data,r.width,r.height)))}r[n.uuid]=new iS(e)}else{let e=await s(n.url);r[n.uuid]=new iS(e)}}}return r}parseTextures(e,i){function n(e,i){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),i[e])}let r={};if(void 0!==e)for(let s=0,a=e.length;s<a;s++){let a;let o=e[s];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===i[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);let l=i[o.image],h=l.data;Array.isArray(h)?(a=new rP,6===h.length&&(a.needsUpdate=!0)):(a=h&&h.data?new sa:new iI,h&&(a.needsUpdate=!0)),a.source=l,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.mapping&&(a.mapping=n(o.mapping,le)),void 0!==o.channel&&(a.channel=o.channel),void 0!==o.offset&&a.offset.fromArray(o.offset),void 0!==o.repeat&&a.repeat.fromArray(o.repeat),void 0!==o.center&&a.center.fromArray(o.center),void 0!==o.rotation&&(a.rotation=o.rotation),void 0!==o.wrap&&(a.wrapS=n(o.wrap[0],lt),a.wrapT=n(o.wrap[1],lt)),void 0!==o.format&&(a.format=o.format),void 0!==o.internalFormat&&(a.internalFormat=o.internalFormat),void 0!==o.type&&(a.type=o.type),void 0!==o.colorSpace&&(a.colorSpace=o.colorSpace),void 0!==o.minFilter&&(a.minFilter=n(o.minFilter,li)),void 0!==o.magFilter&&(a.magFilter=n(o.magFilter,li)),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),void 0!==o.flipY&&(a.flipY=o.flipY),void 0!==o.generateMipmaps&&(a.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(a.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(a.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(a.compareFunction=o.compareFunction),void 0!==o.userData&&(a.userData=o.userData),r[o.uuid]=a}return r}parseObject(e,i,n,r,s){let a,o,l;function h(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){let i=[];for(let r=0,s=e.length;r<s;r++){let s=e[r];void 0===n[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),i.push(n[s])}return i}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function c(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":a=new rU,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new nK(e.background):a.background=c(e.background)),void 0!==e.environment&&(a.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new rO(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new rN(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&a.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(a.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new rB(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new oZ(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new o1(e.color,e.intensity);break;case"DirectionalLight":(a=new o0(e.color,e.intensity)).target=e.target||"";break;case"PointLight":a=new oJ(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new o2(e.color,e.intensity,e.width,e.height);break;case"SpotLight":(a=new oW(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay)).target=e.target||"";break;case"HemisphereLight":a=new oz(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new o4().fromJSON(e);break;case"SkinnedMesh":a=new sr(o=h(e.geometry),l=u(e.material)),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":a=new ry(o=h(e.geometry),l=u(e.material));break;case"InstancedMesh":o=h(e.geometry),l=u(e.material);let d=e.count,p=e.instanceMatrix,f=e.instanceColor;(a=new sv(o,l,d)).instanceMatrix=new su(new Float32Array(p.array),16),void 0!==f&&(a.instanceColor=new su(new Float32Array(f.array),f.itemSize));break;case"BatchedMesh":o=h(e.geometry),l=u(e.material),(a=new sG(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,l)).geometry=o,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(e=>{let i=new iz;i.min.fromArray(e.boxMin),i.max.fromArray(e.boxMax);let n=new i4;return n.radius=e.sphereRadius,n.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:i,sphereInitialized:e.sphereInitialized,sphere:n}}),a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=c(e.matricesTexture.uuid),void 0!==e.colorsTexture&&(a._colorsTexture=c(e.colorsTexture.uuid));break;case"LOD":a=new r4;break;case"Line":a=new sY(h(e.geometry),u(e.material));break;case"LineLoop":a=new s1(h(e.geometry),u(e.material));break;case"LineSegments":a=new s0(h(e.geometry),u(e.material));break;case"PointCloud":case"Points":a=new s8(h(e.geometry),u(e.material));break;case"Sprite":a=new r0(u(e.material));break;case"Group":a=new s9;break;case"Bone":a=new ss;break;default:a=new nI}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(a.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){let o=e.children;for(let e=0;e<o.length;e++)a.add(this.parseObject(o[e],i,n,r,s))}if(void 0!==e.animations){let i=e.animations;for(let e=0;e<i.length;e++){let n=i[e];a.animations.push(s[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);let i=e.levels;for(let e=0;e<i.length;e++){let n=i[e],r=a.getObjectByProperty("uuid",n.object);void 0!==r&&a.addLevel(r,n.distance,n.hysteresis)}}return a}bindSkeletons(e,i){0!==Object.keys(i).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){let n=i[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}})}bindLightTargets(e){e.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){let n=i.target,r=e.getObjectByProperty("uuid",n);void 0!==r?i.target=r:i.target=new nI}})}}let le={UVMapping:ec,CubeReflectionMapping:ed,CubeRefractionMapping:ep,EquirectangularReflectionMapping:ef,EquirectangularRefractionMapping:em,CubeUVReflectionMapping:eg},lt={RepeatWrapping:eA,ClampToEdgeWrapping:ev,MirroredRepeatWrapping:ey},li={NearestFilter:ex,NearestMipmapNearestFilter:e_,NearestMipmapLinearFilter:eb,LinearFilter:eE,LinearMipmapNearestFilter:ew,LinearMipmapLinearFilter:eM};class ln extends rB{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class lr{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ls(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let i=ls();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function ls(){return performance.now()}let la="\\[\\]\\.:\\/",lo=RegExp("["+la+"]","g"),ll="[^"+la+"]",lh="[^"+la.replace("\\.","")+"]",lu=/((?:WC+[\/:])*)/.source.replace("WC",ll),lc=/(WCOD+)?/.source.replace("WCOD",lh),ld=RegExp("^"+lu+lc+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ll)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ll)+"$"),lp=["material","materials","bones","map"];class lf{constructor(e,i,n){this.path=i,this.parsedPath=n||lf.parseTrackName(i),this.node=lf.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,n){return e&&e.isAnimationObjectGroup?new lf.Composite(e,i,n):new lf(e,i,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(lo,"")}static parseTrackName(e){let i=ld.exec(e);if(null===i)throw Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let e=n.nodeName.substring(r+1);-1!==lp.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,i){if(void 0===i||""===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(i);if(void 0!==n)return n}if(e.children){let n=function(e){for(let r=0;r<e.length;r++){let s=e[r];if(s.name===i||s.uuid===i)return s;let a=n(s.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[i++]=n[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){let n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node,i=this.parsedPath,n=i.objectName,r=i.propertyName,s=i.propertyIndex;if(e||(e=lf.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let r=i.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let i=0;i<e.length;i++)if(e[i].name===r){r=i;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(void 0===e[n]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(void 0!==r){if(void 0===e[r]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[r]}}let a=e[r];if(void 0===a){console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+r+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?o=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===r){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}lf.Composite=class{constructor(e,i,n){let r=n||lf.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,r)}getValue(e,i){this.bind();let n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,i)}setValue(e,i){let n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,i)}bind(){let e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].bind()}unbind(){let e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].unbind()}},lf.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},lf.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},lf.prototype.GetterByBindingType=[lf.prototype._getValue_direct,lf.prototype._getValue_array,lf.prototype._getValue_arrayElement,lf.prototype._getValue_toArray],lf.prototype.SetterByBindingTypeAndVersioning=[[lf.prototype._setValue_direct,lf.prototype._setValue_direct_setNeedsUpdate,lf.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lf.prototype._setValue_array,lf.prototype._setValue_array_setNeedsUpdate,lf.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lf.prototype._setValue_arrayElement,lf.prototype._setValue_arrayElement_setNeedsUpdate,lf.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lf.prototype._setValue_fromArray,lf.prototype._setValue_fromArray_setNeedsUpdate,lf.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class lm extends rk{constructor(e,i,n=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){let i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}let lg=new nn;class lA{constructor(e,i,n=0,r=1/0){this.ray=new ni(e,i),this.near=n,this.far=r,this.camera=null,this.layers=new nf,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return lg.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(lg),this}intersectObject(e,i=!0,n=[]){return ly(e,this,n,i),n.sort(lv),n}intersectObjects(e,i=!0,n=[]){for(let r=0,s=e.length;r<s;r++)ly(e[r],this,n,i);return n.sort(lv),n}}function lv(e,i){return e.distance-i.distance}function ly(e,i,n,r){let s=!0;if(e.layers.test(i.layers)&&!1===e.raycast(i,n)&&(s=!1),!0===s&&!0===r){let r=e.children;for(let e=0,s=r.length;e<s;e++)ly(r[e],i,n,!0)}}class lx{constructor(e=1,i=0,n=0){return this.radius=e,this.phi=i,this.theta=n,this}set(e,i,n){return this.radius=e,this.phi=i,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=t9(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+i*i+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(t9(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class l_ extends t3{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function lb(e,i,n,r){let s=function(e){switch(e){case eS:case eT:return{byteLength:1,components:1};case eI:case eR:case eD:return{byteLength:2,components:1};case eN:case eO:return{byteLength:2,components:4};case eL:case eB:case eP:return{byteLength:4,components:1};case ek:return{byteLength:4,components:3}}throw Error(`Unknown texture type ${e}.`)}(r);switch(n){case eF:case eV:return e*i;case ej:return e*i*2;case eW:case eq:return e*i/s.components*s.byteLength;case eX:case eK:return e*i*2/s.components*s.byteLength;case ez:return e*i*3/s.components*s.byteLength;case eG:case eJ:return e*i*4/s.components*s.byteLength;case eZ:case e$:return Math.floor((e+3)/4)*Math.floor((i+3)/4)*8;case e0:case e1:return Math.floor((e+3)/4)*Math.floor((i+3)/4)*16;case e3:case e5:return Math.max(e,16)*Math.max(i,8)/4;case e2:case e4:return Math.max(e,8)*Math.max(i,8)/2;case e6:case e8:return Math.floor((e+3)/4)*Math.floor((i+3)/4)*8;case e7:case e9:return Math.floor((e+3)/4)*Math.floor((i+3)/4)*16;case te:return Math.floor((e+4)/5)*Math.floor((i+3)/4)*16;case tt:return Math.floor((e+4)/5)*Math.floor((i+4)/5)*16;case ti:return Math.floor((e+5)/6)*Math.floor((i+4)/5)*16;case tn:return Math.floor((e+5)/6)*Math.floor((i+5)/6)*16;case tr:return Math.floor((e+7)/8)*Math.floor((i+4)/5)*16;case ts:return Math.floor((e+7)/8)*Math.floor((i+5)/6)*16;case ta:return Math.floor((e+7)/8)*Math.floor((i+7)/8)*16;case to:return Math.floor((e+9)/10)*Math.floor((i+4)/5)*16;case tl:return Math.floor((e+9)/10)*Math.floor((i+5)/6)*16;case th:return Math.floor((e+9)/10)*Math.floor((i+7)/8)*16;case tu:return Math.floor((e+9)/10)*Math.floor((i+9)/10)*16;case tc:return Math.floor((e+11)/12)*Math.floor((i+9)/10)*16;case td:return Math.floor((e+11)/12)*Math.floor((i+11)/12)*16;case tp:case tf:case tm:return Math.ceil(e/4)*Math.ceil(i/4)*16;case tg:case tA:return Math.ceil(e/4)*Math.ceil(i/4)*8;case tv:case ty:return Math.ceil(e/4)*Math.ceil(i/4)*16}throw Error(`Unable to determine texture byte length for ${n} format.`)}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:a}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=a)},44497:function(e,i,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(i,{Z:()=>u});var s,a,o,l=/^\s+/,h=/\s+$/;function u(e,i){if(i=i||{},(e=e||"")instanceof u)return e;if(!(this instanceof u))return new u(e,i);var n,s,a,o,c,d,p,f,m,g,A,v,y,x,_,b,E,w,M,C,T=(s={r:0,g:0,b:0},a=1,o=null,c=null,d=null,p=!1,f=!1,"string"==typeof(n=e)&&(n=function(e){e=e.replace(l,"").replace(h,"").toLowerCase();var i,n=!1;if(S[e])e=S[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};return(i=O.rgb.exec(e))?{r:i[1],g:i[2],b:i[3]}:(i=O.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=O.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=O.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=O.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=O.hsva.exec(e))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=O.hex8.exec(e))?{r:L(i[1]),g:L(i[2]),b:L(i[3]),a:L(i[4])/255,format:n?"name":"hex8"}:(i=O.hex6.exec(e))?{r:L(i[1]),g:L(i[2]),b:L(i[3]),format:n?"name":"hex"}:(i=O.hex4.exec(e))?{r:L(i[1]+""+i[1]),g:L(i[2]+""+i[2]),b:L(i[3]+""+i[3]),a:L(i[4]+""+i[4])/255,format:n?"name":"hex8"}:!!(i=O.hex3.exec(e))&&{r:L(i[1]+""+i[1]),g:L(i[2]+""+i[2]),b:L(i[3]+""+i[3]),format:n?"name":"hex"}}(n)),"object"==r(n)&&(U(n.r)&&U(n.g)&&U(n.b)?(m=n.r,g=n.g,A=n.b,s={r:255*I(m,255),g:255*I(g,255),b:255*I(A,255)},p=!0,f="%"===String(n.r).substr(-1)?"prgb":"rgb"):U(n.h)&&U(n.s)&&U(n.v)?(o=D(n.s),c=D(n.v),v=n.h,y=o,x=c,v=6*I(v,360),y=I(y,100),x=I(x,100),_=Math.floor(v),b=v-_,E=x*(1-y),w=x*(1-b*y),M=x*(1-(1-b)*y),s={r:255*[x,w,E,E,M,x][C=_%6],g:255*[M,x,x,w,E,E][C],b:255*[E,E,M,x,x,w][C]},p=!0,f="hsv"):U(n.h)&&U(n.s)&&U(n.l)&&(o=D(n.s),d=D(n.l),s=function(e,i,n){var r,s,a;function o(e,i,n){return(n<0&&(n+=1),n>1&&(n-=1),n<1/6)?e+(i-e)*6*n:n<.5?i:n<2/3?e+(i-e)*(2/3-n)*6:e}if(e=I(e,360),i=I(i,100),n=I(n,100),0===i)r=s=a=n;else{var l=n<.5?n*(1+i):n+i-n*i,h=2*n-l;r=o(h,l,e+1/3),s=o(h,l,e),a=o(h,l,e-1/3)}return{r:255*r,g:255*s,b:255*a}}(n.h,o,d),p=!0,f="hsl"),n.hasOwnProperty("a")&&(a=n.a)),a=R(a),{ok:p,format:n.format||f,r:Math.min(255,Math.max(s.r,0)),g:Math.min(255,Math.max(s.g,0)),b:Math.min(255,Math.max(s.b,0)),a:a});this._originalInput=e,this._r=T.r,this._g=T.g,this._b=T.b,this._a=T.a,this._roundA=Math.round(100*this._a)/100,this._format=i.format||T.format,this._gradientType=i.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=T.ok}function c(e,i,n){e=I(e,255);var r,s,a=Math.max(e,i=I(i,255),n=I(n,255)),o=Math.min(e,i,n),l=(a+o)/2;if(a==o)r=s=0;else{var h=a-o;switch(s=l>.5?h/(2-a-o):h/(a+o),a){case e:r=(i-n)/h+6*(i<n);break;case i:r=(n-e)/h+2;break;case n:r=(e-i)/h+4}r/=6}return{h:r,s:s,l:l}}function d(e,i,n){e=I(e,255);var r,s,a=Math.max(e,i=I(i,255),n=I(n,255)),o=Math.min(e,i,n),l=a-o;if(s=0===a?0:l/a,a==o)r=0;else{switch(a){case e:r=(i-n)/l+6*(i<n);break;case i:r=(n-e)/l+2;break;case n:r=(e-i)/l+4}r/=6}return{h:r,s:s,v:a}}function p(e,i,n,r){var s=[P(Math.round(e).toString(16)),P(Math.round(i).toString(16)),P(Math.round(n).toString(16))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function f(e,i,n,r){return[P(N(r)),P(Math.round(e).toString(16)),P(Math.round(i).toString(16)),P(Math.round(n).toString(16))].join("")}function m(e,i){i=0===i?0:i||10;var n=u(e).toHsl();return n.s-=i/100,n.s=B(n.s),u(n)}function g(e,i){i=0===i?0:i||10;var n=u(e).toHsl();return n.s+=i/100,n.s=B(n.s),u(n)}function A(e){return u(e).desaturate(100)}function v(e,i){i=0===i?0:i||10;var n=u(e).toHsl();return n.l+=i/100,n.l=B(n.l),u(n)}function y(e,i){i=0===i?0:i||10;var n=u(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-(i/100*255)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-(i/100*255)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-(i/100*255)))),u(n)}function x(e,i){i=0===i?0:i||10;var n=u(e).toHsl();return n.l-=i/100,n.l=B(n.l),u(n)}function _(e,i){var n=u(e).toHsl(),r=(n.h+i)%360;return n.h=r<0?360+r:r,u(n)}function b(e){var i=u(e).toHsl();return i.h=(i.h+180)%360,u(i)}function E(e,i){if(isNaN(i)||i<=0)throw Error("Argument to polyad must be a positive number");for(var n=u(e).toHsl(),r=[u(e)],s=360/i,a=1;a<i;a++)r.push(u({h:(n.h+a*s)%360,s:n.s,l:n.l}));return r}function w(e){var i=u(e).toHsl(),n=i.h;return[u(e),u({h:(n+72)%360,s:i.s,l:i.l}),u({h:(n+216)%360,s:i.s,l:i.l})]}function M(e,i,n){i=i||6,n=n||30;var r=u(e).toHsl(),s=360/n,a=[u(e)];for(r.h=(r.h-(s*i>>1)+720)%360;--i;)r.h=(r.h+s)%360,a.push(u(r));return a}function C(e,i){i=i||6;for(var n=u(e).toHsv(),r=n.h,s=n.s,a=n.v,o=[],l=1/i;i--;)o.push(u({h:r,s:s,v:a})),a=(a+l)%1;return o}u.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,i,n,r,s,a,o=this.toRgb();return e=o.r/255,i=o.g/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.0722*((n=o.b/255)<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(e){return this._a=R(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=d(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=d(this._r,this._g,this._b),i=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.v);return 1==this._a?"hsv("+i+", "+n+"%, "+r+"%)":"hsva("+i+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=c(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=c(this._r,this._g,this._b),i=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.l);return 1==this._a?"hsl("+i+", "+n+"%, "+r+"%)":"hsla("+i+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return p(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){var i,n,r,s,a,o;return i=this._r,n=this._g,r=this._b,s=this._a,a=e,o=[P(Math.round(i).toString(16)),P(Math.round(n).toString(16)),P(Math.round(r).toString(16)),P(N(s))],a&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*I(this._r,255))+"%",g:Math.round(100*I(this._g,255))+"%",b:Math.round(100*I(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*I(this._r,255))+"%, "+Math.round(100*I(this._g,255))+"%, "+Math.round(100*I(this._b,255))+"%)":"rgba("+Math.round(100*I(this._r,255))+"%, "+Math.round(100*I(this._g,255))+"%, "+Math.round(100*I(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(T[p(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var i="#"+f(this._r,this._g,this._b,this._a),n=i,r=this._gradientType?"GradientType = 1, ":"";if(e){var s=u(e);n="#"+f(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+i+",endColorstr="+n+")"},toString:function(e){var i=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0;return!i&&r&&("hex"===e||"hex6"===e||"hex3"===e||"hex4"===e||"hex8"===e||"name"===e)?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),("hex"===e||"hex6"===e)&&(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return u(this.toString())},_applyModification:function(e,i){var n=e.apply(null,[this].concat([].slice.call(i)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(v,arguments)},brighten:function(){return this._applyModification(y,arguments)},darken:function(){return this._applyModification(x,arguments)},desaturate:function(){return this._applyModification(m,arguments)},saturate:function(){return this._applyModification(g,arguments)},greyscale:function(){return this._applyModification(A,arguments)},spin:function(){return this._applyModification(_,arguments)},_applyCombination:function(e,i){return e.apply(null,[this].concat([].slice.call(i)))},analogous:function(){return this._applyCombination(M,arguments)},complement:function(){return this._applyCombination(b,arguments)},monochromatic:function(){return this._applyCombination(C,arguments)},splitcomplement:function(){return this._applyCombination(w,arguments)},triad:function(){return this._applyCombination(E,[3])},tetrad:function(){return this._applyCombination(E,[4])}},u.fromRatio=function(e,i){if("object"==r(e)){var n={};for(var s in e)e.hasOwnProperty(s)&&("a"===s?n[s]=e[s]:n[s]=D(e[s]));e=n}return u(e,i)},u.equals=function(e,i){return!!e&&!!i&&u(e).toRgbString()==u(i).toRgbString()},u.random=function(){return u.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},u.mix=function(e,i,n){n=0===n?0:n||50;var r=u(e).toRgb(),s=u(i).toRgb(),a=n/100;return u({r:(s.r-r.r)*a+r.r,g:(s.g-r.g)*a+r.g,b:(s.b-r.b)*a+r.b,a:(s.a-r.a)*a+r.a})},u.readability=function(e,i){var n=u(e),r=u(i);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},u.isReadable=function(e,i,n){var r,s,a,o,l,h=u.readability(e,i);switch(l=!1,(s=((r=(r=n)||{level:"AA",size:"small"}).level||"AA").toUpperCase(),a=(r.size||"small").toLowerCase(),"AA"!==s&&"AAA"!==s&&(s="AA"),"small"!==a&&"large"!==a&&(a="small"),o={level:s,size:a}).level+o.size){case"AAsmall":case"AAAlarge":l=h>=4.5;break;case"AAlarge":l=h>=3;break;case"AAAsmall":l=h>=7}return l},u.mostReadable=function(e,i,n){var r,s,a,o,l=null,h=0;s=(n=n||{}).includeFallbackColors,a=n.level,o=n.size;for(var c=0;c<i.length;c++)(r=u.readability(e,i[c]))>h&&(h=r,l=u(i[c]));return u.isReadable(e,l,{level:a,size:o})||!s?l:(n.includeFallbackColors=!1,u.mostReadable(e,["#fff","#000"],n))};var S=u.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},T=u.hexNames=function(e){var i={};for(var n in e)e.hasOwnProperty(n)&&(i[e[n]]=n);return i}(S);function R(e){return(isNaN(e=parseFloat(e))||e<0||e>1)&&(e=1),e}function I(e,i){"string"==typeof(n=e)&&-1!=n.indexOf(".")&&1===parseFloat(n)&&(e="100%");var n,r,s="string"==typeof(r=e)&&-1!=r.indexOf("%");return(e=Math.min(i,Math.max(0,parseFloat(e))),s&&(e=parseInt(e*i,10)/100),1e-6>Math.abs(e-i))?1:e%i/parseFloat(i)}function B(e){return Math.min(1,Math.max(0,e))}function L(e){return parseInt(e,16)}function P(e){return 1==e.length?"0"+e:""+e}function D(e){return e<=1&&(e=100*e+"%"),e}function N(e){return Math.round(255*parseFloat(e)).toString(16)}var O=(a="[\\s|\\(]+("+(s="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",o="[\\s|\\(]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",{CSS_UNIT:new RegExp(s),rgb:RegExp("rgb"+a),rgba:RegExp("rgba"+o),hsl:RegExp("hsl"+a),hsla:RegExp("hsla"+o),hsv:RegExp("hsv"+a),hsva:RegExp("hsva"+o),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function U(e){return!!O.CSS_UNIT.exec(e)}}}]);