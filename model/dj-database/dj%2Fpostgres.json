{
    "name": "postgres",
    "djClassName": "org.dashjoin.service.SQLDatabase",
    "username": "postgres",
    "password": "DJ1#\bLN1ubFw94pZSZQ4cSG6KxbWukt/wsaZd",
    "url": "jdbc:postgresql://postgres:5432/postgres",
    "ID": "dj/postgres",
    "tables": {
        "Topic": {
            "instanceLayout": {
                "widget": "page",
                "children": [
                    {
                        "text": "Stelle Frage",
                        "print": "(\n$x := $curl(\"POST\", \"https://api.openai.com/v1/chat/completions\", {\n    \"model\": \"gpt-4o-mini\",\n    \"messages\": [\n      {\n        \"role\": \"system\",\n        \"content\": \"Deine Aufgabe ist es, normale Aufgaben zu den folgenden Lernzielen zu erstellen. Jede Aufgabe soll das Verständnis der Studierenden testen und detailliertes Feedback geben, um aufzuzeigen, ob das Lernziel erreicht wurde. Feedback sollte umfassen: eine Erklärung zur richtigen Antwort, Hinweise auf häufige Fehler und Tipps, wie das Lernziel besser verstanden werden kann. Lernziele: \" & form.lernziele\n      },\n      {\n        \"role\": \"user\",\n        \"content\": value.Content\n      }\n    ]\n }, {\"Authorization\": \"openai\"}).choices[0].message.content;\n\n$setVariable(\"frage\", $x);\n$refresh();\n)\n",
                        "widget": "button"
                    },
                    {
                        "title": "Frage",
                        "display": "variable.frage",
                        "widget": "display"
                    },
                    {
                        "title": "Antwort",
                        "print": "(\n\n$x := $curl(\"POST\", \"https://api.openai.com/v1/chat/completions\", {\n    \"model\": \"gpt-4o-mini\",\n    \"messages\": [\n      {\n        \"role\": \"system\",\n        \"content\": \"Du bist ein sehr strenger Medizin Professor. Gib an, zu wie viel Prozent sich die Antwort des Benutzers mit dem Lernziel deckt. Gib ein Feedback von 60 Wörtern, das den Benutzer detailliert informiert, wie gut das Lernziel verstanden wurde und welche Aspekte verbessert werden können. Antworte mit einem JSON-Objekt. Lernziele: \" & form.lernziele\n      },\n      {\n        \"role\": \"user\",\n        \"content\": value.Content\n      },\n      {\n        \"role\": \"assistant\",\n        \"content\": variable.frage\n      },\n      {\n        \"role\": \"user\",\n        \"content\": form.antwort\n      }\n    ]\n }, {\"Authorization\": \"openai\"} ).choices[0].message.content;\n\n$feedback := $parseJson($contains($x, /```json/) ? $substring($x, 7, $length($x)-7-3) : $x);\n\n$setVariable(\"feedback\", $feedback);\n$create(\"postgres\", \"Result\", {\"Topic\": value.ID, \"Grade\": $feedback.note, \"User\": user, \"Time\": $now()});\n$refresh();\n\n)\n",
                        "text": "Antwort schicken",
                        "widget": "button",
                        "schema": {
                            "type": "object",
                            "properties": {
                                "antwort": {
                                    "widget": "textarea",
                                    "style": {
                                        "width": "400px"
                                    }
                                }
                            }
                        }
                    },
                    {
                        "title": "Feedback",
                        "display": "variable.feedback",
                        "widget": "display"
                    },
                    {
                        "html": "<pre>${context}</pre>",
                        "context": "value.Content",
                        "widget": "html"
                    }
                ]
            },
            "dj-label": "${Title}"
        },
        "Lernziel": {
            "dj-label": "${Ziel}"
        },
        "Fachbereich": {
            "instanceLayout": {
                "widget": "page",
                "children": [
                    {
                        "widget": "container",
                        "children": [
                            {
                                "database": "postgres",
                                "query": "lernziel",
                                "arguments": "{\"Fachbereich\": value.ID}",
                                "widget": "table"
                            },
                            {
                                "title": "Edit Record",
                                "widget": "edit"
                            }
                        ]
                    },
                    {
                        "title": "Related Records",
                        "widget": "links"
                    }
                ]
            }
        },
        "Lernziel2Inhalt": {
            "properties": {
                "Inhalt": {
                    "ref": "dj/postgres/Inhalt/ID",
                    "displayWith": "fk"
                },
                "Lernziel": {
                    "ref": "dj/postgres/Lernziel/ID",
                    "displayWith": "fk"
                }
            }
        },
        "Inhalt": {
            "instanceLayout": {
                "widget": "page",
                "children": [
                    {
                        "title": "Edit Record",
                        "widget": "edit"
                    },
                    {
                        "title": "Related Records",
                        "widget": "links"
                    },
                    {
                        "title": "",
                        "print": "(\n$x := $curl(\"POST\", \"https://api.openai.com/v1/chat/completions\", {\n    \"model\": \"gpt-4o-mini\",\n    \"messages\": [\n      {\n        \"role\": \"system\",\n        \"content\": \"Du bist ein Medizin Professor. Stelle mir eine Frage zu dem Text den ich Dir gebe.\"\n      },\n      {\n        \"role\": \"user\",\n        \"content\": value.Inhalt\n      }\n    ]\n }, {\"Authorization\": \"openai\"}).choices[0].message.content;\n$setVariable(\"frage\", $x);\n$refresh();\n)\n",
                        "text": "Stelle Frage",
                        "widget": "button"
                    },
                    {
                        "display": "variable.frage",
                        "widget": "display"
                    },
                    {
                        "print": "(\n$x := $curl(\"POST\", \"https://api.openai.com/v1/chat/completions\", {\n    \"model\": \"gpt-4o-mini\",\n    \"response_format\": { \"type\": \"json_object\" },\n    \"messages\": [\n      {\n        \"role\": \"system\",\n        \"content\": \"Du bist ein strenger Medizin Professor. Stelle mir eine Fachfrage zu dem Text den ich Dir gebe. Anschließend bewertest Du die Antwort mit einem JSON objekt das die folgenden Felder enthält:\nfeedback: ein feedback mit 60 wörtern, mit Erklärung zur richtigen Antwort, Hinweise auf häufige Fehler und Tipps, wie das Lernziel besser verstanden werden kann\nprozent: ein prozentwert der die güte der antwort beschreibt\n\"\n      },\n      {\n        \"role\": \"user\",\n        \"content\": value.Inhalt\n      },\n      {\n        \"role\": \"assistant\",\n        \"content\": variable.frage\n      },\n      {\n        \"role\": \"user\",\n        \"content\": form.antwort\n      }\n    ]\n }, {\"Authorization\": \"openai\"}).choices[0].message.content;\n)\n",
                        "text": "Sende Antwort",
                        "expression": "",
                        "widget": "button",
                        "schema": {
                            "type": "object",
                            "properties": {
                                "antwort": {
                                    "widget": "voice"
                                }
                            }
                        }
                    }
                ]
            }
        }
    },
    "readRoles": [
        "authenticated"
    ]
}